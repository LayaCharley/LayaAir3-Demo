{"version":3,"names":["DepthCasterData","static","DepthCasterUBOData","uniformpara","Map","set","Shader3D","propertyNameToID","UniformBufferParamsType","Vector4","Vector3","UnifromBufferData","DepthTextureMode","WeightedMode","KeyFrameValueType","DepthPass","constructor","this","_defaultNormalDepthColor","Color","_zBufferParams","Config3D","_uniformBlock","_castDepthData","createDepthCasterUniformBlock","_castDepthUBO","UniformBufferObject","getBuffer","UBONAME_SHADOW","create","BufferUsage","Dynamic","getbyteLength","DEPTHPASS","getDefineByName","DEFINE_SHADOW_BIAS","DEPTHTEXTURE","DEPTHNORMALSTEXTURE","DEPTHZBUFFERPARAMS","SHADOWUNIFORMBLOCK","update","camera","depthType","depthTextureFormat","_viewPort","viewport","_camera","Depth","depthTexture","_depthTexture","RenderTexture","createFromPool","width","height","RenderTargetFormat","None","DepthNormals","depthNormalTexture","_depthNormalsTexture","R8G8B8A8","MotionVectors","render","context","scene","shaderValues","_shaderValues","pipelineMode","addDefine","setVector","SHADOW_BIAS","offsetX","x","offsetY","y","_start","LayaGL","renderEngine","scissor","clearRenderTexture","RenderClearFlag","changeViewport","changeScissor","destTarget","Stat","depthCastDrawCall","_opaqueQueue","renderQueue","_end","_setupDepthModeShaderValue","configPipeLineMode","removeDefine","far","farPlane","near","nearPlane","setValue","setTexture","cleanUp","recoverToPool","KeyframeNode","_ownerPath","_propertys","_keyFrames","ownerPathCount","length","propertyCount","keyFramesCount","_setOwnerPathCount","value","_setOwnerPathByIndex","index","_joinOwnerPath","sep","join","_setPropertyCount","_setPropertyByIndex","_joinProperty","_setKeyframeCount","_setKeyframeByIndex","getOwnerPathByIndex","getPropertyByIndex","getKeyframeByIndex","AnimationEvent","Keyframe","cloneTo","destObject","time","clone","dest","defaultWeight","FloatKeyframe","super","inWeight","outWeight","weightedMode","destKeyFrame","inTangent","outTangent","f","QuaternionKeyframe","weightMode","Quaternion","destKeyFarme","Vector3Keyframe","AnimationClipParser03","_DATA","offset","_reader","getUint32","size","count","_BLOCK","getUint16","blockStarts","blockLengths","i","push","prePos","pos","_strings","readUTFString","clip","reader","_animationClip","READ_DATA","READ_BLOCK","READ_STRINGS","n","blockName","fn","Error","call","j","node","startTimeTypes","startTimeTypeCount","getFloat32","name","clipDur","_duration","islooping","getByte","_frameRate","getInt16","nodeCount","nodes","_nodes","nodesMap","_nodesMap","nodesDic","_nodesDic","setNodeByIndex","_indexInList","type","getUint8","pathLength","nodePath","mapArray","propertyOwner","propertyLength","fullPath","keyframeCount","floatKeyframe","floatArrayKeyframe","z","quaArrayKeyframe","inTangentQua","outTangentQua","valueQua","w","eventCount","event","Math","min","eventName","params","paramCount","getInt32","addEvent","Vector2Keyframe","Vector2","Vector4Keyframe","KeyframeNodeOwner","indexInList","referenceCount","updateMark","property","defaultValue","crossFixedValue","isMaterial","saveCrossFixedValue","animatorDataSetCallBack","callBackOwner","callbackFun","apply","callParams","getCallbackNode","callbackFunData","funPropertys","split","AnimationClipParser04","version","_version","propertyChangePath","paramLen","callParms","Float","Position","Scale","RotationEuler","Rotation","quaternionKeyframe","vec2Keyfram","inTangentV2","outTangentV2","valueV2","vec4Keyfram","inTangentV4","outTangentV4","valueV4","isWeight","In","Both","Out","weidhtMode","weightModeV4","inWeightQua","outWeightQua","weightModeV2","inWeightV2","outWeightV2","weightMode_V4","inWeightV4","outWeightV4","HalfFloatUtils","convertToNumber","KeyframeNodeList","getNodeByIndex","TextureGenerator","maxX","maxY","data","sqrRange","atten","floor","xFac","yFac","texture","textureWidth","textureHeight","func","format","TextureFormat","R8G8B8","Alpha8","Uint8Array","setPixelsData","Utils3D","floatTex","Texture2D","R32G32B32A32","filterMode","FilterMode","Point","wrapModeU","WrapMode","Clamp","wrapModeV","anisoLevel","tx","ty","tz","qx","qy","qz","qw","sx","sy","sz","outArray","outOffset","ai0","ai1","ai2","ai3","re","_tempArray16_0","se","_tempArray16_1","tse","_tempArray16_2","x2","y2","z2","xx","yx","yy","zx","zy","zz","wx","wy","wz","v0","cameraDir","cameraUp","out","normalize","_tempV1","cross","_tempV0","scale","add","A","B","C","P","vsub","_tempVector3_0","v1","_tempVector3_1","v2","_tempVector3_2","dot00","dot","dot01","dot02","dot11","dot12","inverDeno","u","v","bones","curData","inverGlobalBindPose","outBonesDatas","outAnimationDatas","boneIndexToMesh","parentOffset","matOffset","boneLength","keyframeWidth","_rotationTransformScaleSkinAnimation","parentIndex","mulMatrixByArray","mulMatrixByArrayAndMatrixFast","bonesDatas","arrayOffset","animationDatas","createAffineTransformationArray","sourceArray","sourceOffset","rotation","ix","iy","iz","iw","leftArray","leftOffset","rightArray","rightOffset","_tempArray16_3","rightMatrix","rightMatrixE","elements","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","ai0LeftOffset","ai1LeftOffset","ai2LeftOffset","ai3LeftOffset","ai0OutOffset","ai1OutOffset","ai2OutOffset","ai3OutOffset","tX","tY","tZ","rX","rY","rZ","rW","sX","sY","sZ","xy","xz","yz","source","transform","result","resultOffset","coordinateX","coordinateY","coordinateZ","transformElem","lightingMapScaleOffset","url","indexOf","substr","trans","rot","outE","left","right","l","r","e","l11","l12","l13","l14","l21","l22","l23","l24","l31","l32","l33","l34","l41","l42","l43","l44","r11","r12","r13","r14","r21","r22","r23","r24","r31","r32","r33","r34","r41","r42","r43","r44","PI","atan","from","location","angle","subtract","TEMPVector30","asin","arcTanAngle","weight","s","pow","abs","sa","sb","saw","sbw","scaleWeight","sng","a","b","Float32Array","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","b10","b11","b12","b13","b14","b15","matrix4x4MultiplyFFF","colorFunc","mipmaps","_generateTexture2D","debugLine","boundBox","color","lineCount","maxLineCount","start","end","max","addLine","rootSprite","checkSprite","path","sprite","parent","_parent","getChildIndex","invPath","getChildAt","pathlength","rendertexture","pixelArray","colorFormat","R16G16B16A16","toString","getData","ori","pixels","bs","LayaEnv","isConch","canv","HTMLCanvas","lock","ctx2d","getContext","imgdata","createImageData","Uint8ClampedArray","putImageData","toDataURL","destroy","_compIdToNode","Object","window","getRTBase64","uint8ArrayToArrayBuffer","AnimationClip","Resource","_animationEvents","Byte","parse","complete","ILaya","loader","load","Loader","ANIMATIONCLIP","duration","_weightModeHermite","nextweightMode","_hermiteInterpolate","frame","nextFrame","t","dur","t0","t1","Number","isFinite","t2","t3","c","d","_hermiteInterpolateVector3","p0","tan0","p1","tan1","_hermiteCurveSplineWeight","_hermiteInterpolateQuaternion","_hermiteInterpolateVector4","_hermiteInterpolateVector2","frameValue","frametime","frameOutWeight","frameOutTangent","nextframeValue","nextframetime","nextframeInweight","nextframeIntangent","Eps","y1","wt1","wt2","dx","dy","yp1","yp2","wt2s","fg","fpg","fppg","_curveInterpolate","_evaluateClipDatasRealTime","playCurTime","realTimeCurrentFrameIndexes","addtive","frontPlay","outDatas","avatarMask","nextFrameIndex","keyFrames","frameIndex","getTransformActive","isEnd","nextFarme","clipData","_evaluateFrameNodeVector3DatasRealTime","firstFrameValue","clipQuat","_evaluateFrameNodeQuaternionDatasRealTime","tempQuat","_tempQuaternion0","firstFrameValueQua","quaternionConjugate","multiply","v2Data","_evaluateFrameNodeVector2DatasRealTime","v2FrameValue","v4Data","_evaluateFrameNodeVector4DatasRealTime","v4FrameValue","frameData","nextKeyFrame","startTime","firstFrameDatas","_binarySearchEventIndex","mid","midValue","splice","_disposeResource","Laya3DRender","StaticFlag","FrustumCorner","volumeIntersectType","AmbientMode","ReflectionProbeMode","RenderBitFlag","ShadowMode","ShadowCascadesMode","LightType","LightMode","FrustumFace","ShadowMapFormat","ShadowLightType","Sprite3D","Node","isStatic","_isRenderNode","_id","_uniqueIDCounter","_is3D","_transform","renderOBJCreate","createTransform","_isStatic","StaticBatch","Normal","layer","WORLDMATRIX","WORLDINVERTFRONT","sprite3DCommandUniformMap","createGlobalUniformMap","addShaderUniform","ShaderDataType","Matrix4x4","original","worldPositionStays","position","destSprite3D","addChild","worldMatrix","then","res","runWith","id","_layer","Event","LAYERCHANGE","staticMask","_scene","_onActive","sprite3DCount","_onInActive","_onAdded","parent3D","_setParent","_onWorldTransform","_onRemoved","onStartListeningToType","startsWith","_setBit","NodeFlags","PROCESS_COLLISIONS","PROCESS_TRIGGERS","_parse","spriteMap","undefined","active","tag","loccalPosition","localPosition","fromArray","rotationEuler","localRotationEuler","localRotation","localScale","_cloneTo","srcRoot","dstRoot","_destroyed","destTrans","scrSprite","_create","children","_children","child","_createSprite3DInstance","dstSprite","srcChildren","dstChildren","_parseSprite3DInstance","dstSprite3D","destroyChild","ILaya3D","Scene3D","Laya3D","ClusterData","pointLightCount","spotLightCount","indices","Cluster","xSlices","ySlices","zSlices","maxLightsPerClusterAverage","_updateMark","_depthSliceParam","_xSlices","_ySlices","_zSlices","clusterTexWidth","clisterTexHeight","ceil","_clusterTexture","_createFloatTextureBuffer","_clusterPixels","clusterDatas","Array","_clusterDatas","_placePointLightToClusters","lightIndex","lightBound","zMin","zEnd","zMax","yMin","yEnd","yMax","xMin","xEnd","xMax","lightCount","_placeSpotLightToClusters","_insertConePlane","origin","forward","radius","halfAngle","pNor","V1","_tempVector36","V2","_tempVector37","tanR","tan","capRimX","capRimY","capRimZ","_shrinkSphereLightZPerspective","lightviewPos","lvZ","minZ","maxZ","depthSliceParam","log2","_shrinkSpotLightZPerspective","viewLightPos","viewConeCap","pbX","pbY","pbZ","rb","paX","paY","paZ","aX","aY","aZ","dotA","eZ","sqrt","_shrinkSphereLightByBoundOrth","halfX","halfY","lvX","minX","lvY","minY","xStride","yStride","_shrinkSpotLightByBoundOrth","eX","eY","_shrinkXYByRadiusPerspective","xPlanes","yPlanes","plane","_shrinkSpotXYByConePerspective","viewForward","normal","_tempVector32","_updatePointLightPerspective","viewMat","pointLight","_tempLightBound","_tempVector30","transformV3ToV3","owner","range","_updateSpotLightPerspective","spotLight","viewPos","_tempVector31","_tempVector34","getForward","spotAngle","viewFor","_tempVector33","_updatePointLightOrth","_updateSpotLightOrth","camNear","lightClusterCount","viewMatrix","curCount","_directionLights","_length","pointLights","_pointLights","poiCount","poiElements","_elements","spotLights","_spotLights","spoCount","spoElements","orthographic","orthographicVerticalSize","aspectRatio","_updateClusterPlaneXY","_clusterXPlanes","_clusterYPlanes","widthFloat","lightOff","clusterPixels","clusterPixelsCount","freeSpace","clusterOff","pCount","sCount","setSubPixelsData","_tempVector35","Plane","_normal","_distance","distance","point0","point1","point2","x1","z1","invPyth","normalEX","normalEY","normalEZ","magnitude","PlaneIntersectionType_Back","PlaneIntersectionType_Front","PlaneIntersectionType_Intersecting","Ray","direction","at","ContainmentType","Disjoint","Contains","Intersects","CollisionUtils","point","box","boxMin","boxMineX","boxMineY","boxMineZ","boxMax","boxMaxeX","boxMaxeY","boxMaxeZ","pointeX","pointeY","pointeZ","box1","box2","delta","box1Mine","box1MineX","box1MineY","box1MineZ","box1Maxe","box1MaxeX","box1MaxeY","box1MaxeZ","box2Mine","box2MineX","box2MineY","box2MineZ","box2Maxe","box2MaxeX","box2MaxeY","box2MaxeZ","sphere","distanceSquared","center","sphere1","sphere2","ray","vertex1","vertex2","vertex3","rayO","rayOeX","rayOeY","rayOeZ","rayD","rayDeX","rayDeY","rayDeZ","v1eX","v1eY","v1eZ","v2eX","v2eY","v2eZ","v3eX","v3eY","v3eZ","_tempV30eX","_tempV30","_tempV30eY","_tempV30eZ","_tempV31eX","_tempV31","_tempV31eY","_tempV31eZ","_tempV32eX","_tempV32","_tempV32eY","_tempV32eZ","determinant","MathUtils3D","isZero","inversedeterminant","_tempV33eX","_tempV33","_tempV33eY","_tempV33eZ","triangleU","_tempV34eX","_tempV34","_tempV34eY","_tempV34eZ","triangleV","raydistance","intersectsRayAndTriangleRD","ZERO","zeroTolerance","ray1","ray2","ray1o","ray1oeX","ray1oeY","ray1oeZ","ray1d","ray1deX","ray1deY","ray1deZ","ray2o","ray2oeX","ray2oeY","ray2oeZ","ray2d","ray2deX","ray2deY","ray2deZ","tempV3","denominator","scalarLength","nearEqual","dets","point1e","point2e","test1","intersectsPlaneAndPoint","test2","test3","planeNor","intersectsRayAndPlaneRD","scaDis","rayoe","rayoeX","rayoeY","rayoeZ","rayde","raydeX","raydeY","raydeZ","boxMine","boxMaxe","tmax","MaxValue","inverse","temp","inverse1","t4","temp1","inverse2","t5","t6","temp2","intersectsRayAndBoxRD","sphereR","discriminant","intersectsRayAndSphereRD","sphereC","closestPointPointTriangle","plane1","plane2","line","plane1nor","plane2nor","planeD","planeNoreX","planeNoreY","planeNoreZ","nearest","radiisum","sphereCeX","sphereCeY","sphereCeZ","sphereContainsPoint","intersectsSphereAndTriangle","_tempV30e","intersectsBoxAndSphere","radiusSquared","scalarLengthSquared","sphere1R","sphere2R","d1","d2","d3","d4","d5","d6","vc","vb","va","w3","denom","w2","_tempV35","_tempV36","planeN","sphere1C","BoundFrustum","matrix","_matrix","initBoundingPlane","m","np","fp","lp","rp","tp","bp","matrixE","nearNorE","farNorE","leftNorE","rightNorE","topNorE","bottomNorE","_near","_far","_left","_right","_top","_bottom","getPlanesFromMatrix","top","bottom","equalsBoundFrustum","other","equalsOtherMatrix","equalsObj","obj","bf","getPlane","p2","p3","p1Nor","p2Nor","p3Nor","getCorners","corners","get3PlaneInterPoint","nearBottomRight","nearTopRight","nearTopLeft","nearBottomLeft","FarBottomRight","FarTopRight","FarTopLeft","FarBottomLeft","containsPoint","planeResult","intersects","nearNormal","leftNormal","rightNormal","bottomNormal","topNormal","farNormal","containsBoundBox","p","containsBoundSphere","intersectsPlaneAndSphere","Viewport","minDepth","maxDepth","project","transformV3ToV4","unprojectFromMat","matrixEleme","unprojectFromWVP","projection","view","world","_tempMatrix4x4","invert","_tempViewport","Picker","viewPort","projectionMatrix","nearSource","nerSourceE","farSource","farSourceE","nearPoint","farPoint","outDire","edge1","edge2","directionCrossEdge2","MIN_VALUE","NaN","inverseDeterminant","distanceVector","rayDistance","distanceCrossEdge1","ddotn","RenderableSprite3D","SHADERDEFINE_RECEIVE_SHADOW","SAHDERDEFINE_LIGHTMAP","SHADERDEFINE_LIGHTMAP_DIRECTIONAL","LIGHTMAPSCALEOFFSET","LIGHTMAP","LIGHTMAP_DIRECTION","PICKCOLOR","REFLECTIONCUBE_PROBEPOSITION","REFLECTIONCUBE_PROBEBOXMAX","REFLECTIONCUBE_PROBEBOXMIN","VOLUMETRICGI_PROBECOUNTS","VOLUMETRICGI_PROBESTEPS","VOLUMETRICGI_PROBESTARTPOS","VOLUMETRICGI_PROBEPARAMS","VOLUMETRICGI_IRRADIANCE","VOLUMETRICGI_DISTANCE","AMBIENTCOLOR","AMBIENTSH","AMBIENTINTENSITY","REFLECTIONINTENSITY","IBLTEX","IBLROUGHNESSLEVEL","commandUniform","SHADERDEFINE_MORPHTARGET","SHADERDEFINE_MORPHTARGET_POSITION","SHADERDEFINE_MORPHTARGET_NORMAL","SHADERDEFINE_MORPHTARGET_TANGENT","MorphTex","MorphParams","MorphAttriOffset","MorphActiceTargets","MorphActiveWeights","MorphActiveCount","Buffer","Int","REFLECTIONTEXTURE","REFLECTIONCUBE_HDR_PARAMS","TextureCube","AMBIENTSHAR","AMBIENTSHAG","AMBIENTSHAB","AMBIENTSHBR","AMBIENTSHBG","AMBIENTSHBB","AMBIENTSHC","_onActiveInScene","_addToInitStaticBatchManager","_setBelongScene","_setUnBelongScene","Lightmap","ApplyLightmapEvent","MeshSprite3DShaderDeclaration","Bounds","_imp","createBounds","getMax","getMin","setMin","setMax","setCenter","getCenter","setExtent","getExtent","_getUpdateFlag","_setUpdateFlag","_getCenter","_getExtent","_getMin","extent","_getMax","_rotateExtents","extents","extentsX","extentsY","extentsZ","matE","_tranform","getBoundBox","_getBoundBox","calculateBoundsintersection","bounds","_UPDATE_MIN","_UPDATE_MAX","_UPDATE_CENTER","_UPDATE_EXTENT","Volume","Component","_aroundVolumeCacheNum","_bounds","_primitiveBounds","_importance","runInEditor","_type","boundsMax","_reCaculateBoundBox","boundsMin","probePosition","importance","_onEnable","on","TRANSFORM_CHANGED","_VolumeChange","_volumeManager","_onDisable","off","remove","_needUpdateAllRender","ReflectionProbeManager","_reflectionProbes","SingletonList","_sceneReflectionProbe","ReflectionProbe","boxProjection","_isScene","sceneReflectionProbe","_updateRenderObject","baseRender","mainProbe","overlop","maxOverlap","renderBounds","renflectProbe","probReflection","volume","handleMotionlist","motionObjects","_surportReflectionProbe","_reflectionMode","reCaculateAllRenderObjects","baseRenders","Sprite3DRenderDeclaration","VolumetricGIManager","_GIVolumes","removeVolumetricGI","renderer","SHADERDEFINE_VOLUMETRICGI","currentVolume","overlap","volumes","applyVolumetricGI","renders","VolumeManager","_motionObjects","_volumeList","_regVolumeManager","_reflectionProbeManager","ReflectionProbeVolumeType","_volumetricGIManager","VolumetricGIType","reflectionProbeManager","volumetricGIManager","reManager","addMotionObject","renderObj","removeMotionObject","mainVolume","containPoint","clearMotionObjects","needreCaculateAllRenderObjects","SphericalHarmonicsL2","_coefficients","getCoefficient","setCoefficient","coefficient","setCoefficients","coefficient0","coefficient1","coefficient2","coefficient3","coefficient4","coefficient5","coefficient6","coefficient7","coefficient8","coes","destCoes","_default","SphericalHarmonicsL2Generater","atan2","face","out_dir","TextureCubeFace","PositiveX","NegativeX","PositiveY","NegativeY","PositiveZ","NegativeZ","M_PI","cubemapPixels","pixelComponentSize","cubemapSize","isGamma","shr","_tempSHR","fill","shg","_tempSHG","shb","_tempSHB","dir","facePixels","x0","y0","da","surfaceArea","uv2Dir","pixelOffset","g","gammaToLinearSpace","SH_Count","sh_val","sh_eval_9","sh","k","skyColor","equatorColor","groundColor","console","skyPixels","_tempSkyPixels","equatorPixels","_tempEquatorPixels","groundPixels","_tempGroundPixels","fillPixelBuffer","float32","fillColor","toLinear","gradientPixles","CalCubemapSH","GradientSimulateSize","timeEnd","_boxProjection","_ambientColor","_ambientMode","SolidColor","_reflectionHDRParams","_reflectionDecodeFormat","TextureDecodeFormat","_ambientSkyColor","_ambientEquatorColor","_ambientGroundColor","_ambientIntensity","_reflectionIntensity","ambientIntensity","reflectionIntensity","ambientColor","ambientMode","ambientSH","_ambientSH","SphericalHarmonics","_ambientSphericalHarmonics","_applySHCoefficients","TripleColor","_ambientTripleColorSphericalHarmonics","iblTex","_iblTex","_removeReference","_addReference","iblTexRGBD","_iblTexRGBD","applyReflectionShaderData","shaderData","SHADERDEFINE_SPECCUBE_BOX_PROJECTION","setShaderData","SHADERDEFINE_GI_LEGACYIBL","SHADERDEFINE_GI_IBL","setColor","setNumber","maxMipmapLevel","SHADERDEFINE_IBL_RGBD","setBuffer","_reflectionTexture","reflectionTexture","blackTexture","reflectionHDRParams","_shCoefficients","_onDestroy","customReflection","reflectionDecodingFormat","RGBM","ambientSphericalHarmonics","originalSH","intensity","optSH","shaderSHA","shaderSHB","setGradientAmbient","gradientSH","CalGradientSH","TEMPVECTOR3","defaultTextureHDRDecodeValues","BaseRender","_lightmapScaleOffset","_commonUniformMap","_sharedMaterials","_supportOctree","_sceneUpdateMark","_probeReflectionUpdateMark","simple","_updateRenderType","_motionIndexList","_ratioIgnor","_LOD","_getcommonUniformMap","_rendernode","_createBaseRenderNode","renderId","_renderElements","_enabled","_materialsInstance","createShaderData","lightmapIndex","receiveShadow","sortingFudge","_customCull","_needRender","prototype","boundsChange","renderbitFlag","_worldParams","shaderValueInit","mesh","_subMeshes","vertexElements","getSubMesh","_vertexBuffer","_vertexDeclaration","_vertexElements","_elementUsage","VertexMesh","MESH_COLOR0","SHADERDEFINE_COLOR","MESH_TEXTURECOORDINATE0","SHADERDEFINE_UV0","MESH_TEXTURECOORDINATE1","SHADERDEFINE_UV1","MESH_TANGENT0","SHADERDEFINE_TANGENT","oldMesh","defineDatas","lastValue","getMeshDefine","_meshVerticeDefine","ratioIgnor","shadowCullPass","castShadow","renderNode","distanceForSort","_distanceForSort","geometryBounds","_baseGeometryBounds","_lightmapIndex","_applyLightMapParams","lightmapScaleOffset","_setShaderValue","material","insMat","_getInstanceMaterial","renderElement","sharedMaterial","_isSupportReflection","materials","slice","sharedMaterials","_changeMaterialReference","materialsInstance","sharedMats","lastMat","mat","_calculateBoundingBox","_receiveShadow","reflectionMode","_volume","_addRenderNode","_motionInVolume","_removeRenderNode","voluemProbe","_probReflection","createBaseRenderNode","_changeLayer","_changeStaticMask","staticmask","setRenderbitFlag","RenderBitFlag_Editor","_getBit","HIDE_BY_EDITOR","_onWorldMatNeedChange","_addRenderObject","_removeRenderObject","pre","_shader","_supportReflectionProbe","_addReflectionProbeUpdate","flag","_subUniformBufferData","_needUpdate","_batchRender","_updateOneRender","pass","shaderdataType","lightMaps","lightmaps","lightMap","lightmapColor","lightmapDirection","_applyReflection","_batchOneRender","batch","_removeOneRender","boundFrustum","_CullOut","_renderUpdate","_renderUpdateWithCamera","_sceneRenderManager","sceneRenderableManager","removeRenderObject","destroyed","_transLargeUbO","recover","_tempBoundBoxCorners","_defaultLightmapScaleOffset","RenderElement","_canBatch","_subShaderIndex","renderType","RENDERTYPE_NORMAL","_createRenderElementOBJ","_renderElementOBJ","_material","_materialShaderData","renderSubShader","_subShader","subShaderIndex","_baseRender","_renderShaderData","createRenderElement","getInvertFront","_isFrontFaceInvert","setTransform","setGeometry","geometry","_geometry","_geometryElementOBj","compileShader","passes","_passes","_clearShaderInstance","_pipelineMode","comDef","_compileDefine","sceneShaderData","_defineDatas","_configDefineValues","addDefineDatas","configShaderData","cameraShaderData","nodeCommonMap","shaderIns","withCompile","_addShaderInstance","_convertSubShader","customShader","replacementTag","subshaderIndex","subShader","getSubShaderAt","oriTag","getFlag","customSubShaders","_subShaders","customSubShader","_update","_getRenderQueue","_isTransparent","addRenderElement","_renderUpdatePre","sceneMark","Camera","subUbo","updateSubData","_isRender","_prepareRender","_updateRenderParams","_contextOBJ","_invertFront","_render","_destroy","RENDERTYPE_STATICBATCH","RENDERTYPE_INSTANCEBATCH","RENDERTYPE_VERTEXBATCH","DefineDatas","GeometryElement","mode","drawType","createRenderGeometry","bufferState","setDrawArrayParams","first","setDrawElemenParams","instanceCount","indexFormat","_getType","state","clearRenderParams","_typeCounter","SkyBox","MeshTopology","Triangles","DrawType","DrawElement","vertices","verDec","getVertexDeclaration","vertexBuffer","createVertexBuffer3D","vertexStride","Static","vertexDeclaration","indexBuffer","createIndexBuffer3D","IndexFormat","UInt8","setData","BufferState","applyState","instance","VertexPositionTexture0","textureCoordinate0","_position","_textureCoordinate0","VertexDeclaration","VertexElement","VertexElementFormat","MESH_POSITION0","SkyDome","stacks","slices","_stacks","_slices","vertexFloatCount","numberVertices","numberIndices","Uint16Array","stackAngle","sliceAngle","vertexIndex","vertexCount","indexCount","stack","sin","cos","_radius","UInt16","buffer","SkyRenderer","_renderElement","_renderData","SUNLIGHTDIRECTION","SUNLIGHTDIRCOLOR","_mesh","meshType","_isAvailable","_tempMatrix1","_sunColor","setVector3","_sundir","_tempMatrix0","setTranslationVector","createOrthoOffCenter","yScale","fieldOfView","epsilon","isWebXR","_applyViewProject","applyContext","drawRenderElement","BaseCamera","_skyRenderer","_forward","_up","_linearClearColor","clearColor","_fieldOfView","_useUserProjectionMatrix","_orthographicVerticalSize","renderingOrder","_nearPlane","_farPlane","cullingMask","useOcclusionCulling","_renderEngine","_orthographic","_cameraUniformUBO","UBONAME_CAMERA","_cameraUniformData","createCameraUniformBlock","_addCheckUBO","setUniformBuffer","CAMERAUNIFORMBLOCK","SHADERDEFINE_DEPTH","SHADERDEFINE_DEPTHNORMALS","SHADERDEFINE_ORTHOGRAPHIC","SHADERDEFINE_FXAA","camerauniformMap","cameraUniformMap","CAMERAPOS","VIEWMATRIX","VIEWPROJECTMATRIX","PROJECTMATRIX","CAMERADIRECTION","CAMERAUP","VIEWPORT","PROJECTION_PARAMS","OPAQUETEXTURE","OPAQUETEXTUREPARAMS","addShaderBlockUniform","propertyName","uniformtype","CameraUBOData","uniformPara","uniformMap","forEach","key","_clearColor","skyRenderer","_calculateProjectionMatrix","_caculateMaxLocalYRange","maxlocalYDistance","_yrange","vaule","_cullingMask","_renderingOrder","_sortCamerasByRenderingOrder","halffield","dist","_onScreenSizeChanged","displayedInStage","cameraPool","_cameraPool","tempCamera","_prepareCameraToRender","getUp","shader","addLayer","removeLayer","addAllLayers","removeAllLayers","resetProjectionMatrix","_addCamera","_removeCamera","skyboxMaterial","getRes","stage","RESIZE","RENDERINGTYPE_SHADERDEFINE_FXAA","RENDERINGTYPE_DEFERREDLIGHTING","RENDERINGTYPE_FORWARDRENDERING","_invertYScaleMatrix","_invertYProjectionMatrix","_invertYProjectionViewMatrix","_tempMatrix4x40","Light","_shadowMode","_isAlternate","_shadowResolution","_shadowDistance","_shadowDepthBias","_shadowNormalBias","_shadowNearPlane","_shadowStrength","_lightWoldMatrix","_intensity","_intensityColor","_lightmapBakedType","realTime","shadowMode","shadowDistance","shadowResolution","shadowDepthBias","shadowNormalBias","shadowStrength","shadowNearPlane","lightmapBakedType","premode","bakeOnly","_removeFromScene","_addToScene","lightWorldMatrix","quaterian","createAffineTransformation","ONE","lightType","_lightType","colorData","light","maxLightCount","_lightCount","_addToLightQueue","_alternateLights","warn","_removeFromLightQueue","alternateLight","shift","ShadowUtils","_adjustNearPlane","_adjustFarPlane","getCapable","RenderCapable","RenderTextureFormat_Depth","witdh","shadowFormat","depthFormat","DEPTH_16","bit16","bit24_8","DEPTHSTENCIL_24_8","bit32","DEPTH_32","shadowMap","compareMode","TextureCompareMode","LESS","Bilinear","shadowProjectionMatrix","frustumSize","Directional","Spot","Deg2Rad","texelSize","depthBias","normalBias","SoftHigh","kernelRadius","cameraViewProjectMatrix","frustumPlanes","Near","Far","Left","Right","Top","Bottom","twoSplitRatio","fourSplitRatio","cameraNear","shadowFar","fov","cascadesMode","tFov","NoCascades","getFarWithRadius","TwoCascades","FourCascades","shadowSliceData","atlasWidth","atlasHeight","cascadeIndex","outShadowMatrices","sliceE","oneOverAtlasWidth","oneOverAtlasHeight","resolution","_mulMatrixArray","cameraFrustumPlanes","splitDistance","frustumCorners","_frustumCorners","backPlaneFaces","_backPlaneFaces","planeNeighbors","_frustumPlaneNeighbors","twoPlaneCorners","_frustumTwoPlaneCorners","edgePlanePoint2","_edgePlanePoint2","cullPlanes","splitNearDistance","splitNear","splitFar","sphereCenterZ","splitBoundSphere","backIndex","edgeIndex","backFace","neighborFaces","neighborFace","notBackFace","createPlaneBy3P","cullPlaneCount","cameraPos","outBoundSphere","centerZ","k2","farSNear","farANear","tileCount","currentTileCount","lightUp","lightSide","lightForward","shadowMatrices","boundSphere","halfShadowResolution","borderRadius","atlasBorderSize","borderDiam","sizeUnit","radiusUnit","upLen","sideLen","forwardLen","projectMatrix","viewProjectMatrix","createLookAt","_shadowMapScaleOffsetMatrix","shadowSpotData","shadowParams","shadowSpotMatrices","shadowMapSize","spotWorldMatrix","cameraCullInfo","createPerspective","shadowMapWidth","shadowMapHeight","shadowSliceDatas","cascadeCount","splitBoundSpheres","matrixFloatCount","sphereFloatCount","unknown","RenderContext3D","createRenderContext3D","_instance","GammaCorrect","invertY","cameraShaderValue","sceneID","tempVec4","cameraUpdateMark","renderelemt","replaceTag","ScreenQuad","TriangleStrip","DrawArray","_bufferState","_bufferStateInvertUV","_vertices","_vertexBufferInvertUV","_verticesInvertUV","SCREENQUAD_POSITION_UV","Command","_commandBuffer","_screenShaderData","_screenShader","find","SCREENTEXTURE_ID","SCREENTEXTURE_NAME","SCREENTEXTUREOFFSETSCALE_ID","SCREENTEXTUREOFFSETSCALE_NAME","MAINTEXTURE_TEXELSIZE_ID","MAINTEXTURE_TEXELSIZE_NAME","run","setContext","_context","BlitScreenQuadCMD","_source","_dest","_offsetScale","_shaderData","_sourceTexelSize","_transform3D","offsetScale","screenType","_SCREENTYPE_QUAD","commandbuffer","cmd","_pool","pop","setshader","_internalRenderTexture","vpH","vpY","clientHeight","_defaultOffsetScale","blitDrawCall","_SCREENTYPE_TRIANGLE","SetRenderTargetCMD","_renderTexture","renderTexture","currentActive","SetShaderDataCMD","_nameID","_value","_dataType","nameID","shaderDataType","commandBuffer","setInt","Bool","setBool","setMatrix4x4","setVector2","ShaderDataType_define","defineData","BlinnPhongMaterial","Material","setShaderName","renderMode","RENDERMODE_OPAQUE","SHADERDEFINE_DIFFUSEMAP","SHADERDEFINE_NORMALMAP","SHADERDEFINE_SPECULARMAP","SHADERDEFINE_ENABLEVERTEXCOLOR","SHADERDEFINE_ENABLETRANSMISSION","SHADERDEFINE_THICKNESSMAP","ALBEDOTEXTURE","NORMALTEXTURE","SPECULARTEXTURE","ALBEDOCOLOR","MATERIALSPECULAR","SHININESS","TILINGOFFSET","TRANSMISSIONRATE","IBACKDIFFUSE","IBACKSCALE","THINKNESSTEXTURE","TRANSMISSIONCOLOR","AlbedoIntensity","alphaTest","RENDERQUEUE_OPAQUE","depthWrite","cull","RenderState","CULL_BACK","blend","BLEND_DISABLE","depthTest","DEPTHTEST_LESS","RENDERMODE_CUTOUT","RENDERQUEUE_ALPHATEST","RENDERMODE_TRANSPARENT","RENDERQUEUE_TRANSPARENT","BLEND_ENABLE_ALL","blendSrc","BLENDPARAM_SRC_ALPHA","blendDst","BLENDPARAM_ONE_MINUS_SRC_ALPHA","enableVertexColor","hasDefine","tilingOffset","getVector4ByIndex","setVector4ByIndex","albedoColor","getColorByIndex","setColorByIndex","albedoIntensity","getFloatByIndex","setFloatByIndex","specularColor","shininess","albedoTexture","getTextureByIndex","setTextureByIndex","normalTexture","specularTexture","enableTransmission","transmissionRata","backDiffuse","backScale","thinknessTexture","transmissionColor","transmissionRate","destMaterial","MeshFilter","getComponent","MeshRenderer","_onMeshChange","_sharedMesh","sharedMesh","SubMeshRenderElement","_dynamicWorldPositionNormalNeedUpdate","_onWorldMatrixChanged","staticBatch","instanceSubMesh","staticBatchElementList","instanceBatchElementList","vertexBatchElementList","vertexBatchVertexDeclaration","MeshUtil","element","elementUsage","_revertStaticBatchDefineUV1","morphTargetActiveCount","_morphWeightChange","_morphTargetValues","_projectionViewWorldMatrix","SHADERDEFINE_GPU_INSTANCE","_createRenderElement","getMesh","filter","_getMeshDefine","_changeVertexDefine","morphTargetValues","_changeMorphTargetValue","setMorphChannelWeight","channelName","morphTargetData","channel","getMorphChannel","_applyMorphdata","morphData","channelCount","channelIndex","getMorphChannelbyIndex","lastFullWeight","targets","target","fullWeight","morphTargetWeight","_index","activeIndex","morphTargetActiveIndex","morphTargetActiveWeight","maxMorphTargetCount","Texture3D","_changeMorphData","maxCount","vertexDec","MESH_NORMAL0","attributeOffset","targetTexture","morphtargetChannels","targetCount","subMeshCount","defaultMaterial","updateMulPassRender","subCount","matCount","worldMat","getFrontFaceValue","_revertBatchRenderUpdate","DrawMeshCMD","_meshRender","subMeshIndex","_subMeshIndex","_renderElemnts","sceneReflectionProb","submeshs","ClearRenderTextureCMD","_clearDepth","_backgroundColor","_linearbackgroundColor","_depth","clearDepth","backgroundColor","depth","linearBgColor","DrawRenderCMD","_elementRender","renderElements","renderelement","SetGlobalShaderDataCMD","globalShaderData","MeshInstanceGeometry","subMesh","DrawElementInstance","_subMesh","_indexStart","DrawMeshInstancedCMD","_instanceRenderElementArray","_instanceGeometryArray","_instanceWorldMatrixData","maxInstanceCount","_instanceWorldMatrixBuffer","instanceWorldMatrixDeclaration","instanceBuffer","matrixs","instanceProperty","drawnums","_matrixs","_instanceProperty","_drawnums","_updateWorldMatrixBuffer","_setInstanceBuffer","changeVertexDefine","_instanceBufferState","instanceBufferState","vertexArray","_vertexBuffers","propertyMap","_propertyMap","_indexBuffer","worldMatrixData","worldBuffer","orphanStorage","setWorldMatrix","worldMatrixArray","setDrawNums","drawNums","updateVertexBufferData","CommandBuffer","shadowCaster","_shadow","_commands","_name","casterShadow","_apply","cmdDrawCall","_applyOne","getCommandsSize","setShaderDataTexture","setGlobalTexture","setShaderDataColor","setGlobalColor","setShaderDataVector","setGlobalVector","setShaderDataVector3","setGlobalVector3","setShaderDataVector2","setGlobalVector2","setShaderDataNumber","setGlobalNumber","setShaderDataInt","setGlobalInt","setShaderDataMatrix","setShaderDefine","define","setGlobalMatrix","blitScreenQuad","blitScreenQuadByMaterial","blitScreenTriangle","setRenderTarget","clearRenderTarget","drawMesh","submeshIndex","drawRender","drawMeshInstance","DrawElement_Instance","drawMeshInstancedCMD","addCustomCMD","command","clear","PhysicsSettings","flags","maxSubSteps","fixedTimeStep","LightQueue","getBrightestLight","maxIntIndex","maxIntensity","normalLightOrdering","brightestIndex","firstLight","AlternateLightQueue","Scene3DShaderDeclaration","BoundSphere","_center","toDefault","points","upperEnd","_tempVector3","outCenter","createFromSubPoints","intersectsRayDistance","intersectsRayPoint","outPoint","intersectsRayAndSphereRP","ShadowSliceData","ShadowSpotData","createCameraCullInfo","FrustumCulling","_cameraCullInfo","_shadowCullInfo","createShadowCullInfo","cullInfo","nn","ShadowCasterPass","_shadowBias","_shadowParams","_shadowMapSize","_shadowSpotMapSize","_shadowMatrices","_shadowSpotMatrices","_splitBoundSpheres","_maxCascades","_cascadeCount","_shadowMapWidth","_shadowMapHeight","_shadowSliceDatas","_shadowSpotData","_lightUp","_lightSide","_lightForward","_castDepthBufferData","_castDepthBufferOBJ","_castDepthCameraBufferData","_castDepthCameraBufferOBJ","_frustumPlanes","SHADOW_LIGHT_DIRECTION","SHADOW_SPLIT_SPHERES","SHADOW_MATRICES","SHADOW_MAP_SIZE","SHADOW_MAP","SHADOW_PARAMS","SHADOW_SPOTMAP_SIZE","SHADOW_SPOTMAP","SHADOW_SPOTMATRICES","sceneUniformMap","_setupShadowCasterShaderValues","LightParam","shadowparams","shadowBias","cameraSV","projectionViewMatrix","_setupShadowReceiverShaderValues","_light","shadowCascadesMode","SHADERDEFINE_SHADOW_CASCADE","Hard","SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW","SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH","SoftLow","_shadowDirectLightMap","_setupSpotShadowReceiverShaderValues","SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH","SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW","_shadowSpotLightMap","DirectionLight","lightWorldE","lightWorld","createFromQuaternion","cascadesCount","shadowTileResolution","atlasResolution","_shadowCascadesMode","getMaxTileResolutionInAtlas","_cascadesSplitDistance","boundSpheres","getCascadesSplitDistance","_shadowTwoCascadeSplits","_shadowFourCascadeSplits","getCameraFrustumPlanes","sliceData","getBoundSphereByFrustum","getDirectionLightShadowCullPlanes","getDirectionalLightMatrices","applySliceTransform","prepareShadowReceiverShaderValues","SpotLight","getSpotLightShadowData","PointLight","getTemporaryShadowTexture","getShadowBias","shadowCullInfo","cullSphere","_directLightShadowCull","_tempVector4","_applyCasterPassCommandBuffer","spotlight","_sportLightShadowCull","BlitFrameBufferCMD","_texture_size","shaderdata","vph","SceneRenderManager","_sceneManagerOBJ","createSceneRenderManager","list","addRenderObject","object","updateMotionObjects","UI3DManager","_UI3Dlist","_submitRT","rayCast","rayOri","clean","sort","_getCameraDistance","hit","_checkUIPos","destory","BVHSpatialManager","cellCount","bvhManager","updateBVHBoxList","BVHSpatialConfig","max_SpatialCount","limit_size","Min_BVH_Build_Nums","BVHSpatialBox","bvhmanager","config","MAX_VALUE","_cellList","_cellCount","_bvhmanager","_config","_tempV3","_tempV3_2","_isRepeat","cell","_addOneCell","_removeOneCell","delete","_clearList","_isFloatMax","_isBoundsContainedBySpatialBox","cellMin","cellMax","_addBounds","_boundchanged","_removeBounds","getList","getchild0","_children0","getchild1","_children1","fillCell","fillRemove","addCell","removeCell","splitBox","isContentBox","_creatChildNode","merge","getNearlist","checkPos","traverseBoundsCell","conditionalFun","getItemByCameraCullInfo","frustum","getItemByFrustum","getItemBySCI","sci","sciContainsBox","sciIntersectsBox","recaculateBox","error","isRoot","BVHSpatial","bvhConfig","_isBuild","_BVHConfig","_BVHManager","_BVHSpatialBox","bvhSpatialBox","cellLegal","extend","addOne","spatial","removeOne","has","get","motionOne","rebuild","BVHRenderBox","frustumCulling","cullMask","cullingRenderBounds","BVHRenderSpatial","BVHSceneRenderManager","_bvhRenderSpatial","_allRenderList","bvhSpatial","otherList","CullPassBase","_cullList","cullList","bound","exten","dis","cullByCameraCullInfo","renderManager","cullByShadowCullInfo","renderList","cullingSpotShadow","BVHCullPass","PostProcessRenderContext","indirectTarget","destination","compositeShaderData","deferredReleaseTextures","createRTByContextReleaseTexture","mipmap","multiSamples","sRGB","rt","depthStencilFormat","_generateMipmap","generateDepthTexture","_gammaSpace","_inPool","PostProcessEffect","_active","_singleton","singleton","getCameraDepthTextureModeFlag","effectInit","postprocess","release","ToneMappingType","PBRRenderQuality","BlitScreenVS","ColorGradEffect","_needBuildLUT","_lutBuilderMat","_lutSize","_enableSplitTone","_splitShadow","_splitBalance","_splithighlights","_u_SplitShadow","_enableSMH","_shadows","_midtones","_highlights","_limits","_enableLiftGammaGain","_lift","_gamma","_gain","_enableBalance","_balance","_tint","_temperature","_enableColorAdjust","_postExposure","_contrast","_colorFilter","_HueShift","_saturation","_HueSatCon","default_balance","default_splitShadow","default_splithighlights","default_shadow","default_midtones","default_highlight","default_limint","default_lift","default_gamma","default_gain","default_ColorFilter","default_HueSatCon","_toneMapping","_blitlutParams","_lutShaderData","lutSize","_lutCommond","__initDefine__","attributeMap","a_PositionTexcoord","u_OffsetScale","u_MainTex","u_MainTex_TexelSize","SubShader","addSubShader","addShaderPass","BlitVS","renderState","DEPTHTEST_ALWAYS","CULL_NONE","SHADERDEFINE_ACES","SHADERDEFINE_CUSTOMLUT","SHADERVALUE_LUT","SHADERVALUE_LUTPARAMS","SHADERVALUE_CUSTOMLUT","SHADERVALUE_CUSTOMLUTPARAMS","toneMapping","enableSplitTone","splitShadow","splithighlights","equal","splitBalance","enableSMH","shadows","midtones","highlights","shadowLimitStart","shadowLimitEnd","highLightLimitStart","highLightLimitEnd","enableLiftGammaGain","lift","gamma","gain","_StandardIlluminantY","_CIExyToLMS","X","Z","L","M","S","_ColorBalanceToLMSCoeffs","temperature","tint","w1","enableBalance","enableColorAdjust","postExposure","contrast","colorFilter","HueShift","saturation","_lutTex","_buildLUT","lutHeight","lutWidth","lutParams","setVector4","ACES","whiteTexture","_LUTShader","_enableColorGrad","_ColorGradEffect","PostProcess","_compositeShader","_compositeShaderData","_effects","_enable","_depthtextureFlag","SHADERDEFINE_BLOOM_LOW","SHADERDEFINE_BLOOM","SHADERDEFINE_FINALPASS","SHADERVALUE_MAINTEX","SHADERVALUE_BLOOMTEX","SHADERVALUE_AUTOEXPOSURETEX","SHADERVALUE_BLOOM_DIRTTEX","SHADERVALUE_BLOOMTEX_TEXELSIZE","SHADERVALUE_BLOOM_DIRTTILEOFFSET","SHADERVALUE_BLOOM_SETTINGS","SHADERVALUE_BLOOM_COLOR","recaculateCameraFlag","effects","enable","commandContext","oriContext","clearEffect","addEffect","cameraDepthTextureMode","_init","cameraTarget","screenTexture","_getRenderTextureFormat","Indirect","clearDefine","offScreenTex","_offScreenRenderTexture","canvasWidth","_getCanvasWidth","canvasHeight","_getCanvasHeight","_screenOffsetScale","tempRenderTextures","effect","getEffect","classReg","removeEffect","_applyPostProcessCommandBuffers","PBRDefaultDFG","defaultDFG","_defaultDFG","tex","hdrBuffer","Base64Tool","decode","hdrInfo","HDRTextureInfo","getHDRInfo","supportFloatTex","TextureFormat_R32G32B32A32","supportFloatLinearFiltering","Texture_FloatLinearFiltering","setHDRData","pixelCount","hdrPixelData","readScanLine","rgbdPixelData","maxRGB","PBRShaderLib","DEFINE_EMISSION","DEFINE_CLEARCOAT","DEFINE_CLEARCOAT_NORMAL","DEFINE_ANISOTROPY","DEFINE_IOR","DEFINE_IRIDESCENCE","DEFINE_SHEEN","DEFINE_TRANSMISSION","DEFINE_THICKNESS","addInclude","DefaultDfgTexture","regIncludeBindUnifrom","u_IBLDFG","PBRRenderMode","PBRMetallicSmoothnessSource","ParticleSystemShapeType","TrailAlignment","EPhysicsCapable","PBRMaterial","EMISSIONCOLOR","SMOOTHNESS","OCCLUSIONSTRENGTH","NORMALSCALE","PARALLAXSCALE","ALPHATESTVALUE","Opaque","SHADERDEFINE_ALBEDOTEXTURE","SHADERDEFINE_NORMALTEXTURE","SHADERDEFINE_PARALLAXTEXTURE","SHADERDEFINE_OCCLUSIONTEXTURE","SHADERDEFINE_EMISSIONTEXTURE","SHADERDEFINE_TRANSPARENTBLEND","SHADERDEFINE_LAYA_PBR_BRDF_HIGH","SHADERDEFINE_LAYA_PBR_BRDF_LOW","SHADERDEFINE_DETAILALBEDO","SHADERDEFINE_DETAILNORMAL","OCCLUSIONTEXTURE","PARALLAXTEXTURE","EMISSIONTEXTURE","EMISSIONIntensity","DETAILALBEDOTEXTURE","DETAILNORMALTEXTURE","DETAILTILLINGOFFSET","DETAILNORMALSCALE","CLEARCOAT","SHADERDEFINE_CLEARCOATTEXTURE","CLEARCOATTEXTURE","CLEARCOATROUGHNESS","SHADERDEFINE_CLEARCOATROUGHNESSTEXTURE","CLEARCOATROUGHNESSTEXTURE","CLEARCOATNORMALTEXTURE","ANISOTROPY","SHADERDEFINE_ANISOTROPYTEXTURE","ANISOTROPYTEXTURE","ANISOTROPYROTATION","getColor","getTexture","normalTextureScale","getNumber","parallaxTexture","parallaxTextureScale","occlusionTexture","occlusionTextureStrength","smoothness","enableEmission","emissionColor","emissionIntensity","emissionTexture","getVector","detailAlbedoTexture","detailNormalTexture","detailTilingOffset","detailNormalScale","Cutout","Fade","Transparent","BLENDPARAM_ONE","anisotropyEnable","anisotropy","anisotropyTexture","anisotropyRotation","clearCoatEnable","clearCoat","clearCoatTexture","clearCoatRoughness","clearCoatRoughnessTexture","clearCoatNormalTexture","smoothnessTextureScale","renderQuality","High","PBRStandardMaterial","_smoothnessSource","SHADERDEFINE_METALLICGLOSSTEXTURE","SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA","METALLICGLOSSTEXTURE","METALLIC","metallicGlossTexture","metallic","smoothnessSource","SkyBoxMaterial","TINTCOLOR","EXPOSURE","ROTATION","TEXTURECUBE","tintColor","exposure","textureCube","SkyProceduralMaterial","sunDisk","SUN_HIGH_QUALITY","sunSize","sunSizeConvergence","atmosphereThickness","skyTint","groundTint","SHADERDEFINE_SUN_HIGH_QUALITY","SHADERDEFINE_SUN_SIMPLE","SUNSIZE","SUNSIZECONVERGENCE","ATMOSPHERETHICKNESS","SKYTINT","GROUNDTINT","_sunDisk","SUN_SIMPLE","SUN_NODE","UnlitMaterial","_albedoIntensity","RENDERMODE_ADDTIVE","MeshSprite3D","_meshFilter","addComponent","meshFilter","meshRenderer","lightmapScaleOffsetArray","meshPath","enableRender","receiveShadows","materialCount","GradientMode","Blend","Fixed","Gradient","maxColorRGBKeyCount","maxColorAlphaKeyCount","_mode","_maxColorRGBKeysCount","_maxColorAlphaKeysCount","_colorRGBKeysCount","_colorAlphaKeysCount","_keyRanges","_alphaElements","_rgbElements","__alphaElements","__rgbElements","rgbElements","alphaElements","colorRGBKeysCount","colorAlphaKeysCount","maxColorRGBKeysCount","maxColorAlphaKeysCount","addColorRGB","addColorAlpha","updateColorRGB","updateColorAlpha","evaluateColorRGB","lerpFactor","startSearchIndex","reverseSearch","curIndex","diff","evaluateColorAlpha","outColor","destGradientDataColor","destAlphaElements","destRGBElements","Burst","minCount","_time","_minCount","_maxCount","destBurst","GradientColor","_constant","_constantMin","_constantMax","_gradient","_gradientMin","_gradientMax","constant","gradientColor","gradient","minConstant","maxConstant","minGradient","maxGradient","constantMin","constantMax","gradientMin","gradientMax","destGradientColor","ColorOverLifetime","_color","destColorOverLifetime","destColor","createByConstant","createByGradient","createByRandomTwoConstant","createByRandomTwoGradient","FrameOverTime","_overTime","_overTimeMin","_overTimeMax","rotationOverLifetime","overTime","gradientFrameMin","gradientFrameMax","frameOverTimeData","frameOverTimeDataMin","frameOverTimeDataMax","destFrameOverTime","GradientAngularVelocity","_separateAxes","_constantSeparate","_gradientX","_gradientY","_gradientZ","_gradientW","_constantMinSeparate","_constantMaxSeparate","_gradientXMin","_gradientXMax","_gradientYMin","_gradientYMax","_gradientZMin","_gradientZMax","_gradientWMin","_gradientWMax","gradientAngularVelocity","separateConstant","gradientX","gradientY","gradientZ","separateConstantMin","separateConstantMax","gradientXMin","gradientXMax","gradientYMin","gradientYMax","gradientZMin","gradientZMax","gradientWMin","gradientWMax","separateAxes","constantSeparate","gradientW","constantMinSeparate","constantMaxSeparate","destGradientAngularVelocity","GradientDataInt","_currentLength","gradientCount","log","destGradientDataInt","destElements","GradientDataNumber","getKeyByIndex","getValueByIndex","getAverageValue","total","subValue","destGradientDataNumber","GradientSize","gradientSize","getMaxSizeInGradient","meshMode","maxSize","destGradientSize","GradientVelocity","gradientVelocity","destGradientVelocity","RotationOverLifetime","angularVelocity","_angularVelocity","destRotationOverLifetime","destAngularVelocity","createByConstantSeparate","createByGradientSeparate","createByRandomTwoConstantSeparate","createByRandomTwoGradientSeparate","BoundBox","matElements","setCenterAndExtent","tranform","transformCoordinate","BaseShape","randomDirection","_getShapeBoundBox","_getSpeedBoundBox","generatePositionAndDirection","rand","randomSeeds","_calculateProceduralBounds","emitterPosScale","minMaxBounds","speedBounds","maxSpeedBound","maxSpeedMin","maxSpeedMax","minSpeedBound","minSpeedMin","minSpeedMax","destShape","ShapeUtils","arc","getFloat","random","_randomPointUnitArcCircle","_randomPointUnitCircle","_randomPointUnitSphere","BoxShape","shapeType","Box","seed","_randomPointInsideHalfUnitBox","CircleShape","Circle","emitFromEdge","arcDEG","deg","positionPoint","_tempPositionPoint","_randomPointInsideUnitArcCircle","ConeShape","Cone","emitType","angleDEG","coneRadius2","coneLength","sinA","positionX","positionY","directionPointE","positionPointE","dirCosA","dirSinA","_randomPointInsideUnitCircle","_tempDirectionPoint","HemisphereShape","Hemisphere","emitFromShell","_randomPointInsideUnitSphere","SphereShape","Sphere","SizeOverLifetime","_size","destSizeOverLifetime","destSize","StartFrame","destStartFrame","TextureSheetAnimation","startFrame","randomRow","rowIndex","cycles","enableUVChannels","tiles","_frame","_startFrame","destTextureSheetAnimation","destFrame","createByOverTime","createByRandomTwoOverTime","VelocityOverLifetime","velocity","space","_velocity","destVelocityOverLifetime","destVelocity","VertexShuriKenParticle","PARTICLE_DIRECTIONTIME","PARTICLE_POSITION0","PARTICLE_COLOR0","PARTICLE_TEXTURECOORDINATE0","PARTICLE_SHAPEPOSITIONSTARTLIFETIME","PARTICLE_CORNERTEXTURECOORDINATE0","PARTICLE_STARTCOLOR0","PARTICLE_ENDCOLOR0","PARTICLE_STARTSIZE","PARTICLE_STARTROTATION","PARTICLE_STARTSPEED","PARTICLE_RANDOM0","PARTICLE_RANDOM1","PARTICLE_SIMULATIONWORLDPOSTION","PARTICLE_SIMULATIONWORLDROTATION","PARTICLE_SIMULATIONUV","VertexShurikenParticleBillboard","cornerTextureCoordinate","positionStartLifeTime","startColor","startSize","startRotation0","startRotation1","startRotation2","ageAddScale","startSpeed","randoms0","randoms1","simulationWorldPostion","_cornerTextureCoordinate","_positionStartLifeTime","_startColor","_startSize","_startRotation0","_startRotation1","_startRotation2","_startLifeTime","_startSpeed","_randoms0","_randoms1","_simulationWorldPostion","vertexInstanceMeshDeclaration","_vertexInstanceMeshDeclaration","vertexInstanceParticleDeclaration","_vertexInstanceParticleDeclaration","billboardVertexArray","_billboardVertexArray","billboardIndexArray","_billboardIndexArray","Single","startLifeTime","random0","random1","VertexShurikenParticleMesh","Rand","_temp","Uint32Array","seeds","getUint","getSignedFloat","Emission","_emissionRate","_emissionRateOverDistance","_bursts","emissionRate","emissionRateOverDistance","getBurstsCount","getBurstByIndex","addBurst","burst","burstsCount","removeBurst","removeBurstByIndex","clearBurst","destEmission","destBursts","ShuriKenParticle3DShaderDeclaration","SHADERDEFINE_RENDERMODE_BILLBOARD","SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD","SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD","SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD","SHADERDEFINE_COLORKEYCOUNT_8","SHADERDEFINE_COLOROVERLIFETIME","SHADERDEFINE_RANDOMCOLOROVERLIFETIME","SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT","SHADERDEFINE_VELOCITYOVERLIFETIMECURVE","SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT","SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE","SHADERDEFINE_TEXTURESHEETANIMATIONCURVE","SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE","SHADERDEFINE_ROTATIONOVERLIFETIME","SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE","SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT","SHADERDEFINE_ROTATIONOVERLIFETIMECURVE","SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS","SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES","SHADERDEFINE_SIZEOVERLIFETIMECURVE","SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE","SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES","SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE","SHADERDEFINE_RENDERMODE_MESH","SHADERDEFINE_SHAPE","WORLDPOSITION","WORLDROTATION","POSITIONSCALE","SIZESCALE","SCALINGMODE","GRAVITY","THREEDSTARTROTATION","STRETCHEDBILLBOARDLENGTHSCALE","STRETCHEDBILLBOARDSPEEDSCALE","SIMULATIONSPACE","CURRENTTIME","DRAG","VOLVELOCITYCONST","VOLVELOCITYGRADIENTX","VOLVELOCITYGRADIENTY","VOLVELOCITYGRADIENTZ","VOLVELOCITYCONSTMAX","VOLVELOCITYGRADIENTXMAX","VOLVELOCITYGRADIENTYMAX","VOLVELOCITYGRADIENTZMAX","VOLSPACETYPE","COLOROVERLIFEGRADIENTALPHAS","COLOROVERLIFEGRADIENTCOLORS","COLOROVERLIFEGRADIENTRANGES","MAXCOLOROVERLIFEGRADIENTALPHAS","MAXCOLOROVERLIFEGRADIENTCOLORS","MAXCOLOROVERLIFEGRADIENTRANGES","SOLSIZEGRADIENT","SOLSIZEGRADIENTX","SOLSIZEGRADIENTY","SOLSizeGradientZ","SOLSizeGradientMax","SOLSIZEGRADIENTXMAX","SOLSIZEGRADIENTYMAX","SOLSizeGradientZMAX","ROLANGULARVELOCITYCONST","ROLANGULARVELOCITYCONSTSEPRARATE","ROLANGULARVELOCITYGRADIENT","ROLANGULARVELOCITYGRADIENTX","ROLANGULARVELOCITYGRADIENTY","ROLANGULARVELOCITYGRADIENTZ","ROLANGULARVELOCITYCONSTMAX","ROLANGULARVELOCITYCONSTMAXSEPRARATE","ROLANGULARVELOCITYGRADIENTMAX","ROLANGULARVELOCITYGRADIENTXMAX","ROLANGULARVELOCITYGRADIENTYMAX","ROLANGULARVELOCITYGRADIENTZMAX","ROLANGULARVELOCITYGRADIENTWMAX","TEXTURESHEETANIMATIONCYCLES","TEXTURESHEETANIMATIONSUBUVLENGTH","TEXTURESHEETANIMATIONGRADIENTUVS","TEXTURESHEETANIMATIONGRADIENTMAXUVS","ShurikenParticleData","startLifeTimeGradient","emissionTime","lastKey","age","MathUtil","lerp","rotatonE","randomizeRotationDirection","randDic","rotaton","particleSystem","particleRender","autoRandomSeed","_rand","_randomSeeds","startColorType","constantStartColor","startColorConstant","startColorConstantMin","startColorConstantMax","colorOverLifetime","colorRandom","minConstantColor","maxConstantColor","particleSize","startSizeType","threeDStartSize","startSizeConstantSeparate","startSizeConstant","startSizeConstantMinSeparate","startSizeConstantMaxSeparate","startSizeConstantMin","startSizeConstantMax","sizeOverLifetime","randomSize","startRotationType","threeDStartRotation","startRotationConstantSeparate","randomRotationE","_randomInvertRoationArray","startRotation","_randomInvertRoation","startRotationConstant","startRotationConstantMinSeparate","startRotationConstantMaxSeparate","lerpRoationE","startRotationConstantMin","startRotationConstantMax","startLifetimeType","startLifetimeConstant","_getStartLifetimeFromGradient","startLifetimeConstantMin","startLifetimeConstantMax","startLifeTimeGradientMin","startLifeTimeGradientMax","textureSheetAnimation","startFrameCount","title","titleX","titleY","subU","subV","startRow","startCol","startUVInfo","ShurikenParticleSystem","meshTopology","_gravityOffset","_customBounds","_useCustomBounds","_owner","_ownerRender","_floatCountPerVertex","_startLifeTimeIndex","_timeIndex","_simulationUV_Index","_simulateUpdate","_firstActiveElement","_firstNewElement","_firstFreeElement","_firstRetiredElement","_drawCounter","_bufferMaxParticles","_emission","_shape","_isEmitting","_isPlaying","_isPaused","_playStartDelay","_frameRateTime","_emissionTime","_totalDelayTime","_emissionDistance","_emissionLastPosition","_burstsIndex","_velocityOverLifetime","_colorOverLifetime","_sizeOverLifetime","_rotationOverLifetime","_textureSheetAnimation","_startLifetimeType","_startLifetimeConstant","_startLifeTimeGradient","_startLifetimeConstantMin","_startLifetimeConstantMax","_startLifeTimeGradientMin","_startLifeTimeGradientMax","_maxStartLifetime","_uvLength","_vertexStride","_indexStride","_updateMask","_currentTime","_startUpdateLoopCount","looping","prewarm","startDelayType","startDelay","startDelayMin","startDelayMax","startSpeedType","startSpeedConstant","startSpeedConstantMin","startSpeedConstantMax","dragType","dragConstant","dragSpeedConstantMin","dragSpeedConstantMax","gravityModifier","simulationSpace","simulationSpeed","scaleMode","playOnAwake","randomSeed","isPerformanceMode","_RANDOMOFFSET","maxParticles","newMaxParticles","_initBufferDatas","_updateParticlesSimulationRestart","emission","aliveParticleCount","shape","isAlive","isEmitting","isPlaying","isPaused","velocityOverLifetime","shaDat","velocityType","ranges","colorKey","alphaKey","minGradientColor","maxGradientColor","minalphaElements","minrgbElements","maxalphaElements","maxrgbElements","minRanges","maxRanges","sizeSeparate","sizeType","rotationSeparate","rotationType","frameOverTime","textureAniType","_uvLengthE","_getVertexBuffer","_getIndexBuffer","_generateBounds","speedOrigan","maxSizeScale","zDirectionSpeed","fDirectionSpeed","zEmisionOffsetXYZ","fEmisionOffsetXYZ","hemiShpere","cone","sinAngle","tanAngle","rPLCT","circle","meshSize","halfKSqrtOf2","meshBounds","endSizeOffset","offsetSize","speedZOffset","speedFOffset","velocitySpeedOffset","curveX","curveY","curveZ","gravity","gravityOffset","speedZOffsetY","speedFOffsetY","customBounds","_simulationSupported","_updateEmission","elapsedTime","loopCount","timer","_delta","_maxElapsedTime","_updateParticles","_retireActiveParticles","_freeRetiredParticles","_advanceTime","_advanceDistance","delayTime","timeIndex","_burst","fromTime","toTime","totalEmitCount","bursts","emitCount","burstTime","emitTime","lastEmissionTime","emit","stop","minEmissionTime","offsetDistance","rateOverDistance","memorySize","_byteLength","_addMemory","indexOffset","perPartOffset","vbMemorySize","getVertexElementByUsage","_vertexCount","totalVertexCount","lastVBVertexCount","indexDatas","indexValueOffset","firstVertex","secondVertex","_tempPosition","_tempDirection","addParticle","nextFreeParticle","randomVelocityX","randomVelocityY","randomVelocityZ","randomColor","randomRotation","randomTextureAnimation","needRandomVelocity","needRandomColor","needRandomSize","needRandomRotation","needRandomTextureAnimation","meshVertices","meshVertexStride","meshPosOffset","meshCorOffset","meshUVOffset","meshVertexIndex","startIndex","startU","startV","meshVB","getFloat32Data","meshVertexDeclaration","_offset","colorElement","uvElement","vertexOffset","meshOffset","addNewParticlesToVertexBuffer","byteStride","play","pause","simulate","restart","ShurikenParticleInstanceSystem","_instanceParticleVertexBuffer","_instanceVertex","_initMeshVertex","vertex","meshVertexBuffer","meshColorOffset","perParticleDataCount","positionOffset","colorOffset","uvOffset","meshDeclaration","particleDeclaration","_meshIndexCount","_floatCountPerParticleData","meshVertexCount","vbSize","meshVertex","particleVbSize","billboardDeclaration","indexArray","meshVBSize","firstActive","activeStart","_meshFloatCountPreVertex","ShurikenParticleMaterial","RENDERMODE_ALPHABLENDED","SHADERDEFINE_TINTCOLOR","SHADERDEFINE_ADDTIVEFOG","DIFFUSETEXTURE","tilingOffsetX","_MainTex_STX","tilingOffsetY","_MainTex_STY","tilingOffsetZ","_MainTex_STZ","tilingOffsetW","_MainTex_STW","_TintColor","_TintColorR","_TintColorG","_TintColorB","_TintColorA","_MainTex_ST","tilOff","colorR","colorG","colorB","colorA","ShurikenParticleRenderer","_finalGravity","_dragConstant","stretchedBillboardCameraSpeedScale","stretchedBillboardSpeedScale","stretchedBillboardLengthScale","_particleSystem","_renderMode","parSys","particleRenderNode","enableParticle","transfrom","sv","getWorldLossyScale","parRender","ShuriKenParticle3D","particleRenderer","_parseModule","module","moduleData","bases","vector2s","vec2","vec2Data","vector3s","vec3","vec3Data","vector4s","vec4","vec4Data","gradientDataNumbers","gradientNumber","gradientNumberData","valueData","resources","Texture","bitmap","burstsData","brust","main","shapeData","velocityOverLifetimeData","velocityData","constantData","_initParticleVelocity","constantMinData","constantMaxData","colorOverLifetimeData","maxKeyCount","constColorData","_initParticleColor","minConstColorData","maxConstColorData","sizeOverLifetimeData","sizeData","_initParticleSize","constantMinSeparateData","constantMaxSeparateData","rotationOverLifetimeData","angularVelocityData","conSep","_initParticleRotation","minSep","maxSep","textureSheetAnimationData","_initParticleFrame","overTimeMin","overTimeMax","startFrameData","_parseOld","anglelToRad","materialData","_initStartLife","startLifetimeGradient","startLifetimeGradientMin","startLifetimeGradientMax","startSizeConstantSeparateArray","startSizeConstantSeparateElement","startSizeConstantMinSeparateArray","startSizeConstantMinSeparateElement","startSizeConstantMaxSeparateArray","startSizeConstantMaxSeparateElement","startRotationConstantSeparateArray","startRotationConstantSeparateElement","startRotationConstantMinSeparateArray","startRotationConstantMinSeparateElement","startRotationConstantMaxSeparateArray","startRotationConstantMaxSeparateElement","startColorConstantArray","startColorConstantElement","startColorConstantMinArray","startColorConstantMinElement","startColorConstantMaxArray","startColorConstantMaxElement","emissionData","sphereShape","sphereRadius","sphereEmitFromShell","sphereRandomDirection","hemiSphereShape","hemiSphereRadius","hemiSphereEmitFromShell","hemiSphereRandomDirection","coneShape","coneAngle","coneRadius","coneEmitType","coneRandomDirection","boxShape","boxX","boxY","boxZ","boxRandomDirection","circleShape","circleRadius","circleArc","circleEmitFromEdge","circleRandomDirection","tempShape","tilesData","gradientColorData","maxkeyCount","alphasData","alphas","alphaData","rgbsData","rgbs","rgbData","rgbValue","overTimeFramesData","overTimeFrame","framesData","frames","gradientData","startLifetimesData","startLifetimes","velocitysData","velocitys","gradientSizeData","sizesData","sizes","angularVelocitysData","angularVelocitys","PixelLineVertex","Transform3D","EventDispatcher","_localPosition","_localRotation","_localScale","_localRotationEuler","_localMatrix","_rotation","_scale","_rotationEuler","_worldMatrix","_isDefaultMatrix","_faceInvert","_frontFaceValue","_transformFlag","_setTransformFlag","TRANSFORM_LOCALQUATERNION","TRANSFORM_LOCALEULER","TRANSFORM_LOCALMATRIX","TRANSFORM_WORLDPOSITION","TRANSFORM_WORLDQUATERNION","TRANSFORM_WORLDEULER","TRANSFORM_WORLDSCALE","TRANSFORM_WORLDMATRIX","isDefaultMatrix","_getTransformFlag","localMatrix","isInvert","worldNeedUpdate","localPositionX","localPositionY","localPositionZ","_onWorldPositionTransform","localRotationX","localRotationY","localRotationZ","localRotationW","eulerE","createFromYawPitchRoll","_angleToRandin","_onWorldRotationTransform","localScaleX","localScaleY","localScaleZ","_onWorldScaleTransform","localRotationEulerX","localRotationEulerY","localRotationEulerZ","getYawPitchRoll","euler","isIdentity","decomposeTransRotScale","worldMatE","parentInvMat","rotationEulerE","effectiveTrans","_getScaleMatrix","invRotation","invRotationMat","_tempMatrix3x30","worldRotScaMat","_tempMatrix3x31","scaMat","_tempMatrix3x32","Matrix3x3","createFromMatrix4x4","createRotationQuaternion","parentChilds","_onWorldPositionRotationTransform","_onWorldPositionScaleTransform","translate","translation","isLocal","rotate","isRadian","worldMatElem","up","getRight","lookAt","isCamera","eye","rotationLookAt","worldPosition","objLookat","scaMatE","setWorldLossyScale","scaleMat","_tempMatrix3x33","localScaleMat","localScaleMatE","parInvScaleMat","createFromScaling","localToGlobal","globalToLocal","toLocalNormal","TransformNormal","toDir","rotationTo","Up","UnitX","tmpVec3","UnitY","createFromAxisAngle","SkinnedMeshSprite3DShaderDeclaration","SkinRenderElement","setSkinData","skinnedData","createSkinRenderElement","SkinnedMeshRenderer","_bones","_inverseBindPosesBufferForNative","_skinnedMatrixCachesBufferForNative","_bonesTransformForNative","_localBounds","SHADERDEFINE_BONE","localBounds","rootBone","_cacheRootBone","_computeSkinnedData","_cacheMesh","bindPoses","_inverseBindPoses","pathMarks","_skinnedMatrixCaches","subMeshBoneIndices","_boneIndicesList","subData","_skinnedData","boneIndices","_computeSubSkinnedData","matrixCaches","q","_skinnedDataLoopMarks","preData","batchIndex","srcIndex","batchBoneIndex","dstIndex","bone","_computeSkinnedDataForNative","Int32Array","_nativeObj","conch","computeSubSkinnedDataForNative","enableSkin","_onSkinMeshChange","subBoneIndices","skinRenderNode","DEFAULT","cloneHierachFun","rootNode","rootCheckNode","destNode","rootparent","nodeArray","checkNode","getCommomParent","_getHierarchyPath","pathcheck","destParent","_getParentNodeByHierarchyPath","_getNodeByHierarchyPath","destBone","ceckNode","lbb","SkinnedMeshSprite3D","SHADERDEFINE_SIMPLEBONE","BONES","skinnedMeshRenderer","enabled","rootBoneData","bonesData","_tempArray0","TrailMaterial","materialRenderMode","MaterialRenderMode","MAINTEXTURE","SHADERDEFINE_MAINTEXTURE","TrailTextureMode","Stretch","Tile","VertexTrail","vertexDeclaration1","_vertexDeclaration1","vertexDeclaration2","_vertexDeclaration2","TRAIL_POSITION0","TRAIL_OFFSETVECTOR","TRAIL_TIME0","TRAIL_TEXTURECOORDINATE0Y","TRAIL_TEXTURECOORDINATE0X","TRAIL_COLOR","TrailGeometry","_floatCountPerVertices1","_floatCountPerVertices2","_increaseSegementCount","_activeIndex","_endIndex","_needAddFirstVertex","_isTempEndVertex","_vertices1","_vertices2","_lastFixedVertexPosition","tmpColor","_disappearBoundsMode","_segementCount","_resizeData","segementCount","_subBirthTime","_subDistance","Float64Array","vertexBuffers","vertexbuffer1Size","vertexbuffer2Size","_vertexBuffer1","_vertexBuffer2","_resetData","oldVertices1","oldVertices2","oldSubDistance","oldSubBirthTime","_updateTrail","lastPosition","equals","_addTrailByFirstPosition","_addTrailByNextPosition","_curtime","delVector3","pointAtoBVector3","alignment","View","cameraMatrix","TransformZ","widthMultiplier","tempEndIndex","delLength","_updateVerticesByPositionData","minVertexDistance","_updateVerticesByPosition","_totalLength","curtime","down","floatCount","delDistance","_updateVertexBufferUV","sprite3dPosition","curLength","colorGradient","startAlphaIndex","startColorIndex","totalLength","stride","uvX","textureMode","posOffset","side","_updateDisappear","nextIndex","fixedPos","ALIGNMENT_VIEW","ALIGNMENT_TRANSFORM_Z","TrailFilter","_textureMode","_lastPosition","_initDefaultData","CURTIME","LIFETIME","WIDTHCURVE","WIDTHCURVEKEYLENGTH","spriteParms","_minVertexDistance","_widthMultiplier","widthCurve","_widthCurve","widthCurveFloatArray","_colorGradient","_trialGeometry","curPos","widthKeyFrames","widthKeyFrame1","widthKeyFrame2","WHITE","TrailRenderer","_trailFilter","onUpdate","widthCurveData","TrailSprite3D","_geometryFilter","trailFilter","trailRenderer","trailkeyframe","colorGradientData","colorKeys","alphaKeys","srcSprite","SubMeshInstanceBatch","instanceWorldMatrixData","instanceSimpleAnimatorData","instanceWorldMatrixBuffer","instanceSimpleAnimatorBuffer","instanceSimpleAnimatorDeclaration","_indexCount","VertexPositionTerrain","textureCoord0","textureCoord1","_textureCoord0","_textureCoord1","TERRAIN_POSITION0","TERRAIN_NORMAL0","TERRAIN_TEXTURECOORDINATE0","TERRAIN_TEXTURECOORDINATE1","InstanceRenderElement","_InvertFront","_instanceBatchElementList","_isUpdataData","_invertFrontFace","elemet","_isInPool","InvertFront","createInstanceRenderElement","oriRendertype","updateInstanceData","_instanceBufferStateType","Mesh","MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR","getUpdateData","addUpdateBuffer","_instanceWorldVertexBuffer","insBatches","drawCount","simpleAnimatorData","_computeAnimatorParamsData","simpleAnimatorParams","_simpleAnimatorParams","_instanceSimpleAniVertexBuffer","MESH_INSTANCEBUFFER_TYPE_NORMAL","_instanceLightMapVertexBuffer","lightMapData","SubMesh","UInt32","Element_Index_Uint32","_subIndexBufferStart","_subIndexBufferCount","_setIndexRange","indexStart","canRead","_indices","_uploadVerticesData","byteCount","skinnedDatas","_indexFormat","getIndices","_isReadable","setIndices","skinnedMatrixCache","isReadable","_minVerticesUpdate","_maxVerticesUpdate","_needUpdateBounds","destroyedImmediately","Config","destroyResourceImmediatelyDefault","MESH","inverseAbsoluteBindPoses","_getPositionElement","vertexElement","_elementFormat","_getVerticeElementData","uint8Vertices","getUint8Data","floatVertices","uint8VerStr","floatVerStr","uint8EleOffset","floatEleOffset","MESH_BLENDWEIGHT0","MESH_BLENDINDICES0","_setVerticeElementData","float8VerStr","cor","MAX_SAFE_INTEGER","instanceLightMapScaleOffsetData","_setCPUMemory","_setGPUMemory","_btTriangleMesh","_boneNames","__convexMesh","_setSubMeshes","subMeshes","_indexInMesh","_setBuffer","instanceBufferStateType","instanceBuffer3D","instanceLightMapVertexBuffer","instanceLightMapScaleOffsetDeclaration","getPositions","positions","setPositions","getColors","colors","setColors","getUVs","uvs","setUVs","getNormals","normals","setNormals","getTangents","tangents","setTangents","getBoneWeights","boneWeights","setBoneWeights","getBoneIndices","setBoneIndices","markAsUnreadbale","getVertices","setVertices","calculateBounds","positionElement","verticesData","ofset","pX","pY","pZ","getCorveMesh","_convexMesh","_PhysicsCreateUtil","getPhysicsCapable","Physics_CreateCorveMesh","createCorveMesh","destMesh","destVB","bufferUsage","ib","destIB","cpuMemory","gpuMemory","boneNames","destBoneNames","inverseBindPoses","destInverseBindPoses","cacheLength","skinnedCache","subIndexBufferStart","subIndexBufferCount","boneIndicesList","destSubmesh","PrimitiveMesh","long","halfLong","halfHeight","halfWidth","_createMesh","vertexFloatStride","hcHeight","posX","posY","posZ","ic","verticeCount","rotateRadius","curAngle","downV3","upPoint","downPoint","v3","q4","rotateAxis","rv","acos","transformQuat","ri","bv","bi","tv","ti","stacksLong","slicesWidth","indiceIndex","BlitFS","BlitScreenShaderInit","blitPass","statefirst","blitState","transparentShader","transparentSubShader","blitPassTrans","srcBlend","dstBlend","lutBuilderInit","u_LutParams","PBRDepthVS","PBRDepthFS","UnlitShaderInit","UnlitBlock","u_AlbedoColor","u_TilingOffset","u_AlbedoTexture","u_AlphaTestValue","DefaultAttributeMap","DepthVS","DepthFS","BlinnPhongShaderInit","u_DiffuseColor","u_DiffuseTexture","u_AlbedoIntensity","u_MaterialSpecular","u_SpecularTexture","u_Shininess","u_NormalTexture","TrailShaderInit","a_Position","a_OffsetVector","a_Texcoord0X","a_Texcoord0Y","a_BirthTime","a_Color","u_MainTexture","u_MainColor","PBRStandardShaderInit","u_NormalScale","u_Metallic","u_Smoothness","u_OcclusionStrength","u_EmissionColor","u_EmissionIntensity","u_OcclusionTexture","u_EmissionTexture","u_MetallicGlossTexture","u_AnisotropyStrength","u_AnisotropyTexture","u_AnisotropyRotation","u_ClearCoatFactor","u_ClearCoatTexture","u_ClearCoatRoughness","u_ClearCoatRoughnessTexture","u_ClearCoatNormalTexture","u_DetailAlbedoTexture","u_DetailNormalTexture","u_DetailNormalScale","u_DetailTillingOffset","SkyBoxShaderInit","u_TintColor","u_Exposure","u_Rotation","u_CubeTexture","DEPTHTEST_LEQUAL","CullMode","Back","stencilWrite","ParticleShuriKenShaderInit","a_CornerTextureCoordinate","a_MeshPosition","a_MeshColor","a_MeshTextureCoordinate","a_ShapePositionStartLifeTime","a_DirectionTime","a_StartColor","a_StartSize","a_StartRotation0","a_StartSpeed","a_Random0","a_Random1","a_SimulationWorldPostion","a_SimulationWorldRotation","a_SimulationUV","u_Tintcolor","u_texture","SkyProceduralShaderInit","u_SunSize","u_SunSizeConvergence","u_AtmosphereThickness","u_SkyTint","u_GroundTint","SkyPanoramicShaderInit","u_Texture","grayTexture","ACESShaderLib","ShaderInit3D","init","SHADERDEFINE_LEGACYSINGALLIGHTING","SHADERDEFINE_ENUNIFORMBLOCK","SHADERDEFINE_FLOATTEXTURE","SHADERDEFINE_FLOATTEXTURE_FIL_LINEAR","SimpleSkinnedMeshRenderer","_simpleAnimatorOffset","simpleAnimatorTexture","_simpleAnimatorTexture","_simpleAnimatorTextureSize","SIMPLE_SIMPLEANIMATORTEXTURE","SIMPLE_SIMPLEANIMATORTEXTURESIZE","simpleAnimatorOffset","round","_bonesNums","oriMat","getMatrix4x4","SIMPLE_SIMPLEANIMATORPARAMS","SimpleSkinnedMeshSprite3D","simpleSkinnedMeshRenderer","bonesNums","animatorTexture","animatortexture","TEXTURE2D","SkyPanoramicMaterial","_textureHDRParams","TEXTURE_HDR_PARAMS","TEXTURE","panoramicTexture","BloomVS","BloomEffect","_linearColor","_bloomTextureTexelSize","_shaderThreshold","_shaderParams","_pyramid","_threshold","_softKnee","_diffusion","_anamorphicRatio","_dirtIntensity","_shaderSetting","_dirtTileOffset","_fastMode","_dirtTexture","threshold","softKnee","clamp","diffusion","anamorphicRatio","u_AutoExposureTex","u_Threshold","u_Params","u_BloomTex","u_SampleScale","shaderPass","CompositeInit","u_Bloom_DirtTex","u_BloomTex_TexelSize","u_Bloom_DirtTileOffset","u_Bloom_Settings","u_Bloom_Color","SHADERVALUE_SAMPLESCALE","SHADERVALUE_THRESHOLD","SHADERVALUE_PARAMS","_clamp","fastMode","dirtTexture","dirtIntensity","MAXPYRAMIDSIZE","logs","ratio","rw","rh","tw","th","logsInt","iterations","sampleScale","lthresh","knee","lclamp","qualityOffset","lastDownTexture","downIndex","upIndex","SUBSHADER_PREFILTER13","SUBSHADER_DOWNSAMPLE13","mipDownTexture","mipUpTexture","lastUpTexture","SUBSHADER_UPSAMPLETENT","linearColor","shaderSettings","usedirtTexture","dirtRatio","screenRatio","dirtTileOffset","SUBSHADER_PREFILTER4","SUBSHADER_DOWNSAMPLE4","SUBSHADER_UPSAMPLEBOX","AOQUALITY","ScalableAO","_aoParams","_aoQuality","MEDIUM","AOParams","_aoBlurHorizontalShader","_aoComposition","aoQuality","BlurDelty","AOColor","aoTexture","SourceTex","SHADERDEFINE_AOHigh","SHADERDEFINE_AOMEDIUM","SHADERDEFINE_LOWEST","u_Delty","u_PlugTime","u_AOParams","u_BlurVector","u_AOColor","u_compositionAoTexture","aoColor","LOWEST","DepthAndDepthNormals","depthTextureMode","textureFormat","finalTex","blurTex","deltyVector","deltyHorizontal","FullScreenVert","GaussianDoF","COCPARAMS","_sourceSize","_dowmSampleScale","SOURCESIZE","ZBUFFERPARAMS","NORMALDEPTHTEXTURE","FULLCOCTEXTURE","DOWNSAMPLESCALE","BLURCOCTEXTURE","SHADERDEFINE_DEPTHNORMALTEXTURE","u_ZBufferParams","u_CoCParams","u_FullCoCTex","u_SourceSize","u_DownSampleScale","u_BlurCoCTex","cocSubShader","prefilterSubShader","blurHSubShader","blurVSubShader","compositeSubShader","farStart","cocParams","getVector3","farEnd","maxRadius","_setupShaderValue","dataTexFormat","fullCoC","prefilterTex","blurHTex","blurVTex","LensFlareElementGeomtry","_createBuffer","quadSize","lensQuadVertices","lensQuadIndex","instanceVertexDeclaration","_instanceVertexBuffer","lensFlareElementMax","PositionUV","PositionRotationScale","LensFlareCMD","_instanceCount","_lensFlareGeometry","_initMaterial","_materials","setFloat","lensFlareElement","_lensFlareElementData","applyElementData","angularOffset","autoRotate","LensFlareEffect","SHADERDEFINE_AUTOROTATE","testFloat","startPosition","Utils","toAngle","FogMode","CameraClearFlags","CameraEventFlags","AreaShape","LensFlareShaderInit","attribute","a_DistanceRotationScale","u_Tint","u_TintIntensity","u_FlareTexture","u_FlareCenter","u_aspectRatio","u_rotate","u_Postionoffset","u_Angularoffset","subshader","LensFlareElement","_texture","_positionOffset","_autoRotate","_startPosition","_angularOffset","_aspectRatio","_modulateByLightColor","_translationScale","LensFlareData","_effectIntensity","_effectScale","_flareCMDS","_tempV4","lensFlareData","ele","_lensFlareData","bindLight","effectIntensity","effectScale","_updateEffectData","_rotate","cmdEle","caculateDirCenter","_direction","caculatePointCenter","caculateSpotCenter","PhysicsCreateUtil","_enablePhysics","enablePhysics","WebGL","onStageResize","clientWidth","checkPhysics","Promise","resolve","initialize","__init__","_multiLighting","enableMultiLight","enableUniformBufferObject","UnifromBufferObject","lcc","maxAreaLightCountWithZ","_maxAreaLightCountPerClusterAverage","configRenderContextInstance","Sprite","_reflectionsSource","_reflectionsResolution","_reflectionsIblSamples","_lightmaps","_physicsStepTime","_collsionTestList","_key","SubmitKey","createBaseRenderQueue","_transparentQueue","_UI3DManager","currentCreationLayer","enableLight","_ShadowMapupdateFrequency","_componentDriver","ComponentDriver","_timer","conchConfig","conchWebGL","conchSubmitScene3D","renderSubmit","bind","_physicsManager","createPhysicsManger","physicsSettings","_sceneUniformObj","UBONAME_SCENE","_sceneUniformData","createSceneUniformBlock","SCENEUNIFORMBLOCK","_shadowCasterPass","_fogParams","enableFog","fogStart","fogEnd","fogDensity","fogColor","fogMode","Linear","GIRotate","useBVHCull","BVH_Min_Build_nums","BVH_limit_size","BVH_max_SpatialCount","_cullPass","createCullPass","debugFrustumCulling","_sceneReflectionProb","__updateMark","SHADERDEFINE_FOG","SHADERDEFINE_FOG_LINEAR","SHADERDEFINE_FOG_EXP","SHADERDEFINE_FOG_EXP2","SHADERDEFINE_DIRECTIONLIGHT","SHADERDEFINE_POINTLIGHT","SHADERDEFINE_SPOTLIGHT","SHADERDEFINE_SHADOW","SHADERDEFINE_SHADOW_SPOT","FOGCOLOR","FOGPARAMS","DIRECTIONLIGHTCOUNT","LIGHTBUFFER","CLUSTERBUFFER","TIME","LIGHTDIRECTION","LIGHTDIRCOLOR","LIGHTMODE","POINTLIGHTPOS","POINTLIGHTRANGE","POINTLIGHTATTENUATION","POINTLIGHTCOLOR","POINTLIGHTMODE","SPOTLIGHTPOS","SPOTLIGHTDIRECTION","SPOTLIGHTSPOTANGLE","SPOTLIGHTRANGE","SPOTLIGHTCOLOR","SPOTLIGHTMODE","SceneUBOData","clusterSlices","_lightTexture","_lightPixles","configShaderValue","legacyLightingValueInit","ret","Scene","_scene3D","scene2D","_scene2D","manager","cullPass","_enableFog","_fogMode","EXP","EXP2","fogParams","physicsSimulation","maps","map","shadowMapFrequency","physicsManager","enablePhysicsUpdate","callStart","callUpdate","callLateUpdate","callDestroy","_renderByEditor","_binarySearchIndexInCameraPool","_getGroup","_group","_setGroup","_scene3Ds","scenes","_prepareSceneToRender","enableMulLight","ligTex","ligPix","pixelWidth","floatWidth","dirCount","dirElements","sunLightIndex","_mainDirectionLight","dirLight","intCor","mainPointLightIndex","_mainPointLight","poiLight","mainSpotLightIndex","_mainSpotLight","spoLight","cullInfoCamera","_cullInfoCamera","_setCullCamera","recaculateCullCamera","order","_preCulling","_clearRenderQueue","_clear","vpX","renderTex","_getRenderTexture","vpW","_needInternalRenderTexture","renderTarget","_context3DViewPortCatch","_contextScissorPortCatch","clearFlag","Sky","clearConst","stencilFlag","Stencil","DepthOnly","Nothing","ColorOnly","gammaCorrection","_renderScene","renderFlag","SCENERENDERFLAG_RENDERQPAQUE","opaqueDrawCall","SCENERENDERFLAG_SKYBOX","SCENERENDERFLAG_RENDERTRANSPARENT","transDrawCall","lightMapsData","lightMapCount","getTexture2D","skyData","sky","fogRange","fogColorData","fogCol","ambientModeData","ambientColorData","ambCol","ambientSkyColor","tempV3sky","ambientEquatorColor","tempV3Equaltor","ambientGroundColor","tempV3Ground","ambientSphericalHarmonicsData","reflectionData","reflection","reflectionDecodingFormatData","ambientSphericalHarmonicsIntensityData","ambientSphericalHarmonicsIntensity","reflectionIntensityData","ctx","addRenderObject3D","_curBindedBufferState","unBind","enableBuiltInRenderTexture","_blitTransRT","_blitOffset","blitMainCanvans","normalizedViewport","_cacheDepth","Context","set2DRenderConfig","clearPool","normalizeViewPort","mainCavansViewPort","fxaa","getRenderType","releaseRender","reUse","setGlobalShaderValue","shaderOffset","setlightmaps","getlightmaps","lightmapColors","REFLECTIONMODE_SKYBOX","REFLECTIONMODE_CUSTOM","_updateViewMatrix","_postProcess","_enableHDR","_viewportParams","_projectionParams","_needBuiltInRenderTexture","_msaa","_fxaa","_canBlitDepth","_internalCommandBuffer","_depthTextureFormat","_cameraEventCommandBuffer","_shadowCasterCommanBuffer","_clusterPlaneCacheFlag","_viewMatrix","_projectionMatrix","_projectionViewMatrix","_viewport","_normalizedViewport","_rayViewport","_boundFrustum","_depthTextureMode","opaquePass","_onTransformChanged","replaceFlag","recoverTexture","needInternalRT","msaa","_needRenderGamma","callPreRender","needShadowCasterPass","_renderShadowMap","_preRenderMainPass","_renderMainPass","_aftRenderMainPass","callPostRender","coverFilter","pixelData","rtFormat","R32G32B32","R16G16B16","R5G6B5","blit","renderCubeSize","bytelength","quaterionArray","drawRenderTextureByScene","drawTextureCubePixelByScene","depthPass","vp","_calculationViewport","needUpdateCanvasSize","customResolution","pixelRatio","_resoluWidth","_resoluHeight","MSAA","enablemsaa","scaleX","scaleY","scaleZ","viewMatE","_isCameraTarget","postProcess","enableHDR","RenderTextureFormat_R16G16B16A16","_opaquePass","_opaqueTexture","enableBlitDepth","_cacheDepthTexture","canblitDepth","lx","ly","rx","ry","ceilLeftX","ceilLeftY","floorRightX","floorRightY","pixelLeftX","pixelLeftY","pixelRightX","pixelRightY","_isLayerVisible","clearFlagData","_updateCameraRenderData","proMat","projectView","clusterCount","xSlixe","ySlice","xCount","yCount","yLengthPerCluster","xLengthPerCluster","normX","normY","_applyCommandBuffer","enableCameraCMD","commandBufferArray","textureContext","bindoutScreenTarget","_addCasterShadowCommandBuffer","_removeCasterShadowCommandBuffer","shadowCasterPass","mainDirectLight","supportShadow","enableShadow","spotMainLight","spotneedShadowCasterPass","bindCanvasRender","grabTexture","copySubFrameBuffertoTex","setDataByUniformBufferData","_renderDepthMode","BeforeForwardOpaque","recoverRenderContext3D","enableOpaque","BeforeSkyBox","BeforeTransparent","_createOpaqueTexture","enableTransparent","BeforeImageEffect","enablePostprocess","AfterEveryThing","cacheViewPor","cacheScissor","cameraDepthMode","depthStencilTexture","needShadowPass","currentTarget","renderContext","opaqueTexParams","activeInHierarchy","texFormat","viewportPointToRay","_width","_height","calculateCursorRay","normalizedViewportPointToRay","finalPoint","_tempVector20","worldToViewportPoint","_wr","_hr","clientScaleX","clientScaleY","worldToNormalizedViewportPoint","convertScreenCoordToOrthographicCoord","ratioX","ratioY","addCommandBuffer","removeCommandBuffer","removeCommandBuffers","DirectionLightCom","shadowTwoCascadeSplits","shadowFourCascadeSplits","LightSprite","spriteLight","PointLightCom","_range","pointlight","SpotLightCom","_spotAngle","EffectMaterial","ExtendTerrainMaterial","SHADERDEFINE_DETAIL_NUM1","SHADERDEFINE_DETAIL_NUM2","SHADERDEFINE_DETAIL_NUM3","SHADERDEFINE_DETAIL_NUM4","SHADERDEFINE_DETAIL_NUM5","SPLATALPHATEXTURE","DIFFUSETEXTURE1","DIFFUSETEXTURE2","DIFFUSETEXTURE3","DIFFUSETEXTURE4","DIFFUSETEXTURE5","DIFFUSESCALEOFFSET1","DIFFUSESCALEOFFSET2","DIFFUSESCALEOFFSET3","DIFFUSESCALEOFFSET4","DIFFUSESCALEOFFSET5","splatAlphaTexture","diffuseTexture1","_setDetailNum","diffuseTexture2","diffuseTexture3","diffuseTexture4","diffuseTexture5","diffuseScaleOffset1","scaleOffset1","diffuseScaleOffset2","scaleOffset2","diffuseScaleOffset3","scaleOffset3","diffuseScaleOffset4","scaleOffset4","diffuseScaleOffset5","scaleOffset5","WaterPrimaryMaterial","HORIZONCOLOR","WAVESCALE","WAVESPEED","horizonColor","mainTexture","waveScale","waveSpeed","VolumetricGI","probeCounts","probeStep","_params","irradiance","_irradiance","viewBias","irradianceTexel","distanceTexel","AreaLightCom","Area","_spread","_maxBounces","_areaShape","rectangle","_power","power","spread","maxBounces","tempVec","LODInfo","mincullRate","_mincullRate","_renders","_cachSprite3D","group","_updateRecaculateFlag","_lodIndex","addNode","ren","components","comp","numChildren","removeNode","RenderBitFlag_CullFlag","removeAllRender","LODGroup","_needcaculateBounds","_lods","_visialIndex","_lodPosition","lods","_lodCount","nowRate","_nowRate","recalculateBounds","_setLODinvisible","_applyVisibleRate","rate","_setLODvisible","lod","onDestroy","renderarray","lodGroup","lodArray","cloneLOD","firstBounds","onPreRender","checkCamera","maxYDistance","cameraFrustum","rateYDistance","PixelLineData","endPosition","endColor","PixelLineFilter","Lines","_floatCountPerVertices","_minUpdate","_maxUpdate","_floatBound","_calculateBound","_maxLineCount","_lineCount","pointCount","_tempVector0","_tempVector1","_resizeLineData","lastVertices","_updateLineVertices","floatBound","_reCalculateBound","_removeLineData","rightPartVertices","startX","startY","startZ","endX","endY","endZ","_updateLineData","_updateLineDatas","_getLineData","PixelLineMaterial","COLOR","PixelLineRenderer","_isRenderActive","_isInRenders","_needUpdatelines","_lines","_pixelLineFilter","pixelLinesDatas","addLines","_changeRenderObjects","lineFilter","renderObjects","_pixelLinesDataChange","keyN","parseInt","setLine","lines","addCount","removeLine","pixeldata","getLine","pixelLineDatas","linedata","AnimatorPlayState","_currentState","currentState","curTransition","normalizedTime","_normalizedTime","animatorState","_resetPlayState","clipDuration","_finish","_playEventIndex","_startPlayTime","_elapsedTime","_lastIsFront","playTime","_normalizedPlayTime","AnimatorControllerLayer","_referenceCount","_playType","_crossDuration","_crossMark","_crossNodesOwnersCount","_crossNodesOwners","_crossNodesOwnersIndicesMap","_srcCrossClipNodeIndices","_destCrossClipNodeIndices","_states","_playStateInfo","_crossPlayStateInfo","blendingMode","BLENDINGMODE_OVERRIDE","playOnWake","defaultState","_defaultState","_avatarMask","defaultStateName","getAnimatorState","_defaultStateNameCatch","states","removed","removeState","newAdded","addState","_removeClip","clipStateInfos","_clip","clipStateInfo","_animator","frameNodes","nodeOwners","_nodeOwners","_removeKeyframeNodeOwner","_getReferenceCount","_clearReference","getCurrentPlayState","stateName","_getOwnersByClip","BLENDINGMODE_ADDTIVE","AnimatorResource","propertyKey","ClassUtils","getClass","AnimatorState","_currentFrameIndices","_isLooping","_realtimeDatas","_scripts","_transitions","_soloTransitions","speed","clipStart","clipEnd","cycleOffset","realtimeDatas","clipNodes","Int16Array","_resetFrameIndices","transitions","soloTransitions","_eventStart","animator","layerIndex","EVENT_OnStateEnter","setPlayScriptInfo","onStateEnter","_eventExit","EVENT_OnStateExit","onStateExit","_eventStateUpdate","EVENT_OnStateUpdate","onStateUpdate","_eventLoop","EVENT_OnStateLoop","onStateLoop","_eventtransition","normalizeTime","paramsMap","soloNums","check","transNums","addScript","script","getScript","getScripts","coms","AvatarMask","_avatarPathMap","setTransformActive","getAllTranfromPath","Animator","_keyframeNodeOwners","_updateMode","AnimatorUpdateMode","_lowUpdateDelty","_animatorParams","_linkAvatarSpritesData","_linkAvatarSprites","_renderableSprites","cullingMode","CULLINGMODE_CULLCOMPLETELY","_finishSleep","_controllerLayers","_speed","_keyframeNodeOwnerMap","controller","val","_controller","updateTo","updateMode","lowUpdateDelty","controllerLayerCount","animatorParams","values","sleep","_addKeyframeNodeOwner","clipOwners","nodeIndex","keyframeNodeOwner","propertys","frameNodesCount","ownPat","getChildByName","oriProperty","getAnimatorResource","_updatePlayer","playState","lastElapsedTime","elapsedPlaybackTime","_lastElapsedTime","loopNum","_applyTransition","layerindex","transition","crossFade","destState","transduration","transstartoffset","_updateStateFinish","_eventScript","events","eventIndex","endTime","front","scripts","_isScript","fun","_updateEventScript","stateInfo","playStateInfo","HAS_SCRIPT","preEventIndex","newEventIndex","_updateClipDatas","animatorMask","curPlayTime","currentFrameIndices","_applyFloat","nodeOwner","additive","isFirstLayer","defValue","_applyVec2","oriValue","_applyVec3","_applyVec4","_applyColor","_applyPositionAndRotationEuler","oriX","oriY","oriZ","defX","defY","defZ","_applyRotation","clipRot","_tempQuaternion1","quaternionWeight","defaultRot","_applyScale","clipSca","scaleBlend","defaultSca","_applyCrossData","srcValue","desValue","crossWeight","pro","lastpro","proPat","crossValue","localPos","srcX","srcY","srcZ","localRot","localSca","localEuler","v44","getVector2","v4","getVector4","_setClipDatasToNode","controllerLayer","_setCrossClipDatasToNode","srcState","ownerCount","destRealtimeDatas","destDataIndices","destNodeOwners","srcRealtimeDatas","srcDataIndices","srcNodeOwners","destIndex","_setFixedCrossClipDatasToNode","_revertDefaultKeyframeNodes","locPos","def","locRot","defQua","locSca","locEul","tempColor","_tempColor","onAfterDeserialize","arr","controllerLayers","addControllerLayer","defaultClip","getDefaultState","_applyUpdateMode","LowFrame","UnScaleTime","_handleSpriteOwnersBySprite","isLink","ownersNodes","layersData","layers","layerData","animatorLayer","blendingModeData","clipPath","motion","getControllerLayer","layerMaskData","avaMask","bips","cullingModeData","enableAnimatorUpdate","crossPlayStateInfo","finish","crossState","_crossPlayState","crossClip","crossDuratuion","startPlayTime","crossClipDuration","crossScale","crossSpeed","needUpdateFinishcurrentState","controllLayer","animatorStates","cloneLayer","controllderLayer","layerInex","NEGATIVE_INFINITY","curPlayState","calclipduration","transitionDuration","destAnimatorState","playType","crossNodeOwners","crossNodeOwnerIndicesMap","srcAnimatorState","destCrossClipNodeIndices","destClip","destNodes","destNodesMap","crossCount","scrCrossClipNodeIndices","srcClip","srcNodes","srcNodesMap","crossMark","srcNode","srcNodeOwner","srcFullPath","destNodeOwner","destFullPath","setParamsTrigger","AnimatorStateCondition","conditionNameToID","setParamsNumber","setParamsBool","getParamsvalue","getCurrentAnimatorPlayState","CULLINGMODE_ALWAYSANIMATE","AnimatorTransition","_conditions","_exitByTime","_exitTime","_transduration","_transstartoffset","_mute","mute","_destState","conditions","removeCondition","addCondition","exitByTime","exitTime","condition","con","checkState","AniStateConditionType","Trigger","AnimatorController","AnimatorControllerParse","clipsID","getLayers","lArr","acl","unshift","err","getState","currLayer","len","parms","AniParmType","Boolean","isNaN","createState","idCatch","defID","childStates","groupRet","isArray","uuid","substring","setExitTransition","exitRet","pExitRet","ats","sts","linArr","ato","addConditions","solo","setTransitions","pState","exitTransition","o","idk","parm","AnimatorStateBoolCondition","compareFlag","checkValue","AnimatorStateNumberCondition","numberValue","AnimatorStateTriggerCondition","BatchMark","batched","InstanceBatchManager","_instanceBatchOpaqueMarks","updateCountMark","_getData","cls","getInstanceBatchOpaquaMark","materialID","subMeshID","invertFace","reflectionprob","BatchRender","_lodInstanceRenderElement","_RenderBitFlag","RenderBitFlag_Batch","_batchList","checkLOD","_checkLOD","lodCullRateArray","_lodRateArray","_changeLOD","_cacheLod","concat","_lodsize","addList","reBatch","renderNums","_restorRenderNode","StaticInstanceBatchRender","_insBatchMarksNums","_insElementMarksArray","_instanceBatchminNums","_updateChangeElement","_batchManager","RenderBitFlag_InstanceBatch","_isRenderNodeAllCanInstanceBatch","_enableInstancing","_sumInstanceBatch","insBatchMarks","_batchOneElement","instanceelement","_createInstanceElement","indexof","_batchElement","_removeOneElement","_updateOneElement","batchMark","instanceRenderElement","renderNodes","StatiVertexMergeBatchRender","_addList","StaticBatchVolume","_customBatchs","_enableStaticInstanceBatch","_enableStaticVertexMergeBatch","_cacheRender","_enableCustomBatch","_getStaticInstanceBatchRender","_getStatiVertexMergeBatchRender","_instanceBatchRender","_vertexMergeBatchRender","enableStaticInstanceBatchRender","enableMergeBatchRender","enableCustomBatchRender","customBatchRenders","_destroyComponent","addComponentInstance","__addRenderNodeToBatch","__removeRenderNodeFromBatch","onStart","UI3DGeometry","_bound","_vertex","_positionArray","_resizeViewVertexData","viewMode","worldPos","halfwidth","halfhight","tempV0","billboardTrans","_changeVertex","_resizeVertexData","_resizeWorldVertexData","applyMat","UI3D","_sizeChange","_view","_bindPropertyName","_hit","_uiPlane","_resolutionRate","_shellSprite","DISPLAYED_INSTAGE","ACTIVE_INHIERARCHY","_ui3DMat","_uisprite","removeChildren","_resizeRT","prefab","_prefab","resolutionRate","billboard","enableHit","_addRenderElement","_setMaterialTexture","_rendertexure2D","RenderTexture2D","_invertY","_parseHit","_tempRay","_ray","TempMatrix","normalizeHitWidth","normalizeHitHeight","cx","cy","InputManager","inst","getSpriteUnderPoint","getUITexture","drawToTexture","_transByRotate","temp0","DEBUG","internalResources","registerLoader","task","AssetDb","getSubAssetURL","fetch","progress","createCallback","options","getBaseName","ext","ktxInfo","KTXTextureInfo","getKTXTextureInfo","dimension","TextureDimension","Cube","mipmapCount","setKTXData","obsoluteInst","move","byte","readUint8","mipCount","readUint16","wrapModev","mipSize","uint8Arrays","mipPixelLength","_getFormatByteCount","updateSubPixelsData","ltcBasePath","URL","getPath","urls","back","all","images","constructParams","_b","_a","srgb","setImageData","obsolute","_idResourcesMap","LoadModelV04","readData","_readData","_readString","arrayBuffer","__getBuffer","vertexBufferCount","vbStart","vbLength","vbArrayBuffer","vbDatas","bufferAttribute","ibStart","ibLength","ibDatas","boneCount","bindPoseDataStart","bindPoseDataLength","bindPoseDatas","bindPoseFloatCount","bindPoseBuffer","_inverseBindPosesBuffer","ArrayBuffer","inverseGlobalBindPose","ibCount","boneDicofs","boneDicCount","boneIndexCount","MorphTarget","MorphTargetChannel","getTargetByIndex","addTarget","MorphTargetData","channels","addMorphChannel","initData","targetNum","maxTexSize","getParams","RenderParams","MAX_Texture_Size","morphStride","elementCount","vertexElementCount","texHeight","texelStride","Texture2DArray","targetStride","targetIndex","dataOffset","elementIndex","elementOffset","targetDataOffset","newChannel","newTarget","LoadModelV05","vertexData","floatData","uint8Data","vertexFlag","subVertexFlags","subVertexCount","subOffset","verOffset","byteLength","morphVertexDecStr","targetName","readFloat32","bufferStart","readUint32","bufferLength","MeshReader","read","HierarchyParserV2","nodeData","outBatchSprites","props","childData","instanceID","interactMap","_createComponentInstance","componentsData","component","_createInteractInstance","interatMap","_parseInteractive","json","outBatchSprits","_createNodeByJson02","_createNodeByJson","clas","basePath","test","innerUrls","addInnerUrl","propertyParams","url2","lightmapColorData","lightmapDirectionData","reflectionTextureData","MATERIAL","skyboxMatData","parMeshPath","dataPath","TERRAINRES","clipPaths","shapes","HierarchyLoader","ShaderCompile","promises","loadAvatarMask","loadStates","_$uuid","getResURLByUUID","regClass","NativeBaseRenderNode","_geometryBounds","conchRenderNode","RenderElementBatch","_instanceBatchManager","_recoverList","recoverData","elementArray","enableStaticBatch","enableDynamicBatch","insManager","invertFrontFace","insBatchIndex","insOriElement","instanceelements","NativeBaseRenderQueue","isTransparent","conchRenderQueue","_batch","sortPass","_batchQueue","render_element","UploadMemoryManager","syncRenderMemory","NativeBounds","_extent","_boundBox","nativeMemory","NativeMemory","MemoryBlock_size","float32Array","float64Array","conchBounds","_buffer","ownMax","ownMin","calMax","calMin","TEMP_VECTOR3_MAX0","tempV1","TEMP_VECTOR3_MAX1","thisExtends","boundExtends","destBounds","NativeCameraCullInfo","conchCameraCullInfo","setPosition","_useOcclusionCulling","_staticMask","serialize","setPlane","setBoundFrustum","NativeCullPassBase","conchCullPass","_tempRenderList","customRenderList","_customCullList","IndexBuffer3D","IndexBuffer","indexType","BufferTargetType","ELEMENT_ARRAY_BUFFER","_indexType","_canRead","_indexTypeByteCount","_setIndexData","indexTypeByteCount","bufferOffset","dataStartIndex","dataCount","maxLength","NativeIndexBuffer3D","_conchIndexBuffer3D","conchIndexBuffer3D","setGLBuffer","_glBuffer","RenderElementType","UniformParamsMapType","NativeRenderElementOBJ","_shaderInstances","materialShaderData","renderShaderData","conchRenderElement","Base","NativeInstanceRenderElementOBJ","_vertexBuffer3D","_updateData","_updateNums","_conchVertexBuffer3D","Instance","NativeRenderContext3DOBJ","_scissor","conchRenderContext3D","_destTarget","_renderTarget","_confifShaderData","_globalShaderData","_sceneShaderData","_cameraShaderData","NativeRenderGeometryElementOBJ","conchRenderGeometryElement","drawParams","_nativeVertexArrayObject","NativeSceneRenderManager","_customUpdateList","conchSceneCullManger","NativeShadowCullInfo","conchShadowCullInfo","_cullPlanes","clearCullPlanes","addCullPlane","_cullSphere","setCullSphere","setDirection","_cullPlaneCount","NativeSkinRenderElementOBJ","Skin","NativeTransform3D","int32Array","eventDispatcher","conchTransform","getLocalPosition","setLocalPosition","getLocalRotation","setLocalRotation","getLocalScale","setLocalScale","getLocalRotationEuler","setLocalRotationEuler","getLocalMatrix","setLocalMatrix","getPosition","getRotation","setRotation","getRotationEuler","setRotationEuler","getWorldMatrix","setParent","hasListener","caller","listener","args","arguments","once","offAll","offAllCaller","VertexBuffer3D","VertexBuffer","ARRAY_BUFFER","_float32Reader","setDataLength","NativeVertexBuffer3D","conchVertexBuffer3D","setVertexDeclaration","serilizeVertexDeclaration","array","loc","_instanceBuffer","BaseRenderNode","BaseRenderQueue","_sortPass","_sort","CameraCullInfo","RenderElementOBJ","forceInvertFace","switchShader","switchUpdateMark","_uploadMark","uploadScene","_uploadScene","uploadUniforms","_sceneUniformParamsMap","uploadSprite3D","_uploadRender","_spriteUniformParamsMap","uploadCamera","_uploadCameraShaderValue","_cameraUniformParamsMap","uploadMaterial","_uploadMaterial","_materialUniformParamsMap","uploadRenderStateBlendDepth","uploadRenderStateFrontFace","drawGeometry","renderDrawContext","drawGeometryElement","InstanceRenderElementOBJ","_updateDataNum","updateNums","QuickSort","_quickSort","_partitionRenderObject","leftIndex","pivot","_compare","RenderContext3DOBJ","ShaderData","FastSinglelist","RenderGeometryElementOBJ","_glindexFormat","getIndexType","_glmode","getMeshTopology","SceneRenderManagerOBJ","_motionRenders","ShadowCullInfo","SkinRenderElementOBJ","subSkinnedDatas","uploadCustomUniform","drawElements","BoundsImpl","_updateFlag","outCen","outExt","WebGLRenderEngine3DFactory","queue","createSortPass","drayType","HitResult","succeeded","collider","hitFraction","LensFlareSettingsLoader","RandX","_state0U","_state0L","_state1U","_state1L","randomint","s1U","s1L","s0U","s0L","sumL","resU","resL","t1U","t1L","t2U","xU","xL","_CONVERTION_BUFFER","setUint32","getFloat64","DataView","defaultRand","Date","now","Physics3DUtils","COLLISIONFILTERGROUP_DEFAULTFILTER","COLLISIONFILTERGROUP_STATICFILTER","COLLISIONFILTERGROUP_KINEMATICFILTER","COLLISIONFILTERGROUP_DEBRISFILTER","COLLISIONFILTERGROUP_SENSORTRIGGER","COLLISIONFILTERGROUP_CHARACTERFILTER","COLLISIONFILTERGROUP_CUSTOMFILTER1","COLLISIONFILTERGROUP_CUSTOMFILTER2","COLLISIONFILTERGROUP_CUSTOMFILTER3","COLLISIONFILTERGROUP_CUSTOMFILTER4","COLLISIONFILTERGROUP_CUSTOMFILTER5","COLLISIONFILTERGROUP_CUSTOMFILTER6","COLLISIONFILTERGROUP_CUSTOMFILTER7","COLLISIONFILTERGROUP_CUSTOMFILTER8","COLLISIONFILTERGROUP_CUSTOMFILTER9","COLLISIONFILTERGROUP_CUSTOMFILTER10","COLLISIONFILTERGROUP_ALLFILTER","PHYSXDEFAULTMASKVALUE","Size","fullScreen","ECharacterCapable","EColliderCapable","EJointCapable","D6MotionType","D6Axis","D6Drive","WebXRRenderTexture","STENCIL_8","frameLoop","frameBuffer","_frameBuffer","gl","WebXRExperienceHelper","glInstance","bindFramebuffer","FRAMEBUFFER","_currentActive","WebXRSessionManager","currentTimestamp","defaultHeightCompensation","_sessionEnded","referenceSpace","_referenceSpace","newReferenceSpace","sessionMode","_sessionMode","exitXR","endXRRenderLoop","EVENT_MANAGER_END","initializeXRGL","xrSession","makeXRCompatible","initializeAsync","_xrNavigator","navigator","xr","reject","isSessionSupportedAsync","isSessionSupported","supportsSession","initializeSessionAsync","xrSessionMode","xrSessionInit","requestSession","session","addEventListener","resetReferenceSpace","baseReferenceSpace","runXRRenderLoop","requestAnimationFrame","timestamp","xrFrame","_updateByXrFrame","EVENT_FRAME_LOOP","_loop","currentFrame","setReferenceSpaceTypeAsync","referenceSpaceType","requestReferenceSpace","rejectionReason","heightCompensation","XRRigidTransform","getOffsetReferenceSpace","updateRenderStateAsync","baseLayer","_baseLayer","updateRenderState","currentFrameRate","frameRate","supportedFrameRates","updateTargetFrameRate","WebXRCameraManager","_referenceQuaternion","_referencedPosition","_firstFrame","_XRRenderTexture","_rigCameras","_webXRSessionManager","_updateFromXRSession","_updateReferenceSpace","newPosition","rotationQuaternion","rigCameras","pose","getViewerPose","orientation","views","_updateNumberOfRigCameras","currentRig","getViewport","framebufferWidth","framebufferHeight","framebuffer","cameraViewPort","cloneByArray","viewCount","xrcamera","WebXRCamera","removeChild","AxiGamepad","handness","axisData","axisLength","padGameAxi","axes","outPutStickValue","eventnam","EVENT_OUTPUT","eventname","ButtonGamepad","lastTouch","lastPress","lastPressValue","touch","press","pressValue","padButton","touched","pressed","touchEnter","touchStay","touchOut","pressEnter","pressStay","pressOut","outpressed","EVENT_TOUCH_ENTER","EVENT_TOUCH_STAY","EVENT_TOUCH_OUT","EVENT_PRESS_ENTER","EVENT_PRESS_STAY","EVENT_PRESS_OUT","EVENT_PRESS_VALUE","WebXRInput","preButtonEventList","preAxisEventList","_updateByXRPose","rayPose","getPose","_inputSource","targetRaySpace","_lastXRPose","tempQua","UnitZ","gripSpace","meshPose","EVENT_FRAMEUPDATA_WEBXRINPUT","_handleProcessGamepad","gamepad","gamepadAxis","gamepadButton","buttons","addButtonEvent","addAxisEvent","offAxisEvent","offButtonEvent","HANDNESS_LEFT","HANDNESS_RIGHT","WebXRInputManager","webxrManager","webXRCamera","controllers","controllerHandMesh","controllerLineRender","lineColor","RED","rayLength","webXRSessionManager","webXRCameraManager","_updateFromXRFrame","_updataMeshRender","xrInput","meshNode","tempVec1","refSpace","inputSource","inputSources","handedness","getController","bindMeshNode","meshSprite","bindRayNode","lineSprite","xr_Manager","supported","cameraInfo","depthFar","depthNear","XRWebGLLayer","sessionManager","cameraManager","canvasOptions","antialias","stencil","alpha","multiview","framebufferScaleFactor","_clientWidth","_clientHeight","_restoreView","RenderStateContext","setDepthMask","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","Script3D","Script","HLODRender","curHLODRS","_curHLODRS","_changeMesh","HLODMesh","_createRenderelementByHLODElement","lodMesh","meshDefines","batchMesh","_curSubBatchMeshBounds","batchSubMeshInfo","lightmap","hodMesh","drawSubMeshs","lodbatchMesh","onEnable","onDisable","HLOD","lodResource","_resourceList","_applyLODResource","resource","_curLODSource","hlodRender","_curRender","_releaseGroupRender","applyResource","loaded","StaticBatchSubInfo","needRender","StaticBatchSubMesh","subInfos","addSubMesh","info","centerA","distanceA","centerB","indexByteCount","tempMatrix","TriangleIndices","InvertTriangleIndices","StaticBatchMesh","_staticSubMeshes","staticMesh","vertexFloatArray","mergeIndexFormat","mergeIndexByteCount","vertexDataOffset","vertexCountOffset","sp","invertFront","normalMat","transpose","meshIndexCount","meshVertexData","transformVector3ArrayToVector3ArrayCoordinate","transformVector3ArrayToVector3ArrayNormal","transformLightingMapTexcoordArray","meshIndexData","triangleIndices","staticSubMesh","submesh","StaticBatchMeshRenderElement","StaticBatchMeshRender","mergeInfo","_staticMesh","_mergeInfo","meshDef","StaticMeshMergeInfo","match","addElement","TransLargeUBOUtils","UBO","defautSubData","currentlength","bindUBO","defaultSubData","_reset","configStartLength","subDataParamMap","maxlength","subDataMap","pool","reset","subdata","SubUniformBufferData","subModuleData","addStep","setDataByByUniformBufferDataOffset","updateBindRange","bytelenth","_bindBufferRange","_vec2","_hitResult","getSprite3DUnderPoint","pageX","_stage","pageY","normalWidth","Render","_mainCanvas","normalHeight","sim","uiManager","cameras","GradientDataVector2","destGradientDataVector2","MaterialInstanceProperty","_isNeedUpdate","createInstanceVertexBuffer3D","_instanceData","instanceData","dataValue","datalength","updateType","writeTo","InstanceLocation","MaterialInstancePropertyBlock","_checkPropertyLegal","vertexElementFormat","attributeLocation","prob","_creatProperty","attributeName","arrays","vertexformat","setVectorArray","setVector3Array","setVector2Array","setNumberArray","getPropertyArray","INSTANCETYPE_ATTRIBUTE","INSTANCETYPE_UNIFORMBUFFER","playstate","_lastUpdateFrame","_updateFrame","_isTrigger","contacts","_setUpdateFrame","farme","_idCounter","_colliderA","_colliderB","positionOnA","positionOnB","_batchSubMeshInfos","_drawSubMeshs","drawPramas","_lightmap","callFun","hlod","Laya","Handler","conchQuickSort","vs","ps","_shaderPass","pConchAttributeMap","conchAttributeMap","setAttributeValue","stateMap","setStateValue","conchShaderInstance","shaderUniform","shaderDatas","uploadUnTexture","uploadCustomUniforms","isTarget","pixelLineRenderer","meshVertexDecSet","Set","combine","haveMatch","staticRenders","text","_text","fontSize","_fontSize"],"sources":["../../src/layaAir/laya/d3/depthMap/DepthCasterData.ts","../../src/layaAir/laya/d3/depthMap/DepthPass.ts","../../src/layaAir/laya/d3/core/Keyframe.ts","../../src/layaAir/laya/d3/component/Animator/KeyframeNodeOwner.ts","../../src/layaAir/laya/d3/animation/KeyframeNode.ts","../../src/layaAir/laya/d3/animation/AnimationEvent.ts","../../src/layaAir/laya/d3/core/FloatKeyframe.ts","../../src/layaAir/laya/d3/core/QuaternionKeyframe.ts","../../src/layaAir/laya/d3/core/Vector3Keyframe.ts","../../src/layaAir/laya/d3/animation/AnimationClipParser03.ts","../../src/layaAir/laya/d3/core/Vector2Keyframe.ts","../../src/layaAir/laya/d3/core/Vector4Keyframe.ts","../../src/layaAir/laya/d3/animation/AnimationClipParser04.ts","../../src/layaAir/laya/d3/animation/KeyframeNodeList.ts","../../src/layaAir/laya/d3/resource/TextureGenerator.ts","../../src/layaAir/laya/d3/utils/Utils3D.ts","../../src/layaAir/laya/d3/animation/AnimationClip.ts","../../src/layaAir/laya/d3/RenderObjs/Laya3DRender.ts","../../src/layaAir/laya/d3/core/Sprite3D.ts","../../src/layaAir/laya/d3/math/BoundFrustum.ts","../../src/layaAir/laya/d3/component/Volume/Volume.ts","../../src/layaAir/laya/d3/core/scene/AmbientMode.ts","../../src/layaAir/laya/d3/component/Volume/reflectionProbe/ReflectionProbe.ts","../../src/layaAir/laya/d3/core/render/BaseRender.ts","../../src/layaAir/laya/d3/core/light/ShadowMode.ts","../../src/layaAir/laya/d3/core/light/ShadowCascadesMode.ts","../../src/layaAir/laya/d3/core/light/Light.ts","../../src/layaAir/laya/d3/core/light/ShadowUtils.ts","../../src/layaAir/laya/d3/shadowMap/ShadowLightType.ts","../../src/layaAir/ILaya3D.ts","../../src/layaAir/laya/d3/graphics/renderPath/Cluster.ts","../../src/layaAir/laya/d3/math/Plane.ts","../../src/layaAir/laya/d3/math/Ray.ts","../../src/layaAir/laya/d3/math/ContainmentType.ts","../../src/layaAir/laya/d3/math/CollisionUtils.ts","../../src/layaAir/laya/d3/math/Viewport.ts","../../src/layaAir/laya/d3/utils/Picker.ts","../../src/layaAir/laya/d3/core/RenderableSprite3D.ts","../../src/layaAir/laya/d3/core/scene/Lightmap.ts","../../src/layaAir/laya/d3/core/MeshSprite3DShaderDeclaration.ts","../../src/layaAir/laya/d3/math/Bounds.ts","../../src/layaAir/laya/d3/component/Volume/reflectionProbe/ReflectionProbeManager.ts","../../src/layaAir/laya/d3/core/render/Sprite3DRenderDeclaration.ts","../../src/layaAir/laya/d3/component/Volume/VolumetricGI/VolumetricGIManager.ts","../../src/layaAir/laya/d3/component/Volume/VolumeManager.ts","../../src/layaAir/laya/d3/graphics/SphericalHarmonicsL2.ts","../../src/layaAir/laya/d3/core/render/RenderElement.ts","../../src/layaAir/laya/d3/core/GeometryElement.ts","../../src/layaAir/laya/d3/resource/models/SkyBox.ts","../../src/layaAir/laya/d3/graphics/Vertex/VertexPositionTexture0.ts","../../src/layaAir/laya/d3/resource/models/SkyDome.ts","../../src/layaAir/laya/d3/resource/models/SkyRenderer.ts","../../src/layaAir/laya/d3/core/BaseCamera.ts","../../src/layaAir/laya/d3/core/render/RenderContext3D.ts","../../src/layaAir/laya/d3/core/render/ScreenQuad.ts","../../src/layaAir/laya/d3/core/render/command/Command.ts","../../src/layaAir/laya/d3/core/render/command/BlitScreenQuadCMD.ts","../../src/layaAir/laya/d3/core/render/command/SetRenderTargetCMD.ts","../../src/layaAir/laya/d3/core/render/command/SetShaderDataCMD.ts","../../src/layaAir/laya/d3/core/material/BlinnPhongMaterial.ts","../../src/layaAir/laya/d3/core/MeshFilter.ts","../../src/layaAir/laya/d3/core/render/SubMeshRenderElement.ts","../../src/layaAir/laya/d3/resource/models/MeshUtil.ts","../../src/layaAir/laya/d3/core/MeshRenderer.ts","../../src/layaAir/laya/d3/core/render/command/DrawMeshCMD.ts","../../src/layaAir/laya/d3/core/render/command/ClearRenderTextureCMD.ts","../../src/layaAir/laya/d3/core/render/command/DrawRenderCMD.ts","../../src/layaAir/laya/d3/core/render/command/SetGlobalShaderDataCMD.ts","../../src/layaAir/laya/d3/graphics/MeshInstanceGeometry.ts","../../src/layaAir/laya/d3/core/render/command/DrawMeshInstancedCMD.ts","../../src/layaAir/laya/d3/core/render/command/CommandBuffer.ts","../../src/layaAir/laya/d3/physics/PhysicsSettings.ts","../../src/layaAir/laya/d3/core/light/LightQueue.ts","../../src/layaAir/laya/d3/core/scene/Scene3DShaderDeclaration.ts","../../src/layaAir/laya/d3/math/BoundSphere.ts","../../src/layaAir/laya/d3/shadowMap/ShadowSliceData.ts","../../src/layaAir/laya/d3/graphics/FrustumCulling.ts","../../src/layaAir/laya/d3/shadowMap/ShadowCasterPass.ts","../../src/layaAir/laya/d3/core/render/command/BlitFrameBufferCMD.ts","../../src/layaAir/laya/d3/core/scene/SceneRenderManager.ts","../../src/layaAir/laya/d3/core/UI3D/UI3DManager.ts","../../src/layaAir/laya/d3/core/scene/bvh/SpatialManager.ts","../../src/layaAir/laya/d3/core/scene/bvh/BVHSpatialBox.ts","../../src/layaAir/laya/d3/core/scene/bvh/BVHSpatial.ts","../../src/layaAir/laya/d3/core/scene/BVHSceneRenderManager/BVHRenderSpatialBox.ts","../../src/layaAir/laya/d3/core/scene/BVHSceneRenderManager/BVHRenderSpatial.ts","../../src/layaAir/laya/d3/core/scene/BVHSceneRenderManager/BVHSceneRenderManager.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/CullPass.ts","../../src/layaAir/laya/d3/core/scene/BVHSceneRenderManager/BVHCullPass.ts","../../src/layaAir/laya/d3/core/render/PostProcessRenderContext.ts","../../src/layaAir/laya/d3/core/render/PostProcessEffect.ts","../../bin/tsc/layaAir/laya/d3/shader/postprocess/BlitScreen.vs","../../src/layaAir/laya/d3/core/render/PostEffect/ColorGradEffect.ts","../../src/layaAir/laya/d3/core/material/PBRRenderQuality.ts","../../bin/tsc/layaAir/laya/d3/shader/postprocess/BlitLUTScreen.fs","../../src/layaAir/laya/d3/component/PostProcess.ts","../../src/layaAir/laya/d3/shader/pbr/PBRDefaultDFG.ts","../../src/layaAir/laya/d3/shader/pbr/PBRShaderLib.ts","../../bin/tsc/layaAir/laya/d3/shader/pbr/BRDF.glsl","../../bin/tsc/layaAir/laya/d3/shader/pbr/pbrGI.glsl","../../bin/tsc/layaAir/laya/d3/shader/pbr/pbrCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/pbr/pbrVertex.glsl","../../bin/tsc/layaAir/laya/d3/shader/pbr/pbrFrag.glsl","../../bin/tsc/layaAir/laya/d3/shader/pbr/pbrMetallicFrag.glsl","../../src/layaAir/laya/d3/core/material/PBRMaterial.ts","../../src/layaAir/laya/d3/core/material/PBRStandardMaterial.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/shape/BaseShape.ts","../../src/layaAir/laya/d3/core/trail/TrailAlignment.ts","../../src/layaAir/laya/Physics3D/physicsEnum/EPhycisCapable.ts","../../src/layaAir/laya/d3/core/material/SkyBoxMaterial.ts","../../src/layaAir/laya/d3/core/material/SkyProceduralMaterial.ts","../../src/layaAir/laya/d3/core/material/UnlitMaterial.ts","../../src/layaAir/laya/d3/core/MeshSprite3D.ts","../../src/layaAir/laya/d3/core/GradientMode.ts","../../src/layaAir/laya/d3/core/Gradient.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/Burst.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/GradientColor.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/ColorOverLifetime.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/FrameOverTime.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/GradientAngularVelocity.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/GradientDataInt.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/GradientDataNumber.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/GradientSize.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/GradientVelocity.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/RotationOverLifetime.ts","../../src/layaAir/laya/d3/math/BoundBox.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/shape/ShapeUtils.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/shape/BoxShape.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/shape/CircleShape.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/shape/ConeShape.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/shape/HemisphereShape.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/shape/SphereShape.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/SizeOverLifetime.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/StartFrame.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/TextureSheetAnimation.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/VelocityOverLifetime.ts","../../src/layaAir/laya/d3/graphics/Vertex/VertexShuriKenParticle.ts","../../src/layaAir/laya/d3/graphics/Vertex/VertexShurikenParticleBillboard.ts","../../src/layaAir/laya/d3/graphics/Vertex/VertexShurikenParticleMesh.ts","../../src/layaAir/laya/d3/math/Rand.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/Emission.ts","../../src/layaAir/laya/d3/core/particleShuriKen/ShuriKenParticle3DShaderDeclaration.ts","../../src/layaAir/laya/d3/core/particleShuriKen/ShurikenParticleData.ts","../../src/layaAir/laya/d3/core/particleShuriKen/ShurikenParticleSystem.ts","../../src/layaAir/laya/d3/core/particleShuriKen/ShurikenParticleInstanceSystem.ts","../../src/layaAir/laya/d3/core/particleShuriKen/ShurikenParticleMaterial.ts","../../src/layaAir/laya/d3/core/particleShuriKen/ShurikenParticleRenderer.ts","../../src/layaAir/laya/d3/core/particleShuriKen/ShuriKenParticle3D.ts","../../src/layaAir/laya/d3/core/pixelLine/PixelLineVertex.ts","../../src/layaAir/laya/d3/core/Transform3D.ts","../../src/layaAir/laya/d3/core/SkinnedMeshSprite3DShaderDeclaration.ts","../../src/layaAir/laya/d3/core/render/SkinRenderElement.ts","../../src/layaAir/laya/d3/core/SkinnedMeshRenderer.ts","../../src/layaAir/laya/d3/core/SkinnedMeshSprite3D.ts","../../src/layaAir/laya/d3/core/trail/TrailMaterial.ts","../../src/layaAir/laya/d3/core/TrailTextureMode.ts","../../src/layaAir/laya/d3/core/trail/VertexTrail.ts","../../src/layaAir/laya/d3/core/trail/TrailGeometry.ts","../../src/layaAir/laya/d3/core/trail/TrailFilter.ts","../../src/layaAir/laya/d3/core/trail/TrailRenderer.ts","../../src/layaAir/laya/d3/core/trail/TrailSprite3D.ts","../../src/layaAir/laya/d3/graphics/SubMeshInstanceBatch.ts","../../src/layaAir/laya/d3/graphics/Vertex/VertexPositionTerrain.ts","../../src/layaAir/laya/d3/core/render/InstanceRenderElement.ts","../../src/layaAir/laya/d3/resource/models/SubMesh.ts","../../src/layaAir/laya/d3/resource/models/Mesh.ts","../../src/layaAir/laya/d3/resource/models/PrimitiveMesh.ts","../../bin/tsc/layaAir/laya/d3/shader/utils/Utils.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/BlitScreen.fs","../../src/layaAir/laya/d3/shader/postprocess/BlitScreenShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/postprocess/FastApproximateAntiAliasing.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ColorGrading.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/Tonemapping.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/LUT.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/LUTBuilder.fs","../../bin/tsc/layaAir/laya/d3/shader/unlit/Unlit.vs","../../bin/tsc/layaAir/laya/d3/shader/depth/Depth.vs","../../bin/tsc/layaAir/laya/d3/shader/depth/Depth.fs","../../src/layaAir/laya/d3/shader/unlit/UnlitShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/unlit/Unlit.fs","../../src/layaAir/laya/d3/shader/blinnphong/BlinnPhongShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/blinnphong/BlinnPhongCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/blinnphong/BlinnPhongVertex.glsl","../../bin/tsc/layaAir/laya/d3/shader/blinnphong/BlinnPhongFrag.glsl","../../bin/tsc/layaAir/laya/d3/shader/blinnphong/BlinnPhong.vs","../../bin/tsc/layaAir/laya/d3/shader/blinnphong/BlinnPhong.fs","../../bin/tsc/layaAir/laya/d3/shader/blinnphong/BlinnPhongDepthNormal.vs","../../bin/tsc/layaAir/laya/d3/shader/blinnphong/BlinnPhongDepthNormal.fs","../../src/layaAir/laya/d3/shader/Trail/TrailShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/Trail/Trail.vs","../../bin/tsc/layaAir/laya/d3/shader/Trail/Trail.fs","../../src/layaAir/laya/d3/shader/pbr/PBRStandardShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/pbr/pbrStandard.vs","../../bin/tsc/layaAir/laya/d3/shader/pbr/pbrStandard.fs","../../bin/tsc/layaAir/laya/d3/shader/pbr/PBRStandardDepthNormal.vs","../../bin/tsc/layaAir/laya/d3/shader/pbr/PBRStandardDepthNormal.fs","../../src/layaAir/laya/d3/shader/sky/SkyBoxShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/sky/SkyBox.vs","../../bin/tsc/layaAir/laya/d3/shader/sky/SkyBox.fs","../../src/layaAir/laya/d3/shader/ShurikenParticle/ParticleShuriKenShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/ShurikenParticle/MathGradient.glsl","../../bin/tsc/layaAir/laya/d3/shader/ShurikenParticle/particleShuriKenSpriteVS.glsl","../../bin/tsc/layaAir/laya/d3/shader/ShurikenParticle/particleShuriKen.vs","../../bin/tsc/layaAir/laya/d3/shader/ShurikenParticle/particleShuriKen.fs","../../src/layaAir/laya/d3/shader/sky/SkyProceduralShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/sky/SkyProceduralShader.vs","../../bin/tsc/layaAir/laya/d3/shader/sky/SkyProceduralShader.fs","../../src/layaAir/laya/d3/shader/sky/SkyPanoramicShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/sky/SkyPanoramic.vs","../../bin/tsc/layaAir/laya/d3/shader/sky/SkyPanoramic.fs","../../src/layaAir/laya/d3/shader/postprocess/ACES/ACESShaderLib.ts","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/lib/UtillitiesColor.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/lib/TransformCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/lib/Tonescales.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/lib/RRTCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/lib/ODTCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/rrt/RRT.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/odt/ODT_sRGB_100nits.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/ACES.glsl","../../src/layaAir/laya/d3/shader/ShaderInit3D.ts","../../bin/tsc/layaAir/laya/d3/shader/utils/Color.glsl","../../bin/tsc/layaAir/laya/d3/shader/utils/Math.glsl","../../bin/tsc/layaAir/laya/d3/shader/utils/BakedBoneMatrixSampler.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/MorphTarget.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/VertexCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/ShadingCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/ShadingVertex.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/ShadingFrag.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/OutputTransform.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/SceneCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/CameraCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/Sprite3DCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/Sprite3DVertex.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/Sprite3DFrag.glsl","../../bin/tsc/layaAir/laya/d3/shader/depth/DepthVertex.glsl","../../bin/tsc/layaAir/laya/d3/shader/depth/DepthFrag.glsl","../../bin/tsc/layaAir/laya/d3/shader/depth/DepthNormalUtil.glsl","../../bin/tsc/layaAir/laya/d3/shader/depth/DepthNormalFrag.glsl","../../bin/tsc/layaAir/laya/d3/shader/utils/SceneFog.glsl","../../bin/tsc/layaAir/laya/d3/shader/utils/SceneFogInput.glsl","../../bin/tsc/layaAir/laya/d3/shader/lighting/ShadowSampleTent.glsl","../../bin/tsc/layaAir/laya/d3/shader/lighting/ShadowSampler.glsl","../../bin/tsc/layaAir/laya/d3/shader/lighting/Lighting.glsl","../../bin/tsc/layaAir/laya/d3/shader/lighting/globalIllumination.glsl","../../bin/tsc/layaAir/laya/d3/shader/lighting/volumetricGI/Oct.glsl","../../bin/tsc/layaAir/laya/d3/shader/lighting/volumetricGI/GridHelpers.glsl","../../bin/tsc/layaAir/laya/d3/shader/lighting/volumetricGI/VolumetricGI.glsl","../../bin/tsc/layaAir/laya/d3/shader/lightingmode/BlinnPhongLighting.glsl","../../bin/tsc/layaAir/laya/d3/shader/lightingmode/PBRLighting.glsl","../../src/layaAir/laya/d3/core/SimpleSkinnedMeshRenderer.ts","../../src/layaAir/laya/d3/core/SimpleSkinnedMeshSprite3D.ts","../../src/layaAir/laya/d3/core/material/SkyPanoramicMaterial.ts","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/Bloom.vs","../../src/layaAir/laya/d3/core/render/PostEffect/BloomEffect.ts","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/StdLib.glsl","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Colors.glsl","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Sampling.glsl","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/BloomPrefilter13.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/BloomPrefilter4.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/BloomDownsample13.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/BloomDownsample4.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/BloomUpsampleTent.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/BloomUpsampleBox.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/Composite.vs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/Composite.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/ScalableAO/FragAO.fs","../../src/layaAir/laya/d3/core/render/PostEffect/ScalableAO.ts","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/ScalableAO/AmbientOcclusion.glsl","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/ScalableAO/AoBlurHorizontal.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/ScalableAO/AOComposition.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/GaussianDoF/FullScreenVert.vs","../../src/layaAir/laya/d3/core/render/PostEffect/GaussianDoF.ts","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/GaussianDoF/CoC.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/GaussianDoF/Prefilter.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/GaussianDoF/BlurH.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/GaussianDoF/BlurV.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/GaussianDoF/Composite.fs","../../src/layaAir/laya/d3/core/render/PostEffect/LensFlares/LensFlareGeometry.ts","../../src/layaAir/laya/d3/core/render/PostEffect/LensFlares/LensFlareCMD.ts","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/LensFlare/LensFlare.vs","../../src/layaAir/laya/d3/core/scene/Scene3D.ts","../../src/layaAir/laya/d3/core/Camera.ts","../../src/layaAir/laya/d3/core/light/AreaLightCom.ts","../../src/layaAir/laya/d3/core/render/PostEffect/LensFlares/LensFlareShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/LensFlare/LensFlare.fs","../../src/layaAir/laya/d3/core/render/PostEffect/LensFlares/LensFlareEffect.ts","../../src/layaAir/Laya3D.ts","../../src/layaAir/laya/d3/core/light/DirectionLightCom.ts","../../src/layaAir/laya/d3/core/light/LightSprite.ts","../../src/layaAir/laya/d3/core/light/DirectionLight.ts","../../src/layaAir/laya/d3/core/light/PointLightCom.ts","../../src/layaAir/laya/d3/core/light/PointLight.ts","../../src/layaAir/laya/d3/core/light/SpotLightCom.ts","../../src/layaAir/laya/d3/core/light/SpotLight.ts","../../src/layaAir/laya/d3/core/material/EffectMaterial.ts","../../src/layaAir/laya/d3/core/material/ExtendTerrainMaterial.ts","../../src/layaAir/laya/d3/core/material/WaterPrimaryMaterial.ts","../../src/layaAir/laya/d3/component/Volume/VolumetricGI/VolumetricGI.ts","../../src/layaAir/laya/d3/component/LODGroup.ts","../../src/layaAir/laya/d3/core/pixelLine/PixelLineData.ts","../../src/layaAir/laya/d3/core/pixelLine/PixelLineFilter.ts","../../src/layaAir/laya/d3/core/pixelLine/PixelLineMaterial.ts","../../src/layaAir/laya/d3/core/pixelLine/PixelLineRenderer.ts","../../src/layaAir/laya/d3/component/Animator/AnimatorPlayState.ts","../../src/layaAir/laya/d3/component/Animator/AnimatorControllerLayer.ts","../../src/layaAir/laya/d3/component/Animator/AnimatorResource.ts","../../src/layaAir/laya/d3/component/Animator/AnimatorState.ts","../../src/layaAir/laya/d3/component/Animator/AvatarMask.ts","../../src/layaAir/laya/d3/component/Animator/Animator.ts","../../src/layaAir/laya/d3/component/Animator/AnimatorTransition.ts","../../src/layaAir/laya/d3/component/Animator/AnimatorController.ts","../../src/layaAir/laya/d3/core/render/BatchMark.ts","../../src/layaAir/laya/d3/graphics/Batch/InstanceBatchManager.ts","../../src/layaAir/laya/d3/component/Volume/BatchVolume/BatchRender.ts","../../src/layaAir/laya/d3/component/Volume/BatchVolume/StaticInstanceBatchRender.ts","../../src/layaAir/laya/d3/component/Volume/BatchVolume/StatiVertexMergeBatchRender.ts","../../src/layaAir/laya/d3/component/Volume/BatchVolume/StaticBatchVolume.ts","../../src/layaAir/laya/d3/core/UI3D/UI3DGeometry.ts","../../src/layaAir/laya/d3/core/UI3D/UI3D.ts","../../src/layaAir/laya/d3/loaders/CubemapLoader.ts","../../src/layaAir/laya/d3/loaders/AnimationClipLoader.ts","../../src/layaAir/laya/d3/loaders/LoadModelV04.ts","../../src/layaAir/laya/d3/resource/models/MorphTarget.ts","../../src/layaAir/laya/d3/resource/models/MorphTargetData.ts","../../src/layaAir/laya/d3/loaders/LoadModelV05.ts","../../src/layaAir/laya/d3/loaders/MeshReader.ts","../../src/layaAir/laya/d3/loaders/MeshLoader.ts","../../src/layaAir/laya/d3/loaders/HierarchyParserV2.ts","../../src/layaAir/laya/d3/loaders/AvatarMaskLoader.ts","../../src/layaAir/laya/d3/loaders/GLSLLoader.ts","../../src/layaAir/laya/d3/loaders/AnimationControllerLoader.ts","../../src/layaAir/laya/d3/ModuleDef.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeBaseRenderNode.ts","../../src/layaAir/laya/d3/graphics/Batch/RenderElementBatch.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeBaseRenderQueue.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeBounds.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeCameraCullInfo.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeCullPass.ts","../../src/layaAir/laya/d3/graphics/IndexBuffer3D.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeIndexBuffer3D.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeRenderElementOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeShaderInstance.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeInstanceRenderElementOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeRenderContext3DOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeRenderGeometryElementOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeSceneRenderManager.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeShadowCullInfo.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeSkinRenderElementOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeTransform3D.ts","../../src/layaAir/laya/d3/graphics/VertexBuffer3D.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeVertexBuffer3D.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/BaseRenderNode.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/BaseRenderQueue.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/CameraCullInfo.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/RenderElementOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/InstanceRenderElementOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/QuickSort.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/RenderContext3DOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/RenderGeometryElementOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/SceneRenderManagerOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/ShadowCullInfo.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/SkinRenderElementOBJ.ts","../../src/layaAir/laya/d3/math/BoundsImpl.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/WebGLRenderEngine3DFactory.ts","../../src/layaAir/laya/d3/physics/HitResult.ts","../../src/layaAir/laya/d3/loaders/LensFlareSettingsLoader.ts","../../src/layaAir/laya/d3/math/RandX.ts","../../src/layaAir/laya/d3/utils/Physics3DUtils.ts","../../src/layaAir/laya/d3/utils/Size.ts","../../src/layaAir/laya/Physics3D/physicsEnum/ECharacterCapable.ts","../../src/layaAir/laya/Physics3D/physicsEnum/EColliderCapable.ts","../../src/layaAir/laya/Physics3D/physicsEnum/EJointCapable.ts","../../src/layaAir/laya/Physics3D/interface/Joint/ID6Joint.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRRenderTexture.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRSessionManager.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRCameraManager.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRGamepad.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRInput.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRInputManager.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRExperienceHelper.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRCamera.ts","../../src/layaAir/laya/d3/component/Script3D.ts","../../src/layaAir/laya/d3/component/HLOD/HLODRender.ts","../../src/layaAir/laya/d3/component/HLOD/HLOD.ts","../../src/layaAir/laya/d3/component/staticmesh/StaticBatchSubMesh.ts","../../src/layaAir/laya/d3/component/staticmesh/StaticBatchMesh.ts","../../src/layaAir/laya/d3/component/staticmesh/StaticBatchMeshRenderElement.ts","../../src/layaAir/laya/d3/component/staticmesh/StaticBatchMeshRender.ts","../../src/layaAir/laya/d3/component/staticmesh/StaticMeshMergeInfo.ts","../../src/layaAir/laya/d3/core/TransLargeUBOUtils.ts","../../src/layaAir/laya/d3/core/scene/Input3D.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/GradientDataVector2.ts","../../src/layaAir/laya/d3/core/render/command/MaterialInstanceProperty.ts","../../src/layaAir/laya/d3/core/render/command/MaterialInstancePropertyBlock.ts","../../src/layaAir/laya/d3/animation/AnimatorStateScript.ts","../../src/layaAir/laya/d3/physics/Collision.ts","../../src/layaAir/laya/d3/physics/ContactPoint.ts","../../src/layaAir/laya/d3/component/HLOD/HLODBatchMesh.ts","../../src/layaAir/laya/d3/component/HLOD/HLODUtil.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeGLRenderEngine3DOBJFactory.ts","../../src/layaAir/laya/d3/core/pixelLine/PixelLineSprite3D.ts","../../src/layaAir/laya/d3/component/staticmesh/StaticMeshBatchManager.ts","../../src/layaAir/laya/d3/text/TextMesh.ts"],"sourcesContent":["import { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { UniformBufferParamsType, UnifromBufferData } from \"../../RenderEngine/UniformBufferData\";\r\n\r\nexport class DepthCasterData{\r\n    static DepthCasterUBOData: UnifromBufferData;\r\n    /**\r\n     * create DepthCaster UniformBuffer\r\n     * @internal\r\n     * @returns \r\n     */\r\n    static createDepthCasterUniformBlock(): UnifromBufferData {\r\n\r\n        if (!DepthCasterData.DepthCasterUBOData) {\r\n            let uniformpara = new Map<number, UniformBufferParamsType>();\r\n            uniformpara.set(Shader3D.propertyNameToID(\"u_ShadowBias\"), UniformBufferParamsType.Vector4);\r\n            uniformpara.set(Shader3D.propertyNameToID(\"u_ShadowLightDirection\"), UniformBufferParamsType.Vector3);\r\n            DepthCasterData.DepthCasterUBOData = new UnifromBufferData(uniformpara);\r\n        }\r\n\r\n        return DepthCasterData.DepthCasterUBOData;\r\n    }\r\n}","import { Config3D } from \"../../../Config3D\";\r\nimport { Camera } from \"../core/Camera\";\r\nimport { RenderContext3D } from \"../core/render/RenderContext3D\";\r\nimport { RenderTargetFormat } from \"../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { UnifromBufferData } from \"../../RenderEngine/UniformBufferData\";\r\nimport { UniformBufferObject } from \"../../RenderEngine/UniformBufferObject\";\r\nimport { Viewport } from \"../math/Viewport\";\r\nimport { RenderClearFlag } from \"../../RenderEngine/RenderEnum/RenderClearFlag\";\r\nimport { BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { Stat } from \"../../utils/Stat\";\r\nimport { DepthCasterData } from \"./DepthCasterData\";\r\nimport { Color } from \"../../maths/Color\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../resource/RenderTexture\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\n\r\n\r\n/**\r\n * \r\n */\r\nexport enum DepthTextureMode {\r\n    /** */\r\n    None = 0,\r\n    /** */\r\n    Depth = 1,\r\n    /**+ */\r\n    DepthNormals = 2,\r\n    /**  TODO*/\r\n    DepthAndDepthNormals = 3,\r\n    MotionVectors = 4,\r\n}\r\n/**\r\n * <code>ShadowCasterPass</code> \r\n */\r\nexport class DepthPass {\r\n    private static SHADOW_BIAS: Vector4 = new Vector4();\r\n    /** @internal */\r\n    static DEPTHPASS: ShaderDefine;\r\n    /** @internal */\r\n    static DEFINE_SHADOW_BIAS: number;\r\n    /**@internal */\r\n    static DEPTHTEXTURE: number;\r\n    /**@internal */\r\n    static DEPTHNORMALSTEXTURE: number;\r\n    /**@internal */\r\n    static DEPTHZBUFFERPARAMS: number;\r\n    /**@internal */\r\n    static SHADOWUNIFORMBLOCK: number;\r\n\r\n\r\n    static __init__() {\r\n        DepthPass.DEPTHPASS = Shader3D.getDefineByName(\"DEPTHPASS\");\r\n        DepthPass.DEFINE_SHADOW_BIAS = Shader3D.propertyNameToID(\"u_ShadowBias\");\r\n        DepthPass.DEPTHTEXTURE = Shader3D.propertyNameToID(\"u_CameraDepthTexture\");\r\n        DepthPass.DEPTHNORMALSTEXTURE = Shader3D.propertyNameToID(\"u_CameraDepthNormalsTexture\");\r\n        DepthPass.DEPTHZBUFFERPARAMS = Shader3D.propertyNameToID(\"u_ZBufferParams\");\r\n        DepthPass.SHADOWUNIFORMBLOCK = Shader3D.propertyNameToID(UniformBufferObject.UBONAME_SHADOW);\r\n    }\r\n\r\n    /**@internal */\r\n    private _depthTexture: RenderTexture;\r\n    /**@internal */\r\n    private _depthNormalsTexture: RenderTexture;\r\n    /**@internal */\r\n    private _viewPort: Viewport;\r\n    /**@internal */\r\n    private _camera: Camera;\r\n    /** @internal */\r\n    private _castDepthData: UnifromBufferData;\r\n    /** @internal */\r\n    private _castDepthUBO: UniformBufferObject;\r\n    /**@internal */\r\n    //private _castDepthBuffer:\r\n    private _defaultNormalDepthColor = new Color(0.5, 0.5, 1.0, 0.0);\r\n    // Values used to linearize the Z buffer (http://www.humus.name/temp/Linearize%20depth.txt)\r\n    // x = 1-far/near\r\n    // y = far/near\r\n    // z = x/far\r\n    // w = y/far\r\n    // or in case of a reversed depth buffer (UNITY_REVERSED_Z is 1)\r\n    // x = -1+far/near\r\n    // y = 1\r\n    // z = x/far\r\n    // w = 1/far\r\n    /**@internal */\r\n    private _zBufferParams: Vector4 = new Vector4();\r\n\r\n    constructor() {\r\n        if (Config3D._uniformBlock) {\r\n            this._castDepthData = DepthCasterData.createDepthCasterUniformBlock();\r\n            this._castDepthUBO = UniformBufferObject.getBuffer(UniformBufferObject.UBONAME_SHADOW, 0);\r\n            if (!this._castDepthUBO) {\r\n                this._castDepthUBO = UniformBufferObject.create(UniformBufferObject.UBONAME_SHADOW, BufferUsage.Dynamic, this._castDepthData.getbyteLength(), true);\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param camera \r\n     * @param depthType \r\n     */\r\n    update(camera: Camera, depthType: DepthTextureMode, depthTextureFormat: RenderTargetFormat): void {\r\n        this._viewPort = camera.viewport;\r\n        this._camera = camera;\r\n        switch (depthType) {\r\n            case DepthTextureMode.Depth:\r\n                camera.depthTexture = this._depthTexture = RenderTexture.createFromPool(this._viewPort.width, this._viewPort.height, depthTextureFormat, RenderTargetFormat.None, false, 1);\r\n                break;\r\n            case DepthTextureMode.DepthNormals:\r\n                camera.depthNormalTexture = this._depthNormalsTexture = RenderTexture.createFromPool(this._viewPort.width, this._viewPort.height, RenderTargetFormat.R8G8B8A8, depthTextureFormat, false, 1);\r\n                break;\r\n            case DepthTextureMode.MotionVectors:\r\n                //TODO\r\n                break;\r\n            default:\r\n                throw (\"there is UnDefined type of DepthTextureMode\")\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param context \r\n     * @param depthType \r\n     */\r\n    render(context: RenderContext3D, depthType: DepthTextureMode): void {\r\n        var scene = context.scene;\r\n        var shaderValues: ShaderData = scene._shaderValues;\r\n        //this._castDepthUBO && shaderValues.setValueData(Shader3D.propertyNameToID(UniformBufferObject.UBONAME_SHADOW), this._castDepthUBO);\r\n        switch (depthType) {\r\n            case DepthTextureMode.Depth:\r\n                context.pipelineMode = \"ShadowCaster\";\r\n                shaderValues.addDefine(DepthPass.DEPTHPASS);\r\n                shaderValues.setVector(DepthPass.DEFINE_SHADOW_BIAS, DepthPass.SHADOW_BIAS);\r\n                var offsetX: number = this._viewPort.x;\r\n                var offsetY: number = this._viewPort.y;\r\n                this._depthTexture._start();\r\n                LayaGL.renderEngine.viewport(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                LayaGL.renderEngine.scissor(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                LayaGL.renderEngine.clearRenderTexture(RenderClearFlag.Depth, null, 1);\r\n                context.changeViewport(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                context.changeScissor(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                context.destTarget = this._depthTexture;\r\n                Stat.depthCastDrawCall += scene._opaqueQueue.renderQueue(context);\r\n                this._depthTexture._end();\r\n                this._setupDepthModeShaderValue(depthType, this._camera);\r\n                context.pipelineMode = context.configPipeLineMode;\r\n                shaderValues.removeDefine(DepthPass.DEPTHPASS);\r\n                break;\r\n            case DepthTextureMode.DepthNormals:\r\n                context.pipelineMode = \"DepthNormal\";\r\n                this._depthNormalsTexture._start();\r\n                //shader\r\n                var offsetX: number = this._viewPort.x;\r\n                var offsetY: number = this._viewPort.y;\r\n                LayaGL.renderEngine.viewport(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                LayaGL.renderEngine.scissor(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                LayaGL.renderEngine.clearRenderTexture(RenderClearFlag.Color | RenderClearFlag.Depth, this._defaultNormalDepthColor, 1)\r\n                context.destTarget = this._depthNormalsTexture;\r\n                context.changeViewport(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                context.changeScissor(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                Stat.depthCastDrawCall += scene._opaqueQueue.renderQueue(context);\r\n                this._depthNormalsTexture._end();\r\n                this._setupDepthModeShaderValue(depthType, this._camera);\r\n                context.pipelineMode = context.configPipeLineMode;\r\n                break;\r\n            case DepthTextureMode.MotionVectors:\r\n                break;\r\n            default:\r\n                throw (\"there is UnDefined type of DepthTextureMode\")\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     */\r\n    _setupDepthModeShaderValue(depthType: DepthTextureMode, camera: Camera) {\r\n        switch (depthType) {\r\n            case DepthTextureMode.Depth:\r\n                var far = camera.farPlane;\r\n                var near = camera.nearPlane;\r\n                this._zBufferParams.setValue(1.0 - far / near, far / near, (near - far) / (near * far), 1 / near);\r\n                camera._shaderValues.setVector(DepthPass.DEFINE_SHADOW_BIAS, DepthPass.SHADOW_BIAS);\r\n                camera._shaderValues.setTexture(DepthPass.DEPTHTEXTURE, this._depthTexture);\r\n                camera._shaderValues.setVector(DepthPass.DEPTHZBUFFERPARAMS, this._zBufferParams);\r\n                break;\r\n            case DepthTextureMode.DepthNormals:\r\n                camera._shaderValues.setTexture(DepthPass.DEPTHNORMALSTEXTURE, this._depthNormalsTexture);\r\n                break;\r\n            case DepthTextureMode.MotionVectors:\r\n                break;\r\n            default:\r\n                throw (\"there is UnDefined type of DepthTextureMode\")\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     */\r\n    cleanUp(): void {\r\n        (this._depthTexture instanceof RenderTexture)&& this._depthTexture && RenderTexture.recoverToPool(this._depthTexture);\r\n        this._depthNormalsTexture && RenderTexture.recoverToPool(this._depthNormalsTexture);\r\n        this._depthTexture = null;\r\n        this._depthNormalsTexture = null;\r\n    }\r\n}\r\n\r\n","import { IClone } from \"../../utils/IClone\";\r\n/**\r\n * \r\n */\r\n export enum WeightedMode {\r\n\t\r\n\t\r\n\tNone = 0,\r\n\tIn = 1,\r\n\tOut = 2,\r\n\tBoth = 3,\r\n}\r\n/**\r\n * <code>KeyFrame</code> \r\n */\r\nexport class Keyframe implements IClone {\r\n\tstatic defaultWeight:number = 0.33333;\r\n\t/***/\r\n\ttime: number;\r\n\r\n\t/**\r\n\t *  <code>KeyFrame</code> \r\n\t */\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destKeyFrame: Keyframe = (<Keyframe>destObject);\r\n\t\tdestKeyFrame.time = this.time;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: Keyframe = new Keyframe();\r\n\t\t\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\nexport enum KeyFrameValueType {\r\n\tNone = -1,\r\n\tFloat = 0,\r\n\tPosition = 1,\r\n\tRotation = 2,\r\n\tScale = 3,\r\n\tRotationEuler = 4,\r\n\tVector2 = 5,\r\n\tVector3 = 6,\r\n\tVector4 = 7,\r\n\tColor = 8\r\n}\r\n/**\r\n * @internal\r\n * <code>KeyframeNodeOwner</code> \r\n */\r\nexport class KeyframeNodeOwner {\r\n\t/**@internal */\r\n\tindexInList: number = -1;\r\n\t/**@internal */\r\n\treferenceCount: number = 0;\r\n\t/**@internal */\r\n\tupdateMark: number = -1;\r\n\r\n\t/**@internal 0 float,1 position,2 rotation,3 Scale,4 rotationEuler*/\r\n\ttype: KeyFrameValueType = -1;\r\n\t/**@internal */\r\n\tfullPath: string | null = null;\r\n\tnodePath: string | null = null;\r\n\t/**@internal */\r\n\tpropertyOwner: any = null;\r\n\t/**@internal */\r\n\tproperty: string[] | null = null;\r\n\t/**@internal */\r\n\tdefaultValue: any = null;\r\n\t/**@internal */\r\n\tvalue: any = null;\r\n\t/**@internal */\r\n\tcrossFixedValue: any = null;\r\n\t/**@internal */\r\n\tisMaterial: boolean = false;\r\n\t\r\n\t/**@internal */\r\n\tcallbackFunData:string;\r\n\t/**@internal */\r\n\tcallBackOwner:any;\r\n\t/**@internal */\r\n\tcallbackFun:string;\r\n\t/**@internal */\r\n\tcallParams:any[];\r\n\r\n\t/**\r\n\t *  <code>KeyframeNodeOwner</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tsaveCrossFixedValue(): void {\r\n\t\tvar pro: any = this.propertyOwner;\r\n\t\tif (pro) {\r\n\t\t\tswitch (this.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tthis.crossFixedValue = this.value;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\tcase 3:\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\t(<Vector3>this.value).cloneTo(this.crossFixedValue);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\t(<Quaternion>this.value).cloneTo(this.crossFixedValue);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow \"Animator:unknown type.\";\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tanimatorDataSetCallBack(){\r\n\t\tlet fn:Function = this.callBackOwner[this.callbackFun];\r\n\t\tfn.apply(this.callBackOwner,this.callParams);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tgetCallbackNode(){\r\n\t\tif(this.propertyOwner&&this.callbackFunData){\r\n\t\t\tlet funPropertys = this.callbackFunData.split(\".\");\r\n\t\t\tthis.callBackOwner = this.propertyOwner;\r\n\t\t\tfor(let i = 0,n = funPropertys.length-1;i<n;i++){\r\n\t\t\t\tthis.callBackOwner = this.callBackOwner[funPropertys[i]];\r\n\t\t\t}\r\n\t\t\tthis.callbackFun = funPropertys[funPropertys.length-1];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n","import { KeyFrameValueType } from \"../component/Animator/KeyframeNodeOwner\";\r\nimport { Keyframe } from \"../core/Keyframe\"\r\n\r\n/**\r\n *<code>KeyframeNode</code> \r\n */\r\nexport class KeyframeNode {\r\n\tprivate _ownerPath: string[] = [];\r\n\tprivate _propertys: string[] = [];\r\n\r\n\t/**@internal */\r\n\t_keyFrames: Keyframe[] = [];\r\n\t/**@internal */\r\n\t_indexInList: number;\r\n\r\n\t/**@internal */\r\n\ttype: KeyFrameValueType;\r\n\t/**@internal */\r\n\tfullPath: string;\r\n\t/**@internal */\r\n\tnodePath: string;\r\n\t/**@internal */\r\n\tpropertyOwner: string;\r\n\t/**@internal call bake fun*/\r\n\tcallbackFunData: string;\r\n\t/**@internal apply params*/\r\n\tcallParams: any[];\r\n\t/**\r\n\t * @internal\r\n\t * ide\r\n\t */\r\n\tpropertyChangePath: string;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget ownerPathCount(): number {\r\n\t\treturn this._ownerPath.length;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget propertyCount(): number {\r\n\t\treturn this._propertys.length;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget keyFramesCount(): number {\r\n\t\treturn this._keyFrames.length;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setOwnerPathCount(value: number): void {\r\n\t\tthis._ownerPath.length = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setOwnerPathByIndex(index: number, value: string): void {\r\n\t\tthis._ownerPath[index] = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_joinOwnerPath(sep: string): string {\r\n\t\treturn this._ownerPath.join(sep);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setPropertyCount(value: number): void {\r\n\t\tthis._propertys.length = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setPropertyByIndex(index: number, value: string): void {\r\n\t\tthis._propertys[index] = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_joinProperty(sep: string): string {\r\n\t\treturn this._propertys.join(sep);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setKeyframeCount(value: number): void {\r\n\t\tthis._keyFrames.length = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setKeyframeByIndex(index: number, value: Keyframe): void {\r\n\t\tthis._keyFrames[index] = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param index \r\n\t */\r\n\tgetOwnerPathByIndex(index: number): string {\r\n\t\treturn this._ownerPath[index];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param index \r\n\t */\r\n\tgetPropertyByIndex(index: number): string {\r\n\t\treturn this._propertys[index];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param index \r\n\t */\r\n\tgetKeyframeByIndex(index: number): Keyframe {\r\n\t\treturn this._keyFrames[index];\r\n\t}\r\n}","/**\r\n * <code>AnimationEvent</code> \r\n */\r\nexport class AnimationEvent {\r\n\t/** */\r\n\ttime: number;\r\n\t/** */\r\n\teventName: string;\r\n\t/** */\r\n\tparams: any[];\r\n\r\n\t/**\r\n\t *  <code>AnimationEvent</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Keyframe, WeightedMode } from \"./Keyframe\";\r\n/**\r\n\t * <code>FloatKeyFrame</code> \r\n\t */\r\nexport class FloatKeyframe extends Keyframe {\r\n\t/** */\r\n\tinTangent: number;\r\n\t/** */\r\n\toutTangent: number;\r\n\t/** */\r\n\tvalue: number;\r\n\t/** */\r\n\tinWeight: number = Keyframe.defaultWeight;\r\n\t/** */\r\n\toutWeight: number = Keyframe.defaultWeight;\r\n\t/** */\r\n\tweightedMode: number = WeightedMode.None;\r\n\r\n\t/**\r\n\t *  <code>FloatKeyFrame</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tsuper.cloneTo(destObject);\r\n\t\tvar destKeyFrame: FloatKeyframe = (<FloatKeyframe>destObject);\r\n\t\tdestKeyFrame.inTangent = this.inTangent;\r\n\t\tdestKeyFrame.outTangent = this.outTangent;\r\n\t\tdestKeyFrame.value = this.value;\r\n\t\tdestKeyFrame.inTangent = this.inTangent;\r\n\t\tdestKeyFrame.outTangent = this.outTangent;\r\n\t\tdestKeyFrame.value = this.value;\r\n\t\tdestKeyFrame.inWeight = this.inWeight;\r\n\t\tdestKeyFrame.outWeight = this.outWeight;\r\n\t\tdestKeyFrame.weightedMode = this.weightedMode;\r\n\t}\r\n\r\n\tclone(): FloatKeyframe {\r\n\t\tlet f = new FloatKeyframe();\r\n\t\tthis.cloneTo(f);\r\n\t\treturn f;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { Keyframe } from \"./Keyframe\";\r\n\r\n/**\r\n * <code>QuaternionKeyframe</code> \r\n */\r\nexport class QuaternionKeyframe extends Keyframe {\r\n\t/** */\r\n\tinTangent: Vector4 = new Vector4();\r\n\t/** */\r\n\toutTangent: Vector4 = new Vector4();\r\n\t/** */\r\n\tvalue: Quaternion = new Quaternion();\r\n\t/** */\r\n\tinWeight: Vector4;\r\n\t/** */\r\n\toutWeight: Vector4;\r\n\t/***/\r\n\tweightedMode: Vector4;\r\n\r\n\t/**\r\n\t *  <code>QuaternionKeyframe</code> \r\n\t */\r\n\tconstructor(weightMode: boolean = false) {\r\n\t\tsuper();\r\n\t\tif (weightMode) {\r\n\t\t\tthis.inWeight = new Vector4();\r\n\t\t\tthis.outWeight = new Vector4();\r\n\t\t\tthis.weightedMode = new Vector4();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t * @override\r\n\t */\r\n\tcloneTo(dest: any): void {\r\n\t\tsuper.cloneTo(dest);\r\n\t\tvar destKeyFarme: QuaternionKeyframe = (<QuaternionKeyframe>dest);\r\n\t\tthis.inTangent.cloneTo(destKeyFarme.inTangent);\r\n\t\tthis.outTangent.cloneTo(destKeyFarme.outTangent);\r\n\t\tthis.value.cloneTo(destKeyFarme.value);\r\n\t\tif (this.weightedMode) {\r\n\t\t\tthis.inWeight.cloneTo(destKeyFarme.inWeight);\r\n\t\t\tthis.outWeight.cloneTo(destKeyFarme.outWeight);\r\n\t\t\tthis.weightedMode.cloneTo(destKeyFarme.weightedMode);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n","import { Vector3 } from \"../../maths/Vector3\";\r\nimport { Keyframe, WeightedMode } from \"./Keyframe\";\r\n\r\n/**\r\n * <code>Vector3Keyframe</code> \r\n */\r\nexport class Vector3Keyframe extends Keyframe {\r\n\t/** */\r\n\tinTangent: Vector3 = new Vector3();\r\n\t/** */\r\n\toutTangent: Vector3 = new Vector3();\r\n\t/** */\r\n\tvalue: Vector3 = new Vector3();\r\n\t/** */\r\n\tinWeight: Vector3;\r\n\t/** */\r\n\toutWeight: Vector3;\r\n\t/** */\r\n\tweightedMode: Vector3;\r\n\r\n\r\n\t/**\r\n\t *  <code>Vector3Keyframe</code> \r\n\t */\r\n\tconstructor(weightMode:boolean = false) {\r\n\t\tsuper();\r\n\t\tif(weightMode){\r\n\t\t\tthis.inWeight = new Vector3(Keyframe.defaultWeight, Keyframe.defaultWeight, Keyframe.defaultWeight);\r\n\t\t\tthis.outWeight = new Vector3(Keyframe.defaultWeight, Keyframe.defaultWeight, Keyframe.defaultWeight);\r\n\t\t\tthis.weightedMode = new Vector3(WeightedMode.None, WeightedMode.None, WeightedMode.None);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t * @override\r\n\t */\r\n\tcloneTo(dest: any): void {\r\n\t\tsuper.cloneTo(dest);\r\n\t\tvar destKeyFarme: Vector3Keyframe = (<Vector3Keyframe>dest);\r\n\t\tthis.inTangent.cloneTo(destKeyFarme.inTangent);\r\n\t\tthis.outTangent.cloneTo(destKeyFarme.outTangent);\r\n\t\tthis.value.cloneTo(destKeyFarme.value);\r\n\t\tif(this.weightedMode){\r\n\t\t\tthis.inWeight.cloneTo(destKeyFarme.inWeight);\r\n\t\t\tthis.outWeight.cloneTo(destKeyFarme.outWeight);\r\n\t\t\tthis.weightedMode.cloneTo(destKeyFarme.weightedMode);\r\n\t\t}\r\n\t\t\r\n\t}\r\n}","import { KeyframeNode } from \"./KeyframeNode\";\r\nimport { KeyframeNodeList } from \"./KeyframeNodeList\";\r\nimport { AnimationEvent } from \"./AnimationEvent\";\r\nimport { FloatKeyframe } from \"../core/FloatKeyframe\"\r\nimport { QuaternionKeyframe } from \"../core/QuaternionKeyframe\"\r\nimport { Vector3Keyframe } from \"../core/Vector3Keyframe\"\r\nimport { Byte } from \"../../utils/Byte\"\r\nimport { AnimationClip } from \"./AnimationClip\";\r\nimport { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class AnimationClipParser03 {\r\n\tprivate static _animationClip: AnimationClip;\r\n\tprivate static _reader: Byte;\r\n\tprivate static _strings: any[] = [];\r\n\tprivate static _BLOCK: any = { count: 0 };\r\n\tprivate static _DATA: any = { offset: 0, size: 0 };\r\n\r\n\tprivate static READ_DATA(): void {\r\n\t\tAnimationClipParser03._DATA.offset = AnimationClipParser03._reader.getUint32();\r\n\t\tAnimationClipParser03._DATA.size = AnimationClipParser03._reader.getUint32();\r\n\t}\r\n\r\n\tprivate static READ_BLOCK(): void {\r\n\t\tvar count: number = AnimationClipParser03._BLOCK.count = AnimationClipParser03._reader.getUint16();\r\n\t\tvar blockStarts: any[] = AnimationClipParser03._BLOCK.blockStarts = [];\r\n\t\tvar blockLengths: any[] = AnimationClipParser03._BLOCK.blockLengths = [];\r\n\t\tfor (var i: number = 0; i < count; i++) {\r\n\t\t\tblockStarts.push(AnimationClipParser03._reader.getUint32());\r\n\t\t\tblockLengths.push(AnimationClipParser03._reader.getUint32());\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static READ_STRINGS(): void {\r\n\t\tvar offset: number = AnimationClipParser03._reader.getUint32();\r\n\t\tvar count: number = AnimationClipParser03._reader.getUint16();\r\n\t\tvar prePos: number = AnimationClipParser03._reader.pos;\r\n\t\tAnimationClipParser03._reader.pos = offset + AnimationClipParser03._DATA.offset;\r\n\r\n\t\tfor (var i: number = 0; i < count; i++)\r\n\t\t\tAnimationClipParser03._strings[i] = AnimationClipParser03._reader.readUTFString();\r\n\t\tAnimationClipParser03._reader.pos = prePos;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic parse(clip: AnimationClip, reader: Byte): void {\r\n\t\tAnimationClipParser03._animationClip = clip;\r\n\t\tAnimationClipParser03._reader = reader;\r\n\t\r\n\t\tAnimationClipParser03.READ_DATA();\r\n\t\tAnimationClipParser03.READ_BLOCK();\r\n\t\tAnimationClipParser03.READ_STRINGS();\r\n\t\tfor (var i: number = 0, n: number = AnimationClipParser03._BLOCK.count; i < n; i++) {\r\n\t\t\tvar index: number = reader.getUint16();\r\n\t\t\tvar blockName: string = AnimationClipParser03._strings[index];\r\n\t\t\tvar fn:()=>void = (AnimationClipParser03 as any)[\"READ_\" + blockName];\r\n\t\t\tif (fn == null)\r\n\t\t\t\tthrow new Error(\"model file err,no this function:\" + index + \" \" + blockName);\r\n\t\t\telse\r\n\t\t\t\tfn.call(null);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic READ_ANIMATIONS(): void {\r\n\t\tvar i: number, j: number;\r\n\t\tvar node: KeyframeNode;\r\n\t\tvar reader: Byte = AnimationClipParser03._reader;\r\n\r\n\t\tvar startTimeTypes: number[] = [];\r\n\t\tvar startTimeTypeCount: number = reader.getUint16();\r\n\t\tstartTimeTypes.length = startTimeTypeCount;\r\n\t\tfor (i = 0; i < startTimeTypeCount; i++)\r\n\t\t\tstartTimeTypes[i] = reader.getFloat32();\r\n\r\n\t\tvar clip: AnimationClip = AnimationClipParser03._animationClip;\r\n\t\tclip.name = AnimationClipParser03._strings[reader.getUint16()];\r\n\t\tvar clipDur: number = clip._duration = reader.getFloat32();\r\n\t\tclip.islooping = !!reader.getByte();\r\n\t\tclip._frameRate = reader.getInt16();\r\n\t\tvar nodeCount: number = reader.getInt16();\r\n\t\tvar nodes = clip._nodes;\r\n\t\t(nodes as KeyframeNodeList).count = nodeCount;\r\n\t\tvar nodesMap: any = clip._nodesMap = {};\r\n\t\tvar nodesDic: any = clip._nodesDic = {};\r\n\r\n\t\tfor (i = 0; i < nodeCount; i++) {\r\n\t\t\tnode = new KeyframeNode();\r\n\t\t\t(nodes as KeyframeNodeList).setNodeByIndex(i, node);\r\n\t\t\tnode._indexInList = i;\r\n\t\t\tvar type: number = node.type = reader.getUint8();\r\n\r\n\t\t\tvar pathLength: number = reader.getUint16();\r\n\t\t\tnode._setOwnerPathCount(pathLength);\r\n\t\t\tfor (j = 0; j < pathLength; j++)\r\n\t\t\t\tnode._setOwnerPathByIndex(j, AnimationClipParser03._strings[reader.getUint16()]);//TODO:componentType\r\n\r\n\t\t\tvar nodePath: string = node._joinOwnerPath(\"/\");\r\n\t\t\tvar mapArray: KeyframeNode[] = nodesMap[nodePath];\r\n\t\t\t(mapArray) || (nodesMap[nodePath] = mapArray = []);\r\n\t\t\tmapArray.push(node);\r\n\r\n\t\t\tnode.propertyOwner = AnimationClipParser03._strings[reader.getUint16()];\r\n\r\n\t\t\tvar propertyLength: number = reader.getUint16();\r\n\t\t\tnode._setPropertyCount(propertyLength);\r\n\t\t\tfor (j = 0; j < propertyLength; j++)\r\n\t\t\t\tnode._setPropertyByIndex(j, AnimationClipParser03._strings[reader.getUint16()]);\r\n\r\n\t\t\tvar fullPath: string = nodePath + \".\" + node.propertyOwner + \".\" + node._joinProperty(\".\");\r\n\t\t\tnodesDic[fullPath] = node;\r\n\t\t\tnode.fullPath = fullPath;\r\n\r\n\t\t\tvar keyframeCount: number = reader.getUint16();\r\n\t\t\tnode._setKeyframeCount(keyframeCount);\r\n\r\n\t\t\tfor (j = 0; j < keyframeCount; j++) {\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tvar floatKeyframe: FloatKeyframe = new FloatKeyframe();\r\n\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatKeyframe);\r\n\t\t\t\t\t\tfloatKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\tfloatKeyframe.inTangent = reader.getFloat32();\r\n\t\t\t\t\t\tfloatKeyframe.outTangent = reader.getFloat32();\r\n\t\t\t\t\t\tfloatKeyframe.value = reader.getFloat32();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\tvar floatArrayKeyframe: Vector3Keyframe = new Vector3Keyframe();\r\n\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatArrayKeyframe);\r\n\r\n\t\t\t\t\t\tfloatArrayKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\r\n\r\n\t\t\t\t\t\t\tvar inTangent: Vector3 = floatArrayKeyframe.inTangent;\r\n\t\t\t\t\t\t\tvar outTangent: Vector3 = floatArrayKeyframe.outTangent;\r\n\t\t\t\t\t\t\tvar value: Vector3 = floatArrayKeyframe.value;\r\n\t\t\t\t\t\t\tinTangent.x = reader.getFloat32();\r\n\t\t\t\t\t\t\tinTangent.y = reader.getFloat32();\r\n\t\t\t\t\t\t\tinTangent.z = reader.getFloat32();\r\n\t\t\t\t\t\t\toutTangent.x = reader.getFloat32();\r\n\t\t\t\t\t\t\toutTangent.y = reader.getFloat32();\r\n\t\t\t\t\t\t\toutTangent.z = reader.getFloat32();\r\n\t\t\t\t\t\t\tvalue.x = reader.getFloat32();\r\n\t\t\t\t\t\t\tvalue.y = reader.getFloat32();\r\n\t\t\t\t\t\t\tvalue.z = reader.getFloat32();\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tvar quaArrayKeyframe: QuaternionKeyframe = new QuaternionKeyframe();\r\n\t\t\t\t\t\tnode._setKeyframeByIndex(j, quaArrayKeyframe);\r\n\t\t\t\t\t\tquaArrayKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\r\n\t\t\t\t\t\t\tvar inTangentQua: Vector4 = quaArrayKeyframe.inTangent;\r\n\t\t\t\t\t\t\tvar outTangentQua: Vector4 = quaArrayKeyframe.outTangent;\r\n\t\t\t\t\t\t\tvar valueQua: Quaternion = quaArrayKeyframe.value;\r\n\t\t\t\t\t\t\tinTangentQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\tinTangentQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\tinTangentQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\tinTangentQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\toutTangentQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\toutTangentQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\toutTangentQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\toutTangentQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\tvalueQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\tvalueQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\tvalueQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\tvalueQua.w = reader.getFloat32();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow \"AnimationClipParser03:unknown type.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar eventCount: number = reader.getUint16();\r\n\t\tfor (i = 0; i < eventCount; i++) {\r\n\t\t\tvar event: AnimationEvent = new AnimationEvent();\r\n\t\t\tevent.time = Math.min(clipDur, reader.getFloat32());//TODO:\r\n\t\t\tevent.eventName = AnimationClipParser03._strings[reader.getUint16()];\r\n\t\t\tvar params: Array<number|boolean|string> = [];\r\n\t\t\tvar paramCount: number = reader.getUint16();\r\n\t\t\t(paramCount > 0) && (event.params = params = []);\r\n\r\n\t\t\tfor (j = 0; j < paramCount; j++) {\r\n\t\t\t\tvar eventType: number = reader.getByte();\r\n\t\t\t\tswitch (eventType) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tparams.push(!!reader.getByte());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tparams.push(reader.getInt32());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tparams.push(reader.getFloat32());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tparams.push(AnimationClipParser03._strings[reader.getUint16()]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow new Error(\"unknown type.\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tclip.addEvent(event);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n","import { Vector2 } from \"../../maths/Vector2\";\r\nimport { Keyframe, WeightedMode } from \"./Keyframe\";\r\n\r\n\r\n/**\r\n * <code>Vector2Keyframe</code> \r\n */\r\nexport class Vector2Keyframe extends Keyframe {\r\n\t/** */\r\n\tinTangent: Vector2 = new Vector2();\r\n\t/** */\r\n\toutTangent: Vector2 = new Vector2();\r\n\t/** */\r\n\tvalue: Vector2 = new Vector2();\r\n\t/** */\r\n\tinWeight: Vector2;\r\n\t/** */\r\n\toutWeight: Vector2;\r\n\t/** */\r\n\tweightedMode: Vector2;\r\n\r\n\r\n\t/**\r\n\t *  <code>Vector2Keyframe</code> \r\n\t */\r\n\tconstructor(weightMode:boolean = false) {\r\n\t\tsuper();\r\n\t\tif(weightMode){\r\n\t\t\tthis.inWeight = new Vector2(Keyframe.defaultWeight, Keyframe.defaultWeight);\r\n\t\t\tthis.outWeight = new Vector2(Keyframe.defaultWeight, Keyframe.defaultWeight);\r\n\t\t\tthis.weightedMode = new Vector2(WeightedMode.None, WeightedMode.None);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t * @override\r\n\t */\r\n\tcloneTo(dest: any): void {\r\n\t\tsuper.cloneTo(dest);\r\n\t\tvar destKeyFarme: Vector2Keyframe = (<Vector2Keyframe>dest);\r\n\t\tthis.inTangent.cloneTo(destKeyFarme.inTangent);\r\n\t\tthis.outTangent.cloneTo(destKeyFarme.outTangent);\r\n\t\tthis.value.cloneTo(destKeyFarme.value);\r\n\t\tif(this.weightedMode){\r\n\t\t\tthis.inWeight.cloneTo(destKeyFarme.inWeight);\r\n\t\t\tthis.outWeight.cloneTo(destKeyFarme.outWeight);\r\n\t\t\tthis.weightedMode.cloneTo(destKeyFarme.weightedMode);\r\n\t\t}\r\n\t\t\r\n\t}\r\n}\r\n","import { Vector4 } from \"../../maths/Vector4\";\r\nimport { Keyframe, WeightedMode } from \"./Keyframe\";\r\n\r\n\r\n/**\r\n * <code>Vector4Keyframe</code> \r\n */\r\nexport class Vector4Keyframe extends Keyframe {\r\n\t/** */\r\n\tinTangent: Vector4 = new Vector4();\r\n\t/** */\r\n\toutTangent: Vector4 = new Vector4();\r\n\t/** */\r\n\tvalue: Vector4 = new Vector4();\r\n\t/** */\r\n\tinWeight: Vector4;\r\n\t/** */\r\n\toutWeight: Vector4;\r\n\t/** */\r\n\tweightedMode: Vector4;\r\n\r\n\r\n\t/**\r\n\t *  <code>Vector4Keyframe</code> \r\n\t */\r\n\tconstructor(weightMode: boolean = false) {\r\n\t\tsuper();\r\n\t\tif (weightMode) {\r\n\t\t\tthis.inWeight = new Vector4(Keyframe.defaultWeight, Keyframe.defaultWeight, Keyframe.defaultWeight, Keyframe.defaultWeight);\r\n\t\t\tthis.outWeight = new Vector4(Keyframe.defaultWeight, Keyframe.defaultWeight, Keyframe.defaultWeight, Keyframe.defaultWeight);\r\n\t\t\tthis.weightedMode = new Vector4(WeightedMode.None, WeightedMode.None, WeightedMode.None, WeightedMode.None);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t * @override\r\n\t */\r\n\tcloneTo(dest: any): void {\r\n\t\tsuper.cloneTo(dest);\r\n\t\tvar destKeyFarme: Vector4Keyframe = (<Vector4Keyframe>dest);\r\n\t\tthis.inTangent.cloneTo(destKeyFarme.inTangent);\r\n\t\tthis.outTangent.cloneTo(destKeyFarme.outTangent);\r\n\t\tthis.value.cloneTo(destKeyFarme.value);\r\n\t\tif (this.weightedMode) {\r\n\t\t\tthis.inWeight.cloneTo(destKeyFarme.inWeight);\r\n\t\t\tthis.outWeight.cloneTo(destKeyFarme.outWeight);\r\n\t\t\tthis.weightedMode.cloneTo(destKeyFarme.weightedMode);\r\n\t\t}\r\n\t}\r\n}","import { KeyframeNode } from \"./KeyframeNode\";\r\nimport { KeyframeNodeList } from \"./KeyframeNodeList\";\r\nimport { AnimationEvent } from \"./AnimationEvent\";\r\nimport { FloatKeyframe } from \"../core/FloatKeyframe\"\r\nimport { QuaternionKeyframe } from \"../core/QuaternionKeyframe\"\r\nimport { Vector3Keyframe } from \"../core/Vector3Keyframe\"\r\nimport { AnimationClip } from \"./AnimationClip\";\r\nimport { Byte } from \"../../utils/Byte\";\r\nimport { HalfFloatUtils } from \"../../utils/HalfFloatUtils\";\r\nimport { Vector2Keyframe } from \"../core/Vector2Keyframe\";\r\nimport { Vector4Keyframe } from \"../core/Vector4Keyframe\";\r\nimport { KeyFrameValueType } from \"../component/Animator/KeyframeNodeOwner\";\r\nimport { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector2 } from \"../../maths/Vector2\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { WeightedMode } from \"../core/Keyframe\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class AnimationClipParser04 {\r\n\tprivate static _animationClip: AnimationClip | null;\r\n\tprivate static _reader: Byte | null;\r\n\tprivate static _strings: any[] = [];\r\n\tprivate static _BLOCK: any = { count: 0 };\r\n\tprivate static _DATA: any = { offset: 0, size: 0 };\r\n\tprivate static _version: string | null;\r\n\r\n\tprivate static READ_DATA(): void {\r\n\t\tAnimationClipParser04._DATA.offset = AnimationClipParser04._reader!.getUint32();\r\n\t\tAnimationClipParser04._DATA.size = AnimationClipParser04._reader!.getUint32();\r\n\t}\r\n\r\n\tprivate static READ_BLOCK(): void {\r\n\t\tvar count: number = AnimationClipParser04._BLOCK.count = AnimationClipParser04._reader!.getUint16();\r\n\t\tvar blockStarts: any[] = AnimationClipParser04._BLOCK.blockStarts = [];\r\n\t\tvar blockLengths: any[] = AnimationClipParser04._BLOCK.blockLengths = [];\r\n\t\tfor (var i: number = 0; i < count; i++) {\r\n\t\t\tblockStarts.push(AnimationClipParser04._reader!.getUint32());\r\n\t\t\tblockLengths.push(AnimationClipParser04._reader!.getUint32());\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static READ_STRINGS(): void {\r\n\t\tvar offset: number = AnimationClipParser04._reader!.getUint32();\r\n\t\tvar count: number = AnimationClipParser04._reader!.getUint16();\r\n\t\tvar prePos: number = AnimationClipParser04._reader!.pos;\r\n\t\tAnimationClipParser04._reader!.pos = offset + AnimationClipParser04._DATA.offset;\r\n\r\n\t\tfor (var i: number = 0; i < count; i++)\r\n\t\t\tAnimationClipParser04._strings[i] = AnimationClipParser04._reader!.readUTFString();\r\n\t\tAnimationClipParser04._reader!.pos = prePos;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic parse(clip: AnimationClip, reader: Byte, version: string): void {\r\n\t\tAnimationClipParser04._animationClip = clip;\r\n\t\tAnimationClipParser04._reader = reader;\r\n\t\tAnimationClipParser04._version = version;\r\n\t\tAnimationClipParser04.READ_DATA();\r\n\t\tAnimationClipParser04.READ_BLOCK();\r\n\t\tAnimationClipParser04.READ_STRINGS();\r\n\t\tfor (var i: number = 0, n: number = AnimationClipParser04._BLOCK.count; i < n; i++) {\r\n\t\t\tvar index: number = reader.getUint16();\r\n\t\t\tvar blockName: string = AnimationClipParser04._strings[index];\r\n\t\t\tvar fn: () => void = (AnimationClipParser04 as any)[\"READ_\" + blockName];\r\n\t\t\tif (fn == null)\r\n\t\t\t\tthrow new Error(\"model file err,no this function:\" + index + \" \" + blockName);\r\n\t\t\telse\r\n\t\t\t\tfn.call(null);\r\n\t\t}\r\n\t\tAnimationClipParser04._version = null;\r\n\t\tAnimationClipParser04._reader = null;\r\n\t\tAnimationClipParser04._animationClip = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic READ_ANIMATIONS(): void {\r\n\t\tvar i: number, j: number;\r\n\t\tvar node: KeyframeNode;\r\n\t\tvar reader: Byte = AnimationClipParser04._reader!;\r\n\r\n\t\tvar startTimeTypes: number[] = [];\r\n\t\tvar startTimeTypeCount: number = reader.getUint16();\r\n\t\tstartTimeTypes.length = startTimeTypeCount;\r\n\t\tfor (i = 0; i < startTimeTypeCount; i++)\r\n\t\t\tstartTimeTypes[i] = reader.getFloat32();\r\n\r\n\t\tvar clip: AnimationClip = AnimationClipParser04._animationClip!;\r\n\t\tclip.name = AnimationClipParser04._strings[reader.getUint16()];\r\n\t\tvar clipDur: number = clip._duration = reader.getFloat32();\r\n\t\tclip.islooping = !!reader.getByte();\r\n\t\tclip._frameRate = reader.getInt16();\r\n\t\tvar nodeCount: number = reader.getInt16();\r\n\t\tvar nodes: KeyframeNodeList = clip._nodes!;\r\n\t\tnodes.count = nodeCount;\r\n\t\tvar nodesMap: any = clip._nodesMap = {};\r\n\t\tvar nodesDic: any = clip._nodesDic = {};\r\n\r\n\t\tfor (i = 0; i < nodeCount; i++) {\r\n\t\t\tnode = new KeyframeNode();\r\n\t\t\tif (\"LAYAANIMATION:WEIGHT_05\" == AnimationClipParser04._version) {\r\n\t\t\t\tif (1 == reader.getByte()) {\r\n\t\t\t\t\t//propertyChangePath,IDE\r\n\t\t\t\t\tnode.propertyChangePath = AnimationClipParser04._strings[reader.getUint16()];\r\n\t\t\t\t}\r\n\t\t\t\tif (1 == reader.getByte()) {\r\n\t\t\t\t\tnode.callbackFunData = AnimationClipParser04._strings[reader.getUint16()];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet paramLen = reader.getUint8();\r\n\t\t\t\tlet callParms: any[] = null;\r\n\t\t\t\tfor (j = 0; j < paramLen; j++) {\r\n\t\t\t\t\tif (null == callParms) {\r\n\t\t\t\t\t\tcallParms = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcallParms.push(AnimationClipParser04._strings[reader.getUint16()]);\r\n\t\t\t\t}\r\n\t\t\t\tnode.callParams = callParms;\r\n\t\t\t}\r\n\t\t\tnodes.setNodeByIndex(i, node);\r\n\t\t\tnode._indexInList = i;\r\n\t\t\tvar type: number = node.type = reader.getUint8();\r\n\r\n\t\t\tvar pathLength: number = reader.getUint16();\r\n\t\t\tnode._setOwnerPathCount(pathLength);\r\n\t\t\tfor (j = 0; j < pathLength; j++)\r\n\t\t\t\tnode._setOwnerPathByIndex(j, AnimationClipParser04._strings[reader.getUint16()]);//TODO:componentType\r\n\r\n\t\t\tvar nodePath: string = node._joinOwnerPath(\"/\");\r\n\t\t\tvar mapArray: KeyframeNode[] = nodesMap[nodePath];\r\n\t\t\t(mapArray) || (nodesMap[nodePath] = mapArray = []);\r\n\t\t\tmapArray.push(node);\r\n\r\n\t\t\tnode.propertyOwner = AnimationClipParser04._strings[reader.getUint16()];\r\n\r\n\t\t\tvar propertyLength: number = reader.getUint16();\r\n\t\t\tnode._setPropertyCount(propertyLength);\r\n\t\t\tfor (j = 0; j < propertyLength; j++)\r\n\t\t\t\tnode._setPropertyByIndex(j, AnimationClipParser04._strings[reader.getUint16()]);\r\n\r\n\t\t\tvar fullPath: string = nodePath + \".\" + node.propertyOwner + \".\" + node._joinProperty(\".\");\r\n\t\t\tnodesDic[fullPath] = node;\r\n\t\t\tnode.fullPath = fullPath;\r\n\t\t\tnode.nodePath = nodePath;\r\n\r\n\t\t\tvar keyframeCount: number = reader.getUint16();\r\n\t\t\tnode._setKeyframeCount(keyframeCount);\r\n\t\t\tswitch (AnimationClipParser04._version) {\r\n\t\t\t\tcase \"LAYAANIMATION:04\":\r\n\t\t\t\t\tfor (j = 0; j < keyframeCount; j++) {\r\n\t\t\t\t\t\tswitch (type) {\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Float:\r\n\t\t\t\t\t\t\t\tvar floatKeyframe: FloatKeyframe = new FloatKeyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatKeyframe);\r\n\t\t\t\t\t\t\t\tfloatKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tfloatKeyframe.inTangent = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tfloatKeyframe.outTangent = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tfloatKeyframe.value = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Position:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Scale:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.RotationEuler:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector3:\r\n\t\t\t\t\t\t\t\tvar floatArrayKeyframe: Vector3Keyframe = new Vector3Keyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatArrayKeyframe);\r\n\t\t\t\t\t\t\t\tfloatArrayKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangent: Vector3 = floatArrayKeyframe.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangent: Vector3 = floatArrayKeyframe.outTangent;\r\n\t\t\t\t\t\t\t\tvar value: Vector3 = floatArrayKeyframe.value;\r\n\t\t\t\t\t\t\t\tinTangent.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangent.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangent.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangent.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangent.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangent.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalue.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalue.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalue.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Rotation:\r\n\t\t\t\t\t\t\t\tvar quaternionKeyframe: QuaternionKeyframe = new QuaternionKeyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, quaternionKeyframe);\r\n\t\t\t\t\t\t\t\tquaternionKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentQua: Vector4 = quaternionKeyframe.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentQua: Vector4 = quaternionKeyframe.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueQua: Quaternion = quaternionKeyframe.value;\r\n\t\t\t\t\t\t\t\tinTangentQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector2:\r\n\t\t\t\t\t\t\t\tvar vec2Keyfram = new Vector2Keyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, vec2Keyfram);\r\n\t\t\t\t\t\t\t\tvec2Keyfram.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentV2: Vector2 = vec2Keyfram.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentV2: Vector2 = vec2Keyfram.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueV2: Vector2 = vec2Keyfram.value;\r\n\t\t\t\t\t\t\t\tinTangentV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector4:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Color:\r\n\t\t\t\t\t\t\t\tvar vec4Keyfram = new Vector4Keyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, vec4Keyfram);\r\n\t\t\t\t\t\t\t\tvec4Keyfram.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentV4: Vector4 = vec4Keyfram.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentV4: Vector4 = vec4Keyfram.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueV4: Vector4 = vec4Keyfram.value;\r\n\t\t\t\t\t\t\t\tinTangentV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tthrow \"AnimationClipParser04:unknown type.\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"LAYAANIMATION:WEIGHT_04\":\r\n\t\t\t\tcase \"LAYAANIMATION:WEIGHT_05\":\r\n\t\t\t\t\tfor (j = 0; j < keyframeCount; j++) {\r\n\t\t\t\t\t\tlet isWeight = 1;\r\n\t\t\t\t\t\tswitch (type) {\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Float:\r\n\t\t\t\t\t\t\t\tvar floatKeyframe: FloatKeyframe = new FloatKeyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatKeyframe);\r\n\t\t\t\t\t\t\t\tfloatKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tfloatKeyframe.inTangent = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tfloatKeyframe.outTangent = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tfloatKeyframe.value = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tfloatKeyframe.weightedMode = reader.getUint8();\r\n\t\t\t\t\t\t\t\tif (\"LAYAANIMATION:WEIGHT_05\" == AnimationClipParser04._version) {\r\n\t\t\t\t\t\t\t\t\tif (WeightedMode.In == floatKeyframe.weightedMode || WeightedMode.Both == floatKeyframe.weightedMode) {\r\n\t\t\t\t\t\t\t\t\t\tfloatKeyframe.inWeight = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif (WeightedMode.Out == floatKeyframe.weightedMode || WeightedMode.Both == floatKeyframe.weightedMode) {\r\n\t\t\t\t\t\t\t\t\t\tfloatKeyframe.outWeight = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfloatKeyframe.inWeight = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tfloatKeyframe.outWeight = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Position:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Scale:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.RotationEuler:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector3:\r\n\t\t\t\t\t\t\t\tvar floatArrayKeyframe: Vector3Keyframe = new Vector3Keyframe(true);\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatArrayKeyframe);\r\n\t\t\t\t\t\t\t\tfloatArrayKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangent: Vector3 = floatArrayKeyframe.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangent: Vector3 = floatArrayKeyframe.outTangent;\r\n\t\t\t\t\t\t\t\tvar value: Vector3 = floatArrayKeyframe.value;\r\n\t\t\t\t\t\t\t\tlet weidhtMode = floatArrayKeyframe.weightedMode;\r\n\t\t\t\t\t\t\t\tlet inWeight = floatArrayKeyframe.inWeight;\r\n\t\t\t\t\t\t\t\tlet outWeight = floatArrayKeyframe.outWeight;\r\n\t\t\t\t\t\t\t\tinTangent.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangent.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangent.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangent.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangent.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangent.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalue.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalue.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalue.z = reader.getFloat32();\r\n\r\n\t\t\t\t\t\t\t\tif (\"LAYAANIMATION:WEIGHT_05\" == AnimationClipParser04._version) {\r\n\t\t\t\t\t\t\t\t\tisWeight = reader.getByte();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (1 == isWeight) {\r\n\t\t\t\t\t\t\t\t\tweidhtMode.x = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweidhtMode.y = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweidhtMode.z = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tinWeight.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeight.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeight.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeight.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeight.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeight.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Rotation:\r\n\t\t\t\t\t\t\t\tvar quaternionKeyframe: QuaternionKeyframe = new QuaternionKeyframe(true);\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, quaternionKeyframe);\r\n\t\t\t\t\t\t\t\tquaternionKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentQua: Vector4 = quaternionKeyframe.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentQua: Vector4 = quaternionKeyframe.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueQua: Quaternion = quaternionKeyframe.value;\r\n\t\t\t\t\t\t\t\tlet weightModeV4 = quaternionKeyframe.weightedMode;\r\n\t\t\t\t\t\t\t\tlet inWeightQua = quaternionKeyframe.inWeight;\r\n\t\t\t\t\t\t\t\tlet outWeightQua = quaternionKeyframe.outWeight;\r\n\t\t\t\t\t\t\t\tinTangentQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.w = reader.getFloat32();\r\n\r\n\t\t\t\t\t\t\t\tif (\"LAYAANIMATION:WEIGHT_05\" == AnimationClipParser04._version) {\r\n\t\t\t\t\t\t\t\t\tisWeight = reader.getByte();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (1 == isWeight) {\r\n\t\t\t\t\t\t\t\t\tweightModeV4.x = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweightModeV4.y = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweightModeV4.z = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweightModeV4.w = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tinWeightQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeightQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeightQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeightQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector2:\r\n\t\t\t\t\t\t\t\tvar vec2Keyfram = new Vector2Keyframe(true);\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, vec2Keyfram);\r\n\t\t\t\t\t\t\t\tvec2Keyfram.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentV2: Vector2 = vec2Keyfram.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentV2: Vector2 = vec2Keyfram.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueV2: Vector2 = vec2Keyfram.value;\r\n\t\t\t\t\t\t\t\tlet weightModeV2 = vec2Keyfram.weightedMode;\r\n\t\t\t\t\t\t\t\tlet inWeightV2 = vec2Keyfram.inWeight;\r\n\t\t\t\t\t\t\t\tlet outWeightV2 = vec2Keyfram.outWeight;\r\n\t\t\t\t\t\t\t\tinTangentV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tif (\"LAYAANIMATION:WEIGHT_05\" == AnimationClipParser04._version) {\r\n\t\t\t\t\t\t\t\t\tisWeight = reader.getByte();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (1 == isWeight) {\r\n\t\t\t\t\t\t\t\t\tweightModeV2.x = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweightModeV2.y = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tinWeightV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeightV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector4:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Color:\r\n\t\t\t\t\t\t\t\tvar vec4Keyfram = new Vector4Keyframe(true);\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, vec4Keyfram);\r\n\t\t\t\t\t\t\t\tvec4Keyfram.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentV4: Vector4 = vec4Keyfram.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentV4: Vector4 = vec4Keyfram.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueV4: Vector4 = vec4Keyfram.value;\r\n\t\t\t\t\t\t\t\tvar weightMode_V4 = vec4Keyfram.weightedMode;\r\n\t\t\t\t\t\t\t\tvar inWeightV4 = vec4Keyfram.inWeight;\r\n\t\t\t\t\t\t\t\tvar outWeightV4 = vec4Keyfram.outWeight;\r\n\t\t\t\t\t\t\t\tinTangentV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tif (\"LAYAANIMATION:WEIGHT_05\" == AnimationClipParser04._version) {\r\n\t\t\t\t\t\t\t\t\tisWeight = reader.getByte();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (1 == isWeight) {\r\n\t\t\t\t\t\t\t\t\tweightMode_V4.x = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweightMode_V4.y = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweightMode_V4.z = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweightMode_V4.w = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tinWeightV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeightV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeightV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeightV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tthrow \"AnimationClipParser04:unknown type.\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"LAYAANIMATION:COMPRESSION_04\":\r\n\t\t\t\t\tfor (j = 0; j < keyframeCount; j++) {\r\n\t\t\t\t\t\tswitch (type) {\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Float:\r\n\t\t\t\t\t\t\t\tfloatKeyframe = new FloatKeyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatKeyframe);\r\n\t\t\t\t\t\t\t\tfloatKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tfloatKeyframe.inTangent = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tfloatKeyframe.outTangent = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tfloatKeyframe.value = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Position:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Scale:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.RotationEuler:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector3:\r\n\t\t\t\t\t\t\t\tfloatArrayKeyframe = new Vector3Keyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatArrayKeyframe);\r\n\t\t\t\t\t\t\t\tfloatArrayKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\r\n\t\t\t\t\t\t\t\tinTangent = floatArrayKeyframe.inTangent;\r\n\t\t\t\t\t\t\t\toutTangent = floatArrayKeyframe.outTangent;\r\n\t\t\t\t\t\t\t\tvalue = floatArrayKeyframe.value;\r\n\t\t\t\t\t\t\t\tinTangent.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangent.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangent.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangent.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangent.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangent.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalue.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalue.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalue.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Rotation:\r\n\t\t\t\t\t\t\t\tquaternionKeyframe = new QuaternionKeyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, quaternionKeyframe);\r\n\t\t\t\t\t\t\t\tquaternionKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\r\n\t\t\t\t\t\t\t\tinTangentQua = quaternionKeyframe.inTangent;\r\n\t\t\t\t\t\t\t\toutTangentQua = quaternionKeyframe.outTangent;\r\n\t\t\t\t\t\t\t\tvalueQua = quaternionKeyframe.value;\r\n\t\t\t\t\t\t\t\tinTangentQua.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangentQua.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangentQua.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangentQua.w = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentQua.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentQua.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentQua.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentQua.w = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueQua.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueQua.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueQua.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueQua.w = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector2:\r\n\t\t\t\t\t\t\t\tvar vec2Keyfram = new Vector2Keyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, vec2Keyfram);\r\n\t\t\t\t\t\t\t\tvec2Keyfram.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentV2: Vector2 = vec2Keyfram.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentV2: Vector2 = vec2Keyfram.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueV2: Vector2 = vec2Keyfram.value;\r\n\t\t\t\t\t\t\t\tinTangentV2.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangentV2.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentV2.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentV2.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueV2.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueV2.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector4:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Color:\r\n\t\t\t\t\t\t\t\tvar vec4Keyfram = new Vector4Keyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, vec4Keyfram);\r\n\t\t\t\t\t\t\t\tvec4Keyfram.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentV4: Vector4 = vec4Keyfram.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentV4: Vector4 = vec4Keyfram.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueV4: Vector4 = vec4Keyfram.value;\r\n\t\t\t\t\t\t\t\tinTangentV4.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangentV4.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangentV4.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangentV4.w = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentV4.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentV4.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentV4.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentV4.w = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueV4.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueV4.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueV4.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueV4.w = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tthrow \"AnimationClipParser04:unknown type.\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar eventCount: number = reader.getUint16();\r\n\t\tfor (i = 0; i < eventCount; i++) {\r\n\t\t\tvar event: AnimationEvent = new AnimationEvent();\r\n\t\t\tevent.time = Math.min(clipDur, reader.getFloat32());//TODO:\r\n\t\t\tevent.eventName = AnimationClipParser04._strings[reader.getUint16()];\r\n\t\t\tvar params: Array<number | string | boolean> = [];\r\n\t\t\tvar paramCount: number = reader.getUint16();\r\n\t\t\t(paramCount > 0) && (event.params = params = []);\r\n\r\n\t\t\tfor (j = 0; j < paramCount; j++) {\r\n\t\t\t\tvar eventType: number = reader.getByte();\r\n\t\t\t\tswitch (eventType) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tparams.push(!!reader.getByte());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tparams.push(reader.getInt32());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tparams.push(reader.getFloat32());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tparams.push(AnimationClipParser04._strings[reader.getUint16()]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow new Error(\"unknown type.\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tclip.addEvent(event);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n","import { KeyframeNode } from \"./KeyframeNode\";\r\n\r\n/**\r\n * <code>KeyframeNodeList</code> KeyframeNode\r\n */\r\nexport class KeyframeNodeList {\r\n\t/** @internal */\r\n\tprivate _nodes: KeyframeNode[] = [];\r\n\r\n\t/**\r\n\t *\t\r\n\t */\r\n\tget count(): number {\r\n\t\treturn this._nodes.length;\r\n\t}\r\n\r\n\tset count(value: number) {\r\n\t\tthis._nodes.length = value;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>KeyframeNodeList</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tindex \r\n\t * @return \r\n\t */\r\n\tgetNodeByIndex(index: number): KeyframeNode {\r\n\t\treturn this._nodes[index];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tindex \r\n\t * @param \r\n\t */\r\n\tsetNodeByIndex(index: number, node: KeyframeNode): void {\r\n\t\tthis._nodes[index] = node;\r\n\t}\r\n\r\n}\r\n","import { TextureFormat } from \"../../RenderEngine/RenderEnum/TextureFormat\";\r\nimport { Texture2D } from \"../../resource/Texture2D\"\r\n\r\n\r\n/**\r\n * \r\n * @internal\r\n * @author\r\n */\r\nexport class TextureGenerator {\r\n\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\tstatic lightAttenTexture(x: number, y: number, maxX: number, maxY: number, index: number, data: Uint8Array): void {\r\n\r\n\t\tvar sqrRange: number = x / maxX;\r\n\t\tvar atten: number = 1.0 / (1.0 + 25.0 * sqrRange);\r\n\t\tif (sqrRange >= 0.64) {\r\n\t\t\tif (sqrRange > 1.0) {\r\n\t\t\t\tatten = 0;\r\n\t\t\t} else {\r\n\t\t\t\tatten *= 1 - (sqrRange - 0.64) / (1 - 0.64);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdata[index] = Math.floor(atten * 255.0 + 0.5);\r\n\t}\r\n\r\n\tstatic haloTexture(x: number, y: number, maxX: number, maxY: number, index: number, data: Uint8Array): void {\r\n\r\n\t\tmaxX >>= 1;\r\n\t\tmaxY >>= 1;\r\n\t\tvar xFac: number = (x - maxX) / maxX;\r\n\t\tvar yFac: number = (y - maxY) / maxY;\r\n\t\tvar sqrRange: number = xFac * xFac + yFac * yFac;\r\n\t\tif (sqrRange > 1.0) {\r\n\t\t\tsqrRange = 1.0;\r\n\t\t}\r\n\t\tdata[index] = Math.floor((1.0 - sqrRange) * 255.0 + 0.5);\r\n\t}\r\n\r\n\tstatic _generateTexture2D(texture: Texture2D, textureWidth: number, textureHeight: number, func: Function): void {\r\n\t\tvar index: number = 0;\r\n\t\tvar size: number = 0;\r\n\t\tswitch (texture.format) {\r\n\t\t\tcase TextureFormat.R8G8B8:\r\n\t\t\t\tsize = 3;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TextureFormat.R8G8B8A8:\r\n\t\t\t\tsize = 4;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TextureFormat.Alpha8:\r\n\t\t\t\tsize = 1;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow \"GeneratedTexture._generateTexture: unkonw texture format.\";\r\n\t\t}\r\n\r\n\t\tvar data: Uint8Array = new Uint8Array(textureWidth * textureHeight * size);\r\n\t\tfor (var y: number = 0; y < textureHeight; y++) {\r\n\t\t\tfor (var x: number = 0; x < textureWidth; x++) {\r\n\t\t\t\tfunc(x, y, textureWidth, textureHeight, index, data);\r\n\t\t\t\tindex += size;\r\n\t\t\t}\r\n\t\t}\r\n\t\ttexture.setPixelsData(data, false, false);\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Node } from \"../../display/Node\";\r\nimport { Texture2D } from \"../../resource/Texture2D\";\r\nimport { PixelLineSprite3D } from \"../core/pixelLine/PixelLineSprite3D\";\r\nimport { BoundBox } from \"../math/BoundBox\";\r\nimport { TextureGenerator } from \"../resource/TextureGenerator\";\r\nimport { ILaya3D } from \"../../../ILaya3D\";\r\nimport { HTMLCanvas } from \"../../resource/HTMLCanvas\";\r\nimport { TextureFormat } from \"../../RenderEngine/RenderEnum/TextureFormat\";\r\nimport { FilterMode } from \"../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { WrapMode } from \"../../RenderEngine/RenderEnum/WrapMode\";\r\nimport { RenderTargetFormat } from \"../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { LayaEnv } from \"../../../LayaEnv\";\r\nimport { Bounds } from \"../math/Bounds\";\r\nimport { Color } from \"../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../resource/RenderTexture\";\r\n\r\n/**\r\n * <code>Utils3D</code> 3D\r\n */\r\nexport class Utils3D {\r\n    private static _tempVector3_0: Vector3 = new Vector3();\r\n    private static _tempVector3_1: Vector3 = new Vector3();\r\n    private static _tempVector3_2: Vector3 = new Vector3();\r\n\r\n    private static _tempArray16_0: Float32Array = new Float32Array(16);\r\n    private static _tempArray16_1: Float32Array = new Float32Array(16);\r\n    private static _tempArray16_2: Float32Array = new Float32Array(16);\r\n    private static _tempArray16_3: Float32Array = new Float32Array(16);\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _createFloatTextureBuffer(width: number, height: number): Texture2D {\r\n        var floatTex: Texture2D = new Texture2D(width, height, TextureFormat.R32G32B32A32, false, false);\r\n        floatTex.setPixelsData(null, false, false);\r\n        floatTex.filterMode = FilterMode.Point;\r\n        floatTex.wrapModeU = WrapMode.Clamp;\r\n        floatTex.wrapModeV = WrapMode.Clamp;\r\n        floatTex.anisoLevel = 0;\r\n        return floatTex;\r\n    }\r\n\r\n    /**\r\n     *,\r\n     * @param tx left\r\n     * @param ty left\r\n     * @param tz right\r\n     * @param qx right\r\n     * @param qy \r\n     * @param qz \r\n     * @param qw \r\n     * @param sx \r\n     * @param sy \r\n     * @param sz \r\n     * @param outArray \r\n     * @param outOffset \r\n     */\r\n    private static _rotationTransformScaleSkinAnimation(tx: number, ty: number, tz: number, qx: number, qy: number, qz: number, qw: number, sx: number, sy: number, sz: number, outArray: Float32Array, outOffset: number): void {\r\n\r\n        var re: Float32Array = Utils3D._tempArray16_0;\r\n        var se: Float32Array = Utils3D._tempArray16_1;\r\n        var tse: Float32Array = Utils3D._tempArray16_2;\r\n\r\n        //\r\n\r\n        //\r\n        var x2: number = qx + qx;\r\n        var y2: number = qy + qy;\r\n        var z2: number = qz + qz;\r\n\r\n        var xx: number = qx * x2;\r\n        var yx: number = qy * x2;\r\n        var yy: number = qy * y2;\r\n        var zx: number = qz * x2;\r\n        var zy: number = qz * y2;\r\n        var zz: number = qz * z2;\r\n        var wx: number = qw * x2;\r\n        var wy: number = qw * y2;\r\n        var wz: number = qw * z2;\r\n\r\n        //re[3] = re[7] = re[11] = re[12] = re[13] = re[14] = 0;\r\n        re[15] = 1;\r\n        re[0] = 1 - yy - zz;\r\n        re[1] = yx + wz;\r\n        re[2] = zx - wy;\r\n\r\n        re[4] = yx - wz;\r\n        re[5] = 1 - xx - zz;\r\n        re[6] = zy + wx;\r\n\r\n        re[8] = zx + wy;\r\n        re[9] = zy - wx;\r\n        re[10] = 1 - xx - yy;\r\n\r\n        //\r\n        //se[4] = se[8] = se[12] = se[1] = se[9] = se[13] = se[2] = se[6] = se[14] = se[3] = se[7] = se[11] = 0;\r\n        se[15] = 1;\r\n        se[0] = sx;\r\n        se[5] = sy;\r\n        se[10] = sz;\r\n\r\n        var i: number, ai0: number, ai1: number, ai2: number, ai3: number;\r\n        //mul(rMat, tMat, tsMat)......................................\r\n        for (i = 0; i < 4; i++) {\r\n            ai0 = re[i];\r\n            ai1 = re[i + 4];\r\n            ai2 = re[i + 8];\r\n            ai3 = re[i + 12];\r\n            tse[i] = ai0;\r\n            tse[i + 4] = ai1;\r\n            tse[i + 8] = ai2;\r\n            tse[i + 12] = ai0 * tx + ai1 * ty + ai2 * tz + ai3;\r\n        }\r\n\r\n        //mul(tsMat, sMat, out)..............................................\r\n        for (i = 0; i < 4; i++) {\r\n            ai0 = tse[i];\r\n            ai1 = tse[i + 4];\r\n            ai2 = tse[i + 8];\r\n            ai3 = tse[i + 12];\r\n            outArray[i + outOffset] = ai0 * se[0] + ai1 * se[1] + ai2 * se[2] + ai3 * se[3];\r\n            outArray[i + outOffset + 4] = ai0 * se[4] + ai1 * se[5] + ai2 * se[6] + ai3 * se[7];\r\n            outArray[i + outOffset + 8] = ai0 * se[8] + ai1 * se[9] + ai2 * se[10] + ai3 * se[11];\r\n            outArray[i + outOffset + 12] = ai0 * se[12] + ai1 * se[13] + ai2 * se[14] + ai3 * se[15];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _compIdToNode: any = new Object();\r\n    static _tempV0: Vector3 = new Vector3();\r\n    static _tempV1: Vector3 = new Vector3();\r\n\r\n    /**\r\n     * billboard\r\n     */\r\n    static billboardTrans(v0: Vector3, cameraDir: Vector3, cameraUp: Vector3, out: Vector3) {\r\n        //vec3 positionOS = vertex.positionOS.x * normalize(cross(u_CameraDirection, u_CameraUp));\r\n        //positionOS += vertex.positionOS.y * normalize(u_CameraUp);\r\n        Vector3.normalize(cameraUp, Utils3D._tempV1);\r\n        Vector3.cross(cameraDir, cameraUp, Utils3D._tempV0);\r\n        Vector3.normalize(Utils3D._tempV0, Utils3D._tempV0);\r\n        Vector3.scale(Utils3D._tempV0, v0.x, out);\r\n        Vector3.scale(cameraUp, v0.y, Utils3D._tempV1);\r\n        Vector3.add(out, Utils3D._tempV1, out);\r\n    }\r\n\r\n    /**\r\n     * PABC\r\n     * https://mathworld.wolfram.com/BarycentricCoordinates.html\r\n     * @param A \r\n     * @param B \r\n     * @param C \r\n     * @param P \r\n     * @returns \r\n     */\r\n    static PointinTriangle(A: Vector3, B: Vector3, C: Vector3, P: Vector3): boolean {\r\n        let v0 = C.vsub(A, Utils3D._tempVector3_0);\r\n        let v1 = B.vsub(A, Utils3D._tempVector3_1);\r\n        let v2 = P.vsub(A, Utils3D._tempVector3_2);\r\n\r\n        let dot00 = v0.dot(v0);\r\n        let dot01 = v0.dot(v1);\r\n        let dot02 = v0.dot(v2);\r\n        let dot11 = v1.dot(v1);\r\n        let dot12 = v1.dot(v2);\r\n\r\n        let inverDeno = 1 / (dot00 * dot11 - dot01 * dot01);\r\n\r\n        let u = (dot11 * dot02 - dot01 * dot12) * inverDeno;\r\n        if (u < 0 || u > 1) // if u out of range, return directly\r\n        {\r\n            return false;\r\n        }\r\n\r\n\r\n        let v = (dot00 * dot12 - dot01 * dot02) * inverDeno;\r\n        if (v < 0 || v > 1) // if v out of range, return directly\r\n        {\r\n            return false;\r\n        }\r\n        return u + v <= 1;\r\n    }\r\n\r\n\r\n    /** @internal */\r\n    static _computeBoneAndAnimationDatasByBindPoseMatrxix(bones: any, curData: Float32Array, inverGlobalBindPose: Matrix4x4[], outBonesDatas: Float32Array, outAnimationDatas: Float32Array, boneIndexToMesh: number[]): void {\r\n\r\n        var offset: number = 0;\r\n        var matOffset: number = 0;\r\n\r\n        var i: number;\r\n        var parentOffset: number;\r\n        var boneLength: number = bones.length;\r\n        for (i = 0; i < boneLength; offset += bones[i].keyframeWidth, matOffset += 16, i++) {\r\n            //...........................................\r\n            Utils3D._rotationTransformScaleSkinAnimation(curData[offset + 0], curData[offset + 1], curData[offset + 2], curData[offset + 3], curData[offset + 4], curData[offset + 5], curData[offset + 6], curData[offset + 7], curData[offset + 8], curData[offset + 9], outBonesDatas, matOffset);\r\n\r\n            if (i != 0) {\r\n                parentOffset = bones[i].parentIndex * 16;\r\n                Utils3D.mulMatrixByArray(outBonesDatas, parentOffset, outBonesDatas, matOffset, outBonesDatas, matOffset);\r\n            }\r\n        }\r\n\r\n        var n: number = inverGlobalBindPose.length;\r\n        for (i = 0; i < n; i++)//................................................\r\n        {\r\n            Utils3D.mulMatrixByArrayAndMatrixFast(outBonesDatas, boneIndexToMesh[i] * 16, inverGlobalBindPose[i], outAnimationDatas, i * 16);//TODO:-1\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    static _computeAnimationDatasByArrayAndMatrixFast(inverGlobalBindPose: Matrix4x4[], bonesDatas: Float32Array, outAnimationDatas: Float32Array, boneIndexToMesh: number[]): void {\r\n        for (var i: number = 0, n: number = inverGlobalBindPose.length; i < n; i++)//\r\n            Utils3D.mulMatrixByArrayAndMatrixFast(bonesDatas, boneIndexToMesh[i] * 16, inverGlobalBindPose[i], outAnimationDatas, i * 16);//TODO:-1\r\n    }\r\n\r\n    /** @internal */\r\n    static _computeBoneAndAnimationDatasByBindPoseMatrxixOld(bones: any, curData: Float32Array, inverGlobalBindPose: Matrix4x4[], outBonesDatas: Float32Array, outAnimationDatas: Float32Array): void {\r\n\r\n        var offset: number = 0;\r\n        var matOffset: number = 0;\r\n\r\n        var i: number;\r\n        var parentOffset: number;\r\n        var boneLength: number = bones.length;\r\n        for (i = 0; i < boneLength; offset += bones[i].keyframeWidth, matOffset += 16, i++) {\r\n            //...........................................\r\n            Utils3D._rotationTransformScaleSkinAnimation(curData[offset + 7], curData[offset + 8], curData[offset + 9], curData[offset + 3], curData[offset + 4], curData[offset + 5], curData[offset + 6], curData[offset + 0], curData[offset + 1], curData[offset + 2], outBonesDatas, matOffset);\r\n\r\n            if (i != 0) {\r\n                parentOffset = bones[i].parentIndex * 16;\r\n                Utils3D.mulMatrixByArray(outBonesDatas, parentOffset, outBonesDatas, matOffset, outBonesDatas, matOffset);\r\n            }\r\n        }\r\n\r\n        var n: number = inverGlobalBindPose.length;\r\n        for (i = 0; i < n; i++)//................................................\r\n        {\r\n            var arrayOffset: number = i * 16;\r\n            Utils3D.mulMatrixByArrayAndMatrixFast(outBonesDatas, arrayOffset, inverGlobalBindPose[i], outAnimationDatas, arrayOffset);\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    static _computeAnimationDatasByArrayAndMatrixFastOld(inverGlobalBindPose: Matrix4x4[], bonesDatas: Float32Array, outAnimationDatas: Float32Array): void {\r\n        var n: number = inverGlobalBindPose.length;\r\n        for (var i: number = 0; i < n; i++)//................................................\r\n        {\r\n            var arrayOffset: number = i * 16;\r\n            Utils3D.mulMatrixByArrayAndMatrixFast(bonesDatas, arrayOffset, inverGlobalBindPose[i], outAnimationDatas, arrayOffset);\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    static _computeRootAnimationData(bones: any, curData: Float32Array, animationDatas: Float32Array): void {\r\n\r\n        for (var i: number = 0, offset: number = 0, matOffset: number = 0, boneLength: number = bones.length; i < boneLength; offset += bones[i].keyframeWidth, matOffset += 16, i++)\r\n            Utils3D.createAffineTransformationArray(curData[offset + 0], curData[offset + 1], curData[offset + 2], curData[offset + 3], curData[offset + 4], curData[offset + 5], curData[offset + 6], curData[offset + 7], curData[offset + 8], curData[offset + 9], animationDatas, matOffset);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsource \r\n     * @param\trotation \r\n     * @param\tout \r\n     */\r\n    static transformVector3ArrayByQuat(sourceArray: Float32Array, sourceOffset: number, rotation: Quaternion, outArray: Float32Array, outOffset: number): void {\r\n        var x: number = sourceArray[sourceOffset], y: number = sourceArray[sourceOffset + 1], z: number = sourceArray[sourceOffset + 2], qx: number = rotation.x, qy: number = rotation.y, qz: number = rotation.z, qw: number = rotation.w, ix: number = qw * x + qy * z - qz * y, iy: number = qw * y + qz * x - qx * z, iz: number = qw * z + qx * y - qy * x, iw: number = -qx * x - qy * y - qz * z;\r\n        outArray[outOffset] = ix * qw + iw * -qx + iy * -qz - iz * -qy;\r\n        outArray[outOffset + 1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;\r\n        outArray[outOffset + 2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param leftArray left\r\n     * @param leftOffset left\r\n     * @param rightArray right\r\n     * @param rightOffset right\r\n     * @param outArray \r\n     * @param outOffset \r\n     */\r\n    static mulMatrixByArray(leftArray: Float32Array, leftOffset: number, rightArray: Float32Array, rightOffset: number, outArray: Float32Array, outOffset: number): void {\r\n\r\n        var i: number, ai0: number, ai1: number, ai2: number, ai3: number;\r\n\r\n        if (outArray === rightArray) {\r\n            rightArray = Utils3D._tempArray16_3;\r\n            for (i = 0; i < 16; ++i) {\r\n                rightArray[i] = outArray[outOffset + i];\r\n            }\r\n            rightOffset = 0;\r\n        }\r\n\r\n        for (i = 0; i < 4; i++) {\r\n            ai0 = leftArray[leftOffset + i];\r\n            ai1 = leftArray[leftOffset + i + 4];\r\n            ai2 = leftArray[leftOffset + i + 8];\r\n            ai3 = leftArray[leftOffset + i + 12];\r\n            outArray[outOffset + i] = ai0 * rightArray[rightOffset + 0] + ai1 * rightArray[rightOffset + 1] + ai2 * rightArray[rightOffset + 2] + ai3 * rightArray[rightOffset + 3];\r\n            outArray[outOffset + i + 4] = ai0 * rightArray[rightOffset + 4] + ai1 * rightArray[rightOffset + 5] + ai2 * rightArray[rightOffset + 6] + ai3 * rightArray[rightOffset + 7];\r\n            outArray[outOffset + i + 8] = ai0 * rightArray[rightOffset + 8] + ai1 * rightArray[rightOffset + 9] + ai2 * rightArray[rightOffset + 10] + ai3 * rightArray[rightOffset + 11];\r\n            outArray[outOffset + i + 12] = ai0 * rightArray[rightOffset + 12] + ai1 * rightArray[rightOffset + 13] + ai2 * rightArray[rightOffset + 14] + ai3 * rightArray[rightOffset + 15];\r\n        }\r\n    }\r\n\r\n    /**\r\n     *,rightArrayoutArray\r\n     * @param leftArray left\r\n     * @param leftOffset left\r\n     * @param rightArray right\r\n     * @param rightOffset right\r\n     * @param outArray \r\n     * @param outOffset \r\n     */\r\n    static mulMatrixByArrayFast(leftArray: Float32Array, leftOffset: number, rightArray: Float32Array, rightOffset: number, outArray: Float32Array, outOffset: number): void {\r\n\r\n        var i: number, ai0: number, ai1: number, ai2: number, ai3: number;\r\n        for (i = 0; i < 4; i++) {\r\n            ai0 = leftArray[leftOffset + i];\r\n            ai1 = leftArray[leftOffset + i + 4];\r\n            ai2 = leftArray[leftOffset + i + 8];\r\n            ai3 = leftArray[leftOffset + i + 12];\r\n            outArray[outOffset + i] = ai0 * rightArray[rightOffset + 0] + ai1 * rightArray[rightOffset + 1] + ai2 * rightArray[rightOffset + 2] + ai3 * rightArray[rightOffset + 3];\r\n            outArray[outOffset + i + 4] = ai0 * rightArray[rightOffset + 4] + ai1 * rightArray[rightOffset + 5] + ai2 * rightArray[rightOffset + 6] + ai3 * rightArray[rightOffset + 7];\r\n            outArray[outOffset + i + 8] = ai0 * rightArray[rightOffset + 8] + ai1 * rightArray[rightOffset + 9] + ai2 * rightArray[rightOffset + 10] + ai3 * rightArray[rightOffset + 11];\r\n            outArray[outOffset + i + 12] = ai0 * rightArray[rightOffset + 12] + ai1 * rightArray[rightOffset + 13] + ai2 * rightArray[rightOffset + 14] + ai3 * rightArray[rightOffset + 15];\r\n        }\r\n    }\r\n\r\n    /**\r\n     *,rightArrayoutArray\r\n     * @param leftArray left\r\n     * @param leftOffset left\r\n     * @param rightMatrix right\r\n     * @param outArray \r\n     * @param outOffset \r\n     */\r\n    static mulMatrixByArrayAndMatrixFast(leftArray: Float32Array, leftOffset: number, rightMatrix: Matrix4x4, outArray: Float32Array, outOffset: number): void {\r\n\r\n        var i: number, ai0: number, ai1: number, ai2: number, ai3: number;\r\n        var rightMatrixE: Float32Array = rightMatrix.elements;\r\n        var m11: number = rightMatrixE[0], m12: number = rightMatrixE[1], m13: number = rightMatrixE[2], m14: number = rightMatrixE[3];\r\n        var m21: number = rightMatrixE[4], m22: number = rightMatrixE[5], m23: number = rightMatrixE[6], m24: number = rightMatrixE[7];\r\n        var m31: number = rightMatrixE[8], m32: number = rightMatrixE[9], m33: number = rightMatrixE[10], m34: number = rightMatrixE[11];\r\n        var m41: number = rightMatrixE[12], m42: number = rightMatrixE[13], m43: number = rightMatrixE[14], m44: number = rightMatrixE[15];\r\n        var ai0LeftOffset: number = leftOffset;\r\n        var ai1LeftOffset: number = leftOffset + 4;\r\n        var ai2LeftOffset: number = leftOffset + 8;\r\n        var ai3LeftOffset: number = leftOffset + 12;\r\n        var ai0OutOffset: number = outOffset;\r\n        var ai1OutOffset: number = outOffset + 4;\r\n        var ai2OutOffset: number = outOffset + 8;\r\n        var ai3OutOffset: number = outOffset + 12;\r\n\r\n        for (i = 0; i < 4; i++) {\r\n            ai0 = leftArray[ai0LeftOffset + i];\r\n            ai1 = leftArray[ai1LeftOffset + i];\r\n            ai2 = leftArray[ai2LeftOffset + i];\r\n            ai3 = leftArray[ai3LeftOffset + i];\r\n            outArray[ai0OutOffset + i] = ai0 * m11 + ai1 * m12 + ai2 * m13 + ai3 * m14;\r\n            outArray[ai1OutOffset + i] = ai0 * m21 + ai1 * m22 + ai2 * m23 + ai3 * m24;\r\n            outArray[ai2OutOffset + i] = ai0 * m31 + ai1 * m32 + ai2 * m33 + ai3 * m34;\r\n            outArray[ai3OutOffset + i] = ai0 * m41 + ai1 * m42 + ai2 * m43 + ai3 * m44;\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param tX left\r\n     * @param tY left\r\n     * @param tZ right\r\n     * @param qX right\r\n     * @param qY \r\n     * @param qZ \r\n     * @param qW \r\n     * @param sX \r\n     * @param sY \r\n     * @param sZ \r\n     * @param outArray \r\n     * @param outOffset \r\n     */\r\n    static createAffineTransformationArray(tX: number, tY: number, tZ: number, rX: number, rY: number, rZ: number, rW: number, sX: number, sY: number, sZ: number, outArray: Float32Array, outOffset: number): void {\r\n\r\n        var x2: number = rX + rX, y2: number = rY + rY, z2: number = rZ + rZ;\r\n        var xx: number = rX * x2, xy: number = rX * y2, xz: number = rX * z2, yy: number = rY * y2, yz: number = rY * z2, zz: number = rZ * z2;\r\n        var wx: number = rW * x2, wy: number = rW * y2, wz: number = rW * z2;\r\n\r\n        outArray[outOffset + 0] = (1 - (yy + zz)) * sX;\r\n        outArray[outOffset + 1] = (xy + wz) * sX;\r\n        outArray[outOffset + 2] = (xz - wy) * sX;\r\n        outArray[outOffset + 3] = 0;\r\n        outArray[outOffset + 4] = (xy - wz) * sY;\r\n        outArray[outOffset + 5] = (1 - (xx + zz)) * sY;\r\n        outArray[outOffset + 6] = (yz + wx) * sY;\r\n        outArray[outOffset + 7] = 0;\r\n        outArray[outOffset + 8] = (xz + wy) * sZ;\r\n        outArray[outOffset + 9] = (yz - wx) * sZ;\r\n        outArray[outOffset + 10] = (1 - (xx + yy)) * sZ;\r\n        outArray[outOffset + 11] = 0;\r\n        outArray[outOffset + 12] = tX;\r\n        outArray[outOffset + 13] = tY;\r\n        outArray[outOffset + 14] = tZ;\r\n        outArray[outOffset + 15] = 1;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsource \r\n     * @param\tsourceOffset \r\n     * @param\ttransform  \r\n     * @param\tresult \r\n     * @param\tresultOffset \r\n     */\r\n    static transformVector3ArrayToVector3ArrayCoordinate(source: Float32Array, sourceOffset: number, transform: Matrix4x4, result: Float32Array, resultOffset: number): void {\r\n        var coordinateX: number = source[sourceOffset + 0];\r\n        var coordinateY: number = source[sourceOffset + 1];\r\n        var coordinateZ: number = source[sourceOffset + 2];\r\n\r\n        var transformElem: Float32Array = transform.elements;\r\n        var w: number = ((coordinateX * transformElem[3]) + (coordinateY * transformElem[7]) + (coordinateZ * transformElem[11]) + transformElem[15]);\r\n        result[resultOffset] = (coordinateX * transformElem[0]) + (coordinateY * transformElem[4]) + (coordinateZ * transformElem[8]) + transformElem[12] / w;\r\n        result[resultOffset + 1] = (coordinateX * transformElem[1]) + (coordinateY * transformElem[5]) + (coordinateZ * transformElem[9]) + transformElem[13] / w;\r\n        result[resultOffset + 2] = (coordinateX * transformElem[2]) + (coordinateY * transformElem[6]) + (coordinateZ * transformElem[10]) + transformElem[14] / w;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param source \r\n     * @param sourceOffset \r\n     * @param transform \r\n     * @param result \r\n     * @param resultOffset \r\n     */\r\n    static transformVector3ArrayToVector3ArrayNormal(source: Float32Array, sourceOffset: number, transform: Matrix4x4, result: Float32Array, resultOffset: number): void {\r\n        var coordinateX: number = source[sourceOffset + 0];\r\n        var coordinateY: number = source[sourceOffset + 1];\r\n        var coordinateZ: number = source[sourceOffset + 2];\r\n\r\n        var transformElem: Float32Array = transform.elements;\r\n        result[resultOffset] = coordinateX * transformElem[0] + coordinateY * transformElem[4] + coordinateZ * transformElem[8];\r\n        result[resultOffset + 1] = coordinateX * transformElem[1] + coordinateY * transformElem[5] + coordinateZ * transformElem[9];\r\n        result[resultOffset + 2] = coordinateX * transformElem[2] + coordinateY * transformElem[6] + coordinateZ * transformElem[10];\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static transformLightingMapTexcoordArray(source: Float32Array, sourceOffset: number, lightingMapScaleOffset: Vector4, result: Float32Array, resultOffset: number): void {\r\n        result[resultOffset + 0] = source[sourceOffset + 0] * lightingMapScaleOffset.x + lightingMapScaleOffset.z;\r\n        result[resultOffset + 1] = 1.0 - ((1.0 - source[sourceOffset + 1]) * lightingMapScaleOffset.y + lightingMapScaleOffset.w);\r\n    }\r\n\r\n    /**\r\n     * URL\r\n     * @param\turl\r\n     * @return\r\n     */\r\n    static getURLVerion(url: string): string {\r\n        var index: number = url.indexOf(\"?\");\r\n        return index >= 0 ? url.substr(index) : null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _createAffineTransformationArray(trans: Vector3, rot: Quaternion, scale: Vector3, outE: Float32Array): void {\r\n\r\n        var x: number = rot.x, y: number = rot.y, z: number = rot.z, w: number = rot.w, x2: number = x + x, y2: number = y + y, z2: number = z + z;\r\n        var xx: number = x * x2, xy: number = x * y2, xz: number = x * z2, yy: number = y * y2, yz: number = y * z2, zz: number = z * z2;\r\n        var wx: number = w * x2, wy: number = w * y2, wz: number = w * z2, sx: number = scale.x, sy: number = scale.y, sz: number = scale.z;\r\n\r\n        outE[0] = (1 - (yy + zz)) * sx;\r\n        outE[1] = (xy + wz) * sx;\r\n        outE[2] = (xz - wy) * sx;\r\n        outE[3] = 0;\r\n        outE[4] = (xy - wz) * sy;\r\n        outE[5] = (1 - (xx + zz)) * sy;\r\n        outE[6] = (yz + wx) * sy;\r\n        outE[7] = 0;\r\n        outE[8] = (xz + wy) * sz;\r\n        outE[9] = (yz - wx) * sz;\r\n        outE[10] = (1 - (xx + yy)) * sz;\r\n        outE[11] = 0;\r\n        outE[12] = trans.x;\r\n        outE[13] = trans.y;\r\n        outE[14] = trans.z;\r\n        outE[15] = 1;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _mulMatrixArray(left: Float32Array, right: Float32Array, rightOffset: number, outArray: Float32Array, outOffset: number): void {\r\n        var l: Float32Array = right;\r\n        var r: Float32Array = left;\r\n        var e: Float32Array = outArray;\r\n\r\n        var l11: number = l[rightOffset], l12: number = l[rightOffset + 1], l13: number = l[rightOffset + 2], l14: number = l[rightOffset + 3];\r\n        var l21: number = l[rightOffset + 4], l22: number = l[rightOffset + 5], l23: number = l[rightOffset + 6], l24: number = l[rightOffset + 7];\r\n        var l31: number = l[rightOffset + 8], l32: number = l[rightOffset + 9], l33: number = l[rightOffset + 10], l34: number = l[rightOffset + 11];\r\n        var l41: number = l[rightOffset + 12], l42: number = l[rightOffset + 13], l43: number = l[rightOffset + 14], l44: number = l[rightOffset + 15];\r\n\r\n        var r11: number = r[0], r12: number = r[1], r13: number = r[2], r14: number = r[3];\r\n        var r21: number = r[4], r22: number = r[5], r23: number = r[6], r24: number = r[7];\r\n        var r31: number = r[8], r32: number = r[9], r33: number = r[10], r34: number = r[11];\r\n        var r41: number = r[12], r42: number = r[13], r43: number = r[14], r44: number = r[15];\r\n\r\n        e[outOffset] = (l11 * r11) + (l12 * r21) + (l13 * r31) + (l14 * r41);\r\n        e[outOffset + 1] = (l11 * r12) + (l12 * r22) + (l13 * r32) + (l14 * r42);\r\n        e[outOffset + 2] = (l11 * r13) + (l12 * r23) + (l13 * r33) + (l14 * r43);\r\n        e[outOffset + 3] = (l11 * r14) + (l12 * r24) + (l13 * r34) + (l14 * r44);\r\n        e[outOffset + 4] = (l21 * r11) + (l22 * r21) + (l23 * r31) + (l24 * r41);\r\n        e[outOffset + 5] = (l21 * r12) + (l22 * r22) + (l23 * r32) + (l24 * r42);\r\n        e[outOffset + 6] = (l21 * r13) + (l22 * r23) + (l23 * r33) + (l24 * r43);\r\n        e[outOffset + 7] = (l21 * r14) + (l22 * r24) + (l23 * r34) + (l24 * r44);\r\n        e[outOffset + 8] = (l31 * r11) + (l32 * r21) + (l33 * r31) + (l34 * r41);\r\n        e[outOffset + 9] = (l31 * r12) + (l32 * r22) + (l33 * r32) + (l34 * r42);\r\n        e[outOffset + 10] = (l31 * r13) + (l32 * r23) + (l33 * r33) + (l34 * r43);\r\n        e[outOffset + 11] = (l31 * r14) + (l32 * r24) + (l33 * r34) + (l34 * r44);\r\n        e[outOffset + 12] = (l41 * r11) + (l42 * r21) + (l43 * r31) + (l44 * r41);\r\n        e[outOffset + 13] = (l41 * r12) + (l42 * r22) + (l43 * r32) + (l44 * r42);\r\n        e[outOffset + 14] = (l41 * r13) + (l42 * r23) + (l43 * r33) + (l44 * r43);\r\n        e[outOffset + 15] = (l41 * r14) + (l42 * r24) + (l43 * r34) + (l44 * r44);\r\n    }\r\n\r\n    /**@internal */\r\n    private static arcTanAngle(x: number, y: number): number {\r\n\r\n        if (x == 0) {\r\n            if (y == 1)\r\n                return Math.PI / 2;\r\n            return -Math.PI / 2;\r\n        }\r\n        if (x > 0)\r\n            return Math.atan(y / x);\r\n        if (x < 0) {\r\n            if (y > 0)\r\n                return Math.atan(y / x) + Math.PI;\r\n            return Math.atan(y / x) - Math.PI;\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    /**@internal */\r\n    static angleTo(from: Vector3, location: Vector3, angle: Vector3): void {\r\n\r\n        Vector3.subtract(location, from, TEMPVector30);\r\n        Vector3.normalize(TEMPVector30, TEMPVector30);\r\n\r\n        angle.x = Math.asin(TEMPVector30.y);\r\n        angle.y = Utils3D.arcTanAngle(-TEMPVector30.z, -TEMPVector30.x);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param source \r\n     * @param rotation Array\r\n     * @param out \r\n     */\r\n    static transformQuat(source: Vector3, rotation: Float32Array, out: Vector3): void {\r\n        var re: Float32Array = rotation;\r\n\r\n        var x: number = source.x, y: number = source.y, z: number = source.z, qx: number = re[0], qy: number = re[1], qz: number = re[2], qw: number = re[3],\r\n\r\n            ix: number = qw * x + qy * z - qz * y, iy: number = qw * y + qz * x - qx * z, iz: number = qw * z + qx * y - qy * x, iw: number = -qx * x - qy * y - qz * z;\r\n\r\n        out.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\r\n        out.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\r\n        out.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param f \r\n     * @param weight \r\n     * @param e \r\n     */\r\n    static quaternionWeight(f: Quaternion, weight: number, e: Quaternion): void {\r\n        e.x = f.x * weight;\r\n        e.y = f.y * weight;\r\n        e.z = f.z * weight;\r\n        e.w = f.w;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static quaternionConjugate(value: Quaternion, result: Quaternion): void {\r\n        result.x = -value.x;\r\n        result.y = -value.y;\r\n        result.z = -value.z;\r\n        result.w = value.w;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static scaleWeight(s: Vector3, w: number, out: Vector3): void {\r\n        var sX: number = s.x, sY: number = s.y, sZ: number = s.z;\r\n        out.x = sX > 0 ? Math.pow(Math.abs(sX), w) : -Math.pow(Math.abs(sX), w);\r\n        out.y = sY > 0 ? Math.pow(Math.abs(sY), w) : -Math.pow(Math.abs(sY), w);\r\n        out.z = sZ > 0 ? Math.pow(Math.abs(sZ), w) : -Math.pow(Math.abs(sZ), w);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static scaleBlend(sa: Vector3, sb: Vector3, w: number, out: Vector3): void {\r\n        var saw: Vector3 = Utils3D._tempVector3_0;\r\n        var sbw: Vector3 = Utils3D._tempVector3_1;\r\n        Utils3D.scaleWeight(sa, 1.0 - w, saw);\r\n        Utils3D.scaleWeight(sb, w, sbw);\r\n        var sng: Vector3 = w > 0.5 ? sb : sa;\r\n        out.x = sng.x > 0 ? Math.abs(saw.x * sbw.x) : -Math.abs(saw.x * sbw.x);\r\n        out.y = sng.y > 0 ? Math.abs(saw.y * sbw.y) : -Math.abs(saw.y * sbw.y);\r\n        out.z = sng.z > 0 ? Math.abs(saw.z * sbw.z) : -Math.abs(saw.z * sbw.z);\r\n    }\r\n\r\n\r\n    /**@internal */\r\n    static matrix4x4MultiplyFFF(a: Float32Array, b: Float32Array, e: Float32Array): void {\r\n\r\n        var i: number, ai0: number, ai1: number, ai2: number, ai3: number;\r\n        if (e === b) {\r\n            b = new Float32Array(16);\r\n            for (i = 0; i < 16; ++i) {\r\n                b[i] = e[i];\r\n            }\r\n        }\r\n\r\n        var b0: number = b[0], b1: number = b[1], b2: number = b[2], b3: number = b[3];\r\n        var b4: number = b[4], b5: number = b[5], b6: number = b[6], b7: number = b[7];\r\n        var b8: number = b[8], b9: number = b[9], b10: number = b[10], b11: number = b[11];\r\n        var b12: number = b[12], b13: number = b[13], b14: number = b[14], b15: number = b[15];\r\n\r\n        for (i = 0; i < 4; i++) {\r\n            ai0 = a[i];\r\n            ai1 = a[i + 4];\r\n            ai2 = a[i + 8];\r\n            ai3 = a[i + 12];\r\n            e[i] = ai0 * b0 + ai1 * b1 + ai2 * b2 + ai3 * b3;\r\n            e[i + 4] = ai0 * b4 + ai1 * b5 + ai2 * b6 + ai3 * b7;\r\n            e[i + 8] = ai0 * b8 + ai1 * b9 + ai2 * b10 + ai3 * b11;\r\n            e[i + 12] = ai0 * b12 + ai1 * b13 + ai2 * b14 + ai3 * b15;\r\n        }\r\n    }\r\n\r\n    /**@internal */\r\n    static matrix4x4MultiplyMFM(left: Matrix4x4, right: Float32Array, out: Matrix4x4): void {\r\n        Utils3D.matrix4x4MultiplyFFF(left.elements, right, out.elements);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _buildTexture2D(width: number, height: number, format: number, colorFunc: Function, mipmaps: boolean = false): Texture2D {\r\n        var texture: Texture2D = new Texture2D(width, height, format, mipmaps, true);\r\n        texture.anisoLevel = 1;\r\n        texture.filterMode = FilterMode.Point;\r\n        TextureGenerator._generateTexture2D(texture, width, height, colorFunc);\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _drawBound(debugLine: PixelLineSprite3D, boundBox: BoundBox | Bounds, color: Color): void {\r\n        if (debugLine.lineCount + 12 > debugLine.maxLineCount)\r\n            debugLine.maxLineCount += 12;\r\n\r\n        var start: Vector3 = Utils3D._tempVector3_0;\r\n        var end: Vector3 = Utils3D._tempVector3_1;\r\n        var min: Vector3 = boundBox.min;\r\n        var max: Vector3 = boundBox.max;\r\n\r\n        start.setValue(min.x, min.y, min.z);\r\n        end.setValue(max.x, min.y, min.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(min.x, min.y, min.z);\r\n        end.setValue(min.x, min.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(max.x, min.y, min.z);\r\n        end.setValue(max.x, min.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(min.x, min.y, max.z);\r\n        end.setValue(max.x, min.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(min.x, min.y, min.z);\r\n        end.setValue(min.x, max.y, min.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(min.x, min.y, max.z);\r\n        end.setValue(min.x, max.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(max.x, min.y, min.z);\r\n        end.setValue(max.x, max.y, min.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(max.x, min.y, max.z);\r\n        end.setValue(max.x, max.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(min.x, max.y, min.z);\r\n        end.setValue(max.x, max.y, min.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(min.x, max.y, min.z);\r\n        end.setValue(min.x, max.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(max.x, max.y, min.z);\r\n        end.setValue(max.x, max.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(min.x, max.y, max.z);\r\n        end.setValue(max.x, max.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n    }\r\n\r\n    ///**@internal */\r\n    //private static var _tempHierarchyID:int = 0;\r\n    //\r\n    ///**\r\n    //* @internal\r\n    //*/\r\n    //public static function _getSpritesHierarchyID(sprite:Sprite3D, checkSprites:Array, outIDs:Array):void {\r\n    //var index:int = checkSprites.indexOf(sprite);\r\n    //if (index !== -1)\r\n    //outIDs[index] = _tempHierarchyID;\r\n    //_tempHierarchyID++;\r\n    //var children:Array = sprite._children;\r\n    //for (var i:int = 0, n:int = children.length; i < n; i++)\r\n    //_getSpritesHierarchyID(children[i], checkSprites, outIDs);\r\n    //}\r\n\r\n    /**\r\n     * @internal\r\n     * @param rootSprite parent Sprite\r\n     * @param checkSprite check Sprite\r\n     * @param path pathArray\r\n     * @returns \r\n     */\r\n    static _getHierarchyPath(rootSprite: Node, checkSprite: Node, path: number[]): any[] {\r\n        path.length = 0;\r\n        var sprite: Node = checkSprite;\r\n        while (sprite !== rootSprite) {\r\n            var parent: Node = sprite._parent;\r\n            if (parent)\r\n                path.push(parent.getChildIndex(sprite));\r\n            else\r\n                return null;\r\n            sprite = parent;\r\n        }\r\n        return path;\r\n    }\r\n\r\n    /**\r\n     * @interanl\r\n     * @param rootSprite parentNode\r\n     * @param invPath PathArray\r\n     * @returns \r\n     */\r\n    static _getNodeByHierarchyPath(rootSprite: Node, invPath: number[]): Node {\r\n        var sprite: Node = rootSprite;\r\n        for (var i: number = invPath.length - 1; i >= 0; i--) {\r\n            sprite = sprite.getChildAt(invPath[i]);\r\n        }\r\n        return sprite;\r\n    }\r\n\r\n    static _getParentNodeByHierarchyPath(rootSprite: Node, path: number[]): Node {\r\n        let pathlength = path.length;\r\n        let node: Node = rootSprite;\r\n        for (let i = 0; i < pathlength; i++) {\r\n            if (node)\r\n                node = node.parent;\r\n            else\r\n                return null;\r\n        }\r\n        return node;\r\n    }\r\n\r\n\r\n    /**\r\n     * RenderTextureBase64\r\n     * @param rendertexture Buffer\r\n     * @returns \r\n     */\r\n    static uint8ArrayToArrayBuffer(rendertexture: RenderTexture) {\r\n        let pixelArray: Uint8Array | Float32Array;\r\n        let width = rendertexture.width;\r\n        let height = rendertexture.height;\r\n        switch (rendertexture.colorFormat) {\r\n            case RenderTargetFormat.R8G8B8:\r\n                pixelArray = new Uint8Array(width * height * 4);\r\n                break;\r\n            case RenderTargetFormat.R8G8B8A8:\r\n                pixelArray = new Uint8Array(width * height * 4);\r\n                break;\r\n            case RenderTargetFormat.R16G16B16A16:\r\n                pixelArray = new Float32Array(width * height * 4);\r\n                break;\r\n            default:\r\n                throw \"this function is not surpprt \" + rendertexture.format.toString() + \"format Material\";\r\n        }\r\n        rendertexture.getData(0, 0, rendertexture.width, rendertexture.height, pixelArray);\r\n        //tranceTo\r\n        //throw \" rt get Data\";\r\n        switch (rendertexture.colorFormat) {\r\n            case RenderTargetFormat.R16G16B16A16:\r\n                let ori = pixelArray;\r\n                let trans = new Uint8Array(width * height * 4);\r\n                for (let i = 0, n = ori.length; i < n; i++) {\r\n                    trans[i] = Math.min(Math.floor(ori[i] * 255), 255);\r\n                }\r\n                pixelArray = trans;\r\n                break;\r\n        }\r\n\r\n        let pixels = pixelArray;\r\n        var bs: String;\r\n        if (LayaEnv.isConch) {\r\n            //TODO:\r\n            //var base64img=__JS__(\"conchToBase64('image/png',1,pixels,canvasWidth,canvasHeight)\");\r\n            //var l = base64img.split(\",\");\r\n            //if (isBase64)\r\n            //\treturn base64img;\r\n            //return base.utils.DBUtils.decodeArrayBuffer(l[1]);\r\n        }\r\n        else {\r\n            var canv: HTMLCanvas = new HTMLCanvas(true);\r\n            canv.lock = true;\r\n            canv.size(width, height);\r\n            var ctx2d = canv.getContext('2d');\r\n            //@ts-ignore\r\n            var imgdata: ImageData = ctx2d.createImageData(width, height);\r\n            //@ts-ignore\r\n            imgdata.data.set(new Uint8ClampedArray(pixels));\r\n            //@ts-ignore\r\n            ctx2d.putImageData(imgdata, 0, 0);;\r\n            bs = canv.source.toDataURL();\r\n            canv.destroy();\r\n        }\r\n        return bs;\r\n    }\r\n}\r\n\r\n(window as any).getRTBase64 = Utils3D.uint8ArrayToArrayBuffer;\r\nconst TEMPVector30 = new Vector3();","import { AnimationClipParser03 } from \"./AnimationClipParser03\";\r\nimport { AnimationClipParser04 } from \"./AnimationClipParser04\";\r\nimport { KeyframeNodeList } from \"./KeyframeNodeList\";\r\nimport { AnimationEvent } from \"./AnimationEvent\";\r\nimport { FloatKeyframe } from \"../core/FloatKeyframe\"\r\nimport { QuaternionKeyframe } from \"../core/QuaternionKeyframe\"\r\nimport { Vector3Keyframe } from \"../core/Vector3Keyframe\"\r\nimport { Utils3D } from \"../utils/Utils3D\"\r\nimport { Resource } from \"../../resource/Resource\"\r\nimport { Byte } from \"../../utils/Byte\"\r\nimport { Handler } from \"../../utils/Handler\"\r\nimport { ILaya } from \"../../../ILaya\";\r\nimport { WeightedMode } from \"../core/Keyframe\";\r\nimport { Loader } from \"../../net/Loader\";\r\nimport { Vector2Keyframe } from \"../core/Vector2Keyframe\";\r\nimport { Vector4Keyframe } from \"../core/Vector4Keyframe\";\r\nimport { AvatarMask } from \"../component/Animator/AvatarMask\";\r\nimport { KeyFrameValueType } from \"../component/Animator/KeyframeNodeOwner\";\r\nimport { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector2 } from \"../../maths/Vector2\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\n\r\n/**\r\n * <code>AnimationClip</code> \r\n */\r\nexport class AnimationClip extends Resource {\r\n\r\n\t/**@internal\t*/\r\n\tstatic _tempQuaternion0: Quaternion = new Quaternion();\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @internal\r\n\t */\r\n\tstatic _parse(data: any): AnimationClip {\r\n\t\tvar clip = new AnimationClip();\r\n\t\tvar reader = new Byte(data);\r\n\t\tvar version = reader.readUTFString();\r\n\t\tswitch (version) {\r\n\t\t\tcase \"LAYAANIMATION:03\":\r\n\t\t\t\tAnimationClipParser03.parse(clip, reader);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"LAYAANIMATION:04\":\r\n\t\t\tcase \"LAYAANIMATION:COMPRESSION_04\":\r\n\t\t\tcase \"LAYAANIMATION:WEIGHT_04\":\r\n\t\t\tcase \"LAYAANIMATION:WEIGHT_05\":\r\n\t\t\t\tAnimationClipParser04.parse(clip, reader, version);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow \"unknown animationClip version.\";\r\n\t\t}\r\n\t\treturn clip;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param url \r\n\t * @param complete  load\r\n\t */\r\n\tstatic load(url: string, complete: Handler): void {\r\n\t\tILaya.loader.load(url, complete, null, Loader.ANIMATIONCLIP);\r\n\t}\r\n\r\n\t/**@internal */\r\n\t_duration: number = 0;\r\n\t/**@internal */\r\n\t_frameRate: number = 0;\r\n\t/**@internal */\r\n\t_nodes: KeyframeNodeList | null = new KeyframeNodeList();\r\n\t/**@internal */\r\n\t_nodesDic: any;\r\n\t/**@internal */\r\n\t_nodesMap: any;//TODO:\r\n\t/** @internal */\r\n\t_animationEvents: AnimationEvent[];\r\n\r\n\t/***/\r\n\tislooping: boolean = false;\r\n\r\n\t/**\r\n\t * \r\n\t * @returns \r\n\t */\r\n\tduration(): number {\r\n\t\treturn this._duration;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>AnimationClip</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._animationEvents = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Weight\r\n\t * @param weightMode \r\n\t * @param nextweightMode \r\n\t * @returns true \r\n\t */\r\n\tprivate _weightModeHermite(weightMode: number, nextweightMode: number): boolean {\r\n\t\treturn (((weightMode & WeightedMode.Out) == 0) && ((nextweightMode & WeightedMode.In) == 0));\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _hermiteInterpolate(frame: FloatKeyframe, nextFrame: FloatKeyframe, t: number, dur: number): number {\r\n\t\tvar t0 = frame.outTangent, t1 = nextFrame.inTangent;\r\n\t\tif (Number.isFinite(t0) && Number.isFinite(t1)) {\r\n\t\t\tvar t2 = t * t;\r\n\t\t\tvar t3 = t2 * t;\r\n\t\t\tvar a = 2.0 * t3 - 3.0 * t2 + 1.0;\r\n\t\t\tvar b = t3 - 2.0 * t2 + t;\r\n\t\t\tvar c = t3 - t2;\r\n\t\t\tvar d = -2.0 * t3 + 3.0 * t2;\r\n\t\t\treturn a * frame.value + b * t0 * dur + c * t1 * dur + d * nextFrame.value;\r\n\t\t} else\r\n\t\t\treturn frame.value;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _hermiteInterpolateVector3(frame: Vector3Keyframe, nextFrame: Vector3Keyframe, t: number, dur: number, out: Vector3): void {\r\n\t\tvar p0 = frame.value;\r\n\t\tvar tan0 = frame.outTangent;\r\n\t\tvar p1 = nextFrame.value;\r\n\t\tvar tan1 = nextFrame.inTangent;\r\n\r\n\t\tvar t2 = t * t;\r\n\t\tvar t3 = t2 * t;\r\n\t\tvar a = 2.0 * t3 - 3.0 * t2 + 1.0;\r\n\t\tvar b = t3 - 2.0 * t2 + t;\r\n\t\tvar c = t3 - t2;\r\n\t\tvar d = -2.0 * t3 + 3.0 * t2;\r\n\r\n\t\tvar t0 = tan0.x, t1 = tan1.x;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.x, nextFrame.weightedMode.x)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.x = a * p0.x + b * t0 * dur + c * t1 * dur + d * p1.x;\r\n\t\t\telse\r\n\t\t\t\tout.x = p0.x;\r\n\t\t} else {\r\n\t\t\tout.x = this._hermiteCurveSplineWeight(frame.value.x, frame.time, frame.outWeight.x, frame.outTangent.x,\r\n\t\t\t\tnextFrame.value.x, nextFrame.time, nextFrame.inWeight.x, nextFrame.inTangent.x, t);\r\n\t\t}\r\n\r\n\t\tt0 = tan0.y, t1 = tan1.y;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.y, nextFrame.weightedMode.y)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.y = a * p0.y + b * t0 * dur + c * t1 * dur + d * p1.y;\r\n\t\t\telse\r\n\t\t\t\tout.y = p0.y;\r\n\t\t} else {\r\n\t\t\tout.y = this._hermiteCurveSplineWeight(frame.value.y, frame.time, frame.outWeight.y, frame.outTangent.y,\r\n\t\t\t\tnextFrame.value.y, nextFrame.time, nextFrame.inWeight.y, nextFrame.inTangent.y, t);\r\n\t\t}\r\n\r\n\t\tt0 = tan0.z, t1 = tan1.z;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.z, nextFrame.weightedMode.z)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.z = a * p0.z + b * t0 * dur + c * t1 * dur + d * p1.z;\r\n\t\t\telse\r\n\t\t\t\tout.z = p0.z;\r\n\t\t} else {\r\n\t\t\tout.z = this._hermiteCurveSplineWeight(frame.value.z, frame.time, frame.outWeight.z, frame.outTangent.z,\r\n\t\t\t\tnextFrame.value.z, nextFrame.time, nextFrame.inWeight.z, nextFrame.inTangent.z, t);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _hermiteInterpolateQuaternion(frame: QuaternionKeyframe, nextFrame: QuaternionKeyframe, t: number, dur: number, out: Quaternion): void {\r\n\t\tvar p0 = frame.value;\r\n\t\tvar tan0 = frame.outTangent;\r\n\t\tvar p1 = nextFrame.value;\r\n\t\tvar tan1 = nextFrame.inTangent;\r\n\r\n\t\tvar t2 = t * t;\r\n\t\tvar t3 = t2 * t;\r\n\t\tvar a = 2.0 * t3 - 3.0 * t2 + 1.0;\r\n\t\tvar b = t3 - 2.0 * t2 + t;\r\n\t\tvar c = t3 - t2;\r\n\t\tvar d = -2.0 * t3 + 3.0 * t2;\r\n\r\n\t\tvar t0 = tan0.x, t1 = tan1.x;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.x, nextFrame.weightedMode.x)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.x = a * p0.x + b * t0 * dur + c * t1 * dur + d * p1.x;\r\n\t\t\telse\r\n\t\t\t\tout.x = p0.x;\r\n\t\t} else {\r\n\t\t\tout.x = this._hermiteCurveSplineWeight(frame.value.x, frame.time, frame.outWeight.x, frame.outTangent.x,\r\n\t\t\t\tnextFrame.value.x, nextFrame.time, nextFrame.inWeight.x, nextFrame.inTangent.x, t);\r\n\t\t}\r\n\r\n\r\n\t\tt0 = tan0.y, t1 = tan1.y;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.y, nextFrame.weightedMode.y)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.y = a * p0.y + b * t0 * dur + c * t1 * dur + d * p1.y;\r\n\t\t\telse\r\n\t\t\t\tout.y = p0.y;\r\n\t\t} else {\r\n\t\t\tout.y = this._hermiteCurveSplineWeight(frame.value.y, frame.time, frame.outWeight.y, frame.outTangent.y,\r\n\t\t\t\tnextFrame.value.y, nextFrame.time, nextFrame.inWeight.y, nextFrame.inTangent.y, t);\r\n\t\t}\r\n\r\n\t\tt0 = tan0.z, t1 = tan1.z;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.z, nextFrame.weightedMode.z)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.z = a * p0.z + b * t0 * dur + c * t1 * dur + d * p1.z;\r\n\t\t\telse\r\n\t\t\t\tout.z = p0.z;\r\n\t\t} else {\r\n\t\t\tout.z = this._hermiteCurveSplineWeight(frame.value.z, frame.time, frame.outWeight.z, frame.outTangent.z,\r\n\t\t\t\tnextFrame.value.z, nextFrame.time, nextFrame.inWeight.z, nextFrame.inTangent.z, t);\r\n\t\t}\r\n\r\n\t\tt0 = tan0.w, t1 = tan1.w;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.w, nextFrame.weightedMode.w)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.w = a * p0.w + b * t0 * dur + c * t1 * dur + d * p1.w;\r\n\t\t\telse\r\n\t\t\t\tout.w = p0.w;\r\n\t\t} else {\r\n\t\t\tout.w = this._hermiteCurveSplineWeight(frame.value.w, frame.time, frame.outWeight.w, frame.outTangent.w,\r\n\t\t\t\tnextFrame.value.w, nextFrame.time, nextFrame.inWeight.w, nextFrame.inTangent.w, t);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _hermiteInterpolateVector4(frame: Vector4Keyframe, nextFrame: Vector4Keyframe, t: number, dur: number, out: Vector4) {\r\n\t\tvar p0 = frame.value;\r\n\t\tvar tan0 = frame.outTangent;\r\n\t\tvar p1 = nextFrame.value;\r\n\t\tvar tan1 = nextFrame.inTangent;\r\n\r\n\t\tvar t2 = t * t;\r\n\t\tvar t3 = t2 * t;\r\n\t\tvar a = 2.0 * t3 - 3.0 * t2 + 1.0;\r\n\t\tvar b = t3 - 2.0 * t2 + t;\r\n\t\tvar c = t3 - t2;\r\n\t\tvar d = -2.0 * t3 + 3.0 * t2;\r\n\r\n\t\tvar t0 = tan0.x, t1 = tan1.x;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.x, nextFrame.weightedMode.x)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.x = a * p0.x + b * t0 * dur + c * t1 * dur + d * p1.x;\r\n\t\t\telse\r\n\t\t\t\tout.x = p0.x;\r\n\t\t} else {\r\n\t\t\tout.x = this._hermiteCurveSplineWeight(frame.value.x, frame.time, frame.outWeight.x, frame.outTangent.x,\r\n\t\t\t\tnextFrame.value.x, nextFrame.time, nextFrame.inWeight.x, nextFrame.inTangent.x, t);\r\n\t\t}\r\n\t\tt0 = tan0.y, t1 = tan1.y;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.y, nextFrame.weightedMode.y)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.y = a * p0.y + b * t0 * dur + c * t1 * dur + d * p1.y;\r\n\t\t\telse\r\n\t\t\t\tout.y = p0.y;\r\n\t\t} else {\r\n\t\t\tout.y = this._hermiteCurveSplineWeight(frame.value.y, frame.time, frame.outWeight.y, frame.outTangent.y,\r\n\t\t\t\tnextFrame.value.y, nextFrame.time, nextFrame.inWeight.y, nextFrame.inTangent.y, t);\r\n\t\t}\r\n\r\n\t\tt0 = tan0.z, t1 = tan1.z;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.z, nextFrame.weightedMode.z)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.z = a * p0.z + b * t0 * dur + c * t1 * dur + d * p1.z;\r\n\t\t\telse\r\n\t\t\t\tout.z = p0.z;\r\n\t\t} else {\r\n\t\t\tout.z = this._hermiteCurveSplineWeight(frame.value.z, frame.time, frame.outWeight.z, frame.outTangent.z,\r\n\t\t\t\tnextFrame.value.z, nextFrame.time, nextFrame.inWeight.z, nextFrame.inTangent.z, t);\r\n\t\t}\r\n\r\n\t\tt0 = tan0.w, t1 = tan1.w;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.w, nextFrame.weightedMode.w)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.w = a * p0.w + b * t0 * dur + c * t1 * dur + d * p1.w;\r\n\t\t\telse\r\n\t\t\t\tout.w = p0.w;\r\n\t\t} else {\r\n\t\t\tout.w = this._hermiteCurveSplineWeight(frame.value.w, frame.time, frame.outWeight.w, frame.outTangent.w,\r\n\t\t\t\tnextFrame.value.w, nextFrame.time, nextFrame.inWeight.w, nextFrame.inTangent.w, t);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _hermiteInterpolateVector2(frame: Vector2Keyframe, nextFrame: Vector2Keyframe, t: number, dur: number, out: Vector2) {\r\n\t\tvar p0 = frame.value;\r\n\t\tvar tan0 = frame.outTangent;\r\n\t\tvar p1 = nextFrame.value;\r\n\t\tvar tan1 = nextFrame.inTangent;\r\n\r\n\t\tvar t2 = t * t;\r\n\t\tvar t3 = t2 * t;\r\n\t\tvar a = 2.0 * t3 - 3.0 * t2 + 1.0;\r\n\t\tvar b = t3 - 2.0 * t2 + t;\r\n\t\tvar c = t3 - t2;\r\n\t\tvar d = -2.0 * t3 + 3.0 * t2;\r\n\r\n\t\tvar t0 = tan0.x, t1 = tan1.x;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.x, nextFrame.weightedMode.x)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.x = a * p0.x + b * t0 * dur + c * t1 * dur + d * p1.x;\r\n\t\t\telse\r\n\t\t\t\tout.x = p0.x;\r\n\t\t} else {\r\n\t\t\tout.x = this._hermiteCurveSplineWeight(frame.value.x, frame.time, frame.outWeight.x, frame.outTangent.x,\r\n\t\t\t\tnextFrame.value.x, nextFrame.time, nextFrame.inWeight.x, nextFrame.inTangent.x, t);\r\n\t\t}\r\n\r\n\t\tt0 = tan0.y, t1 = tan1.y;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.y, nextFrame.weightedMode.y)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.y = a * p0.y + b * t0 * dur + c * t1 * dur + d * p1.y;\r\n\t\t\telse\r\n\t\t\t\tout.y = p0.y;\r\n\t\t} else {\r\n\t\t\tout.y = this._hermiteCurveSplineWeight(frame.value.y, frame.time, frame.outWeight.y, frame.outTangent.y,\r\n\t\t\t\tnextFrame.value.y, nextFrame.time, nextFrame.inWeight.y, nextFrame.inTangent.y, t);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _hermiteCurveSplineWeight(frameValue: number, frametime: number, frameOutWeight: number, frameOutTangent: number, nextframeValue: number, nextframetime: number, nextframeInweight: number, nextframeIntangent: number, time: number) {\r\n\t\tlet Eps = 2.22e-16;\r\n\r\n\t\tlet x = time;\r\n\t\tlet x1 = frametime;\r\n\t\tlet y1 = frameValue;\r\n\t\tlet wt1 = frameOutWeight;\r\n\t\tlet x2 = nextframetime;\r\n\t\tlet y2 = nextframeValue;\r\n\t\tlet wt2 = nextframeInweight;\r\n\r\n\t\tlet dx = x2 - x1;\r\n\t\tlet dy = y2 - y1;\r\n\t\tdy = Math.max(Math.abs(dy), Eps) * (dy < 0 ? -1 : 1);\r\n\r\n\t\tlet yp1 = frameOutTangent;\r\n\t\tlet yp2 = nextframeIntangent;\r\n\r\n\t\tif (!Number.isFinite(yp1) || !Number.isFinite(yp2)) {\r\n\t\t\treturn frameValue;\r\n\t\t}\r\n\r\n\t\typ1 = yp1 * dx / dy;\r\n\t\typ2 = yp2 * dx / dy;\r\n\r\n\t\tlet wt2s = 1 - wt2;\r\n\r\n\t\tlet t = 0.5;\r\n\t\tlet t2 = 0;\r\n\r\n\t\tif (Math.abs(wt1 - 0.33333334) < 0.0001 && Math.abs(wt2 - 0.33333334) < 0.0001) {\r\n\t\t\tt = x;\r\n\t\t\tt2 = 1 - t;\r\n\t\t}\r\n\t\telse {\r\n\t\t\twhile (true) {\r\n\t\t\t\tt2 = (1 - t);\r\n\t\t\t\tlet fg = 3 * t2 * t2 * t * wt1 + 3 * t2 * t * t * wt2s + t * t * t - x;\r\n\t\t\t\tif (Math.abs(fg) <= 2.5 * Eps)\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t// third order householder method\r\n\t\t\t\tlet fpg = 3 * t2 * t2 * wt1 + 6 * t2 * t * (wt2s - wt1) + 3 * t * t * (1 - wt2s);\r\n\t\t\t\tlet fppg = 6 * t2 * (wt2s - 2 * wt1) + 6 * t * (1 - 2 * wt2s + wt1);\r\n\t\t\t\tlet fpppg = 18 * wt1 - 18 * wt2s + 6;\r\n\r\n\t\t\t\tt -= (6 * fg * fpg * fpg - 3 * fg * fg * fppg) / (6 * fpg * fpg * fpg - 6 * fg * fpg * fppg + fg * fg * fpppg);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet y = 3 * t2 * t2 * t * wt1 * yp1 + 3 * t2 * t * t * (1 - wt2 * yp2) + t * t * t;\r\n\r\n\t\treturn y * dy + y1;\r\n\t}\r\n\r\n\tprivate _curveInterpolate(frame: FloatKeyframe, nextFrame: FloatKeyframe, t: number, dur: number): number {\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode, nextFrame.weightedMode)) {\r\n\t\t\treturn this._hermiteInterpolate(frame, nextFrame, t, dur);\r\n\t\t} else {\r\n\t\t\t//weight\r\n\t\t\treturn this._hermiteCurveSplineWeight(frame.value, frame.time, frame.outWeight, frame.outTangent,\r\n\t\t\t\tnextFrame.value, nextFrame.time, nextFrame.inWeight, nextFrame.inTangent, t);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @param nodes \r\n\t * @param playCurTime \r\n\t * @param realTimeCurrentFrameIndexes \r\n\t * @param addtive addtive\r\n\t * @param frontPlay \r\n\t * @param outDatas \r\n\t */\r\n\t_evaluateClipDatasRealTime(nodes: KeyframeNodeList, playCurTime: number, realTimeCurrentFrameIndexes: Int16Array, addtive: boolean, frontPlay: boolean, outDatas: Array<number | Vector3 | Quaternion | Vector4 | Vector2>, avatarMask: AvatarMask): void {\r\n\t\tfor (var i = 0, n = nodes.count; i < n; i++) {\r\n\t\t\tvar node = nodes.getNodeByIndex(i);\r\n\t\t\tvar type = node.type;\r\n\t\t\tvar nextFrameIndex;\r\n\t\t\tvar keyFrames = node._keyFrames;\r\n\t\t\tvar keyFramesCount = keyFrames.length;\r\n\t\t\tvar frameIndex = realTimeCurrentFrameIndexes[i];\r\n\t\t\tif (avatarMask && (!avatarMask.getTransformActive(node.nodePath))) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (frontPlay) {\r\n\t\t\t\tif ((frameIndex !== -1) && (playCurTime < keyFrames[frameIndex].time)) {//\r\n\t\t\t\t\tframeIndex = -1;\r\n\t\t\t\t\trealTimeCurrentFrameIndexes[i] = frameIndex;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnextFrameIndex = frameIndex + 1;\r\n\t\t\t\twhile (nextFrameIndex < keyFramesCount) {\r\n\t\t\t\t\tif (keyFrames[nextFrameIndex].time > playCurTime)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\tnextFrameIndex++;\r\n\t\t\t\t\trealTimeCurrentFrameIndexes[i] = frameIndex;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tnextFrameIndex = frameIndex + 1;\r\n\t\t\t\tif ((nextFrameIndex !== keyFramesCount) && (playCurTime > keyFrames[nextFrameIndex].time)) {//\r\n\t\t\t\t\tframeIndex = keyFramesCount - 1;\r\n\t\t\t\t\trealTimeCurrentFrameIndexes[i] = frameIndex;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnextFrameIndex = frameIndex + 1;\r\n\t\t\t\twhile (frameIndex > -1) {\r\n\t\t\t\t\tif (keyFrames[frameIndex].time < playCurTime)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tframeIndex--;\r\n\t\t\t\t\tnextFrameIndex--;\r\n\t\t\t\t\trealTimeCurrentFrameIndexes[i] = frameIndex;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar isEnd = nextFrameIndex === keyFramesCount;\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase KeyFrameValueType.Float:\r\n\t\t\t\t\tif (frameIndex !== -1) {\r\n\t\t\t\t\t\tvar frame = (<FloatKeyframe>keyFrames[frameIndex]);\r\n\t\t\t\t\t\tif (isEnd) {//nextFarme\r\n\t\t\t\t\t\t\toutDatas[i] = frame.value;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar nextFarme = (<FloatKeyframe>keyFrames[nextFrameIndex]);\r\n\t\t\t\t\t\t\tvar d = nextFarme.time - frame.time;\r\n\t\t\t\t\t\t\tvar t;\r\n\t\t\t\t\t\t\tif (d !== 0)\r\n\t\t\t\t\t\t\t\tt = (playCurTime - frame.time) / d;\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tt = 0;\r\n\t\t\t\t\t\t\toutDatas[i] = this._curveInterpolate(frame, nextFarme, t, d);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\toutDatas[i] = (<FloatKeyframe>keyFrames[0]).value;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (addtive)\r\n\t\t\t\t\t\toutDatas[i] = <number>outDatas[i] - (<FloatKeyframe>keyFrames[0]).value;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KeyFrameValueType.Position:\r\n\t\t\t\tcase KeyFrameValueType.RotationEuler:\r\n\t\t\t\tcase KeyFrameValueType.Vector3:\r\n\t\t\t\t\tvar clipData = <Vector3>outDatas[i];\r\n\t\t\t\t\tthis._evaluateFrameNodeVector3DatasRealTime(keyFrames as Vector3Keyframe[], frameIndex, isEnd, playCurTime, clipData);\r\n\t\t\t\t\tif (addtive) {\r\n\t\t\t\t\t\tvar firstFrameValue = ((<Vector3Keyframe>keyFrames[0])).value;\r\n\t\t\t\t\t\tclipData.x -= firstFrameValue.x;\r\n\t\t\t\t\t\tclipData.y -= firstFrameValue.y;\r\n\t\t\t\t\t\tclipData.z -= firstFrameValue.z;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KeyFrameValueType.Rotation:\r\n\t\t\t\t\tvar clipQuat = <Quaternion>outDatas[i];\r\n\t\t\t\t\tthis._evaluateFrameNodeQuaternionDatasRealTime(keyFrames as QuaternionKeyframe[], frameIndex, isEnd, playCurTime, clipQuat);\r\n\t\t\t\t\tif (addtive) {\r\n\t\t\t\t\t\tvar tempQuat = AnimationClip._tempQuaternion0;\r\n\t\t\t\t\t\tvar firstFrameValueQua = ((<QuaternionKeyframe>keyFrames[0])).value;\r\n\t\t\t\t\t\tUtils3D.quaternionConjugate(firstFrameValueQua, tempQuat);\r\n\t\t\t\t\t\tQuaternion.multiply(tempQuat, clipQuat, clipQuat);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KeyFrameValueType.Scale:\r\n\t\t\t\t\tclipData = <Vector3>outDatas[i];\r\n\t\t\t\t\tthis._evaluateFrameNodeVector3DatasRealTime(keyFrames as Vector3Keyframe[], frameIndex, isEnd, playCurTime, clipData);\r\n\t\t\t\t\tif (addtive) {\r\n\t\t\t\t\t\tfirstFrameValue = ((<Vector3Keyframe>keyFrames[0])).value;\r\n\t\t\t\t\t\tclipData.x /= firstFrameValue.x;\r\n\t\t\t\t\t\tclipData.y /= firstFrameValue.y;\r\n\t\t\t\t\t\tclipData.z /= firstFrameValue.z;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KeyFrameValueType.Vector2:\r\n\t\t\t\t\tvar v2Data = <Vector2>outDatas[i];\r\n\t\t\t\t\tthis._evaluateFrameNodeVector2DatasRealTime(keyFrames as Vector2Keyframe[], frameIndex, isEnd, playCurTime, v2Data);\r\n\t\t\t\t\tif (addtive) {\r\n\t\t\t\t\t\tvar v2FrameValue = ((<Vector2Keyframe>keyFrames[0])).value;\r\n\t\t\t\t\t\tv2Data.x -= v2FrameValue.x;\r\n\t\t\t\t\t\tv2Data.y -= v2FrameValue.y;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KeyFrameValueType.Vector4:\r\n\t\t\t\tcase KeyFrameValueType.Color:\r\n\t\t\t\t\tvar v4Data = <Vector4>outDatas[i];\r\n\t\t\t\t\tthis._evaluateFrameNodeVector4DatasRealTime(keyFrames as Vector4Keyframe[], frameIndex, isEnd, playCurTime, v4Data);\r\n\t\t\t\t\tif (addtive) {\r\n\t\t\t\t\t\tvar v4FrameValue = ((<Vector4Keyframe>keyFrames[0])).value;\r\n\t\t\t\t\t\tv4Data.x -= v4FrameValue.x;\r\n\t\t\t\t\t\tv4Data.y -= v4FrameValue.y;\r\n\t\t\t\t\t\tv4Data.z -= v4FrameValue.z;\r\n\t\t\t\t\t\tv4Data.w -= v4FrameValue.w;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow \"AnimationClip:unknown node type.\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _evaluateFrameNodeVector3DatasRealTime(keyFrames: Vector3Keyframe[], frameIndex: number, isEnd: boolean, playCurTime: number, outDatas: Vector3): void {\r\n\t\tif (frameIndex !== -1) {\r\n\t\t\tvar frame = keyFrames[frameIndex];\r\n\t\t\tif (isEnd) {\r\n\t\t\t\tvar frameData = frame.value;\r\n\t\t\t\toutDatas.x = frameData.x;//null\r\n\t\t\t\toutDatas.y = frameData.y;\r\n\t\t\t\toutDatas.z = frameData.z;\r\n\t\t\t} else {\r\n\t\t\t\tvar nextKeyFrame = keyFrames[frameIndex + 1];\r\n\t\t\t\tvar t;\r\n\t\t\t\tvar startTime = frame.time;\r\n\t\t\t\tvar d = nextKeyFrame.time - startTime;\r\n\t\t\t\tif (d !== 0)\r\n\t\t\t\t\tt = (playCurTime - startTime) / d;\r\n\t\t\t\telse\r\n\t\t\t\t\tt = 0;\r\n\r\n\t\t\t\tthis._hermiteInterpolateVector3(frame, nextKeyFrame, t, d, outDatas);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tvar firstFrameDatas = keyFrames[0].value;\r\n\t\t\toutDatas.x = firstFrameDatas.x;\r\n\t\t\toutDatas.y = firstFrameDatas.y;\r\n\t\t\toutDatas.z = firstFrameDatas.z;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _evaluateFrameNodeVector2DatasRealTime(keyFrames: Vector2Keyframe[], frameIndex: number, isEnd: boolean, playCurTime: number, outDatas: Vector2): void {\r\n\t\tif (frameIndex !== -1) {\r\n\t\t\tvar frame = keyFrames[frameIndex];\r\n\t\t\tif (isEnd) {\r\n\t\t\t\tvar frameData = frame.value;\r\n\t\t\t\toutDatas.x = frameData.x;//null\r\n\t\t\t\toutDatas.y = frameData.y;\r\n\t\t\t} else {\r\n\t\t\t\tvar nextKeyFrame = keyFrames[frameIndex + 1];\r\n\t\t\t\tvar t;\r\n\t\t\t\tvar startTime = frame.time;\r\n\t\t\t\tvar d = nextKeyFrame.time - startTime;\r\n\t\t\t\tif (d !== 0)\r\n\t\t\t\t\tt = (playCurTime - startTime) / d;\r\n\t\t\t\telse\r\n\t\t\t\t\tt = 0;\r\n\r\n\t\t\t\tthis._hermiteInterpolateVector2(frame, nextKeyFrame, t, d, outDatas);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tvar firstFrameDatas = keyFrames[0].value;\r\n\t\t\toutDatas.x = firstFrameDatas.x;\r\n\t\t\toutDatas.y = firstFrameDatas.y;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _evaluateFrameNodeVector4DatasRealTime(keyFrames: Vector4Keyframe[], frameIndex: number, isEnd: boolean, playCurTime: number, outDatas: Vector4): void {\r\n\t\tif (frameIndex !== -1) {\r\n\t\t\tvar frame = keyFrames[frameIndex];\r\n\t\t\tif (isEnd) {\r\n\t\t\t\tvar frameData = frame.value;\r\n\t\t\t\toutDatas.x = frameData.x;//null\r\n\t\t\t\toutDatas.y = frameData.y;\r\n\t\t\t\toutDatas.z = frameData.z;\r\n\t\t\t} else {\r\n\t\t\t\tvar nextKeyFrame = keyFrames[frameIndex + 1];\r\n\t\t\t\tvar t;\r\n\t\t\t\tvar startTime = frame.time;\r\n\t\t\t\tvar d = nextKeyFrame.time - startTime;\r\n\t\t\t\tif (d !== 0)\r\n\t\t\t\t\tt = (playCurTime - startTime) / d;\r\n\t\t\t\telse\r\n\t\t\t\t\tt = 0;\r\n\r\n\t\t\t\tthis._hermiteInterpolateVector4(frame, nextKeyFrame, t, d, outDatas);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tvar firstFrameDatas = keyFrames[0].value;\r\n\t\t\toutDatas.x = firstFrameDatas.x;\r\n\t\t\toutDatas.y = firstFrameDatas.y;\r\n\t\t\toutDatas.z = firstFrameDatas.z;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tprivate _evaluateFrameNodeQuaternionDatasRealTime(keyFrames: QuaternionKeyframe[], frameIndex: number, isEnd: boolean, playCurTime: number, outDatas: Quaternion): void {\r\n\t\tif (frameIndex !== -1) {\r\n\t\t\tvar frame = keyFrames[frameIndex];\r\n\t\t\tif (isEnd) {\r\n\t\t\t\tvar frameData = frame.value;\r\n\t\t\t\toutDatas.x = frameData.x;//null\r\n\t\t\t\toutDatas.y = frameData.y;\r\n\t\t\t\toutDatas.z = frameData.z;\r\n\t\t\t\toutDatas.w = frameData.w;\r\n\t\t\t} else {\r\n\t\t\t\tvar nextKeyFrame = keyFrames[frameIndex + 1];\r\n\t\t\t\tvar t;\r\n\t\t\t\tvar startTime = frame.time;\r\n\t\t\t\tvar d = nextKeyFrame.time - startTime;\r\n\t\t\t\tif (d !== 0)\r\n\t\t\t\t\tt = (playCurTime - startTime) / d;\r\n\t\t\t\telse\r\n\t\t\t\t\tt = 0;\r\n\r\n\t\t\t\tthis._hermiteInterpolateQuaternion(frame, nextKeyFrame, t, d, outDatas);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tvar firstFrameDatas = keyFrames[0].value;\r\n\t\t\toutDatas.x = firstFrameDatas.x;\r\n\t\t\toutDatas.y = firstFrameDatas.y;\r\n\t\t\toutDatas.z = firstFrameDatas.z;\r\n\t\t\toutDatas.w = firstFrameDatas.w;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _binarySearchEventIndex(time: number): number {\r\n\t\tvar start = 0;\r\n\t\tvar end = this._animationEvents.length - 1;\r\n\t\tvar mid;\r\n\t\twhile (start <= end) {\r\n\t\t\tmid = Math.floor((start + end) / 2);\r\n\t\t\tvar midValue = this._animationEvents[mid].time;\r\n\t\t\tif (midValue == time)\r\n\t\t\t\treturn mid;\r\n\t\t\telse if (midValue > time)\r\n\t\t\t\tend = mid - 1;\r\n\t\t\telse\r\n\t\t\t\tstart = mid + 1;\r\n\t\t}\r\n\t\treturn start;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param event \r\n\t */\r\n\taddEvent(event: AnimationEvent): void {\r\n\t\tvar index = this._binarySearchEventIndex(event.time);\r\n\t\tthis._animationEvents.splice(index, 0, event);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tprotected _disposeResource(): void {\r\n\t\tthis._nodes = null;\r\n\t\tthis._nodesMap = null;\r\n\t}\r\n}\r\n\r\n\r\n\r\n","import { IRenderEngine3DOBJFactory } from \"./IRenderEngine3DOBJFactory\";\r\n\r\nexport class Laya3DRender {\r\n    static renderOBJCreate: IRenderEngine3DOBJFactory;\r\n}","import { Node } from \"../../display/Node\";\r\nimport { Handler } from \"../../utils/Handler\";\r\nimport { Transform3D } from \"./Transform3D\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { Stat } from \"../../utils/Stat\";\r\nimport { Prefab } from \"../../resource/HierarchyResource\";\r\nimport { ILaya } from \"../../../ILaya\";\r\nimport { CommandUniformMap } from \"../../RenderEngine/CommandUniformMap\";\r\nimport { NodeFlags } from \"../../Const\";\r\nimport { Event } from \"../../events/Event\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Scene3D } from \"./scene/Scene3D\";\r\nimport { ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport enum StaticFlag {\r\n    Normal = 1 << 0,\r\n    StaticBatch = 1 << 1,\r\n}\r\n\r\n/**\r\n * <code>Sprite3D</code> 3D\r\n */\r\nexport class Sprite3D extends Node {\r\n    /**@internal */\r\n    static WORLDMATRIX: number;\r\n    static WORLDINVERTFRONT: number;//-11\r\n    /**@internal */\r\n    static sprite3DCommandUniformMap: CommandUniformMap;\r\n    /**@internal */\r\n    protected static _uniqueIDCounter: number = 0;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n        Sprite3D.WORLDMATRIX = Shader3D.propertyNameToID(\"u_WorldMat\");\r\n        Sprite3D.WORLDINVERTFRONT = Shader3D.propertyNameToID(\"u_WroldInvertFront\");\r\n        Sprite3D.sprite3DCommandUniformMap = LayaGL.renderOBJCreate.createGlobalUniformMap(\"Sprite3D\");\r\n        Sprite3D.sprite3DCommandUniformMap.addShaderUniform(Sprite3D.WORLDMATRIX, \"u_WorldMat\",ShaderDataType.Matrix4x4);\r\n        Sprite3D.sprite3DCommandUniformMap.addShaderUniform(Sprite3D.WORLDINVERTFRONT, \"u_WroldInvertFront\",ShaderDataType.Vector4);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\toriginal  \r\n     * @param   parent    \r\n     * @param   worldPositionStays \r\n     * @param\tposition  ,worldPositionStaysfalse\r\n     * @param\trotation  ,worldPositionStaysfalse\r\n     * @return  \r\n     */\r\n    static instantiate(original: Sprite3D, parent: Node = null, worldPositionStays: boolean = true, position: Vector3 = null, rotation: Quaternion = null): Sprite3D {\r\n        var destSprite3D: Sprite3D = (<Sprite3D>original.clone());\r\n        (parent) && (parent.addChild(destSprite3D));\r\n        var transform: Transform3D = destSprite3D.transform;\r\n        if (worldPositionStays) {\r\n            var worldMatrix: Matrix4x4 = transform.worldMatrix;\r\n            original.transform.worldMatrix.cloneTo(worldMatrix);\r\n            transform.worldMatrix = worldMatrix;\r\n        } else {\r\n            (position) && (transform.position = position);\r\n            (rotation) && (transform.rotation = rotation);\r\n        }\r\n        return destSprite3D;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param url \r\n     * @param complete \r\n     */\r\n    static load(url: string, complete: Handler): void {\r\n        ILaya.loader.load(url).then((res: Prefab) => {\r\n            complete && complete.runWith([res?.create()]);\r\n        });\r\n    }\r\n\r\n    /** @internal */\r\n    private _id: number;\r\n\r\n    /** @internal */\r\n    _isStatic: number;\r\n    /** @internal */\r\n    _layer: number;\r\n    /**@internal */\r\n    _transform: Transform3D;\r\n    /**@internal 0*/\r\n    _isRenderNode: number = 0;\r\n\r\n    /**\r\n     * ID\r\n     */\r\n    get id(): number {\r\n        return this._id;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get layer(): number {\r\n        return this._layer;\r\n    }\r\n\r\n    set layer(value: number) {\r\n        if (this._layer !== value) {\r\n            if (value >= 0 && value <= 30) {\r\n                this._layer = value;\r\n                this.event(Event.LAYERCHANGE, value);\r\n            } else {\r\n                throw new Error(\"Layer value must be 0-30.\");\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get isStatic(): boolean {\r\n        return !!(this._isStatic >> 1 | 0x0);\r\n    }\r\n\r\n    /**@internal IDE only*/\r\n    set isStatic(value: boolean) {\r\n        this._isStatic = value ? StaticFlag.StaticBatch : StaticFlag.Normal;\r\n        this.event(Event.staticMask, this._isStatic);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get transform(): Transform3D {\r\n        return this._transform;\r\n    }\r\n\r\n    get scene(): Scene3D {\r\n        return <Scene3D>this._scene;\r\n    }\r\n\r\n    /**\r\n     *  <code>Sprite3D</code> \r\n     * @param name \r\n     * @param isStatic \r\n     */\r\n    constructor(name: string = null, isStatic: boolean = false) {\r\n        super();\r\n        this._id = ++Sprite3D._uniqueIDCounter;\r\n        this._is3D = true;\r\n        this._transform = Laya3DRender.renderOBJCreate.createTransform(this);\r\n        this._isStatic = isStatic ? StaticFlag.StaticBatch : StaticFlag.Normal;\r\n        this.layer = 0;\r\n        this.name = name ? name : \"New Sprite3D\";\r\n    }\r\n\r\n    /**\r\n    * @private\r\n    */\r\n    protected _onActive(): void {\r\n        super._onActive();\r\n        Stat.sprite3DCount++;\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    protected _onInActive(): void {\r\n        super._onInActive();\r\n        Stat.sprite3DCount--;\r\n    }\r\n\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onAdded(): void {\r\n        if (this._parent instanceof Sprite3D) {\r\n            var parent3D: Sprite3D = (<Sprite3D>this._parent);\r\n            this.transform._setParent(parent3D.transform);\r\n        }\r\n        else\r\n            this.transform._onWorldTransform();\r\n        super._onAdded();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onRemoved(): void {\r\n        super._onRemoved();\r\n        if (this._parent instanceof Sprite3D)\r\n            this.transform._setParent(null);\r\n    }\r\n\r\n    protected onStartListeningToType(type: string) {\r\n        super.onStartListeningToType(type);\r\n        if (type.startsWith(\"collision\"))\r\n            this._setBit(NodeFlags.PROCESS_COLLISIONS, true);\r\n        else if (type.startsWith(\"trigger\"))\r\n            this._setBit(NodeFlags.PROCESS_TRIGGERS, true);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        (data.isStatic !== undefined) && (this.isStatic = data.isStatic);\r\n        (data.active !== undefined) && (this.active = data.active);\r\n        (data.name != undefined) && (this.name = data.name);\r\n        (data.tag != undefined) && (this.tag = data.tag);\r\n\r\n        if (data.position !== undefined) {\r\n            var loccalPosition: Vector3 = this.transform.localPosition;\r\n            loccalPosition.fromArray(data.position);\r\n            this.transform.localPosition = loccalPosition;\r\n        }\r\n\r\n        if (data.rotationEuler !== undefined) {\r\n            var localRotationEuler: Vector3 = this.transform.localRotationEuler;\r\n            localRotationEuler.fromArray(data.rotationEuler);\r\n            this.transform.localRotationEuler = localRotationEuler;\r\n        }\r\n        if (data.rotation !== undefined) {\r\n            var localRotation: Quaternion = this.transform.localRotation;\r\n            localRotation.fromArray(data.rotation);\r\n            this.transform.localRotation = localRotation;\r\n        }\r\n\r\n        if (data.scale !== undefined) {\r\n            var localScale: Vector3 = this.transform.localScale;\r\n            localScale.fromArray(data.scale);\r\n            this.transform.localScale = localScale;\r\n        }\r\n\r\n        (data.layer != undefined) && (this.layer = data.layer);\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @internal\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    _cloneTo(destObject: any, srcRoot: Node, dstRoot: Node): void {\r\n        if (this._destroyed)\r\n            throw new Error(\"Sprite3D: Can't be cloned if the Sprite3D has destroyed.\");\r\n\r\n        var destSprite3D: Sprite3D = <Sprite3D>destObject;\r\n        var trans: Transform3D = this._transform;\r\n        var destTrans: Transform3D = destSprite3D._transform;\r\n\r\n        destSprite3D.name = this.name/* + \"(clone)\"*/;//TODO:\r\n        destSprite3D.tag = this.tag;\r\n        destSprite3D._destroyed = this._destroyed;\r\n        destSprite3D.active = this.active;\r\n        destTrans.localPosition = trans.localPosition;\r\n        destTrans.localRotation = trans.localRotation;\r\n        destTrans.localScale = trans.localScale;\r\n\r\n        destSprite3D._isStatic = this._isStatic;\r\n        destSprite3D.layer = this.layer;\r\n        super._cloneTo(destSprite3D, srcRoot, dstRoot);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static _createSprite3DInstance(scrSprite: Sprite3D): Node {\r\n        var node: Node = scrSprite._create();\r\n        var children: any[] = scrSprite._children;\r\n        for (var i: number = 0, n: number = children.length; i < n; i++) {\r\n            var child: any = Sprite3D._createSprite3DInstance(children[i])\r\n            node.addChild(child);\r\n        }\r\n        return node;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static _parseSprite3DInstance(srcRoot: Node, dstRoot: Node, scrSprite: Node, dstSprite: Node): void {\r\n        var srcChildren: any[] = scrSprite._children;\r\n        var dstChildren: any[] = dstSprite._children;\r\n        for (var i: number = 0, n: number = srcChildren.length; i < n; i++)\r\n            Sprite3D._parseSprite3DInstance(srcRoot, dstRoot, srcChildren[i], dstChildren[i])\r\n        scrSprite._cloneTo(dstSprite, srcRoot, dstRoot);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): Node {\r\n        var dstSprite3D: Node = Sprite3D._createSprite3DInstance(this);\r\n        Sprite3D._parseSprite3DInstance(this, dstSprite3D, this, dstSprite3D);\r\n        return dstSprite3D;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    destroy(destroyChild: boolean = true): void {\r\n        if (this._destroyed)\r\n            return;\r\n\r\n        super.destroy(destroyChild);\r\n        this._transform = null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Node {\r\n        return new Sprite3D();\r\n    }\r\n}\r\n\r\n","import { Plane } from \"./Plane\";\r\nimport { CollisionUtils } from \"./CollisionUtils\";\r\nimport { ContainmentType } from \"./ContainmentType\";\r\nimport { BoundBox } from \"./BoundBox\";\r\nimport { BoundSphere } from \"./BoundSphere\";\r\nimport { IClone } from \"../../utils/IClone\";\r\nimport { Bounds } from \"./Bounds\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\n\r\n/**\r\n * \r\n */\r\nexport enum FrustumCorner {\r\n\tFarBottomLeft = 0,\r\n\tFarTopLeft = 1,\r\n\tFarTopRight = 2,\r\n\tFarBottomRight = 3,\r\n\tnearBottomLeft = 4,\r\n\tnearTopLeft = 5,\r\n\tnearTopRight = 6,\r\n\tnearBottomRight = 7,\r\n\tunknown = 8\r\n}\r\n\r\n\r\n/**\r\n * <code>BoundFrustum</code> \r\n */\r\nexport class BoundFrustum implements IClone {\r\n\t/** @internal */\r\n\tprivate static _tempV30: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\tprivate static _tempV31: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\tprivate static _tempV32: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\tprivate static _tempV33: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\tprivate static _tempV34: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\tprivate static _tempV35: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\tprivate static _tempV36: Vector3 = new Vector3();\r\n\r\n\t/**\r\n\t * 6\r\n\t * @param  m \r\n\t * @param  np \r\n\t * @param  fp \r\n\t * @param  lp \r\n\t * @param  rp \r\n\t * @param  tp \r\n\t * @param  bp \r\n\t */\r\n\tstatic getPlanesFromMatrix(m: Matrix4x4, np: Plane, fp: Plane, lp: Plane, rp: Plane, tp: Plane, bp: Plane): void {\r\n\t\tvar matrixE: Float32Array = m.elements;\r\n\t\tvar m11: number = matrixE[0];\r\n\t\tvar m12: number = matrixE[1];\r\n\t\tvar m13: number = matrixE[2];\r\n\t\tvar m14: number = matrixE[3];\r\n\t\tvar m21: number = matrixE[4];\r\n\t\tvar m22: number = matrixE[5];\r\n\t\tvar m23: number = matrixE[6];\r\n\t\tvar m24: number = matrixE[7];\r\n\t\tvar m31: number = matrixE[8];\r\n\t\tvar m32: number = matrixE[9];\r\n\t\tvar m33: number = matrixE[10];\r\n\t\tvar m34: number = matrixE[11];\r\n\t\tvar m41: number = matrixE[12];\r\n\t\tvar m42: number = matrixE[13];\r\n\t\tvar m43: number = matrixE[14];\r\n\t\tvar m44: number = matrixE[15];\r\n\r\n\t\t//near\r\n\t\tvar nearNorE: Vector3 = np.normal;\r\n\t\tnearNorE.x = m13;\r\n\t\tnearNorE.y = m23;\r\n\t\tnearNorE.z = m33;\r\n\t\tnp.distance = m43;\r\n\t\tnp.normal = nearNorE;\r\n\t\tnp.normalize();\r\n\r\n\t\t//far\r\n\t\tvar farNorE: Vector3 = fp.normal;\r\n\t\tfarNorE.x = m14 - m13;\r\n\t\tfarNorE.y = m24 - m23;\r\n\t\tfarNorE.z = m34 - m33;\r\n\t\tfp.distance = m44 - m43;\r\n\t\tfp.normal = farNorE;\r\n\t\tfp.normalize();\r\n\r\n\t\t//left\r\n\t\tvar leftNorE: Vector3 = lp.normal;\r\n\t\tleftNorE.x = m14 + m11;\r\n\t\tleftNorE.y = m24 + m21;\r\n\t\tleftNorE.z = m34 + m31;\r\n\t\tlp.distance = m44 + m41;\r\n\t\tlp.normal = leftNorE;\r\n\t\tlp.normalize();\r\n\r\n\t\t//right\r\n\t\tvar rightNorE: Vector3 = rp.normal;\r\n\t\trightNorE.x = m14 - m11;\r\n\t\trightNorE.y = m24 - m21;\r\n\t\trightNorE.z = m34 - m31;\r\n\t\trp.distance = m44 - m41;\r\n\t\trp.normal = rightNorE;\r\n\t\trp.normalize();\r\n\r\n\t\t//top\r\n\t\tvar topNorE: Vector3 = tp.normal;\r\n\t\ttopNorE.x = m14 - m12;\r\n\t\ttopNorE.y = m24 - m22;\r\n\t\ttopNorE.z = m34 - m32;\r\n\t\ttp.distance = m44 - m42;\r\n\t\ttp.normal = topNorE;\r\n\t\ttp.normalize();\r\n\r\n\t\t//bottom\r\n\t\tvar bottomNorE: Vector3 = bp.normal;\r\n\t\tbottomNorE.x = m14 + m12;\r\n\t\tbottomNorE.y = m24 + m22;\r\n\t\tbottomNorE.z = m34 + m32;\r\n\t\tbp.distance = m44 + m42;\r\n\t\tbp.normal = bottomNorE;\r\n\t\tbp.normalize();\r\n\t}\r\n\r\n\t/** @internal */\r\n\tprotected _matrix: Matrix4x4;\r\n\t/** @internal */\r\n\tprotected _near: Plane;\r\n\t/** @internal */\r\n\tprotected _far: Plane;\r\n\t/** @internal */\r\n\tprotected _left: Plane;\r\n\t/** @internal */\r\n\tprotected _right: Plane;\r\n\t/** @internal */\r\n\tprotected _top: Plane;\r\n\t/** @internal */\r\n\tprotected _bottom: Plane;\r\n\r\n\t/**\r\n\t *  <code>BoundFrustum</code> \r\n\t * @param\tmatrix 4x4\r\n\t */\r\n\tconstructor(matrix: Matrix4x4) {\r\n\t\tthis._matrix = matrix;\r\n\t\tthis.initBoundingPlane();\r\n\t}\r\n\r\n\tprotected initBoundingPlane() {\r\n\t\tthis._near = new Plane();\r\n\t\tthis._far = new Plane();\r\n\t\tthis._left = new Plane();\r\n\t\tthis._right = new Plane();\r\n\t\tthis._top = new Plane();\r\n\t\tthis._bottom = new Plane();\r\n\t\tBoundFrustum.getPlanesFromMatrix(this._matrix, this._near, this._far, this._left, this._right, this._top, this._bottom);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget matrix(): Matrix4x4 {\r\n\t\treturn this._matrix;\r\n\t}\r\n\r\n\tset matrix(matrix: Matrix4x4) {\r\n\t\tmatrix.cloneTo(this._matrix)\r\n\t\tBoundFrustum.getPlanesFromMatrix(this._matrix, this._near, this._far, this._left, this._right, this._top, this._bottom);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget near(): Plane {\r\n\t\treturn this._near;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget far(): Plane {\r\n\t\treturn this._far;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget left(): Plane {\r\n\t\treturn this._left;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget right(): Plane {\r\n\t\treturn this._right;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget top(): Plane {\r\n\t\treturn this._top;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget bottom(): Plane {\r\n\t\treturn this._bottom;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tother \r\n\t */\r\n\tequalsBoundFrustum(other: BoundFrustum): boolean {\r\n\t\treturn this._matrix.equalsOtherMatrix(other.matrix)\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tobj \r\n\t */\r\n\tequalsObj(obj: any): boolean {\r\n\t\tif (obj instanceof BoundFrustum) {\r\n\t\t\tvar bf: BoundFrustum = (<BoundFrustum>obj);\r\n\t\t\treturn this.equalsBoundFrustum(bf);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * 0:\r\n\t * 1:\r\n\t * 2:\r\n\t * 3:\r\n\t * 4:\r\n\t * 5:\r\n\t * @param\tindex \r\n\t */\r\n\tgetPlane(index: number): Plane {\r\n\t\tswitch (index) {\r\n\t\t\tcase 0:\r\n\t\t\t\treturn this._near;\r\n\t\t\tcase 1:\r\n\t\t\t\treturn this._far;\r\n\t\t\tcase 2:\r\n\t\t\t\treturn this._left;\r\n\t\t\tcase 3:\r\n\t\t\t\treturn this._right;\r\n\t\t\tcase 4:\r\n\t\t\t\treturn this._top;\r\n\t\t\tcase 5:\r\n\t\t\t\treturn this._bottom;\r\n\t\t\tdefault:\r\n\t\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param  p1  1\r\n\t * @param  p2  2\r\n\t * @param  p3  3\r\n\t */\r\n\tstatic get3PlaneInterPoint(p1: Plane, p2: Plane, p3: Plane, out: Vector3): void {\r\n\t\tvar p1Nor: Vector3 = p1.normal;\r\n\t\tvar p2Nor: Vector3 = p2.normal;\r\n\t\tvar p3Nor: Vector3 = p3.normal;\r\n\r\n\t\tVector3.cross(p2Nor, p3Nor, BoundFrustum._tempV30);\r\n\t\tVector3.cross(p3Nor, p1Nor, BoundFrustum._tempV31);\r\n\t\tVector3.cross(p1Nor, p2Nor, BoundFrustum._tempV32);\r\n\r\n\t\tvar a: number = Vector3.dot(p1Nor, BoundFrustum._tempV30);\r\n\t\tvar b: number = Vector3.dot(p2Nor, BoundFrustum._tempV31);\r\n\t\tvar c: number = Vector3.dot(p3Nor, BoundFrustum._tempV32);\r\n\r\n\t\tVector3.scale(BoundFrustum._tempV30, -p1.distance / a, BoundFrustum._tempV33);\r\n\t\tVector3.scale(BoundFrustum._tempV31, -p2.distance / b, BoundFrustum._tempV34);\r\n\t\tVector3.scale(BoundFrustum._tempV32, -p3.distance / c, BoundFrustum._tempV35);\r\n\r\n\t\tVector3.add(BoundFrustum._tempV33, BoundFrustum._tempV34, BoundFrustum._tempV36);\r\n\t\tVector3.add(BoundFrustum._tempV35, BoundFrustum._tempV36, out);\r\n\t}\r\n\r\n\t/**\r\n\t * 8\r\n\t * @param  corners  \r\n\t */\r\n\tgetCorners(corners: Vector3[]): void {\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._near, this._bottom, this._right, corners[FrustumCorner.nearBottomRight]);\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._near, this._top, this._right, corners[FrustumCorner.nearTopRight]);\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._near, this._top, this._left, corners[FrustumCorner.nearTopLeft]);\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._near, this._bottom, this._left, corners[FrustumCorner.nearBottomLeft]);\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._far, this._bottom, this._right, corners[FrustumCorner.FarBottomRight]);\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._far, this._top, this._right, corners[FrustumCorner.FarTopRight]);\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._far, this._top, this._left, corners[FrustumCorner.FarTopLeft]);\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._far, this._bottom, this._left, corners[FrustumCorner.FarBottomLeft]);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param  point  \r\n\t * @returns :1,:2,:0\r\n\t */\r\n\tcontainsPoint(point: Vector3): number {\r\n\t\tvar result: number = Plane.PlaneIntersectionType_Front;\r\n\t\tvar planeResult: number = Plane.PlaneIntersectionType_Front;\r\n\r\n\t\tfor (var i: number = 0; i < 6; i++) {\r\n\r\n\t\t\tswitch (i) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndPoint(this._near, point);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndPoint(this._far, point);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndPoint(this._left, point);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndPoint(this._right, point);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndPoint(this._top, point);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 5:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndPoint(this._bottom, point);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tswitch (planeResult) {\r\n\t\t\t\tcase Plane.PlaneIntersectionType_Back:\r\n\t\t\t\t\treturn ContainmentType.Disjoint;\r\n\t\t\t\tcase Plane.PlaneIntersectionType_Intersecting:\r\n\t\t\t\t\tresult = Plane.PlaneIntersectionType_Intersecting;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tswitch (result) {\r\n\t\t\tcase Plane.PlaneIntersectionType_Intersecting:\r\n\t\t\t\treturn ContainmentType.Intersects;\r\n\t\t\tdefault:\r\n\t\t\t\treturn ContainmentType.Contains;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param box \r\n\t * @returns boolean \r\n\t */\r\n\tintersects(box: BoundBox|Bounds): boolean {\r\n\t\tvar min: Vector3 = box.min;\r\n\t\tvar max: Vector3 = box.max;\r\n\t\tvar minX: number = min.x;\r\n\t\tvar minY: number = min.y;\r\n\t\tvar minZ: number = min.z;\r\n\t\tvar maxX: number = max.x;\r\n\t\tvar maxY: number = max.y;\r\n\t\tvar maxZ: number = max.z;\r\n\r\n\t\tvar nearNormal: Vector3 = this._near.normal;\r\n\t\tif (this._near.distance + (nearNormal.x * (nearNormal.x < 0 ? minX : maxX)) + (nearNormal.y * (nearNormal.y < 0 ? minY : maxY)) + (nearNormal.z * (nearNormal.z < 0 ? minZ : maxZ)) < 0)\r\n\t\t\treturn false;\r\n\r\n\t\tvar leftNormal: Vector3 = this._left.normal;\r\n\t\tif (this._left.distance + (leftNormal.x * (leftNormal.x < 0 ? minX : maxX)) + (leftNormal.y * (leftNormal.y < 0 ? minY : maxY)) + (leftNormal.z * (leftNormal.z < 0 ? minZ : maxZ)) < 0)\r\n\t\t\treturn false\r\n\r\n\t\tvar rightNormal: Vector3 = this._right.normal;\r\n\t\tif (this._right.distance + (rightNormal.x * (rightNormal.x < 0 ? minX : maxX)) + (rightNormal.y * (rightNormal.y < 0 ? minY : maxY)) + (rightNormal.z * (rightNormal.z < 0 ? minZ : maxZ)) < 0)\r\n\t\t\treturn false;\r\n\r\n\t\tvar bottomNormal: Vector3 = this._bottom.normal;\r\n\t\tif (this._bottom.distance + (bottomNormal.x * (bottomNormal.x < 0 ? minX : maxX)) + (bottomNormal.y * (bottomNormal.y < 0 ? minY : maxY)) + (bottomNormal.z * (bottomNormal.z < 0 ? minZ : maxZ)) < 0)\r\n\t\t\treturn false;\r\n\r\n\t\tvar topNormal: Vector3 = this._top.normal;\r\n\t\tif (this._top.distance + (topNormal.x * (topNormal.x < 0 ? minX : maxX)) + (topNormal.y * (topNormal.y < 0 ? minY : maxY)) + (topNormal.z * (topNormal.z < 0 ? minZ : maxZ)) < 0)\r\n\t\t\treturn false;\r\n\r\n\t\t// Can ignore far plane when distant object culling is handled by another mechanism\r\n\t\tvar farNormal: Vector3 = this._far.normal;\r\n\t\tif (this._far.distance + (farNormal.x * (farNormal.x < 0 ? minX : maxX)) + (farNormal.y * (farNormal.y < 0 ? minY : maxY)) + (farNormal.z * (farNormal.z < 0 ? minZ : maxZ)) < 0)\r\n\t\t\treturn false;\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param  box  \r\n\t * @returns :1,:2,:0\r\n\t */\r\n\tcontainsBoundBox(box: BoundBox|Bounds): number {\r\n\t\tvar p: Vector3 = BoundFrustum._tempV30, n: Vector3 = BoundFrustum._tempV31;\r\n\t\tvar boxMin: Vector3 = box.min;\r\n\t\tvar boxMax: Vector3 = box.max;\r\n\t\tvar result: number = ContainmentType.Contains;\r\n\t\tfor (var i: number = 0; i < 6; i++) {\r\n\t\t\tvar plane: Plane = this.getPlane(i);\r\n\t\t\tvar planeNor: Vector3 = plane.normal;\r\n\r\n\t\t\tif (planeNor.x >= 0) {\r\n\t\t\t\tp.x = boxMax.x;\r\n\t\t\t\tn.x = boxMin.x;\r\n\t\t\t} else {\r\n\t\t\t\tp.x = boxMin.x;\r\n\t\t\t\tn.x = boxMax.x;\r\n\t\t\t}\r\n\t\t\tif (planeNor.y >= 0) {\r\n\t\t\t\tp.y = boxMax.y;\r\n\t\t\t\tn.y = boxMin.y;\r\n\t\t\t} else {\r\n\t\t\t\tp.y = boxMin.y;\r\n\t\t\t\tn.y = boxMax.y;\r\n\t\t\t}\r\n\t\t\tif (planeNor.z >= 0) {\r\n\t\t\t\tp.z = boxMax.z;\r\n\t\t\t\tn.z = boxMin.z;\r\n\t\t\t} else {\r\n\t\t\t\tp.z = boxMin.z;\r\n\t\t\t\tn.z = boxMax.z;\r\n\t\t\t}\r\n\r\n\t\t\tif (CollisionUtils.intersectsPlaneAndPoint(plane, p) === Plane.PlaneIntersectionType_Back)\r\n\t\t\t\treturn ContainmentType.Disjoint;\r\n\r\n\t\t\tif (CollisionUtils.intersectsPlaneAndPoint(plane, n) === Plane.PlaneIntersectionType_Back)\r\n\t\t\t\tresult = ContainmentType.Intersects;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param  sphere  \r\n\t * @returns :1,:2,:0\r\n\t */\r\n\tcontainsBoundSphere(sphere: BoundSphere): number {\r\n\t\tvar result: number = Plane.PlaneIntersectionType_Front;\r\n\t\tvar planeResult: number = Plane.PlaneIntersectionType_Front;\r\n\t\tfor (var i: number = 0; i < 6; i++) {\r\n\t\t\tswitch (i) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndSphere(this._near, sphere);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndSphere(this._far, sphere);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndSphere(this._left, sphere);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndSphere(this._right, sphere);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndSphere(this._top, sphere);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 5:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndSphere(this._bottom, sphere);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tswitch (planeResult) {\r\n\r\n\t\t\t\tcase Plane.PlaneIntersectionType_Back:\r\n\t\t\t\t\treturn ContainmentType.Disjoint;\r\n\t\t\t\tcase Plane.PlaneIntersectionType_Intersecting:\r\n\t\t\t\t\tresult = Plane.PlaneIntersectionType_Intersecting;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tswitch (result) {\r\n\r\n\t\t\tcase Plane.PlaneIntersectionType_Intersecting:\r\n\t\t\t\treturn ContainmentType.Intersects;\r\n\t\t\tdefault:\r\n\t\t\t\treturn ContainmentType.Contains;\r\n\t\t}\r\n\t}\r\n\r\n\tcloneTo(dest: BoundFrustum) {\r\n\t\tdest.matrix = this.matrix;\r\n\t}\r\n\r\n\tclone(): BoundFrustum {\r\n\t\tlet dest = new BoundFrustum(new Matrix4x4);\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n}\r\n\r\n\r\n","import { Component } from \"../../../components/Component\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { VolumeManager } from \"./VolumeManager\";\r\nimport { Event } from \"../../../events/Event\";\r\nimport { Scene3D } from \"../../core/scene/Scene3D\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\nexport enum volumeIntersectType {\r\n    /** */\r\n    contain,\r\n    /** */\r\n    intersect,\r\n    /***/\r\n    Disjoint\r\n}\r\n\r\n/**\r\n * Volume\r\n */\r\nexport class volumeIntersectInfo {\r\n    type: volumeIntersectType;\r\n    /** */\r\n    intersectRate: number;\r\n}\r\n\r\nexport class Volume extends Component {\r\n    /**@internal */\r\n    protected _primitiveBounds: Bounds;\r\n    /**  */\r\n    protected _bounds: Bounds;\r\n    /**cache number of around Volume */\r\n    protected _aroundVolumeCacheNum: number = 0;\r\n    /** around Volume */\r\n    protected _aroundVolume: Volume[];\r\n    /** volume manager */\r\n    protected _volumeManager: VolumeManager;\r\n    /** volume intersect Comonent */\r\n    protected _type: number;\r\n    /**  */\r\n    protected _importance: number;\r\n\r\n    /**\r\n     * <code>Volume</code>\r\n     */\r\n    constructor() {\r\n        super();\r\n        this._bounds = new Bounds();\r\n        this._primitiveBounds = new Bounds();\r\n        this._importance = 0;\r\n        this.runInEditor = true;\r\n    }\r\n\r\n    /**\r\n     * volume Type\r\n     */\r\n    get type() {\r\n        return this._type;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    get bounds(): Bounds {\r\n        return this._bounds;\r\n    }\r\n\r\n    get boundsMax(): Vector3 {\r\n        return this._primitiveBounds.getMax();\r\n    }\r\n\r\n    /**\r\n     * primitivemax\r\n     */\r\n    set boundsMax(value: Vector3) {\r\n        this._primitiveBounds.setMax(value);\r\n        this._reCaculateBoundBox();\r\n    }\r\n\r\n    /**\r\n     * primitiveBoxMax\r\n     */\r\n    set boundsMin(value: Vector3) {\r\n        this._primitiveBounds.setMin(value);\r\n        this._reCaculateBoundBox();\r\n    }\r\n\r\n    get boundsMin(): Vector3 {\r\n        return this._primitiveBounds.getMin();\r\n    }\r\n\r\n    get probePosition(): Vector3 {\r\n        return (this.owner as Sprite3D).transform.position;\r\n    }\r\n\r\n    get importance() {\r\n        return this._importance;\r\n    }\r\n\r\n    set importance(value: number) {\r\n        this._importance = value;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onEnable(): void {\r\n        (this.owner as Sprite3D).transform.on(Event.TRANSFORM_CHANGED, this, this._VolumeChange);\r\n        this._volumeManager = ((this.owner as Sprite3D).scene as Scene3D)._volumeManager;\r\n        this._volumeManager.add(this);\r\n        this._reCaculateBoundBox();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onDisable(): void {\r\n        (this.owner as Sprite3D).transform.off(Event.TRANSFORM_CHANGED, this, this._VolumeChange);\r\n        this._volumeManager.remove(this);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param renderNode \r\n     */\r\n    _addRenderNode?(renderNode: BaseRender): void;\r\n\r\n    /**\r\n     * \r\n     * @param renderNode    \r\n     */\r\n    _removeRenderNode?(renderNode: BaseRender): void;\r\n\r\n    /**\r\n     * \r\n     * @param renderNode \r\n     */\r\n    _motionInVolume?(renderNode: BaseRender): void;\r\n\r\n\r\n    /**\r\n     * Volume change\r\n     */\r\n    _VolumeChange() {\r\n        this._volumeManager._needUpdateAllRender = true;\r\n        this._reCaculateBoundBox();\r\n    }\r\n\r\n    _reCaculateBoundBox() {\r\n        this.owner && this._primitiveBounds._tranform((this.owner as Sprite3D).transform.worldMatrix, this._bounds);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _cloneTo(dest: Volume): void {\r\n    }\r\n\r\n}","/**\r\n * \r\n */\r\nexport enum AmbientMode {\r\n    /** */\r\n    SolidColor,\r\n    /** ,  */\r\n    SphericalHarmonics,\r\n    /** , ,  */\r\n    TripleColor\r\n}\r\n","import { TextureDecodeFormat } from \"../../../../RenderEngine/RenderEnum/TextureDecodeFormat\";\r\nimport { Sprite3D } from \"../../../core/Sprite3D\";\r\nimport { Bounds } from \"../../../math/Bounds\";\r\nimport { TextureCube } from \"../../../../resource/TextureCube\";\r\nimport { Volume } from \"../Volume\";\r\nimport { VolumeManager } from \"../VolumeManager\";\r\nimport { SphericalHarmonicsL2, SphericalHarmonicsL2Generater } from \"../../../graphics/SphericalHarmonicsL2\";\r\nimport { ShaderData, ShaderDataType } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { RenderableSprite3D } from \"../../../core/RenderableSprite3D\";\r\nimport { Sprite3DRenderDeclaration } from \"../../../core/render/Sprite3DRenderDeclaration\";\r\nimport { ILaya3D } from \"../../../../../ILaya3D\";\r\nimport { AmbientMode } from \"../../../core/scene/AmbientMode\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\n\r\n\r\n/**\r\n * \r\n */\r\nexport enum ReflectionProbeMode {\r\n\t/** */\r\n\toff = 0,//Back\r\n\t/** */\r\n\tsimple = 1,\r\n}\r\n/**\r\n * <code>ReflectionProbe</code> \r\n * @miner\r\n */\r\nexport class ReflectionProbe extends Volume {\r\n\t// \r\n\tstatic TEMPVECTOR3: Vector3 = new Vector3();\r\n\t/**  */\r\n\tstatic defaultTextureHDRDecodeValues: Vector4 = new Vector4(1.0, 1.0, 0.0, 0.0);\r\n\t/**  */\r\n\tprivate _boxProjection: boolean = false;\r\n\t/**  */\r\n\tprotected _bounds: Bounds;\r\n\t/**  */\r\n\tprotected _importance: number;\r\n\t/** */\r\n\tprivate _ambientColor: Color = new Color();\r\n\t/**SH */\r\n\tprivate _ambientSH: Float32Array;\r\n\t/** */\r\n\tprivate _ambientIntensity: number;\r\n\t/**ibl */\r\n\tprivate _iblTex: TextureCube;\r\n\t/**ibl */\r\n\tprivate _iblTexRGBD: boolean;\r\n\t/** */\r\n\tprivate _reflectionIntensity: number;\r\n\t/** @internal */\r\n\tprivate _ambientMode: AmbientMode = AmbientMode.SolidColor;\r\n\r\n\t/**  */\r\n\t_isScene: boolean = false;\r\n\t/**shaderupdateMask */\r\n\t_updateMark: number;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._importance = 0;\r\n\t\tthis._type = VolumeManager.ReflectionProbeVolumeType;\r\n\t\tthis._ambientIntensity = 1.0;\r\n\t\tthis._reflectionIntensity = 1.0;\r\n\t\tthis.boundsMax = new Vector3(5, 5, 5);\r\n\t\tthis.boundsMin = new Vector3(-5, -5, -5);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget boxProjection(): boolean {\r\n\t\treturn this._boxProjection;\r\n\t}\r\n\r\n\tset boxProjection(value: boolean) {\r\n\t\tif (value != this._boxProjection) {\r\n\t\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t\t}\r\n\t\tthis._boxProjection = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget importance(): number {\r\n\t\treturn this._importance;\r\n\t}\r\n\r\n\tset importance(value: number) {\r\n\t\tthis._importance = value\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget ambientIntensity(): number {\r\n\t\treturn this._ambientIntensity;\r\n\t}\r\n\r\n\tset ambientIntensity(value: number) {\r\n\t\tif (value == this._ambientIntensity) return;\r\n\t\tthis._ambientIntensity = value;\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget reflectionIntensity(): number {\r\n\t\treturn this._reflectionIntensity;\r\n\t}\r\n\r\n\tset reflectionIntensity(value: number) {\r\n\t\tif (value == this._reflectionIntensity) return;\r\n\t\tvalue = Math.max(value, 0.0);\r\n\t\tthis._reflectionIntensity = value\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget bounds(): Bounds {\r\n\t\treturn this._bounds as Bounds;\r\n\t}\r\n\r\n\t/**\r\n\t *  max\r\n\t */\r\n\tset boundsMax(value: Vector3) {\r\n\t\tsuper.boundsMax = value;\r\n\t\tif (this.boxProjection)\r\n\t\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\tget boundsMax(): Vector3 {\r\n\t\treturn this._primitiveBounds.getMax();\r\n\t}\r\n\r\n\t/**\r\n\t *  min\r\n\t */\r\n\tset boundsMin(value: Vector3) {\r\n\t\tsuper.boundsMin = value;\r\n\t\tif (this.boxProjection)\r\n\t\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\tget boundsMin(): Vector3 {\r\n\t\treturn this._primitiveBounds.getMin();\r\n\t}\r\n\r\n\t/**\r\n\t * probe \r\n\t */\r\n\tget probePosition(): Vector3 {\r\n\t\treturn (this.owner as Sprite3D).transform.position;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tpublic get ambientColor(): Color {\r\n\t\treturn this._ambientColor;\r\n\t}\r\n\tpublic set ambientColor(value: Color) {\r\n\t\tvalue && value.cloneTo(this._ambientColor);\r\n\t\tif (this.ambientMode == AmbientMode.SolidColor)\r\n\t\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\t/**\r\n\t *  sh\r\n\t */\r\n\tpublic get ambientSH(): Float32Array {\r\n\t\treturn this._ambientSH;\r\n\t}\r\n\r\n\tpublic set ambientSH(value: Float32Array) {\r\n\t\tif (this.ambientMode == AmbientMode.SphericalHarmonics)\r\n\t\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t\tthis._ambientSH = value;\r\n\t}\r\n\r\n\t/**\r\n\t* \r\n\t* AmbientMode.SolidColorambientColorAmbientMode.SphericalHarmonicsambientSphericalHarmonics\r\n\t*/\r\n\tget ambientMode(): AmbientMode {\r\n\t\treturn this._ambientMode;\r\n\t}\r\n\r\n\tset ambientMode(value: AmbientMode) {\r\n\t\tif (value == this.ambientMode) return;\r\n\t\tthis._ambientMode = value;\r\n\t\tif (!this.ambientSH) {\r\n\t\t\tif (value == AmbientMode.SphericalHarmonics) {\r\n\t\t\t\tthis._ambientSphericalHarmonics && this._applySHCoefficients(this._ambientSphericalHarmonics, Math.pow(this._ambientIntensity, 2.2));\r\n\t\t\t} else if (value == AmbientMode.TripleColor) {\r\n\t\t\t\tthis._ambientTripleColorSphericalHarmonics && this._applySHCoefficients(this._ambientTripleColorSphericalHarmonics, 1.0);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Image base Light\r\n\t */\r\n\tpublic get iblTex(): TextureCube {\r\n\t\treturn this._iblTex;\r\n\t}\r\n\r\n\tpublic set iblTex(value: TextureCube) {\r\n\t\tif (this.iblTex == value) return;\r\n\t\tif (this.iblTex) this.iblTex._removeReference();\r\n\t\tthis._iblTex = value;\r\n\t\tif (value)\r\n\t\t\tvalue._addReference();\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\t/**\r\n\t * Image base Light Compress by RGBD\r\n\t */\r\n\tpublic get iblTexRGBD(): boolean {\r\n\t\treturn this._iblTexRGBD;\r\n\t}\r\n\r\n\tpublic set iblTexRGBD(value: boolean) {\r\n\t\tif (value == this._iblTexRGBD)\r\n\t\t\treturn;\r\n\t\tthis._iblTexRGBD = value;\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\tapplyReflectionShaderData(shaderData: ShaderData) {\r\n\t\t//boxProjection\r\n\t\tif (!this.boxProjection) {\r\n\t\t\tshaderData.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_SPECCUBE_BOX_PROJECTION);\r\n\t\t} else {\r\n\t\t\tshaderData.addDefine(Sprite3DRenderDeclaration.SHADERDEFINE_SPECCUBE_BOX_PROJECTION);\r\n\t\t\tshaderData.setShaderData(RenderableSprite3D.REFLECTIONCUBE_PROBEPOSITION, ShaderDataType.Vector3, this.probePosition);\r\n\t\t\tshaderData.setShaderData(RenderableSprite3D.REFLECTIONCUBE_PROBEBOXMAX, ShaderDataType.Vector3, this._bounds.getMax());\r\n\t\t\tshaderData.setShaderData(RenderableSprite3D.REFLECTIONCUBE_PROBEBOXMIN, ShaderDataType.Vector3, this._bounds.getMin());\r\n\r\n\t\t}\r\n\t\tif (this.ambientMode == AmbientMode.SolidColor) {\r\n\t\t\tshaderData.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_GI_LEGACYIBL);\r\n\t\t\tshaderData.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_GI_IBL);\r\n\t\t\tshaderData.setColor(RenderableSprite3D.AMBIENTCOLOR, this.ambientColor);\r\n\t\t} else if (this.iblTex && this.ambientSH) {\r\n\t\t\tshaderData.addDefine(Sprite3DRenderDeclaration.SHADERDEFINE_GI_IBL);\r\n\t\t\tshaderData.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_GI_LEGACYIBL);\r\n\t\t\tif (this.iblTex) {\r\n\t\t\t\tshaderData.setTexture(RenderableSprite3D.IBLTEX, this.iblTex);\r\n\t\t\t\tshaderData.setNumber(RenderableSprite3D.IBLROUGHNESSLEVEL, this.iblTex.maxMipmapLevel);\r\n\t\t\t};\r\n\t\t\tthis.iblTexRGBD ? shaderData.addDefine(Sprite3DRenderDeclaration.SHADERDEFINE_IBL_RGBD) : shaderData.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_IBL_RGBD);\r\n\t\t\tthis.ambientSH && shaderData.setBuffer(RenderableSprite3D.AMBIENTSH, this.ambientSH);\r\n\t\t} else {//Legency\r\n\t\t\tshaderData.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_GI_IBL);\r\n\t\t\tshaderData.addDefine(Sprite3DRenderDeclaration.SHADERDEFINE_GI_LEGACYIBL);\r\n\t\t\tif (this._reflectionTexture) {\r\n\t\t\t\tshaderData.setShaderData(RenderableSprite3D.REFLECTIONTEXTURE, ShaderDataType.TextureCube, this.reflectionTexture ? this.reflectionTexture : TextureCube.blackTexture);\r\n\t\t\t\tshaderData.setShaderData(RenderableSprite3D.REFLECTIONCUBE_HDR_PARAMS, ShaderDataType.Vector4, this.reflectionHDRParams);\r\n\t\t\t}\r\n\r\n\t\t\tif (this._shCoefficients) {\r\n\t\t\t\tshaderData.setVector(RenderableSprite3D.AMBIENTSHAR, this._shCoefficients[0]);\r\n\t\t\t\tshaderData.setVector(RenderableSprite3D.AMBIENTSHAG, this._shCoefficients[1]);\r\n\t\t\t\tshaderData.setVector(RenderableSprite3D.AMBIENTSHAB, this._shCoefficients[2]);\r\n\t\t\t\tshaderData.setVector(RenderableSprite3D.AMBIENTSHBR, this._shCoefficients[3]);\r\n\t\t\t\tshaderData.setVector(RenderableSprite3D.AMBIENTSHBG, this._shCoefficients[4]);\r\n\t\t\t\tshaderData.setVector(RenderableSprite3D.AMBIENTSHBB, this._shCoefficients[5]);\r\n\t\t\t\tshaderData.setVector(RenderableSprite3D.AMBIENTSHC, this._shCoefficients[6]);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tshaderData.setNumber(RenderableSprite3D.AMBIENTINTENSITY, this.ambientIntensity);\r\n\t\tshaderData.setNumber(RenderableSprite3D.REFLECTIONINTENSITY, this.reflectionIntensity);\r\n\t}\r\n\r\n\t/**\r\n\t* @inheritDoc\r\n\t* @override\r\n\t*/\r\n\tprotected _onEnable(): void {\r\n\t\tsuper._onEnable();\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tprotected _onDisable(): void {\r\n\t\tsuper._onDisable();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tprotected _onDestroy() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_cloneTo(dest: ReflectionProbe): void {\r\n\t\t//TODO\r\n\t}\r\n\r\n\r\n\r\n\t//----------------------------------------deprecated--------------------------------------------\r\n\t/**\r\n\t * @deprecated\r\n\t *   */\r\n\tprivate _reflectionTexture: TextureCube;\r\n\t/**\r\n\t * @deprecated\r\n\t *   \r\n\t */\r\n\tprivate _reflectionHDRParams: Vector4 = new Vector4();\r\n\t/**\r\n\t * @deprecated  \r\n\t */\r\n\tprivate _reflectionDecodeFormat: TextureDecodeFormat = TextureDecodeFormat.Normal;\r\n\t/**\r\n\t * @deprecated\r\n\t *  @internal \r\n\t */\r\n\tprivate _ambientSphericalHarmonics: SphericalHarmonicsL2;\r\n\t/**\r\n\t * \r\n\t * @deprecated\r\n\t *  @internal \r\n\t */\r\n\tprivate _ambientTripleColorSphericalHarmonics: SphericalHarmonicsL2;\r\n\t/**\r\n\t * @deprecated\r\n\t *  @internal \r\n\t */\r\n\tprivate _shCoefficients: Vector4[];\r\n\t/**\r\n\t * @deprecated\r\n\t *  @internal \r\n\t */\r\n\tprivate _ambientSkyColor: Vector3 = new Vector3();\r\n\t/**\r\n\t * @deprecated\r\n\t *  @internal \r\n\t */\r\n\tprivate _ambientEquatorColor: Vector3 = new Vector3();\r\n\t/**\r\n\t * @deprecated\r\n\t *  @internal \r\n\t */\r\n\tprivate _ambientGroundColor: Vector3 = new Vector3();\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * \r\n\t */\r\n\tget reflectionTexture() {\r\n\t\treturn this._reflectionTexture;\r\n\t}\r\n\r\n\tset reflectionTexture(value: TextureCube) {\r\n\t\tif (this._reflectionTexture == value) return;\r\n\t\tif (this._reflectionTexture) this.iblTex._removeReference();\r\n\t\tthis._reflectionTexture = value\r\n\t\tif (value) {\r\n\t\t\tthis._reflectionTexture._addReference();\r\n\t\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* @deprecated\r\n\t*/\r\n\tget customReflection(): TextureCube {\r\n\t\treturn this.reflectionTexture;\r\n\t}\r\n\r\n\tset customReflection(value: TextureCube) {\r\n\t\tthis.reflectionTexture = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * \r\n\t */\r\n\tget reflectionHDRParams(): Vector4 {\r\n\t\treturn this._reflectionHDRParams;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset reflectionHDRParams(value: Vector4) {\r\n\t\tthis._reflectionHDRParams = value;\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @deprecated\r\n\t */\r\n\tget reflectionDecodingFormat(): TextureDecodeFormat {\r\n\t\treturn this._reflectionDecodeFormat;\r\n\t}\r\n\r\n\tset reflectionDecodingFormat(value: TextureDecodeFormat) {\r\n\t\tif (this._reflectionDecodeFormat != value) {\r\n\t\t\tthis._reflectionDecodeFormat = value;\r\n\t\t\tif (this._reflectionDecodeFormat == TextureDecodeFormat.RGBM)\r\n\t\t\t\tthis._reflectionHDRParams.x = 5.0;//5.0 is RGBM param\r\n\t\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* @deprecated\r\n\t* ,\r\n\t* use scene.ambientSH\r\n\t*/\r\n\tget ambientSphericalHarmonics(): SphericalHarmonicsL2 {\r\n\t\treturn this._ambientSphericalHarmonics;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * use scene.ambientSH\r\n\t */\r\n\tset ambientSphericalHarmonics(value: SphericalHarmonicsL2) {\r\n\t\tvar originalSH: SphericalHarmonicsL2 = value || SphericalHarmonicsL2._default;\r\n\r\n\t\tif (!this._ambientSphericalHarmonics) {\r\n\t\t\tthis._ambientSphericalHarmonics = new SphericalHarmonicsL2();\r\n\t\t}\r\n\t\tif (this._ambientSphericalHarmonics != value) {\r\n\t\t\tvalue.cloneTo(this._ambientSphericalHarmonics);\r\n\t\t\tthis._applySHCoefficients(this._ambientSphericalHarmonics, Math.pow(this.ambientIntensity, 2.2))\r\n\t\t}\r\n\t\tif (this.ambientMode == AmbientMode.TripleColor)\r\n\t\t\tthis._applySHCoefficients(originalSH, Math.pow(this.ambientIntensity, 2.2));//Gamma to Linear,I prefer use 'Color.gammaToLinearSpace',but must same with Unity now.\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate _applySHCoefficients(originalSH: SphericalHarmonicsL2, intensity: number): void {\r\n\t\tif (!this._shCoefficients) {\r\n\t\t\tthis._shCoefficients = new Array(7);\r\n\t\t\tfor (var i: number = 0; i < 7; i++)\r\n\t\t\t\tthis._shCoefficients[i] = new Vector4();\r\n\t\t}\r\n\t\tvar optSH: Vector4[] = this._shCoefficients;\r\n\t\tfor (var i = 0; i < 3; i++) {\r\n\t\t\tvar shaderSHA: Vector4 = optSH[i];\r\n\t\t\tvar shaderSHB: Vector4 = optSH[i + 3];\r\n\t\t\tshaderSHA.setValue(originalSH.getCoefficient(i, 3) * intensity, originalSH.getCoefficient(i, 1) * intensity, originalSH.getCoefficient(i, 2) * intensity, (originalSH.getCoefficient(i, 0) - originalSH.getCoefficient(i, 6)) * intensity);\r\n\t\t\tshaderSHB.setValue(originalSH.getCoefficient(i, 4) * intensity, originalSH.getCoefficient(i, 5) * intensity, originalSH.getCoefficient(i, 6) * 3 * intensity, originalSH.getCoefficient(i, 7) * intensity);// Quadratic polynomials \r\n\t\t}\r\n\t\toptSH[6].setValue(originalSH.getCoefficient(0, 8) * intensity, originalSH.getCoefficient(1, 8) * intensity, originalSH.getCoefficient(2, 8) * intensity, 1);// Final quadratic polynomial\r\n\t}\r\n\r\n\t/**\r\n   * @deprecated\r\n   *     \r\n   */\r\n\tpublic setGradientAmbient(skyColor: Vector3, equatorColor: Vector3, groundColor: Vector3) {\r\n\t\tthis._ambientSkyColor = skyColor;\r\n\t\tthis._ambientEquatorColor = equatorColor;\r\n\t\tthis._ambientGroundColor = groundColor;\r\n\r\n\t\tlet gradientSH = SphericalHarmonicsL2Generater.CalGradientSH(this._ambientSkyColor, this._ambientEquatorColor, this._ambientGroundColor, true);\r\n\t\tthis._ambientTripleColorSphericalHarmonics = gradientSH;\r\n\r\n\t\tif (this.ambientMode == AmbientMode.TripleColor) {\r\n\t\t\tthis._applySHCoefficients(gradientSH, 2.2);\r\n\t\t}\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n}\r\n\r\n\r\n","import { RenderElement } from \"./RenderElement\";\r\nimport { RenderContext3D } from \"./RenderContext3D\";\r\nimport { RenderableSprite3D } from \"../RenderableSprite3D\"\r\nimport { Transform3D } from \"../Transform3D\"\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { BoundFrustum } from \"../../math/BoundFrustum\"\r\nimport { Event } from \"../../../events/Event\"\r\nimport { Lightmap } from \"../scene/Lightmap\";\r\nimport { MeshSprite3DShaderDeclaration } from \"../../../d3/core/MeshSprite3DShaderDeclaration\";\r\nimport { TextureCube } from \"../../../resource/TextureCube\";\r\nimport { Component } from \"../../../components/Component\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { ShaderData, ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { TransLargeUBOUtils } from \"../TransLargeUBOUtils\";\r\nimport { IBaseRenderNode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IBaseRenderNode\";\r\nimport { SubUniformBufferData } from \"../../../RenderEngine/SubUniformBufferData\";\r\nimport { Stat } from \"../../../utils/Stat\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { Volume } from \"../../component/Volume/Volume\";\r\nimport { ReflectionProbe, ReflectionProbeMode } from \"../../component/Volume/reflectionProbe/ReflectionProbe\";\r\nimport { Mesh } from \"../../resource/models/Mesh\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { NodeFlags } from \"../../../Const\";\r\nimport { Sprite3DRenderDeclaration } from \"./Sprite3DRenderDeclaration\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { BatchRender } from \"../../component/Volume/BatchVolume/BatchRender\";\r\nimport { IBoundsCell } from \"../../math/IBoundsCell\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\n\r\nexport enum RenderBitFlag {\r\n    RenderBitFlag_CullFlag = 0,\r\n    RenderBitFlag_Batch = 1,\r\n    RenderBitFlag_Editor = 2,\r\n    RenderBitFlag_InstanceBatch = 3,\r\n    RenderBitFlag_VertexMergeBatch = 4,\r\n\r\n}\r\n/**\r\n * <code>Render</code> \r\n */\r\nexport class BaseRender extends Component implements IBoundsCell {\r\n    /** @internal */\r\n    static _meshVerticeDefine: Array<ShaderDefine> = [];\r\n\r\n    /**@internal */\r\n    private static _uniqueIDCounter: number = 0;\r\n\r\n    /**@internal */\r\n    static _tempBoundBoxCorners: Vector3[] = [new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3()];\r\n\r\n    /**@internal */\r\n    static _defaultLightmapScaleOffset: Vector4 = new Vector4(1.0, 1.0, 0.0, 0.0);\r\n\r\n    /**@internal */\r\n    static _transLargeUbO: TransLargeUBOUtils;\r\n\r\n    /**\r\n     * BaseRender Init\r\n     */\r\n    static __init__() {\r\n        BaseRender.shaderValueInit();\r\n        // if (Config3D._config._uniformBlock)\r\n        // \tBaseRender.initRenderableLargeUniformBlock();\r\n    }\r\n    /**\r\n      * @internal\r\n      * @param mesh \r\n      * @param out \r\n      */\r\n    static getMeshDefine(mesh: Mesh, out: Array<ShaderDefine>): number {\r\n        out.length = 0;\r\n        var define: number;\r\n        for (var i: number = 0, n: number = mesh._subMeshes.length; i < n; i++) {\r\n            var subMesh = mesh.getSubMesh(i);\r\n            var vertexElements: any[] = subMesh._vertexBuffer._vertexDeclaration._vertexElements;\r\n            for (var j: number = 0, m: number = vertexElements.length; j < m; j++) {\r\n                var vertexElement = vertexElements[j];\r\n                var name: number = vertexElement._elementUsage;\r\n                switch (name) {\r\n                    case VertexMesh.MESH_COLOR0:\r\n                        out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_COLOR);\r\n                        break\r\n                    case VertexMesh.MESH_TEXTURECOORDINATE0:\r\n                        out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV0);\r\n                        break;\r\n                    case VertexMesh.MESH_TEXTURECOORDINATE1:\r\n                        out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV1);\r\n                        break;\r\n                    case VertexMesh.MESH_TANGENT0:\r\n                        out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_TANGENT);\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        return define;\r\n    }\r\n\r\n    static changeVertexDefine(oldMesh: Mesh, mesh: Mesh, defineDatas: ShaderData) {\r\n\r\n        var lastValue: Mesh = oldMesh;\r\n        if (lastValue) {\r\n            BaseRender.getMeshDefine(lastValue, BaseRender._meshVerticeDefine);\r\n            for (var i: number = 0, n: number = BaseRender._meshVerticeDefine.length; i < n; i++)\r\n                defineDatas.removeDefine(BaseRender._meshVerticeDefine[i]);\r\n        }\r\n        if (mesh) {\r\n            BaseRender.getMeshDefine(mesh, BaseRender._meshVerticeDefine);\r\n            for (var i: number = 0, n: number = BaseRender._meshVerticeDefine.length; i < n; i++)\r\n                defineDatas.addDefine(BaseRender._meshVerticeDefine[i]);\r\n        }\r\n    }\r\n\r\n    static shaderValueInit() {\r\n        Sprite3DRenderDeclaration.SHADERDEFINE_GI_LEGACYIBL = Shader3D.getDefineByName(\"GI_LEGACYIBL\");\r\n        Sprite3DRenderDeclaration.SHADERDEFINE_GI_IBL = Shader3D.getDefineByName(\"GI_IBL\");\r\n        Sprite3DRenderDeclaration.SHADERDEFINE_IBL_RGBD = Shader3D.getDefineByName(\"IBL_RGBD\");\r\n        Sprite3DRenderDeclaration.SHADERDEFINE_SPECCUBE_BOX_PROJECTION = Shader3D.getDefineByName(\"SPECCUBE_BOX_PROJECTION\");\r\n\r\n        Sprite3DRenderDeclaration.SHADERDEFINE_VOLUMETRICGI = Shader3D.getDefineByName(\"VOLUMETRICGI\");\r\n    }\r\n\r\n    /** @internal */\r\n    private _lightmapScaleOffset: Vector4 = new Vector4(1, 1, 0, 0);\r\n    /** @internal */\r\n    private _lightmapIndex: number;\r\n    /** @internal */\r\n    private _materialsInstance: boolean[];\r\n    /**@internal */\r\n    _commonUniformMap: Array<string> = [];\r\n    /** @internal */\r\n    _sharedMaterials: Material[] = [];\r\n    /** @internal TODO*/\r\n    _supportOctree: boolean = true;\r\n    /** @internal TODO*/\r\n    _scene: any;//Scene3D\r\n    /** @internal */\r\n    _sceneUpdateMark: number = -1;\r\n    /** @internal */\r\n    _updateMark: number = -1;\r\n    /** @internal */\r\n    _probReflection: ReflectionProbe;\r\n    /**@internal  */\r\n    _probeReflectionUpdateMark: number = -1;\r\n    /** @internal */\r\n    _surportReflectionProbe: boolean = false;\r\n    /** @internal  off  simple */\r\n    _reflectionMode: number = ReflectionProbeMode.simple;\r\n    /** @internal */\r\n    _shaderValues: ShaderData;\r\n    /**@internal */\r\n    _renderElements: RenderElement[];\r\n    /** @internal */\r\n    _updateRenderType: number = -1;\r\n    /***/\r\n    sortingFudge: number;\r\n    /**@internal */\r\n    _subUniformBufferData: SubUniformBufferData;\r\n    /**@internal motion list indexnot motion is -1*/\r\n    _motionIndexList: number = -1;\r\n    /**@internal needRender*/\r\n    _customCull: boolean;\r\n    /**@internal */\r\n    _ratioIgnor: number = 0.005;//TODO\r\n    /**@internal TODO*/\r\n    _LOD: number = -1;\r\n    /**@internal TODO*/\r\n    _batchRender: BatchRender;\r\n    /**@internal 0,1lod*/\r\n    private _volume: Volume;\r\n    /**@internal */\r\n    protected _worldParams: Vector4;//x:invertFaceFront  yzw?\r\n    /**\r\n     * DistanceVolumCull\r\n     * \r\n     */\r\n    set ratioIgnor(value: number) {\r\n        this._ratioIgnor = value;\r\n    }\r\n\r\n    get ratioIgnor(): number {\r\n        return this._ratioIgnor;\r\n    }\r\n\r\n    get renderbitFlag() {\r\n        return this._rendernode.renderbitFlag;\r\n    }\r\n\r\n    set boundsChange(value: boolean) {\r\n        this._rendernode.boundsChange = value\r\n    }\r\n\r\n    get boundsChange(): boolean {\r\n        return this._rendernode.boundsChange;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    shadowCullPass(): boolean {\r\n        return this.castShadow && this._enabled && (this.renderbitFlag == 0);\r\n    }\r\n\r\n    /**@internal */\r\n    protected _rendernode: IBaseRenderNode;\r\n\r\n    /** @internal */\r\n    protected _bounds: Bounds;\r\n\r\n    /** @internal */\r\n    protected _baseGeometryBounds: Bounds;\r\n\r\n    /**@internal */\r\n    protected _transform: Transform3D;\r\n\r\n    /**@internal */\r\n    _distanceForSort: number;\r\n\r\n    /**@interface */\r\n    _receiveShadow: boolean;\r\n\r\n    get renderNode(): IBaseRenderNode {\r\n        return this._rendernode;\r\n    }\r\n\r\n    set distanceForSort(value: number) {\r\n        this._distanceForSort = value;\r\n        this._rendernode.distanceForSort = value;\r\n    }\r\n\r\n    get distanceForSort() {\r\n        return this._distanceForSort;\r\n    }\r\n\r\n    /**\r\n     * GeometryBounds\r\n     * boundsgeometryBoundstransformnative\r\n     * @internal\r\n     */\r\n    set geometryBounds(value: Bounds) {\r\n        this._baseGeometryBounds = this._rendernode.geometryBounds = value;\r\n    }\r\n\r\n    get geometryBounds(): Bounds {\r\n        return this._baseGeometryBounds;\r\n    }\r\n    /**\r\n     * ID,\r\n     */\r\n    get id(): number {\r\n        return this._rendernode.renderId;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get lightmapIndex(): number {\r\n        return this._lightmapIndex;\r\n    }\r\n\r\n    set lightmapIndex(value: number) {\r\n        if (value != -1) {\r\n            this._scene && this._scene.on(Lightmap.ApplyLightmapEvent, this, this._applyLightMapParams);\r\n        } else {\r\n            this._scene && this._scene.off(Lightmap.ApplyLightmapEvent, this, this._applyLightMapParams);\r\n        }\r\n        this._lightmapIndex = value;\r\n        this._scene && this._applyLightMapParams();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get lightmapScaleOffset(): Vector4 {\r\n        return this._lightmapScaleOffset;\r\n    }\r\n\r\n    set lightmapScaleOffset(value: Vector4) {\r\n        if (!value)\r\n            throw \"BaseRender: lightmapScaleOffset can't be null.\";\r\n        this._lightmapScaleOffset = value;\r\n        this._setShaderValue(RenderableSprite3D.LIGHTMAPSCALEOFFSET, ShaderDataType.Vector4, value);\r\n    }\r\n\r\n    /**\r\n     * ,\r\n     */\r\n    get material(): Material {\r\n        var material: Material = this._sharedMaterials[0];\r\n        if (material && !this._materialsInstance[0]) {\r\n            var insMat: Material = this._getInstanceMaterial(material, 0);\r\n            var renderElement: RenderElement = this._renderElements[0];\r\n            (renderElement) && (renderElement.material = insMat);\r\n        }\r\n        return this._sharedMaterials[0];\r\n    }\r\n\r\n    set material(value: Material) {\r\n        this.sharedMaterial = value;\r\n        this._isSupportReflection();\r\n    }\r\n\r\n    /**\r\n     * ,\r\n     */\r\n    get materials(): Material[] {\r\n        for (var i: number = 0, n: number = this._sharedMaterials.length; i < n; i++) {\r\n            if (!this._materialsInstance[i]) {\r\n                var insMat: Material = this._getInstanceMaterial(this._sharedMaterials[i], i);\r\n                var renderElement: RenderElement = this._renderElements[i];\r\n                (renderElement) && (renderElement.material = insMat);\r\n            }\r\n        }\r\n        return this._sharedMaterials.slice();\r\n    }\r\n\r\n    set materials(value: Material[]) {\r\n        this.sharedMaterials = value;\r\n        this._isSupportReflection();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get sharedMaterial(): Material {\r\n        return this._sharedMaterials[0];\r\n    }\r\n\r\n    set sharedMaterial(value: Material) {\r\n        var lastValue: Material = this._sharedMaterials[0];\r\n        if (lastValue !== value) {\r\n            this._sharedMaterials[0] = value;\r\n            this._materialsInstance[0] = false;\r\n            this._changeMaterialReference(lastValue, value);\r\n            var renderElement: RenderElement = this._renderElements[0];\r\n            (renderElement) && (renderElement.material = value);\r\n        }\r\n        this._isSupportReflection();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get sharedMaterials(): Material[] {\r\n        return this._sharedMaterials.slice();\r\n    }\r\n\r\n    set sharedMaterials(value: Material[]) {\r\n        var materialsInstance: boolean[] = this._materialsInstance;\r\n        var sharedMats: Material[] = this._sharedMaterials;\r\n\r\n        for (var i: number = 0, n: number = sharedMats.length; i < n; i++) {\r\n            var lastMat: Material = sharedMats[i];\r\n            (lastMat) && (lastMat._removeReference());\r\n        }\r\n\r\n        if (value) {\r\n            var count: number = value.length;\r\n            materialsInstance.length = count;\r\n            sharedMats.length = count;\r\n            for (i = 0; i < count; i++) {\r\n                lastMat = sharedMats[i];\r\n                var mat: Material = value[i];\r\n                if (lastMat !== mat) {\r\n                    materialsInstance[i] = false;\r\n                    var renderElement: RenderElement = this._renderElements[i];\r\n                    (renderElement) && (renderElement.material = mat);\r\n                }\r\n                if (mat) {\r\n                    mat._addReference();\r\n                }\r\n                sharedMats[i] = mat;\r\n            }\r\n        } else {\r\n            throw new Error(\"BaseRender: shadredMaterials value can't be null.\");\r\n        }\r\n        this._isSupportReflection();\r\n    }\r\n\r\n    /**\r\n     * ,,\r\n     */\r\n    get bounds(): Bounds {\r\n        if (this.boundsChange) {\r\n            this._calculateBoundingBox();\r\n            this.boundsChange = false;\r\n        }\r\n        return this._bounds as Bounds;\r\n    }\r\n\r\n    set receiveShadow(value: boolean) {\r\n        if (this.renderNode.receiveShadow !== value) {\r\n            this.renderNode.receiveShadow = value;\r\n            this._receiveShadow = value;\r\n            if (value)\r\n                this._shaderValues.addDefine(RenderableSprite3D.SHADERDEFINE_RECEIVE_SHADOW);\r\n            else\r\n                this._shaderValues.removeDefine(RenderableSprite3D.SHADERDEFINE_RECEIVE_SHADOW);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get receiveShadow(): boolean {\r\n        return this.renderNode.receiveShadow;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get castShadow(): boolean {\r\n        return this.renderNode.castShadow;\r\n    }\r\n\r\n    set castShadow(value: boolean) {\r\n        this.renderNode.castShadow = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set reflectionMode(value: ReflectionProbeMode) {\r\n        this._reflectionMode = value;\r\n    }\r\n\r\n    get reflectionMode(): ReflectionProbeMode {\r\n        return this._reflectionMode;\r\n    }\r\n\r\n\r\n\r\n    set volume(value: Volume) {\r\n        if (!value) {//value = null,\r\n            if (this._volume) {\r\n                this._volume._removeRenderNode && this._volume._removeRenderNode(this);\r\n                this._volume = null;\r\n            }\r\n            return;\r\n        }\r\n        if (this._volume != value) {\r\n            value._addRenderNode && value._addRenderNode(this);\r\n            this._volume = value;\r\n            return;\r\n        } else {\r\n            value._motionInVolume && value._motionInVolume(this);\r\n        }\r\n    }\r\n\r\n    get volume(): Volume {\r\n        return this._volume;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    set probReflection(voluemProbe: ReflectionProbe) {\r\n        if (this._probReflection == voluemProbe)\r\n            return;\r\n        this._probeReflectionUpdateMark = -1;\r\n        this._probReflection = voluemProbe;\r\n        if (this._reflectionMode == ReflectionProbeMode.off) {\r\n            this._shaderValues.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_SPECCUBE_BOX_PROJECTION);\r\n            this._shaderValues.addDefine(Sprite3DRenderDeclaration.SHADERDEFINE_GI_IBL);\r\n            this._setShaderValue(RenderableSprite3D.IBLTEX, ShaderDataType.TextureCube, TextureCube.blackTexture);\r\n            this._setShaderValue(RenderableSprite3D.IBLROUGHNESSLEVEL, ShaderDataType.Float, 0);\r\n        } else {\r\n            this._probReflection.applyReflectionShaderData(this._shaderValues);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  <code>BaseRender</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._commonUniformMap = this._getcommonUniformMap();\r\n        this._rendernode = this._createBaseRenderNode();\r\n        this._rendernode.owner = this;\r\n        this._rendernode.renderId = ++BaseRender._uniqueIDCounter;\r\n        this._bounds = this._rendernode.bounds = new Bounds(Vector3.ZERO, Vector3.ZERO);\r\n        this._renderElements = [];\r\n        this._enabled = true;\r\n        this._materialsInstance = [];\r\n        this._shaderValues = LayaGL.renderOBJCreate.createShaderData(null);\r\n        this.lightmapIndex = -1;\r\n        this.receiveShadow = false;\r\n        this.sortingFudge = 0.0;\r\n        this._customCull = this._needRender !== BaseRender.prototype._needRender;\r\n        this.runInEditor = true;\r\n        this.boundsChange = true;\r\n        this._rendernode.renderbitFlag = 0;\r\n        this._rendernode.staticMask = 1;\r\n        this._worldParams = new Vector4(1.0, 0.0, 0.0, 0.0);\r\n    }\r\n\r\n    protected _getcommonUniformMap(): Array<string> {\r\n        return [\"Sprite3D\"];\r\n    }\r\n\r\n    protected _createBaseRenderNode(): IBaseRenderNode {\r\n        return Laya3DRender.renderOBJCreate.createBaseRenderNode();\r\n    }\r\n\r\n    private _changeLayer(layer: number) {\r\n        this._rendernode.layer = layer;\r\n    }\r\n\r\n    private _changeStaticMask(staticmask: number) {\r\n        this._rendernode.staticMask = staticmask;\r\n    }\r\n\r\n    protected _onAdded(): void {\r\n        this._transform = (this.owner as Sprite3D).transform;\r\n        (this.owner as Sprite3D)._isRenderNode++;\r\n        this.setRenderbitFlag(RenderBitFlag.RenderBitFlag_Editor, this.owner._getBit(NodeFlags.HIDE_BY_EDITOR));\r\n        this._rendernode.transform = this._transform;\r\n        this._changeLayer((this.owner as Sprite3D).layer);\r\n        this._changeStaticMask((this.owner as Sprite3D)._isStatic);\r\n    }\r\n\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n        if (this.owner) {\r\n            (this.owner as Sprite3D).transform.on(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange);//BaseRender,owner\r\n            (this.owner as Sprite3D).on(Event.LAYERCHANGE, this, this._changeLayer);\r\n            (this.owner as Sprite3D).on(Event.staticMask, this, this._changeStaticMask);\r\n            this._changeLayer((this.owner as Sprite3D).layer);\r\n            this._changeStaticMask((this.owner as Sprite3D)._isStatic);\r\n        }\r\n        this.owner.scene._addRenderObject(this);\r\n        this._setBelongScene(this.owner.scene);\r\n    }\r\n\r\n    protected _onDisable(): void {\r\n        if (this.owner) {\r\n            (this.owner as Sprite3D).transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange);//BaseRender,owner\r\n            (this.owner as Sprite3D).off(Event.LAYERCHANGE, this, this._changeLayer);\r\n            (this.owner as Sprite3D).off(Event.staticMask, this, this._changeStaticMask);\r\n        }\r\n        this.owner.scene._removeRenderObject(this);\r\n        this._setUnBelongScene();\r\n        this.volume = null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _changeMaterialReference(lastValue: Material, value: Material): void {\r\n        (lastValue) && (lastValue._removeReference());\r\n        value._addReference();//TODO:value\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _getInstanceMaterial(material: Material, index: number): Material {\r\n        var insMat: Material = material.clone();//\r\n        insMat.name = insMat.name + \"(Instance)\";\r\n        this._materialsInstance[index] = true;\r\n        this._changeMaterialReference(this._sharedMaterials[index], insMat);\r\n        this._sharedMaterials[index] = insMat;\r\n        return insMat;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _isSupportReflection() {\r\n        let pre = this._surportReflectionProbe;\r\n        this._surportReflectionProbe = false;\r\n        var sharedMats: Material[] = this._sharedMaterials;\r\n        for (var i: number = 0, n: number = sharedMats.length; i < n; i++) {\r\n            var mat: Material = sharedMats[i];\r\n            this._surportReflectionProbe ||= (this._surportReflectionProbe || (mat && mat._shader._supportReflectionProbe));//TODO\r\n        }\r\n        if (!pre && this._surportReflectionProbe)//Reflection\r\n            this._addReflectionProbeUpdate();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * BaseRender motion\r\n     */\r\n    protected _onWorldMatNeedChange(flag: number): void {\r\n        this.boundsChange = true;\r\n        this._addReflectionProbeUpdate();\r\n        this._subUniformBufferData && (this._subUniformBufferData._needUpdate = true);\r\n        this._batchRender && this._batchRender._updateOneRender(this);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _calculateBoundingBox(): void {\r\n        throw (\"BaseRender: must override it.\");\r\n    }\r\n\r\n\r\n    /**\r\n     * flag,1lod\r\n     */\r\n    setRenderbitFlag(flag: number, pass: boolean) {\r\n        if (pass)\r\n            this._rendernode.renderbitFlag |= (1 << flag);\r\n        else\r\n            this._rendernode.renderbitFlag &= ~(1 << flag);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setShaderValue(index: number, shaderdataType: ShaderDataType, value: any) {\r\n        this._shaderValues.setShaderData(index, shaderdataType, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     */\r\n    _addReflectionProbeUpdate() {\r\n        //TODOsimpleoff\r\n        this._scene && this._scene._volumeManager.addMotionObject(this);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    _applyLightMapParams(): void {\r\n        if (!this._scene) return;\r\n        var lightMaps: Lightmap[] = this._scene.lightmaps;\r\n        var shaderValues: ShaderData = this._shaderValues;\r\n        var lightmapIndex: number = this._lightmapIndex;\r\n        if (lightmapIndex >= 0 && lightmapIndex < lightMaps.length) {\r\n            var lightMap: Lightmap = lightMaps[lightmapIndex];\r\n            shaderValues.setTexture(RenderableSprite3D.LIGHTMAP, lightMap.lightmapColor);\r\n            shaderValues.addDefine(RenderableSprite3D.SAHDERDEFINE_LIGHTMAP);\r\n            if (lightMap.lightmapDirection) {\r\n                shaderValues.setTexture(RenderableSprite3D.LIGHTMAP_DIRECTION, lightMap.lightmapDirection);\r\n                shaderValues.addDefine(RenderableSprite3D.SHADERDEFINE_LIGHTMAP_DIRECTIONAL);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(RenderableSprite3D.SHADERDEFINE_LIGHTMAP_DIRECTIONAL);\r\n            }\r\n        } else {\r\n            shaderValues.removeDefine(RenderableSprite3D.SAHDERDEFINE_LIGHTMAP);\r\n            shaderValues.removeDefine(RenderableSprite3D.SHADERDEFINE_LIGHTMAP_DIRECTIONAL);\r\n        }\r\n    }\r\n\r\n    _applyReflection() {\r\n        if (!this._probReflection) return;\r\n        if (this._probReflection._updateMark != this._probeReflectionUpdateMark) {\r\n            this._probeReflectionUpdateMark = this._probReflection._updateMark;\r\n            this._probReflection.applyReflectionShaderData(this._shaderValues);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setBelongScene(scene: any): void {\r\n        this._scene = scene;\r\n        this._onWorldMatNeedChange(1);\r\n        this._isSupportReflection();\r\n        this._batchRender && this._batchRender._batchOneRender(this);\r\n        this.lightmapIndex = this.lightmapIndex;\r\n        Stat.renderNode++;\r\n        if (false) {\r\n            this._subUniformBufferData = BaseRender._transLargeUbO.create();\r\n            this._subUniformBufferData.setMatrix(\"u_WorldMat\", Matrix4x4.DEFAULT);\r\n            this._addReflectionProbeUpdate();\r\n            this.probReflection = this._probReflection;\r\n            this.lightmapScaleOffset = this._lightmapScaleOffset;\r\n            this._subUniformBufferData._needUpdate = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setUnBelongScene() {\r\n        Stat.renderNode--;\r\n        this._scene._volumeManager.removeMotionObject(this);\r\n        let batch = this._batchRender;\r\n        this._batchRender && this._batchRender._removeOneRender(this);\r\n        this._batchRender = batch;\r\n        if (false) {\r\n            this._subUniformBufferData && BaseRender._transLargeUbO.recover(this._subUniformBufferData);\r\n            this._subUniformBufferData = null;\r\n        }\r\n        this._scene = null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param boundFrustum \r\n     */\r\n    _needRender(boundFrustum: BoundFrustum, context: RenderContext3D): boolean {\r\n        if (boundFrustum)\r\n            return boundFrustum.intersects(this.bounds);\r\n        else\r\n            return true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    _CullOut(): void {\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _renderUpdate(context: RenderContext3D, transform: Transform3D): void {\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _renderUpdateWithCamera(context: RenderContext3D, transform: Transform3D): void {\r\n    }\r\n\r\n    protected _onDestroy() {\r\n        if (this.owner as Sprite3D)\r\n            (this.owner as Sprite3D)._isRenderNode--;\r\n        (this._motionIndexList !== -1) && (this._scene._sceneRenderManager.removeMotionObject(this));\r\n        (this._scene) && this._scene.sceneRenderableManager.removeRenderObject(this);\r\n        var i: number = 0, n: number = 0;\r\n        for (i = 0, n = this._renderElements.length; i < n; i++)\r\n            this._renderElements[i].destroy();\r\n        for (i = 0, n = this._sharedMaterials.length; i < n; i++) {\r\n            let m = this._sharedMaterials[i];\r\n            m && !m.destroyed && m._removeReference();\r\n        }\r\n        this._renderElements = null;\r\n        this._sharedMaterials = null;\r\n        this._bounds = null;\r\n        this._lightmapScaleOffset = null;\r\n        this._lightmapIndex = -1;\r\n        this._scene = null;\r\n        this._rendernode = null;\r\n        this._shaderValues.destroy();\r\n        this._shaderValues = null;\r\n        this._transform = null;\r\n        this._batchRender = null;\r\n        if (this._subUniformBufferData) {\r\n            BaseRender._transLargeUbO.recover(this._subUniformBufferData);\r\n            this._subUniformBufferData = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @param dest \r\n     */\r\n    _cloneTo(dest: Component): void {\r\n        super._cloneTo(dest);\r\n        let render = (dest as BaseRender);\r\n        render.receiveShadow = this.receiveShadow;\r\n        render.sharedMaterials = this.sharedMaterials;\r\n        render.reflectionMode = this.reflectionMode;\r\n        render.castShadow = this.castShadow;\r\n        render.sortingFudge = this.sortingFudge;\r\n    }\r\n}\r\n\r\n","/**\r\n * \r\n */\r\nexport enum ShadowMode {\r\n    /***/\r\n    None,\r\n    /***/\r\n    Hard,\r\n    /***/\r\n    SoftLow,\r\n    /**,*/\r\n    SoftHigh\r\n}","/**\r\n * \r\n */\r\nexport enum ShadowCascadesMode {\r\n    /**  */\r\n    NoCascades,\r\n    /**  */\r\n    TwoCascades,\r\n    /**  */\r\n    FourCascades,\r\n}","import { Config3D } from \"../../../../Config3D\";\r\nimport { Scene3D } from \"../scene/Scene3D\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { ShadowMode } from \"./ShadowMode\";\r\nimport { Component } from \"../../../components/Component\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\n\r\nexport enum LightType {\r\n    Directional,\r\n    Spot,\r\n    Point,\r\n    Area\r\n}\r\n\r\nexport enum LightMode {\r\n    mix,\r\n    realTime,//\r\n    bakeOnly\r\n}\r\n\r\n/**\r\n * <code>LightSprite</code> \r\n */\r\nexport class Light extends Component {\r\n\r\n    /** @internal */\r\n    protected _shadowMode: ShadowMode = ShadowMode.None;\r\n\r\n    /** @internal */\r\n    _isAlternate: boolean = false;\r\n    /** @internal */\r\n    _intensityColor: Vector3;\r\n    /** @internal */\r\n    _intensity: number;\r\n    /** @internal */\r\n    _shadowResolution: number = 2048;\r\n    /** @internal */\r\n    _shadowDistance: number = 50.0;\r\n    /** @internal */\r\n    _shadowDepthBias: number = 1.0;\r\n    /** @internal */\r\n    _shadowNormalBias: number = 1.0;\r\n    /** @internal */\r\n    _shadowNearPlane: number = 0.1;\r\n    /** @internal */\r\n    _shadowStrength: number = 1.0;\r\n    /** @internal */\r\n    _lightmapBakedType: LightMode;\r\n    /** @internal */\r\n    _lightType: LightType;\r\n    /** @internal scale*/\r\n    _lightWoldMatrix: Matrix4x4 = new Matrix4x4();\r\n\r\n    /**  */\r\n    color: Color;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get intensity(): number {\r\n        return this._intensity;\r\n    }\r\n\r\n    set intensity(value: number) {\r\n        this._intensity = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowMode(): ShadowMode {\r\n        return this._shadowMode;\r\n    }\r\n\r\n    set shadowMode(value: ShadowMode) {\r\n        this._shadowMode = value\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowDistance(): number {\r\n        return this._shadowDistance;\r\n    }\r\n\r\n    set shadowDistance(value: number) {\r\n        this._shadowDistance = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowResolution(): number {\r\n        return this._shadowResolution;\r\n    }\r\n\r\n    set shadowResolution(value: number) {\r\n        this._shadowResolution = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowDepthBias(): number {\r\n        return this._shadowDepthBias;\r\n    }\r\n\r\n    set shadowDepthBias(value: number) {\r\n        this._shadowDepthBias = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowNormalBias(): number {\r\n        return this._shadowNormalBias;\r\n    }\r\n\r\n    set shadowNormalBias(value: number) {\r\n        this._shadowNormalBias = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowStrength(): number {\r\n        return this._shadowStrength;\r\n    }\r\n\r\n    set shadowStrength(value: number) {\r\n        this._shadowStrength = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowNearPlane(): number {\r\n        return this._shadowNearPlane;\r\n    }\r\n\r\n    set shadowNearPlane(value: number) {\r\n        this._shadowNearPlane = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get lightmapBakedType(): LightMode {\r\n        return this._lightmapBakedType;\r\n    }\r\n\r\n    set lightmapBakedType(value: LightMode) {\r\n        let premode = this._lightmapBakedType;\r\n        if (this._lightmapBakedType !== value) {\r\n            this._lightmapBakedType = value;\r\n            if (this._enabled) {\r\n                if (value == LightMode.bakeOnly)\r\n                    this._removeFromScene();\r\n                else\r\n                    if (premode == LightMode.bakeOnly)\r\n                        this._addToScene();\r\n            }\r\n        }\r\n    }\r\n\r\n    get lightWorldMatrix(): Matrix4x4 {\r\n        var position = (this.owner as Sprite3D).transform.position;\r\n        var quaterian = (this.owner as Sprite3D).transform.rotation;\r\n        Matrix4x4.createAffineTransformation(position, quaterian, Vector3.ONE, this._lightWoldMatrix);\r\n        return this._lightWoldMatrix;\r\n    }\r\n\r\n    get lightType() {\r\n        return this._lightType;\r\n    }\r\n\r\n    /**\r\n     *  <code>LightSprite</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n\r\n        this.runInEditor = true;\r\n        this._intensity = 1.0;\r\n        this._intensityColor = new Vector3();\r\n        this.color = new Color(1.0, 1.0, 1.0, 1.0);\r\n        this._lightmapBakedType = LightMode.realTime;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n        var colorData: any[] = data.color;\r\n        this.color.r = colorData[0];\r\n        this.color.g = colorData[1];\r\n        this.color.b = colorData[2];\r\n        this.intensity = data.intensity;\r\n        this.lightmapBakedType = data.lightmapBakedType;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _cloneTo(dest: Component) {\r\n        super._cloneTo(dest);\r\n        var light = <Light>dest;\r\n        light.color = this.color.clone();\r\n        light.intensity = this.intensity;\r\n        light.lightmapBakedType = this.lightmapBakedType;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _addToScene(): void {\r\n        var scene: Scene3D = <Scene3D>this.owner.scene;\r\n        var maxLightCount: number = Config3D.maxLightCount;\r\n        if (scene._lightCount < maxLightCount) {\r\n            scene._lightCount++;\r\n            this._addToLightQueue();\r\n            this._isAlternate = false;\r\n        }\r\n        else {\r\n            scene._alternateLights.add(this);\r\n            this._isAlternate = true;\r\n            console.warn(\"LightSprite:light count has large than maxLightCount,the latest added light will be ignore.\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _removeFromScene(): void {\r\n        var scene: Scene3D = <Scene3D>this.owner._scene;\r\n        if (!scene)\r\n            return;\r\n        if (this._isAlternate) {\r\n            scene._alternateLights.remove(this);\r\n        }\r\n        else {\r\n            scene._lightCount--;\r\n            this._removeFromLightQueue();\r\n            if (scene._alternateLights._length > 0) {\r\n                var alternateLight = scene._alternateLights.shift();\r\n                alternateLight!._addToLightQueue();\r\n                alternateLight!._isAlternate = false;\r\n                scene._lightCount++;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _addToLightQueue(): void {\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _removeFromLightQueue(): void {\r\n    }\r\n\r\n    protected _onEnable(): void {\r\n        (this.lightmapBakedType !== LightMode.bakeOnly) && (this._addToScene());\r\n    }\r\n\r\n    protected _onDisable(): void {\r\n        (this.lightmapBakedType !== LightMode.bakeOnly) && (this._removeFromScene());\r\n    }\r\n\r\n    protected _onDestroy() {\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Component {\r\n        return new Light();\r\n    }\r\n}\r\n\r\n","import { BoundFrustum, FrustumCorner } from \"../../math/BoundFrustum\";\r\nimport { BoundSphere } from \"../../math/BoundSphere\";\r\nimport { Plane } from \"../../math/Plane\";\r\nimport { ShadowSliceData, ShadowSpotData } from \"../../shadowMap/ShadowSliceData\";\r\nimport { Utils3D } from \"../../utils/Utils3D\";\r\nimport { ShadowCascadesMode } from \"./ShadowCascadesMode\";\r\nimport { ShadowMode } from \"./ShadowMode\";\r\nimport { Light, LightType } from \"./Light\";\r\nimport { SpotLightCom } from \"./SpotLightCom\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { DirectionLightCom } from \"./DirectionLightCom\";\r\nimport { FilterMode } from \"../../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { WrapMode } from \"../../../RenderEngine/RenderEnum/WrapMode\";\r\nimport { RenderCapable } from \"../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { TextureCompareMode } from \"../../../RenderEngine/RenderEnum/TextureCompareMode\";\r\nimport { MathUtils3D } from \"../../../maths/MathUtils3D\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../../resource/RenderTexture\";\r\nimport { RenderTargetFormat } from \"../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\n\r\n/**\r\n * @internal\r\n */\r\nenum FrustumFace {\r\n    Near = 0,\r\n    Far = 1,\r\n    Left = 2,\r\n    Right = 3,\r\n    Bottom = 4,\r\n    Top = 5,\r\n}\r\n\r\nexport enum ShadowMapFormat {\r\n    bit16,\r\n    bit24_8,\r\n    bit32\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class ShadowUtils {\r\n    /** @internal */\r\n    private static _tempMatrix0: Matrix4x4 = new Matrix4x4()\r\n\r\n\r\n    /** @internal */\r\n    private static _shadowMapScaleOffsetMatrix: Matrix4x4 = new Matrix4x4(\r\n        0.5, 0.0, 0.0, 0.0,\r\n        0.0, 0.5, 0.0, 0.0,\r\n        0.0, 0.0, 1.0, 0.0,\r\n        0.5, 0.5, 0.0, 1.0,\r\n    );\r\n\r\n    /** @internal */\r\n    private static _frustumCorners: Vector3[] = [new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3()];\r\n    /** @internal */\r\n    private static _adjustNearPlane: Plane;\r\n    /** @internal */\r\n    private static _adjustFarPlane: Plane;\r\n    /** @internal */\r\n    private static _backPlaneFaces: FrustumFace[] = new Array(5);\r\n    /** @internal */\r\n    private static _edgePlanePoint2: Vector3 = new Vector3();\r\n\r\n    /** @internal */\r\n    private static _frustumPlaneNeighbors: FrustumFace[][] = [\r\n        [FrustumFace.Left, FrustumFace.Right, FrustumFace.Top, FrustumFace.Bottom],// near\r\n        [FrustumFace.Left, FrustumFace.Right, FrustumFace.Top, FrustumFace.Bottom],// far\r\n        [FrustumFace.Near, FrustumFace.Far, FrustumFace.Top, FrustumFace.Bottom],// left\r\n        [FrustumFace.Near, FrustumFace.Far, FrustumFace.Top, FrustumFace.Bottom],// right\r\n        [FrustumFace.Near, FrustumFace.Far, FrustumFace.Left, FrustumFace.Right],// bottom\r\n        [FrustumFace.Near, FrustumFace.Far, FrustumFace.Left, FrustumFace.Right]];// top\r\n\r\n    /** @internal */\r\n    private static _frustumTwoPlaneCorners: FrustumCorner[][][] = [\r\n        [[FrustumCorner.unknown, FrustumCorner.unknown]/* near */, [FrustumCorner.unknown, FrustumCorner.unknown]/* far */, [FrustumCorner.nearBottomLeft, FrustumCorner.nearTopLeft]/* left */, [FrustumCorner.nearTopRight, FrustumCorner.nearBottomRight]/* right */, [FrustumCorner.nearBottomRight, FrustumCorner.nearBottomLeft]/* bottom */, [FrustumCorner.nearTopLeft, FrustumCorner.nearTopRight]/* top */],// near\r\n        [[FrustumCorner.unknown, FrustumCorner.unknown]/* near */, [FrustumCorner.unknown, FrustumCorner.unknown]/* far */, [FrustumCorner.FarTopLeft, FrustumCorner.FarBottomLeft]/* left */, [FrustumCorner.FarBottomRight, FrustumCorner.FarTopRight]/* right */, [FrustumCorner.FarBottomLeft, FrustumCorner.FarBottomRight]/* bottom */, [FrustumCorner.FarTopRight, FrustumCorner.FarTopLeft]/* top */],// far\r\n        [[FrustumCorner.nearTopLeft, FrustumCorner.nearBottomLeft]/* near */, [FrustumCorner.FarBottomLeft, FrustumCorner.FarTopLeft]/* far */, [FrustumCorner.unknown, FrustumCorner.unknown]/* left */, [FrustumCorner.unknown, FrustumCorner.unknown]/* right */, [FrustumCorner.nearBottomLeft, FrustumCorner.FarBottomLeft]/* bottom */, [FrustumCorner.FarTopLeft, FrustumCorner.nearTopLeft]/* top */],// left\r\n        [[FrustumCorner.nearBottomRight, FrustumCorner.nearTopRight]/* near */, [FrustumCorner.FarTopRight, FrustumCorner.FarBottomRight]/* far */, [FrustumCorner.unknown, FrustumCorner.unknown]/* left */, [FrustumCorner.unknown, FrustumCorner.unknown]/* right */, [FrustumCorner.FarBottomRight, FrustumCorner.nearBottomRight]/* bottom */, [FrustumCorner.nearTopRight, FrustumCorner.FarTopRight]/* top */],// right\r\n        [[FrustumCorner.nearBottomLeft, FrustumCorner.nearBottomRight]/* near */, [FrustumCorner.FarBottomRight, FrustumCorner.FarBottomLeft]/* far */, [FrustumCorner.FarBottomLeft, FrustumCorner.nearBottomLeft]/* left */, [FrustumCorner.nearBottomRight, FrustumCorner.FarBottomRight]/* right */, [FrustumCorner.unknown, FrustumCorner.unknown]/* bottom */, [FrustumCorner.unknown, FrustumCorner.unknown]/* top */],// bottom\r\n        [[FrustumCorner.nearTopRight, FrustumCorner.nearTopLeft]/* near */, [FrustumCorner.FarTopLeft, FrustumCorner.FarTopRight]/* far */, [FrustumCorner.nearTopLeft, FrustumCorner.FarTopLeft]/* left */, [FrustumCorner.FarTopRight, FrustumCorner.nearTopRight], [FrustumCorner.unknown/* right */, FrustumCorner.unknown]/* bottom */, [FrustumCorner.unknown, FrustumCorner.unknown]/* top */]// top\r\n    ];\r\n\r\n    /** @internal */\r\n    static readonly atlasBorderSize: number = 4.0;//now max shadow sample tent is 5x5,atlas borderSize at leate 3=ceil(2.5),and +1 pixle is for global border for no cascade mode.\r\n\r\n    static init() {\r\n        ShadowUtils._adjustNearPlane = new Plane(new Vector3(), 0);\r\n        ShadowUtils._adjustFarPlane = new Plane(new Vector3(), 0);\r\n    }\r\n\r\n    /**\r\n    * @internal\r\n    */\r\n    static supportShadow(): boolean {\r\n        return LayaGL.renderEngine.getCapable(RenderCapable.RenderTextureFormat_Depth);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static getTemporaryShadowTexture(witdh: number, height: number, shadowFormat: ShadowMapFormat): RenderTexture {\r\n        let depthFormat = RenderTargetFormat.DEPTH_16;\r\n        switch (shadowFormat) {\r\n            case ShadowMapFormat.bit16:\r\n                depthFormat = RenderTargetFormat.DEPTH_16;\r\n                break;\r\n            case ShadowMapFormat.bit24_8:\r\n                depthFormat = RenderTargetFormat.DEPTHSTENCIL_24_8;\r\n                break;\r\n            case ShadowMapFormat.bit32:\r\n                depthFormat = RenderTargetFormat.DEPTH_32;\r\n                break;\r\n        }\r\n\r\n        var shadowMap: RenderTexture = RenderTexture.createFromPool(witdh, height, depthFormat, RenderTargetFormat.None, false, 1);\r\n        shadowMap.compareMode = TextureCompareMode.LESS;\r\n        shadowMap.filterMode = FilterMode.Bilinear;\r\n        shadowMap.wrapModeU = WrapMode.Clamp;\r\n        shadowMap.wrapModeV = WrapMode.Clamp;\r\n        return shadowMap;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static getShadowBias(light: Light, shadowProjectionMatrix: Matrix4x4, shadowResolution: number, out: Vector4): void {\r\n        var frustumSize: number;\r\n        if (light._lightType == LightType.Directional) {\r\n            // Frustum size is guaranteed to be a cube as we wrap shadow frustum around a sphere\r\n            // elements[0] = 2.0 / (right - left)\r\n            frustumSize = 2.0 / shadowProjectionMatrix.elements[0];\r\n        }\r\n        else if (light._lightType == LightType.Spot) {\r\n            // For perspective projections, shadow texel size varies with depth\r\n            // It will only work well if done in receiver side in the pixel shader. Currently We\r\n            // do bias on caster side in vertex shader. When we add shader quality tiers we can properly\r\n            // handle this. For now, as a poor approximation we do a constant bias and compute the size of\r\n            // the frustum as if it was orthogonal considering the size at mid point between near and far planes.\r\n            // Depending on how big the light range is, it will be good enough with some tweaks in bias\r\n            frustumSize = Math.tan((<SpotLightCom>light).spotAngle * 0.5 * MathUtils3D.Deg2Rad) * (<SpotLightCom>light).range;\r\n        }\r\n        else {\r\n            console.warn(\"ShadowUtils:Only spot and directional shadow casters are supported now.\");\r\n            frustumSize = 0.0;\r\n        }\r\n\r\n        // depth and normal bias scale is in shadowmap texel size in world space\r\n        var texelSize: number = frustumSize / shadowResolution;\r\n        var depthBias: number = -light._shadowDepthBias * texelSize;\r\n        var normalBias: number = -light._shadowNormalBias * texelSize;\r\n\r\n        if (light.shadowMode == ShadowMode.SoftHigh) {\r\n            // TODO: depth and normal bias assume sample is no more than 1 texel away from shadowmap\r\n            // This is not true with PCF. Ideally we need to do either\r\n            // cone base bias (based on distance to center sample)\r\n            // or receiver place bias based on derivatives.\r\n            // For now we scale it by the PCF kernel size (5x5)\r\n            const kernelRadius: number = 2.5;\r\n            depthBias *= kernelRadius;\r\n            normalBias *= kernelRadius;\r\n        }\r\n        out.setValue(depthBias, normalBias, 0.0, 0.0);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static getCameraFrustumPlanes(cameraViewProjectMatrix: Matrix4x4, frustumPlanes: Plane[]): void {\r\n        BoundFrustum.getPlanesFromMatrix(cameraViewProjectMatrix, frustumPlanes[FrustumFace.Near], frustumPlanes[FrustumFace.Far], frustumPlanes[FrustumFace.Left], frustumPlanes[FrustumFace.Right], frustumPlanes[FrustumFace.Top], frustumPlanes[FrustumFace.Bottom]);\r\n    }\r\n\r\n    /**\r\n    * @internal\r\n    */\r\n    static getFarWithRadius(radius: number, denominator: number): number {\r\n        // use the frustum side as the radius and get the far distance form camera.\r\n        // var tFov: number = Math.tan(fov * 0.5);// get this the equation using Pythagorean\r\n        // return Math.sqrt(radius * radius / (1.0 + tFov * tFov * (aspectRatio * aspectRatio + 1.0)));\r\n        return Math.sqrt(radius * radius / denominator);\r\n    }\r\n\r\n    /**\r\n    * @internal\r\n    */\r\n    static getCascadesSplitDistance(twoSplitRatio: number, fourSplitRatio: Vector3, cameraNear: number, shadowFar: number, fov: number, aspectRatio: number, cascadesMode: ShadowCascadesMode, out: number[]): void {\r\n        out[0] = cameraNear;\r\n        var range: number = shadowFar - cameraNear;\r\n        var tFov: number = Math.tan(fov * 0.5);\r\n        var denominator: number = 1.0 + tFov * tFov * (aspectRatio * aspectRatio + 1.0);\r\n        switch (cascadesMode) {\r\n            case ShadowCascadesMode.NoCascades:\r\n                out[1] = ShadowUtils.getFarWithRadius(shadowFar, denominator);\r\n                break;\r\n            case ShadowCascadesMode.TwoCascades:\r\n                out[1] = ShadowUtils.getFarWithRadius(cameraNear + range * twoSplitRatio, denominator);\r\n                out[2] = ShadowUtils.getFarWithRadius(shadowFar, denominator);\r\n                break;\r\n            case ShadowCascadesMode.FourCascades:\r\n                out[1] = ShadowUtils.getFarWithRadius(cameraNear + range * fourSplitRatio.x, denominator);\r\n                out[2] = ShadowUtils.getFarWithRadius(cameraNear + range * fourSplitRatio.y, denominator);\r\n                out[3] = ShadowUtils.getFarWithRadius(cameraNear + range * fourSplitRatio.z, denominator);\r\n                out[4] = ShadowUtils.getFarWithRadius(shadowFar, denominator);\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static applySliceTransform(shadowSliceData: ShadowSliceData, atlasWidth: number, atlasHeight: number, cascadeIndex: number, outShadowMatrices: Float32Array): void {\r\n        // Apply shadow slice scale and offset\r\n        var sliceE: Float32Array = ShadowUtils._tempMatrix0.elements;\r\n        var oneOverAtlasWidth: number = 1.0 / atlasWidth;\r\n        var oneOverAtlasHeight: number = 1.0 / atlasHeight;\r\n\r\n        sliceE[0] = shadowSliceData.resolution * oneOverAtlasWidth;//scale\r\n        sliceE[5] = shadowSliceData.resolution * oneOverAtlasHeight;\r\n        sliceE[12] = shadowSliceData.offsetX * oneOverAtlasWidth;//offset\r\n        sliceE[13] = shadowSliceData.offsetY * oneOverAtlasHeight;\r\n        sliceE[1] = sliceE[2] = sliceE[2] = sliceE[4] = sliceE[6] = sliceE[7] = sliceE[8] = sliceE[9] = sliceE[11] = sliceE[14] = 0;\r\n        sliceE[10] = sliceE[15] = 1;\r\n\r\n        var offset: number = cascadeIndex * 16;\r\n        Utils3D._mulMatrixArray(sliceE, outShadowMatrices, offset, outShadowMatrices, offset);\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static getDirectionLightShadowCullPlanes(cameraFrustumPlanes: Array<Plane>, cascadeIndex: number, splitDistance: number[], cameraNear: number, direction: Vector3, shadowSliceData: ShadowSliceData): void {\r\n        // http://lspiroengine.com/?p=187\r\n        var frustumCorners: Vector3[] = ShadowUtils._frustumCorners;\r\n        var backPlaneFaces: FrustumFace[] = ShadowUtils._backPlaneFaces;\r\n        var planeNeighbors: FrustumFace[][] = ShadowUtils._frustumPlaneNeighbors;\r\n        var twoPlaneCorners: FrustumCorner[][][] = ShadowUtils._frustumTwoPlaneCorners;\r\n        var edgePlanePoint2: Vector3 = ShadowUtils._edgePlanePoint2;\r\n        var out: Plane[] = shadowSliceData.cullPlanes;\r\n\r\n        // cameraFrustumPlanes is share\r\n        var near: Plane = cameraFrustumPlanes[FrustumFace.Near], far: Plane = cameraFrustumPlanes[FrustumFace.Far];\r\n        var left: Plane = cameraFrustumPlanes[FrustumFace.Left], right: Plane = cameraFrustumPlanes[FrustumFace.Right];\r\n        var bottom: Plane = cameraFrustumPlanes[FrustumFace.Bottom], top: Plane = cameraFrustumPlanes[FrustumFace.Top];\r\n\r\n        // adjustment the near/far plane\r\n        var splitNearDistance: number = splitDistance[cascadeIndex] - cameraNear;\r\n        var splitNear: Plane = ShadowUtils._adjustNearPlane;\r\n        var splitFar: Plane = ShadowUtils._adjustFarPlane;\r\n        splitNear.normal = near.normal;\r\n        splitFar.normal = far.normal;\r\n        splitNear.distance = near.distance - splitNearDistance;\r\n        splitFar.distance = Math.min(-near.distance + shadowSliceData.sphereCenterZ + shadowSliceData.splitBoundSphere.radius, far.distance);//do a clamp is the sphere is out of range the far plane\r\n\r\n        BoundFrustum.get3PlaneInterPoint(splitNear, bottom, right, frustumCorners[FrustumCorner.nearBottomRight]);\r\n        BoundFrustum.get3PlaneInterPoint(splitNear, top, right, frustumCorners[FrustumCorner.nearTopRight]);\r\n        BoundFrustum.get3PlaneInterPoint(splitNear, top, left, frustumCorners[FrustumCorner.nearTopLeft]);\r\n        BoundFrustum.get3PlaneInterPoint(splitNear, bottom, left, frustumCorners[FrustumCorner.nearBottomLeft]);\r\n        BoundFrustum.get3PlaneInterPoint(splitFar, bottom, right, frustumCorners[FrustumCorner.FarBottomRight]);\r\n        BoundFrustum.get3PlaneInterPoint(splitFar, top, right, frustumCorners[FrustumCorner.FarTopRight]);\r\n        BoundFrustum.get3PlaneInterPoint(splitFar, top, left, frustumCorners[FrustumCorner.FarTopLeft]);\r\n        BoundFrustum.get3PlaneInterPoint(splitFar, bottom, left, frustumCorners[FrustumCorner.FarBottomLeft]);\r\n\r\n        var backIndex: number = 0;\r\n        for (var i: FrustumFace = 0; i < 6; i++) {// meybe 345(light eye is at far, forward is near, or orth camera is any axis)\r\n            var plane: Plane;\r\n            switch (i) {\r\n                case FrustumFace.Near:\r\n                    plane = splitNear;\r\n                    break;\r\n                case FrustumFace.Far:\r\n                    plane = splitFar;\r\n                    break;\r\n                default:\r\n                    plane = cameraFrustumPlanes[i];\r\n                    break;\r\n            }\r\n            if (Vector3.dot(plane.normal, direction) < 0.0) {\r\n                plane.cloneTo(out[backIndex]);\r\n                backPlaneFaces[backIndex] = i;\r\n                backIndex++;\r\n            }\r\n        }\r\n\r\n        var edgeIndex: number = backIndex;\r\n        for (var i: FrustumFace = 0; i < backIndex; i++) {\r\n            var backFace: FrustumFace = backPlaneFaces[i];\r\n            var neighborFaces: Array<FrustumFace> = planeNeighbors[backFace];\r\n            for (var j: number = 0; j < 4; j++) {\r\n                var neighborFace: FrustumFace = neighborFaces[j];\r\n                var notBackFace: boolean = true;\r\n                for (var k: number = 0; k < backIndex; k++)\r\n                    if (neighborFace == backPlaneFaces[k]) {\r\n                        notBackFace = false;\r\n                        break;\r\n                    }\r\n                if (notBackFace) {\r\n                    var corners: Array<FrustumCorner> = twoPlaneCorners[backFace][neighborFace];\r\n                    var point0: Vector3 = frustumCorners[corners[0]];\r\n                    var point1: Vector3 = frustumCorners[corners[1]];\r\n                    Vector3.add(point0, direction, edgePlanePoint2);\r\n                    Plane.createPlaneBy3P(point0, point1, edgePlanePoint2, out[edgeIndex++]);\r\n                }\r\n            }\r\n        }\r\n        shadowSliceData.cullPlaneCount = edgeIndex;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static getBoundSphereByFrustum(near: number, far: number, fov: number, aspectRatio: number, cameraPos: Vector3, forward: Vector3, outBoundSphere: BoundSphere): number {\r\n        // https://lxjk.github.io/2017/04/15/Calculate-Minimal-Bounding-Sphere-of-Frustum.html\r\n        var centerZ: number;\r\n        var radius: number;\r\n        var k: number = Math.sqrt(1.0 + aspectRatio * aspectRatio) * Math.tan(fov / 2.0);\r\n        var k2: number = k * k;\r\n        var farSNear: number = far - near;\r\n        var farANear: number = far + near;\r\n        if (k2 > farSNear / farANear) {\r\n            centerZ = far;\r\n            radius = far * k;\r\n        }\r\n        else {\r\n            centerZ = 0.5 * farANear * (1 + k2);\r\n            radius = 0.5 * Math.sqrt(farSNear * farSNear + 2.0 * (far * far + near * near) * k2 + farANear * farANear * k2 * k2);\r\n        }\r\n\r\n        var center: Vector3 = outBoundSphere.center;\r\n        outBoundSphere.radius = radius;\r\n        Vector3.scale(forward, centerZ, center);\r\n        Vector3.add(cameraPos, center, center);\r\n        outBoundSphere.center = center;\r\n        return centerZ;\r\n    }\r\n\r\n    /**\r\n     * @inernal\r\n     */\r\n    static getMaxTileResolutionInAtlas(atlasWidth: number, atlasHeight: number, tileCount: number): number {\r\n        var resolution: number = Math.min(atlasWidth, atlasHeight);\r\n        var currentTileCount: number = Math.floor(atlasWidth / resolution) * Math.floor(atlasHeight / resolution);\r\n        while (currentTileCount < tileCount) {\r\n            resolution = Math.floor(resolution >> 1);\r\n            currentTileCount = Math.floor(atlasWidth / resolution) * Math.floor(atlasHeight / resolution);\r\n        }\r\n        return resolution;\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static getDirectionalLightMatrices(lightUp: Vector3, lightSide: Vector3, lightForward: Vector3, cascadeIndex: number, nearPlane: number, shadowResolution: number, shadowSliceData: ShadowSliceData, shadowMatrices: Float32Array): void {\r\n        var boundSphere: BoundSphere = shadowSliceData.splitBoundSphere;\r\n\r\n        // To solve shdow swimming problem.\r\n        var center: Vector3 = boundSphere.center;\r\n        var radius: number = boundSphere.radius;\r\n        var halfShadowResolution: number = shadowResolution / 2;\r\n        // Add border to prject edge pixel PCF.\r\n        // Improve:the clip planes not conside the border,but I think is OK,because the object can clip is not continuous.\r\n        var borderRadius: number = radius * halfShadowResolution / (halfShadowResolution - ShadowUtils.atlasBorderSize);\r\n        var borderDiam: number = borderRadius * 2.0;\r\n        var sizeUnit: number = shadowResolution / borderDiam;\r\n        var radiusUnit: number = borderDiam / shadowResolution;\r\n        var upLen: number = Math.ceil(Vector3.dot(center, lightUp) * sizeUnit) * radiusUnit;\r\n        var sideLen: number = Math.ceil(Vector3.dot(center, lightSide) * sizeUnit) * radiusUnit;\r\n        var forwardLen: number = Vector3.dot(center, lightForward);\r\n        center.x = lightUp.x * upLen + lightSide.x * sideLen + lightForward.x * forwardLen;\r\n        center.y = lightUp.y * upLen + lightSide.y * sideLen + lightForward.y * forwardLen;\r\n        center.z = lightUp.z * upLen + lightSide.z * sideLen + lightForward.z * forwardLen;\r\n        boundSphere.center = center;\r\n\r\n        // Direction light use shadow pancaking tech,do special dispose with nearPlane.\r\n        var origin: Vector3 = shadowSliceData.position;\r\n        var viewMatrix: Matrix4x4 = shadowSliceData.viewMatrix;\r\n        var projectMatrix: Matrix4x4 = shadowSliceData.projectionMatrix;\r\n        var viewProjectMatrix: Matrix4x4 = shadowSliceData.viewProjectMatrix;\r\n\r\n        shadowSliceData.resolution = shadowResolution;\r\n        shadowSliceData.offsetX = (cascadeIndex % 2) * shadowResolution;\r\n        shadowSliceData.offsetY = Math.floor(cascadeIndex / 2) * shadowResolution;\r\n\r\n        Vector3.scale(lightForward, radius + nearPlane, origin);\r\n        Vector3.subtract(center, origin, origin);\r\n        Matrix4x4.createLookAt(origin, center, lightUp, viewMatrix);\r\n        Matrix4x4.createOrthoOffCenter(- borderRadius, borderRadius, - borderRadius, borderRadius, 0.0, radius * 2.0 + nearPlane, projectMatrix);\r\n        Matrix4x4.multiply(projectMatrix, viewMatrix, viewProjectMatrix);\r\n        Utils3D._mulMatrixArray(ShadowUtils._shadowMapScaleOffsetMatrix.elements, viewProjectMatrix.elements, 0, shadowMatrices, cascadeIndex * 16);\r\n    }\r\n\r\n    /** \r\n    * @internal\r\n    */\r\n    static getSpotLightShadowData(shadowSpotData: ShadowSpotData, spotLight: SpotLightCom, resolution: number, shadowParams: Vector4, shadowSpotMatrices: Matrix4x4, shadowMapSize: Vector4) {\r\n        var out: Vector3 = shadowSpotData.position = (spotLight.owner as Sprite3D).transform.position;\r\n        shadowSpotData.resolution = resolution;\r\n        shadowMapSize.setValue(1.0 / resolution, 1.0 / resolution, resolution, resolution);\r\n        shadowSpotData.offsetX = 0;\r\n        shadowSpotData.offsetY = 0;\r\n\r\n        var spotWorldMatrix: Matrix4x4 = spotLight.lightWorldMatrix;\r\n        var viewMatrix: Matrix4x4 = shadowSpotData.viewMatrix;\r\n        var projectMatrix: Matrix4x4 = shadowSpotData.projectionMatrix;\r\n        var viewProjectMatrix: Matrix4x4 = shadowSpotData.viewProjectMatrix;\r\n        var BoundFrustum: BoundFrustum = shadowSpotData.cameraCullInfo.boundFrustum;\r\n        spotWorldMatrix.invert(viewMatrix);\r\n        Matrix4x4.createPerspective(3.1416 * spotLight.spotAngle / 180.0, 1, 0.1, spotLight.range, projectMatrix);\r\n        shadowParams.y = spotLight.shadowStrength;\r\n        Matrix4x4.multiply(projectMatrix, viewMatrix, viewProjectMatrix);\r\n        BoundFrustum.matrix = viewProjectMatrix;\r\n        viewProjectMatrix.cloneTo(shadowSpotMatrices);\r\n        shadowSpotData.cameraCullInfo.position = out;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static prepareShadowReceiverShaderValues(light: DirectionLightCom, shadowMapWidth: number, shadowMapHeight: number, shadowSliceDatas: ShadowSliceData[], cascadeCount: number, shadowMapSize: Vector4, shadowParams: Vector4, shadowMatrices: Float32Array, splitBoundSpheres: Float32Array): void {\r\n        shadowMapSize.setValue(1.0 / shadowMapWidth, 1.0 / shadowMapHeight, shadowMapWidth, shadowMapHeight);\r\n        shadowParams.setValue(light._shadowStrength, 0.0, 0.0, 0.0);\r\n        if (cascadeCount > 1) {\r\n            const matrixFloatCount: number = 16;\r\n            for (var i: number = cascadeCount * matrixFloatCount, n: number = 4 * matrixFloatCount; i < n; i++)//the last matrix is always ZERO\r\n                shadowMatrices[i] = 0.0;//set Matrix4x4.ZERO to project the cascade index is 4\r\n\r\n            for (var i: number = 0; i < cascadeCount; i++) {\r\n                var boundSphere: BoundSphere = shadowSliceDatas[i].splitBoundSphere;\r\n                var center: Vector3 = boundSphere.center;\r\n                var radius: number = boundSphere.radius;\r\n                var offset: number = i * 4;\r\n                splitBoundSpheres[offset] = center.x;\r\n                splitBoundSpheres[offset + 1] = center.y;\r\n                splitBoundSpheres[offset + 2] = center.z;\r\n                splitBoundSpheres[offset + 3] = radius * radius;\r\n            }\r\n            const sphereFloatCount: number = 4;\r\n            for (var i: number = cascadeCount * sphereFloatCount, n: number = 4 * sphereFloatCount; i < n; i++)\r\n                splitBoundSpheres[i] = 0.0;//set Matrix4x4.ZERO to project the cascade index is 4\r\n        }\r\n    }\r\n}","/**\r\n * Shadow Light enum\r\n */\r\n export enum ShadowLightType {\r\n    /** */\r\n    DirectionLight,\r\n    /** */\r\n    SpotLight,\r\n    /** */\r\n    PointLight\r\n}","import { Scene3D } from \"./laya/d3/core/scene/Scene3D\";\r\nimport { Laya3D } from \"./Laya3D\";\r\n\r\n/**\r\n * @internal\r\n * \r\n */\r\nexport class ILaya3D {\r\n    static Scene3D: typeof Scene3D = null;\r\n    static Laya3D: typeof Laya3D = null;\r\n}\r\n","import { Config3D } from \"../../../../Config3D\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Texture2D } from \"../../../resource/Texture2D\";\r\nimport { Camera } from \"../../core/Camera\";\r\nimport { LightQueue } from \"../../core/light/LightQueue\";\r\nimport { PointLightCom } from \"../../core/light/PointLightCom\";\r\nimport { SpotLightCom } from \"../../core/light/SpotLightCom\";\r\nimport { Scene3D } from \"../../core/scene/Scene3D\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\n\r\nimport { Utils3D } from \"../../utils/Utils3D\";\r\n\r\n/**\r\n * @internal\r\n */\r\nclass LightBound {\r\n    xMin: number;\r\n    xMax: number;\r\n    yMin: number;\r\n    yMax: number;\r\n    zMin: number;\r\n    zMax: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nclass ClusterData {\r\n    updateMark: number = -1;\r\n    pointLightCount: number = 0;\r\n    spotLightCount: number = 0;\r\n    indices: number[] = [];\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class Cluster {\r\n    private static _tempVector30: Vector3 = new Vector3();\r\n    private static _tempVector31: Vector3 = new Vector3();\r\n    private static _tempVector32: Vector3 = new Vector3();\r\n    private static _tempVector33: Vector3 = new Vector3();\r\n    private static _tempVector34: Vector3 = new Vector3();\r\n    private static _tempVector35: Vector3 = new Vector3();\r\n    private static _tempVector36: Vector3 = new Vector3();\r\n    private static _tempVector37: Vector3 = new Vector3();\r\n    private static _tempLightBound: LightBound = new LightBound();\r\n\r\n    static instance: Cluster;\r\n\r\n    private _xSlices: number;\r\n    private _ySlices: number;\r\n    private _zSlices: number;\r\n    private _clusterDatas: ClusterData[][][];\r\n    private _clusterPixels: Float32Array;\r\n    private _updateMark: number = 0;\r\n    private _depthSliceParam: Vector2 = new Vector2();\r\n\r\n    public _clusterTexture: Texture2D;\r\n\r\n    constructor(xSlices: number, ySlices: number, zSlices: number, maxLightsPerClusterAverage: number) {\r\n        this._xSlices = xSlices;\r\n        this._ySlices = ySlices;\r\n        this._zSlices = zSlices;\r\n        var clusterTexWidth: number = xSlices * ySlices;\r\n        var clisterTexHeight: number = zSlices * (1 + Math.ceil(maxLightsPerClusterAverage / 4));\r\n        this._clusterTexture = Utils3D._createFloatTextureBuffer(clusterTexWidth, clisterTexHeight);\r\n        this._clusterTexture.lock = true;\r\n        this._clusterPixels = new Float32Array(clusterTexWidth * clisterTexHeight * 4);\r\n\r\n        //Init for every cluster\r\n        var clusterDatas: ClusterData[][][] = new Array<Array<Array<ClusterData>>>(this._zSlices);\r\n        for (var z = 0; z < this._zSlices; z++) {\r\n            clusterDatas[z] = new Array<Array<ClusterData>>(this._ySlices);\r\n            for (var y = 0; y < this._ySlices; y++) {\r\n                clusterDatas[z][y] = new Array<ClusterData>(this._xSlices);\r\n                for (var x = 0; x < this._xSlices; x++)\r\n                    clusterDatas[z][y][x] = new ClusterData();\r\n            }\r\n        }\r\n        this._clusterDatas = clusterDatas;\r\n\r\n        /*\r\n        Layout of clusterTexture\r\n        |------------------------------------------------------U(XY)\r\n        |               cluster0               cluster1       \r\n        |        (PCou|SCou|Off0|Off1) | (PCou|SCou|Off0|Off1) \r\n        |               cluster2               cluster3      \r\n        |        (PCou|SCou|Off0|Off1) | (PCou|SCou|Off0|Off1) \r\n        |-----------------------------------------------------------\r\n        |                                    _                              \r\n        |        (poi0|poi1|spo0|spo1) |(spo2|poi0|poi1|poi2)\r\n        |             _\r\n        |        (poi3|spo0|....|....) |(....|....|....|....) \r\n        |\r\n        V(Z)\r\n        */\r\n    }\r\n\r\n    // private _insertSpotLightSphere(origin: Vector3, forward: Vector3, size: number, angle: number, testSphere: Vector4): boolean {\r\n    //     //combine cone cull and sphere range cull\r\n    //     var V: Vector3 = Cluster._tempVector35;\r\n    //     V.x = testSphere.x - origin.x;\r\n    //     V.y = testSphere.y - origin.y;\r\n    //     V.z = testSphere.z - origin.z;\r\n\r\n    //     var VlenSq = Vector3.dot(V, V);\r\n    //     var sphereRadius: number = testSphere.w;\r\n\r\n    //     var rangeCull: boolean = VlenSq > sphereRadius * sphereRadius;\r\n    //     if (!rangeCull)\r\n    //         return false;\r\n\r\n    //     var V1len: number = Vector3.dot(V, forward);\r\n    //     var distanceClosestPoint: number = Math.cos(angle) * Math.sqrt(VlenSq - V1len * V1len) - V1len * Math.sin(angle);\r\n\r\n    //     var angleCull: boolean = distanceClosestPoint > sphereRadius;\r\n    //     var frontCull: boolean = V1len > sphereRadius + size;\r\n    //     var backCull: boolean = V1len < -sphereRadius;\r\n    //     return !(angleCull || frontCull || backCull);\r\n    // }\r\n\r\n    private _placePointLightToClusters(lightIndex: number, lightBound: LightBound): void {\r\n        var clusterDatas: ClusterData[][][] = this._clusterDatas;\r\n        var updateMark: number = this._updateMark;\r\n        for (var z: number = lightBound.zMin, zEnd: number = lightBound.zMax; z < zEnd; z++) {\r\n            for (var y: number = lightBound.yMin, yEnd: number = lightBound.yMax; y < yEnd; y++) {\r\n                for (var x: number = lightBound.xMin, xEnd: number = lightBound.xMax; x < xEnd; x++) {\r\n                    var data: ClusterData = clusterDatas[z][y][x];\r\n                    if (data.updateMark != updateMark) {\r\n                        data.pointLightCount = 0;\r\n                        data.spotLightCount = 0;\r\n                        data.updateMark = updateMark;\r\n                    }\r\n                    var indices: number[] = data.indices;\r\n                    var lightCount: number = data.pointLightCount++;\r\n                    if (lightCount < indices.length)\r\n                        indices[lightCount] = lightIndex;\r\n                    else\r\n                        indices.push(lightIndex);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private _placeSpotLightToClusters(lightIndex: number, lightBound: LightBound): void {\r\n        var clusterDatas: ClusterData[][][] = this._clusterDatas;\r\n        var updateMark: number = this._updateMark;\r\n        for (var z: number = lightBound.zMin, zEnd: number = lightBound.zMax; z < zEnd; z++) {\r\n            for (var y: number = lightBound.yMin, yEnd: number = lightBound.yMax; y < yEnd; y++) {\r\n                for (var x: number = lightBound.xMin, xEnd: number = lightBound.xMax; x < xEnd; x++) {\r\n                    var data: ClusterData = clusterDatas[z][y][x];\r\n                    if (data.updateMark != updateMark) {\r\n                        data.pointLightCount = 0;\r\n                        data.spotLightCount = 0;\r\n                        data.updateMark = updateMark;\r\n                    }\r\n                    var indices: number[] = data.indices;\r\n                    var lightCount: number = data.pointLightCount + data.spotLightCount++;\r\n                    if (lightCount < indices.length)\r\n                        indices[lightCount] = lightIndex;\r\n                    else\r\n                        indices.push(lightIndex);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    private _insertConePlane(origin: Vector3, forward: Vector3, radius: number, halfAngle: number, pNor: Vector3): boolean {\r\n        //https://bartwronski.com/2017/04/13/cull-that-cone/\r\n        //because distance is always zero so we ease this method\r\n        var V1: Vector3 = Cluster._tempVector36;\r\n        var V2: Vector3 = Cluster._tempVector37;\r\n        Vector3.cross(pNor, forward, V1);\r\n        Vector3.cross(V1, forward, V2);\r\n        Vector3.normalize(V2, V2);\r\n        var tanR: number = radius * Math.tan(halfAngle);\r\n        var capRimX: number = origin.x + radius * forward.x + tanR * V2.x;\r\n        var capRimY: number = origin.y + radius * forward.y + tanR * V2.y;\r\n        var capRimZ: number = origin.z + radius * forward.z + tanR * V2.z;\r\n\r\n        return capRimX * pNor.x + capRimY * pNor.y + capRimZ * pNor.z <= 0 || origin.x * pNor.x + origin.y * pNor.y + origin.z * pNor.z <= 0;\r\n    }\r\n\r\n\r\n    private _shrinkSphereLightZPerspective(near: number, far: number, lightviewPos: Vector3, radius: number, lightBound: LightBound): boolean {\r\n        var lvZ: number = lightviewPos.z;\r\n        var minZ: number = lvZ - radius;\r\n        var maxZ: number = lvZ + radius;\r\n\r\n        if ((minZ > far) || (maxZ <= near))\r\n            return false;\r\n        // slice = Math.log2(z) * (numSlices / Math.log2(far / near)) - Math.log2(near) * numSlices / Math.log2(far / near)\r\n        // slice start from near plane,near is index:0,z must large than near,or the result will NaN\r\n        var depthSliceParam: Vector2 = this._depthSliceParam;\r\n        lightBound.zMin = Math.floor(Math.log2(Math.max(minZ, near)) * depthSliceParam.x - depthSliceParam.y);\r\n        lightBound.zMax = Math.min(Math.ceil(Math.log2(maxZ) * depthSliceParam.x - depthSliceParam.y), this._zSlices);\r\n        return true;\r\n    }\r\n\r\n    private _shrinkSpotLightZPerspective(near: number, far: number, viewLightPos: Vector3, viewConeCap: Vector3, radius: number, halfAngle: number, lightBound: LightBound): boolean {\r\n        //https://bartwronski.com/2017/04/13/cull-that-cone/\r\n        //http://www.iquilezles.org/www/articles/diskbbox/diskbbox.htm\r\n\r\n        var pbX: number = viewConeCap.x, pbY: number = viewConeCap.y, pbZ: number = viewConeCap.z;\r\n        var rb: number = Math.tan(halfAngle) * radius;\r\n        var paX: number = viewLightPos.x, paY: number = viewLightPos.y, paZ: number = viewLightPos.z;\r\n        var aX: number = pbX - paX, aY: number = pbY - paY, aZ: number = pbZ - paZ;\r\n        var dotA: number = aX * aX + aY * aY + aZ * aZ;\r\n        var eZ: number = Math.sqrt(1.0 - aZ * aZ / dotA);\r\n\r\n        //flat-capped cone is not spotLight shape,spoltlight is sphere-capped.so we get the common boundBox of flat-capped cone bounds and sphere bounds.\r\n        var minZ: number = Math.max(Math.min(paZ, pbZ - eZ * rb), viewLightPos.z - radius);\r\n        var maxZ: number = Math.min(Math.max(paZ, pbZ + eZ * rb), viewLightPos.z + radius);\r\n\r\n        if ((minZ > far) || (maxZ <= near))\r\n            return false;\r\n        // slice = Math.log2(z) * (numSlices / Math.log2(far / near)) - Math.log2(near) * numSlices / Math.log2(far / near)\r\n        // slice start from near plane,near is index:0,z must large than near,or the result will NaN\r\n        var depthSliceParam: Vector2 = this._depthSliceParam;\r\n        lightBound.zMin = Math.floor(Math.log2(Math.max(minZ, near)) * depthSliceParam.x - depthSliceParam.y);\r\n        lightBound.zMax = Math.min(Math.ceil(Math.log2(maxZ) * depthSliceParam.x - depthSliceParam.y), this._zSlices);\r\n        return true;\r\n    }\r\n\r\n    private _shrinkSphereLightByBoundOrth(halfX: number, halfY: number, near: number, far: number, lightviewPos: Vector3, radius: number, lightBound: LightBound): boolean {\r\n        var lvZ: number = lightviewPos.z;\r\n        var minZ: number = lvZ - radius, maxZ: number = lvZ + radius;\r\n        if ((minZ > far) || (maxZ <= near))\r\n            return false;\r\n        var lvX: number = lightviewPos.x;\r\n        var minX: number = lvX - radius, maxX: number = lvX + radius;\r\n        if ((minX > halfX) || (maxX <= -halfX))\r\n            return false;\r\n        var lvY: number = lightviewPos.y;\r\n        var minY: number = lvY - radius, maxY: number = lvY + radius;\r\n        if ((minY > halfY) || (maxY <= -halfY))\r\n            return false;\r\n\r\n        // slice = Math.log2(z) * (numSlices / Math.log2(far / near)) - Math.log2(near) * numSlices / Math.log2(far / near)\r\n        // slice start from near plane,near is index:0,z must large than near,or the result will NaN\r\n        var xSlices: number = this._xSlices, ySlices: number = this._ySlices;\r\n        var depthSliceParam: Vector2 = this._depthSliceParam;\r\n        var xStride: number = halfX * 2 / xSlices, yStride: number = halfY * 2 / ySlices;\r\n        lightBound.xMin = Math.max(Math.floor((minX + halfX) / xStride), 0);\r\n        lightBound.xMax = Math.min(Math.ceil((maxX + halfX) / xStride), xSlices);\r\n        lightBound.yMin = Math.max(Math.floor((halfY - maxY) / yStride), 0);//zero is from top\r\n        lightBound.yMax = Math.min(Math.ceil((halfY - minY) / yStride), ySlices);\r\n        lightBound.zMin = Math.floor(Math.log2(Math.max(minZ, near)) * depthSliceParam.x - depthSliceParam.y);\r\n        lightBound.zMax = Math.min(Math.ceil(Math.log2(maxZ) * depthSliceParam.x - depthSliceParam.y), this._zSlices);\r\n        return true;\r\n    }\r\n\r\n    private _shrinkSpotLightByBoundOrth(halfX: number, halfY: number, near: number, far: number, viewLightPos: Vector3, viewConeCap: Vector3, radius: number, halfAngle: number, lightBound: LightBound): boolean {\r\n        //https://bartwronski.com/2017/04/13/cull-that-cone/\r\n        //http://www.iquilezles.org/www/articles/diskbbox/diskbbox.htm\r\n        var pbX: number = viewConeCap.x, pbY: number = viewConeCap.y, pbZ: number = viewConeCap.z;\r\n        var rb: number = Math.tan(halfAngle) * radius;\r\n        var paX: number = viewLightPos.x, paY: number = viewLightPos.y, paZ: number = viewLightPos.z;\r\n        var aX: number = pbX - paX, aY: number = pbY - paY, aZ: number = pbZ - paZ;\r\n        var dotA: number = aX * aX + aY * aY + aZ * aZ;\r\n\r\n        //flat-capped cone is not spotLight shape,spoltlight is sphere-capped.so we get the common boundBox of flat-capped cone bounds and sphere bounds.\r\n        var eZ: number = Math.sqrt(1.0 - aZ * aZ / dotA);\r\n        var minZ: number = Math.max(Math.min(paZ, pbZ - eZ * rb), viewLightPos.z - radius);\r\n        var maxZ: number = Math.min(Math.max(paZ, pbZ + eZ * rb), viewLightPos.z + radius);\r\n        if ((minZ > far) || (maxZ <= near))\r\n            return false;\r\n        var eX: number = Math.sqrt(1.0 - aX * aX / dotA);\r\n        var minX: number = Math.max(Math.min(paX, pbX - eX * rb), viewLightPos.x - radius);\r\n        var maxX: number = Math.min(Math.max(paX, pbX + eX * rb), viewLightPos.x + radius);\r\n        if ((minX > halfX) || (maxX <= -halfX))\r\n            return false;\r\n        var eY: number = Math.sqrt(1.0 - aY * aY / dotA);\r\n        var minY: number = Math.max(Math.min(paY, pbY - eY * rb), viewLightPos.y - radius);\r\n        var maxY: number = Math.min(Math.max(paY, pbY + eY * rb), viewLightPos.y + radius);\r\n        if ((minY > halfY) || (maxY <= -halfY))\r\n            return false;\r\n\r\n        // slice = Math.log2(z) * (numSlices / Math.log2(far / near)) - Math.log2(near) * numSlices / Math.log2(far / near)\r\n        // slice start from near plane,near is index:0,z must large than near,or the result will NaN\r\n        var xSlices: number = this._xSlices, ySlices: number = this._ySlices;\r\n        var depthSliceParam: Vector2 = this._depthSliceParam;\r\n        var xStride: number = halfX * 2 / xSlices, yStride: number = halfY * 2 / ySlices;\r\n        lightBound.xMin = Math.max(Math.floor((minX + halfX) / xStride), 0);\r\n        lightBound.xMax = Math.min(Math.ceil((maxX + halfX) / xStride), xSlices);\r\n        lightBound.yMin = Math.max(Math.floor((halfY - maxY) / yStride), 0);//zero is from top\r\n        lightBound.yMax = Math.min(Math.ceil((halfY - minY) / yStride), ySlices);\r\n        lightBound.zMin = Math.floor(Math.log2(Math.max(minZ, near)) * depthSliceParam.x - depthSliceParam.y);\r\n        lightBound.zMax = Math.min(Math.ceil(Math.log2(maxZ) * depthSliceParam.x - depthSliceParam.y), this._zSlices);\r\n        return true;\r\n    }\r\n\r\n\r\n    private _shrinkXYByRadiusPerspective(lightviewPos: Vector3, radius: number, lightBound: LightBound, xPlanes: Vector3[], yPlanes: Vector3[]): boolean {\r\n        var xMin: number, yMin: number;\r\n        var xMax: number, yMax: number;\r\n        var lvX: number = lightviewPos.x, lvY: number = lightviewPos.y, lvZ: number = lightviewPos.z;\r\n\r\n        var i: number;\r\n        var n: number = this._ySlices + 1;\r\n        for (i = 0; i < n; i++) {\r\n            var plane: Vector3 = yPlanes[i];\r\n            if (lvY * plane.y + lvZ * plane.z < radius) {//Dot\r\n                yMin = Math.max(0, i - 1);\r\n                break;\r\n            }\r\n        }\r\n        if (i == n)//fail scan insert\r\n            return false;\r\n        yMax = this._ySlices;\r\n        for (i = yMin + 1; i < n; i++) {\r\n            var plane: Vector3 = yPlanes[i];\r\n            if (lvY * plane.y + lvZ * plane.z <= -radius) {//Dot\r\n                yMax = Math.max(0, i);\r\n                break;\r\n            }\r\n        }\r\n\r\n        n = this._xSlices + 1;\r\n        for (i = 0; i < n; i++) {\r\n            var plane: Vector3 = xPlanes[i];\r\n            if (lvX * plane.x + lvZ * plane.z < radius) {//Dot\r\n                xMin = Math.max(0, i - 1);\r\n                break;\r\n            }\r\n        }\r\n        xMax = this._xSlices;\r\n        for (i = xMin + 1; i < n; i++) {\r\n            var plane: Vector3 = xPlanes[i];\r\n            if (lvX * plane.x + lvZ * plane.z <= -radius) {//Dot\r\n                xMax = Math.max(0, i);\r\n                break;\r\n            }\r\n        }\r\n\r\n\r\n        lightBound.xMin = xMin\r\n        lightBound.xMax = xMax;\r\n        lightBound.yMin = yMin;\r\n        lightBound.yMax = yMax;\r\n        return true;\r\n    }\r\n\r\n    private _shrinkSpotXYByConePerspective(lightviewPos: Vector3, viewForward: Vector3, radius: number, halfAngle: number, lightBound: LightBound, xPlanes: Vector3[], yPlanes: Vector3[]): void {\r\n        var xMin: number, yMin: number;\r\n        var xMax: number, yMax: number;\r\n\r\n        var normal: Vector3 = Cluster._tempVector32;\r\n        var n: number = lightBound.yMax + 1;\r\n        for (var i: number = lightBound.yMin + 1; i < n; i++) {\r\n            if (this._insertConePlane(lightviewPos, viewForward, radius, halfAngle, yPlanes[i])) {\r\n                yMin = Math.max(0, i - 1);\r\n                break;\r\n            }\r\n        }\r\n\r\n        yMax = lightBound.yMax;\r\n        for (var i: number = yMin + 1; i < n; i++) {\r\n            var plane: Vector3 = yPlanes[i];\r\n            normal.setValue(0, -plane.y, -plane.z);\r\n            if (!this._insertConePlane(lightviewPos, viewForward, radius, halfAngle, normal)) {\r\n                yMax = Math.max(0, i);\r\n                break;\r\n            }\r\n        }\r\n\r\n        n = lightBound.xMax + 1;\r\n        for (var i: number = lightBound.xMin + 1; i < n; i++) {\r\n            if (this._insertConePlane(lightviewPos, viewForward, radius, halfAngle, xPlanes[i])) {\r\n                xMin = Math.max(0, i - 1);\r\n                break;\r\n            }\r\n        }\r\n        xMax = lightBound.xMax;\r\n        for (var i: number = xMin + 1; i < n; i++) {\r\n            var plane: Vector3 = xPlanes[i];\r\n            normal.setValue(-plane.x, 0, -plane.z);\r\n            if (!this._insertConePlane(lightviewPos, viewForward, radius, halfAngle, normal)) {\r\n                xMax = Math.max(0, i);\r\n                break;\r\n            }\r\n        }\r\n\r\n        lightBound.xMin = xMin;\r\n        lightBound.xMax = xMax;\r\n        lightBound.yMin = yMin;\r\n        lightBound.yMax = yMax;\r\n    }\r\n\r\n\r\n\r\n    private _updatePointLightPerspective(near: number, far: number, viewMat: Matrix4x4, pointLight: PointLightCom, lightIndex: number, xPlanes: Vector3[], yPlanes: Vector3[]): void {\r\n        var lightBound: LightBound = Cluster._tempLightBound;\r\n        var lightviewPos: Vector3 = Cluster._tempVector30;\r\n        Vector3.transformV3ToV3((pointLight.owner as Sprite3D)._transform.position, viewMat, lightviewPos);//World to View\r\n        lightviewPos.z *= -1;\r\n        if (!this._shrinkSphereLightZPerspective(near, far, lightviewPos, pointLight.range, lightBound))\r\n            return;\r\n        if (!this._shrinkXYByRadiusPerspective(lightviewPos, pointLight.range, lightBound, xPlanes, yPlanes))\r\n            return;\r\n\r\n        this._placePointLightToClusters(lightIndex, lightBound);\r\n    }\r\n\r\n    private _updateSpotLightPerspective(near: number, far: number, viewMat: Matrix4x4, spotLight: SpotLightCom, lightIndex: number, xPlanes: Vector3[], yPlanes: Vector3[]): void {\r\n        // technically could fall outside the bounds we make because the planes themeselves are tilted by some angle\r\n        // the effect is exaggerated the steeper the angle the plane makes is\r\n        var lightBound: LightBound = Cluster._tempLightBound;\r\n        var viewPos: Vector3 = Cluster._tempVector30;\r\n        var forward: Vector3 = Cluster._tempVector31;\r\n        var viewConeCap: Vector3 = Cluster._tempVector34;\r\n        var position: Vector3 = (spotLight.owner as Sprite3D)._transform.position;\r\n        var range: number = spotLight.range;\r\n        (spotLight.owner as Sprite3D)._transform.worldMatrix.getForward(forward);\r\n        Vector3.normalize(forward, forward);\r\n        Vector3.scale(forward, range, viewConeCap);\r\n        Vector3.add(position, viewConeCap, viewConeCap);\r\n\r\n        Vector3.transformV3ToV3(position, viewMat, viewPos);//World to View\r\n        Vector3.transformV3ToV3(viewConeCap, viewMat, viewConeCap);//World to View\r\n        viewPos.z *= -1;\r\n        viewConeCap.z *= -1;\r\n        var halfAngle: number = (spotLight.spotAngle / 2) * Math.PI / 180;\r\n        if (!this._shrinkSpotLightZPerspective(near, far, viewPos, viewConeCap, range, halfAngle, lightBound))\r\n            return;\r\n        if (!this._shrinkXYByRadiusPerspective(viewPos, range, lightBound, xPlanes, yPlanes))\r\n            return;\r\n        var viewFor: Vector3 = Cluster._tempVector33;\r\n        viewFor.x = viewConeCap.x - viewPos.x, viewFor.y = viewConeCap.y - viewPos.y, viewFor.z = viewConeCap.z - viewPos.z;\r\n        Vector3.normalize(viewFor, viewFor);\r\n        this._shrinkSpotXYByConePerspective(viewPos, viewFor, range, halfAngle, lightBound, xPlanes, yPlanes);\r\n\r\n        this._placeSpotLightToClusters(lightIndex, lightBound);\r\n    }\r\n\r\n    private _updatePointLightOrth(halfX: number, halfY: number, near: number, far: number, viewMat: Matrix4x4, pointLight: PointLightCom, lightIndex: number): void {\r\n        var lightBound: LightBound = Cluster._tempLightBound;\r\n        var lightviewPos: Vector3 = Cluster._tempVector30;\r\n        Vector3.transformV3ToV3((pointLight.owner as Sprite3D)._transform.position, viewMat, lightviewPos);//World to View\r\n        lightviewPos.z *= -1;\r\n\r\n        if (!this._shrinkSphereLightByBoundOrth(halfX, halfY, near, far, lightviewPos, pointLight.range, lightBound))\r\n            return;\r\n\r\n        this._placePointLightToClusters(lightIndex, lightBound);\r\n    }\r\n\r\n    private _updateSpotLightOrth(halfX: number, halfY: number, near: number, far: number, viewMat: Matrix4x4, spotLight: SpotLightCom, lightIndex: number): void {\r\n        // technically could fall outside the bounds we make because the planes themeselves are tilted by some angle\r\n        // the effect is exaggerated the steeper the angle the plane makes is\r\n        var lightBound: LightBound = Cluster._tempLightBound;\r\n        var viewPos: Vector3 = Cluster._tempVector30;\r\n        var forward: Vector3 = Cluster._tempVector31;\r\n        var viewConeCap: Vector3 = Cluster._tempVector34;\r\n        var position: Vector3 = (spotLight.owner as Sprite3D)._transform.position;\r\n        var range: number = spotLight.range;\r\n        (spotLight.owner as Sprite3D)._transform.worldMatrix.getForward(forward);\r\n        Vector3.normalize(forward, forward);\r\n        Vector3.scale(forward, range, viewConeCap);\r\n        Vector3.add(position, viewConeCap, viewConeCap);\r\n\r\n        Vector3.transformV3ToV3(position, viewMat, viewPos);//World to View\r\n        Vector3.transformV3ToV3(viewConeCap, viewMat, viewConeCap);//World to View\r\n        viewPos.z *= -1;\r\n        viewConeCap.z *= -1;\r\n        var halfAngle: number = (spotLight.spotAngle / 2) * Math.PI / 180;\r\n        if (!this._shrinkSpotLightByBoundOrth(halfX, halfY, near, far, viewPos, viewConeCap, range, halfAngle, lightBound))\r\n            return;\r\n\r\n        this._placeSpotLightToClusters(lightIndex, lightBound);\r\n    }\r\n\r\n    update(camera: Camera, scene: Scene3D): void {\r\n        this._updateMark++;\r\n        var camNear: number = camera.nearPlane;\r\n        this._depthSliceParam.x = Config3D.lightClusterCount.z / Math.log2(camera.farPlane / camNear);\r\n        this._depthSliceParam.y = Math.log2(camNear) * this._depthSliceParam.x;\r\n\r\n        var near: number = camera.nearPlane;\r\n        var far: number = camera.farPlane;\r\n        var viewMat: Matrix4x4 = camera.viewMatrix;\r\n        var curCount: number = scene._directionLights._length;\r\n        var pointLights: LightQueue<PointLightCom> = scene._pointLights;\r\n        var poiCount: number = pointLights._length;\r\n        var poiElements: PointLightCom[] = <PointLightCom[]>pointLights._elements;\r\n        var spotLights: LightQueue<SpotLightCom> = scene._spotLights;\r\n        var spoCount: number = spotLights._length;\r\n        var spoElements: SpotLightCom[] = <SpotLightCom[]>spotLights._elements;\r\n        if (camera.orthographic) {\r\n            var halfY: number = camera.orthographicVerticalSize / 2.0;\r\n            var halfX: number = halfY * camera.aspectRatio;\r\n            for (var i = 0; i < poiCount; i++, curCount++)\r\n                this._updatePointLightOrth(halfX, halfY, near, far, viewMat, poiElements[i], curCount);\r\n            for (var i = 0; i < spoCount; i++, curCount++)\r\n                this._updateSpotLightOrth(halfX, halfY, near, far, viewMat, spoElements[i], curCount);\r\n        }\r\n        else {\r\n            camera._updateClusterPlaneXY();\r\n            var xPlanes: Vector3[] = camera._clusterXPlanes;//must after camera._updateClusterPlaneXY()\r\n            var yPlanes: Vector3[] = camera._clusterYPlanes;\r\n            for (var i = 0; i < poiCount; i++, curCount++)\r\n                this._updatePointLightPerspective(near, far, viewMat, poiElements[i], curCount, xPlanes, yPlanes);\r\n            for (var i = 0; i < spoCount; i++, curCount++)\r\n                this._updateSpotLightPerspective(near, far, viewMat, spoElements[i], curCount, xPlanes, yPlanes);\r\n        }\r\n\r\n        if (poiCount + spoCount > 0) {\r\n            var xSlices: number = this._xSlices, ySlices: number = this._ySlices, zSlices: number = this._zSlices;\r\n            var widthFloat: number = xSlices * ySlices * 4;\r\n            var lightOff: number = widthFloat * zSlices;\r\n            var clusterPixels: Float32Array = this._clusterPixels;\r\n            var clusterPixelsCount: number = clusterPixels.length;\r\n            var clusterDatas: ClusterData[][][] = this._clusterDatas;\r\n            var updateMark: number = this._updateMark;\r\n            var freeSpace: boolean = true;\r\n            for (var z = 0; z < zSlices; z++) {\r\n                for (var y = 0; y < ySlices; y++) {\r\n                    for (var x = 0; x < xSlices; x++) {\r\n                        var data: ClusterData = clusterDatas[z][y][x];\r\n                        var clusterOff: number = (x + y * xSlices + z * xSlices * ySlices) * 4;\r\n                        if (data.updateMark !== updateMark) {\r\n                            clusterPixels[clusterOff] = 0;\r\n                            clusterPixels[clusterOff + 1] = 0;\r\n                        }\r\n                        else {\r\n                            if (freeSpace) {\r\n                                var indices: number[] = data.indices;\r\n                                var pCount: number = data.pointLightCount;\r\n                                var sCount: number = data.spotLightCount;\r\n                                var count: number = pCount + sCount;\r\n                                if (lightOff + count < clusterPixelsCount) {\r\n                                    clusterPixels[clusterOff] = pCount;\r\n                                    clusterPixels[clusterOff + 1] = sCount;\r\n                                    clusterPixels[clusterOff + 2] = Math.floor(lightOff / widthFloat);//solve precision problme, if data is big some GPU int(float) have problem\r\n                                    clusterPixels[clusterOff + 3] = lightOff % widthFloat;\r\n                                    for (var i: number = 0; i < count; i++)\r\n                                        clusterPixels[lightOff++] = indices[i];\r\n                                }\r\n                                else {\r\n                                    count = clusterPixelsCount - (lightOff + count);\r\n                                    pCount = Math.min(pCount, count);\r\n                                    clusterPixels[clusterOff] = pCount;\r\n                                    clusterPixels[clusterOff + 1] = Math.min(sCount, count - pCount);\r\n                                    clusterPixels[clusterOff + 2] = Math.floor(lightOff / widthFloat);//solve precision problme, if data is big some GPU int(float) have problem\r\n                                    clusterPixels[clusterOff + 3] = lightOff % widthFloat;\r\n                                    for (var i: number = 0; i < count; i++)\r\n                                        clusterPixels[lightOff++] = indices[i];\r\n                                    freeSpace = false;//remain cluster light will be ignore\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            var width: number = this._clusterTexture.width;\r\n            this._clusterTexture.setSubPixelsData(0, 0, width, Math.ceil(lightOff / (4 * width)), clusterPixels, 0, false, false, false);\r\n        }\r\n    }\r\n}\r\n","import { Vector3 } from \"../../maths/Vector3\";\r\n\r\n/**\r\n * \r\n */\r\nexport class Plane {\r\n\t/***/\r\n\tstatic PlaneIntersectionType_Back: number = 0;\r\n\tstatic PlaneIntersectionType_Front: number = 1;\r\n\tstatic PlaneIntersectionType_Intersecting: number = 2;\r\n\t\r\n\t/**@internal */\r\n\t_normal: Vector3;\r\n\t\r\n\t/**@internal */\r\n\t_distance: number;\r\n\r\n\t/**\r\n\t *  <code>Plane</code> \r\n\t * @param\tnormal \r\n\t * @param\td  \r\n\t */\r\n\tconstructor(normal: Vector3 = new Vector3, d: number = 0) {\r\n\t\tthis._normal = normal;\r\n\t\tthis._distance = d;//this.distance = d;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tset normal(value: Vector3) {\r\n\t\tvalue.cloneTo(this._normal);\r\n\t}\r\n\r\n\tget normal() {\r\n\t\treturn this._normal;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tset distance(value: number) {\r\n\t\tthis._distance = value;\r\n\t}\r\n\r\n\tget distance(): number {\r\n\t\treturn this._distance;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tpoint0 \r\n\t * @param\tpoint1 \r\n\t * @param\tpoint2 \r\n\t */\r\n\tstatic createPlaneBy3P(point0: Vector3, point1: Vector3, point2: Vector3, out: Plane): void {\r\n\t\tvar x1: number = point1.x - point0.x;\r\n\t\tvar y1: number = point1.y - point0.y;\r\n\t\tvar z1: number = point1.z - point0.z;\r\n\t\tvar x2: number = point2.x - point0.x;\r\n\t\tvar y2: number = point2.y - point0.y;\r\n\t\tvar z2: number = point2.z - point0.z;\r\n\t\tvar yz: number = (y1 * z2) - (z1 * y2);\r\n\t\tvar xz: number = (z1 * x2) - (x1 * z2);\r\n\t\tvar xy: number = (x1 * y2) - (y1 * x2);\r\n\t\tvar invPyth: number = 1.0 / (Math.sqrt((yz * yz) + (xz * xz) + (xy * xy)));\r\n\r\n\t\tvar x: number = yz * invPyth;\r\n\t\tvar y: number = xz * invPyth;\r\n\t\tvar z: number = xy * invPyth;\r\n\r\n\t\tvar normal: Vector3 = out.normal;\r\n\t\tnormal.x = x;\r\n\t\tnormal.y = y;\r\n\t\tnormal.z = z;\r\n\t\tout.normal = normal.normalize();\r\n\t\tout.distance = -((x * point0.x) + (y * point0.y) + (z * point0.z));\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tnormalize(): void {\r\n\t\tvar normalEX: number = this.normal.x;\r\n\t\tvar normalEY: number = this.normal.y;\r\n\t\tvar normalEZ: number = this.normal.z;\r\n\t\tvar magnitude: number = 1.0 / Math.sqrt(normalEX * normalEX + normalEY * normalEY + normalEZ * normalEZ);\r\n\r\n\t\tthis.normal.x = normalEX * magnitude;\r\n\t\tthis.normal.y = normalEY * magnitude;\r\n\t\tthis.normal.z = normalEZ * magnitude;\r\n\t\tthis.distance *= magnitude;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar dest: Plane = <Plane>destObject;\r\n\t\tthis.normal.cloneTo(dest.normal);\r\n\t\tdest.distance = this.distance;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): Plane {\r\n\t\tvar dest = new Plane();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n}\r\n\r\n\r\n\r\n","import { Vector3 } from \"../../maths/Vector3\";\r\n\r\n/**\r\n\t * <code>Ray</code> \r\n\t */\r\nexport class Ray {\r\n\t/***/\r\n\torigin: Vector3;\r\n\t/***/\r\n\tdirection: Vector3;\r\n\r\n\t/**\r\n\t *  <code>Ray</code> \r\n\t * @param\torigin \r\n\t * @param\tdirection  \r\n\t */\r\n\tconstructor(origin: Vector3, direction: Vector3) {\r\n\t\tthis.origin = origin;\r\n\t\tthis.direction = direction;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param t \r\n\t * @param out \r\n\t */\r\n\tat(t: number, out: Vector3) {\r\n\t\tVector3.scale(this.direction, t, out);\r\n\t\tVector3.add(this.origin, out, out);\r\n\t}\r\n\r\n}\r\n\r\n","/**\r\n * <code>ContainmentType</code> \r\n */\r\nexport class ContainmentType {\r\n\r\n\t/***/\r\n\tstatic Disjoint: number = 0;\r\n\t/***/\r\n\tstatic Contains: number = 1;\r\n\t/***/\r\n\tstatic Intersects: number = 2;\r\n\r\n}\r\n\r\n\r\n","import { Plane } from \"./Plane\";\r\nimport { BoundBox } from \"./BoundBox\";\r\nimport { BoundSphere } from \"./BoundSphere\";\r\nimport { Ray } from \"./Ray\";\r\nimport { ContainmentType } from \"./ContainmentType\";\r\nimport { MathUtils3D } from \"../../maths/MathUtils3D\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\n/**\r\n     * <code>Collision</code> \r\n     */\r\nexport class CollisionUtils {\r\n\r\n    /** @internal */\r\n    private static _tempV30: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private static _tempV31: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private static _tempV32: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private static _tempV33: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private static _tempV34: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private static _tempV35: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private static _tempV36: Vector3 = new Vector3();\r\n\r\n\r\n    /**\r\n     *  <code>Collision</code> \r\n     */\r\n    constructor() {\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tplane \r\n     * @param\tpoint \r\n     */\r\n    static distancePlaneToPoint(plane: Plane, point: Vector3): number {\r\n\r\n        var dot: number = Vector3.dot(plane.normal, point);\r\n        return dot + plane.distance;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tbox \r\n     * @param\tpoint \r\n     */\r\n    static distanceBoxToPoint(box: BoundBox, point: Vector3): number {\r\n\r\n        var boxMin: Vector3 = box.min;\r\n        var boxMineX: number = boxMin.x;\r\n        var boxMineY: number = boxMin.y;\r\n        var boxMineZ: number = boxMin.z;\r\n\r\n        var boxMax: Vector3 = box.max;\r\n        var boxMaxeX: number = boxMax.x;\r\n        var boxMaxeY: number = boxMax.y;\r\n        var boxMaxeZ: number = boxMax.z;\r\n\r\n        var pointeX: number = point.x;\r\n        var pointeY: number = point.y;\r\n        var pointeZ: number = point.z;\r\n\r\n        var distance: number = 0;\r\n\r\n        if (pointeX < boxMineX)\r\n            distance += (boxMineX - pointeX) * (boxMineX - pointeX);\r\n        if (pointeX > boxMaxeX)\r\n            distance += (boxMaxeX - pointeX) * (boxMaxeX - pointeX);\r\n\r\n        if (pointeY < boxMineY)\r\n            distance += (boxMineY - pointeY) * (boxMineY - pointeY);\r\n        if (pointeY > boxMaxeY)\r\n            distance += (boxMaxeY - pointeY) * (boxMaxeY - pointeY);\r\n\r\n        if (pointeZ < boxMineZ)\r\n            distance += (boxMineZ - pointeZ) * (boxMineZ - pointeZ);\r\n        if (pointeZ > boxMaxeZ)\r\n            distance += (boxMaxeZ - pointeZ) * (boxMaxeZ - pointeZ);\r\n\r\n        return Math.sqrt(distance);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tbox1 1\r\n     * @param\tbox2 2\r\n     */\r\n    static distanceBoxToBox(box1: BoundBox, box2: BoundBox): number {\r\n\r\n        var box1Mine: Vector3 = box1.min;\r\n        var box1MineX: number = box1Mine.x;\r\n        var box1MineY: number = box1Mine.y;\r\n        var box1MineZ: number = box1Mine.z;\r\n\r\n        var box1Maxe: Vector3 = box1.max;\r\n        var box1MaxeX: number = box1Maxe.x;\r\n        var box1MaxeY: number = box1Maxe.y;\r\n        var box1MaxeZ: number = box1Maxe.z;\r\n\r\n        var box2Mine: Vector3 = box2.min;\r\n        var box2MineX: number = box2Mine.x;\r\n        var box2MineY: number = box2Mine.y;\r\n        var box2MineZ: number = box2Mine.z;\r\n\r\n        var box2Maxe: Vector3 = box2.max;\r\n        var box2MaxeX: number = box2Maxe.x;\r\n        var box2MaxeY: number = box2Maxe.y;\r\n        var box2MaxeZ: number = box2Maxe.z;\r\n\r\n        var distance: number = 0;\r\n        var delta: number;\r\n\r\n        if (box1MineX > box2MaxeX) {\r\n\r\n            delta = box1MineX - box2MaxeX;\r\n            distance += delta * delta;\r\n        } else if (box2MineX > box1MaxeX) {\r\n\r\n            delta = box2MineX - box1MaxeX;\r\n            distance += delta * delta;\r\n        }\r\n\r\n        if (box1MineY > box2MaxeY) {\r\n\r\n            delta = box1MineY - box2MaxeY;\r\n            distance += delta * delta;\r\n        } else if (box2MineY > box1MaxeY) {\r\n\r\n            delta = box2MineY - box1MaxeY;\r\n            distance += delta * delta;\r\n        }\r\n\r\n        if (box1MineZ > box2MaxeZ) {\r\n\r\n            delta = box1MineZ - box2MaxeZ;\r\n            distance += delta * delta;\r\n        } else if (box2MineZ > box1MaxeZ) {\r\n\r\n            delta = box2MineZ - box1MaxeZ;\r\n            distance += delta * delta;\r\n        }\r\n\r\n        return Math.sqrt(distance);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere \r\n     * @param\tpoint  \r\n     */\r\n    static distanceSphereToPoint(sphere: BoundSphere, point: Vector3): number {\r\n\r\n        var distance: number = Math.sqrt(Vector3.distanceSquared(sphere.center, point));\r\n        distance -= sphere.radius;\r\n\r\n        return Math.max(distance, 0);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere1 1\r\n     * @param\tsphere2 2\r\n     */\r\n    static distanceSphereToSphere(sphere1: BoundSphere, sphere2: BoundSphere): number {\r\n\r\n        var distance: number = Math.sqrt(Vector3.distanceSquared(sphere1.center, sphere2.center));\r\n        distance -= sphere1.radius + sphere2.radius;\r\n\r\n        return Math.max(distance, 0);\r\n    }\r\n\r\n\r\n    /**\r\n     * ,\r\n     * @param\tray \r\n     * @param\tvertex1 1\r\n     * @param\tvertex2\t2\r\n     * @param\tvertex3 3\r\n     * @param\tout \r\n     * @return  \r\n     */\r\n    static intersectsRayAndTriangleRD(ray: Ray, vertex1: Vector3, vertex2: Vector3, vertex3: Vector3, out: number): boolean {\r\n\r\n        var rayO: Vector3 = ray.origin;\r\n        var rayOeX: number = rayO.x;\r\n        var rayOeY: number = rayO.y;\r\n        var rayOeZ: number = rayO.z;\r\n\r\n        var rayD: Vector3 = ray.direction;\r\n        var rayDeX: number = rayD.x;\r\n        var rayDeY: number = rayD.y;\r\n        var rayDeZ: number = rayD.z;\r\n\r\n        var v1eX: number = vertex1.x;\r\n        var v1eY: number = vertex1.y;\r\n        var v1eZ: number = vertex1.z;\r\n\r\n        var v2eX: number = vertex2.x;\r\n        var v2eY: number = vertex2.y;\r\n        var v2eZ: number = vertex2.z;\r\n\r\n        var v3eX: number = vertex3.x;\r\n        var v3eY: number = vertex3.y;\r\n        var v3eZ: number = vertex3.z;\r\n\r\n        var _tempV30eX: number = CollisionUtils._tempV30.x;\r\n        var _tempV30eY: number = CollisionUtils._tempV30.y;\r\n        var _tempV30eZ: number = CollisionUtils._tempV30.z;\r\n\r\n        _tempV30eX = v2eX - v1eX;\r\n        _tempV30eY = v2eY - v1eY;\r\n        _tempV30eZ = v2eZ - v1eZ;\r\n\r\n        var _tempV31eX: number = CollisionUtils._tempV31.x;\r\n        var _tempV31eY: number = CollisionUtils._tempV31.y;\r\n        var _tempV31eZ: number = CollisionUtils._tempV31.z;\r\n\r\n        _tempV31eX = v3eX - v1eX;\r\n        _tempV31eY = v3eY - v1eY;\r\n        _tempV31eZ = v3eZ - v1eZ;\r\n\r\n        var _tempV32eX: number = CollisionUtils._tempV32.x;\r\n        var _tempV32eY: number = CollisionUtils._tempV32.y;\r\n        var _tempV32eZ: number = CollisionUtils._tempV32.z;\r\n\r\n        _tempV32eX = (rayDeY * _tempV31eZ) - (rayDeZ * _tempV31eY);\r\n        _tempV32eY = (rayDeZ * _tempV31eX) - (rayDeX * _tempV31eZ);\r\n        _tempV32eZ = (rayDeX * _tempV31eY) - (rayDeY * _tempV31eX);\r\n\r\n        var determinant: number = (_tempV30eX * _tempV32eX) + (_tempV30eY * _tempV32eY) + (_tempV30eZ * _tempV32eZ);\r\n\r\n        if (MathUtils3D.isZero(determinant)) {\r\n\r\n            out = 0;\r\n            return false;\r\n        }\r\n\r\n        var inversedeterminant: number = 1 / determinant;\r\n\r\n        var _tempV33eX: number = CollisionUtils._tempV33.x;\r\n        var _tempV33eY: number = CollisionUtils._tempV33.y;\r\n        var _tempV33eZ: number = CollisionUtils._tempV33.z;\r\n\r\n        _tempV33eX = rayOeX - v1eX;\r\n        _tempV33eY = rayOeY - v1eY;\r\n        _tempV33eZ = rayOeZ - v1eZ;\r\n\r\n        var triangleU: number = (_tempV33eX * _tempV32eX) + (_tempV33eY * _tempV32eY) + (_tempV33eZ * _tempV32eZ);\r\n        triangleU *= inversedeterminant;\r\n\r\n        if (triangleU < 0 || triangleU > 1) {\r\n\r\n            out = 0;\r\n            return false;\r\n        }\r\n\r\n        var _tempV34eX: number = CollisionUtils._tempV34.x;\r\n        var _tempV34eY: number = CollisionUtils._tempV34.y;\r\n        var _tempV34eZ: number = CollisionUtils._tempV34.z;\r\n\r\n        _tempV34eX = (_tempV33eY * _tempV30eZ) - (_tempV33eZ * _tempV30eY);\r\n        _tempV34eY = (_tempV33eZ * _tempV30eX) - (_tempV33eX * _tempV30eZ);\r\n        _tempV34eZ = (_tempV33eX * _tempV30eY) - (_tempV33eY * _tempV30eX);\r\n\r\n        var triangleV: number = ((rayDeX * _tempV34eX) + (rayDeY * _tempV34eY)) + (rayDeZ * _tempV34eZ);\r\n        triangleV *= inversedeterminant;\r\n\r\n        if (triangleV < 0 || triangleU + triangleV > 1) {\r\n\r\n            out = 0;\r\n            return false;\r\n        }\r\n\r\n        var raydistance: number = (_tempV31eX * _tempV34eX) + (_tempV31eY * _tempV34eY) + (_tempV31eZ * _tempV34eZ);\r\n        raydistance *= inversedeterminant;\r\n\r\n        if (raydistance < 0) {\r\n\r\n            out = 0;\r\n            return false;\r\n        }\r\n\r\n        out = raydistance;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * ,\r\n     * @param\tray \r\n     * @param\tvertex1 1\r\n     * @param\tvertex2\t2\r\n     * @param\tvertex3 3\r\n     * @param\tout \r\n     * @return  \r\n     */\r\n    static intersectsRayAndTriangleRP(ray: Ray, vertex1: Vector3, vertex2: Vector3, vertex3: Vector3, out: Vector3): boolean {\r\n\r\n        var distance: number;\r\n        if (!CollisionUtils.intersectsRayAndTriangleRD(ray, vertex1, vertex2, vertex3, distance)) {\r\n\r\n            Vector3.ZERO.cloneTo(out);\r\n            return false;\r\n        }\r\n\r\n        Vector3.scale(ray.direction, distance, CollisionUtils._tempV30);\r\n        Vector3.add(ray.origin, CollisionUtils._tempV30, out);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere1 1\r\n     * @param\tsphere2 2\r\n     */\r\n    static intersectsRayAndPoint(ray: Ray, point: Vector3): boolean {\r\n\r\n        Vector3.subtract(ray.origin, point, CollisionUtils._tempV30);\r\n\r\n        var b: number = Vector3.dot(CollisionUtils._tempV30, ray.direction);\r\n        var c: number = Vector3.dot(CollisionUtils._tempV30, CollisionUtils._tempV30) - MathUtils3D.zeroTolerance;\r\n\r\n        if (c > 0 && b > 0)\r\n            return false;\r\n        var discriminant: number = b * b - c;\r\n        if (discriminant < 0)\r\n            return false;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tray1 1\r\n     * @param\tray2 2\r\n     * @param\tout \r\n     */\r\n    static intersectsRayAndRay(ray1: Ray, ray2: Ray, out: Vector3): boolean {\r\n\r\n        var ray1o: Vector3 = ray1.origin;\r\n        var ray1oeX: number = ray1o.x;\r\n        var ray1oeY: number = ray1o.y;\r\n        var ray1oeZ: number = ray1o.z;\r\n\r\n        var ray1d: Vector3 = ray1.direction;\r\n        var ray1deX: number = ray1d.x;\r\n        var ray1deY: number = ray1d.y;\r\n        var ray1deZ: number = ray1d.z;\r\n\r\n        var ray2o: Vector3 = ray2.origin;\r\n        var ray2oeX: number = ray2o.x;\r\n        var ray2oeY: number = ray2o.y;\r\n        var ray2oeZ: number = ray2o.z;\r\n\r\n        var ray2d: Vector3 = ray2.direction;\r\n        var ray2deX: number = ray2d.x;\r\n        var ray2deY: number = ray2d.y;\r\n        var ray2deZ: number = ray2d.z;\r\n\r\n        Vector3.cross(ray1d, ray2d, CollisionUtils._tempV30);\r\n        var tempV3: Vector3 = CollisionUtils._tempV30;\r\n        var denominator: number = Vector3.scalarLength(CollisionUtils._tempV30);\r\n\r\n        if (MathUtils3D.isZero(denominator)) {\r\n\r\n            if (MathUtils3D.nearEqual(ray2oeX, ray1oeX) && MathUtils3D.nearEqual(ray2oeY, ray1oeY) && MathUtils3D.nearEqual(ray2oeZ, ray1oeZ)) {\r\n                Vector3.ZERO.cloneTo(out);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        denominator = denominator * denominator;\r\n\r\n        var m11: number = ray2oeX - ray1oeX;\r\n        var m12: number = ray2oeY - ray1oeY;\r\n        var m13: number = ray2oeZ - ray1oeZ;\r\n        var m21: number = ray2deX;\r\n        var m22: number = ray2deY;\r\n        var m23: number = ray2deZ;\r\n        var m31: number = tempV3.x;\r\n        var m32: number = tempV3.y;\r\n        var m33: number = tempV3.z;\r\n\r\n        var dets: number = m11 * m22 * m33 + m12 * m23 * m31 + m13 * m21 * m32 - m11 * m23 * m32 - m12 * m21 * m33 - m13 * m22 * m31;\r\n\r\n        m21 = ray1deX;\r\n        m22 = ray1deY;\r\n        m23 = ray1deZ;\r\n\r\n\r\n        var s: number = dets / denominator;\r\n\r\n        Vector3.scale(ray1d, s, CollisionUtils._tempV30);\r\n        Vector3.scale(ray2d, s, CollisionUtils._tempV31);\r\n\r\n        Vector3.add(ray1o, CollisionUtils._tempV30, CollisionUtils._tempV32);\r\n        Vector3.add(ray2o, CollisionUtils._tempV31, CollisionUtils._tempV33);\r\n\r\n        var point1e: Vector3 = CollisionUtils._tempV32;\r\n        var point2e: Vector3 = CollisionUtils._tempV33;\r\n\r\n        if (!MathUtils3D.nearEqual(point2e.x, point1e.x) || !MathUtils3D.nearEqual(point2e.y, point1e.y) || !MathUtils3D.nearEqual(point2e.z, point1e.z)) {\r\n            Vector3.ZERO.cloneTo(out);\r\n            return false;\r\n        }\r\n\r\n        out = CollisionUtils._tempV32;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tplane \r\n     * @param\tvertex1 1\r\n     * @param\tvertex2 2\r\n     * @param\tvertex3 3\r\n     * @return  \r\n     */\r\n    static intersectsPlaneAndTriangle(plane: Plane, vertex1: Vector3, vertex2: Vector3, vertex3: Vector3): number {\r\n\r\n        var test1: number = CollisionUtils.intersectsPlaneAndPoint(plane, vertex1);\r\n        var test2: number = CollisionUtils.intersectsPlaneAndPoint(plane, vertex2);\r\n        var test3: number = CollisionUtils.intersectsPlaneAndPoint(plane, vertex3);\r\n\r\n        if (test1 == Plane.PlaneIntersectionType_Front && test2 == Plane.PlaneIntersectionType_Front && test3 == Plane.PlaneIntersectionType_Front)\r\n            return Plane.PlaneIntersectionType_Front;\r\n\r\n        if (test1 == Plane.PlaneIntersectionType_Back && test2 == Plane.PlaneIntersectionType_Back && test3 == Plane.PlaneIntersectionType_Back)\r\n            return Plane.PlaneIntersectionType_Back;\r\n\r\n        return Plane.PlaneIntersectionType_Intersecting;\r\n    }\r\n\r\n    /**\r\n     * ,\r\n     * @param\tray   \r\n     * @param\tplane \r\n     * @return\t,-1\r\n     */\r\n    static intersectsRayAndPlaneRD(ray: Ray, plane: Plane): number {\r\n        //Source: Real-Time Collision Detection by Christer Ericson\r\n        //Reference: Page 175\r\n        var planeNor: Vector3 = plane.normal;\r\n        var direction: number = Vector3.dot(planeNor, ray.direction);\r\n\r\n        if (Math.abs(direction) < MathUtils3D.zeroTolerance)\r\n            return -1;\r\n\r\n        var position: number = Vector3.dot(planeNor, ray.origin);\r\n        var distance: number = (-plane.distance - position) / direction;\r\n\r\n        if (distance < 0) {\r\n            if (distance < -MathUtils3D.zeroTolerance)\r\n                return -1;\r\n            distance = 0;\r\n        }\r\n        return distance;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tray   \r\n     * @param\tplane \r\n     * @param\tout \r\n     */\r\n    static intersectsRayAndPlaneRP(ray: Ray, plane: Plane, out: Vector3): boolean {\r\n        //Source: Real-Time Collision Detection by Christer Ericson\r\n        //Reference: Page 175\r\n        var distance: number = CollisionUtils.intersectsRayAndPlaneRD(ray, plane);\r\n        if (distance == -1) {\r\n            out.setValue(0, 0, 0);\r\n            return false;\r\n        }\r\n\r\n        var scaDis: Vector3 = CollisionUtils._tempV30;\r\n        Vector3.scale(ray.direction, distance, scaDis);\r\n        Vector3.add(ray.origin, scaDis, out);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tray \r\n     * @param\tbox\t\r\n     * @param\tout ,0,\r\n     */\r\n    static intersectsRayAndBoxRD(ray: Ray, box: BoundBox): number {\r\n\r\n        var rayoe: Vector3 = ray.origin;\r\n        var rayoeX: number = rayoe.x;\r\n        var rayoeY: number = rayoe.y;\r\n        var rayoeZ: number = rayoe.z;\r\n\r\n        var rayde: Vector3 = ray.direction;\r\n        var raydeX: number = rayde.x;\r\n        var raydeY: number = rayde.y;\r\n        var raydeZ: number = rayde.z;\r\n\r\n        var boxMine: Vector3 = box.min;\r\n        var boxMineX: number = boxMine.x;\r\n        var boxMineY: number = boxMine.y;\r\n        var boxMineZ: number = boxMine.z;\r\n\r\n        var boxMaxe: Vector3 = box.max;\r\n        var boxMaxeX: number = boxMaxe.x;\r\n        var boxMaxeY: number = boxMaxe.y;\r\n        var boxMaxeZ: number = boxMaxe.z;\r\n\r\n        var out: number = 0;\r\n\r\n        var tmax: number = MathUtils3D.MaxValue;\r\n\r\n        if (MathUtils3D.isZero(raydeX)) {\r\n\r\n            if (rayoeX < boxMineX || rayoeX > boxMaxeX) {\r\n\r\n                //out = 0;\r\n                return -1;\r\n            }\r\n        } else {\r\n\r\n            var inverse: number = 1 / raydeX;\r\n            var t1: number = (boxMineX - rayoeX) * inverse;\r\n            var t2: number = (boxMaxeX - rayoeX) * inverse;\r\n\r\n            if (t1 > t2) {\r\n\r\n                var temp: number = t1;\r\n                t1 = t2;\r\n                t2 = temp;\r\n            }\r\n\r\n            out = Math.max(t1, out);\r\n            tmax = Math.min(t2, tmax);\r\n\r\n            if (out > tmax) {\r\n\r\n                //out = 0;\r\n                return -1;\r\n            }\r\n        }\r\n\r\n        if (MathUtils3D.isZero(raydeY)) {\r\n\r\n            if (rayoeY < boxMineY || rayoeY > boxMaxeY) {\r\n\r\n                //out = 0;\r\n                return -1;\r\n            }\r\n        } else {\r\n\r\n            var inverse1: number = 1 / raydeY;\r\n            var t3: number = (boxMineY - rayoeY) * inverse1;\r\n            var t4: number = (boxMaxeY - rayoeY) * inverse1;\r\n\r\n            if (t3 > t4) {\r\n\r\n                var temp1: number = t3;\r\n                t3 = t4;\r\n                t4 = temp1;\r\n            }\r\n\r\n            out = Math.max(t3, out);\r\n            tmax = Math.min(t4, tmax);\r\n\r\n            if (out > tmax) {\r\n\r\n                //out = 0;\r\n                return -1;\r\n            }\r\n        }\r\n\r\n        if (MathUtils3D.isZero(raydeZ)) {\r\n\r\n            if (rayoeZ < boxMineZ || rayoeZ > boxMaxeZ) {\r\n\r\n                //out = 0;\r\n                return -1;\r\n            }\r\n        } else {\r\n\r\n            var inverse2: number = 1 / raydeZ;\r\n            var t5: number = (boxMineZ - rayoeZ) * inverse2;\r\n            var t6: number = (boxMaxeZ - rayoeZ) * inverse2;\r\n\r\n            if (t5 > t6) {\r\n\r\n                var temp2: number = t5;\r\n                t5 = t6;\r\n                t6 = temp2;\r\n            }\r\n\r\n            out = Math.max(t5, out);\r\n            tmax = Math.min(t6, tmax);\r\n\r\n            if (out > tmax) {\r\n\r\n                //out = 0;\r\n                return -1;\r\n            }\r\n        }\r\n\r\n        return out;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tray \r\n     * @param\tbox\t\r\n     * @param\tout \r\n     */\r\n    static intersectsRayAndBoxRP(ray: Ray, box: BoundBox, out: Vector3): number {\r\n\r\n        var distance: number = CollisionUtils.intersectsRayAndBoxRD(ray, box);\r\n        if (distance === -1) {\r\n\r\n            Vector3.ZERO.cloneTo(out);\r\n            return distance;\r\n        }\r\n        Vector3.scale(ray.direction, distance, CollisionUtils._tempV30);\r\n        Vector3.add(ray.origin, CollisionUtils._tempV30, CollisionUtils._tempV31);\r\n\r\n        CollisionUtils._tempV31.cloneTo(out);\r\n\r\n        return distance;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tray    \r\n     * @param\tsphere \r\n     * @return\t,-1\r\n     */\r\n    static intersectsRayAndSphereRD(ray: Ray, sphere: BoundSphere): number {\r\n\r\n        var sphereR: number = sphere.radius;\r\n        Vector3.subtract(ray.origin, sphere.center, CollisionUtils._tempV30);\r\n\r\n        var b: number = Vector3.dot(CollisionUtils._tempV30, ray.direction);\r\n        var c: number = Vector3.dot(CollisionUtils._tempV30, CollisionUtils._tempV30) - (sphereR * sphereR);\r\n\r\n        if (c > 0 && b > 0) {\r\n            return -1;\r\n        }\r\n\r\n        var discriminant: number = b * b - c;\r\n\r\n        if (discriminant < 0) {\r\n            return -1;\r\n        }\r\n\r\n        var distance: number = -b - Math.sqrt(discriminant);\r\n\r\n        if (distance < 0)\r\n            distance = 0;\r\n\r\n        return distance;\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tray    \r\n     * @param\tsphere \r\n     * @param\tout    \r\n     * @return  ,-1\r\n     */\r\n    static intersectsRayAndSphereRP(ray: Ray, sphere: BoundSphere, out: Vector3): number {\r\n        var distance: number = CollisionUtils.intersectsRayAndSphereRD(ray, sphere);\r\n        if (distance === -1) {\r\n            Vector3.ZERO.cloneTo(out);\r\n            return distance;\r\n        }\r\n\r\n        Vector3.scale(ray.direction, distance, CollisionUtils._tempV30);\r\n        Vector3.add(ray.origin, CollisionUtils._tempV30, CollisionUtils._tempV31);\r\n\r\n        CollisionUtils._tempV31.cloneTo(out);\r\n        return distance;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere \r\n     * @param\tvertex1 1\r\n     * @param\tvertex2 2\r\n     * @param\tvertex3 3\r\n     * @return  \r\n     */\r\n    static intersectsSphereAndTriangle(sphere: BoundSphere, vertex1: Vector3, vertex2: Vector3, vertex3: Vector3): boolean {\r\n\r\n        var sphereC: Vector3 = sphere.center;\r\n        var sphereR: number = sphere.radius;\r\n\r\n        CollisionUtils.closestPointPointTriangle(sphereC, vertex1, vertex2, vertex3, CollisionUtils._tempV30);\r\n        Vector3.subtract(CollisionUtils._tempV30, sphereC, CollisionUtils._tempV31);\r\n\r\n        var dot: number = Vector3.dot(CollisionUtils._tempV31, CollisionUtils._tempV31);\r\n\r\n        return dot <= sphereR * sphereR;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tplane  \r\n     * @param\tpoint  \r\n     * @return  \r\n     */\r\n    static intersectsPlaneAndPoint(plane: Plane, point: Vector3): number {\r\n        var distance: number = Vector3.dot(plane.normal, point) + plane.distance;\r\n        if (distance > 0)\r\n            return Plane.PlaneIntersectionType_Front;\r\n        if (distance < 0)\r\n            return Plane.PlaneIntersectionType_Back;\r\n        return Plane.PlaneIntersectionType_Intersecting;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tplane1 1\r\n     * @param\tplane2 2\r\n     * @return  \r\n     */\r\n    static intersectsPlaneAndPlane(plane1: Plane, plane2: Plane): boolean {\r\n\r\n        Vector3.cross(plane1.normal, plane2.normal, CollisionUtils._tempV30);\r\n\r\n        var denominator: number = Vector3.dot(CollisionUtils._tempV30, CollisionUtils._tempV30);\r\n\r\n        if (MathUtils3D.isZero(denominator))\r\n            return false;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tplane1 1\r\n     * @param\tplane2 2\r\n     * @param\tline   \r\n     * @return  \r\n     */\r\n    static intersectsPlaneAndPlaneRL(plane1: Plane, plane2: Plane, line: Ray): boolean {\r\n\r\n        var plane1nor: Vector3 = plane1.normal;\r\n        var plane2nor: Vector3 = plane2.normal;\r\n\r\n        Vector3.cross(plane1nor, plane2nor, CollisionUtils._tempV34);\r\n        var denominator: number = Vector3.dot(CollisionUtils._tempV34, CollisionUtils._tempV34);\r\n\r\n        if (MathUtils3D.isZero(denominator))\r\n            return false;\r\n\r\n        Vector3.scale(plane2nor, plane1.distance, CollisionUtils._tempV30);\r\n        Vector3.scale(plane1nor, plane2.distance, CollisionUtils._tempV31);\r\n        Vector3.subtract(CollisionUtils._tempV30, CollisionUtils._tempV31, CollisionUtils._tempV32);\r\n        Vector3.cross(CollisionUtils._tempV32, CollisionUtils._tempV34, CollisionUtils._tempV33);\r\n\r\n        Vector3.normalize(CollisionUtils._tempV34, CollisionUtils._tempV34);\r\n        line = new Ray(CollisionUtils._tempV33, CollisionUtils._tempV34);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tplane \r\n     * @param   box  \r\n     * @return  \r\n     */\r\n    static intersectsPlaneAndBox(plane: Plane, box: BoundBox): number {\r\n\r\n        var planeD: number = plane.distance;\r\n\r\n        var planeNor: Vector3 = plane.normal;\r\n        var planeNoreX: number = planeNor.x;\r\n        var planeNoreY: number = planeNor.y;\r\n        var planeNoreZ: number = planeNor.z;\r\n\r\n        var boxMine: Vector3 = box.min;\r\n        var boxMineX: number = boxMine.x;\r\n        var boxMineY: number = boxMine.y;\r\n        var boxMineZ: number = boxMine.z;\r\n\r\n        var boxMaxe: Vector3 = box.max;\r\n        var boxMaxeX: number = boxMaxe.x;\r\n        var boxMaxeY: number = boxMaxe.y;\r\n        var boxMaxeZ: number = boxMaxe.z;\r\n\r\n        CollisionUtils._tempV30.x = (planeNoreX > 0) ? boxMineX : boxMaxeX;\r\n        CollisionUtils._tempV30.y = (planeNoreY > 0) ? boxMineY : boxMaxeY;\r\n        CollisionUtils._tempV30.z = (planeNoreZ > 0) ? boxMineZ : boxMaxeZ;\r\n\r\n        CollisionUtils._tempV31.x = (planeNoreX > 0) ? boxMaxeX : boxMineX;\r\n        CollisionUtils._tempV31.y = (planeNoreY > 0) ? boxMaxeY : boxMineY;\r\n        CollisionUtils._tempV31.z = (planeNoreZ > 0) ? boxMaxeZ : boxMineZ;\r\n\r\n        var distance: number = Vector3.dot(planeNor, CollisionUtils._tempV30);\r\n        if (distance + planeD > 0)\r\n            return Plane.PlaneIntersectionType_Front;\r\n\r\n        distance = Vector3.dot(planeNor, CollisionUtils._tempV31);\r\n        if (distance + planeD < 0)\r\n            return Plane.PlaneIntersectionType_Back;\r\n\r\n        return Plane.PlaneIntersectionType_Intersecting;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tplane \r\n     * @param   sphere \r\n     * @return  \r\n     */\r\n    static intersectsPlaneAndSphere(plane: Plane, sphere: BoundSphere): number {\r\n\r\n        var sphereR: number = sphere.radius;\r\n        var distance: number = Vector3.dot(plane.normal, sphere.center) + plane.distance;\r\n\r\n        if (distance > sphereR)\r\n            return Plane.PlaneIntersectionType_Front;\r\n        if (distance < -sphereR)\r\n            return Plane.PlaneIntersectionType_Back;\r\n        return Plane.PlaneIntersectionType_Intersecting;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tbox1 1\r\n     * @param   box2 2\r\n     * @return  \r\n     */\r\n    static intersectsBoxAndBox(box1: BoundBox, box2: BoundBox): boolean {\r\n\r\n        var box1Mine: Vector3 = box1.min;\r\n        var box1Maxe: Vector3 = box1.max;\r\n        var box2Mine: Vector3 = box2.min;\r\n        var box2Maxe: Vector3 = box2.max;\r\n\r\n        if (box1Mine.x > box2Maxe.x || box2Mine.x > box1Maxe.x)\r\n            return false;\r\n        if (box1Mine.y > box2Maxe.y || box2Mine.y > box1Maxe.y)\r\n            return false;\r\n        if (box1Mine.z > box2Maxe.z || box2Mine.z > box1Maxe.z)\r\n            return false;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tbox \r\n     * @param   sphere \r\n     * @return  \r\n     */\r\n    static intersectsBoxAndSphere(box: BoundBox, sphere: BoundSphere): boolean {\r\n        var center: Vector3 = sphere.center;\r\n        var radius: number = sphere.radius;\r\n        var nearest: Vector3 = CollisionUtils._tempV30;\r\n        Vector3.Clamp(center, box.min, box.max, nearest);\r\n        var distance: number = Vector3.distanceSquared(center, nearest);\r\n        return distance <= radius * radius;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere1 1\r\n     * @param   sphere2 2\r\n     * @return  \r\n     */\r\n    static intersectsSphereAndSphere(sphere1: BoundSphere, sphere2: BoundSphere): boolean {\r\n\r\n        var radiisum: number = sphere1.radius + sphere2.radius;\r\n        return Vector3.distanceSquared(sphere1.center, sphere2.center) <= radiisum * radiisum;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tbox \r\n     * @param   point \r\n     * @return  :0 ,1 , 2 \r\n     */\r\n    static boxContainsPoint(box: BoundBox, point: Vector3): number {\r\n        var boxMine: Vector3 = box.min;\r\n        var boxMaxe: Vector3 = box.max;\r\n        if (boxMine.x <= point.x && boxMaxe.x >= point.x && boxMine.y <= point.y && boxMaxe.y >= point.y && boxMine.z <= point.z && boxMaxe.z >= point.z)\r\n            return ContainmentType.Contains;\r\n        return ContainmentType.Disjoint;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tbox1 1\r\n     * @param   box2 2\r\n     * @return  :0 ,1 , 2 \r\n     */\r\n    static boxContainsBox(box1: BoundBox, box2: BoundBox): number {\r\n\r\n        var box1Mine: Vector3 = box1.min;\r\n        var box1MineX: number = box1Mine.x;\r\n        var box1MineY: number = box1Mine.y;\r\n        var box1MineZ: number = box1Mine.z;\r\n\r\n        var box1Maxe: Vector3 = box1.max;\r\n        var box1MaxeX: number = box1Maxe.x;\r\n        var box1MaxeY: number = box1Maxe.y;\r\n        var box1MaxeZ: number = box1Maxe.z;\r\n\r\n        var box2Mine: Vector3 = box2.min;\r\n        var box2MineX: number = box2Mine.x;\r\n        var box2MineY: number = box2Mine.y;\r\n        var box2MineZ: number = box2Mine.z;\r\n\r\n        var box2Maxe: Vector3 = box2.max;\r\n        var box2MaxeX: number = box2Maxe.x;\r\n        var box2MaxeY: number = box2Maxe.y;\r\n        var box2MaxeZ: number = box2Maxe.z;\r\n\r\n        if (box1MaxeX < box2MineX || box1MineX > box2MaxeX)\r\n            return ContainmentType.Disjoint;\r\n\r\n        if (box1MaxeY < box2MineY || box1MineY > box2MaxeY)\r\n            return ContainmentType.Disjoint;\r\n\r\n        if (box1MaxeZ < box2MineZ || box1MineZ > box2MaxeZ)\r\n            return ContainmentType.Disjoint;\r\n\r\n        if (box1MineX <= box2MineX && box2MaxeX <= box1MaxeX && box1MineY <= box2MineY && box2MaxeY <= box1MaxeY && box1MineZ <= box2MineZ && box2MaxeZ <= box1MaxeZ) {\r\n            return ContainmentType.Contains;\r\n        }\r\n\r\n        return ContainmentType.Intersects;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tbox \r\n     * @param   sphere \r\n     * @return  :0 ,1 , 2 \r\n     */\r\n    static boxContainsSphere(box: BoundBox, sphere: BoundSphere): number {\r\n\r\n        var boxMin: Vector3 = box.min;\r\n        var boxMineX: number = boxMin.x;\r\n        var boxMineY: number = boxMin.y;\r\n        var boxMineZ: number = boxMin.z;\r\n\r\n        var boxMax: Vector3 = box.max;\r\n        var boxMaxeX: number = boxMax.x;\r\n        var boxMaxeY: number = boxMax.y;\r\n        var boxMaxeZ: number = boxMax.z;\r\n\r\n        var sphereC: Vector3 = sphere.center;\r\n        var sphereCeX: number = sphereC.x;\r\n        var sphereCeY: number = sphereC.y;\r\n        var sphereCeZ: number = sphereC.z;\r\n\r\n        var sphereR: number = sphere.radius;\r\n\r\n        Vector3.Clamp(sphereC, boxMin, boxMax, CollisionUtils._tempV30);\r\n        var distance: number = Vector3.distanceSquared(sphereC, CollisionUtils._tempV30);\r\n\r\n        if (distance > sphereR * sphereR)\r\n            return ContainmentType.Disjoint;\r\n\r\n        if ((((boxMineX + sphereR <= sphereCeX) && (sphereCeX <= boxMaxeX - sphereR)) && ((boxMaxeX - boxMineX > sphereR) &&\r\n            (boxMineY + sphereR <= sphereCeY))) && (((sphereCeY <= boxMaxeY - sphereR) && (boxMaxeY - boxMineY > sphereR)) &&\r\n                (((boxMineZ + sphereR <= sphereCeZ) && (sphereCeZ <= boxMaxeZ - sphereR)) && (boxMaxeZ - boxMineZ > sphereR))))\r\n            return ContainmentType.Contains;\r\n\r\n        return ContainmentType.Intersects;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere \r\n     * @param   point \r\n     * @return  :0 ,1 , 2 \r\n     */\r\n    static sphereContainsPoint(sphere: BoundSphere, point: Vector3): number {\r\n\r\n        if (Vector3.distanceSquared(point, sphere.center) <= sphere.radius * sphere.radius)\r\n            return ContainmentType.Contains;\r\n\r\n        return ContainmentType.Disjoint;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere\r\n     * @param\tvertex1 1\r\n     * @param\tvertex2 2\r\n     * @param\tvertex3 3\r\n     * @return  \r\n     */\r\n    static sphereContainsTriangle(sphere: BoundSphere, vertex1: Vector3, vertex2: Vector3, vertex3: Vector3): number {\r\n        var test1: number = CollisionUtils.sphereContainsPoint(sphere, vertex1);\r\n        var test2: number = CollisionUtils.sphereContainsPoint(sphere, vertex2);\r\n        var test3: number = CollisionUtils.sphereContainsPoint(sphere, vertex3);\r\n\r\n        if (test1 == ContainmentType.Contains && test2 == ContainmentType.Contains && test3 == ContainmentType.Contains)\r\n            return ContainmentType.Contains;\r\n\r\n        if (CollisionUtils.intersectsSphereAndTriangle(sphere, vertex1, vertex2, vertex3))\r\n            return ContainmentType.Intersects;\r\n\r\n        return ContainmentType.Disjoint;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere \r\n     * @param   box \r\n     * @return  :0 ,1 , 2 \r\n     */\r\n    static sphereContainsBox(sphere: BoundSphere, box: BoundBox): number {\r\n\r\n        var sphereC: Vector3 = sphere.center;\r\n        var sphereCeX: number = sphereC.x;\r\n        var sphereCeY: number = sphereC.y;\r\n        var sphereCeZ: number = sphereC.z;\r\n\r\n        var sphereR: number = sphere.radius;\r\n\r\n        var boxMin: Vector3 = box.min;\r\n        var boxMineX: number = boxMin.x;\r\n        var boxMineY: number = boxMin.y;\r\n        var boxMineZ: number = boxMin.z;\r\n\r\n        var boxMax: Vector3 = box.max;\r\n        var boxMaxeX: number = boxMax.x;\r\n        var boxMaxeY: number = boxMax.y;\r\n        var boxMaxeZ: number = boxMax.z;\r\n\r\n        var _tempV30e: Vector3 = CollisionUtils._tempV30;\r\n        var _tempV30eX: number = _tempV30e.x;\r\n        var _tempV30eY: number = _tempV30e.y;\r\n        var _tempV30eZ: number = _tempV30e.z;\r\n\r\n        if (!CollisionUtils.intersectsBoxAndSphere(box, sphere))\r\n            return ContainmentType.Disjoint;\r\n\r\n        var radiusSquared: number = sphereR * sphereR;\r\n\r\n        _tempV30eX = sphereCeX - boxMineX;\r\n        _tempV30eY = sphereCeY - boxMaxeY;\r\n        _tempV30eZ = sphereCeZ - boxMaxeZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        _tempV30eX = sphereCeX - boxMaxeX;\r\n        _tempV30eY = sphereCeY - boxMaxeY;\r\n        _tempV30eZ = sphereCeZ - boxMaxeZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        _tempV30eX = sphereCeX - boxMaxeX;\r\n        _tempV30eY = sphereCeY - boxMineY;\r\n        _tempV30eZ = sphereCeZ - boxMaxeZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        _tempV30eX = sphereCeX - boxMineX;\r\n        _tempV30eY = sphereCeY - boxMineY;\r\n        _tempV30eZ = sphereCeZ - boxMaxeZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        _tempV30eX = sphereCeX - boxMineX;\r\n        _tempV30eY = sphereCeY - boxMaxeY;\r\n        _tempV30eZ = sphereCeZ - boxMineZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        _tempV30eX = sphereCeX - boxMaxeX;\r\n        _tempV30eY = sphereCeY - boxMaxeY;\r\n        _tempV30eZ = sphereCeZ - boxMineZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        _tempV30eX = sphereCeX - boxMaxeX;\r\n        _tempV30eY = sphereCeY - boxMineY;\r\n        _tempV30eZ = sphereCeZ - boxMineZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        _tempV30eX = sphereCeX - boxMineX;\r\n        _tempV30eY = sphereCeY - boxMineY;\r\n        _tempV30eZ = sphereCeZ - boxMineZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        return ContainmentType.Contains;\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere1 \r\n     * @param   sphere2 \r\n     * @return  :0 ,1 , 2 \r\n     */\r\n    static sphereContainsSphere(sphere1: BoundSphere, sphere2: BoundSphere): number {\r\n\r\n        var sphere1R: number = sphere1.radius;\r\n        var sphere2R: number = sphere2.radius;\r\n\r\n        var distance: number = Vector3.distance(sphere1.center, sphere2.center);\r\n\r\n        if (sphere1R + sphere2R < distance)\r\n            return ContainmentType.Disjoint;\r\n\r\n        if (sphere1R - sphere2R < distance)\r\n            return ContainmentType.Intersects;\r\n\r\n        return ContainmentType.Contains;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tpoint \r\n     * @param\tvertex1 1\r\n     * @param\tvertex2\t2\r\n     * @param\tvertex3 3\r\n     * @param\tout \r\n     */\r\n    static closestPointPointTriangle(point: Vector3, vertex1: Vector3, vertex2: Vector3, vertex3: Vector3, out: Vector3): void {\r\n\r\n        Vector3.subtract(vertex2, vertex1, CollisionUtils._tempV30);\r\n        Vector3.subtract(vertex3, vertex1, CollisionUtils._tempV31);\r\n\r\n        Vector3.subtract(point, vertex1, CollisionUtils._tempV32);\r\n        Vector3.subtract(point, vertex2, CollisionUtils._tempV33);\r\n        Vector3.subtract(point, vertex3, CollisionUtils._tempV34);\r\n\r\n        var d1: number = Vector3.dot(CollisionUtils._tempV30, CollisionUtils._tempV32);\r\n        var d2: number = Vector3.dot(CollisionUtils._tempV31, CollisionUtils._tempV32);\r\n        var d3: number = Vector3.dot(CollisionUtils._tempV30, CollisionUtils._tempV33);\r\n        var d4: number = Vector3.dot(CollisionUtils._tempV31, CollisionUtils._tempV33);\r\n        var d5: number = Vector3.dot(CollisionUtils._tempV30, CollisionUtils._tempV34);\r\n        var d6: number = Vector3.dot(CollisionUtils._tempV31, CollisionUtils._tempV34);\r\n\r\n        if (d1 <= 0 && d2 <= 0) {\r\n            vertex1.cloneTo(out);\r\n            return;\r\n        }\r\n\r\n        if (d3 >= 0 && d4 <= d3) {\r\n            vertex2.cloneTo(out);\r\n            return;\r\n        }\r\n\r\n        var vc: number = d1 * d4 - d3 * d2;\r\n        if (vc <= 0 && d1 >= 0 && d3 <= 0) {\r\n            var v: number = d1 / (d1 - d3);\r\n            Vector3.scale(CollisionUtils._tempV30, v, out);\r\n            Vector3.add(vertex1, out, out);\r\n            return;\r\n        }\r\n\r\n        if (d6 >= 0 && d5 <= d6) {\r\n            vertex3.cloneTo(out);\r\n            return;\r\n        }\r\n\r\n        var vb: number = d5 * d2 - d1 * d6;\r\n        if (vb <= 0 && d2 >= 0 && d6 <= 0) {\r\n            var w: number = d2 / (d2 - d6);\r\n            Vector3.scale(CollisionUtils._tempV31, w, out);\r\n            Vector3.add(vertex1, out, out);\r\n            return;\r\n        }\r\n\r\n        var va: number = d3 * d6 - d5 * d4;\r\n        if (va <= 0 && (d4 - d3) >= 0 && (d5 - d6) >= 0) {\r\n            var w3: number = (d4 - d3) / ((d4 - d3) + (d5 - d6));\r\n            Vector3.subtract(vertex3, vertex2, out);\r\n            Vector3.scale(out, w3, out);\r\n            Vector3.add(vertex2, out, out);\r\n            return;\r\n        }\r\n\r\n        var denom: number = 1 / (va + vb + vc);\r\n        var v2: number = vb * denom;\r\n        var w2: number = vc * denom;\r\n        Vector3.scale(CollisionUtils._tempV30, v2, CollisionUtils._tempV35);\r\n        Vector3.scale(CollisionUtils._tempV31, w2, CollisionUtils._tempV36);\r\n        Vector3.add(CollisionUtils._tempV35, CollisionUtils._tempV36, out);\r\n        Vector3.add(vertex1, out, out);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tplane \r\n     * @param\tpoint \r\n     * @param\tout \r\n     */\r\n    static closestPointPlanePoint(plane: Plane, point: Vector3, out: Vector3): void {\r\n\r\n        var planeN: Vector3 = plane.normal;\r\n        var t: number = Vector3.dot(planeN, point) - plane.distance;\r\n\r\n        Vector3.scale(planeN, t, CollisionUtils._tempV30);\r\n        Vector3.subtract(point, CollisionUtils._tempV30, out);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tbox \r\n     * @param\tpoint \r\n     * @param\tout \r\n     */\r\n    static closestPointBoxPoint(box: BoundBox, point: Vector3, out: Vector3): void {\r\n        Vector3.max(point, box.min, CollisionUtils._tempV30);\r\n        Vector3.min(CollisionUtils._tempV30, box.max, out);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere \r\n     * @param\tpoint \r\n     * @param\tout \r\n     */\r\n    static closestPointSpherePoint(sphere: BoundSphere, point: Vector3, out: Vector3): void {\r\n        var sphereC: Vector3 = sphere.center;\r\n\r\n        Vector3.subtract(point, sphereC, out);\r\n        Vector3.normalize(out, out);\r\n\r\n        Vector3.scale(out, sphere.radius, out);\r\n        Vector3.add(out, sphereC, out);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere1 1\r\n     * @param\tsphere2 2\r\n     * @param\tout \r\n     */\r\n    static closestPointSphereSphere(sphere1: BoundSphere, sphere2: BoundSphere, out: Vector3): void {\r\n        var sphere1C: Vector3 = sphere1.center;\r\n\r\n        Vector3.subtract(sphere2.center, sphere1C, out);\r\n        Vector3.normalize(out, out);\r\n\r\n        Vector3.scale(out, sphere1.radius, out);\r\n        Vector3.add(out, sphere1C, out);\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n","import { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\n\r\n/**\r\n * <code>Viewport</code> \r\n */\r\nexport class Viewport {\r\n\t/** @internal */\r\n\tstatic _tempMatrix4x4: Matrix4x4 = new Matrix4x4();\r\n\tstatic _tempViewport: Viewport = new Viewport(0, 0, 0, 0);\r\n\t/**X*/\r\n\tx: number;\r\n\t/**Y*/\r\n\ty: number;\r\n\t/***/\r\n\twidth: number;\r\n\t/***/\r\n\theight: number;\r\n\t/***/\r\n\tminDepth: number;\r\n\t/***/\r\n\tmaxDepth: number;\r\n\r\n\t/**\r\n\t *  <code>Viewport</code> \r\n\t * @param\tx x\r\n\t * @param\ty y\r\n\t * @param\twidth \r\n\t * @param\theight \r\n\t */\r\n\tconstructor(x?: number, y?: number, width?: number, height?: number) {\r\n\t\tthis.minDepth = 0.0;\r\n\t\tthis.maxDepth = 1.0;\r\n\r\n\t\tthis.x = x ?? 0;\r\n\t\tthis.y = y ?? 0;\r\n\t\tthis.width = width ?? 0;\r\n\t\tthis.height = height ?? 0;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tsource \r\n\t * @param\tmatrix \r\n\t * @param\tout xyz,wz\r\n\t */\r\n\tproject(source: Vector3, matrix: Matrix4x4, out: Vector4): void {\r\n\t\tVector3.transformV3ToV4(source, matrix, out);\r\n\t\tvar x: number = out.x, y: number = out.y, z: number = out.z;\r\n\t\tvar w: number = out.w;\r\n\t\tif (w !== 1.0) {\r\n\t\t\tx = x / w;\r\n\t\t\ty = y / w;\r\n\t\t\tz = z / w;\r\n\t\t}\r\n\t\tout.x = (x + 1.0) * 0.5 * this.width + this.x;\r\n\t\tout.y = (-y + 1.0) * 0.5 * this.height + this.y;\r\n\t\tout.z = z * (this.maxDepth - this.minDepth) + this.minDepth;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tsource \r\n\t * @param\tmatrix \r\n\t * @param\tout \r\n\t */\r\n\tunprojectFromMat(source: Vector3, matrix: Matrix4x4, out: Vector3): void {\r\n\t\tvar matrixEleme: Float32Array = matrix.elements;\r\n\r\n\t\tout.x = (((source.x - this.x) / this.width) * 2.0) - 1.0;\r\n\t\tout.y = -((((source.y - this.y) / this.height) * 2.0) - 1.0);\r\n\t\tout.z = (source.z - this.minDepth) / (this.maxDepth - this.minDepth);\r\n\t\tvar a: number = (((out.x * matrixEleme[3]) + (out.y * matrixEleme[7])) + (out.z * matrixEleme[11])) + matrixEleme[15];\r\n\t\tVector3.transformV3ToV3(out, matrix, out);\r\n\t\tif (a !== 1.0) {\r\n\t\t\tout.x = out.x / a;\r\n\t\t\tout.y = out.y / a;\r\n\t\t\tout.z = out.z / a;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tsource \r\n\t * @param\tprojection  \r\n\t * @param\tview \r\n\t * @param\tworld ,null\r\n\t * @param   out \r\n\t */\r\n\tunprojectFromWVP(source: Vector3, projection: Matrix4x4, view: Matrix4x4, world: Matrix4x4, out: Vector3): void {\r\n\r\n\t\tMatrix4x4.multiply(projection, view, Viewport._tempMatrix4x4);\r\n\t\t(world) && (Matrix4x4.multiply(Viewport._tempMatrix4x4, world, Viewport._tempMatrix4x4));\r\n\t\tViewport._tempMatrix4x4.invert(Viewport._tempMatrix4x4);\r\n\t\tthis.unprojectFromMat(source, Viewport._tempMatrix4x4, out);\r\n\t}\r\n\r\n\tset(x: number, y: number, width: number, height: number) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tout\r\n\t */\r\n\tcloneTo(out: Viewport): void {\r\n\t\tout.x = this.x;\r\n\t\tout.y = this.y;\r\n\t\tout.width = this.width;\r\n\t\tout.height = this.height;\r\n\t\tout.minDepth = this.minDepth;\r\n\t\tout.maxDepth = this.maxDepth;\r\n\t}\r\n}\r\n\r\n\r\n","\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../maths/Vector2\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Plane } from \"../math/Plane\"\r\nimport { Ray } from \"../math/Ray\"\r\n\r\nimport { Viewport } from \"../math/Viewport\"\r\n\r\n/**\r\n * <code>Picker</code> \r\n */\r\nexport class Picker {\r\n\tprivate static _tempVector30: Vector3 = new Vector3();\r\n\tprivate static _tempVector31: Vector3 = new Vector3();\r\n\tprivate static _tempVector32: Vector3 = new Vector3();\r\n\tprivate static _tempVector33: Vector3 = new Vector3();\r\n\tprivate static _tempVector34: Vector3 = new Vector3();\r\n\r\n\t/**\r\n\t *  <code>Picker</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tpoint \r\n\t * @param\tviewPort \r\n\t * @param\tprojectionMatrix \r\n\t * @param\tviewMatrix \r\n\t * @param\tworld \r\n\t * @return  out  \r\n\t */\r\n\tstatic calculateCursorRay(point: Vector2, viewPort: Viewport, projectionMatrix: Matrix4x4, viewMatrix: Matrix4x4, world: Matrix4x4, out: Ray): void {\r\n\r\n\t\tvar x: number = point.x;\r\n\t\tvar y: number = point.y;\r\n\r\n\t\tvar nearSource: Vector3 = Picker._tempVector30;\r\n\t\tvar nerSourceE: Vector3 = nearSource;\r\n\t\tnerSourceE.x = x;\r\n\t\tnerSourceE.y = y;\r\n\t\tnerSourceE.z = viewPort.minDepth;\r\n\r\n\t\tvar farSource: Vector3 = Picker._tempVector31;\r\n\t\tvar farSourceE: Vector3 = farSource;\r\n\t\tfarSourceE.x = x;\r\n\t\tfarSourceE.y = y;\r\n\t\tfarSourceE.z = viewPort.maxDepth;\r\n\r\n\t\tvar nearPoint: Vector3 = out.origin;\r\n\t\tvar farPoint: Vector3 = Picker._tempVector32;\r\n\r\n\t\tviewPort.unprojectFromWVP(nearSource, projectionMatrix, viewMatrix, world, nearPoint);\r\n\t\tviewPort.unprojectFromWVP(farSource, projectionMatrix, viewMatrix, world, farPoint);\r\n\r\n\t\tvar outDire: Vector3 = out.direction;\r\n\t\toutDire.x = farPoint.x - nearPoint.x;\r\n\t\toutDire.y = farPoint.y - nearPoint.y;\r\n\t\toutDire.z = farPoint.z - nearPoint.z;\r\n\t\tVector3.normalize(out.direction, out.direction);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tray \r\n\t * @param\tvertex1 1\r\n\t * @param\tvertex2 2\r\n\t * @param\tvertex3 3\r\n\t * @return   Number.NaN\r\n\t */\r\n\tstatic rayIntersectsTriangle(ray: Ray, vertex1: Vector3, vertex2: Vector3, vertex3: Vector3): number {\r\n\r\n\t\tvar result: number;\r\n\t\t// Compute vectors along two edges of the triangle.\r\n\t\tvar edge1: Vector3 = Picker._tempVector30, edge2: Vector3 = Picker._tempVector31;\r\n\r\n\t\tVector3.subtract(vertex2, vertex1, edge1);\r\n\t\tVector3.subtract(vertex3, vertex1, edge2);\r\n\r\n\t\t// Compute the determinant.\r\n\t\tvar directionCrossEdge2: Vector3 = Picker._tempVector32;\r\n\t\tVector3.cross(ray.direction, edge2, directionCrossEdge2);\r\n\r\n\t\tvar determinant: number;\r\n\t\tdeterminant = Vector3.dot(edge1, directionCrossEdge2);\r\n\r\n\t\t// If the ray is parallel to the triangle plane, there is no collision.\r\n\t\tif (determinant > -Number.MIN_VALUE && determinant < Number.MIN_VALUE) {\r\n\t\t\tresult = Number.NaN;\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tvar inverseDeterminant: number = 1.0 / determinant;\r\n\r\n\t\t// Calculate the U parameter of the intersection point.\r\n\t\tvar distanceVector: Vector3 = Picker._tempVector33;\r\n\t\tVector3.subtract(ray.origin, vertex1, distanceVector);\r\n\r\n\t\tvar triangleU: number;\r\n\t\ttriangleU = Vector3.dot(distanceVector, directionCrossEdge2);\r\n\t\ttriangleU *= inverseDeterminant;\r\n\r\n\t\t// Make sure it is inside the triangle.\r\n\t\tif (triangleU < 0 || triangleU > 1) {\r\n\t\t\tresult = Number.NaN;\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\t// Calculate the V parameter of the intersection point.\r\n\t\tvar distanceCrossEdge1: Vector3 = Picker._tempVector34;\r\n\t\tVector3.cross(distanceVector, edge1, distanceCrossEdge1);\r\n\r\n\t\tvar triangleV: number;\r\n\t\ttriangleV = Vector3.dot(ray.direction, distanceCrossEdge1);\r\n\t\ttriangleV *= inverseDeterminant;\r\n\r\n\t\t// Make sure it is inside the triangle.\r\n\t\tif (triangleV < 0 || triangleU + triangleV > 1) {\r\n\t\t\tresult = Number.NaN;\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\t// Compute the distance along the ray to the triangle.\r\n\t\tvar rayDistance: number;\r\n\t\trayDistance = Vector3.dot(edge2, distanceCrossEdge1);\r\n\t\trayDistance *= inverseDeterminant;\r\n\r\n\t\t// Is the triangle behind the ray origin?\r\n\t\tif (rayDistance < 0) {\r\n\t\t\tresult = Number.NaN;\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = rayDistance;\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param ray \r\n\t * @param plane \r\n\t * @returns \r\n\t */\r\n\tstatic rayPlaneIntersection(ray: Ray, plane: Plane): Vector3 {\r\n\t\tlet point = new Vector3();\r\n\t\tlet ddotn = Vector3.dot(ray.direction.normalize(), plane.normal.normalize());\r\n\t\tif (ddotn == 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tlet t = (-plane.distance - Vector3.dot(ray.origin, plane.normal)) / ddotn;\r\n\t\tif (t < 0)\r\n\t\t\treturn null;\r\n\t\tray.at(t, point);\r\n\t\treturn point;\r\n\t}\r\n}\r\n\r\n\r\n","import { Node } from \"../../display/Node\";\r\nimport { Sprite3D } from \"./Sprite3D\";\r\nimport { BaseRender } from \"./render/BaseRender\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\n\r\n/**\r\n * @deprecated\r\n * <code>RenderableSprite3D</code> 3D\r\n */\r\nexport class RenderableSprite3D extends Sprite3D {\r\n\t/**,*/\r\n\tstatic SHADERDEFINE_RECEIVE_SHADOW: ShaderDefine;\r\n\t/**,*/\r\n\tstatic SAHDERDEFINE_LIGHTMAP: ShaderDefine;\r\n\t/**, */\r\n\tstatic SHADERDEFINE_LIGHTMAP_DIRECTIONAL: ShaderDefine;\r\n\t/***/\r\n\tstatic LIGHTMAPSCALEOFFSET: number;\r\n\t/***/\r\n\tstatic LIGHTMAP: number;\r\n\t/***/\r\n\tstatic LIGHTMAP_DIRECTION: number;\r\n\t/***/\r\n\tstatic PICKCOLOR: number;\r\n\r\n\r\n\t/**  */\r\n\tstatic REFLECTIONCUBE_PROBEPOSITION: number;\r\n\tstatic REFLECTIONCUBE_PROBEBOXMAX: number;\r\n\tstatic REFLECTIONCUBE_PROBEBOXMIN: number;\r\n\r\n\t/** volumetric GI */\r\n\r\n\tstatic VOLUMETRICGI_PROBECOUNTS: number;\r\n\tstatic VOLUMETRICGI_PROBESTEPS: number;\r\n\tstatic VOLUMETRICGI_PROBESTARTPOS: number;\r\n\tstatic VOLUMETRICGI_PROBEPARAMS: number;\r\n\tstatic VOLUMETRICGI_IRRADIANCE: number;\r\n\tstatic VOLUMETRICGI_DISTANCE: number;\r\n\r\n\t/** @internal */\r\n\tstatic IBLTEX: number;\r\n\t/** @internal */\r\n\tstatic IBLROUGHNESSLEVEL: number;\r\n\t/** @internal */\r\n\tstatic AMBIENTSH: number;\r\n\t/** @internal */\r\n\tstatic AMBIENTCOLOR: number;\r\n\t/** @internal */\r\n\tstatic AMBIENTINTENSITY: number;\r\n\t/** @internal */\r\n\tstatic REFLECTIONINTENSITY: number;\r\n\r\n\t/// Morph target\r\n\r\n\tstatic SHADERDEFINE_MORPHTARGET: ShaderDefine;\r\n\tstatic SHADERDEFINE_MORPHTARGET_POSITION: ShaderDefine;\r\n\tstatic SHADERDEFINE_MORPHTARGET_NORMAL: ShaderDefine;\r\n\tstatic SHADERDEFINE_MORPHTARGET_TANGENT: ShaderDefine;\r\n\r\n\t/** @internal */\r\n\tstatic MorphTex: number;\r\n\t/** @internal */\r\n\tstatic MorphParams: number;\r\n\t/** @internal */\r\n\tstatic MorphAttriOffset: number;\r\n\t/** @internal */\r\n\tstatic MorphActiceTargets: number;\r\n\t/** @internal */\r\n\tstatic MorphActiveWeights: number;\r\n\t/** @internal */\r\n\tstatic MorphActiveCount: number;\r\n\r\n\t//--------------------------------------------------------deprecated------------------------------------------------------------------------\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tstatic AMBIENTSHAR: number;\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tstatic AMBIENTSHAG: number;\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tstatic AMBIENTSHAB: number;\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tstatic AMBIENTSHBR: number;\r\n\t/**\r\n\t* @deprecated\r\n\t* @internal\r\n\t*/\r\n\tstatic AMBIENTSHBG: number;\r\n\t/**\r\n\t* @deprecated\r\n\t* @internal\r\n\t*/\r\n\tstatic AMBIENTSHBB: number;\r\n\t/**\r\n\t* @deprecated\r\n\t* @internal\r\n\t*/\r\n\tstatic AMBIENTSHC: number;\r\n\t/**\r\n\t * @deprecated\r\n\t *   \r\n\t */\r\n\tstatic REFLECTIONTEXTURE: number;\r\n\t/**\r\n\t * @deprecated\r\n\t *   \r\n\t */\r\n\tstatic REFLECTIONCUBE_HDR_PARAMS: number;\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tRenderableSprite3D.SHADERDEFINE_RECEIVE_SHADOW = Shader3D.getDefineByName(\"RECEIVESHADOW\");\r\n\t\tRenderableSprite3D.SAHDERDEFINE_LIGHTMAP = Shader3D.getDefineByName(\"LIGHTMAP\");\r\n\t\tRenderableSprite3D.SHADERDEFINE_LIGHTMAP_DIRECTIONAL = Shader3D.getDefineByName(\"LIGHTMAP_DIRECTIONAL\");\r\n\r\n\t\tRenderableSprite3D.LIGHTMAPSCALEOFFSET = Shader3D.propertyNameToID(\"u_LightmapScaleOffset\");\r\n\t\tRenderableSprite3D.LIGHTMAP = Shader3D.propertyNameToID(\"u_LightMap\");\r\n\t\tRenderableSprite3D.LIGHTMAP_DIRECTION = Shader3D.propertyNameToID(\"u_LightMapDirection\");\r\n\t\tRenderableSprite3D.PICKCOLOR = Shader3D.propertyNameToID(\"u_PickColor\");\r\n\r\n\t\tRenderableSprite3D.REFLECTIONCUBE_PROBEPOSITION = Shader3D.propertyNameToID(\"u_SpecCubeProbePosition\");\r\n\t\tRenderableSprite3D.REFLECTIONCUBE_PROBEBOXMAX = Shader3D.propertyNameToID(\"u_SpecCubeBoxMax\");\r\n\t\tRenderableSprite3D.REFLECTIONCUBE_PROBEBOXMIN = Shader3D.propertyNameToID(\"u_SpecCubeBoxMin\");\r\n\r\n\t\t// volumestric GI\r\n\t\tRenderableSprite3D.VOLUMETRICGI_PROBECOUNTS = Shader3D.propertyNameToID(\"u_VolumetricGI.probeCounts\");\r\n\t\tRenderableSprite3D.VOLUMETRICGI_PROBESTEPS = Shader3D.propertyNameToID(\"u_VolumetricGI.probeStep\");\r\n\t\tRenderableSprite3D.VOLUMETRICGI_PROBESTARTPOS = Shader3D.propertyNameToID(\"u_VolumetricGI.probeStartPosition\");\r\n\t\tRenderableSprite3D.VOLUMETRICGI_PROBEPARAMS = Shader3D.propertyNameToID(\"u_VolumetricGI.probeParams\");\r\n\t\tRenderableSprite3D.VOLUMETRICGI_IRRADIANCE = Shader3D.propertyNameToID(\"u_ProbeIrradiance\");\r\n\t\tRenderableSprite3D.VOLUMETRICGI_DISTANCE = Shader3D.propertyNameToID(\"u_ProbeDistance\");\r\n\r\n\t\t//ambient Color\r\n\t\tRenderableSprite3D.AMBIENTCOLOR = Shader3D.propertyNameToID(\"u_AmbientColor\");\r\n\t\t// sh \r\n\t\tRenderableSprite3D.AMBIENTSH = Shader3D.propertyNameToID(\"u_IblSH\");\r\n\t\t//GI instance\r\n\t\tRenderableSprite3D.AMBIENTINTENSITY = Shader3D.propertyNameToID(\"u_AmbientIntensity\");\r\n\t\tRenderableSprite3D.REFLECTIONINTENSITY = Shader3D.propertyNameToID(\"u_ReflectionIntensity\");\r\n\t\tRenderableSprite3D.IBLTEX = Shader3D.propertyNameToID(\"u_IBLTex\");\r\n\t\tRenderableSprite3D.IBLROUGHNESSLEVEL = Shader3D.propertyNameToID(\"u_IBLRoughnessLevel\");\r\n\r\n\t\tconst commandUniform = LayaGL.renderOBJCreate.createGlobalUniformMap(\"Sprite3D\");\r\n\r\n\t\t/// morph target\r\n\r\n\t\tRenderableSprite3D.SHADERDEFINE_MORPHTARGET = Shader3D.getDefineByName(\"MORPHTARGETS\");\r\n\t\tRenderableSprite3D.SHADERDEFINE_MORPHTARGET_POSITION = Shader3D.getDefineByName(\"MORPHTARGETS_POSITION\");\r\n\t\tRenderableSprite3D.SHADERDEFINE_MORPHTARGET_NORMAL = Shader3D.getDefineByName(\"MORPHTARGETS_NORMAL\");\r\n\t\tRenderableSprite3D.SHADERDEFINE_MORPHTARGET_TANGENT = Shader3D.getDefineByName(\"MORPHTARGETS_TANGENT\");\r\n\r\n\t\tRenderableSprite3D.MorphTex = Shader3D.propertyNameToID(\"u_MorphTargetsTex\");\r\n\t\tRenderableSprite3D.MorphParams = Shader3D.propertyNameToID(\"u_MorphParams\");\r\n\t\tRenderableSprite3D.MorphAttriOffset = Shader3D.propertyNameToID(\"u_MorphAttrOffset\");\r\n\t\tRenderableSprite3D.MorphActiceTargets = Shader3D.propertyNameToID(\"u_MorphActiveTargets\");\r\n\t\tRenderableSprite3D.MorphActiveWeights = Shader3D.propertyNameToID(\"u_MorphTargetWeights\");\r\n\t\tRenderableSprite3D.MorphActiveCount = Shader3D.propertyNameToID(\"u_MorphTargetActiveCount\");\r\n\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.MorphTex, \"u_MorphTargetsTex\",ShaderDataType.Texture2D);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.MorphParams, \"u_MorphParams\",ShaderDataType.Vector4);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.MorphAttriOffset, \"u_MorphAttrOffset\",ShaderDataType.Vector4);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.MorphActiceTargets, \"u_MorphActiveTargets\",ShaderDataType.Buffer);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.MorphActiveWeights, \"u_MorphTargetWeights\",ShaderDataType.Buffer);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.MorphActiveCount, \"u_MorphTargetActiveCount\",ShaderDataType.Int);\r\n\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.LIGHTMAPSCALEOFFSET, \"u_LightmapScaleOffset\",ShaderDataType.Vector4);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.LIGHTMAP, \"u_LightMap\",ShaderDataType.Texture2D);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.LIGHTMAP_DIRECTION, \"u_LightMapDirection\",ShaderDataType.Texture2D);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.PICKCOLOR, \"u_PickColor\",ShaderDataType.Vector3);\r\n\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.REFLECTIONCUBE_PROBEPOSITION, \"u_SpecCubeProbePosition\",ShaderDataType.Vector3);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.REFLECTIONCUBE_PROBEBOXMAX, \"u_SpecCubeBoxMax\",ShaderDataType.Vector3);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.REFLECTIONCUBE_PROBEBOXMIN, \"u_SpecCubeBoxMin\",ShaderDataType.Vector3);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.IBLTEX, \"u_IBLTex\",ShaderDataType.Texture2D);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.IBLROUGHNESSLEVEL, \"u_IBLRoughnessLevel\",ShaderDataType.Float);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.VOLUMETRICGI_PROBECOUNTS, \"u_VolumetricGI.probeCounts\",ShaderDataType.Vector3);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.VOLUMETRICGI_PROBESTEPS, \"u_VolumetricGI.probeStep\",ShaderDataType.Vector3);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.VOLUMETRICGI_PROBESTARTPOS, \"u_VolumetricGI.probeStartPosition\",ShaderDataType.Vector3);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.VOLUMETRICGI_PROBEPARAMS, \"u_VolumetricGI.probeParams\",ShaderDataType.Vector4);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.VOLUMETRICGI_IRRADIANCE, \"u_ProbeIrradiance\",ShaderDataType.Texture2D);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.VOLUMETRICGI_DISTANCE, \"u_ProbeDistance\",ShaderDataType.Texture2D);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSH, \"u_IblSH\",ShaderDataType.Buffer);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTCOLOR, \"u_AmbientColor\",ShaderDataType.Vector4);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTINTENSITY, \"u_AmbientIntensity\",ShaderDataType.Float);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.REFLECTIONINTENSITY, \"u_ReflectionIntensity\",ShaderDataType.Float);\r\n\r\n\t\t//Legency Reflectexture\r\n\t\tRenderableSprite3D.REFLECTIONTEXTURE = Shader3D.propertyNameToID(\"u_ReflectTexture\");\r\n\t\tRenderableSprite3D.REFLECTIONCUBE_HDR_PARAMS = Shader3D.propertyNameToID(\"u_ReflectCubeHDRParams\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.REFLECTIONTEXTURE, \"u_ReflectTexture\",ShaderDataType.TextureCube);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.REFLECTIONCUBE_HDR_PARAMS, \"u_ReflectCubeHDRParams\",ShaderDataType.Vector4);\r\n\t\t// legacy sh\r\n\t\tRenderableSprite3D.AMBIENTSHAR = Shader3D.propertyNameToID(\"u_AmbientSHAr\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSHAR, \"u_AmbientSHAr\",ShaderDataType.Vector4);\r\n\t\tRenderableSprite3D.AMBIENTSHAG = Shader3D.propertyNameToID(\"u_AmbientSHAg\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSHAG, \"u_AmbientSHAg\",ShaderDataType.Vector4);\r\n\t\tRenderableSprite3D.AMBIENTSHAB = Shader3D.propertyNameToID(\"u_AmbientSHAb\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSHAB, \"u_AmbientSHAb\",ShaderDataType.Vector4);\r\n\t\tRenderableSprite3D.AMBIENTSHBR = Shader3D.propertyNameToID(\"u_AmbientSHBr\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSHBR, \"u_AmbientSHBr\",ShaderDataType.Vector4);\r\n\t\tRenderableSprite3D.AMBIENTSHBG = Shader3D.propertyNameToID(\"u_AmbientSHBg\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSHBG, \"u_AmbientSHBg\",ShaderDataType.Vector4);\r\n\t\tRenderableSprite3D.AMBIENTSHBB = Shader3D.propertyNameToID(\"u_AmbientSHBb\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSHBB, \"u_AmbientSHBb\",ShaderDataType.Vector4);\r\n\t\tRenderableSprite3D.AMBIENTSHC = Shader3D.propertyNameToID(\"u_AmbientSHC\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSHC, \"u_AmbientSHC\",ShaderDataType.Vector4);\r\n\t}\r\n\r\n\t/** @internal */\r\n\t_render: BaseRender;\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t *  <code>RenderableSprite3D</code> \r\n\t */\r\n\tconstructor(name: string) {\r\n\t\tsuper(name);\r\n\t}\r\n\r\n\t/** \r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tprotected _onInActive(): void {\r\n\t\tsuper._onInActive();\r\n\t}\r\n\r\n\t/** \r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tprotected _onActive(): void {\r\n\t\tsuper._onActive();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tprotected _onActiveInScene(): void {\r\n\t\tsuper._onActiveInScene();\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Node {\r\n\t\treturn new Sprite3D(this.name);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_addToInitStaticBatchManager(): void {\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\t_setBelongScene(scene: Node): void {\r\n\t\tsuper._setBelongScene(scene);\r\n\t\t//this._render._setBelongScene(<Scene3D>scene);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\t_setUnBelongScene(): void {\r\n\t\tsuper._setUnBelongScene();\r\n\t}\r\n}\r\n\r\n\r\n","import { Texture2D } from \"../../../resource/Texture2D\";\r\n\r\n/**\r\n * \r\n */\r\nexport class Lightmap {\r\n    static ApplyLightmapEvent:string = \"ApplyLightmap\";\r\n    /**  */\r\n    lightmapColor: Texture2D;\r\n    /**  */\r\n    lightmapDirection: Texture2D;\r\n\r\n    \r\n}","import { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\";\r\n\r\n/**\r\n * \r\n */\r\nexport class MeshSprite3DShaderDeclaration {\r\n\t/**UV0 */\r\n\tstatic SHADERDEFINE_UV0: ShaderDefine;\r\n\t/** */\r\n\tstatic SHADERDEFINE_COLOR: ShaderDefine;\r\n\t/**UV1 */\r\n\tstatic SHADERDEFINE_UV1: ShaderDefine;\r\n\t/** Tangent  */\r\n\tstatic SHADERDEFINE_TANGENT: ShaderDefine;\r\n\t/**instance */\r\n\tstatic SHADERDEFINE_GPU_INSTANCE: ShaderDefine;\r\n\t\r\n}\r\n","import { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { IClone } from \"../../utils/IClone\";\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\";\r\nimport { BoundBox } from \"./BoundBox\";\r\n\r\n/**\r\n * <code>Bounds</code> \r\n */\r\nexport class Bounds implements IClone {\r\n    /**\r\n     * \r\n     * @param\tbox1 1\r\n     * @param\tbox2 2\r\n     * @param\tout \r\n     */\r\n    static merge(box1: Bounds, box2: Bounds, out: Bounds): void {\r\n        Vector3.min(box1.min, box2.min, out.min);\r\n        Vector3.max(box1.max, box2.max, out.max);\r\n        out.min = out.min;\r\n        out.max = out.max;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param box \r\n     * @param point \r\n     * @returns \r\n     */\r\n    static containPoint(box: Bounds, point: Vector3): boolean {\r\n        let max = box.getMax();\r\n        let min = box.getMin();\r\n        if (point.x > max.x || point.x < min.x) return false;\r\n        if (point.y > max.y || point.y < min.y) return false;\r\n        if (point.z > max.z || point.z < min.z) return false;\r\n        return true;\r\n    }\r\n\r\n\r\n    /**@internal */\r\n    static _UPDATE_MIN: number = 0x01;\r\n    /**@internal */\r\n    static _UPDATE_MAX: number = 0x02;\r\n    /**@internal */\r\n    static _UPDATE_CENTER: number = 0x04;\r\n    /**@internal */\r\n    static _UPDATE_EXTENT: number = 0x08;\r\n\r\n    /**@internal\t*/\r\n    _imp: any;\r\n\r\n    get min() {\r\n        return this.getMin();\r\n    }\r\n\r\n    set min(value: Vector3) {\r\n        this.setMin(value);\r\n    }\r\n\r\n    get max() {\r\n        return this.getMax();\r\n    }\r\n\r\n    set max(value: Vector3) {\r\n        this.setMax(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setMin(value: Vector3): void {\r\n        this._imp.setMin(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getMin(): Vector3 {\r\n        return this._imp.getMin();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setMax(value: Vector3): void {\r\n        this._imp.setMax(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getMax(): Vector3 {\r\n        return this._imp.getMax();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setCenter(value: Vector3): void {\r\n        this._imp.setCenter(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getCenter(): Vector3 {\r\n        return this._imp.getCenter();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setExtent(value: Vector3): void {\r\n        this._imp.setExtent(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getExtent(): Vector3 {\r\n        return this._imp.getExtent();\r\n    }\r\n\r\n    /**\r\n     *  <code>Bounds</code> \r\n     * @param\tmin  min \r\n     * @param\tmax  max \r\n     */\r\n    constructor(min?: Vector3, max?: Vector3) {\r\n        this._imp = Laya3DRender.renderOBJCreate.createBounds(min, max);\r\n    }\r\n\r\n    protected _getUpdateFlag(type: number): boolean {\r\n        return this._imp._getUpdateFlag(type);\r\n    }\r\n\r\n\r\n    protected _setUpdateFlag(type: number, value: boolean): void {\r\n        this._imp._setUpdateFlag(type, value);\r\n    }\r\n\r\n\r\n    protected _getCenter(min: Vector3, max: Vector3, out: Vector3): void {\r\n        Vector3.add(min, max, out);\r\n        Vector3.scale(out, 0.5, out);\r\n    }\r\n\r\n\r\n    protected _getExtent(min: Vector3, max: Vector3, out: Vector3): void {\r\n        Vector3.subtract(max, min, out);\r\n        Vector3.scale(out, 0.5, out);\r\n    }\r\n\r\n\r\n    protected _getMin(center: Vector3, extent: Vector3, out: Vector3): void {\r\n        Vector3.subtract(center, extent, out);\r\n    }\r\n\r\n\r\n    protected _getMax(center: Vector3, extent: Vector3, out: Vector3): void {\r\n        Vector3.add(center, extent, out);\r\n    }\r\n\r\n    protected _rotateExtents(extents: Vector3, rotation: Matrix4x4, out: Vector3): void {\r\n        var extentsX: number = extents.x;\r\n        var extentsY: number = extents.y;\r\n        var extentsZ: number = extents.z;\r\n        var matE: Float32Array = rotation.elements;\r\n        out.x = Math.abs(matE[0] * extentsX) + Math.abs(matE[4] * extentsY) + Math.abs(matE[8] * extentsZ);\r\n        out.y = Math.abs(matE[1] * extentsX) + Math.abs(matE[5] * extentsY) + Math.abs(matE[9] * extentsZ);\r\n        out.z = Math.abs(matE[2] * extentsX) + Math.abs(matE[6] * extentsY) + Math.abs(matE[10] * extentsZ);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _tranform(matrix: Matrix4x4, out: Bounds): void {\r\n        this._imp._tranform(matrix, out._imp);\r\n    }\r\n\r\n    getCorners(corners: Vector3[]) {\r\n        this._imp.getCorners(corners);\r\n    }\r\n\r\n    /**\r\n     * TODO\r\n     * @param box \r\n     */\r\n    getBoundBox(box: BoundBox): void {\r\n        this._imp._getBoundBox().cloneTo(box);\r\n    }\r\n\r\n    /**\r\n     * @returns -1 0\r\n     */\r\n    calculateBoundsintersection(bounds: Bounds): number {\r\n        return this._imp.calculateBoundsintersection(bounds._imp);\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {\r\n        this._imp.cloneTo(destObject._imp);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): any {\r\n        var dest: Bounds = new Bounds(new Vector3(), new Vector3());\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n\r\n}\r\n\r\nconst TEMP_VECTOR3_MAX0 = new Vector3();\r\nconst TEMP_VECTOR3_MAX1 = new Vector3();","import { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { BaseRender } from \"../../../core/render/BaseRender\";\r\nimport { Bounds } from \"../../../math/Bounds\";\r\nimport { IVolumeManager } from \"../IVolumeManager\";\r\nimport { Volume } from \"../Volume\";\r\nimport { ReflectionProbe } from \"./ReflectionProbe\";\r\n\r\n/**\r\n *<code>ReflectionProbeManager</code> \r\n */\r\nexport class ReflectionProbeManager implements IVolumeManager {\r\n\r\n    /** @internal  */\r\n    private _reflectionProbes: SingletonList<ReflectionProbe> = new SingletonList<ReflectionProbe>();\r\n    /** @internal  */\r\n    private _sceneReflectionProbe: ReflectionProbe;\r\n    /** @internal */\r\n    _needUpdateAllRender: boolean = false;\r\n\r\n    /**\r\n     * \r\n     */\r\n    constructor() {\r\n        this._sceneReflectionProbe = new ReflectionProbe();\r\n        this._sceneReflectionProbe.boxProjection = false;\r\n        this._sceneReflectionProbe._isScene = true;\r\n    }\r\n\r\n    /**\r\n     * Scene Reflection\r\n     */\r\n    set sceneReflectionProbe(value: ReflectionProbe) {\r\n        this._sceneReflectionProbe = value;\r\n        this._needUpdateAllRender = true;//update Reflection\r\n    }\r\n\r\n    get sceneReflectionProbe(): ReflectionProbe {\r\n        return this._sceneReflectionProbe;\r\n    }\r\n\r\n    /**\r\n     * baseRender\r\n     * @param baseRender \r\n     */\r\n    _updateRenderObject(baseRender: BaseRender): void {\r\n        if (this._reflectionProbes.length == 0) {\r\n            baseRender.probReflection = this._sceneReflectionProbe;\r\n            return;\r\n        }\r\n        var elements: ReflectionProbe[] = this._reflectionProbes.elements;\r\n        var maxOverlap: number = 0;\r\n        var mainProbe: ReflectionProbe;\r\n        var renderBounds: Bounds = baseRender.bounds;\r\n        var overlop;\r\n        for (var i: number = 0, n: number = this._reflectionProbes.length; i < n; i++) {\r\n            var renflectProbe = elements[i];\r\n            if (!mainProbe) {\r\n                overlop = renderBounds.calculateBoundsintersection(renflectProbe.bounds);\r\n                if (overlop < maxOverlap) continue;\r\n            } else {\r\n                if (mainProbe.importance > renflectProbe.importance) continue;//\r\n                overlop = renderBounds.calculateBoundsintersection(renflectProbe.bounds);\r\n                if (overlop < maxOverlap && mainProbe.importance == renflectProbe.importance) continue;\r\n            }\r\n            mainProbe = renflectProbe;\r\n            maxOverlap = overlop;\r\n        }\r\n        if (!mainProbe && this._sceneReflectionProbe)// \r\n            mainProbe = this._sceneReflectionProbe;\r\n        baseRender.probReflection = mainProbe;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param reflectionProbe \r\n     */\r\n    add(volume: ReflectionProbe) {\r\n        this._reflectionProbes.add(volume);\r\n        this._needUpdateAllRender = true;\r\n    }\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param reflectionProbe \r\n     */\r\n    remove(volume: ReflectionProbe) {\r\n        this._reflectionProbes.remove(volume);\r\n        this._needUpdateAllRender = true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    handleMotionlist(motionObjects: SingletonList<BaseRender>): void {\r\n        var elements: BaseRender[] = motionObjects.elements;\r\n        let render: BaseRender;\r\n        for (var i: number = 0, n: number = motionObjects.length; i < n; i++) {\r\n            render = elements[i];\r\n            if (render._surportReflectionProbe && render._reflectionMode == 1) {\r\n                this._updateRenderObject(elements[i]);\r\n            }\r\n        }\r\n        //this.clearMotionObjects();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     * @param \r\n     */\r\n    reCaculateAllRenderObjects(baseRenders: SingletonList<BaseRender>) {\r\n        var elements = baseRenders.elements;\r\n        let render: BaseRender;\r\n        for (var i: number = 0, n: number = baseRenders.length; i < n; i++) {\r\n            render = elements[i];\r\n            if (render._surportReflectionProbe && render._reflectionMode == 1) {\r\n                this._updateRenderObject(render);\r\n            }\r\n            this._needUpdateAllRender = false;\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * destroy\r\n     */\r\n    destroy() {\r\n        for (let index = 0; index < this._reflectionProbes.length; index++) {\r\n            let probe = this._reflectionProbes.elements[index];\r\n            probe.destroy();\r\n        }\r\n        this._reflectionProbes.length = 0;\r\n        this._sceneReflectionProbe.destroy();\r\n        this._sceneReflectionProbe = null;\r\n    }\r\n}\r\n\r\n\r\n","import { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\n\r\nexport class Sprite3DRenderDeclaration{\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_GI_LEGACYIBL: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_GI_IBL: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_IBL_RGBD: ShaderDefine;\r\n    /** */\r\n\tstatic SHADERDEFINE_SPECCUBE_BOX_PROJECTION: ShaderDefine;\r\n\r\n\t/// Volumetric GI\r\n\tstatic SHADERDEFINE_VOLUMETRICGI: ShaderDefine;\r\n\r\n}","import { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { BaseRender } from \"../../../core/render/BaseRender\";\r\nimport { Sprite3DRenderDeclaration } from \"../../../core/render/Sprite3DRenderDeclaration\";\r\nimport { IVolumeManager } from \"../IVolumeManager\";\r\nimport { VolumetricGI } from \"./VolumetricGI\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class VolumetricGIManager implements IVolumeManager {\r\n    _needUpdateAllRender: boolean;\r\n\r\n    private _GIVolumes: SingletonList<VolumetricGI> = new SingletonList<VolumetricGI>();\r\n\r\n    constructor() {\r\n        this._needUpdateAllRender = true;\r\n    }\r\n\r\n    removeVolumetricGI(renderer: BaseRender) {\r\n        let shaderData = renderer._shaderValues;\r\n        shaderData.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_VOLUMETRICGI);\r\n    }\r\n\r\n    add(volume: VolumetricGI): void {\r\n        this._GIVolumes.add(volume);\r\n        this._needUpdateAllRender = true;\r\n    }\r\n\r\n    remove(volume: VolumetricGI): void {\r\n        this._GIVolumes.remove(volume);\r\n        this._needUpdateAllRender = true;\r\n    }\r\n\r\n    _updateRenderObject(renderer: BaseRender): void {\r\n        if (this._GIVolumes.length == 0) {\r\n            this.removeVolumetricGI(renderer);\r\n            return;\r\n        }\r\n\r\n        let renderBounds = renderer.bounds;\r\n        let maxOverlap = 0, overlap = 0;\r\n        let currentVolume: VolumetricGI;\r\n\r\n        let volumes = this._GIVolumes.elements;\r\n        for (let index = 0; index < this._GIVolumes.length; index++) {\r\n            let volume = volumes[index];\r\n            if (!currentVolume) {\r\n                overlap = renderBounds.calculateBoundsintersection(volume.bounds);\r\n                if (overlap < maxOverlap)\r\n                    continue;\r\n            }\r\n            else {\r\n                if (currentVolume.importance > volume.importance)\r\n                    continue;\r\n                overlap = renderBounds.calculateBoundsintersection(volume.bounds);\r\n                if (overlap < maxOverlap && currentVolume.importance == volume.importance)\r\n                    continue;\r\n            }\r\n            currentVolume = volume;\r\n            maxOverlap = overlap;\r\n        }\r\n\r\n        if (currentVolume) {\r\n            currentVolume.applyVolumetricGI(renderer._shaderValues);\r\n        }\r\n        else {\r\n            this.removeVolumetricGI(renderer);\r\n        }\r\n\r\n    }\r\n    handleMotionlist(motionObjects: SingletonList<BaseRender>): void {\r\n        for (let index = 0; index < motionObjects.length; index++) {\r\n            let render = motionObjects.elements[index];\r\n            // todo render  VolumetricGI\r\n            if (true) {\r\n                this._updateRenderObject(render);\r\n            }\r\n        }\r\n        this._needUpdateAllRender = false;\r\n    }\r\n\r\n    reCaculateAllRenderObjects(renders: SingletonList<BaseRender>): void {\r\n        for (let index = 0; index < renders.length; index++) {\r\n            let render = renders.elements[index];\r\n            // todo  VolumetricGI \r\n            if (true) {\r\n                this._updateRenderObject(render);\r\n            }\r\n        }\r\n        this._needUpdateAllRender = false;\r\n    }\r\n\r\n    destroy(): void {\r\n        // throw new Error(\"Method not implemented.\");\r\n    }\r\n}","import { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { IVolumeManager } from \"./IVolumeManager\";\r\nimport { ReflectionProbeManager } from \"./reflectionProbe/ReflectionProbeManager\";\r\nimport { Volume} from \"./Volume\";\r\nimport { VolumetricGIManager } from \"./VolumetricGI/VolumetricGIManager\";\r\n\r\n\r\n\r\n\r\n/**\r\n * <code>VolumeManager</code> \r\n */\r\nexport class VolumeManager implements IVolumeManager {\r\n    static ReflectionProbeVolumeType: number = 1;\r\n\r\n    static VolumetricGIType: number = 2;\r\n\r\n    //Volume\r\n    //static regVolumeManager: { [key: number]: any } = {};\r\n    /** @internal  */\r\n    private _motionObjects: SingletonList<BaseRender> = new SingletonList<BaseRender>();\r\n    /** @internal volume list */\r\n    private _volumeList: SingletonList<Volume> = new SingletonList<Volume>();\r\n\r\n    /** @internal */\r\n    _needUpdateAllRender: boolean = false;\r\n    /** Volume */\r\n    private _regVolumeManager: { [key: number]: IVolumeManager } = {};\r\n\r\n    /**@internal */\r\n    _reflectionProbeManager: ReflectionProbeManager;\r\n\r\n    _volumetricGIManager: VolumetricGIManager;\r\n\r\n    constructor() {\r\n        this._reflectionProbeManager = new ReflectionProbeManager();\r\n        this._regVolumeManager[VolumeManager.ReflectionProbeVolumeType] = this._reflectionProbeManager;\r\n\r\n        this._volumetricGIManager = new VolumetricGIManager();\r\n        this._regVolumeManager[VolumeManager.VolumetricGIType] = this._volumetricGIManager;\r\n\r\n    }\r\n\r\n    /**\r\n     * get reflection manager\r\n     */\r\n    get reflectionProbeManager(): ReflectionProbeManager {\r\n        return this._reflectionProbeManager;\r\n    }\r\n\r\n    get volumetricGIManager(): VolumetricGIManager {\r\n        return this._volumetricGIManager;\r\n    }\r\n\r\n    /**\r\n     * add volume\r\n     * @param volume \r\n     */\r\n    add(volume: Volume) {\r\n        let reManager = this._regVolumeManager[volume.type];\r\n        if (reManager) {\r\n            reManager.add(volume);\r\n        } else {\r\n            this._volumeList.add(volume);\r\n            this._needUpdateAllRender = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * remove volume\r\n     * @param volume \r\n     */\r\n    remove(volume: Volume) {\r\n        let reManager = this._regVolumeManager[volume.type];\r\n        if (reManager) {\r\n            reManager.remove(volume);\r\n        } else {\r\n            this._volumeList.remove(volume);\r\n            this._needUpdateAllRender = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * add motion obj to handle list\r\n     * @param renderObj \r\n     */\r\n    addMotionObject(renderObj: BaseRender) {\r\n        this._motionObjects.add(renderObj);\r\n    }\r\n\r\n    removeMotionObject(renderObj: BaseRender) {\r\n        this._motionObjects.remove(renderObj);\r\n    }\r\n\r\n    /**\r\n     * update one RenderNode Volume info\r\n     * @param baseRender \r\n     */\r\n    _updateRenderObject(baseRender: BaseRender): void {\r\n        let elements: Volume[] = this._volumeList.elements;\r\n\r\n        let renderBounds: Bounds = baseRender.bounds;\r\n        let center = renderBounds.getCenter();\r\n        let mainVolume: Volume;\r\n        for (var i: number = 0, n: number = this._volumeList.length; i < n; i++) {\r\n            let volume = elements[i];\r\n            let bounds = volume.bounds;\r\n            if (Bounds.containPoint(bounds, center)) {\r\n                mainVolume = volume;\r\n                continue;\r\n            }\r\n        }\r\n        baseRender.volume = mainVolume;\r\n    }\r\n    /**\r\n     * @internal\r\n     * handle motion list\r\n     */\r\n    handleMotionlist(): void {\r\n        var elements: BaseRender[] = this._motionObjects.elements;\r\n        for (var i: number = 0, n: number = this._motionObjects.length; i < n; i++) {\r\n            this._updateRenderObject(elements[i]);\r\n        }\r\n        //minerTODO \r\n        this.reflectionProbeManager.handleMotionlist(this._motionObjects);\r\n\r\n        this.volumetricGIManager.handleMotionlist(this._motionObjects);\r\n\r\n        this.clearMotionObjects();\r\n    }\r\n\r\n    /**\r\n     * Volume\r\n     */\r\n    reCaculateAllRenderObjects(baseRenders: SingletonList<BaseRender>) {\r\n        if (this._needUpdateAllRender) {\r\n            var elements = baseRenders.elements;\r\n            for (var i: number = 0, n: number = baseRenders.length; i < n; i++) {\r\n                this._updateRenderObject(elements[i]);\r\n            }\r\n            this._needUpdateAllRender = false;\r\n        } else {\r\n            this.handleMotionlist();\r\n        }\r\n\r\n        //minerTODO \r\n        if (this.reflectionProbeManager._needUpdateAllRender) {\r\n            this.reflectionProbeManager.reCaculateAllRenderObjects(baseRenders);\r\n        } else {\r\n            this.reflectionProbeManager.handleMotionlist(this._motionObjects);\r\n        }\r\n\r\n        if (this.volumetricGIManager._needUpdateAllRender) {\r\n            this.volumetricGIManager.reCaculateAllRenderObjects(baseRenders);\r\n        }\r\n        else {\r\n            this.volumetricGIManager.handleMotionlist(this._motionObjects);\r\n        }\r\n\r\n    }\r\n\r\n    needreCaculateAllRenderObjects(): boolean {\r\n        return this._needUpdateAllRender || this.reflectionProbeManager._needUpdateAllRender || this.volumetricGIManager._needUpdateAllRender;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    clearMotionObjects() {\r\n        this._motionObjects.length = 0;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * destroy\r\n     */\r\n    destroy() {\r\n\r\n    }\r\n}","\r\nimport { Color } from \"../../maths/Color\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { TextureCubeFace } from \"../../resource/TextureCube\";\r\n\r\n/**\r\n * \r\n */\r\nexport class SphericalHarmonicsL2 {\r\n    /** @internal */\r\n    static _default: SphericalHarmonicsL2 = new SphericalHarmonicsL2();\r\n\r\n    /** @internal */\r\n    private _coefficients: Float32Array = new Float32Array(27);\r\n\r\n    /**\r\n     * \r\n     * @param i 02\r\n     * @param j 08\r\n     */\r\n    getCoefficient(i: number, j: number): number {\r\n        return this._coefficients[i * 9 + j];\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param i 02\r\n     * @param j 08\r\n     */\r\n    setCoefficient(i: number, j: number, coefficient: number): void {\r\n        this._coefficients[i * 9 + j] = coefficient;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param i 02\r\n     * @param coefficient0 0\r\n     * @param coefficient1 1\r\n     * @param coefficient2 2\r\n     * @param coefficient3 3\r\n     * @param coefficient4 4\r\n     * @param coefficient5 5\r\n     * @param coefficient6 6\r\n     * @param coefficient7 7\r\n     * @param coefficient8 8\r\n     */\r\n    setCoefficients(i: number, coefficient0: number, coefficient1: number, coefficient2: number, coefficient3: number, coefficient4: number, coefficient5: number, coefficient6: number, coefficient7: number, coefficient8: number): void {\r\n        var offset: number = i * 9;\r\n        this._coefficients[offset] = coefficient0;\r\n        this._coefficients[++offset] = coefficient1;\r\n        this._coefficients[++offset] = coefficient2;\r\n        this._coefficients[++offset] = coefficient3;\r\n        this._coefficients[++offset] = coefficient4;\r\n        this._coefficients[++offset] = coefficient5;\r\n        this._coefficients[++offset] = coefficient6;\r\n        this._coefficients[++offset] = coefficient7;\r\n        this._coefficients[++offset] = coefficient8;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param dest \r\n     */\r\n    cloneTo(dest: SphericalHarmonicsL2): void {\r\n        if (this === dest)\r\n            return;\r\n        var coes: Float32Array = this._coefficients;\r\n        var destCoes: Float32Array = dest._coefficients;\r\n        for (var i: number = 0; i < 27; i++)\r\n            destCoes[i] = coes[i];\r\n    }\r\n}\r\n\r\n/**\r\n * @internal\r\n * \r\n */\r\nexport class SphericalHarmonicsL2Generater {\r\n\r\n    private static _tempSHR: Float32Array = new Float32Array(9);\r\n    private static _tempSHG: Float32Array = new Float32Array(9);\r\n    private static _tempSHB: Float32Array = new Float32Array(9);\r\n\r\n    /**\r\n     * k0: 1/2  * sqrt(1/Pi)\r\n     * k1: 1/3  * sqrt(3/Pi)\r\n     * k2: 1/8  * sqrt(15/Pi)\r\n     * k3: 1/16 * sqrt(5/Pi)\r\n     * k4: 1/16 * sqrt(15/Pi)\r\n     * [\r\n     *  k0,\r\n     * -k1, k1, k1\r\n     * k2, -k2, k3, -k2, k4\r\n     * ]\r\n     */\r\n    private static readonly k = [\r\n        0.28209479177387814347,\r\n        -0.32573500793527994772, 0.32573500793527994772, -0.32573500793527994772,\r\n        0.27313710764801976764, -0.27313710764801976764, 0.07884789131313000151, -0.27313710764801976764, 0.13656855382400988382\r\n    ]\r\n\r\n    /** @internal */\r\n    static readonly GradientSimulateSize: number = 3;\r\n    /** @internal */\r\n    static readonly SH_Count: number = 9;\r\n\r\n    private static _tempSkyPixels: Float32Array = new Float32Array(SphericalHarmonicsL2Generater.GradientSimulateSize * SphericalHarmonicsL2Generater.GradientSimulateSize * 3);\r\n    private static _tempEquatorPixels: Float32Array = new Float32Array(SphericalHarmonicsL2Generater.GradientSimulateSize * SphericalHarmonicsL2Generater.GradientSimulateSize * 3);\r\n    private static _tempGroundPixels: Float32Array = new Float32Array(SphericalHarmonicsL2Generater.GradientSimulateSize * SphericalHarmonicsL2Generater.GradientSimulateSize * 3);\r\n    /**\r\n     * @internal\r\n     * uv   \r\n     * @param u \r\n     * @param v \r\n     */\r\n    static surfaceArea(u: number, v: number) {\r\n        return Math.atan2(u * v, Math.sqrt(u * u + v * v + 1.0));\r\n    }\r\n\r\n    /**\r\n     * uv  () \r\n     * @param u \r\n     * @param v \r\n     * @param face \r\n     * @param out_dir \r\n     */\r\n    static uv2Dir(u: number, v: number, face: TextureCubeFace, out_dir: Vector3) {\r\n        switch (face) {\r\n            case TextureCubeFace.PositiveX:\r\n                out_dir.x = 1.0;\r\n                out_dir.y = -v;\r\n                out_dir.z = -u;\r\n                break;\r\n            case TextureCubeFace.NegativeX:\r\n                out_dir.x = -1.0;\r\n                out_dir.y = -v;\r\n                out_dir.z = u;\r\n                break;\r\n            case TextureCubeFace.PositiveY:\r\n                out_dir.x = u;\r\n                out_dir.y = 1.0;\r\n                out_dir.z = v;\r\n                break;\r\n            case TextureCubeFace.NegativeY:\r\n                out_dir.x = u;\r\n                out_dir.y = -1.0;\r\n                out_dir.z = -v;\r\n                break;\r\n            case TextureCubeFace.PositiveZ:\r\n                out_dir.x = u;\r\n                out_dir.y = -v;\r\n                out_dir.z = 1.0;\r\n                break;\r\n            case TextureCubeFace.NegativeZ:\r\n                out_dir.x = -u;\r\n                out_dir.y = -v;\r\n                out_dir.z = -1.0;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     *  \r\n     * @param i \r\n     * @param x \r\n     * @param y \r\n     * @param z \r\n     * @returns \r\n     */\r\n    static sh_eval_9(i: number, x: number, y: number, z: number) {\r\n        const sqrt = Math.sqrt;\r\n        const M_PI = Math.PI;\r\n        switch (i) {\r\n            case 0:\r\n                return 0.5 * sqrt(1.0 / M_PI);\r\n            case 1:\r\n                return -y * 0.5 * sqrt(3.0 / M_PI);\r\n            case 2:\r\n                return z * 0.5 * sqrt(3.0 / M_PI);\r\n            case 3:\r\n                return -x * 0.5 * sqrt(3.0 / M_PI);\r\n            case 4:\r\n                return x * y * 0.5 * sqrt(15.0 / M_PI);\r\n            case 5:\r\n                return -y * z * 0.5 * sqrt(15.0 / M_PI);\r\n            case 6:\r\n                return (3.0 * z * z - 1.0) * 0.25 * sqrt(5.0 / M_PI);\r\n            case 7:\r\n                return -x * z * 0.5 * sqrt(15.0 / M_PI);\r\n            case 8:\r\n                return (x * x - y * y) * 0.25 * sqrt(15.0 / M_PI);\r\n            default:\r\n                return 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     *  cubemap  \r\n     * @param cubemapPixels cubemap \r\n     * @param pixelComponentSize  (RGB 3, RGBA 4)\r\n     * @param cubemapSize cubemap \r\n     * @param isGamma \r\n     */\r\n    static CalCubemapSH(cubemapPixels: Float32Array[], pixelComponentSize: number, cubemapSize: number, isGamma: boolean = true): SphericalHarmonicsL2 {\r\n\r\n        let width = cubemapSize;\r\n        let height = cubemapSize;\r\n\r\n        let shr = this._tempSHR.fill(0);\r\n        let shg = this._tempSHG.fill(0);\r\n        let shb = this._tempSHB.fill(0);\r\n\r\n        let dir = new Vector3();\r\n        for (let face = 0; face < 6; face++) {\r\n\r\n            let facePixels = cubemapPixels[face];\r\n\r\n            for (let y = 0; y < height; y++) {\r\n                for (let x = 0; x < width; x++) {\r\n\r\n                    let px = x + 0.5;\r\n                    let py = y + 0.5;\r\n\r\n                    let u = 2.0 * (px / width) - 1.0;\r\n                    let v = 2.0 * (py / height) - 1.0;\r\n\r\n                    let dx = 1.0 / width;\r\n                    let dy = 1.0 / height;\r\n                    // 4 uv \r\n                    let x0 = u - dx;\r\n                    let y0 = v - dy;\r\n                    let x1 = u + dx;\r\n                    let y1 = v + dy;\r\n\r\n                    // \r\n                    let da = this.surfaceArea(x0, y0) - this.surfaceArea(x0, y1) - this.surfaceArea(x1, y0) + this.surfaceArea(x1, y1);\r\n\r\n                    this.uv2Dir(u, v, face, dir);\r\n                    Vector3.normalize(dir, dir);\r\n\r\n                    let pixelOffset = (x + y * width) * pixelComponentSize;\r\n                    let r = facePixels[pixelOffset];\r\n                    let g = facePixels[pixelOffset + 1];\r\n                    let b = facePixels[pixelOffset + 2];\r\n                    if (isGamma) {\r\n                        r = Color.gammaToLinearSpace(r);\r\n                        g = Color.gammaToLinearSpace(g);\r\n                        b = Color.gammaToLinearSpace(b);\r\n                    }\r\n\r\n                    for (let s = 0; s < this.SH_Count; s++) {\r\n                        let sh_val = this.sh_eval_9(s, dir.x, dir.y, dir.z);\r\n                        shr[s] += r * sh_val * da;\r\n                        shg[s] += g * sh_val * da;\r\n                        shb[s] += b * sh_val * da;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        let sh = new SphericalHarmonicsL2();\r\n\r\n        for (let index = 0; index < this.SH_Count; index++) {\r\n            let scale = this.k[index];\r\n\r\n            let r = shr[index];\r\n            sh.setCoefficient(0, index, r * scale);\r\n\r\n            let g = shg[index];\r\n            sh.setCoefficient(1, index, g * scale);\r\n\r\n            let b = shb[index];\r\n            sh.setCoefficient(2, index, b * scale);\r\n        }\r\n\r\n        return sh;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     *  , , \r\n     * @param skyColor \r\n     * @param equatorColor \r\n     * @param groundColor \r\n     * @param isGamma \r\n     */\r\n    static CalGradientSH(skyColor: Vector3, equatorColor: Vector3, groundColor: Vector3, isGamma: boolean = true): SphericalHarmonicsL2 {\r\n\r\n        console.time(\"Gradient SH\");\r\n\r\n        let skyPixels = this._tempSkyPixels;\r\n        let equatorPixels = this._tempEquatorPixels;\r\n        let groundPixels = this._tempGroundPixels;\r\n\r\n        const fillPixelBuffer = (float32: Float32Array, color: Vector3, isGamma: boolean) => {\r\n            let fillColor = new Color(color.x, color.y, color.z, 1.0);\r\n            if (isGamma) {\r\n                fillColor.toLinear(fillColor);\r\n            }\r\n            let r = Math.min(fillColor.r, 1.0);\r\n            let g = Math.min(fillColor.g, 1.0);\r\n            let b = Math.min(fillColor.b, 1.0);\r\n            for (let index = 0; index < float32.length; index += 3) {\r\n                float32[index] = r;\r\n                float32[index + 1] = g;\r\n                float32[index + 2] = b;\r\n            }\r\n        }\r\n\r\n        fillPixelBuffer(skyPixels, skyColor, isGamma);\r\n        fillPixelBuffer(equatorPixels, equatorColor, isGamma);\r\n        fillPixelBuffer(groundPixels, groundColor, isGamma);\r\n\r\n        let gradientPixles = [];\r\n        gradientPixles[TextureCubeFace.PositiveY] = skyPixels;\r\n        gradientPixles[TextureCubeFace.NegativeY] = groundPixels;\r\n        gradientPixles[TextureCubeFace.PositiveX] = equatorPixels;\r\n        gradientPixles[TextureCubeFace.NegativeX] = equatorPixels;\r\n        gradientPixles[TextureCubeFace.PositiveZ] = equatorPixels;\r\n        gradientPixles[TextureCubeFace.NegativeZ] = equatorPixels;\r\n\r\n        let sh = SphericalHarmonicsL2Generater.CalCubemapSH(gradientPixles, 3, this.GradientSimulateSize, false);\r\n\r\n        console.timeEnd(\"Gradient SH\");\r\n        return sh;\r\n    }\r\n}","import { BaseRender } from \"./BaseRender\"\r\nimport { RenderContext3D } from \"./RenderContext3D\"\r\nimport { Camera } from \"../Camera\"\r\nimport { GeometryElement } from \"../GeometryElement\"\r\nimport { Transform3D } from \"../Transform3D\"\r\nimport { Material } from \"../../../resource/Material\"\r\nimport { IRenderElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderElement\"\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\"\r\nimport { DefineDatas } from \"../../../RenderEngine/RenderShader/DefineDatas\"\r\nimport { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\"\r\nimport { ILaya3D } from \"../../../../ILaya3D\"\r\nimport { ShaderInstance } from \"../../../RenderEngine/RenderShader/ShaderInstance\"\r\nimport { ShaderPass } from \"../../../RenderEngine/RenderShader/ShaderPass\"\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\"\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\"\r\n\r\n/**\r\n * <code>RenderElement</code> \r\n */\r\nexport class RenderElement {\r\n    /** @internal */\r\n    static RENDERTYPE_NORMAL: number = 0;\r\n    /** @internal */\r\n    static RENDERTYPE_STATICBATCH: number = 1;\r\n    /** @internal */\r\n    static RENDERTYPE_INSTANCEBATCH: number = 2;\r\n    /** @internal */\r\n    static RENDERTYPE_VERTEXBATCH: number = 3;\r\n\r\n    /** @internal */\r\n    static _compileDefine: DefineDatas = new DefineDatas();\r\n\r\n    /**\r\n     * \r\n     */\r\n    _renderElementOBJ: IRenderElement;\r\n    /** @internal */\r\n    _geometry: GeometryElement;\r\n    /**@internal */\r\n    _canBatch: boolean = false;\r\n    /** @internal */\r\n    _material: Material;//\r\n    /** @internal */\r\n    _baseRender: BaseRender;\r\n    /**@internal */\r\n    _subShader: SubShader;\r\n    /**@internal */\r\n    _subShaderIndex: number = 0;\r\n    _batchElement: RenderElement;\r\n    _transform: Transform3D;\r\n\r\n    /** @internal */\r\n    set transform(value: Transform3D) {\r\n        this._transform = value;\r\n        this._renderElementOBJ._transform = value;\r\n    }\r\n\r\n    /**@internal */\r\n    get transform(): Transform3D {\r\n        return this._renderElementOBJ._transform;\r\n    }\r\n\r\n    /**\r\n     * set RenderElement Material/Shaderdata\r\n     */\r\n    set material(value: Material) {\r\n        // todo debug \r\n        if (value) {\r\n            this._material = value;\r\n            this._renderElementOBJ._materialShaderData = value.shaderData;\r\n        }\r\n    }\r\n\r\n    /**@internal */\r\n    get material(): Material {\r\n        return this._material;\r\n    }\r\n\r\n    /**\r\n     *  SubShader\r\n     */\r\n    set renderSubShader(value: SubShader) {\r\n        this._subShader = value;\r\n    }\r\n\r\n    get renderSubShader(): SubShader {\r\n        return this._subShader;\r\n    }\r\n\r\n    set subShaderIndex(value: number) {\r\n        this._subShaderIndex = value;\r\n    }\r\n\r\n    get subShaderIndex() {\r\n        return this._subShaderIndex;\r\n    }\r\n    /**@internal */\r\n    set render(value: BaseRender) {\r\n        this._baseRender = value;\r\n        this._renderElementOBJ._renderShaderData = value._shaderValues;\r\n    }\r\n\r\n    get render(): BaseRender {\r\n        return this._baseRender;\r\n    }\r\n\r\n\r\n\r\n    /** @internal */\r\n    staticBatch: GeometryElement;\r\n    /** @internal */\r\n    renderType: number = RenderElement.RENDERTYPE_NORMAL;\r\n    /**\r\n     *  <code>RenderElement</code> \r\n     */\r\n    constructor() {\r\n        this._createRenderElementOBJ();\r\n    }\r\n\r\n    protected _createRenderElementOBJ() {\r\n        this._renderElementOBJ = Laya3DRender.renderOBJCreate.createRenderElement();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    getInvertFront(): boolean {\r\n        return this.transform ? this.transform._isFrontFaceInvert : false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    setTransform(transform: Transform3D): void {\r\n        this.transform = transform;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    setGeometry(geometry: GeometryElement): void {\r\n        this._geometry = geometry;\r\n        this._renderElementOBJ._geometry = geometry._geometryElementOBj;\r\n    }\r\n\r\n    /**\r\n     * shader\r\n     * @param context \r\n     */\r\n    compileShader(context: IRenderContext3D) {\r\n        var passes: ShaderPass[] = this._subShader._passes;\r\n        this._renderElementOBJ._clearShaderInstance();\r\n        for (var j: number = 0, m: number = passes.length; j < m; j++) {\r\n            var pass: ShaderPass = passes[j];\r\n            //NOTE:this will cause maybe a shader not render but do prepare beforebut the developer can avoide this manual,for example shaderCaster=false.\r\n            if (pass._pipelineMode !== context.pipelineMode)\r\n                continue;\r\n\r\n            var comDef: DefineDatas = RenderElement._compileDefine;\r\n\r\n            // context.configShaderData._defineDatas.cloneTo(comDef);\r\n\r\n            if (context.sceneShaderData) {\r\n                context.sceneShaderData._defineDatas.cloneTo(comDef);\r\n            } else {\r\n                Shader3D._configDefineValues.cloneTo(comDef);\r\n            }\r\n\r\n            comDef.addDefineDatas(context.configShaderData._defineDatas);\r\n\r\n            context.cameraShaderData && comDef.addDefineDatas(context.cameraShaderData._defineDatas);\r\n            if (this.render) {\r\n                comDef.addDefineDatas(this.render._shaderValues._defineDatas);\r\n                pass.nodeCommonMap = this.render._commonUniformMap;\r\n            } else {\r\n                pass.nodeCommonMap = null;\r\n            }\r\n\r\n            comDef.addDefineDatas(this._renderElementOBJ._materialShaderData._defineDatas);\r\n            var shaderIns: ShaderInstance = pass.withCompile(comDef);\r\n            this._renderElementOBJ._addShaderInstance(shaderIns);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Shader\r\n     * @param customShader \r\n     * @param replacementTag \r\n     * @param subshaderIndex \r\n     * @returns \r\n     */\r\n    _convertSubShader(customShader: Shader3D, replacementTag: string, subshaderIndex: number = 0) {\r\n        var subShader: SubShader = this.material._shader.getSubShaderAt(this._subShaderIndex);//TODO:\r\n        this.renderSubShader = null;\r\n        if (customShader) {\r\n            if (replacementTag) {\r\n                var oriTag: string = subShader.getFlag(replacementTag);\r\n                if (oriTag) {\r\n                    var customSubShaders: SubShader[] = customShader._subShaders;\r\n                    for (var k: number = 0, p: number = customSubShaders.length; k < p; k++) {\r\n                        var customSubShader: SubShader = customSubShaders[k];\r\n                        if (oriTag === customSubShader.getFlag(replacementTag)) {\r\n                            this.renderSubShader = customSubShader;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (!this.renderSubShader)\r\n                        return;\r\n                } else {\r\n                    return;\r\n                }\r\n            } else {\r\n                this.renderSubShader = customShader.getSubShaderAt(subshaderIndex);//TODO:\r\n            }\r\n        } else {\r\n            this.renderSubShader = subShader;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _update(scene: any, context: RenderContext3D, customShader: Shader3D, replacementTag: string, subshaderIndex: number = 0): void {\r\n        if (this.material) {//\r\n            this._convertSubShader(customShader, replacementTag, subshaderIndex);\r\n            if (!this.renderSubShader)\r\n                return;\r\n            var renderQueue = scene._getRenderQueue(this.material.renderQueue);\r\n            if (renderQueue._isTransparent)\r\n                renderQueue.addRenderElement(this);\r\n            else\r\n                renderQueue.addRenderElement(this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * pre update data\r\n     * @param context \r\n     */\r\n    _renderUpdatePre(context: RenderContext3D) {\r\n        var sceneMark: number = ILaya3D.Scene3D._updateMark;\r\n        var transform: Transform3D = this.transform;\r\n        context.renderElement = this;\r\n        //model local\r\n        var modelDataRender: boolean = (!!this._baseRender) ? (sceneMark !== this._baseRender._sceneUpdateMark || this.renderType !== this._baseRender._updateRenderType) : false;\r\n        if (modelDataRender) {\r\n            this._baseRender._renderUpdate(context, transform);\r\n            this._baseRender._sceneUpdateMark = sceneMark;\r\n        }\r\n        //camera\r\n        var updateMark: number = Camera._updateMark;\r\n        var updateRender: boolean = (!!this._baseRender) ? (updateMark !== this._baseRender._updateMark || this.renderType !== this._baseRender._updateRenderType) : false;\r\n        if (updateRender) {//\r\n            this._baseRender._renderUpdateWithCamera(context, transform);\r\n            this._baseRender._updateMark = updateMark;\r\n            this._baseRender._updateRenderType = this.renderType;\r\n        }\r\n\r\n        const subUbo = (!!this._baseRender) ? this._baseRender._subUniformBufferData : false;\r\n        if (subUbo) {\r\n            subUbo._needUpdate && BaseRender._transLargeUbO.updateSubData(subUbo);\r\n        }\r\n        //context.shader = this._renderElementOBJ._subShader;\r\n        this._renderElementOBJ._isRender = this._geometry._prepareRender(context);\r\n        this._geometry._updateRenderParams(context);\r\n        this.compileShader(context._contextOBJ);\r\n        this._renderElementOBJ._invertFront = this.getInvertFront();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _render(context: IRenderContext3D): void {\r\n        this._renderElementOBJ._render(context);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    destroy(): void {\r\n        this._renderElementOBJ._destroy();\r\n        this._renderElementOBJ = null;\r\n        this._geometry = null;\r\n        this._baseRender = null;\r\n        this._material = null\r\n        this._baseRender = null;\r\n        this._subShader = null;\r\n    }\r\n}\r\n\r\n","import { RenderContext3D } from \"./render/RenderContext3D\"\r\nimport { IRenderGeometryElement } from \"../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderGeometryElement\";\r\nimport { MeshTopology } from \"../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { IndexFormat } from \"../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { DrawType } from \"../../RenderEngine/RenderEnum/DrawType\";\r\nimport { BufferState } from \"../../webgl/utils/BufferState\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * <code>GeometryElement</code> ,\r\n */\r\nexport class GeometryElement {\r\n\t/** @internal */\r\n\tprivate static _uniqueIDCounter: number = 0;\r\n\tprotected _owner: any;\r\n\tstatic _typeCounter: number = 0;\r\n\t/**@internal */\r\n\tprotected _destroyed: boolean;\r\n\t_geometryElementOBj: IRenderGeometryElement;\r\n\t/** @internal */\r\n\t_id: number;\r\n\t/**\r\n\t * VAO OBJ\r\n\t */\r\n\tset bufferState(value: BufferState) {\r\n\t\tthis._geometryElementOBj.bufferState = value;\r\n\t}\r\n\r\n\tget bufferState(): BufferState {\r\n\t\treturn this._geometryElementOBj.bufferState;\r\n\t}\r\n\r\n\t/**\r\n\t * mesh topology type\r\n\t */\r\n\tset mode(value: MeshTopology) {\r\n\t\tthis._geometryElementOBj.mode = value;\r\n\t}\r\n\r\n\tget mode(): MeshTopology {\r\n\t\treturn this._geometryElementOBj.mode;\r\n\t}\r\n\r\n\t/**\r\n\t * draw Type\r\n\t */\r\n\tset drawType(value: number) {\r\n\t\tthis._geometryElementOBj.drawType = value;\r\n\t}\r\n\r\n\tget drawType(): number {\r\n\t\treturn this._geometryElementOBj.drawType;\r\n\t}\r\n\r\n\tsetDrawArrayParams(first: number, count: number): void {\r\n\t\tthis._geometryElementOBj.setDrawArrayParams(first, count);\r\n\r\n\t}\r\n\r\n\tsetDrawElemenParams(count: number, offset: number): void {\r\n\t\tthis._geometryElementOBj.setDrawElemenParams(count, offset);\r\n\t}\r\n\r\n\tset instanceCount(value: number) {\r\n\t\tthis._geometryElementOBj.instanceCount = value;\r\n\t}\r\n\r\n\tget instanceCount(): number {\r\n\t\treturn this._geometryElementOBj.instanceCount;\r\n\t}\r\n\r\n\tset indexFormat(value: IndexFormat) {\r\n\t\tthis._geometryElementOBj.indexFormat = value;\r\n\t}\r\n\r\n\tget indexFormat(): IndexFormat {\r\n\t\treturn this._geometryElementOBj.indexFormat;\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget destroyed(): boolean {\r\n\t\treturn this._destroyed;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GeometryElement</code> \r\n\t */\r\n\tconstructor(mode: MeshTopology, drawType: DrawType) {\r\n\t\tthis._destroyed = false;\r\n\t\tthis._geometryElementOBj = Laya3DRender.renderOBJCreate.createRenderGeometry(mode, drawType);\r\n\t\tthis._id = ++GeometryElement._uniqueIDCounter;\r\n\t}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\t_getType(): number {\r\n\t\tthrow \"GeometryElement:must override it.\";\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @return  \r\n\t */\r\n\t_prepareRender(state: RenderContext3D): boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * UpdateGeometry Data\r\n\t */\r\n\t_updateRenderParams(state: RenderContext3D): void {\r\n\t\tthrow \"GeometryElement:must override it.\";\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tdestroy(): void {\r\n\t\tif (this._destroyed)\r\n\t\t\treturn;\r\n\t\tthis._destroyed = true;\r\n\t\tthis._geometryElementOBj.destroy();\r\n\t}\r\n\r\n\tclearRenderParams() {\r\n\t\tthis._geometryElementOBj.clearRenderParams();\r\n\t}\r\n}\r\n\r\n","import { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { GeometryElement } from \"../../core/GeometryElement\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\n\r\n\r\n/**\r\n * <code>SkyBox</code> \r\n */\r\nexport class SkyBox extends GeometryElement {\r\n\tstatic instance: SkyBox;\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tSkyBox.instance = new SkyBox();//TODO:Mesh\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SkyBox</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper(MeshTopology.Triangles, DrawType.DrawElement);\r\n\t\tvar halfHeight: number = 1.0;\r\n\t\tvar halfWidth: number = 1.0;\r\n\t\tvar halfDepth: number = 1.0;\r\n\t\tvar vertices: Float32Array = new Float32Array([-halfDepth, halfHeight, -halfWidth, halfDepth, halfHeight, -halfWidth, halfDepth, halfHeight, halfWidth, -halfDepth, halfHeight, halfWidth,//\r\n\t\t-halfDepth, -halfHeight, -halfWidth, halfDepth, -halfHeight, -halfWidth, halfDepth, -halfHeight, halfWidth, -halfDepth, -halfHeight, halfWidth]);//\r\n\t\tvar indices: Uint8Array = new Uint8Array([\r\n\t\t\t0, 2, 1, 2, 0, 3, //\r\n\t\t\t4, 6, 7, 6, 4, 5, //\r\n\t\t\t0, 7, 3, 7, 0, 4, //\r\n\t\t\t1, 6, 5, 6, 1, 2,//\r\n\t\t\t3, 6, 2, 6, 3, 7, //\r\n\t\t\t0, 5, 4, 5, 0, 1]);//\r\n\t\tvar verDec: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION\");\r\n\t\tlet vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(verDec.vertexStride * 8, BufferUsage.Static, false);\r\n\t\tvertexBuffer.vertexDeclaration = verDec;\r\n\t\tlet indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt8, 36, BufferUsage.Static, false);\r\n\t\tvertexBuffer.setData(vertices);\r\n\t\tindexBuffer.setData(indices);\r\n\t\tthis.bufferState = new BufferState();\r\n\t\tthis.bufferState.applyState([vertexBuffer], indexBuffer);\r\n\t\tthis._geometryElementOBj.setDrawElemenParams(36, 0);\r\n\t\tthis.indexFormat = IndexFormat.UInt8;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * UpdateGeometry Data\r\n\t */\r\n\t_updateRenderParams(state: RenderContext3D): void {\r\n\r\n\t}\r\n}\r\n\r\n","import { IVertex } from \"../IVertex\"\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\n\r\n/**\r\n * @internal\r\n * <code>VertexPositionNormalTexture</code> \r\n */\r\nexport class VertexPositionTexture0 implements IVertex {\r\n\r\n\tprivate static _vertexDeclaration: VertexDeclaration;\r\n\r\n\tstatic get vertexDeclaration(): VertexDeclaration {\r\n\t\treturn VertexPositionTexture0._vertexDeclaration;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tVertexPositionTexture0._vertexDeclaration = new VertexDeclaration(20, [new VertexElement(0, VertexElementFormat.Vector3, VertexMesh.MESH_POSITION0),\r\n\t\tnew VertexElement(12, VertexElementFormat.Vector2, VertexMesh.MESH_TEXTURECOORDINATE0)]);\r\n\t}\r\n\r\n\tprivate _position: Vector3;\r\n\tprivate _textureCoordinate0: Vector2;\r\n\r\n\tget position(): Vector3 {\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tget textureCoordinate0(): Vector2 {\r\n\t\treturn this._textureCoordinate0;\r\n\t}\r\n\r\n\tget vertexDeclaration(): VertexDeclaration {\r\n\t\treturn VertexPositionTexture0._vertexDeclaration;\r\n\t}\r\n\r\n\tconstructor(position: Vector3, textureCoordinate0: Vector2) {\r\n\t\tthis._position = position;\r\n\t\tthis._textureCoordinate0 = textureCoordinate0;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { VertexPositionTexture0 } from \"../../graphics/Vertex/VertexPositionTexture0\"\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { GeometryElement } from \"../../core/GeometryElement\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * <code>SkyDome</code> \r\n */\r\nexport class SkyDome extends GeometryElement {\r\n\t/**@internal */\r\n\tprivate static _radius: number = 1;\r\n\r\n\tstatic instance: SkyDome;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tSkyDome.instance = new SkyDome();//TODO:Mesh\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _stacks: number;\r\n\t/**@internal */\r\n\tprivate _slices: number;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget stacks(): number {\r\n\t\treturn this._stacks;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget slices(): number {\r\n\t\treturn this._slices;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SkyDome</code> \r\n\t * @param stacks \r\n\t * @param slices \r\n\t */\r\n\tconstructor(stacks: number = 48, slices: number = 48) {\r\n\t\tsuper(MeshTopology.Triangles,DrawType.DrawElement);\r\n\t\tthis._stacks = stacks;\r\n\t\tthis._slices = slices;\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexPositionTexture0.vertexDeclaration;\r\n\t\tvar vertexFloatCount: number = vertexDeclaration.vertexStride / 4;\r\n\t\tvar numberVertices: number = (this._stacks + 1) * (this._slices + 1);\r\n\t\tvar numberIndices: number = (3 * this._stacks * (this._slices + 1)) * 2;\r\n\r\n\t\tvar vertices: Float32Array = new Float32Array(numberVertices * vertexFloatCount);\r\n\t\tvar indices: Uint16Array = new Uint16Array(numberIndices);\r\n\r\n\t\tvar stackAngle: number = Math.PI / this._stacks;\r\n\t\tvar sliceAngle: number = (Math.PI * 2.0) / this._slices;\r\n\r\n\t\t// Generate the group of Stacks for the sphere  \r\n\t\tvar vertexIndex: number = 0;\r\n\t\tvar vertexCount: number = 0;\r\n\t\tvar indexCount: number = 0;\r\n\r\n\t\tfor (var stack: number = 0; stack < (this._stacks + 1); stack++) {\r\n\t\t\tvar r: number = Math.sin(stack * stackAngle);\r\n\t\t\tvar y: number = Math.cos(stack * stackAngle);\r\n\r\n\t\t\t// Generate the group of segments for the current Stack  \r\n\t\t\tfor (var slice: number = 0; slice < (this._slices + 1); slice++) {\r\n\t\t\t\tvar x: number = r * Math.sin(slice * sliceAngle);\r\n\t\t\t\tvar z: number = r * Math.cos(slice * sliceAngle);\r\n\t\t\t\tvertices[vertexCount + 0] = x * SkyDome._radius;\r\n\t\t\t\tvertices[vertexCount + 1] = y * SkyDome._radius;\r\n\t\t\t\tvertices[vertexCount + 2] = z * SkyDome._radius;\r\n\t\t\t\tvertices[vertexCount + 3] = -(slice / this._slices) + 0.75;//gzk   slice/_slices\r\n\t\t\t\tvertices[vertexCount + 4] = stack / this._stacks;\r\n\t\t\t\tvertexCount += vertexFloatCount;\r\n\t\t\t\tif (stack != (this._stacks - 1)) {\r\n\t\t\t\t\t// First Face\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + 1;\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex;\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + (this._slices + 1);\r\n\t\t\t\t\t// Second \r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + (this._slices + 1);\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex;\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + (this._slices);\r\n\t\t\t\t\tvertexIndex++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vertices.length * 4, BufferUsage.Static, false);\r\n\t\tvertexBuffer.vertexDeclaration = vertexDeclaration;\r\n\t\tlet indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, indices.length, BufferUsage.Static, false);\r\n\t\tvertexBuffer.setData(vertices.buffer);\r\n\t\tindexBuffer.setData(indices);\r\n\r\n\t\tvar bufferState: BufferState = new BufferState();\r\n\t\tbufferState.applyState([vertexBuffer],indexBuffer);\r\n\t\tthis.bufferState = bufferState;\r\n\t\tthis.indexFormat = IndexFormat.UInt16;\r\n\t\tthis._geometryElementOBj.setDrawElemenParams(indexBuffer.indexCount,0);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * UpdateGeometry Data\r\n\t */\r\n\t _updateRenderParams(state: RenderContext3D): void {\r\n\t\t\r\n\t}\r\n}\r\n\r\n","import { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Camera } from \"../../core/Camera\";\r\nimport { GeometryElement } from \"../../core/GeometryElement\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { RenderElement } from \"../../core/render/RenderElement\";\r\nimport { Scene3D } from \"../../core/scene/Scene3D\";\r\nimport { SkyBox } from \"./SkyBox\";\r\nimport { SkyDome } from \"./SkyDome\";\r\n\r\n/**\r\n * <code>SkyRenderer</code> \r\n */\r\nexport class SkyRenderer {\r\n    /** @internal */\r\n    private static _tempMatrix0: Matrix4x4 = new Matrix4x4();\r\n    /** @internal */\r\n    private static _tempMatrix1: Matrix4x4 = new Matrix4x4();\r\n\r\n    /** @internal */\r\n    private _material: Material;\r\n    /** @internal */\r\n    private _mesh: GeometryElement;\r\n    /**@internal */\r\n    private _renderElement: RenderElement;\r\n\r\n    private _renderData: BaseRender;\r\n    static SUNLIGHTDIRECTION: number;\r\n    static SUNLIGHTDIRCOLOR: number;\r\n    static __init__() {\r\n        SkyRenderer.SUNLIGHTDIRECTION = Shader3D.propertyNameToID(\"u_SunLight_direction\");\r\n        SkyRenderer.SUNLIGHTDIRCOLOR = Shader3D.propertyNameToID(\"u_SunLight_color\");\r\n        const commandUniform = LayaGL.renderOBJCreate.createGlobalUniformMap(\"Sprite3D\");\r\n        commandUniform.addShaderUniform(SkyRenderer.SUNLIGHTDIRECTION, \"u_SunLight_direction\", ShaderDataType.Vector3);\r\n        commandUniform.addShaderUniform(SkyRenderer.SUNLIGHTDIRCOLOR, \"u_SunLight_color\", ShaderDataType.Color);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get material(): Material {\r\n        return this._material;\r\n    }\r\n\r\n    set material(value: Material) {\r\n        if (this._material !== value) {\r\n            (this._material) && (this._material._removeReference());\r\n            this._material = value;\r\n            this._renderElement.material = value;\r\n            if (value) {\r\n                value._addReference();\r\n                this._renderElement.renderSubShader = this._material._shader.getSubShaderAt(0);\r\n            }\r\n            else\r\n                this._renderElement.renderSubShader = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get mesh(): GeometryElement {\r\n        return this._mesh;\r\n    }\r\n\r\n    set mesh(value: GeometryElement) {\r\n\r\n        if (this._mesh !== value) {\r\n            this._mesh = value;\r\n            this._renderElement.setGeometry(this._mesh);\r\n        }\r\n    }\r\n\r\n    //@internal\r\n    private get meshType(): \"box\" | \"dome\" | \"\" {\r\n        return this.mesh == SkyBox.instance ? \"box\" : (this.mesh == SkyDome.instance ? \"dome\" : \"\");\r\n    }\r\n\r\n    //@internal\r\n    private set meshType(value: \"box\" | \"dome\" | \"\") {\r\n        if (value == \"dome\")\r\n            this.mesh = SkyDome.instance;\r\n        else\r\n            this.mesh = SkyBox.instance;\r\n    }\r\n\r\n    /**\r\n     *  <code>SkyRenderer</code> \r\n     */\r\n    constructor() {\r\n        this._renderElement = new RenderElement();\r\n        this.mesh = SkyDome.instance;\r\n        this._renderData = new BaseRender();\r\n        this._renderElement.render = this._renderData;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    _isAvailable(): boolean {\r\n        return this._material && this._mesh ? true : false;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _render(context: RenderContext3D): void {\r\n        if (this._material && this._mesh) {\r\n            var camera = context.camera;\r\n            var scene: Scene3D = context.scene;\r\n            var projectionMatrix: Matrix4x4 = SkyRenderer._tempMatrix1;\r\n            this._renderData._shaderValues.setColor(SkyRenderer.SUNLIGHTDIRCOLOR, scene._sunColor);\r\n            this._renderData._shaderValues.setVector3(SkyRenderer.SUNLIGHTDIRECTION, scene._sundir);\r\n            //,DirectX\r\n            //http://terathon.com/gdc07_lengyel.pdf\r\n\r\n            //xScale  0     0                          0\r\n            //0     yScale  0                          0\r\n            //0       0    \t-zfar /(zfar-znear)        -1.0\r\n            //0       0     -znear*zfar /(zfar-znear)  0\r\n\r\n            //xScale  0     0       0        mul   [x,y,z,0] =[xScale*x,yScale*y,-z,-z]\r\n            //0     yScale  0       0\t\t\r\n            //0       0    \t-1      -1.0\t\r\n            //0       0     -0      0\r\n\r\n            //[xScale*x,yScale*y,-z,-z]=>[-xScale*x/z,-yScale*y/z,1]\r\n\r\n            //xScale  0     0       0      \r\n            //0     yScale  0       0\t\t\r\n            //0       0    \t-1+e    -1.0\t\r\n            //0       0     -0  0\r\n            var viewMatrix: Matrix4x4 = SkyRenderer._tempMatrix0;\r\n\r\n            camera.viewMatrix.cloneTo(viewMatrix);//\r\n            viewMatrix.setTranslationVector(Vector3.ZERO);\r\n            if (!camera.orthographic) {\r\n                camera.projectionMatrix.cloneTo(projectionMatrix);\r\n\r\n                var epsilon: number = 1e-6;\r\n                var yScale: number = 1.0 / Math.tan(3.1416 * camera.fieldOfView / 180 * 0.5);\r\n                projectionMatrix.elements[0] = yScale / camera.aspectRatio;\r\n                projectionMatrix.elements[5] = yScale;\r\n                projectionMatrix.elements[10] = epsilon - 1.0;\r\n                projectionMatrix.elements[11] = -1.0;\r\n                projectionMatrix.elements[14] = -0;//znear\r\n\r\n            } else {\r\n\r\n                var halfWidth: number = 0.2;\r\n                var halfHeight: number = halfWidth;\r\n                Matrix4x4.createOrthoOffCenter(-halfWidth, halfWidth, -halfHeight, halfHeight, camera.nearPlane, camera.farPlane, projectionMatrix);\r\n            }\r\n            if ((camera as any).isWebXR) {\r\n                camera._applyViewProject(context, viewMatrix, camera.projectionMatrix);//TODO: Camera\r\n            } else {\r\n                camera._applyViewProject(context, viewMatrix, projectionMatrix);//TODO: Camera\r\n            }\r\n\r\n\r\n            context._contextOBJ.applyContext(Camera._updateMark);\r\n            context.drawRenderElement(this._renderElement);\r\n            camera._applyViewProject(context, camera.viewMatrix, camera.projectionMatrix);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    destroy(): void {\r\n\r\n        if (this._material) {\r\n            this._material._removeReference();\r\n            this._material = null;\r\n        }\r\n        this._renderData.destroy();\r\n        this._renderElement.destroy();\r\n\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n","import { Node } from \"../../display/Node\";\r\nimport { Event } from \"../../events/Event\";\r\nimport { Loader } from \"../../net/Loader\";\r\nimport { Config3D } from \"../../../Config3D\";\r\nimport { IRenderEngine } from \"../../RenderEngine/RenderInterface/IRenderEngine\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData, ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { UniformBufferParamsType, UnifromBufferData } from \"../../RenderEngine/UniformBufferData\";\r\nimport { Scene3D } from \"./scene/Scene3D\";\r\nimport { Sprite3D, StaticFlag } from \"./Sprite3D\";\r\nimport { UniformBufferObject } from \"../../RenderEngine/UniformBufferObject\";\r\nimport { BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { CommandUniformMap } from \"../../RenderEngine/CommandUniformMap\";\r\nimport { ILaya } from \"../../../ILaya\";\r\nimport { Color } from \"../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { SkyRenderer } from \"../resource/models/SkyRenderer\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\n\r\n/**\r\n * <code>BaseCamera</code> \r\n */\r\nexport class BaseCamera extends Sprite3D {\r\n    /** @internal CameraUniformBlock Map */\r\n    static cameraUniformMap: CommandUniformMap;\r\n    /**Camera Uniform PropertyID */\r\n    /**@internal */\r\n    static CAMERAPOS: number;\r\n    /**@internal */\r\n    static VIEWMATRIX: number;\r\n    /**@internal */\r\n    static PROJECTMATRIX: number;\r\n    /**@internal */\r\n    static VIEWPROJECTMATRIX: number;\r\n    /**@internal */\r\n    static CAMERADIRECTION: number;\r\n    /**@internal */\r\n    static CAMERAUP: number;\r\n    /**@internal */\r\n    static VIEWPORT: number;\r\n    /**@internal */\r\n    static PROJECTION_PARAMS: number;\r\n    /**@internal */\r\n    static OPAQUETEXTURE: number\r\n    /**@internal */\r\n    static OPAQUETEXTUREPARAMS: number;\r\n    /**@internal */\r\n    static DEPTHTEXTURE: number;\r\n    /**@internal */\r\n    static DEPTHNORMALSTEXTURE: number;\r\n    /**@internal */\r\n    static DEPTHZBUFFERPARAMS: number;\r\n    /**@internal */\r\n    static CAMERAUNIFORMBLOCK: number;\r\n    /**Camera Define*/\r\n    /**@internal */\r\n    static SHADERDEFINE_DEPTH: ShaderDefine;\r\n    /**@internal */\r\n    static SHADERDEFINE_DEPTHNORMALS: ShaderDefine;\r\n    /**@internal */\r\n    static SHADERDEFINE_ORTHOGRAPHIC: ShaderDefine;\r\n    /**@internal */\r\n    static SHADERDEFINE_FXAA: ShaderDefine;\r\n    /**@internal */\r\n    static RENDERINGTYPE_SHADERDEFINE_FXAA: string = \"FXAA\";\r\n    /**,*/\r\n    static RENDERINGTYPE_DEFERREDLIGHTING: string = \"DEFERREDLIGHTING\";\r\n    /**,*/\r\n    static RENDERINGTYPE_FORWARDRENDERING: string = \"FORWARDRENDERING\";\r\n    /**@internal */\r\n    protected static _invertYScaleMatrix: Matrix4x4 = new Matrix4x4(1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);//Matrix4x4.createScaling(new Vector3(1, -1, 1), _invertYScaleMatrix);\r\n    /**@internal */\r\n    protected static _invertYProjectionMatrix: Matrix4x4 = new Matrix4x4();\r\n    /**@internal */\r\n    protected static _invertYProjectionViewMatrix: Matrix4x4 = new Matrix4x4();\r\n    /**@internal */\r\n    static _tempMatrix4x40: Matrix4x4 = new Matrix4x4();\r\n    /**@internal */\r\n    static CameraUBOData: UnifromBufferData;\r\n    /**\r\n     * @internal\r\n     * shaderInfo init\r\n     */\r\n    static shaderValueInit() {\r\n        BaseCamera.SHADERDEFINE_DEPTH = Shader3D.getDefineByName(\"DEPTHMAP\");\r\n        BaseCamera.SHADERDEFINE_DEPTHNORMALS = Shader3D.getDefineByName(\"DEPTHNORMALSMAP\");\r\n        BaseCamera.SHADERDEFINE_ORTHOGRAPHIC = Shader3D.getDefineByName(\"CAMERAORTHOGRAPHIC\");\r\n        BaseCamera.SHADERDEFINE_FXAA = Shader3D.getDefineByName(\"FXAA\");\r\n        let camerauniformMap = BaseCamera.cameraUniformMap = LayaGL.renderOBJCreate.createGlobalUniformMap(\"BaseCamera\");\r\n\r\n        BaseCamera.CAMERAPOS = Shader3D.propertyNameToID(\"u_CameraPos\");\r\n        BaseCamera.VIEWMATRIX = Shader3D.propertyNameToID(\"u_View\");\r\n        BaseCamera.VIEWPROJECTMATRIX = Shader3D.propertyNameToID(\"u_ViewProjection\");\r\n        BaseCamera.PROJECTMATRIX = Shader3D.propertyNameToID(\"u_Projection\");\r\n        BaseCamera.CAMERADIRECTION = Shader3D.propertyNameToID(\"u_CameraDirection\");\r\n        BaseCamera.CAMERAUP = Shader3D.propertyNameToID(\"u_CameraUp\");\r\n        BaseCamera.VIEWPORT = Shader3D.propertyNameToID(\"u_Viewport\");\r\n        BaseCamera.PROJECTION_PARAMS = Shader3D.propertyNameToID(\"u_ProjectionParams\");\r\n        BaseCamera.DEPTHTEXTURE = Shader3D.propertyNameToID(\"u_CameraDepthTexture\");\r\n        BaseCamera.DEPTHNORMALSTEXTURE = Shader3D.propertyNameToID(\"u_CameraDepthNormalsTexture\");\r\n        BaseCamera.OPAQUETEXTURE = Shader3D.propertyNameToID(\"u_CameraOpaqueTexture\");\r\n        BaseCamera.OPAQUETEXTUREPARAMS = Shader3D.propertyNameToID(\"u_OpaqueTextureParams\");\r\n        BaseCamera.DEPTHZBUFFERPARAMS = Shader3D.propertyNameToID(\"u_ZBufferParams\");\r\n        BaseCamera.CAMERAUNIFORMBLOCK = Shader3D.propertyNameToID(UniformBufferObject.UBONAME_CAMERA);\r\n        if (Config3D._uniformBlock) {\r\n            camerauniformMap.addShaderBlockUniform(BaseCamera.CAMERAUNIFORMBLOCK, UniformBufferObject.UBONAME_CAMERA, [\r\n                {\r\n                    id: BaseCamera.VIEWMATRIX,\r\n                    propertyName: \"u_View\",\r\n                    uniformtype: ShaderDataType.Matrix4x4\r\n                },\r\n                {\r\n                    id: BaseCamera.PROJECTMATRIX,\r\n                    propertyName: \"u_Projection\",\r\n                    uniformtype: ShaderDataType.Matrix4x4\r\n                },\r\n                {\r\n                    id: BaseCamera.VIEWPROJECTMATRIX,\r\n                    propertyName: \"u_ViewProjection\",\r\n                    uniformtype: ShaderDataType.Matrix4x4\r\n                },\r\n\r\n                {\r\n                    id: BaseCamera.PROJECTION_PARAMS,\r\n                    propertyName: \"u_ProjectionParams\",\r\n                    uniformtype: ShaderDataType.Vector4\r\n                },\r\n                {\r\n                    id: BaseCamera.VIEWPORT,\r\n                    propertyName: \"u_Viewport\",\r\n                    uniformtype: ShaderDataType.Vector4\r\n                },\r\n                {\r\n                    id: BaseCamera.CAMERADIRECTION,\r\n                    propertyName: \"u_CameraDirection\",\r\n                    uniformtype: ShaderDataType.Vector3\r\n                },\r\n                {\r\n                    id: BaseCamera.CAMERAUP,\r\n                    propertyName: \"u_CameraUp\",\r\n                    uniformtype: ShaderDataType.Vector3\r\n                },\r\n                {\r\n                    id: BaseCamera.CAMERAPOS,\r\n                    propertyName: \"u_CameraPos\",\r\n                    uniformtype: ShaderDataType.Vector3\r\n                }\r\n            ]);\r\n        } else {\r\n            camerauniformMap.addShaderUniform(BaseCamera.CAMERAPOS, \"u_CameraPos\", ShaderDataType.Vector3);\r\n            camerauniformMap.addShaderUniform(BaseCamera.VIEWMATRIX, \"u_View\", ShaderDataType.Matrix4x4);\r\n            camerauniformMap.addShaderUniform(BaseCamera.PROJECTMATRIX, \"u_Projection\", ShaderDataType.Matrix4x4);\r\n            camerauniformMap.addShaderUniform(BaseCamera.VIEWPROJECTMATRIX, \"u_ViewProjection\", ShaderDataType.Vector4);\r\n            camerauniformMap.addShaderUniform(BaseCamera.CAMERADIRECTION, \"u_CameraDirection\", ShaderDataType.Vector3);\r\n            camerauniformMap.addShaderUniform(BaseCamera.CAMERAUP, \"u_CameraUp\", ShaderDataType.Vector3);\r\n            camerauniformMap.addShaderUniform(BaseCamera.VIEWPORT, \"u_Viewport\", ShaderDataType.Vector4);\r\n            camerauniformMap.addShaderUniform(BaseCamera.PROJECTION_PARAMS, \"u_ProjectionParams\", ShaderDataType.Vector4);\r\n        }\r\n        camerauniformMap.addShaderUniform(BaseCamera.DEPTHTEXTURE, \"u_CameraDepthTexture\", ShaderDataType.Texture2D);\r\n        camerauniformMap.addShaderUniform(BaseCamera.DEPTHNORMALSTEXTURE, \"u_CameraDepthNormalsTexture\", ShaderDataType.Texture2D);\r\n        camerauniformMap.addShaderUniform(BaseCamera.OPAQUETEXTURE, \"u_CameraOpaqueTexture\", ShaderDataType.Texture2D);\r\n        camerauniformMap.addShaderUniform(BaseCamera.OPAQUETEXTUREPARAMS, \"u_OpaqueTextureParams\", ShaderDataType.Vector4);\r\n        camerauniformMap.addShaderUniform(BaseCamera.DEPTHZBUFFERPARAMS, \"u_ZBufferParams\", ShaderDataType.Vector4);\r\n    }\r\n\r\n    /**\r\n     * create BaseCamera UniformBuffer\r\n     * @internal\r\n     * @returns \r\n     */\r\n    static createCameraUniformBlock() {\r\n        if (!BaseCamera.CameraUBOData) {\r\n            let uniformPara: Map<string, UniformBufferParamsType> = new Map<string, UniformBufferParamsType>();\r\n            uniformPara.set(\"u_View\", UniformBufferParamsType.Matrix4x4);\r\n            uniformPara.set(\"u_Projection\", UniformBufferParamsType.Matrix4x4);\r\n            uniformPara.set(\"u_ViewProjection\", UniformBufferParamsType.Matrix4x4);\r\n            uniformPara.set(\"u_ProjectionParams\", UniformBufferParamsType.Vector4);\r\n            uniformPara.set(\"u_Viewport\", UniformBufferParamsType.Vector4);\r\n            uniformPara.set(\"u_CameraDirection\", UniformBufferParamsType.Vector3);\r\n            uniformPara.set(\"u_CameraUp\", UniformBufferParamsType.Vector3);\r\n            uniformPara.set(\"u_CameraPos\", UniformBufferParamsType.Vector3);\r\n\r\n            let uniformMap = new Map<number, UniformBufferParamsType>();\r\n            uniformPara.forEach((value, key) => {\r\n                uniformMap.set(Shader3D.propertyNameToID(key), value);\r\n            })\r\n            BaseCamera.CameraUBOData = new UnifromBufferData(uniformMap);\r\n        }\r\n\r\n        return BaseCamera.CameraUBOData;\r\n    }\r\n    /**\r\n     * Camera Init\r\n     */\r\n    static __init__() {\r\n        BaseCamera.shaderValueInit();\r\n    }\r\n\r\n    /** @internal */\r\n    _renderingOrder: number\r\n    /** @internal */\r\n    _cameraUniformData: UnifromBufferData;\r\n    /** @internal */\r\n    _cameraUniformUBO: UniformBufferObject;\r\n    /** */\r\n    protected _nearPlane: number;\r\n    /** */\r\n    protected _farPlane: number;\r\n    /** */\r\n    protected _renderEngine: IRenderEngine;\r\n    /**@internal */\r\n    private _yrange: number;\r\n    /** */\r\n    private _fieldOfView: number;\r\n    /** */\r\n    private _orthographicVerticalSize: number;\r\n    /** skyRender */\r\n    private _skyRenderer: SkyRenderer = new SkyRenderer();\r\n    /** */\r\n    _forward: Vector3 = new Vector3();\r\n    /** up */\r\n    _up: Vector3 = new Vector3();\r\n    /**  */\r\n    protected _orthographic: boolean;\r\n    /**@internal ResetProjectionMatrix*/\r\n    protected _useUserProjectionMatrix: boolean;\r\n\r\n    /** @internal */\r\n    _shaderValues: ShaderData;\r\n\r\n    /** @internal */\r\n    _linearClearColor: Color;\r\n    /**,CornflowerBlue*/\r\n    private _clearColor: Color;\r\n    public get clearColor(): Color {\r\n        return this._clearColor;\r\n    }\r\n    public set clearColor(value: Color) {\r\n        this._clearColor = value;\r\n        value.toLinear(this._linearClearColor);\r\n    }\r\n    /** , :cullingMask=Math.pow(2,0)|Math.pow(2,1)01*/\r\n    private _cullingMask: number;\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    staticMask: number;\r\n\r\n    /**  */\r\n    useOcclusionCulling: boolean;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get skyRenderer(): SkyRenderer {\r\n        return this._skyRenderer;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get fieldOfView(): number {\r\n        return this._fieldOfView;\r\n    }\r\n\r\n    set fieldOfView(value: number) {\r\n        this._fieldOfView = value;\r\n        this._calculateProjectionMatrix();\r\n        this._caculateMaxLocalYRange();\r\n    }\r\n\r\n    /**\r\n   * \r\n   */\r\n    get maxlocalYDistance(): number {\r\n        return this._yrange;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get nearPlane(): number {\r\n        return this._nearPlane;\r\n    }\r\n\r\n    set nearPlane(value: number) {\r\n        this._nearPlane = value;\r\n        this._calculateProjectionMatrix();\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get farPlane(): number {\r\n        return this._farPlane;\r\n    }\r\n\r\n    set farPlane(vaule: number) {\r\n        this._farPlane = vaule;\r\n        this._calculateProjectionMatrix();\r\n        this._caculateMaxLocalYRange();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get orthographic(): boolean {\r\n        return this._orthographic;\r\n    }\r\n\r\n    set orthographic(vaule: boolean) {\r\n        this._orthographic = vaule;\r\n        this._calculateProjectionMatrix();\r\n        if (vaule) {\r\n            this._shaderValues.addDefine(BaseCamera.SHADERDEFINE_ORTHOGRAPHIC);\r\n        } else\r\n            this._shaderValues.removeDefine(BaseCamera.SHADERDEFINE_ORTHOGRAPHIC);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get orthographicVerticalSize(): number {\r\n        return this._orthographicVerticalSize;\r\n    }\r\n\r\n    set orthographicVerticalSize(vaule: number) {\r\n        this._orthographicVerticalSize = vaule;\r\n        this._calculateProjectionMatrix();\r\n    }\r\n\r\n    get cullingMask() {\r\n        return this._cullingMask;\r\n    }\r\n\r\n    set cullingMask(value: number) {\r\n        this._cullingMask = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get renderingOrder(): number {\r\n        return this._renderingOrder;\r\n    }\r\n\r\n    set renderingOrder(value: number) {\r\n        this._renderingOrder = value;\r\n        this._sortCamerasByRenderingOrder();\r\n    }\r\n\r\n    /**\r\n     *  <code>BaseCamera</code> \r\n     * @param\tfieldOfView \r\n     * @param\tnearPlane \r\n     * @param\tfarPlane \r\n     */\r\n    constructor(nearPlane: number = 0.3, farPlane: number = 1000) {\r\n        super();\r\n        this._shaderValues = LayaGL.renderOBJCreate.createShaderData(null);\r\n\r\n        this._linearClearColor = new Color();\r\n        this.clearColor = new Color(100 / 255, 149 / 255, 237 / 255, 255 / 255);\r\n\r\n        this._fieldOfView = 60;\r\n        this._useUserProjectionMatrix = false;\r\n\r\n\r\n        this._orthographicVerticalSize = 10;\r\n        this.renderingOrder = 0;\r\n\r\n        this._nearPlane = nearPlane;\r\n        this._farPlane = farPlane;\r\n\r\n        this.cullingMask = 2147483647/*int.MAX_VALUE*/;\r\n        this.staticMask = 0xffffffff;\r\n        this.useOcclusionCulling = true;\r\n        this._renderEngine = LayaGL.renderEngine;\r\n        this._orthographic = false;\r\n        if (Config3D._uniformBlock) {\r\n            this._cameraUniformUBO = UniformBufferObject.getBuffer(UniformBufferObject.UBONAME_CAMERA, 0);\r\n            this._cameraUniformData = BaseCamera.createCameraUniformBlock();\r\n            if (!this._cameraUniformUBO) {\r\n                this._cameraUniformUBO = UniformBufferObject.create(UniformBufferObject.UBONAME_CAMERA, BufferUsage.Dynamic, this._cameraUniformData.getbyteLength(), false);\r\n            }\r\n            this._shaderValues._addCheckUBO(UniformBufferObject.UBONAME_CAMERA, this._cameraUniformUBO, this._cameraUniformData);\r\n            this._shaderValues.setUniformBuffer(BaseCamera.CAMERAUNIFORMBLOCK, this._cameraUniformUBO);\r\n        }\r\n    }\r\n\r\n    private _caculateMaxLocalYRange() {\r\n        let halffield = 3.1416 * this.fieldOfView / 180.0 / 2;\r\n        let dist = this.farPlane;\r\n        this._yrange = Math.tan(halffield) * dist * 2;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _calculateProjectionMatrix(): void {\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onScreenSizeChanged(): void {\r\n        this._calculateProjectionMatrix();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Node {\r\n        return new BaseCamera();\r\n    }\r\n\r\n    /**\r\n     * RenderingOrder\r\n     * @internal\r\n     */\r\n    _sortCamerasByRenderingOrder(): void {\r\n        if (this.displayedInStage) {\r\n            var cameraPool: BaseCamera[] = this.scene._cameraPool;//TODO:\r\n            var n: number = cameraPool.length - 1;\r\n            for (var i: number = 0; i < n; i++) {\r\n                if (cameraPool[i].renderingOrder > cameraPool[n].renderingOrder) {\r\n                    var tempCamera: BaseCamera = cameraPool[i];\r\n                    cameraPool[i] = cameraPool[n];\r\n                    cameraPool[n] = tempCamera;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _prepareCameraToRender(): void {\r\n        //var cameraSV: ShaderData = this._shaderValues;\r\n        this.transform.getForward(this._forward);\r\n        this.transform.getUp(this._up);\r\n        this._shaderValues.setVector3(BaseCamera.CAMERAPOS, this.transform.position);\r\n        this._shaderValues.setVector3(BaseCamera.CAMERADIRECTION, this._forward);\r\n        this._shaderValues.setVector3(BaseCamera.CAMERAUP, this._up);\r\n    }\r\n\r\n    // /**\r\n    //  * @internal\r\n    //  */\r\n    // _setShaderValue(index: number, value: any) {\r\n    // \tif (this._cameraUniformData && this._cameraUniformData._has(index))\r\n    // \t\tthis._cameraUniformData._setData(index, value);\r\n    // \tthis._shaderValues.setValueData(index, value);\r\n    // }\r\n\r\n    // /**\r\n    //  * @internal\r\n    //  */\r\n    // _getShaderValue(index: number): any {\r\n    // \treturn this._shaderValues.getValueData(index);\r\n    // }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tshader \r\n     * @param   replacementTag \r\n     */\r\n    render(shader: Shader3D = null, replacementTag: string = null): void {\r\n    }\r\n\r\n    /**\r\n     * ,layer031\r\n     * @param layer \r\n     */\r\n    addLayer(layer: number): void {\r\n        this.cullingMask |= Math.pow(2, layer);\r\n    }\r\n\r\n    /**\r\n     * ,layer031\r\n     * @param layer \r\n     */\r\n    removeLayer(layer: number): void {\r\n        this.cullingMask &= ~Math.pow(2, layer);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    addAllLayers(): void {\r\n        this.cullingMask = 2147483647/*int.MAX_VALUE*/;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    removeAllLayers(): void {\r\n        this.cullingMask = 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    resetProjectionMatrix(): void {\r\n        this._useUserProjectionMatrix = false;\r\n        this._calculateProjectionMatrix();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onActive(): void {\r\n        ((<Scene3D>this._scene))._addCamera(this);\r\n        super._onActive();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onInActive(): void {\r\n        ((<Scene3D>this._scene))._removeCamera(this);\r\n        super._onInActive();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n\r\n        this.orthographic = data.orthographic;\r\n        (data.orthographicVerticalSize !== undefined) && (this.orthographicVerticalSize = data.orthographicVerticalSize);\r\n        (data.fieldOfView !== undefined) && (this.fieldOfView = data.fieldOfView);\r\n        this.nearPlane = data.nearPlane;\r\n        this.farPlane = data.farPlane;\r\n\r\n        var color: any[] = data.clearColor;\r\n        this.clearColor = new Color(color[0], color[1], color[2], color[3]);\r\n        var skyboxMaterial: any = data.skyboxMaterial;\r\n        if (skyboxMaterial) {\r\n            this._skyRenderer.material = Loader.getRes(skyboxMaterial.path);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @inheritDoc\r\n     * @override\r\n     * @param \r\n     */\r\n    destroy(destroyChild: boolean = true): void {\r\n        //postProcess = null;\r\n        //AmbientLight = null;\r\n        this._skyRenderer.destroy();\r\n        this._skyRenderer = null;\r\n\r\n        ILaya.stage.off(Event.RESIZE, this, this._onScreenSizeChanged);\r\n        super.destroy(destroyChild);\r\n    }\r\n}\r\n\r\n","import { RenderElement } from \"./RenderElement\";\r\nimport { Scene3D } from \"../scene/Scene3D\"\r\nimport { Viewport } from \"../../math/Viewport\"\r\nimport { ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Camera } from \"../Camera\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { IRenderContext3D, PipelineMode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { IRenderTarget } from \"../../../RenderEngine/RenderInterface/IRenderTarget\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { ShaderInstance } from \"../../../RenderEngine/RenderShader/ShaderInstance\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * <code>RenderContext3D</code> \r\n */\r\nexport class RenderContext3D {\r\n    static _instance: RenderContext3D;\r\n\r\n    /***/\r\n    static clientWidth: number;\r\n    /***/\r\n    static clientHeight: number;\r\n\r\n    /** @internal */\r\n    static GammaCorrect: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static __init__() {\r\n        RenderContext3D._instance = new RenderContext3D();\r\n\r\n        this.GammaCorrect = Shader3D.getDefineByName(\"GAMMACORRECT\");\r\n    }\r\n\r\n    /** @internal */\r\n    viewMatrix: Matrix4x4;\r\n    /**@internal */\r\n    customShader: Shader3D;\r\n    /**@internal */\r\n    replaceTag: string;\r\n\r\n    /** @internal */\r\n    projectionMatrix: Matrix4x4;\r\n    /** @internal */\r\n    projectionViewMatrix: Matrix4x4;\r\n    /** @internal */\r\n    renderElement: RenderElement;\r\n\r\n    camera: Camera;\r\n    /**@internal */\r\n    _scene: Scene3D;\r\n    /** @internal */\r\n    shader: ShaderInstance;\r\n    /** */\r\n    configPipeLineMode: PipelineMode = \"Forward\";\r\n    /**@internal contextOBJ*/\r\n    _contextOBJ: IRenderContext3D;\r\n    /**@internal */\r\n    get destTarget(): IRenderTarget {\r\n        return this._contextOBJ.destTarget;\r\n    }\r\n\r\n    /**@internal */\r\n    set destTarget(value: IRenderTarget) {\r\n        this._contextOBJ.destTarget = value;\r\n\r\n        // todo ohter color gamut\r\n        // let sRGBGammaOut = false;\r\n        // if (value) {\r\n        //     // todo \r\n        //     if (value._renderTarget._textures[0].gammaCorrection == 2.2) {\r\n        //         sRGBGammaOut = true;\r\n        //     }\r\n        // }\r\n        // else {\r\n        //     // , srgb gamma 2.2\r\n        //     sRGBGammaOut = true;\r\n        // }\r\n\r\n        // if (sRGBGammaOut) {\r\n        //     this._contextOBJ.configShaderData.addDefine(RenderContext3D.GammaCorrect);\r\n        // }\r\n        // else {\r\n        //     this._contextOBJ.configShaderData.removeDefine(RenderContext3D.GammaCorrect);\r\n        // }\r\n    }\r\n\r\n    /** @internal */\r\n    get viewport(): Viewport {\r\n        return this._contextOBJ.viewPort;\r\n    }\r\n\r\n    set viewport(value: Viewport) {\r\n        value.cloneTo(this._contextOBJ.viewPort);\r\n    }\r\n    /** @internal */\r\n    get scissor(): Vector4 {\r\n        return this._contextOBJ.scissor;\r\n    }\r\n\r\n    set scissor(value: Vector4) {\r\n        value.cloneTo(this._contextOBJ.scissor);\r\n    }\r\n\r\n    /** @internal */\r\n    get invertY(): boolean {\r\n        return this._contextOBJ.invertY;\r\n    }\r\n\r\n    set invertY(value: boolean) {\r\n        this._contextOBJ.invertY = value;\r\n    }\r\n\r\n    /** @internal */\r\n    get pipelineMode(): PipelineMode {\r\n        return this._contextOBJ.pipelineMode;\r\n    }\r\n\r\n    set pipelineMode(value: PipelineMode) {\r\n        this._contextOBJ.pipelineMode = value;\r\n    }\r\n    //Camera Shader Data\r\n    get cameraShaderValue(): ShaderData {\r\n        return this._contextOBJ.cameraShaderData;\r\n    }\r\n\r\n    set cameraShaderValue(value: ShaderData) {\r\n        this._contextOBJ.cameraShaderData = value;\r\n    }\r\n\r\n    /** @internal */\r\n    set scene(value: Scene3D) {\r\n        if (value) {\r\n            this._contextOBJ.sceneID = value._id;\r\n            this._contextOBJ.sceneShaderData = value._shaderValues;\r\n            this._scene = value;\r\n        } else {\r\n            this._contextOBJ.sceneID = -1;\r\n            this._contextOBJ.sceneShaderData = null;\r\n            this._scene = null;\r\n        }\r\n\r\n    }\r\n\r\n    get scene(): Scene3D {\r\n        return this._scene;\r\n    }\r\n\r\n    changeViewport(x: number, y: number, width: number, height: number) {\r\n        Viewport._tempViewport.set(x, y, width, height);\r\n        this.viewport = Viewport._tempViewport;\r\n    }\r\n\r\n    changeScissor(x: number, y: number, width: number, height: number) {\r\n        Vector4.tempVec4.setValue(x, y, width, height);\r\n        this.scissor = Vector4.tempVec4;\r\n    }\r\n\r\n    applyContext(cameraUpdateMark: number) {\r\n        this._contextOBJ.applyContext(cameraUpdateMark);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param renderelemt \r\n     */\r\n    drawRenderElement(renderelemt: RenderElement): void {\r\n        renderelemt.material && renderelemt._convertSubShader(this.customShader, this.replaceTag);\r\n        if (!renderelemt.renderSubShader)\r\n            return;\r\n        renderelemt._renderUpdatePre(this);\r\n        this._contextOBJ.drawRenderElement(renderelemt._renderElementOBJ);\r\n    }\r\n    /**\r\n     *  <code>RenderContext3D</code> \r\n     */\r\n    constructor() {\r\n        this._contextOBJ = Laya3DRender.renderOBJCreate.createRenderContext3D();\r\n    }\r\n\r\n}\r\n\r\n\r\n","import { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\"\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\"\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\"\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\"\r\nimport { VertexElement } from \"../../../renders/VertexElement\"\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\"\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\"\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\"\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\"\r\nimport { GeometryElement } from \"../GeometryElement\"\r\nimport { RenderContext3D } from \"./RenderContext3D\"\r\n\r\n/**\r\n * <code>ScreenQuad</code> \r\n */\r\nexport class ScreenQuad extends GeometryElement {\r\n\t/** @internal */\r\n\tstatic SCREENQUAD_POSITION_UV: number = 0;\r\n\t/** @internal */\r\n\tprivate static _vertexDeclaration: VertexDeclaration;\r\n\t/** @internal */\r\n\tprivate static _vertices: Float32Array = new Float32Array([\r\n\t\t1, 1, 1, 1, \r\n\t\t1, -1, 1, 0,\r\n\t\t-1, 1, 0, 1,\r\n\t\t-1, -1, 0, 0]);//the rule of OpenGL\r\n\t/** @internal */\r\n\tprivate static _verticesInvertUV: Float32Array = new Float32Array([\r\n\t\t1, 1, 1, 0, \r\n\t\t1, -1, 1, 1,\r\n\t\t-1, 1, 0, 0, \r\n\t\t-1, -1, 0, 1]);\r\n\t/**@internal */\r\n\tstatic instance: ScreenQuad;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tScreenQuad._vertexDeclaration = new VertexDeclaration(16, [new VertexElement(0, VertexElementFormat.Vector4, ScreenQuad.SCREENQUAD_POSITION_UV)]);\r\n\t\tScreenQuad.instance = new ScreenQuad();\r\n\t}\r\n\r\n\t/** @internal */\r\n\tprivate _vertexBuffer: VertexBuffer3D;\r\n\t/** @internal */\r\n\tprivate _bufferState: BufferState = new BufferState();\r\n\t/** @internal */\r\n\tprivate _vertexBufferInvertUV: VertexBuffer3D;\r\n\t/** @internal */\r\n\tprivate _bufferStateInvertUV: BufferState = new BufferState();\r\n\r\n\t/**\r\n\t *  <code>ScreenQuad</code> ,\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper(MeshTopology.TriangleStrip, DrawType.DrawArray);\r\n\t\tthis.setDrawArrayParams(0, 4);\r\n\t\t//buffer\r\n\t\tthis._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(16 * 4, BufferUsage.Static, false);\r\n\t\tthis._vertexBuffer.vertexDeclaration = ScreenQuad._vertexDeclaration;\r\n\t\tthis._vertexBuffer.setData(ScreenQuad._vertices.buffer);\r\n\t\tthis._bufferState.applyState([this._vertexBuffer], null);\r\n\r\n\t\tthis._vertexBufferInvertUV = Laya3DRender.renderOBJCreate.createVertexBuffer3D(16 * 4, BufferUsage.Static, false);\r\n\t\tthis._vertexBufferInvertUV.vertexDeclaration = ScreenQuad._vertexDeclaration;\r\n\t\tthis._vertexBufferInvertUV.setData(ScreenQuad._verticesInvertUV.buffer);\r\n\t\tthis._bufferStateInvertUV.applyState([this._vertexBufferInvertUV], null);\r\n\t}\r\n\r\n\t/**\r\n\t * set BufferState\r\n\t */\r\n\tset invertY(value: boolean) {\r\n\t\tthis.bufferState = value ? this._bufferStateInvertUV : this._bufferState;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * UpdateGeometry Data\r\n\t */\r\n\t_updateRenderParams(state: RenderContext3D): void {\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tdestroy(): void {\r\n\t\tsuper.destroy();\r\n\t\tthis._bufferState.destroy();\r\n\t\tthis._vertexBuffer.destroy();\r\n\t\tthis._bufferStateInvertUV.destroy();\r\n\t\tthis._vertexBufferInvertUV.destroy();\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\n\r\n/**\r\n * <code>Command</code> \r\n */\r\nexport class Command {\r\n\t/**@internal */\r\n\tstatic _screenShaderData: ShaderData;\r\n\t/** @internal */\r\n\tstatic _screenShader: Shader3D;\r\n\r\n\t/** @internal */\r\n\tstatic SCREENTEXTURE_NAME: string = \"u_MainTex\";\r\n\t/** @internal */\r\n\tstatic SCREENTEXTUREOFFSETSCALE_NAME: string = \"u_OffsetScale\";\r\n\t/** @internal */\r\n\tstatic MAINTEXTURE_TEXELSIZE_NAME: string = \"u_MainTex_TexelSize\";//todo\r\n\t/** @internal */\r\n\tstatic SCREENTEXTURE_ID: number ;//todo\r\n\t/** @internal */\r\n\tstatic SCREENTEXTUREOFFSETSCALE_ID: number;//todo\r\n\t/** @internal */\r\n\tstatic MAINTEXTURE_TEXELSIZE_ID: number ;//todo\r\n\r\n\t/**@internal */\r\n\t_commandBuffer: CommandBuffer = null;\r\n\t/**@internal */\r\n\t_context: RenderContext3D;\r\n\t/**\r\n\t* @internal\r\n\t*/\r\n\tstatic __init__(): void {\r\n\t\tCommand._screenShaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n\t\tCommand._screenShader = Shader3D.find(\"BlitScreen\");\r\n\t\tCommand.SCREENTEXTURE_ID = Shader3D.propertyNameToID(Command.SCREENTEXTURE_NAME);//todo\r\n\t\tCommand.SCREENTEXTUREOFFSETSCALE_ID = Shader3D.propertyNameToID(Command.SCREENTEXTUREOFFSETSCALE_NAME);//todo\r\n\t\tCommand.MAINTEXTURE_TEXELSIZE_ID = Shader3D.propertyNameToID(Command.MAINTEXTURE_TEXELSIZE_NAME);//todo\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Command</code> \r\n\t */\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\trun(): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\trecover(): void {\r\n\t\tthis._commandBuffer = null;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param context  \r\n\t */\r\n\tsetContext(context: RenderContext3D) {\r\n\t\tthis._context = context;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @destroy\r\n\t */\r\n\tdestroy(){\r\n\t\tthis._commandBuffer = null;\r\n\t\tthis._context = null;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { BaseTexture } from \"../../../../resource/BaseTexture\";\r\nimport { Stat } from \"../../../../utils/Stat\";\r\nimport { Viewport } from \"../../../math/Viewport\";\r\nimport { Transform3D } from \"../../Transform3D\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { RenderElement } from \"../RenderElement\";\r\nimport { ScreenQuad } from \"../ScreenQuad\";\r\nimport { Command } from \"./Command\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\nimport { Camera } from \"../../Camera\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\nimport { Laya3DRender } from \"../../../RenderObjs/Laya3DRender\";\r\n\r\nexport class BlitScreenQuadCMD extends Command {\r\n\t/**@internal */\r\n\tstatic _SCREENTYPE_QUAD: number = 0;\r\n\t/**@internal */\r\n\tstatic _SCREENTYPE_TRIANGLE: number = 1;\r\n\t/**@internal */\r\n\tprivate static _pool: any[] = [];\r\n\t/** @internal */\r\n\tprivate static _defaultOffsetScale: Vector4 = new Vector4(0, 0, 1, 1);\r\n\t/**\r\n\t* \r\n\t* @param source  null  CameraRenderTexture\r\n\t* @param dest  nullcamera\r\n\t* @param offsetScale \r\n\t* @param shader shader\r\n\t* @param shaderData \r\n\t* @param subShader subshader\r\n\t* @param screenType \r\n\t*/\r\n\tstatic create(source: BaseTexture, dest: RenderTexture, offsetScale: Vector4 = null, shader: Shader3D = null, shaderData: ShaderData = null, subShader: number = 0, screenType: number = BlitScreenQuadCMD._SCREENTYPE_QUAD, commandbuffer: CommandBuffer = null): BlitScreenQuadCMD {\r\n\t\tvar cmd: BlitScreenQuadCMD;\r\n\t\tcmd = BlitScreenQuadCMD._pool.length > 0 ? BlitScreenQuadCMD._pool.pop() : new BlitScreenQuadCMD();\r\n\t\tcmd._source = source;\r\n\t\tcmd._dest = dest;\r\n\t\tcmd._offsetScale = offsetScale;\r\n\t\tcmd.setshader(shader, subShader, shaderData);\r\n\t\t// cmd._shader = shader;\r\n\t\t// cmd.shaderData = shaderData;\r\n\t\t// cmd._subShader = subShader;\r\n\t\tcmd._commandBuffer = commandbuffer;\r\n\t\treturn cmd;\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _source: BaseTexture = null;\r\n\t/**@internal */\r\n\tprivate _dest: RenderTexture = null;\r\n\t/**@internal */\r\n\tprivate _offsetScale: Vector4 = null;\r\n\t/**@internal */\r\n\tprivate _shader: Shader3D = null;\r\n\t/**@internal */\r\n\tprivate _shaderData: ShaderData = null;\r\n\t/**@internal */\r\n\tprivate _subShader: number = 0;\r\n\t/**@internal */\r\n\tprivate _sourceTexelSize: Vector4 = new Vector4();\r\n\t/**@internal */\r\n\tprivate _renderElement: RenderElement;\r\n\t/**@internal */\r\n\tprivate _transform3D: Transform3D;\r\n\r\n\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._transform3D = Laya3DRender.renderOBJCreate.createTransform(null);\r\n\t\tthis._renderElement = new RenderElement();\r\n\t\tthis._renderElement.setTransform(this._transform3D);\r\n\t\tthis._renderElement.setGeometry(ScreenQuad.instance);\r\n\t}\r\n\r\n\tset shaderData(value: ShaderData) {\r\n\t\tthis._shaderData = value || Command._screenShaderData;\r\n\t\tthis._renderElement._renderElementOBJ._materialShaderData = this._shaderData;\r\n\t}\r\n\r\n\tsetshader(shader: Shader3D, subShader: number, shaderData: ShaderData) {\r\n\t\tthis._shader = shader || Command._screenShader;\r\n\t\tthis._subShader = subShader || 0;\r\n\t\tthis.shaderData = shaderData;\r\n\t\tthis._renderElement.renderSubShader = this._shader.getSubShaderAt(this._subShader);\r\n\t\tthis._renderElement._subShaderIndex = subShader;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trun(): void {//TODO:UV\r\n\t\tthis._commandBuffer && (this.setContext(this._commandBuffer._context));\r\n\t\tvar context = this._context;\r\n\t\tvar source;\r\n\t\tif (!this._source) {\r\n\t\t\tif (!this._commandBuffer._camera._internalRenderTexture)//source null, Bind define FrameBuffer\r\n\t\t\t\tthrow \"camera internalRenderTexture is null,please set camera enableBuiltInRenderTexture\";\r\n\t\t\tsource = this._commandBuffer._camera._internalRenderTexture;\r\n\t\t} else\r\n\t\t\tsource = this._source;\r\n\t\tvar shaderData: ShaderData = this._shaderData;\r\n\t\tvar dest: RenderTexture = this._dest ? this._dest : this._commandBuffer._camera._internalRenderTexture;//set dest\r\n\t\tif (dest) {//set viewport\r\n\t\t\tcontext.changeViewport(0, 0, dest.width, dest.height);\r\n\t\t\tcontext.changeScissor(0, 0, dest.width, dest.height);\r\n\t\t} else {\r\n\t\t\tlet camera = this._commandBuffer._camera;\r\n\t\t\tlet viewport: Viewport = camera.viewport;\r\n\t\t\tlet vpH = viewport.height;\r\n\t\t\tlet vpY = RenderContext3D.clientHeight - viewport.y - vpH;\r\n\t\t\tcontext.changeViewport(viewport.x, vpY, viewport.width, vpH);\r\n\t\t\tcontext.changeScissor(viewport.x, vpY, viewport.width, vpH);\r\n\t\t}\r\n\t\tshaderData.setTexture(Command.SCREENTEXTURE_ID, source);\r\n\t\tshaderData.setVector(Command.SCREENTEXTUREOFFSETSCALE_ID, this._offsetScale || BlitScreenQuadCMD._defaultOffsetScale);\r\n\t\tthis._sourceTexelSize.setValue(1.0 / source.width, 1.0 / source.height, source.width, source.height);\r\n\t\tshaderData.setVector(Command.MAINTEXTURE_TEXELSIZE_ID, this._sourceTexelSize);\r\n\t\tcontext.destTarget = dest;\r\n\t\tcontext._contextOBJ.applyContext(Camera._updateMark);\r\n\t\t// ScreenQuad.instance.invertY = dest ? dest._isCameraTarget : false;\r\n\t\tScreenQuad.instance.invertY = context.invertY;\r\n\t\tcontext.drawRenderElement(this._renderElement);\r\n\t\tStat.blitDrawCall++;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trecover(): void {\r\n\t\tBlitScreenQuadCMD._pool.push(this);\r\n\t\tthis._source = null;\r\n\t\tthis._dest = null;\r\n\t\tthis._offsetScale = null;\r\n\t\tthis._shader = null;\r\n\t\tthis._shaderData = null;\r\n\t\tsuper.recover();\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tthis._source = null;\r\n\t\tthis._dest = null;\r\n\t\tthis._offsetScale = null;\r\n\t\tthis._shader = null;\r\n\t\tthis._shaderData = null;\r\n\t\tthis._renderElement.destroy();\r\n\t}\r\n}","import { Command } from \"./Command\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { Camera } from \"../../Camera\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\n\r\n/**\r\n * @internal\r\n * <code>SetRenderTargetCMD</code> \r\n */\r\nexport class SetRenderTargetCMD extends Command {\r\n\t/**@internal */\r\n\tprivate static _pool: any[] = [];\r\n\r\n\t/**@internal */\r\n\tprivate _renderTexture: RenderTexture = null;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic create(renderTexture: RenderTexture): SetRenderTargetCMD {\r\n\t\tvar cmd: SetRenderTargetCMD;\r\n\t\tcmd = SetRenderTargetCMD._pool.length > 0 ? SetRenderTargetCMD._pool.pop() : new SetRenderTargetCMD();\r\n\t\tcmd._renderTexture = renderTexture;\r\n\t\treturn cmd;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trun(): void {\r\n\t\t//buffer  \r\n\t\t(RenderTexture.currentActive) && (RenderTexture.currentActive._end());\r\n\t\tRenderContext3D._instance.destTarget = this._renderTexture;\r\n\t\tRenderContext3D._instance.changeScissor(0, 0, this._renderTexture.width, this._renderTexture.height);\r\n\t\tRenderContext3D._instance.changeViewport(0, 0, this._renderTexture.width, this._renderTexture.height);\r\n\t\tRenderContext3D._instance._contextOBJ.applyContext(Camera._updateMark);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trecover(): void {\r\n\t\tSetRenderTargetCMD._pool.push(this);\r\n\t\tthis._renderTexture = null;\r\n\t}\r\n}\r\n\r\n\r\n","import { Command } from \"./Command\";\r\nimport { BaseTexture } from \"../../../../resource/BaseTexture\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\nimport { ShaderData, ShaderDataItem, ShaderDataType } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderDefine } from \"../../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\n\r\n/**\r\n * @internal\r\n * <code>SetShaderDataTextureCMD</code> \r\n */\r\nexport class SetShaderDataCMD extends Command {\r\n\tstatic ShaderDataType_define:number = -2;\r\n\t/**@internal */\r\n\tprivate static _pool: any[] = [];\r\n\r\n\t/**@internal */\r\n\tprivate _shaderData: ShaderData = null;\r\n\t/**@internal */\r\n\tprivate _nameID: number|string = 0;\r\n\t/**@internal */\r\n\tprivate _value: ShaderDataItem = null;\r\n\t/**@internal */\r\n\tprivate _dataType:number = -1;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic create(shaderData: ShaderData, nameID: number|string, value:ShaderDataItem,shaderDataType:ShaderDataType|number,commandBuffer:CommandBuffer): SetShaderDataCMD {\r\n\t\tvar cmd: SetShaderDataCMD;\r\n\t\tcmd = SetShaderDataCMD._pool.length > 0 ? SetShaderDataCMD._pool.pop() : new SetShaderDataCMD();\r\n\t\tcmd._shaderData = shaderData;\r\n\t\tcmd._nameID = nameID;\r\n\t\tcmd._value = (value as any).clone?(value as any).clone():value;\r\n\t\tcmd._dataType = shaderDataType;\r\n\t\tcmd._commandBuffer = commandBuffer;\r\n\t\treturn cmd;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trun(): void {\r\n\t\tswitch(this._dataType){\r\n\t\t\tcase ShaderDataType.Int:\r\n\t\t\t\tthis._shaderData.setInt(this._nameID as number,this._value as number);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Float:\r\n\t\t\t\tthis._shaderData.setNumber(this._nameID as number,this._value as number);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Bool:\r\n\t\t\t\tthis._shaderData.setBool(this._nameID as number,this._value as boolean);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Matrix4x4:\r\n\t\t\t\tthis._shaderData.setMatrix4x4(this._nameID as number,this._value as Matrix4x4);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Color:\r\n\t\t\t\tthis._shaderData.setColor(this._nameID as number,this._value as Color);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Texture2D:\r\n\t\t\t\tthis._shaderData.setTexture(this._nameID as number,this._value as BaseTexture);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Vector4:\r\n\t\t\t\tthis._shaderData.setVector(this._nameID as number,this._value as Vector4);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Vector2:\r\n\t\t\t\tthis._shaderData.setVector2(this._nameID as number,this._value as Vector2);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Vector3:\r\n\t\t\t\tthis._shaderData.setVector3(this._nameID as number,this._value as Vector3);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Buffer:\r\n\t\t\t\tthis._shaderData.setBuffer( this._nameID as number,this._value as Float32Array);\r\n\t\t\t\tbreak;\r\n\t\t\t// case ShaderDataType.ShaderDefine:\r\n\t\t\t// \tlet defineData :ShaderDefine = Shader3D.getDefineByName(this._nameID as string);\r\n\t\t\t// \tif(this._value)\r\n\t\t\t// \tthis._shaderData.addDefine(defineData);\r\n\t\t\t// \telse\r\n\t\t\t// \tthis._shaderData.removeDefine(defineData);\r\n\t\t\t// \tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tif(this._dataType==SetShaderDataCMD.ShaderDataType_define){\r\n\t\t\t\t\tlet defineData :ShaderDefine = Shader3D.getDefineByName(this._nameID as string);\r\n\t\t\t\t\t\tif(this._value)\r\n\t\t\t\t\t\tthis._shaderData.addDefine(defineData);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\tthis._shaderData.removeDefine(defineData);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}else\r\n\t\t\t\t\tthrow \"no type shaderValue on this CommendBuffer\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trecover(): void {\r\n\t\tSetShaderDataCMD._pool.push(this);\r\n\t\tthis._shaderData = null;\r\n\t\tthis._nameID = 0;\r\n\t\tthis._value = null;\r\n\t\tthis._dataType = -1;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { Material } from \"../../../resource/Material\";\r\n\r\n\r\n/**\r\n * <code>BlinnPhongMaterial</code> Blinn-Phong\r\n */\r\nexport class BlinnPhongMaterial extends Material {\r\n\t/**_Alpha*/\r\n\tstatic SPECULARSOURCE_DIFFUSEMAPALPHA: number;\r\n\t/**_RGB*/\r\n\tstatic SPECULARSOURCE_SPECULARMAP: number;\r\n\r\n\t/**_*/\r\n\tstatic RENDERMODE_OPAQUE: number = 0;\r\n\t/**_*/\r\n\tstatic RENDERMODE_CUTOUT: number = 1;\r\n\t/**_*/\r\n\tstatic RENDERMODE_TRANSPARENT: number = 2;\r\n\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DIFFUSEMAP: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_NORMALMAP: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SPECULARMAP: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ENABLEVERTEXCOLOR: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ENABLETRANSMISSION: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_THICKNESSMAP: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic ALBEDOTEXTURE: number;\r\n\t/**@internal */\r\n\tstatic NORMALTEXTURE: number;\r\n\t/**@internal */\r\n\tstatic SPECULARTEXTURE: number;\r\n\t/**@internal */\r\n\tstatic ALBEDOCOLOR: number;\r\n\t/**@internal */\r\n\tstatic MATERIALSPECULAR: number;\r\n\t/**@internal */\r\n\tstatic SHININESS: number;\r\n\t/**@internal */\r\n\tstatic TILINGOFFSET: number;\r\n\t/**@internal */\r\n\tstatic TRANSMISSIONRATE: number;\r\n\t/**@internal */\r\n\tstatic IBACKDIFFUSE: number;\r\n\t/**@internal */\r\n\tstatic IBACKSCALE: number;\r\n\t/**@internal */\r\n\tstatic THINKNESSTEXTURE: number;\r\n\t/**@internal */\r\n\tstatic TRANSMISSIONCOLOR: number;\r\n\t/**@internal */\r\n\tstatic AlbedoIntensity: number;\r\n\r\n\t/** */\r\n\tstatic defaultMaterial: BlinnPhongMaterial;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __initDefine__(): void {\r\n\t\tBlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP = Shader3D.getDefineByName(\"DIFFUSEMAP\");\r\n\t\tBlinnPhongMaterial.SHADERDEFINE_NORMALMAP = Shader3D.getDefineByName(\"NORMALMAP\");\r\n\t\tBlinnPhongMaterial.SHADERDEFINE_SPECULARMAP = Shader3D.getDefineByName(\"SPECULARMAP\");\r\n\t\tBlinnPhongMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR = Shader3D.getDefineByName(\"ENABLEVERTEXCOLOR\");\r\n\t\tBlinnPhongMaterial.SHADERDEFINE_ENABLETRANSMISSION = Shader3D.getDefineByName(\"ENABLETRANSMISSION\");\r\n\t\tBlinnPhongMaterial.SHADERDEFINE_THICKNESSMAP = Shader3D.getDefineByName(\"THICKNESSMAP\");\r\n\r\n\t\tBlinnPhongMaterial.ALBEDOTEXTURE = Shader3D.propertyNameToID(\"u_DiffuseTexture\");\r\n\t\tBlinnPhongMaterial.NORMALTEXTURE = Shader3D.propertyNameToID(\"u_NormalTexture\");\r\n\t\tBlinnPhongMaterial.SPECULARTEXTURE = Shader3D.propertyNameToID(\"u_SpecularTexture\");\r\n\t\tBlinnPhongMaterial.ALBEDOCOLOR = Shader3D.propertyNameToID(\"u_DiffuseColor\");\r\n\t\tBlinnPhongMaterial.MATERIALSPECULAR = Shader3D.propertyNameToID(\"u_MaterialSpecular\");\r\n\t\tBlinnPhongMaterial.SHININESS = Shader3D.propertyNameToID(\"u_Shininess\");\r\n\t\tBlinnPhongMaterial.TILINGOFFSET = Shader3D.propertyNameToID(\"u_TilingOffset\");\r\n\t\tBlinnPhongMaterial.TRANSMISSIONRATE = Shader3D.propertyNameToID(\"u_TransmissionRate\");\r\n\t\tBlinnPhongMaterial.IBACKDIFFUSE = Shader3D.propertyNameToID(\"u_BackDiffuse\");\r\n\t\tBlinnPhongMaterial.IBACKSCALE = Shader3D.propertyNameToID(\"u_BackScale\");\r\n\t\tBlinnPhongMaterial.THINKNESSTEXTURE = Shader3D.propertyNameToID(\"u_ThinknessTexture\");\r\n\t\tBlinnPhongMaterial.TRANSMISSIONCOLOR = Shader3D.propertyNameToID(\"u_TransmissionColor\");\r\n\t\tBlinnPhongMaterial.AlbedoIntensity = Shader3D.propertyNameToID(\"u_AlbedoIntensity\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param \r\n\t */\r\n\tset renderMode(value: number) {\r\n\t\tswitch (value) {\r\n\t\t\tcase BlinnPhongMaterial.RENDERMODE_OPAQUE:\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_OPAQUE;\r\n\t\t\t\tthis.depthWrite = true;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_DISABLE;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LESS;\r\n\t\t\t\tbreak;\r\n\t\t\tcase BlinnPhongMaterial.RENDERMODE_CUTOUT:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_ALPHATEST;\r\n\t\t\t\tthis.alphaTest = true;\r\n\t\t\t\tthis.depthWrite = true;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_DISABLE;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LESS;\r\n\t\t\t\tbreak;\r\n\t\t\tcase BlinnPhongMaterial.RENDERMODE_TRANSPARENT:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LESS;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"Material:renderMode value error.\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget enableVertexColor(): boolean {\r\n\t\treturn this.hasDefine(BlinnPhongMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n\t}\r\n\r\n\tset enableVertexColor(value: boolean) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(BlinnPhongMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n\t\telse\r\n\t\t\tthis.removeDefine(BlinnPhongMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget tilingOffset(): Vector4 {\r\n\t\treturn (<Vector4>this.getVector4ByIndex(BlinnPhongMaterial.TILINGOFFSET));\r\n\t}\r\n\r\n\tset tilingOffset(value: Vector4) {\r\n\t\tif (value) {\r\n\t\t\tthis.setVector4ByIndex(BlinnPhongMaterial.TILINGOFFSET, value);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.getVector4ByIndex(BlinnPhongMaterial.TILINGOFFSET).setValue(1.0, 1.0, 0.0, 0.0);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget albedoColor(): Color {\r\n\t\treturn this.getColorByIndex(BlinnPhongMaterial.ALBEDOCOLOR);\r\n\t}\r\n\r\n\tset albedoColor(value: Color) {\r\n\t\tthis.setColorByIndex(BlinnPhongMaterial.ALBEDOCOLOR, value);//,NATIVE\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget albedoIntensity(): number {\r\n\t\treturn this.getFloatByIndex(BlinnPhongMaterial.AlbedoIntensity);\r\n\t}\r\n\r\n\tset albedoIntensity(value: number) {\r\n\t\tthis.setFloatByIndex(BlinnPhongMaterial.AlbedoIntensity, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget specularColor(): Color {\r\n\t\treturn this.getColorByIndex(BlinnPhongMaterial.MATERIALSPECULAR);\r\n\t}\r\n\r\n\tset specularColor(value: Color) {\r\n\t\tthis.setColorByIndex(BlinnPhongMaterial.MATERIALSPECULAR, value);\r\n\t}\r\n\r\n\t/**\r\n\t * ,01\r\n\t */\r\n\tget shininess(): number {\r\n\t\treturn this.getFloatByIndex(BlinnPhongMaterial.SHININESS);\r\n\t}\r\n\r\n\tset shininess(value: number) {\r\n\t\tvalue = Math.max(0.0, Math.min(1.0, value));\r\n\t\tthis.setFloatByIndex(BlinnPhongMaterial.SHININESS, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget albedoTexture(): BaseTexture {\r\n\t\treturn this.getTextureByIndex(BlinnPhongMaterial.ALBEDOTEXTURE);\r\n\t}\r\n\r\n\tset albedoTexture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP);\r\n\t\telse\r\n\t\t\tthis.removeDefine(BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP);\r\n\t\tthis.setTextureByIndex(BlinnPhongMaterial.ALBEDOTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget normalTexture(): BaseTexture {\r\n\t\treturn this.getTextureByIndex(BlinnPhongMaterial.NORMALTEXTURE);\r\n\t}\r\n\r\n\tset normalTexture(value: BaseTexture) {\r\n\t\tif (value) {\r\n\t\t\tthis.addDefine(BlinnPhongMaterial.SHADERDEFINE_NORMALMAP);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.removeDefine(BlinnPhongMaterial.SHADERDEFINE_NORMALMAP);\r\n\t\t}\r\n\t\tthis.setTextureByIndex(BlinnPhongMaterial.NORMALTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget specularTexture(): BaseTexture {\r\n\t\treturn this.getTextureByIndex(BlinnPhongMaterial.SPECULARTEXTURE);\r\n\t}\r\n\r\n\tset specularTexture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP);\r\n\t\telse\r\n\t\t\tthis.removeDefine(BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP);\r\n\r\n\t\tthis.setTextureByIndex(BlinnPhongMaterial.SPECULARTEXTURE, value);\r\n\t}\r\n\t/**\r\n\t * \r\n\t */\r\n\tget enableTransmission(): boolean {\r\n\t\treturn this.hasDefine(BlinnPhongMaterial.SHADERDEFINE_ENABLETRANSMISSION);\r\n\t}\r\n\r\n\tset enableTransmission(value: boolean) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(BlinnPhongMaterial.SHADERDEFINE_ENABLETRANSMISSION);\r\n\t\telse\r\n\t\t\tthis.removeDefine(BlinnPhongMaterial.SHADERDEFINE_ENABLETRANSMISSION);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget transmissionRata(): number {\r\n\t\treturn this.getFloatByIndex(BlinnPhongMaterial.TRANSMISSIONRATE);\r\n\t}\r\n\r\n\tset transmissionRata(value: number) {\r\n\t\tthis.setFloatByIndex(BlinnPhongMaterial.TRANSMISSIONRATE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget backDiffuse(): number {\r\n\t\treturn this.getFloatByIndex(BlinnPhongMaterial.IBACKDIFFUSE);\r\n\t}\r\n\tset backDiffuse(value: number) {\r\n\t\tthis.setFloatByIndex(BlinnPhongMaterial.IBACKDIFFUSE, Math.max(value, 1.0));\r\n\t}\r\n\t/**\r\n\t * \r\n\t */\r\n\tget backScale(): number {\r\n\t\treturn this.getFloatByIndex(BlinnPhongMaterial.IBACKSCALE);\r\n\t}\r\n\tset backScale(value: number) {\r\n\t\tthis.setFloatByIndex(BlinnPhongMaterial.IBACKSCALE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget thinknessTexture(): BaseTexture {\r\n\t\treturn this.getTextureByIndex(BlinnPhongMaterial.THINKNESSTEXTURE);\r\n\t}\r\n\tset thinknessTexture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(BlinnPhongMaterial.SHADERDEFINE_THICKNESSMAP);\r\n\t\telse\r\n\t\t\tthis.removeDefine(BlinnPhongMaterial.SHADERDEFINE_THICKNESSMAP);\r\n\r\n\t\tthis.setTextureByIndex(BlinnPhongMaterial.THINKNESSTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget transmissionColor(): Color {\r\n\t\treturn this.getColorByIndex(BlinnPhongMaterial.TRANSMISSIONCOLOR);\r\n\t}\r\n\tset transmissionColor(value: Color) {\r\n\t\tthis.setColorByIndex(BlinnPhongMaterial.TRANSMISSIONCOLOR, value);\r\n\t}\r\n\r\n\t/**\r\n\t * transmissionRata\r\n\t * @deprecated\r\n\t */\r\n\tget transmissionRate(): number {\r\n\t\treturn this.getFloatByIndex(BlinnPhongMaterial.TRANSMISSIONRATE);\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>BlinnPhongMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"BLINNPHONG\");\r\n\t\tthis.renderMode = BlinnPhongMaterial.RENDERMODE_OPAQUE;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: BlinnPhongMaterial = new BlinnPhongMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tsuper.cloneTo(destObject);\r\n\t\tvar destMaterial: BlinnPhongMaterial = (<BlinnPhongMaterial>destObject);\r\n\t\tdestMaterial.albedoIntensity = this.albedoIntensity;\r\n\t\tdestMaterial.enableVertexColor = this.enableVertexColor;\r\n\t\tthis.albedoColor.cloneTo(destMaterial.albedoColor);\r\n\t}\r\n\r\n\r\n}\r\n\r\n\r\n","\r\nimport { Component } from \"../../components/Component\";\r\nimport { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Mesh } from \"../resource/models/Mesh\";\r\nimport { MeshRenderer } from \"./MeshRenderer\";\r\n\r\n/**\r\n * <code>MeshFilter</code> \r\n */\r\nexport class MeshFilter extends Component {\r\n    /** @internal */\r\n    static _meshVerticeDefine: Array<ShaderDefine> = [];\r\n\r\n    /** @internal */\r\n    private _sharedMesh: Mesh;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.runInEditor = true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onEnable(): void {\r\n        const render = this.owner.getComponent(MeshRenderer) as MeshRenderer;\r\n        render && render._enabled && render._onMeshChange(this._sharedMesh);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onDisable(): void {\r\n        const render = this.owner.getComponent(MeshRenderer) as MeshRenderer;\r\n       // render && render._enabled && render._onMeshChange(null);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get sharedMesh(): Mesh {\r\n        return this._sharedMesh;\r\n    }\r\n\r\n    set sharedMesh(value: Mesh) {\r\n        if (this._sharedMesh !== value) {\r\n            //meshReference\r\n            var lastValue: Mesh = this._sharedMesh;\r\n            if (lastValue) {\r\n                lastValue._removeReference();\r\n            }\r\n            if (value) {\r\n                value._addReference();\r\n            }\r\n            this._sharedMesh = value;\r\n\r\n            const render = this.owner.getComponent(MeshRenderer);\r\n            if (!render) {\r\n                return;\r\n            }\r\n            render._onMeshChange(value);\r\n            this._sharedMesh = value;\r\n        }\r\n    }\r\n\r\n    protected _onDestroy() {\r\n        (this._sharedMesh) && (this._sharedMesh._removeReference(), this._sharedMesh = null);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param dest \r\n     */\r\n    _cloneTo(dest: Component): void {\r\n        let meshfilter = dest as MeshFilter;\r\n        meshfilter.sharedMesh = this.sharedMesh;\r\n        super._cloneTo(dest);\r\n    }\r\n\r\n}\r\n\r\n\r\n","import { RenderElement } from \"./RenderElement\";\r\nimport { Event } from \"../../../events/Event\";\r\nimport { SubMesh } from \"../../resource/models/SubMesh\";\r\nimport { GeometryElement } from \"../GeometryElement\";\r\nimport { Transform3D } from \"../Transform3D\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class SubMeshRenderElement extends RenderElement {\r\n\r\n\t/** @internal */\r\n\tprivate _dynamicWorldPositionNormalNeedUpdate: boolean;\r\n\r\n\t/** @internal */\r\n\tstaticBatchIndexStart: number;\r\n\t/** @internal */\r\n\tstaticBatchIndexEnd: number;\r\n\t/** @internal */\r\n\tstaticBatchElementList: SingletonList<SubMeshRenderElement>;\r\n\r\n\t/** @internal */\r\n\tinstanceSubMesh: SubMesh;\r\n\t/** @internal */\r\n\tinstanceBatchElementList: SingletonList<SubMeshRenderElement>;\r\n\r\n\t/** @internal */\r\n\tvertexBatchElementList: SingletonList<SubMeshRenderElement>;\r\n\t/** @internal */\r\n\tvertexBatchVertexDeclaration: VertexDeclaration;\r\n\r\n\r\n\t/**\r\n\t *  <code>SubMeshRenderElement</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._dynamicWorldPositionNormalNeedUpdate = true;\r\n\t\tthis._canBatch = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _onWorldMatrixChanged(): void {\r\n\t\tthis._dynamicWorldPositionNormalNeedUpdate = true;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tsetTransform(transform: Transform3D): void {\r\n\t\tif (this.transform !== transform) {\r\n\t\t\t(this.transform) && (this.transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatrixChanged));\r\n\t\t\t(transform) && (transform.on(Event.TRANSFORM_CHANGED, this, this._onWorldMatrixChanged));\r\n\t\t\tthis._dynamicWorldPositionNormalNeedUpdate = true;\r\n\t\t\tthis.transform = transform;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tsetGeometry(geometry: GeometryElement): void {\r\n\t\tif (this._geometry !== geometry) {\r\n\t\t\tthis._geometry = geometry;\r\n\t\t\tthis._renderElementOBJ._geometry = geometry._geometryElementOBj;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tdestroy(): void {\r\n\t\tif(!this._renderElementOBJ)return;\r\n\t\t(this.transform) && this.transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatrixChanged);\r\n\t\tsuper.destroy();\r\n\t\tthis.staticBatch = null;\r\n\t\tthis.instanceSubMesh = null;\r\n\t\tthis.staticBatchElementList && this.staticBatchElementList.destroy();\r\n\t\tthis.instanceBatchElementList && this.instanceBatchElementList.destroy();\r\n\t\tthis.vertexBatchElementList && this.vertexBatchElementList.destroy();\r\n\t\tthis.vertexBatchVertexDeclaration = null;\r\n\t}\r\n}\r\n\r\n\r\n","import { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { MeshSprite3DShaderDeclaration } from \"../../core/MeshSprite3DShaderDeclaration\";\r\nimport { Mesh } from \"./Mesh\";\r\n\r\n/**\r\n * <code>Mesh</code> \r\n */\r\nexport class MeshUtil {\r\n    /**\r\n     * mesh\r\n     * @param mesh Mesh\r\n     * @param out define\r\n     */\r\n    static getMeshDefine(mesh: Mesh, out: Array<ShaderDefine>) {\r\n        out.length = 0;\r\n        let vertexElements = mesh._vertexBuffer.vertexDeclaration._vertexElements;\r\n        for (const element of vertexElements) {\r\n            switch (element.elementUsage) {\r\n                case VertexMesh.MESH_COLOR0:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_COLOR);\r\n                    break;\r\n                case VertexMesh.MESH_TEXTURECOORDINATE0:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV0);\r\n                    break;\r\n                case VertexMesh.MESH_TEXTURECOORDINATE1:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV1);\r\n                    break;\r\n                case VertexMesh.MESH_TANGENT0:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_TANGENT);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n","import { Config3D } from \"../../../Config3D\"\r\nimport { Component } from \"../../components/Component\"\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\"\r\nimport { RenderCapable } from \"../../RenderEngine/RenderEnum/RenderCapable\"\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\"\r\nimport { ShaderData, ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\"\r\nimport { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\"\r\nimport { VertexMesh } from \"../../RenderEngine/RenderShader/VertexMesh\"\r\nimport { Mesh } from \"../resource/models/Mesh\"\r\nimport { MorphTargetChannel } from \"../resource/models/MorphTarget\"\r\nimport { BlinnPhongMaterial } from \"./material/BlinnPhongMaterial\"\r\nimport { Material } from \"../../resource/Material\"\r\nimport { MeshFilter } from \"./MeshFilter\"\r\nimport { MeshSprite3DShaderDeclaration } from \"./MeshSprite3DShaderDeclaration\"\r\nimport { BaseRender } from \"./render/BaseRender\"\r\nimport { RenderContext3D } from \"./render/RenderContext3D\"\r\nimport { RenderElement } from \"./render/RenderElement\"\r\nimport { SubMeshRenderElement } from \"./render/SubMeshRenderElement\"\r\nimport { RenderableSprite3D } from \"./RenderableSprite3D\"\r\nimport { Sprite3D } from \"./Sprite3D\"\r\nimport { Transform3D } from \"./Transform3D\"\r\nimport { MeshUtil } from \"../resource/models/MeshUtil\"\r\nimport { LayaGL } from \"../../layagl/LayaGL\"\r\n\r\n/**\r\n * <code>MeshRenderer</code> \r\n */\r\nexport class MeshRenderer extends BaseRender {\r\n    /** @internal */\r\n    protected _revertStaticBatchDefineUV1: boolean = false;\r\n    /** @internal */\r\n    protected _projectionViewWorldMatrix: Matrix4x4;\r\n    /** @internal */\r\n    protected _mesh: Mesh;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n        MeshSprite3DShaderDeclaration.SHADERDEFINE_UV0 = Shader3D.getDefineByName(\"UV\");\r\n        MeshSprite3DShaderDeclaration.SHADERDEFINE_COLOR = Shader3D.getDefineByName(\"COLOR\");\r\n        MeshSprite3DShaderDeclaration.SHADERDEFINE_UV1 = Shader3D.getDefineByName(\"UV1\");\r\n        MeshSprite3DShaderDeclaration.SHADERDEFINE_TANGENT = Shader3D.getDefineByName(\"TANGENT\");\r\n        MeshSprite3DShaderDeclaration.SHADERDEFINE_GPU_INSTANCE = Shader3D.getDefineByName(\"GPU_INSTANCE\");\r\n    }\r\n\r\n    private morphTargetActiveCount: number = 0;\r\n    private morphTargetActiveWeight: Float32Array;\r\n    private morphTargetActiveIndex: Float32Array;\r\n\r\n    /**@internal */\r\n    morphTargetWeight: Float32Array;\r\n    private morphtargetChannels: MorphTargetChannel[];\r\n\r\n    private _morphWeightChange: boolean = true;\r\n\r\n    /**\r\n     *  <code>MeshRender</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._projectionViewWorldMatrix = new Matrix4x4();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _createRenderElement(): RenderElement {\r\n        return new SubMeshRenderElement();\r\n    }\r\n\r\n    /**@intermal */\r\n    getMesh() {\r\n        return this._mesh;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n        const filter = this.owner.getComponent(MeshFilter) as MeshFilter;\r\n        if (filter) filter._enabled && this._onMeshChange(filter.sharedMesh);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param mesh \r\n     * @param out \r\n     */\r\n    protected _getMeshDefine(mesh: Mesh, out: Array<ShaderDefine>): number {\r\n        let define;\r\n        out.length = 0;\r\n        MeshUtil.getMeshDefine(mesh, out);\r\n        return define;\r\n    }\r\n\r\n    protected _changeVertexDefine(mesh: Mesh) {\r\n        var defineDatas: ShaderData = this._shaderValues;\r\n        var lastValue: Mesh = this._mesh;\r\n        if (lastValue) {\r\n            this._getMeshDefine(lastValue, MeshFilter._meshVerticeDefine);\r\n            for (var i: number = 0, n: number = MeshFilter._meshVerticeDefine.length; i < n; i++)\r\n                defineDatas.removeDefine(MeshFilter._meshVerticeDefine[i]);\r\n        }\r\n        if (mesh) {\r\n            this._getMeshDefine(mesh, MeshFilter._meshVerticeDefine);\r\n            for (var i: number = 0, n: number = MeshFilter._meshVerticeDefine.length; i < n; i++)\r\n                defineDatas.addDefine(MeshFilter._meshVerticeDefine[i]);\r\n        }\r\n\r\n    }\r\n\r\n    private _morphTargetValues: Record<string, number> = {}\r\n    /**\r\n     * @internal\r\n     */\r\n    public get morphTargetValues(): Record<string, number> {\r\n        return this._morphTargetValues;\r\n    }\r\n    /**\r\n     * @internal\r\n     */\r\n    public set morphTargetValues(value: Record<string, number>) {\r\n        this._morphTargetValues = value;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param key \r\n     */\r\n    _changeMorphTargetValue(key: string) {\r\n        this._morphWeightChange = true;\r\n    }\r\n\r\n    /**\r\n     *  morph target  \r\n     * @param channelName \r\n     * @param weight \r\n     */\r\n    setMorphChannelWeight(channelName: string, weight: number) {\r\n        // todo\r\n        let mesh = this._mesh;\r\n        if (mesh && mesh.morphTargetData) {\r\n            let morphData = mesh.morphTargetData;\r\n            let channel = morphData.getMorphChannel(channelName);\r\n            this.morphTargetValues[channel.name] = weight;\r\n            this._morphWeightChange = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  morph target \r\n     */\r\n    protected _applyMorphdata() {\r\n        let mesh = this._mesh;\r\n        if (this._morphWeightChange && mesh) {\r\n\r\n            let morphData = mesh.morphTargetData;\r\n            let channelCount = morphData.channelCount;\r\n\r\n            for (let channelIndex = 0; channelIndex < channelCount; channelIndex++) {\r\n                let channel = morphData.getMorphChannelbyIndex(channelIndex);\r\n                // channel.targetCount;\r\n                let weight = this.morphTargetValues[channel.name];\r\n\r\n                // update target weight\r\n                let lastFullWeight = 0;\r\n                channel.targets.forEach(target => {\r\n                    if (weight <= target.fullWeight) {\r\n                        this.morphTargetWeight[target._index] = (weight - lastFullWeight) / (target.fullWeight - lastFullWeight);\r\n                    }\r\n                    else {\r\n                        this.morphTargetWeight[target._index] = 1;\r\n                    }\r\n                    lastFullWeight = target.fullWeight;\r\n                });\r\n            }\r\n\r\n            let activeIndex = 0;\r\n            // todo top k\r\n            this.morphTargetWeight.forEach((weight, index) => {\r\n                if (weight > 0) {\r\n                    this.morphTargetActiveIndex[activeIndex] = index;\r\n                    this.morphTargetActiveWeight[activeIndex] = weight;\r\n                    activeIndex++;\r\n                }\r\n            });\r\n\r\n            this.morphTargetActiveCount = Math.min(activeIndex, Config3D.maxMorphTargetCount);\r\n\r\n            if (LayaGL.renderEngine.getCapable(RenderCapable.Texture3D)) {\r\n                this._shaderValues.setInt(RenderableSprite3D.MorphActiveCount, this.morphTargetActiveCount);\r\n\r\n                this._shaderValues.setBuffer(RenderableSprite3D.MorphActiceTargets, this.morphTargetActiveIndex);\r\n                this._shaderValues.setBuffer(RenderableSprite3D.MorphActiveWeights, this.morphTargetActiveWeight);\r\n            }\r\n            else {\r\n                // todo\r\n            }\r\n            this._morphWeightChange = false;\r\n            // todo \r\n            // active count == 0 disable morph ?\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     *  mesh   morph target data (shader define)\r\n     * @param mesh \r\n     */\r\n    protected _changeMorphData(mesh: Mesh) {\r\n        let shaderData = this._shaderValues;\r\n        let oldMesh = this._mesh;\r\n\r\n        // todo\r\n        // config max count\r\n        const maxMorphTargetCount = Config3D.maxMorphTargetCount;\r\n        let maxCount = maxMorphTargetCount;\r\n\r\n        this.morphTargetActiveIndex = new Float32Array(maxCount);\r\n        this.morphTargetActiveWeight = new Float32Array(maxCount);\r\n\r\n        if (LayaGL.renderEngine.getCapable(RenderCapable.Texture3D)) {\r\n            if (oldMesh && oldMesh.morphTargetData) {\r\n                let morphData = oldMesh.morphTargetData;\r\n                shaderData.removeDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET);\r\n\r\n                let morphVertexDec = morphData.vertexDec;\r\n\r\n                morphVertexDec._vertexElements.forEach(element => {\r\n                    switch (element.elementUsage) {\r\n                        case VertexMesh.MESH_POSITION0:\r\n                            shaderData.removeDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET_POSITION);\r\n                            break;\r\n                        case VertexMesh.MESH_NORMAL0:\r\n                            shaderData.removeDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET_NORMAL);\r\n                            break;\r\n                        case VertexMesh.MESH_TANGENT0:\r\n                            shaderData.removeDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET_TANGENT);\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                })\r\n            }\r\n\r\n            if (mesh && mesh.morphTargetData) {\r\n\r\n                let morphData = mesh.morphTargetData;\r\n\r\n                shaderData.addDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET);\r\n                let morphVertexDec = morphData.vertexDec;\r\n                morphVertexDec._vertexElements.forEach(element => {\r\n                    switch (element.elementUsage) {\r\n                        case VertexMesh.MESH_POSITION0:\r\n                            shaderData.addDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET_POSITION);\r\n                            break;\r\n                        case VertexMesh.MESH_NORMAL0:\r\n                            shaderData.addDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET_NORMAL);\r\n                            break;\r\n                        case VertexMesh.MESH_TANGENT0:\r\n                            shaderData.addDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET_TANGENT);\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                })\r\n\r\n                shaderData.setVector(RenderableSprite3D.MorphAttriOffset, mesh.morphTargetData.attributeOffset);\r\n\r\n                shaderData.setTexture(RenderableSprite3D.MorphTex, mesh.morphTargetData.targetTexture);\r\n\r\n                shaderData.setVector(RenderableSprite3D.MorphParams, morphData.params);\r\n\r\n                shaderData.setBuffer(RenderableSprite3D.MorphActiceTargets, this.morphTargetActiveIndex);\r\n                shaderData.setBuffer(RenderableSprite3D.MorphActiveWeights, this.morphTargetActiveWeight);\r\n            }\r\n        }\r\n\r\n        if (oldMesh && oldMesh.morphTargetData) {\r\n            this.morphTargetWeight = null;\r\n\r\n            this.morphtargetChannels = null;\r\n            this._morphTargetValues = {};\r\n        }\r\n\r\n        if (mesh && mesh.morphTargetData) {\r\n\r\n            let morphData = mesh.morphTargetData;\r\n\r\n            let channelCount = morphData.channelCount;\r\n\r\n            this.morphTargetWeight = new Float32Array(morphData.targetCount);\r\n\r\n            this.morphtargetChannels = new Array<MorphTargetChannel>(channelCount);\r\n            for (let index = 0; index < channelCount; index++) {\r\n                let channel = morphData.getMorphChannelbyIndex(index);\r\n                this.morphtargetChannels[index] = channel;\r\n                this._morphTargetValues[channel.name] = 0;\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _onMeshChange(mesh: Mesh): void {\r\n        if (mesh && this._mesh != mesh) {\r\n            this._changeVertexDefine(mesh);\r\n            this._changeMorphData(mesh);\r\n            this._mesh = mesh;\r\n            this.geometryBounds = mesh.bounds;\r\n            var count: number = mesh.subMeshCount;\r\n            this._renderElements.length = count;\r\n            for (var i: number = 0; i < count; i++) {\r\n                var renderElement: RenderElement = this._renderElements[i];\r\n                if (!renderElement) {\r\n                    var material: Material = this.sharedMaterials[i];\r\n                    renderElement = this._renderElements[i] = this._renderElements[i] ? this._renderElements[i] : this._createRenderElement();\r\n                    this.owner && renderElement.setTransform((this.owner as Sprite3D)._transform);\r\n                    renderElement.render = this;\r\n                    renderElement.material = material ? material : BlinnPhongMaterial.defaultMaterial;//,\r\n                }\r\n                renderElement.setGeometry(mesh.getSubMesh(i));\r\n            }\r\n\r\n        } else if (!mesh) {\r\n            this._renderElements.forEach\r\n            this._renderElements.forEach(element => {\r\n                element.destroy();\r\n            });\r\n            this._renderElements.length = 0;\r\n            this._mesh = null;\r\n            this._changeVertexDefine(null);\r\n            this._changeMorphData(null);\r\n        }\r\n        this.boundsChange = true;\r\n        // if (this._octreeNode && this._indexInOctreeMotionList === -1) {\r\n        // \tthis._octreeNode.getManagerNode().addMotionObject(this);\r\n        // }\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     *  element\r\n     */\r\n    updateMulPassRender(): void {\r\n        const filter = this.owner.getComponent(MeshFilter);\r\n        if (!filter)\r\n            return;\r\n        const mesh = filter.sharedMesh;\r\n        if (mesh) {\r\n            var subCount: number = mesh.subMeshCount;\r\n            var matCount = this._sharedMaterials.length;\r\n            if (subCount > matCount) {\r\n                let count = subCount\r\n                this._renderElements.length = count;\r\n                for (var i: number = 0; i < count; i++) {\r\n                    var renderElement: RenderElement = this._renderElements[i];\r\n                    if (!renderElement) {\r\n                        var material: Material = this.sharedMaterials[i];\r\n                        renderElement = this._renderElements[i] = this._renderElements[i] ? this._renderElements[i] : this._createRenderElement();\r\n                        renderElement.setTransform((this.owner as Sprite3D)._transform);\r\n                        renderElement.render = this;\r\n                        renderElement.material = material ? material : BlinnPhongMaterial.defaultMaterial;//,\r\n                    }\r\n                    renderElement.setGeometry(mesh.getSubMesh(i));\r\n                }\r\n            } else {\r\n                let count = matCount;\r\n                this._renderElements.length = count;\r\n                for (var i: number = 0; i < count; i++) {\r\n                    var renderElement: RenderElement = this._renderElements[i];\r\n                    if (!renderElement) {\r\n                        var material: Material = this.sharedMaterials[i];\r\n                        renderElement = this._renderElements[i] = this._renderElements[i] ? this._renderElements[i] : this._createRenderElement();\r\n                        renderElement.setTransform((this.owner as Sprite3D)._transform);\r\n                        renderElement.render = this;\r\n                        renderElement.material = material ? material : BlinnPhongMaterial.defaultMaterial;//,\r\n                    }\r\n                }\r\n                renderElement.setGeometry(mesh.getSubMesh(count % subCount));\r\n            }\r\n\r\n        } else {\r\n            this._renderElements.length = 0;\r\n        }\r\n        this.boundsChange = true;\r\n        // if (this._octreeNode && this._indexInOctreeMotionList === -1) {\r\n        // \tthis._octreeNode.getManagerNode().addMotionObject(this);\r\n        // }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    protected _calculateBoundingBox(): void {\r\n        var sharedMesh: Mesh = this._mesh;\r\n        if (sharedMesh) {\r\n            var worldMat: Matrix4x4 = this._transform.worldMatrix;\r\n            if (sharedMesh.morphTargetData) {\r\n                sharedMesh.morphTargetData.bounds._tranform(worldMat, this._bounds);\r\n            }\r\n            else {\r\n                sharedMesh.bounds._tranform(worldMat, this._bounds);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _renderUpdate(context: RenderContext3D, transform: Transform3D): void {\r\n        this._applyReflection();\r\n        this._mesh.morphTargetData && this._applyMorphdata();\r\n        var element: SubMeshRenderElement = <SubMeshRenderElement>context.renderElement;\r\n        let trans = transform ? transform : this._transform;\r\n        this._setShaderValue(Sprite3D.WORLDMATRIX, ShaderDataType.Matrix4x4, trans.worldMatrix);\r\n        this._worldParams.x = trans.getFrontFaceValue();\r\n        this._setShaderValue(Sprite3D.WORLDINVERTFRONT, ShaderDataType.Vector4, this._worldParams);\r\n        return;\r\n    }\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    _revertBatchRenderUpdate(context: RenderContext3D): void {\r\n        var element: SubMeshRenderElement = (<SubMeshRenderElement>context.renderElement);\r\n        switch (element.renderType) {\r\n            case RenderElement.RENDERTYPE_STATICBATCH:\r\n                if (this._revertStaticBatchDefineUV1)\r\n                    this._shaderValues.removeDefine(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV1);\r\n                this._shaderValues.setVector(RenderableSprite3D.LIGHTMAPSCALEOFFSET, this.lightmapScaleOffset);\r\n                break;\r\n            case RenderElement.RENDERTYPE_INSTANCEBATCH:\r\n                this._shaderValues.removeDefine(MeshSprite3DShaderDeclaration.SHADERDEFINE_GPU_INSTANCE);\r\n                break;\r\n        }\r\n    }\r\n\r\n    protected _onDestroy() {\r\n        super._onDestroy();\r\n        this._morphTargetValues = null;\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @param dest \r\n     */\r\n    _cloneTo(dest: Component): void {\r\n        super._cloneTo(dest);\r\n        // todo clone morphtarget weight\r\n        // onMeshChange in onEnable\r\n        if (this.morphTargetWeight) {\r\n            (<MeshRenderer>dest).morphTargetWeight = new Float32Array(this.morphTargetWeight);\r\n        }\r\n        for (const key in this._morphTargetValues) {\r\n            (<MeshRenderer>dest)._morphTargetValues[key] = this._morphTargetValues[key];\r\n        }\r\n    }\r\n}","import { Mesh } from \"../../../resource/models/Mesh\";\r\nimport { Material } from \"../../../../resource/Material\";\r\nimport { Command } from \"./Command\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\nimport { MeshRenderer } from \"../../../core/MeshRenderer\";\r\nimport { RenderElement } from \"../RenderElement\";\r\nimport { Transform3D } from \"../../Transform3D\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { Camera } from \"../../Camera\";\r\nimport { Matrix4x4 } from \"../../../../maths/Matrix4x4\";\r\nimport { Laya3DRender } from \"../../../RenderObjs/Laya3DRender\";\r\n/**\r\n * @internal\r\n * <code>SetShaderDataTextureCMD</code> \r\n */\r\nexport class DrawMeshCMD extends Command {\r\n\r\n    /**@internal */\r\n    private static _pool: DrawMeshCMD[] = [];\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static create(mesh: Mesh, matrix: Matrix4x4, material: Material, subMeshIndex: number, subShaderIndex: number, commandBuffer: CommandBuffer): DrawMeshCMD {\r\n        var cmd: DrawMeshCMD;\r\n        cmd = DrawMeshCMD._pool.length > 0 ? DrawMeshCMD._pool.pop() : new DrawMeshCMD();\r\n\r\n        cmd._matrix = matrix;\r\n        cmd._transform.worldMatrix = cmd._matrix;\r\n        cmd.material = material;\r\n        cmd._subMeshIndex = subMeshIndex;\r\n        cmd._subShaderIndex = subShaderIndex;\r\n        cmd.mesh = mesh;\r\n        cmd._commandBuffer = commandBuffer;\r\n        return cmd;\r\n    }\r\n\r\n    /**@internal */\r\n    private _material: Material;\r\n\r\n    /**@internal */\r\n    private _matrix: Matrix4x4;\r\n\r\n    /**@internal */\r\n    private _subMeshIndex: number;\r\n\r\n    /**@internal */\r\n    private _subShaderIndex: number;\r\n\r\n    /**@internal */\r\n    private _mesh: Mesh;\r\n\r\n    /**@internal */\r\n    _renderElemnts: RenderElement[];\r\n\r\n    /**@internal */\r\n    _meshRender: MeshRenderer;\r\n\r\n    /**@internal */\r\n    _transform: Transform3D;\r\n\r\n    /**\r\n     * \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._transform = Laya3DRender.renderOBJCreate.createTransform(null);\r\n        this._meshRender = new MeshRenderer();\r\n    }\r\n\r\n    set material(value: Material) {\r\n        this._material && this._material._removeReference(1);\r\n        this._material = value;\r\n        this._material && this._material._addReference(1);\r\n    }\r\n\r\n    set mesh(value: Mesh) {\r\n        if (this._mesh == value)\r\n            return;\r\n        this._mesh = value;\r\n        this._meshRender._onMeshChange(this._mesh);\r\n        this._renderElemnts = this._meshRender._renderElements;\r\n        this._renderElemnts.forEach(element => {\r\n            element.material = this._material;\r\n            element.setTransform(this._transform);\r\n            element.renderSubShader = this._material._shader.getSubShaderAt(this._subShaderIndex);\r\n            element._subShaderIndex = this._subShaderIndex;\r\n        });\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    run(): void {\r\n        var context = RenderContext3D._instance;\r\n        this._meshRender.probReflection = context.scene.sceneReflectionProb;\r\n        context._contextOBJ.applyContext(Camera._updateMark);\r\n        let submeshs = this._mesh._subMeshes\r\n        if (this._subMeshIndex == -1) {\r\n            for (let i = 0, n = submeshs.length; i < n; i++) {\r\n                let element = this._renderElemnts[i];\r\n                context.drawRenderElement(element);\r\n            }\r\n        } else {\r\n            let element = this._renderElemnts[this._subMeshIndex];\r\n            context.drawRenderElement(element);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    recover(): void {\r\n        DrawMeshCMD._pool.push(this);\r\n        super.recover();\r\n        this._material && (this.material = null);\r\n        this._mesh && (this.mesh = null);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    destroy() {\r\n        super.destroy();\r\n        this._renderElemnts.forEach(element => {\r\n            element.destroy();\r\n        });\r\n        this._material && this._material._removeReference(1);\r\n        this._material = null;\r\n        this._renderElemnts = null;\r\n        this._transform = null;\r\n        this._material = null;\r\n        this._matrix = null\r\n    }\r\n}","import { LayaGL } from \"../../../../layagl/LayaGL\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { RenderClearFlag } from \"../../../../RenderEngine/RenderEnum/RenderClearFlag\";\r\nimport { Command } from \"./Command\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\n\r\n\r\n/**\r\n * @internal\r\n * <code>SetShaderDataTextureCMD</code> \r\n */\r\nexport class ClearRenderTextureCMD extends Command {\r\n\t/**@internal */\r\n\tprivate static _pool: any[] = [];\r\n\t/**@internal */\r\n\tprivate _clearColor: boolean = false;\r\n\t/**@internal */\r\n\tprivate _clearDepth: boolean = false;\r\n\t/**@internal */\r\n\tprivate _backgroundColor: Color = new Color();\r\n\t/**@internal */\r\n\tprivate _linearbackgroundColor: Color = new Color();\r\n\t/**@internal */\r\n\tprivate _depth: number = 1;\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic create(clearColor: boolean, clearDepth: boolean, backgroundColor: Color, depth: number = 1, commandBuffer: CommandBuffer): ClearRenderTextureCMD {\r\n\t\tvar cmd: ClearRenderTextureCMD;\r\n\t\tcmd = ClearRenderTextureCMD._pool.length > 0 ? ClearRenderTextureCMD._pool.pop() : new ClearRenderTextureCMD();\r\n\t\tcmd._clearColor = clearColor;\r\n\t\tcmd._clearDepth = clearDepth;\r\n\t\tbackgroundColor.cloneTo(cmd._backgroundColor);\r\n\t\tbackgroundColor.toLinear(cmd._linearbackgroundColor);\r\n\t\tcmd._depth = depth;\r\n\t\tcmd._commandBuffer = commandBuffer;\r\n\t\treturn cmd;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trun(): void {\r\n\t\tvar flag: number;\r\n\t\t// var backgroundColor: Color = this._backgroundColor;\r\n\t\tlet linearBgColor = this._linearbackgroundColor;\r\n\t\tif (this._clearDepth && this._clearColor) {\r\n\t\t\tLayaGL.renderEngine.clearRenderTexture(RenderClearFlag.Color | RenderClearFlag.Depth, linearBgColor, this._depth);\r\n\t\t} else if (this._clearDepth) {\r\n\t\t\tLayaGL.renderEngine.clearRenderTexture(RenderClearFlag.Depth, linearBgColor, this._depth);\r\n\t\t} else if (this._clearColor) {\r\n\t\t\tLayaGL.renderEngine.clearRenderTexture(RenderClearFlag.Color, linearBgColor, this._depth);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trecover(): void {\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Camera } from \"../../Camera\";\r\nimport { Material } from \"../../../../resource/Material\";\r\nimport { BaseRender } from \"../BaseRender\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { RenderElement } from \"../RenderElement\";\r\nimport { Command } from \"./Command\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\n\r\nexport class DrawRenderCMD extends Command {\r\n    /**@internal */\r\n    private static _pool: any[] = [];\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static create(render: BaseRender, material: Material, subShaderIndex: number, commandBuffer: CommandBuffer): DrawRenderCMD {\r\n        var cmd: DrawRenderCMD;\r\n        cmd = DrawRenderCMD._pool.length > 0 ? DrawRenderCMD._pool.pop() : new DrawRenderCMD();\r\n        cmd._render = render;\r\n        cmd.material = material;\r\n        cmd._subShaderIndex = subShaderIndex;\r\n        cmd._commandBuffer = commandBuffer;\r\n        return cmd;\r\n    }\r\n\r\n\r\n\r\n    /**@internal */\r\n    private _material: Material;\r\n    /**@internal */\r\n    private _render: BaseRender;\r\n    /**@internal */\r\n    private _subShaderIndex: number;\r\n\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _elementRender(renderElement: RenderElement, context: RenderContext3D): void {\r\n        renderElement.renderSubShader = this._material._shader.getSubShaderAt(this._subShaderIndex);//TODO\r\n        renderElement.material = this._material;\r\n        context.drawRenderElement(renderElement);\r\n    }\r\n\r\n    set material(value: Material) {\r\n        this._material && this._material._removeReference(1);\r\n        this._material = value;\r\n        this._material && this._material._addReference(1);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    run(): void {\r\n        if (!this._material)\r\n            throw \"This render command material cannot be empty\";\r\n        this.setContext(this._commandBuffer._context);\r\n        var context = this._context;\r\n        context._contextOBJ.applyContext(Camera._updateMark);\r\n        var renderElements = this._render._renderElements;\r\n        for (var i: number = 0, n = renderElements.length; i < n; i++) {\r\n            var renderelement = renderElements[i];\r\n            //change Material\r\n            let mat = renderelement.material;\r\n            this._elementRender(renderelement, context);\r\n            //Recover Material\r\n            renderelement.material = mat;\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    recover(): void {\r\n        DrawRenderCMD._pool.push(this);\r\n        super.recover();\r\n        this._material && this._material._removeReference(1);\r\n        this._material = null;\r\n    }\r\n\r\n    destroy(): void {\r\n        super.destroy();\r\n        this._material && this._material._removeReference(1);\r\n        this._material = null;\r\n    }\r\n\r\n}","import { Command } from \"./Command\";\r\nimport { BaseTexture } from \"../../../../resource/BaseTexture\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { ShaderDataItem, ShaderDataType } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\n\r\n/**\r\n * @internal\r\n * <code>SetShaderDataTextureCMD</code> \r\n */\r\nexport class SetGlobalShaderDataCMD extends Command {\r\n\t/**@internal */\r\n\tprivate static _pool: any[] = [];\r\n\t/**@internal */\r\n\tprivate _nameID: number = 0;\r\n\t/**@internal */\r\n\tprivate _value: ShaderDataItem = null;\r\n\t/**@internal */\r\n\tprivate _dataType:number = -1;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic create(nameID: number, value:any,shaderDataType:ShaderDataType,commandBuffer:CommandBuffer): SetGlobalShaderDataCMD {\r\n\t\tvar cmd: SetGlobalShaderDataCMD;\r\n\t\tcmd = SetGlobalShaderDataCMD._pool.length > 0 ? SetGlobalShaderDataCMD._pool.pop() : new SetGlobalShaderDataCMD();\r\n\t\tcmd._nameID = nameID;\r\n\t\tcmd._value = value;\r\n\t\tcmd._dataType = shaderDataType;\r\n\t\tcmd._commandBuffer = commandBuffer;\r\n\t\treturn cmd;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trun(): void {\r\n\t\t//var shaderData:ShaderData = (this._commandBuffer._camera.scene as Scene3D)._shaderValues;\r\n\t\tlet context = RenderContext3D._instance;\r\n\t\tlet shaderData = context._contextOBJ.globalShaderData;\r\n\t\tif(!shaderData)\r\n\t\tshaderData = context._contextOBJ.globalShaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n\t\tswitch(this._dataType){\r\n\t\t\tcase ShaderDataType.Int:\r\n\t\t\t\tshaderData.setInt(this._nameID,this._value as number);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Float:\r\n\t\t\t\tshaderData.setNumber(this._nameID,this._value as number);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Bool:\r\n\t\t\t\tshaderData.setBool(this._nameID,this._value as boolean);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Matrix4x4:\r\n\t\t\t\tshaderData.setMatrix4x4(this._nameID,this._value as Matrix4x4);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Texture2D:\r\n\t\t\t\tshaderData.setTexture(this._nameID,this._value as BaseTexture);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Vector4:\r\n\t\t\t\tshaderData.setVector(this._nameID,this._value as Vector4);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Vector2:\r\n\t\t\t\tshaderData.setVector2(this._nameID,this._value as Vector2);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Vector3:\r\n\t\t\t\tshaderData.setVector3(this._nameID,this._value as Vector3);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Buffer:\r\n\t\t\t\tshaderData.setBuffer(this._nameID,this._value as Float32Array);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Color:\r\n\t\t\t\tshaderData.setColor(this._nameID,this._value as Color);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow \"no type shaderValue on this CommendBuffer\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trecover(): void {\r\n\t\tSetGlobalShaderDataCMD._pool.push(this);\r\n\t\tthis._nameID = 0;\r\n\t\tthis._value = null;\r\n\t\tthis._dataType = -1;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { DrawType } from \"../../RenderEngine/RenderEnum/DrawType\";\r\nimport { MeshTopology } from \"../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { GeometryElement } from \"../core/GeometryElement\";\r\nimport { RenderContext3D } from \"../core/render/RenderContext3D\";\r\nimport { SubMesh } from \"../resource/models/SubMesh\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class MeshInstanceGeometry extends GeometryElement {\r\n    private _subMesh:SubMesh;\r\n    constructor(subMesh: SubMesh) {\r\n        super(subMesh?subMesh._geometryElementOBj.mode:MeshTopology.Triangles, DrawType.DrawElementInstance);\r\n        this._subMesh = subMesh;\r\n        if(subMesh)\r\n        this.indexFormat = subMesh._mesh.indexFormat;\r\n    }\r\n\r\n    set subMesh(value:SubMesh){\r\n        this._subMesh = value;\r\n        if(value)\r\n        this.indexFormat = value._mesh.indexFormat;\r\n        this.mode = value._geometryElementOBj.mode;\r\n    }\r\n\r\n    get subMesh():SubMesh{\r\n        return this._subMesh\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * UpdateGeometry Data\r\n     */\r\n    _updateRenderParams(state: RenderContext3D): void {\r\n        this.clearRenderParams();\r\n\t\tthis.setDrawElemenParams(this._subMesh.indexCount, this._subMesh._indexStart * 2);\r\n    }\r\n\r\n}","import { BufferUsage } from \"../../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { VertexBuffer } from \"../../../../RenderEngine/VertexBuffer\";\r\nimport { VertexBuffer3D } from \"../../../graphics/VertexBuffer3D\";\r\nimport { Mesh } from \"../../../resource/models/Mesh\";\r\nimport { Material } from \"../../../../resource/Material\";\r\nimport { Transform3D } from \"../../Transform3D\";\r\nimport { Command } from \"./Command\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\nimport { MaterialInstancePropertyBlock } from \"./MaterialInstancePropertyBlock\";\r\nimport { RenderElement } from \"../RenderElement\";\r\nimport { MeshInstanceGeometry } from \"../../../graphics/MeshInstanceGeometry\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { BaseRender } from \"../../../core/render/BaseRender\";\r\nimport { MeshSprite3DShaderDeclaration } from \"../../MeshSprite3DShaderDeclaration\";\r\nimport { Camera } from \"../../Camera\";\r\nimport { Matrix4x4 } from \"../../../../maths/Matrix4x4\";\r\nimport { BufferState } from \"../../../../webgl/utils/BufferState\";\r\nimport { VertexMesh } from \"../../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { Laya3DRender } from \"../../../RenderObjs/Laya3DRender\";\r\n\r\n\r\nexport class DrawMeshInstancedCMD extends Command {\r\n    /**@internal */\r\n    private static _pool: DrawMeshInstancedCMD[] = [];\r\n    /**DrawInstance */\r\n    static maxInstanceCount = 1024;\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     */\r\n    static create(mesh: Mesh, subMeshIndex: number, matrixs: Matrix4x4[], material: Material, subShaderIndex: number, instanceProperty: MaterialInstancePropertyBlock, drawnums: number, commandBuffer: CommandBuffer): DrawMeshInstancedCMD {\r\n        var cmd: DrawMeshInstancedCMD;\r\n        if ((matrixs && matrixs.length > DrawMeshInstancedCMD.maxInstanceCount) || drawnums > DrawMeshInstancedCMD.maxInstanceCount) {\r\n            throw \"the number of renderings exceeds the maximum number of merges\";\r\n        }\r\n        cmd = DrawMeshInstancedCMD._pool.length > 0 ? DrawMeshInstancedCMD._pool.pop() : new DrawMeshInstancedCMD();\r\n\r\n\r\n        cmd._matrixs = matrixs;\r\n        cmd.material = material;\r\n        cmd._subMeshIndex = subMeshIndex;\r\n        cmd._subShaderIndex = subShaderIndex;\r\n        cmd._commandBuffer = commandBuffer;\r\n        cmd._instanceProperty = instanceProperty;\r\n        cmd._drawnums = drawnums;\r\n        cmd.mesh = mesh;\r\n        matrixs && cmd._updateWorldMatrixBuffer();\r\n        cmd._setInstanceBuffer();\r\n        cmd.setContext(RenderContext3D._instance);\r\n        return cmd;\r\n    }\r\n\r\n    /**@internal */\r\n    private _material: Material;\r\n    /**@internal */\r\n    private _matrixs: Matrix4x4[];\r\n    /**@internal */\r\n    private _subMeshIndex: number;\r\n    /**@internal */\r\n    private _subShaderIndex: number = 0;\r\n    /**@internal */\r\n    private _mesh: Mesh;\r\n    /**@internal */\r\n    private _instanceProperty: MaterialInstancePropertyBlock;\r\n    /** @internal */\r\n    private _instanceBufferState: BufferState;\r\n    /** @internal */\r\n    private _drawnums: number;\r\n    /**@internal */\r\n    private _instanceWorldMatrixData: Float32Array;\r\n    /**@internal buffer*/\r\n    private _instanceWorldMatrixBuffer: VertexBuffer3D;\r\n    /**@internal */\r\n    private _instanceGeometryArray: MeshInstanceGeometry[];\r\n    /**@internal */\r\n    private _instanceRenderElementArray: RenderElement[];\r\n    /**@internal */\r\n    _byteCount: number;\r\n    /**@internal */\r\n    _transform: Transform3D;\r\n    /**@internal */\r\n    _instanceRenderElement: RenderElement;\r\n    /**@internal */\r\n    _render: BaseRender;\r\n\r\n\r\n    constructor() {\r\n        super();\r\n        this._transform = Laya3DRender.renderOBJCreate.createTransform(null);\r\n        this._instanceRenderElementArray = [];\r\n        this._instanceGeometryArray = [];\r\n        this._instanceWorldMatrixData = new Float32Array(DrawMeshInstancedCMD.maxInstanceCount * 16);\r\n        this._instanceWorldMatrixBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(this._instanceWorldMatrixData.length * 4, BufferUsage.Dynamic, false);\r\n        this._instanceWorldMatrixBuffer.vertexDeclaration = VertexMesh.instanceWorldMatrixDeclaration;\r\n        this._instanceWorldMatrixBuffer.instanceBuffer = true;\r\n        this._render = new BaseRender();\r\n        this._render._shaderValues.addDefine(MeshSprite3DShaderDeclaration.SHADERDEFINE_GPU_INSTANCE);\r\n\r\n    }\r\n\r\n    set material(value: Material) {\r\n        this._material && this._material._removeReference(1);\r\n        this._material = value;\r\n        this._material && this._material._addReference(1);\r\n    }\r\n\r\n    get bufferState() {\r\n        return this._instanceWorldMatrixBuffer;\r\n    }\r\n\r\n    set mesh(value: Mesh) {\r\n\r\n        if (this._mesh == value)\r\n            return;\r\n        BaseRender.changeVertexDefine(this._mesh, value, this._render._shaderValues);\r\n        this._mesh = value;\r\n        if (!this._mesh)\r\n            return;\r\n        let submeshs = this._mesh._subMeshes;\r\n        if (this._subMeshIndex == -1) {\r\n            for (let i = 0, n = submeshs.length; i < n; i++) {\r\n                let element = this._instanceRenderElementArray[i] = this._instanceRenderElementArray[i] ? this._instanceRenderElementArray[i] : new RenderElement();\r\n                let geometry = this._instanceGeometryArray[i] = this._instanceGeometryArray[i] ? this._instanceGeometryArray[i] : new MeshInstanceGeometry(submeshs[i]);\r\n                element.setGeometry(geometry);\r\n                element.transform = this._transform;\r\n                element.material = this._material;\r\n                element.renderSubShader = this._material._shader.getSubShaderAt(this._subShaderIndex);\r\n                element._subShaderIndex = this._subShaderIndex;\r\n                element.render = this._render;\r\n\r\n                geometry.bufferState = this._instanceBufferState;\r\n                geometry.instanceCount = this._drawnums;\r\n            }\r\n        } else {\r\n            let element = this._instanceRenderElementArray[0] = this._instanceRenderElementArray[0] ? this._instanceRenderElementArray[0] : new RenderElement();\r\n            let geometry = this._instanceGeometryArray[0] = this._instanceGeometryArray[0] ? this._instanceGeometryArray[0] : new MeshInstanceGeometry(submeshs[this._subMeshIndex]);\r\n            element.setGeometry(geometry);\r\n            element.transform = this._transform;\r\n            element.material = this._material;\r\n            element.render = this._render;\r\n            element.renderSubShader = this._material._shader.getSubShaderAt(this._subShaderIndex);\r\n            geometry.bufferState = this._instanceBufferState;\r\n            geometry.instanceCount = this._drawnums;\r\n        }\r\n\r\n    }\r\n\r\n    get mesh(): Mesh {\r\n        return this._mesh;\r\n    }\r\n\r\n    /**\r\n * @internal\r\n     */\r\n    private _setInstanceBuffer(): void {\r\n        if (!this._instanceBufferState) {\r\n            this._instanceBufferState = new BufferState();\r\n        }\r\n        let instanceBufferState = this._instanceBufferState;\r\n\r\n        let vertexArray: Array<VertexBuffer> = [];\r\n        let meshVertexBuffer = this._mesh._bufferState._vertexBuffers;\r\n        meshVertexBuffer.forEach(element => {\r\n            vertexArray.push(element);\r\n        });\r\n        vertexArray.push(this._instanceWorldMatrixBuffer);\r\n        let propertyMap = this._instanceProperty._propertyMap;\r\n        for (let i in propertyMap) {\r\n            vertexArray.push(propertyMap[i]._vertexBuffer);\r\n        }\r\n        instanceBufferState.applyState(vertexArray, this._mesh._indexBuffer);\r\n        this._instanceGeometryArray.forEach(element => {\r\n            element.bufferState = instanceBufferState;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * buffer\r\n     * @internal\r\n     */\r\n    private _updateWorldMatrixBuffer() {\r\n        let worldMatrixData: Float32Array = this._instanceWorldMatrixData;\r\n        let count: number = this._drawnums;\r\n        for (let i = 0; i < count; i++) {\r\n            worldMatrixData.set(this._matrixs[i].elements, i * 16);\r\n        }\r\n        let worldBuffer: VertexBuffer3D = this._instanceWorldMatrixBuffer;\r\n        worldBuffer.orphanStorage();\r\n        worldBuffer.setData(worldMatrixData.buffer, 0, 0, count * 64);\r\n    }\r\n\r\n    /**\r\n     * DrawInstance\r\n     * @param worldMatrixArray \r\n     */\r\n    setWorldMatrix(worldMatrixArray: Matrix4x4[]): void {\r\n        if (worldMatrixArray.length < this._drawnums)\r\n            throw \"worldMatrixArray length is less then drawnums\";\r\n        this._matrixs = worldMatrixArray;\r\n        this._matrixs && this._updateWorldMatrixBuffer();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param drawNums \r\n     */\r\n    setDrawNums(drawNums: number): void {\r\n        if (this._matrixs && this._matrixs.length < drawNums)\r\n            throw \"worldMatrixArray length is less then drawnums\";\r\n        this._drawnums = drawNums;\r\n        let submeshs = this._mesh._subMeshes;\r\n        if (this._subMeshIndex == -1) {\r\n            for (let i = 0, n = submeshs.length; i < n; i++) {\r\n                let geometry = this._instanceGeometryArray[i] ? this._instanceGeometryArray[i] : new MeshInstanceGeometry(submeshs[i]);\r\n                geometry.instanceCount = this._drawnums;\r\n            }\r\n        } else {\r\n            let geometry = this._instanceGeometryArray[0] ? this._instanceGeometryArray[0] : new MeshInstanceGeometry(submeshs[0]);\r\n            geometry.instanceCount = this._drawnums;\r\n        }\r\n        this._matrixs && this._updateWorldMatrixBuffer();\r\n    }\r\n\r\n    run(): void {\r\n        //update blockData\r\n        let context = RenderContext3D._instance;\r\n        context._contextOBJ.applyContext(Camera._updateMark);\r\n        let propertyMap = this._instanceProperty._propertyMap;\r\n        for (let i in propertyMap) {\r\n            //Instancebuffer\r\n            propertyMap[i].updateVertexBufferData(this._drawnums);\r\n        }\r\n\r\n        let submeshs = this.mesh._subMeshes\r\n        if (this._subMeshIndex == -1) {\r\n            for (let i = 0, n = submeshs.length; i < n; i++) {\r\n                let element = this._instanceRenderElementArray[i];\r\n                context.drawRenderElement(element);\r\n            }\r\n        } else {\r\n            let element = this._instanceRenderElementArray[0];\r\n            context.drawRenderElement(element);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    recover(): void {\r\n        DrawMeshInstancedCMD._pool.push(this);\r\n        super.recover();\r\n        this._material && this._material._removeReference(1);\r\n        this._material = null;\r\n        this._instanceBufferState.destroy();\r\n        this._instanceBufferState = null;\r\n        delete this._instanceRenderElementArray;\r\n        this._instanceRenderElementArray = [];\r\n        delete this._instanceGeometryArray;\r\n        this._instanceGeometryArray = [];\r\n        this.mesh = null;\r\n\r\n    }\r\n\r\n    destroy(): void {\r\n        super.destroy();\r\n        this._material && this._material._removeReference(1);\r\n        this._material = null;\r\n        this._instanceBufferState.destroy();\r\n        this._instanceBufferState = null;\r\n        delete this._instanceRenderElementArray;\r\n        this._instanceRenderElementArray = [];\r\n        delete this._instanceGeometryArray;\r\n        this._instanceGeometryArray = [];\r\n        this.mesh = null;\r\n    }\r\n\r\n}","\r\nimport { Camera } from \"../../Camera\";\r\nimport { BlitScreenQuadCMD } from \"./BlitScreenQuadCMD\";\r\nimport { SetRenderTargetCMD } from \"./SetRenderTargetCMD\";\r\nimport { Command } from \"./Command\";\r\nimport { BaseTexture } from \"../../../../resource/BaseTexture\";\r\nimport { Mesh } from \"../../../resource/models/Mesh\";\r\nimport { Material } from \"../../../../resource/Material\";\r\nimport { SetShaderDataCMD } from \"./SetShaderDataCMD\";\r\nimport { DrawMeshCMD } from \"./DrawMeshCMD\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { ClearRenderTextureCMD } from \"./ClearRenderTextureCMD\";\r\nimport { BaseRender } from \"../BaseRender\";\r\nimport { DrawRenderCMD } from \"./DrawRenderCMD\";\r\nimport { SetGlobalShaderDataCMD } from \"./SetGlobalShaderDataCMD\";\r\nimport { DrawMeshInstancedCMD } from \"./DrawMeshInstancedCMD\";\r\nimport { MaterialInstancePropertyBlock } from \"./MaterialInstancePropertyBlock\";\r\nimport { RenderCapable } from \"../../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData, ShaderDataType } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Stat } from \"../../../../utils/Stat\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\n\r\n/**\r\n * <code>CommandBuffer</code> \r\n */\r\nexport class CommandBuffer {\r\n\t/**@internal */\r\n\t_name: string\r\n\t/**@internal */\r\n\tprivate _shadow: boolean = false;\r\n\t/**@internal */\r\n\t_camera: Camera = null;\r\n\t/**@internal */\r\n\t_context: RenderContext3D;\r\n\t/**@internal */\r\n\tprivate _commands: Command[] = [];\r\n\r\n\r\n\t/**\r\n\t *  <code>CommandBuffer</code> \r\n\t */\r\n\tconstructor(name: string = null, shadowCaster: boolean = false) {\r\n\t\tthis._name = name;\r\n\t\tthis._shadow = shadowCaster;\r\n\t}\r\n\r\n\tget name(): string {\r\n\t\treturn this._name;\r\n\t}\r\n\r\n\tget casterShadow() {\r\n\t\treturn this._shadow;\r\n\t}\r\n\r\n\tset context(value: RenderContext3D) {\r\n\t\tthis._context = value;\r\n\t}\r\n\r\n\tget context() {\r\n\t\treturn this._context;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\t_apply(): void {\r\n\t\tfor (var i: number = 0, n: number = this._commands.length; i < n; i++)\r\n\t\t\tthis._commands[i].run();\r\n\t\tStat.cmdDrawCall += this._commands.length;\r\n\t}\r\n\r\n\t_applyOne(): boolean {\r\n\t\tif (this._commands.length) {\r\n\t\t\tvar cmd = this._commands.shift();\r\n\t\t\tcmd.run();\r\n\t\t\tcmd.recover();\r\n\t\t}\r\n\t\treturn this._commands.length > 0;\r\n\t}\r\n\r\n\tgetCommandsSize(): number {\r\n\t\treturn this._commands.length;\r\n\t}\r\n\r\n\t/**\r\n\t * shader\r\n\t * @param shaderData shader\r\n\t * @param nameID UniformID\r\n\t * @param source \r\n\t */\r\n\tsetShaderDataTexture(shaderData: ShaderData, nameID: number, source: BaseTexture): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, source, ShaderDataType.Texture2D, this));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param nameID uniformID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalTexture(nameID: number, source: BaseTexture) {\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Texture2D, this));\r\n\t}\r\n\r\n\t/**\r\n\t * shader Vector4\r\n\t * @param shaderData shader\r\n\t * @param nameID ID\r\n\t * @param value \r\n\t */\r\n\tsetShaderDataColor(shaderData: ShaderData, nameID: number, value: Color): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, value, ShaderDataType.Color, this));\r\n\t}\r\n\r\n\t/**\r\n\t * Vector4\r\n\t * @param nameID Vector4ID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalColor(nameID: number, source: Color) {\r\n\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Color, this));\r\n\t}\r\n\r\n\t/**\r\n\t * shader Vector4\r\n\t * @param shaderData shader\r\n\t * @param nameID ID\r\n\t * @param value \r\n\t */\r\n\tsetShaderDataVector(shaderData: ShaderData, nameID: number, value: Vector4): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, value, ShaderDataType.Vector4, this));\r\n\t}\r\n\r\n\t/**\r\n\t * Vector4\r\n\t * @param nameID Vector4ID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalVector(nameID: number, source: Vector4) {\r\n\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Vector4, this));\r\n\t}\r\n\r\n\t/**\r\n\t * shader Vector3\r\n\t * @param shaderData shader\r\n\t * @param nameID ID\r\n\t * @param value \r\n\t */\r\n\tsetShaderDataVector3(shaderData: ShaderData, nameID: number, value: Vector3): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, value, ShaderDataType.Vector3, this));\r\n\t}\r\n\r\n\t/**\r\n\t * Vector3\r\n\t * @param nameID ID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalVector3(nameID: number, source: Vector3) {\r\n\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Vector3, this));\r\n\t}\r\n\r\n\t/**\r\n\t * shader Vector2\r\n\t * @param shaderData shader\r\n\t * @param nameID ID\r\n\t * @param value \r\n\t */\r\n\tsetShaderDataVector2(shaderData: ShaderData, nameID: number, value: Vector2): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, value, ShaderDataType.Vector2, this));\r\n\t}\r\n\r\n\t/**\r\n\t * Vector2\r\n\t * @param nameID ID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalVector2(nameID: number, source: Vector2) {\r\n\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Vector2, this));\r\n\t}\r\n\r\n\t/**\r\n\t * shader Number\r\n\t * @param shaderData shader\r\n\t * @param nameID ID\r\n\t * @param value \r\n\t */\r\n\tsetShaderDataNumber(shaderData: ShaderData, nameID: number, value: number): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, value, ShaderDataType.Float, this));\r\n\t}\r\n\r\n\t/**\r\n\t * number\r\n\t * @param nameID ID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalNumber(nameID: number, source: number) {\r\n\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Float, this));\r\n\t}\r\n\r\n\t/**\r\n\t * shader Int\r\n\t * @param shaderData shader\r\n\t * @param nameID ID\r\n\t * @param value \r\n\t */\r\n\tsetShaderDataInt(shaderData: ShaderData, nameID: number, value: number): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, value, ShaderDataType.Int, this));\r\n\t}\r\n\r\n\t/**\r\n\t * int\r\n\t * @param nameID ID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalInt(nameID: number, source: number) {\r\n\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Int, this));\r\n\t}\r\n\r\n\t/**\r\n\t * shader Matrix\r\n\t * @param shaderData shader\r\n\t * @param nameID ID\r\n\t * @param value \r\n\t */\r\n\tsetShaderDataMatrix(shaderData: ShaderData, nameID: number, value: Matrix4x4): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, value, ShaderDataType.Matrix4x4, this));\r\n\t}\r\n\r\n\tsetShaderDefine(shaderData: ShaderData, define: string, value: boolean): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, define, value, SetShaderDataCMD.ShaderDataType_define, this));\r\n\t}\r\n\r\n\t/**\r\n\t * Matrix\r\n\t * @param nameID ID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalMatrix(nameID: number, source: number) {\r\n\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Matrix4x4, this));\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tsource . null,\r\n\t * @param\tdest  . null\r\n\t * @param\toffsetScale \r\n\t * @param\tshader ,null,\r\n\t * @param\tshaderData ,nullsourceTexture\r\n\t * @param\tsubShader subShader,0\r\n\t */\r\n\tblitScreenQuad(source: BaseTexture, dest: RenderTexture, offsetScale: Vector4 = null, shader: Shader3D = null, shaderData: ShaderData = null, subShader: number = 0): void {\r\n\t\tthis._commands.push(BlitScreenQuadCMD.create(source, dest, offsetScale, shader, shaderData, subShader, BlitScreenQuadCMD._SCREENTYPE_QUAD, this));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param source  null,\r\n\t * @param dest  null\r\n\t * @param offsetScale \r\n\t * @param material \r\n\t * @param subShader shader\r\n\t */\r\n\tblitScreenQuadByMaterial(source: BaseTexture, dest: RenderTexture, offsetScale: Vector4 = null, material: Material = null, subShader: number = 0): void {\r\n\t\tvar shader: Shader3D;\r\n\t\tvar shaderData: ShaderData;\r\n\t\tif (material) {\r\n\t\t\tshader = material._shader;\r\n\t\t\tshaderData = material.shaderData\r\n\t\t}\r\n\t\tthis._commands.push(BlitScreenQuadCMD.create(source, dest, offsetScale, shader, shaderData, subShader, BlitScreenQuadCMD._SCREENTYPE_QUAD, this));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tsource \r\n\t * @param\tdest  \r\n\t * @param\toffsetScale \r\n\t * @param\tshader ,null,\r\n\t * @param\tshaderData ,nullsourceTexture\r\n\t * @param\tsubShader subShader,0\r\n\t */\r\n\tblitScreenTriangle(source: BaseTexture, dest: RenderTexture, offsetScale: Vector4 = null, shader: Shader3D = null, shaderData: ShaderData = null, subShader: number = 0): void {\r\n\t\tthis._commands.push(BlitScreenQuadCMD.create(source, dest, offsetScale, shader, shaderData, subShader, BlitScreenQuadCMD._SCREENTYPE_TRIANGLE, this));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param renderTexture RT\r\n\t */\r\n\tsetRenderTarget(renderTexture: RenderTexture): void {\r\n\t\tthis._commands.push(SetRenderTargetCMD.create(renderTexture));\r\n\t}\r\n\r\n\t/**\r\n\t * clear\r\n\t * @param clearColor \r\n\t * @param clearDepth \r\n\t * @param backgroundColor \r\n\t * @param depth \r\n\t */\r\n\tclearRenderTarget(clearColor: boolean, clearDepth: boolean, backgroundColor: Color, depth: number = 1): void {\r\n\t\tthis._commands.push(ClearRenderTextureCMD.create(clearColor, clearDepth, backgroundColor, depth, this));\r\n\t}\r\n\r\n\t/**\r\n\t * Mesh\r\n\t * @param mesh \r\n\t * @param matrix \r\n\t * @param material \r\n\t * @param submeshIndex  \r\n\t * @param subShaderIndex shader 0\r\n\t */\r\n\tdrawMesh(mesh: Mesh, matrix: Matrix4x4, material: Material, submeshIndex: number, subShaderIndex: number): void {\r\n\t\tthis._commands.push(DrawMeshCMD.create(mesh, matrix, material, submeshIndex, subShaderIndex, this));\r\n\t}\r\n\r\n\t/**\r\n\t * Render\r\n\t * @param render \r\n\t * @param material \r\n\t * @param subShaderIndex shader 0\r\n\t */\r\n\tdrawRender(render: BaseRender, material: Material, subShaderIndex: number): void {\r\n\t\tthis._commands.push(DrawRenderCMD.create(render, material, subShaderIndex, this));\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * instanceMesh\r\n\t * @param mesh \r\n\t * @param subMeshIndex mesh\r\n\t * @param matrixs Mesh,nullBuffer\r\n\t * @param material \r\n\t * @param subShaderIndex shader\r\n\t * @param instanceProperty Instance\r\n\t * @param drawnums \r\n\t */\r\n\tdrawMeshInstance(mesh: Mesh, subMeshIndex: number = 0, matrixs: Matrix4x4[], material: Material, subShaderIndex: number = 0, instanceProperty: MaterialInstancePropertyBlock, drawnums: number): any {\r\n\t\tif (!LayaGL.renderEngine.getCapable(RenderCapable.DrawElement_Instance))\r\n\t\t\treturn null;\r\n\t\tvar drawMeshInstancedCMD = DrawMeshInstancedCMD.create(mesh, subMeshIndex, matrixs, material, subShaderIndex, instanceProperty, drawnums, this);\r\n\t\tthis._commands.push(drawMeshInstancedCMD);\r\n\t\treturn drawMeshInstancedCMD;\r\n\t}\r\n\r\n\t/**\r\n\t * add \r\n\t * @param command \r\n\t */\r\n\taddCustomCMD(command: Command) {\r\n\t\tcommand._commandBuffer = this;\r\n\t\tthis._commands.push(command);\r\n\t}\r\n\r\n\t/**\r\n\t *@internal\r\n\t */\r\n\tclear(): void {\r\n\t\tfor (var i: number = 0, n: number = this._commands.length; i < n; i++)\r\n\t\t\tthis._commands[i].recover();\r\n\t\tthis._commands.length = 0;\r\n\t}\r\n\r\n}","/**\r\n * <code>PhysicsSettings</code> \r\n */\r\nexport class PhysicsSettings {\r\n    /***/\r\n    flags: number = 0;\r\n\r\n    /***/\r\n    maxSubSteps: number = 1;\r\n\r\n    /***/\r\n    fixedTimeStep: number = 1.0 / 60.0;\r\n}\r\n\r\n\r\n","import { Light } from \"./Light\";\r\n\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class LightQueue<T extends Light> {\r\n    _length: number = 0;\r\n    _elements: T[] = [];\r\n\r\n    add(light: T): void {\r\n        let index = this._elements.indexOf(light);\r\n        if (index !=-1 && index < this._length) {\r\n            return;\r\n        }\r\n        if (this._length === this._elements.length)\r\n            this._elements.push(light);\r\n        else\r\n            this._elements[this._length] = light;\r\n        this._length++;\r\n    }\r\n\r\n    remove(light: T): void {\r\n        var index: number = this._elements.indexOf(light);\r\n        if(index == -1)\r\n            return;\r\n        this._length--;\r\n        if (index !== this._length) {\r\n            var end: T = this._elements[this._length];\r\n            this._elements[index] = end;\r\n        }\r\n    }\r\n\r\n    shift(): T | undefined {\r\n        this._length--;\r\n        return this._elements.shift();\r\n    }\r\n\r\n    getBrightestLight(): number | undefined {\r\n        var maxIntIndex;\r\n        var maxIntensity: number = -1;\r\n        var elements: T[] = this._elements;\r\n        for (var i: number = 0; i < this._length; i++) {\r\n            var intensity: number = elements[i]._intensity;\r\n            if (maxIntensity < intensity) {\r\n                maxIntensity = intensity;\r\n                maxIntIndex = i;\r\n            }\r\n        }\r\n        return maxIntIndex;\r\n    }\r\n    normalLightOrdering(brightestIndex: number) {\r\n        var firstLight: T = this._elements[0];\r\n        this._elements[0] = this._elements[brightestIndex];\r\n        this._elements[brightestIndex] = firstLight;\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class AlternateLightQueue extends LightQueue<Light>{\r\n\r\n    remove(light: Light): void {\r\n        //sort must base added time\r\n        var index: number = this._elements.indexOf(light);\r\n        this._elements.splice(index, 1);\r\n        this._length--;\r\n    }\r\n}\r\n","import { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\n\r\n/**\r\n * @internal\r\n * \r\n */\r\nexport class Scene3DShaderDeclaration {\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_FOG: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_FOG_LINEAR: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_FOG_EXP: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_FOG_EXP2: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DIRECTIONLIGHT: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_POINTLIGHT: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SPOTLIGHT: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHADOW: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHADOW_CASCADE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHADOW_SPOT: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH: ShaderDefine;\r\n\r\n}","import { Ray } from \"./Ray\";\r\nimport { CollisionUtils } from \"./CollisionUtils\";\r\nimport { IClone } from \"../../utils/IClone\"\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\n\r\n/**\r\n * <code>BoundSphere</code> \r\n */\r\nexport class BoundSphere implements IClone {\r\n\tprivate static _tempVector3: Vector3 = new Vector3();\r\n\r\n\t/***/\r\n\t_center: Vector3;\r\n\t/***/\r\n\t_radius: number;\r\n\tset center(value: Vector3) {\r\n\t\tvalue.cloneTo(this._center);\r\n\t}\r\n\r\n\tget center() {\r\n\t\treturn this._center;\r\n\t}\r\n\r\n\tset radius(value: number) {\r\n\t\tthis._radius = value;\r\n\t}\r\n\r\n\tget radius(): number {\r\n\t\treturn this._radius\r\n\t}\r\n\t/**\r\n\t *  <code>BoundSphere</code> \r\n\t * @param\tcenter \r\n\t * @param\tradius \r\n\t */\r\n\tconstructor(center: Vector3 = new Vector3, radius: number = 0) {\r\n\t\tthis._center = center;\r\n\t\tthis._radius = radius;\r\n\t}\r\n\r\n\ttoDefault(): void {\r\n\t\tthis._center.toDefault();\r\n\t\tthis._radius = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tpoints \r\n\t * @param\tstart \r\n\t * @param\tcount \r\n\t * @param\tresult \r\n\t */\r\n\tstatic createFromSubPoints(points: Vector3[], start: number, count: number, out: BoundSphere): void {\r\n\t\tif (points == null) {\r\n\t\t\tthrow new Error(\"points\");\r\n\t\t}\r\n\r\n\t\t// Check that start is in the correct range \r\n\t\tif (start < 0 || start >= points.length) {\r\n\t\t\tthrow new Error(\"start\" + start + \"Must be in the range [0, \" + (points.length - 1) + \"]\");\r\n\t\t}\r\n\r\n\t\t// Check that count is in the correct range \r\n\t\tif (count < 0 || (start + count) > points.length) {\r\n\t\t\tthrow new Error(\"count\" + count + \"Must be in the range <= \" + points.length + \"}\");\r\n\t\t}\r\n\r\n\t\tvar upperEnd: number = start + count;\r\n\r\n\t\t//Find the center of all points. \r\n\t\tvar center: Vector3 = BoundSphere._tempVector3;\r\n\t\tcenter.x = 0;\r\n\t\tcenter.y = 0;\r\n\t\tcenter.z = 0;\r\n\t\tfor (var i: number = start; i < upperEnd; ++i) {\r\n\t\t\tVector3.add(points[i], center, center);\r\n\t\t}\r\n\r\n\t\tvar outCenter: Vector3 = out.center;\r\n\t\t//This is the center of our sphere. \r\n\t\tVector3.scale(center, 1 / count, outCenter);\r\n\r\n\t\t//Find the radius of the sphere \r\n\t\tvar radius: number = 0.0;\r\n\t\tfor (i = start; i < upperEnd; ++i) {\r\n\t\t\t//We are doing a relative distance comparison to find the maximum distance \r\n\t\t\t//from the center of our sphere. \r\n\t\t\tvar distance: number = Vector3.distanceSquared(outCenter, points[i]);\r\n\r\n\t\t\tif (distance > radius)\r\n\t\t\t\tradius = distance;\r\n\t\t}\r\n\r\n\t\t//Find the real distance from the DistanceSquared. \r\n\t\tout.radius = Math.sqrt(radius);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tpoints \r\n\t * @param\tresult \r\n\t */\r\n\tstatic createfromPoints(points: Vector3[], out: BoundSphere): void {\r\n\t\tif (points == null) {\r\n\t\t\tthrow new Error(\"points\");\r\n\t\t}\r\n\r\n\t\tBoundSphere.createFromSubPoints(points, 0, points.length, out);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tray \r\n\t * @return -1\r\n\t */\r\n\tintersectsRayDistance(ray: Ray): number {\r\n\t\treturn CollisionUtils.intersectsRayAndSphereRD(ray, this);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tray  \r\n\t * @param\toutPoint \r\n\t * @return  -1\r\n\t */\r\n\tintersectsRayPoint(ray: Ray, outPoint: Vector3): number {\r\n\t\treturn CollisionUtils.intersectsRayAndSphereRP(ray, this, outPoint);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar dest: BoundSphere = (<BoundSphere>destObject);\r\n\t\tthis._center.cloneTo(dest._center);\r\n\t\tdest._radius = this._radius;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: BoundSphere = new BoundSphere(new Vector3(), 0);\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n}\r\n\r\n","import { Plane } from \"../math/Plane\";\r\nimport { ShaderData } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ICameraCullInfo } from \"../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { BoundSphere } from \"../math/BoundSphere\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * @internal\r\n * \r\n */\r\nexport class ShadowSliceData {\r\n    cameraShaderValue: ShaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n    position: Vector3 = new Vector3();\r\n    offsetX: number;\r\n    offsetY: number;\r\n    resolution: number;\r\n    viewMatrix: Matrix4x4 = new Matrix4x4();\r\n    projectionMatrix: Matrix4x4 = new Matrix4x4();\r\n    viewProjectMatrix: Matrix4x4 = new Matrix4x4();\r\n    cullPlanes: Array<Plane> = [new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0)];\r\n    cullPlaneCount: number;\r\n    splitBoundSphere: BoundSphere = new BoundSphere(new Vector3(), 0.0);\r\n    sphereCenterZ: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n * \r\n */\r\nexport class ShadowSpotData {\r\n    cameraShaderValue: ShaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n    position: Vector3 = new Vector3;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    resolution: number;\r\n    viewMatrix: Matrix4x4 = new Matrix4x4();\r\n    projectionMatrix: Matrix4x4 = new Matrix4x4();\r\n    viewProjectMatrix: Matrix4x4 = new Matrix4x4();\r\n    cameraCullInfo: ICameraCullInfo = Laya3DRender.renderOBJCreate.createCameraCullInfo();\r\n\r\n}\r\n","import { Plane } from \"../math/Plane\";\r\nimport { ICameraCullInfo } from \"../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { IShadowCullInfo } from \"../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { Bounds } from \"../math/Bounds\";\r\nimport { ContainmentType } from \"../math/ContainmentType\";\r\nimport { CollisionUtils } from \"../math/CollisionUtils\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * @internal\r\n * <code>FrustumCulling</code> \r\n */\r\nexport class FrustumCulling {\r\n\t/**@internal */\r\n\tstatic _cameraCullInfo: ICameraCullInfo;\r\n\t/**@internal */\r\n\tstatic _shadowCullInfo: IShadowCullInfo;\r\n\t/**@internal */\r\n\tprivate static _tempV30: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempV31: Vector3 = new Vector3();\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tFrustumCulling._cameraCullInfo = Laya3DRender.renderOBJCreate.createCameraCullInfo();\r\n\t\tFrustumCulling._shadowCullInfo = Laya3DRender.renderOBJCreate.createShadowCullInfo();\r\n\t}\r\n\r\n\t// /**\r\n\t//  * @internal\r\n\t//  */\r\n\t// private static _drawTraversalCullingBound(renderList: SingletonList<ISingletonElement>, debugTool: PixelLineSprite3D): void {\r\n\t// \tvar renders: ISingletonElement[] = renderList.elements;\r\n\t// \tfor (var i: number = 0, n: number = renderList.length; i < n; i++) {\r\n\t// \t\tvar color: Color = FrustumCulling._tempColor0;\r\n\t// \t\tcolor.r = 0;\r\n\t// \t\tcolor.g = 1;\r\n\t// \t\tcolor.b = 0;\r\n\t// \t\tcolor.a = 1;\r\n\t// \t\tUtils3D._drawBound(debugTool, ((<BaseRender>renders[i])).bounds._getBoundBox(), color);\r\n\t// \t}\r\n\t// }\r\n\r\n\r\n\t/**\r\n\t * caculate Bounds by ShadowCullInfo\r\n\t * @param bounds \r\n\t * @param cullInfo \r\n\t * @returns \r\n\t */\r\n\tstatic cullingRenderBounds(bounds: Bounds, cullInfo: IShadowCullInfo): boolean {\r\n\t\tvar cullPlaneCount: number = cullInfo.cullPlaneCount;\r\n\t\tvar cullPlanes: Plane[] = cullInfo.cullPlanes;\r\n\r\n\t\tvar min: Vector3 = bounds.getMin();\r\n\t\tvar max: Vector3 = bounds.getMax();\r\n\t\tvar minX: number = min.x;\r\n\t\tvar minY: number = min.y;\r\n\t\tvar minZ: number = min.z;\r\n\t\tvar maxX: number = max.x;\r\n\t\tvar maxY: number = max.y;\r\n\t\tvar maxZ: number = max.z;\r\n\t\t//TODO:pass\r\n\r\n\t\tvar pass: boolean = true;\r\n\t\t// cull by planes\r\n\t\t// Improve:Maybe use sphre and direction cull can savle the far plane cull\r\n\t\tfor (var j: number = 0; j < cullPlaneCount; j++) {\r\n\t\t\tvar plane: Plane = cullPlanes[j];\r\n\t\t\tvar normal: Vector3 = plane.normal;\r\n\t\t\tif (plane.distance + (normal.x * (normal.x < 0.0 ? minX : maxX)) + (normal.y * (normal.y < 0.0 ? minY : maxY)) + (normal.z * (normal.z < 0.0 ? minZ : maxZ)) < 0.0) {\r\n\t\t\t\tpass = false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pass;\r\n\t}\r\n\r\n\t/**\r\n\t * caculate Bounds by ShadowCullInfo\r\n\t * @param bounds \r\n\t * @param cullInfo \r\n\t * @returns \r\n\t */\r\n\tstatic cullingRenderBoundsState(bounds: Bounds, cullInfo: IShadowCullInfo): ContainmentType {\r\n\t\tvar p: Vector3 = FrustumCulling._tempV30, n: Vector3 = FrustumCulling._tempV31;\r\n\t\tvar boxMin: Vector3 = bounds.min;\r\n\t\tvar boxMax: Vector3 = bounds.max;\r\n\t\tvar result: number = ContainmentType.Contains;\r\n\t\tfor (var i = 0, nn = cullInfo.cullPlaneCount; i < nn; i++) {\r\n\t\t\tvar plane: Plane = cullInfo.cullPlanes[i];\r\n\t\t\tvar planeNor: Vector3 = plane.normal;\r\n\r\n\t\t\tif (planeNor.x >= 0) {\r\n\t\t\t\tp.x = boxMax.x;\r\n\t\t\t\tn.x = boxMin.x;\r\n\t\t\t} else {\r\n\t\t\t\tp.x = boxMin.x;\r\n\t\t\t\tn.x = boxMax.x;\r\n\t\t\t}\r\n\t\t\tif (planeNor.y >= 0) {\r\n\t\t\t\tp.y = boxMax.y;\r\n\t\t\t\tn.y = boxMin.y;\r\n\t\t\t} else {\r\n\t\t\t\tp.y = boxMin.y;\r\n\t\t\t\tn.y = boxMax.y;\r\n\t\t\t}\r\n\t\t\tif (planeNor.z >= 0) {\r\n\t\t\t\tp.z = boxMax.z;\r\n\t\t\t\tn.z = boxMin.z;\r\n\t\t\t} else {\r\n\t\t\t\tp.z = boxMin.z;\r\n\t\t\t\tn.z = boxMax.z;\r\n\t\t\t}\r\n\r\n\t\t\tif (CollisionUtils.intersectsPlaneAndPoint(plane, p) === Plane.PlaneIntersectionType_Back)\r\n\t\t\t\treturn ContainmentType.Disjoint;\r\n\r\n\t\t\tif (CollisionUtils.intersectsPlaneAndPoint(plane, n) === Plane.PlaneIntersectionType_Back)\r\n\t\t\t\tresult = ContainmentType.Intersects;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\r\n}\r\n\r\n","import { BaseCamera } from \"../core/BaseCamera\";\r\nimport { Camera } from \"../core/Camera\";\r\nimport { ShadowCascadesMode } from \"../core/light/ShadowCascadesMode\";\r\nimport { ShadowMode } from \"../core/light/ShadowMode\";\r\nimport { ShadowMapFormat, ShadowUtils } from \"../core/light/ShadowUtils\";\r\nimport { RenderContext3D } from \"../core/render/RenderContext3D\";\r\nimport { Scene3DShaderDeclaration } from \"../core/scene/Scene3DShaderDeclaration\";\r\nimport { Plane } from \"../math/Plane\";\r\nimport { Light, LightType } from \"../core/light/Light\";\r\nimport { DirectionLightCom } from \"../core/light/DirectionLightCom\";\r\nimport { Sprite3D } from \"../core/Sprite3D\";\r\nimport { SpotLightCom } from \"../core/light/SpotLightCom\";\r\nimport { Config3D } from \"../../../Config3D\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData, ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { UnifromBufferData } from \"../../RenderEngine/UniformBufferData\";\r\nimport { UniformBufferObject } from \"../../RenderEngine/UniformBufferObject\";\r\nimport { BoundFrustum } from \"../math/BoundFrustum\";\r\nimport { ShadowSliceData, ShadowSpotData } from \"./ShadowSliceData\";\r\nimport { RenderClearFlag } from \"../../RenderEngine/RenderEnum/RenderClearFlag\";\r\nimport { Viewport } from \"../math/Viewport\";\r\nimport { IShadowCullInfo } from \"../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { FrustumCulling } from \"../graphics/FrustumCulling\";\r\nimport { BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { Stat } from \"../../utils/Stat\";\r\nimport { ShadowLightType } from \"./ShadowLightType\";\r\nimport { DepthCasterData } from \"../depthMap/DepthCasterData\";\r\nimport { MathUtils3D } from \"../../maths/MathUtils3D\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../resource/RenderTexture\";\r\nimport { Scene3D } from \"../core/scene/Scene3D\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\n\r\n/**\r\n * @internal\r\n * <code>ShadowCasterPass</code> \r\n */\r\nexport class ShadowCasterPass {\r\n    /**@internal */\r\n    private static _tempVector30: Vector3 = new Vector3();\r\n    /**@internal */\r\n    private static _tempVector4: Vector4 = new Vector4();\r\n    /**@internal */\r\n    private static _tempMatrix0: Matrix4x4 = new Matrix4x4();\r\n    /** @internal */\r\n    static SHADOW_BIAS: number;\r\n    /** @internal */\r\n    static SHADOW_LIGHT_DIRECTION: number;\r\n    /** @internal */\r\n    static SHADOW_SPLIT_SPHERES: number;\r\n    /** @internal */\r\n    static SHADOW_MATRICES: number;\r\n    /** @internal */\r\n    static SHADOW_MAP_SIZE: number;\r\n    /** @internal */\r\n    static SHADOW_MAP: number;\r\n    /** @internal */\r\n    static SHADOW_PARAMS: number;\r\n    /** @internal */\r\n    static SHADOW_SPOTMAP_SIZE: number;\r\n    /** @internal */\r\n    static SHADOW_SPOTMAP: number;\r\n    /** @internal */\r\n    static SHADOW_SPOTMATRICES: number;\r\n    /** @internal */\r\n    private static _maxCascades: number = 4;\r\n    /**@internal */\r\n    private static _cascadesSplitDistance: number[] = new Array(ShadowCasterPass._maxCascades + 1);\r\n    /** @internal */\r\n    private static _frustumPlanes: Plane[] = new Array();\r\n\r\n    /**\r\n     * @internal\r\n     * init Scene UniformMap\r\n     */\r\n    static __init__() {\r\n        ShadowCasterPass._frustumPlanes = new Array(new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0));\r\n        ShadowCasterPass.SHADOW_BIAS = Shader3D.propertyNameToID(\"u_ShadowBias\");\r\n        ShadowCasterPass.SHADOW_LIGHT_DIRECTION = Shader3D.propertyNameToID(\"u_ShadowLightDirection\");\r\n        ShadowCasterPass.SHADOW_SPLIT_SPHERES = Shader3D.propertyNameToID(\"u_ShadowSplitSpheres\");\r\n        ShadowCasterPass.SHADOW_MATRICES = Shader3D.propertyNameToID(\"u_ShadowMatrices\");\r\n        ShadowCasterPass.SHADOW_MAP_SIZE = Shader3D.propertyNameToID(\"u_ShadowMapSize\");\r\n        ShadowCasterPass.SHADOW_MAP = Shader3D.propertyNameToID(\"u_ShadowMap\");\r\n        ShadowCasterPass.SHADOW_PARAMS = Shader3D.propertyNameToID(\"u_ShadowParams\");\r\n        ShadowCasterPass.SHADOW_SPOTMAP_SIZE = Shader3D.propertyNameToID(\"u_SpotShadowMapSize\");\r\n        ShadowCasterPass.SHADOW_SPOTMAP = Shader3D.propertyNameToID(\"u_SpotShadowMap\");\r\n        ShadowCasterPass.SHADOW_SPOTMATRICES = Shader3D.propertyNameToID(\"u_SpotViewProjectMatrix\");\r\n\r\n        const sceneUniformMap = LayaGL.renderOBJCreate.createGlobalUniformMap(\"Scene3D\");\r\n\r\n        if (Config3D._uniformBlock) {\r\n            sceneUniformMap.addShaderBlockUniform(Shader3D.propertyNameToID(UniformBufferObject.UBONAME_SHADOW), UniformBufferObject.UBONAME_SHADOW, [\r\n                {\r\n                    id: ShadowCasterPass.SHADOW_BIAS,\r\n                    propertyName: \"u_ShadowBias\",\r\n                    uniformtype: ShaderDataType.Vector4\r\n\r\n                },\r\n                {\r\n                    id: ShadowCasterPass.SHADOW_LIGHT_DIRECTION,\r\n                    propertyName: \"u_ShadowLightDirection\",\r\n                    uniformtype: ShaderDataType.Vector3\r\n                }\r\n            ])\r\n        }else{\r\n            sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_BIAS, \"u_ShadowBias\",ShaderDataType.Vector4);\r\n            sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_LIGHT_DIRECTION, \"u_ShadowLightDirection\",ShaderDataType.Vector3);\r\n        }\r\n\r\n\r\n        \r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_SPLIT_SPHERES, \"u_ShadowSplitSpheres\",ShaderDataType.Vector4);\r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_MATRICES, \"u_ShadowMatrices\",ShaderDataType.Matrix4x4);\r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_MAP_SIZE, \"u_ShadowMapSize\",ShaderDataType.Vector4);\r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_MAP, \"u_ShadowMap\",ShaderDataType.Texture2D);\r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_PARAMS, \"u_ShadowParams\",ShaderDataType.Vector4);\r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_SPOTMAP_SIZE, \"u_SpotShadowMapSize\",ShaderDataType.Vector4);\r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_SPOTMAP, \"u_SpotShadowMap\",ShaderDataType.Texture2D);\r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_SPOTMATRICES, \"u_SpotViewProjectMatrix\",ShaderDataType.Matrix4x4);\r\n        //sceneUniformMap.addShaderUniform(Shader3D.propertyNameToID(UniformBufferObject.UBONAME_SHADOW), UniformBufferObject.UBONAME_SHADOW);\r\n    }\r\n\r\n\r\n\r\n    /** @internal */\r\n    private _shadowBias: Vector4 = new Vector4();\r\n    /** @internal */\r\n    private _shadowParams: Vector4 = new Vector4();\r\n    /** @internal */\r\n    private _shadowMapSize: Vector4 = new Vector4();\r\n    /** @internal */\r\n    private _shadowSpotMapSize: Vector4 = new Vector4();\r\n    /** @internal */\r\n    private _shadowMatrices: Float32Array = new Float32Array(16 * (ShadowCasterPass._maxCascades));\r\n    /** @internal */\r\n    private _shadowSpotMatrices: Matrix4x4 = new Matrix4x4();\r\n    /**@internal */\r\n    private _splitBoundSpheres: Float32Array = new Float32Array(ShadowCasterPass._maxCascades * 4);\r\n    /** @internal */\r\n    private _cascadeCount: number = 0;\r\n    /** @internal */\r\n    private _shadowMapWidth: number = 0;\r\n    /** @internal */\r\n    private _shadowMapHeight: number = 0;\r\n    /** @internal */\r\n    private _shadowDirectLightMap: RenderTexture;\r\n    /** @internal */\r\n    private _shadowSpotLightMap: RenderTexture;\r\n    /** @internal */\r\n    private _shadowSliceDatas: ShadowSliceData[] = [new ShadowSliceData(), new ShadowSliceData(), new ShadowSliceData(), new ShadowSliceData()];\r\n    /** @internal */\r\n    private _shadowSpotData: ShadowSpotData = new ShadowSpotData();\r\n    /**@internal */\r\n    private _light: Light;\r\n    /** @internal */\r\n    private _lightUp: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private _lightSide: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private _lightForward: Vector3 = new Vector3();\r\n    /** @internal */\r\n    _castDepthBufferData: UnifromBufferData;\r\n    _castDepthBufferOBJ: UniformBufferObject;\r\n\r\n    _castDepthCameraBufferData: UnifromBufferData;\r\n    _castDepthCameraBufferOBJ: UniformBufferObject;\r\n\r\n    constructor() {\r\n        this._shadowSpotData.cameraCullInfo.boundFrustum = new BoundFrustum(new Matrix4x4());\r\n        if (Config3D._uniformBlock) {\r\n            this._castDepthBufferData = DepthCasterData.createDepthCasterUniformBlock();\r\n            this._castDepthBufferOBJ = UniformBufferObject.getBuffer(UniformBufferObject.UBONAME_SHADOW, 0);\r\n            if (!this._castDepthBufferOBJ) {\r\n                this._castDepthBufferOBJ = UniformBufferObject.create(UniformBufferObject.UBONAME_SHADOW, BufferUsage.Dynamic, this._castDepthBufferData.getbyteLength(), true);\r\n            }\r\n            BaseCamera.createCameraUniformBlock();\r\n            this._castDepthCameraBufferData = BaseCamera.CameraUBOData.clone();\r\n            this._castDepthCameraBufferOBJ = UniformBufferObject.getBuffer(UniformBufferObject.UBONAME_CAMERA, 1);\r\n            if (!this._castDepthCameraBufferOBJ) {\r\n                this._castDepthCameraBufferOBJ = UniformBufferObject.create(UniformBufferObject.UBONAME_CAMERA, BufferUsage.Dynamic, this._castDepthCameraBufferData.getbyteLength(), false);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param context \r\n     * @param shaderValues \r\n     * @param shadowSliceData \r\n     * @param LightParam \r\n     * @param shadowparams \r\n     * @param shadowBias \r\n     * @param lightType \r\n     */\r\n    private _setupShadowCasterShaderValues(context: RenderContext3D, shaderValues: ShaderData, shadowSliceData: any, LightParam: Vector3, shadowparams: Vector4, shadowBias: Vector4, lightType: LightType): void {\r\n        //shaderValues.setVector(ShadowCasterPass.SHADOW_BIAS, shadowBias);\r\n        shaderValues.setVector(ShadowCasterPass.SHADOW_BIAS, shadowBias);\r\n        switch (lightType) {\r\n            case LightType.Directional:\r\n                shaderValues.setVector3(ShadowCasterPass.SHADOW_LIGHT_DIRECTION, LightParam);\r\n                //this._setcommandBlockData(ShadowCasterPass.SHADOW_LIGHT_DIRECTION, LightParam);\r\n                break;\r\n            case LightType.Spot:\r\n                shaderValues.setVector(ShadowCasterPass.SHADOW_PARAMS, shadowparams);\r\n                break;\r\n            case LightType.Point:\r\n                break;\r\n        }\r\n        var cameraSV: ShaderData = shadowSliceData.cameraShaderValue;//TODO:should optimization with shader upload.\r\n        if (this._castDepthCameraBufferOBJ) {\r\n            cameraSV._addCheckUBO(UniformBufferObject.UBONAME_CAMERA, this._castDepthCameraBufferOBJ, this._castDepthCameraBufferData);\r\n            cameraSV.setUniformBuffer(BaseCamera.CAMERAUNIFORMBLOCK, this._castDepthCameraBufferOBJ);\r\n        }\r\n\r\n        cameraSV.setMatrix4x4(BaseCamera.VIEWMATRIX, shadowSliceData.viewMatrix);\r\n        cameraSV.setMatrix4x4(BaseCamera.PROJECTMATRIX, shadowSliceData.projectionMatrix);\r\n        cameraSV.setMatrix4x4(BaseCamera.VIEWPROJECTMATRIX, shadowSliceData.viewProjectMatrix);\r\n        shaderValues.setMatrix4x4(BaseCamera.VIEWPROJECTMATRIX, shadowSliceData.viewProjectMatrix);\r\n        context.viewMatrix = shadowSliceData.viewMatrix;\r\n        context.projectionMatrix = shadowSliceData.projectionMatrix;\r\n        context.projectionViewMatrix = shadowSliceData.viewProjectMatrix;\r\n        //this._castDepthBufferOBJ && shaderValues.setUniformBuffer(Shader3D.propertyNameToID(UniformBufferObject.UBONAME_SHADOW), this._castDepthBufferOBJ);\r\n    }\r\n\r\n\r\n    /**\r\n     *\r\n     * @internal\r\n     * @param shaderValues \r\n     */\r\n    private _setupShadowReceiverShaderValues(shaderValues: ShaderData): void {\r\n        var light: DirectionLightCom = <DirectionLightCom>this._light;\r\n        if (light.shadowCascadesMode !== ShadowCascadesMode.NoCascades)\r\n            shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_CASCADE);\r\n        else\r\n            shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_CASCADE);\r\n        switch (light.shadowMode) {\r\n            case ShadowMode.Hard:\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW);\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH);\r\n                break;\r\n            case ShadowMode.SoftLow:\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW);\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH);\r\n                break;\r\n            case ShadowMode.SoftHigh:\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH);\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW);\r\n                break;\r\n        }\r\n        shaderValues.setTexture(ShadowCasterPass.SHADOW_MAP, this._shadowDirectLightMap);\r\n        shaderValues.setBuffer(ShadowCasterPass.SHADOW_MATRICES, this._shadowMatrices);\r\n        shaderValues.setVector(ShadowCasterPass.SHADOW_MAP_SIZE, this._shadowMapSize);\r\n        shaderValues.setVector(ShadowCasterPass.SHADOW_PARAMS, this._shadowParams);\r\n        shaderValues.setBuffer(ShadowCasterPass.SHADOW_SPLIT_SPHERES, this._splitBoundSpheres);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param shaderValues \r\n     */\r\n    private _setupSpotShadowReceiverShaderValues(shaderValues: ShaderData): void {\r\n        var spotLight: SpotLightCom = <SpotLightCom>this._light;\r\n        switch (spotLight.shadowMode) {\r\n            case ShadowMode.Hard:\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH);\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW);\r\n                break;\r\n            case ShadowMode.SoftLow:\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW);\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH);\r\n                break;\r\n            case ShadowMode.SoftHigh:\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH);\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW);\r\n                break;\r\n        }\r\n        shaderValues.setTexture(ShadowCasterPass.SHADOW_SPOTMAP, this._shadowSpotLightMap);\r\n        shaderValues.setMatrix4x4(ShadowCasterPass.SHADOW_SPOTMATRICES, this._shadowSpotMatrices)\r\n        shaderValues.setVector(ShadowCasterPass.SHADOW_SPOTMAP_SIZE, this._shadowSpotMapSize);\r\n        shaderValues.setVector(ShadowCasterPass.SHADOW_PARAMS, this._shadowParams);\r\n    }\r\n\r\n    // /**\r\n    //  * set castDepthBuffer data\r\n    //  */\r\n    // private _setcommandBlockData(index: number, value: any) {\r\n    // \tif (this._castDepthBufferData && this._castDepthBufferData._has(index))\r\n    // \t\tthis._castDepthBufferData._setData(index, value);\r\n    // }\r\n\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param camera \r\n     * @param light \r\n     * @param lightType \r\n     */\r\n    update(camera: Camera, light: Light, lightType: ShadowLightType): void {\r\n        this.cleanUp();\r\n        switch (lightType) {\r\n            case ShadowLightType.DirectionLight:\r\n                this._light = light;\r\n                var lightWorld: Matrix4x4 = ShadowCasterPass._tempMatrix0;\r\n                var lightWorldE: Float32Array = lightWorld.elements;\r\n                var lightUp: Vector3 = this._lightUp;\r\n                var lightSide: Vector3 = this._lightSide;\r\n                var lightForward: Vector3 = this._lightForward;\r\n                //  \r\n                Matrix4x4.createFromQuaternion((light.owner as Sprite3D)._transform.rotation, lightWorld);//to remove scale problem\r\n                lightSide.setValue(lightWorldE[0], lightWorldE[1], lightWorldE[2]);\r\n                lightUp.setValue(lightWorldE[4], lightWorldE[5], lightWorldE[6]);\r\n                lightForward.setValue(-lightWorldE[8], -lightWorldE[9], -lightWorldE[10]);\r\n                //\r\n                var atlasResolution: number = light._shadowResolution;\r\n                var cascadesMode: ShadowCascadesMode = (<DirectionLightCom>light)._shadowCascadesMode;\r\n                var cascadesCount: number;\r\n                var shadowTileResolution: number;\r\n                var shadowMapWidth: number, shadowMapHeight: number;\r\n                if (cascadesMode == ShadowCascadesMode.NoCascades) {\r\n                    cascadesCount = 1;\r\n                    shadowTileResolution = atlasResolution;\r\n                    shadowMapWidth = atlasResolution;\r\n                    shadowMapHeight = atlasResolution;\r\n                }\r\n                else {\r\n                    cascadesCount = cascadesMode == ShadowCascadesMode.TwoCascades ? 2 : 4;\r\n                    shadowTileResolution = ShadowUtils.getMaxTileResolutionInAtlas(atlasResolution, atlasResolution, cascadesCount);\r\n                    shadowMapWidth = shadowTileResolution * 2;\r\n                    shadowMapHeight = cascadesMode == ShadowCascadesMode.TwoCascades ? shadowTileResolution : shadowTileResolution * 2;\r\n                }\r\n                this._cascadeCount = cascadesCount;\r\n                this._shadowMapWidth = shadowMapWidth;\r\n                this._shadowMapHeight = shadowMapHeight;\r\n\r\n                var splitDistance: number[] = ShadowCasterPass._cascadesSplitDistance;\r\n                var frustumPlanes: Plane[] = ShadowCasterPass._frustumPlanes;\r\n                var cameraNear: number = camera.nearPlane;\r\n                var shadowFar: number = Math.min(camera.farPlane, light._shadowDistance);\r\n                var shadowMatrices: Float32Array = this._shadowMatrices;\r\n                var boundSpheres: Float32Array = this._splitBoundSpheres;\r\n                ShadowUtils.getCascadesSplitDistance((<DirectionLightCom>light)._shadowTwoCascadeSplits, (<DirectionLightCom>light)._shadowFourCascadeSplits, cameraNear, shadowFar, camera.fieldOfView * MathUtils3D.Deg2Rad, camera.aspectRatio, cascadesMode, splitDistance);\r\n                ShadowUtils.getCameraFrustumPlanes(camera.projectionViewMatrix, frustumPlanes);\r\n                var forward: Vector3 = ShadowCasterPass._tempVector30;\r\n                camera._transform.getForward(forward);\r\n                Vector3.normalize(forward, forward);\r\n                for (var i: number = 0; i < cascadesCount; i++) {\r\n                    var sliceData: ShadowSliceData = this._shadowSliceDatas[i];\r\n                    sliceData.sphereCenterZ = ShadowUtils.getBoundSphereByFrustum(splitDistance[i], splitDistance[i + 1], camera.fieldOfView * MathUtils3D.Deg2Rad, camera.aspectRatio, camera._transform.position, forward, sliceData.splitBoundSphere);\r\n                    ShadowUtils.getDirectionLightShadowCullPlanes(frustumPlanes, i, splitDistance, cameraNear, lightForward, sliceData);\r\n                    ShadowUtils.getDirectionalLightMatrices(lightUp, lightSide, lightForward, i, light._shadowNearPlane, shadowTileResolution, sliceData, shadowMatrices);\r\n                    if (cascadesCount > 1)\r\n                        ShadowUtils.applySliceTransform(sliceData, shadowMapWidth, shadowMapHeight, i, shadowMatrices);\r\n                }\r\n                ShadowUtils.prepareShadowReceiverShaderValues((<DirectionLightCom>light), shadowMapWidth, shadowMapHeight, this._shadowSliceDatas, cascadesCount, this._shadowMapSize, this._shadowParams, shadowMatrices, boundSpheres);\r\n                break;\r\n            case ShadowLightType.SpotLight:\r\n                this._light = light;\r\n                var lightWorld: Matrix4x4 = ShadowCasterPass._tempMatrix0;\r\n                var lightForward: Vector3 = this._lightForward;\r\n                var shadowResolution: number = this._light._shadowResolution;\r\n                this._shadowMapWidth = shadowResolution;\r\n                this._shadowMapHeight = shadowResolution;\r\n                var shadowSpotData: ShadowSpotData = this._shadowSpotData;\r\n                ShadowUtils.getSpotLightShadowData(shadowSpotData, <SpotLightCom>this._light, shadowResolution, this._shadowParams, this._shadowSpotMatrices, this._shadowSpotMapSize);\r\n                break;\r\n            case ShadowLightType.PointLight:\r\n                //TODO:\r\n                break;\r\n            default:\r\n                throw (\"There is no shadow of this type\")\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param context \r\n     * @param scene 3DScene\r\n     * @param lightType \r\n     */\r\n    render(context: RenderContext3D, scene: Scene3D, lightType: ShadowLightType, camera: Camera): void {\r\n        switch (lightType) {\r\n            case ShadowLightType.DirectionLight:\r\n                var shaderValues: ShaderData = scene._shaderValues;\r\n                context.pipelineMode = \"ShadowCaster\";\r\n                var shadowMap: RenderTexture = this._shadowDirectLightMap = ShadowUtils.getTemporaryShadowTexture(this._shadowMapWidth, this._shadowMapHeight, ShadowMapFormat.bit16);\r\n                shadowMap._start();\r\n                context.destTarget = shadowMap;\r\n                var light: DirectionLightCom = <DirectionLightCom>this._light;\r\n                for (var i: number = 0, n: number = this._cascadeCount; i < n; i++) {\r\n                    var sliceData: ShadowSliceData = this._shadowSliceDatas[i];\r\n                    ShadowUtils.getShadowBias(light, sliceData.projectionMatrix, sliceData.resolution, this._shadowBias);\r\n                    this._setupShadowCasterShaderValues(context, shaderValues, sliceData, this._lightForward, this._shadowParams, this._shadowBias, LightType.Directional);\r\n                    var shadowCullInfo: IShadowCullInfo = FrustumCulling._shadowCullInfo;\r\n                    shadowCullInfo.position = sliceData.position;\r\n                    shadowCullInfo.cullPlanes = sliceData.cullPlanes;\r\n                    shadowCullInfo.cullPlaneCount = sliceData.cullPlaneCount;\r\n                    shadowCullInfo.cullSphere = sliceData.splitBoundSphere;\r\n                    shadowCullInfo.direction = this._lightForward;\r\n                    //cull\r\n                    scene._directLightShadowCull(shadowCullInfo, context);\r\n                    context.cameraShaderValue = sliceData.cameraShaderValue;\r\n                    Camera._updateMark++;\r\n\r\n                    var resolution: number = sliceData.resolution;\r\n                    var offsetX: number = sliceData.offsetX;\r\n                    var offsetY: number = sliceData.offsetY;\r\n\r\n                    LayaGL.renderEngine.viewport(offsetX, offsetY, resolution, resolution);\r\n                    LayaGL.renderEngine.scissor(offsetX, offsetY, resolution, resolution);\r\n\r\n                    LayaGL.renderEngine.clearRenderTexture(RenderClearFlag.Depth, null, 1);\r\n                    if (scene._opaqueQueue.elements.length > 0) {// if one cascade have anything to render.\r\n                        Viewport._tempViewport.set(offsetX, offsetY, resolution, resolution);\r\n                        ShadowCasterPass._tempVector4.setValue(offsetX + 1, offsetY + 1, resolution - 2, resolution - 2);\r\n                        context.viewport = Viewport._tempViewport;\r\n                        context.scissor = ShadowCasterPass._tempVector4;\r\n                        Stat.depthCastDrawCall += scene._opaqueQueue.renderQueue(context);//\r\n                    }\r\n                    camera._applyCasterPassCommandBuffer(context);\r\n                }\r\n                shadowMap._end();\r\n                this._setupShadowReceiverShaderValues(shaderValues);\r\n                context.pipelineMode = context.configPipeLineMode;\r\n                break;\r\n            case ShadowLightType.SpotLight:\r\n                var shaderValues: ShaderData = scene._shaderValues;\r\n                context.pipelineMode = \"ShadowCaster\";\r\n                var spotlight: SpotLightCom = <SpotLightCom>this._light;\r\n                var shadowMap: RenderTexture = this._shadowSpotLightMap = ShadowUtils.getTemporaryShadowTexture(this._shadowMapWidth, this._shadowMapHeight, ShadowMapFormat.bit16);\r\n                shadowMap._start();\r\n                context.destTarget = shadowMap;\r\n                var shadowSpotData: ShadowSpotData = this._shadowSpotData;\r\n                ShadowUtils.getShadowBias(spotlight, shadowSpotData.projectionMatrix, shadowSpotData.resolution, this._shadowBias);\r\n                this._setupShadowCasterShaderValues(context, shaderValues, shadowSpotData, (this._light.owner as Sprite3D).transform.position, this._shadowParams, this._shadowBias, LightType.Spot);\r\n                scene._sportLightShadowCull(shadowSpotData.cameraCullInfo, context);\r\n                context.cameraShaderValue = shadowSpotData.cameraShaderValue;\r\n                Camera._updateMark++;\r\n\r\n                LayaGL.renderEngine.viewport(shadowSpotData.offsetX, shadowSpotData.offsetY, shadowSpotData.resolution, shadowSpotData.resolution);\r\n                LayaGL.renderEngine.scissor(shadowSpotData.offsetX, shadowSpotData.offsetY, shadowSpotData.resolution, shadowSpotData.resolution);\r\n                LayaGL.renderEngine.clearRenderTexture(RenderClearFlag.Depth, null, 1);\r\n\r\n                if (scene._opaqueQueue.elements.length > 0) {\r\n                    context.changeViewport(shadowSpotData.offsetX, shadowSpotData.offsetY, shadowSpotData.resolution, shadowSpotData.resolution);\r\n                    context.changeScissor(shadowSpotData.offsetX, shadowSpotData.offsetY, shadowSpotData.resolution, shadowSpotData.resolution);\r\n                    Stat.depthCastDrawCall += scene._opaqueQueue.renderQueue(context);//\r\n                }\r\n                camera._applyCasterPassCommandBuffer(context);\r\n                shadowMap._end();\r\n                this._setupSpotShadowReceiverShaderValues(shaderValues);\r\n                context.pipelineMode = context.configPipeLineMode;\r\n                break;\r\n            case ShadowLightType.PointLight:\r\n                //TODO:\r\n                break;\r\n            default:\r\n                throw (\"There is no shadow of this type\");\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     */\r\n    cleanUp(): void {\r\n        this._shadowDirectLightMap && RenderTexture.recoverToPool(this._shadowDirectLightMap);\r\n        this._shadowSpotLightMap && RenderTexture.recoverToPool(this._shadowSpotLightMap);\r\n        this._shadowDirectLightMap = null;\r\n        this._shadowSpotLightMap = null;\r\n        this._light = null;\r\n    }\r\n}\r\n\r\n","import { BaseTexture } from \"../../../../resource/BaseTexture\";\r\nimport { Viewport } from \"../../../math/Viewport\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { ScreenQuad } from \"../ScreenQuad\";\r\nimport { Command } from \"./Command\";\r\nimport { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { RenderElement } from \"../RenderElement\";\r\nimport { Transform3D } from \"../../Transform3D\";\r\nimport { Camera } from \"../../Camera\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\nimport { ShaderPass } from \"../../../../RenderEngine/RenderShader/ShaderPass\";\r\nimport { SubShader } from \"../../../../RenderEngine/RenderShader/SubShader\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\nimport { Laya3DRender } from \"../../../RenderObjs/Laya3DRender\";\r\n\r\n\r\n/**\r\n * \r\n */\r\nexport class BlitFrameBufferCMD {\r\n\t/**@internal */\r\n\tprivate static _pool: any[] = [];\r\n\t/** @internal */\r\n\tprivate static _defaultOffsetScale: Vector4 = new Vector4(0, 0, 1, 1);\r\n\t/** @internal */\r\n\tstatic shaderdata: ShaderData;\r\n\r\n\t/** @internal */\r\n\tstatic __init__(): void {\r\n\t\tBlitFrameBufferCMD.shaderdata = LayaGL.renderOBJCreate.createShaderData(null);\r\n\t}\r\n\r\n\t/**\r\n   * \r\n   * @param source \r\n   * @param dest \r\n   * @param viewport \r\n   * @param offsetScale \r\n   * @param shader \r\n   * @param shaderData \r\n   * @param subShader \r\n   */\r\n\tstatic create(source: BaseTexture, dest: RenderTexture, viewport: Viewport, offsetScale: Vector4 = null, shader: Shader3D = null, shaderData: ShaderData = null, subShader: number = 0) {\r\n\t\tvar cmd: BlitFrameBufferCMD;\r\n\t\tcmd = BlitFrameBufferCMD._pool.length > 0 ? BlitFrameBufferCMD._pool.pop() : new BlitFrameBufferCMD();\r\n\t\tcmd._source = source;\r\n\t\tcmd._dest = dest;\r\n\t\tcmd._offsetScale = offsetScale;\r\n\t\tcmd.setshader(shader, subShader, shaderData);\r\n\t\tcmd._source && cmd._texture_size.setValue(source.width, source.height, 1.0 / source.width, 1.0 / source.height);\r\n\t\t//cmd._shader = shader;\r\n\t\t//cmd._shaderData = shaderData;\r\n\t\t//cmd._subShader = subShader;\r\n\t\tcmd._viewPort = viewport;\r\n\t\treturn cmd;\r\n\t}\r\n\t/**@internal source */\r\n\tprivate _source: BaseTexture = null;\r\n\t/**@internal dest  null*/\r\n\tprivate _dest: RenderTexture = null;\r\n\t/**@internal */\r\n\tprivate _offsetScale: Vector4 = null;\r\n\t/**@internal */\r\n\t_texture_size: Vector4 = null;\r\n\t/**@internal shader*/\r\n\tprivate _shader: Shader3D = null;\r\n\t/**@internal */\r\n\tprivate _shaderData: ShaderData = null;\r\n\t/**@internal subshader*/\r\n\tprivate _subShader: number = 0;\r\n\t/**@internal */\r\n\tprivate _viewPort: Viewport = null;\r\n\t// /**@internal */\r\n\t// private _sourceTexelSize: Vector4 = new Vector4();\r\n\t/**@internal */\r\n\tprivate _renderElement: RenderElement;\r\n\t/**@internal */\r\n\tprivate _transform3D: Transform3D;\r\n\tconstructor() {\r\n\t\tthis._transform3D = Laya3DRender.renderOBJCreate.createTransform(null);\r\n\t\tthis._renderElement = new RenderElement();\r\n\t\tthis._renderElement.setTransform(this._transform3D);\r\n\t\tthis._renderElement.setGeometry(ScreenQuad.instance);\r\n\t\tthis._texture_size = new Vector4();\r\n\t}\r\n\r\n\tset shaderData(value: ShaderData) {\r\n\t\tthis._shaderData = value || BlitFrameBufferCMD.shaderdata;\r\n\t\tthis._renderElement._renderElementOBJ._materialShaderData = this._shaderData;\r\n\t}\r\n\r\n\tsetshader(shader: Shader3D, subShader: number, shaderData: ShaderData) {\r\n\t\tthis._shader = shader || Command._screenShader;\r\n\t\tthis._subShader = subShader || 0;\r\n\t\tthis.shaderData = shaderData;\r\n\t\tthis._renderElement.renderSubShader = this._shader.getSubShaderAt(this._subShader);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trun(): void {\r\n\t\tif (!this._source || !this._viewPort)\r\n\t\t\treturn;\r\n\t\tvar source = this._source;\r\n\t\tvar dest = this._dest;\r\n\t\tvar shader: Shader3D = this._shader;\r\n\t\tvar shaderData: ShaderData = this._shaderData;\r\n\t\tvar viewport = this._viewPort;\r\n\r\n\t\tlet vph = RenderContext3D.clientHeight - viewport.y - viewport.height;\r\n\r\n\t\t// LayaGL.renderEngine.viewport(viewport.x, vph, viewport.width, viewport.height);\r\n\t\t// LayaGL.renderEngine.scissor(viewport.x, vph, viewport.width, viewport.height);\r\n\t\tlet context = RenderContext3D._instance;\r\n\t\tcontext.changeViewport(viewport.x, vph, viewport.width, viewport.height);\r\n\t\tcontext.changeScissor(viewport.x, vph, viewport.width, viewport.height);\r\n\r\n\t\tshaderData.setTexture(Command.SCREENTEXTURE_ID, source);\r\n\t\tshaderData.setVector(Command.SCREENTEXTUREOFFSETSCALE_ID, this._offsetScale || BlitFrameBufferCMD._defaultOffsetScale);\r\n\t\tsource && (shaderData.setVector(Command.MAINTEXTURE_TEXELSIZE_ID, this._texture_size));\r\n\t\t//this._sourceTexelSize.setValue(1.0 / source.width, 1.0 / source.height, source.width, source.height);\r\n\t\t(RenderTexture.currentActive) && (RenderTexture.currentActive._end());\r\n\r\n\t\tif (dest) {\r\n\t\t\tdest._start();\r\n\t\t\tshaderData.removeDefine(RenderContext3D.GammaCorrect);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tshaderData.addDefine(RenderContext3D.GammaCorrect);\r\n\t\t}\r\n\t\tvar subShader: SubShader = shader.getSubShaderAt(this._subShader);\r\n\t\tvar passes: ShaderPass[] = subShader._passes;\r\n\t\tScreenQuad.instance.invertY = false;\r\n\r\n\t\tcontext.destTarget = dest;\r\n\t\tcontext._contextOBJ.applyContext(Camera._updateMark);\r\n\t\tcontext.drawRenderElement(this._renderElement);\r\n\t\t//RenderContext3D._instance.invertY ? ScreenQuad.instance.renderInvertUV() : ScreenQuad.instance.render();\r\n\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trecover(): void {\r\n\t\tBlitFrameBufferCMD._pool.push(this);\r\n\t\tthis._source = null;\r\n\t\tthis._dest = null;\r\n\t\tthis._offsetScale = null;\r\n\t\tthis._shader = null;\r\n\t\tthis._shaderData = null;\r\n\t\tthis._viewPort = null;\r\n\t}\r\n}","import { ISceneRenderManager } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { BaseRender } from \"../render/BaseRender\";\r\n\r\n/**\r\n * <code><code/>\r\n */\r\nexport class SceneRenderManager {\r\n    /**@internal */\r\n    protected _sceneManagerOBJ: ISceneRenderManager;\r\n    \r\n    /**\r\n     * \r\n     */\r\n    constructor() {\r\n        this._sceneManagerOBJ = Laya3DRender.renderOBJCreate.createSceneRenderManager();\r\n    }\r\n\r\n    /**\r\n     * get RenderList\r\n     */\r\n    get list(): SingletonList<BaseRender> {\r\n        return this._sceneManagerOBJ.list;\r\n    }\r\n\r\n    set list(value: SingletonList<BaseRender>) {\r\n        this._sceneManagerOBJ.list = value;\r\n    }\r\n\r\n    /**\r\n     * add Render Node\r\n     * @param object \r\n     */\r\n    addRenderObject(object: BaseRender): void {\r\n        this._sceneManagerOBJ.addRenderObject(object);\r\n    }\r\n\r\n    /**\r\n     * remove Render Node\r\n     * @param object \r\n     */\r\n    removeRenderObject(object: BaseRender): void {\r\n        this._sceneManagerOBJ.removeRenderObject(object);\r\n    }\r\n\r\n    /**\r\n     * remove motion Object\r\n     * @param object \r\n     */\r\n    removeMotionObject(object: BaseRender): void {\r\n        this._sceneManagerOBJ.removeMotionObject(object);\r\n    }\r\n\r\n    /**\r\n     * update All Motion Render Data\r\n     */\r\n    updateMotionObjects(): void {\r\n        this._sceneManagerOBJ.updateMotionObjects();\r\n    }\r\n\r\n    /**\r\n     * add motion Render Data\r\n     * @param object \r\n     */\r\n    addMotionObject(object: BaseRender): void {\r\n        this._sceneManagerOBJ.addMotionObject(object);\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy(): void {\r\n        this._sceneManagerOBJ.destroy();\r\n    }\r\n\r\n}","import { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { Ray } from \"../../math/Ray\";\r\nimport { UI3D } from \"./UI3D\";\r\n\r\nexport class UI3DManager {\r\n\r\n    _UI3Dlist: SingletonList<UI3D> = new SingletonList<UI3D>();\r\n\r\n    constructor() {\r\n    }\r\n\r\n    add(value: UI3D) {\r\n        this._UI3Dlist.add(value);\r\n    }\r\n\r\n    remove(value: UI3D) {\r\n        this._UI3Dlist.remove(value);\r\n    }\r\n\r\n    //\r\n    update() {\r\n        let elements = this._UI3Dlist.elements;\r\n        for (var i = 0, n = this._UI3Dlist.length; i < n; i++) {\r\n            elements[i]._submitRT();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    rayCast(ray: Ray): any {\r\n        let rayOri = ray.origin;\r\n        this._UI3Dlist.clean();\r\n        //sort\r\n        this._UI3Dlist.elements.sort(\r\n            (a: UI3D, b: UI3D) => {\r\n                return a._getCameraDistance(rayOri) - b._getCameraDistance(rayOri);\r\n            }\r\n        );\r\n        let elements = this._UI3Dlist.elements;\r\n        for (var i = 0, n = this._UI3Dlist.length; i < n; i++) {\r\n            let hit = elements[i]._checkUIPos(ray);\r\n            if (hit) {//\r\n                return hit;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Destroy\r\n     */\r\n    destory() {\r\n        this._UI3Dlist.destroy();\r\n    }\r\n}","import { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { IBoundsCell } from \"../../../math/IBoundsCell\";\r\nimport { BVHSpatialBox } from \"./BVHSpatialBox\";\r\n\r\n/**\r\n *    \r\n */\r\nexport class BVHSpatialManager {\r\n    /**@internal */\r\n    bvhManager: Map<number, BVHSpatialBox<IBoundsCell>>;\r\n\r\n    /**@internal */\r\n    cellCount: number = 0;\r\n\r\n    /**@internal */\r\n    updateBVHBoxList: SingletonList<BVHSpatialBox<IBoundsCell>>;\r\n\r\n    /**\r\n     * BVHSpatialManager\r\n     */\r\n    constructor() {\r\n        this.bvhManager = new Map();\r\n        this.updateBVHBoxList = new SingletonList<BVHSpatialBox<IBoundsCell>>();\r\n    }\r\n\r\n    /**\r\n     * clear\r\n     */\r\n    clear() {\r\n        this.cellCount = 0;\r\n        this.updateBVHBoxList.clear();\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy() {\r\n        this.bvhManager = null;\r\n        this.updateBVHBoxList.destroy();\r\n    }\r\n}\r\n\r\n/**\r\n * BVHConfig\r\n */\r\nexport class BVHSpatialConfig {\r\n    /**@internal BVHcell*/\r\n    public max_SpatialCount = 7;\r\n    /**@internal BVH*/\r\n    public limit_size = 32;\r\n    /**@internal cellbuildBVH*/\r\n    public Min_BVH_Build_Nums = 10;\r\n}","import { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { ICameraCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { IShadowCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { BoundFrustum } from \"../../../math/BoundFrustum\";\r\nimport { Bounds } from \"../../../math/Bounds\";\r\nimport { CollisionUtils } from \"../../../math/CollisionUtils\";\r\nimport { ContainmentType } from \"../../../math/ContainmentType\";\r\nimport { IBoundsCell } from \"../../../math/IBoundsCell\";\r\nimport { Plane } from \"../../../math/Plane\";\r\nimport { BVHSpatialConfig, BVHSpatialManager } from \"./SpatialManager\";\r\n\r\n/**\r\n * BVH\r\n */\r\nexport class BVHSpatialBox<T> {\r\n    private static _tempV3: Vector3 = new Vector3();\r\n    private static _tempV3_2: Vector3 = new Vector3();\r\n\r\n    /**\r\n     * \r\n     * @param box\r\n     * @param cullInfo \r\n     * @returns 0: 1 2\r\n     */\r\n    static sciContainsBox(box: Bounds, cullInfo: IShadowCullInfo) {\r\n        const p = BVHSpatialBox._tempV3;\r\n        const n = BVHSpatialBox._tempV3_2;\r\n        const boxMin = box.min;\r\n        const boxMax = box.max;\r\n        let result = ContainmentType.Contains;\r\n        for (let i = 0, nn = cullInfo.cullPlaneCount; i < nn; i++) {\r\n            const plane = cullInfo.cullPlanes[i];\r\n            const planeNor = plane.normal;\r\n\r\n            if (planeNor.x >= 0) {\r\n                p.x = boxMax.x;\r\n                n.x = boxMin.x;\r\n            } else {\r\n                p.x = boxMin.x;\r\n                n.x = boxMax.x;\r\n            }\r\n            if (planeNor.y >= 0) {\r\n                p.y = boxMax.y;\r\n                n.y = boxMin.y;\r\n            } else {\r\n                p.y = boxMin.y;\r\n                n.y = boxMax.y;\r\n            }\r\n            if (planeNor.z >= 0) {\r\n                p.z = boxMax.z;\r\n                n.z = boxMin.z;\r\n            } else {\r\n                p.z = boxMin.z;\r\n                n.z = boxMax.z;\r\n            }\r\n\r\n            if (CollisionUtils.intersectsPlaneAndPoint(plane, p) === Plane.PlaneIntersectionType_Back)\r\n                return ContainmentType.Disjoint;\r\n            if (CollisionUtils.intersectsPlaneAndPoint(plane, n) === Plane.PlaneIntersectionType_Back)\r\n                result = ContainmentType.Intersects;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param box \r\n     * @param cullInfo \r\n    */\r\n    static sciIntersectsBox(box: Bounds, cullInfo: IShadowCullInfo) {\r\n        const cullPlaneCount = cullInfo.cullPlaneCount;\r\n        const cullPlanes = cullInfo.cullPlanes;\r\n\r\n        const min: Vector3 = box.min;\r\n        const max: Vector3 = box.max;\r\n        const minX: number = min.x;\r\n        const minY: number = min.y;\r\n        const minZ: number = min.z;\r\n        const maxX: number = max.x;\r\n        const maxY: number = max.y;\r\n        const maxZ: number = max.z;\r\n\r\n        let pass: boolean = true;\r\n        for (let j = 0; j < cullPlaneCount; j++) {\r\n            const plane = cullPlanes[j];\r\n            const normal = plane.normal;\r\n            if (plane.distance + (normal.x * (normal.x < 0.0 ? minX : maxX)) + (normal.y * (normal.y < 0.0 ? minY : maxY)) + (normal.z * (normal.z < 0.0 ? minZ : maxZ)) < 0.0) {\r\n                pass = false;\r\n                break;\r\n            }\r\n        }\r\n        return pass;\r\n    }\r\n    /**@internal */\r\n    protected _bounds: Bounds;\r\n    /**@internal BVH */\r\n    protected _cellList: Array<IBoundsCell>;\r\n    /**@internal  */\r\n    protected _cellCount: number; //\r\n    /**@internal  */\r\n    protected _parent: BVHSpatialBox<T>; //\r\n    /**@internal  */\r\n    protected _children0: BVHSpatialBox<T>;\r\n    protected _children1: BVHSpatialBox<T>;\r\n    /**BVH */\r\n    protected _config: BVHSpatialConfig;\r\n    /**BVH */\r\n    protected _bvhmanager: BVHSpatialManager;\r\n    /**@internal  */\r\n    _boundchanged: boolean;\r\n\r\n    /**\r\n     * BVHSpaticalBox\r\n     * @param bvhmanager \r\n     * @param config \r\n     */\r\n    constructor(bvhmanager: BVHSpatialManager, config: BVHSpatialConfig) {\r\n        this._bounds = new Bounds(new Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), new Vector3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE));\r\n        this._cellList = [];\r\n        this._cellCount = 0;\r\n        this._bvhmanager = bvhmanager;\r\n        this._config = config;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set parent(value: BVHSpatialBox<IBoundsCell>) {\r\n        this._parent = value;\r\n    }\r\n\r\n    get parent() {\r\n        return this._parent;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param cell \r\n     * @returns \r\n     */\r\n    private _isRepeat(cell: IBoundsCell): boolean {\r\n        return (this._cellList.indexOf(cell) != -1);\r\n    }\r\n\r\n    /**\r\n     * add one cell to list\r\n     * @param cell \r\n     */\r\n    private _addOneCell(cell: IBoundsCell) {\r\n        this._cellList.push(cell);\r\n        this._cellCount++;\r\n        this._bvhmanager.bvhManager.set(cell.id, this);\r\n        this._bvhmanager.cellCount++;\r\n        // this._addBounds(cell);\r\n    }\r\n\r\n    /**\r\n     * remove one cell to list\r\n     * @param cell \r\n     * @returns \r\n     */\r\n    private _removeOneCell(cell: IBoundsCell) {\r\n        let index = this._cellList.indexOf(cell);\r\n        if (index == -1)\r\n            return false;\r\n        this._cellCount--;\r\n        this._cellList.splice(index, 1);\r\n        this._bvhmanager.bvhManager.delete(cell.id);\r\n        this._bvhmanager.cellCount--;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * TODO bvhmanager\r\n     */\r\n    private _clearList() {\r\n        this._bvhmanager.cellCount -= this._cellCount;\r\n        this._cellCount = 0;\r\n        this._cellList = null;\r\n    }\r\n\r\n    /**\r\n     * Float\r\n     * @param x \r\n     * @param y \r\n     * @returns \r\n     */\r\n    private _isFloatMax(x: number, y: number) {\r\n        return x - y > 0.0001;//x>y \r\n    }\r\n\r\n    /**\r\n     * Box\r\n     */\r\n    private _isBoundsContainedBySpatialBox(cell: IBoundsCell) {\r\n        let cellMin = cell.bounds.getMin();\r\n        let cellMax = cell.bounds.getMax();\r\n        let boxMin = this._bounds.getMin();\r\n        let boxMax = this._bounds.getMax();\r\n        //cell box,\r\n        if (this._isFloatMax(cellMin.x, boxMin.x) && this._isFloatMax(cellMin.y, boxMin.y) && this._isFloatMax(cellMin.z, boxMin.z) &&\r\n            this._isFloatMax(boxMax.x, cellMax.x) && this._isFloatMax(boxMax.y, cellMax.y) && this._isFloatMax(boxMax.z, cellMax.z)) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * boxBounds\r\n     * @param cell \r\n     */\r\n    private _addBounds(cell: IBoundsCell) {\r\n        this._boundchanged = this._isBoundsContainedBySpatialBox(cell);\r\n    }\r\n\r\n    /**\r\n     * boxbounds\r\n     * @param cell \r\n     */\r\n    private _removeBounds(cell: IBoundsCell) {\r\n        this._boundchanged = this._isBoundsContainedBySpatialBox(cell);\r\n    }\r\n\r\n    /**\r\n     * list\r\n     * @returns \r\n     */\r\n    getList() {\r\n        return this._cellList;\r\n    }\r\n\r\n    /**\r\n     * child0\r\n     * @returns \r\n     */\r\n    getchild0() {\r\n        return this._children0;\r\n    }\r\n    /**\r\n     * child1\r\n     * @returns \r\n     */\r\n    getchild1() {\r\n        return this._children1;\r\n    }\r\n\r\n    /**\r\n     * fill one Cell\r\n     * add but dont Split immediately\r\n     */\r\n    fillCell(cell: IBoundsCell) {\r\n        if (this._isRepeat(cell)) {\r\n            return;\r\n        }\r\n        this._addOneCell(cell);\r\n        this._boundchanged = true;\r\n        this._bvhmanager.updateBVHBoxList.add(this);\r\n    }\r\n\r\n    /**\r\n     * fill remove one cell\r\n     * remove but dont split imediately\r\n     * @param cell \r\n     */\r\n    fillRemove(cell: IBoundsCell) {\r\n        if (!this._isRepeat(cell)) {\r\n            return;\r\n        }\r\n        this._removeOneCell(cell);\r\n        this._boundchanged = true;\r\n        this._bvhmanager.updateBVHBoxList.add(this);\r\n    }\r\n\r\n    /**\r\n     * add one Cell\r\n     * @param cell \r\n     * @returns \r\n     */\r\n    addCell(cell: IBoundsCell) {\r\n        if (this._isRepeat(cell)) {\r\n            return;\r\n        }\r\n        this._addOneCell(cell);\r\n        this._addBounds(cell);\r\n    }\r\n\r\n    /**\r\n     * remove one Cell\r\n     * @param cell \r\n     */\r\n    removeCell(cell: IBoundsCell) {\r\n        if (this._removeOneCell(cell)) {\r\n            this._removeBounds(cell);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * BVHBox\r\n     * @returns \r\n     */\r\n    splitBox() {\r\n        if (!this.isContentBox()) {\r\n            this._children0 && this._children0.splitBox();\r\n            this._children1 && this._children1.splitBox();\r\n            return;\r\n        }\r\n\r\n        let v1 = this._bounds.getExtent(); //\r\n\r\n        if ((this._config.max_SpatialCount > this._cellCount && this._config.limit_size >= 2 * Math.max(v1.x, v1.y, v1.z)) || this._cellCount <= 1)\r\n            return;\r\n\r\n        //sort\r\n        if (v1.x > v1.y && v1.x > v1.z)\r\n            this._cellList.sort((a: IBoundsCell, b: IBoundsCell) => {\r\n                if (a && b)\r\n                    return a.bounds.getCenter().x - b.bounds.getCenter().x;\r\n                else return 0;\r\n            }); //X\r\n        else if (v1.y > v1.x && v1.y > v1.z) //\r\n            this._cellList.sort((a: IBoundsCell, b: IBoundsCell) => {\r\n                if (a && b) return a.bounds.getCenter().y - b.bounds.getCenter().y;\r\n                else return 0;\r\n            }); //Y\r\n        else if (v1.z > v1.x && v1.z > v1.y) //\r\n            this._cellList.sort((a: IBoundsCell, b: IBoundsCell) => {\r\n                if (a && b) return a.bounds.getCenter().z - b.bounds.getCenter().z;\r\n                else return 0;\r\n            }); //Y\r\n        const mid = this._cellCount / 2 | 0; //\r\n\r\n        this._children0 = this._creatChildNode();\r\n        this._children0.parent = this;\r\n        for (let i = 0; i < mid; i++) { //\r\n            const cell = this._cellList[i];\r\n            this._children0.fillCell(cell);\r\n            Bounds.merge(this._children0._bounds, cell.bounds, this._children0._bounds);\r\n        }\r\n        this._children0._boundchanged = false;\r\n        this._children0.splitBox();\r\n\r\n        this._children1 = this._creatChildNode();\r\n        this._children1.parent = this;\r\n\r\n        for (let i = mid; i < this._cellCount; i++) { //\r\n            const cell = this._cellList[i];\r\n            this._children1.fillCell(cell);\r\n            Bounds.merge(this._children1._bounds, cell.bounds, this._children1._bounds);\r\n        }\r\n        this._children1._boundchanged = false;\r\n        this._children1.splitBox();\r\n\r\n        this._clearList();\r\n    }\r\n\r\n    /**\r\n     * Content BVHBox\r\n     * @param checkPos \r\n     * @returns \r\n     */\r\n    getNearlist(checkPos: Vector3): BVHSpatialBox<T> {\r\n        if (this.isContentBox())\r\n            return this;\r\n        else {\r\n            let v1 = this._children0._bounds.getCenter();\r\n            let v2 = this._children1._bounds.getCenter();\r\n            return Vector3.distanceSquared(v1, checkPos) < Vector3.distanceSquared(v2, checkPos) ? this._children0.getNearlist(checkPos) : this._children1.getNearlist(checkPos);\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * content\r\n     * @param out \r\n     * @param conditionalFun\r\n     */\r\n    traverseBoundsCell(out: SingletonList<IBoundsCell>, conditionalFun: Function = null) {\r\n        if (this.isContentBox()) {\r\n            if (!conditionalFun)\r\n                for (var i = 0; i < this._cellCount; i++) {\r\n                    out.add(this._cellList[i]);\r\n                }\r\n            else\r\n                for (var i = 0; i < this._cellCount; i++) {\r\n                    var node = this._cellList[i]\r\n                    conditionalFun(node) && out.add(node);\r\n                }\r\n        } else {\r\n            this._children0 && this._children0.traverseBoundsCell(out, conditionalFun);\r\n            this._children1 && this._children1.traverseBoundsCell(out, conditionalFun);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Override it\r\n     * @returns \r\n     */\r\n    protected _creatChildNode(): BVHSpatialBox<T> {\r\n        return new BVHSpatialBox<T>(this._bvhmanager, this._config);\r\n    }\r\n\r\n    /**\r\n     * CameraCull\r\n     * @override\r\n     * @param frustum \r\n     * @param out \r\n     */\r\n    getItemByCameraCullInfo(cameraCullInfo: ICameraCullInfo, out: SingletonList<IBoundsCell>) {\r\n        var frustum: BoundFrustum = cameraCullInfo.boundFrustum;\r\n        const result = frustum.containsBoundBox(this._bounds);\r\n        if (result == 1) //\r\n            this.traverseBoundsCell(out); //\r\n        else if (result == 2) { //\r\n            if (this.isContentBox()) {\r\n                for (let i = 0; i < this._cellList.length; i++) { //\r\n                    if (frustum.intersects(this._cellList[i].bounds))\r\n                        out.add(this._cellList[i]);\r\n                }\r\n            } else {\r\n                this._children0.getItemByCameraCullInfo(cameraCullInfo, out); //\r\n                this._children1.getItemByCameraCullInfo(cameraCullInfo, out); //\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @override\r\n     * @param frustum \r\n     * @param out \r\n     */\r\n    getItemByFrustum(frustum: BoundFrustum, out: SingletonList<IBoundsCell>) {\r\n        const result = frustum.containsBoundBox(this._bounds);\r\n        if (result == 1) //\r\n            this.traverseBoundsCell(out); //\r\n        else if (result == 2) { //\r\n            if (this.isContentBox()) {\r\n                for (let i = 0; i < this._cellList.length; i++) { //\r\n                    if (frustum.intersects(this._cellList[i].bounds))\r\n                        out.add(this._cellList[i]);\r\n                }\r\n            } else {\r\n                this._children0.getItemByFrustum(frustum, out); //\r\n                this._children1.getItemByFrustum(frustum, out); //\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @override \r\n     * @param sci\r\n     * @param out \r\n     */\r\n    getItemBySCI(sci: IShadowCullInfo, out: SingletonList<IBoundsCell>) {\r\n        const result = BVHSpatialBox.sciContainsBox(this._bounds, sci);\r\n        if (result == 1) { //\r\n            let fn = (data: IBoundsCell) => { return data.shadowCullPass() };\r\n            this.traverseBoundsCell(out, fn); //\r\n        }\r\n        else if (result == 2) { //\r\n            if (this.isContentBox()) {\r\n                for (let i = 0; i < this._cellList.length; i++) { //\r\n                    let render = this._cellList[i];\r\n                    let pass = render.shadowCullPass();\r\n                    if (pass && BVHSpatialBox.sciIntersectsBox(this._cellList[i].bounds, sci))\r\n                        out.add(this._cellList[i]);\r\n                }\r\n            } else {\r\n                this._children0.getItemBySCI(sci, out); //\r\n                this._children1.getItemBySCI(sci, out); //\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * null need Update by child\r\n     * contents need Update by List\r\n     */\r\n    recaculateBox() {\r\n        if (!!this._children0 && !!this._children1) {\r\n            Bounds.merge(this._children0._bounds, this._children1._bounds, this._bounds);\r\n        }\r\n        else if (this._cellList && this._cellList.length >= 1) {\r\n            this._cellList[0].bounds.cloneTo(this._bounds);\r\n            for (var i = 0, n = this._cellList.length; i < n; i++) {\r\n                Bounds.merge(this._cellList[i].bounds, this._bounds, this._bounds);\r\n            }\r\n        } else {\r\n            console.error(\"BVHSpatialBox is illegal\");\r\n        }\r\n        this.parent && this.parent.recaculateBox();\r\n        this._boundchanged = false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @returns \r\n     */\r\n    isRoot(): boolean {\r\n        return !this._parent;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @returns \r\n     */\r\n    isContentBox(): boolean {\r\n        return this._cellCount != 0;\r\n    }\r\n\r\n    /**\r\n     * box\r\n     */\r\n    destroy() {\r\n        if (this.isContentBox()) {\r\n            this._cellList = null;\r\n        } else {\r\n            this._children0 && this._children0.destroy();\r\n            this._children1 && this._children1.destroy();\r\n            this._children0 = null;\r\n            this._children1 = null;\r\n        }\r\n        this._bounds = null;\r\n        this._config = null;\r\n        this._bvhmanager = null;\r\n    }\r\n\r\n}","import { ICameraCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { IShadowCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { BoundFrustum } from \"../../../math/BoundFrustum\";\r\nimport { IBoundsCell } from \"../../../math/IBoundsCell\";\r\nimport { BVHSpatialBox } from \"./BVHSpatialBox\";\r\nimport { BVHSpatialConfig, BVHSpatialManager } from \"./SpatialManager\";\r\n\r\n/**\r\n * BVH\r\n */\r\nexport class BVHSpatial {\r\n\r\n    /**@internal */\r\n    protected _BVHConfig: BVHSpatialConfig;\r\n\r\n    /**@internal */\r\n    protected _BVHManager: BVHSpatialManager;\r\n\r\n    /**@internal */\r\n    protected _BVHSpatialBox: BVHSpatialBox<IBoundsCell>;\r\n\r\n    /**@internal */\r\n    protected _isBuild: boolean = false;\r\n\r\n    /**\r\n     * Override it\r\n     * @returns \r\n     */\r\n    protected _creatChildNode(): BVHSpatialBox<IBoundsCell> {\r\n        return new BVHSpatialBox<IBoundsCell>(this._BVHManager, this._BVHConfig);\r\n    }\r\n\r\n    /**\r\n     * BVH\r\n     */\r\n    constructor(bvhConfig: BVHSpatialConfig = null, bvhManager: BVHSpatialManager = null) {\r\n        this._BVHConfig = bvhConfig ? bvhConfig : new BVHSpatialConfig();\r\n        this._BVHManager = bvhManager ? bvhManager : new BVHSpatialManager();\r\n        this._BVHSpatialBox = this._creatChildNode();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get bvhSpatialBox(){\r\n        return this._BVHSpatialBox;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param cell \r\n     * @returns \r\n     */\r\n    cellLegal(cell: IBoundsCell): boolean {\r\n        let extend = cell.bounds.getExtent();\r\n        return this._BVHConfig.limit_size > (Math.max(extend.x, extend.y, extend.z) * 2);// too large is cant \r\n    }\r\n\r\n    /**\r\n     * add one\r\n     * @param cell \r\n     */\r\n    addOne(cell: IBoundsCell) {\r\n        if (!this.cellLegal(cell)) {\r\n            return false\r\n        }\r\n        if (this._isBuild) {\r\n            let spatial = this._BVHSpatialBox.getNearlist(cell.bounds.getCenter());\r\n            spatial.addCell(cell);\r\n            this._BVHManager.updateBVHBoxList.add(spatial);\r\n        } else {\r\n            this._BVHSpatialBox.fillCell(cell);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * remove one\r\n     * @param cell \r\n     * @returns \r\n     */\r\n    removeOne(cell: IBoundsCell) {\r\n        if (!this._BVHManager.bvhManager.has(cell.id)) {\r\n            return false;\r\n        }\r\n        if (this._isBuild) {\r\n            let spatial = this._BVHManager.bvhManager.get(cell.id);\r\n            spatial.removeCell(cell);\r\n            this._BVHManager.updateBVHBoxList.add(spatial);\r\n        } else {\r\n            this._BVHSpatialBox.fillRemove(cell);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * remove\r\n     * @param cell \r\n     */\r\n    motionOne(cell: IBoundsCell) {\r\n        if (this._BVHSpatialBox.getNearlist(cell.bounds.getCenter()) == this._BVHManager.bvhManager.get(cell.id)) {\r\n            return;\r\n        } else {\r\n            this.removeOne(cell);\r\n            this.addOne(cell);\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n    * CameraCull\r\n    * @override\r\n    * @param frustum \r\n    * @param out \r\n    */\r\n    getItemByCameraCullInfo(cameraCullInfo: ICameraCullInfo, out: SingletonList<IBoundsCell>) {\r\n        if (this._BVHManager.updateBVHBoxList.length > 0) {\r\n            this.update();\r\n        }\r\n        if (this._isBuild) {\r\n            this._BVHSpatialBox.getItemByCameraCullInfo(cameraCullInfo, out);\r\n        } else {\r\n            this._BVHSpatialBox.traverseBoundsCell(out);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @override\r\n     * @param frustum \r\n     * @param out \r\n     */\r\n    getItemByFrustum(frustum: BoundFrustum, out: SingletonList<IBoundsCell>) {\r\n        if (this._BVHManager.updateBVHBoxList.length > 0) {\r\n            this.update();\r\n        }\r\n        if (this._isBuild) {\r\n            this._BVHSpatialBox.getItemByFrustum(frustum, out);\r\n        } else {\r\n            this._BVHSpatialBox.traverseBoundsCell(out);\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @override \r\n     * @param sci\r\n     * @param out \r\n     */\r\n    getItemBySCI(sci: IShadowCullInfo, out: SingletonList<IBoundsCell>) {\r\n        if (this._BVHManager.updateBVHBoxList.length > 0) {\r\n            this.update();\r\n        }\r\n        if (this._isBuild) {\r\n            this._BVHSpatialBox.getItemBySCI(sci, out);\r\n        } else {\r\n            this._BVHSpatialBox.traverseBoundsCell(out,(data:IBoundsCell)=>{return data.shadowCullPass()});\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    update() {\r\n        if (!this._isBuild) {//first build\r\n            if (this._BVHManager.cellCount > this._BVHConfig.Min_BVH_Build_Nums) {\r\n                this._BVHSpatialBox.recaculateBox();\r\n                this._BVHSpatialBox.splitBox();//build\r\n                this._BVHManager.updateBVHBoxList.remove(this._BVHSpatialBox);\r\n                this._isBuild = true;\r\n            }\r\n            this._BVHManager.updateBVHBoxList.length = 0;\r\n        } else {\r\n            let list = this._BVHManager.updateBVHBoxList;\r\n            for (let i = 0, n = list.length; i < n; i++) {\r\n                let spatial = list.elements[i];\r\n                spatial._boundchanged && spatial.recaculateBox();\r\n                spatial.splitBox();\r\n            }\r\n            list.length = 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * rebuild\r\n     */\r\n    rebuild() {\r\n        if (this._isBuild) {//reBuild\r\n            let out = new SingletonList<IBoundsCell>();\r\n            this._BVHSpatialBox.traverseBoundsCell(out);\r\n            this._BVHSpatialBox.destroy();\r\n            this._BVHManager.clear();\r\n            this._isBuild = false;\r\n            this._BVHSpatialBox = this._creatChildNode();\r\n            for (let i = 0, n = out.length; i < n; i++) {\r\n                this.addOne(out.elements[i]);\r\n            }\r\n            this._BVHSpatialBox.recaculateBox();\r\n            this._BVHSpatialBox.splitBox();//build\r\n        }\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy() {\r\n        this._BVHSpatialBox.destroy();\r\n        this._BVHManager.destroy();\r\n    }\r\n}","import { ICameraCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { IShadowCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { Stat } from \"../../../../utils/Stat\";\r\nimport { FrustumCulling } from \"../../../graphics/FrustumCulling\";\r\nimport { BoundFrustum } from \"../../../math/BoundFrustum\";\r\nimport { BaseRender } from \"../../render/BaseRender\";\r\nimport { RenderContext3D } from \"../../render/RenderContext3D\";\r\nimport { BVHSpatialBox } from \"../bvh/BVHSpatialBox\";\r\n\r\nexport class BVHRenderBox<T> extends BVHSpatialBox<T>{\r\n\r\n    /**@internal BVH */\r\n    protected _cellList: Array<BaseRender>;\r\n\r\n    /**\r\n     * Override it\r\n     * @returns \r\n     */\r\n    protected _creatChildNode(): BVHSpatialBox<T> {\r\n        return new BVHRenderBox<BaseRender>(this._bvhmanager, this._config);\r\n    }\r\n\r\n    /**\r\n     * CameraCull\r\n     * @override\r\n     * @param frustum \r\n     * @param out \r\n     */\r\n    getItemByCameraCullInfo(cameraCullInfo: ICameraCullInfo, out: SingletonList<BaseRender>) {\r\n        var frustum: BoundFrustum = cameraCullInfo.boundFrustum;\r\n        const result = frustum.containsBoundBox(this._bounds);\r\n        if (result == 1) {\r\n            this.traverseBoundsCell(out); //\r\n            Stat.frustumCulling++;\r\n        } //\r\n        else if (result == 2) { //\r\n            if (this.isContentBox()) {\r\n                var cullMask: number = cameraCullInfo.cullingMask;\r\n                let staticMask = cameraCullInfo.staticMask;\r\n                let context = RenderContext3D._instance;\r\n                for (let i = 0; i < this._cellList.length; i++) { //\r\n                    var canPass: boolean;\r\n                    let render = this._cellList[i]\r\n                    canPass = (Math.pow(2, render.renderNode.layer) & cullMask) != 0 && render._enabled && (render.renderbitFlag == 0);\r\n                    canPass = canPass && ((render.renderNode.staticMask & staticMask) != 0);\r\n                    if (canPass) {\r\n                        Stat.frustumCulling++;\r\n                        if (!cameraCullInfo.useOcclusionCulling || render._needRender(frustum, context)) {\r\n                            out.add(render);\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                this._children0.getItemByCameraCullInfo(cameraCullInfo, out); //\r\n                this._children1.getItemByCameraCullInfo(cameraCullInfo, out); //\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @override\r\n    * @param sci\r\n    * @param out \r\n    */\r\n    getItemBySCI(sci: IShadowCullInfo, out: SingletonList<BaseRender>) {\r\n        const result = BVHSpatialBox.sciContainsBox(this._bounds, sci);\r\n        if (result == 1) //\r\n            this.traverseBoundsCell(out); //\r\n        else if (result == 2) { //\r\n            if (this.isContentBox()) {\r\n                for (let i = 0; i < this._cellList.length; i++) { //\r\n                    var render = this._cellList[i];\r\n                    var canPass = render.shadowCullPass();\r\n                    if (canPass) {\r\n                        Stat.frustumCulling++;\r\n                        let pass = FrustumCulling.cullingRenderBounds(render.bounds, sci);\r\n                        pass && out.add(render);\r\n                    }\r\n                    // if (BVHSpatialBox.sciIntersectsBox(this._cellList[i].bounds, sci))\r\n                    //     out.add(this._cellList[i]);\r\n                }\r\n            } else {\r\n                this._children0.getItemBySCI(sci, out); //\r\n                this._children1.getItemBySCI(sci, out); //\r\n            }\r\n        }\r\n    }\r\n\r\n}","import { BaseRender } from \"../../render/BaseRender\";\r\nimport { StaticFlag } from \"../../Sprite3D\";\r\nimport { BVHSpatial } from \"../bvh/BVHSpatial\";\r\nimport { BVHRenderBox } from \"./BVHRenderSpatialBox\";\r\n\r\nexport class BVHRenderSpatial extends BVHSpatial {\r\n    /**\r\n     * Override it\r\n     * @returns \r\n     */\r\n    protected _creatChildNode(): BVHRenderBox<BaseRender> {\r\n        return new BVHRenderBox<BaseRender>(this._BVHManager, this._BVHConfig);\r\n    }\r\n    \r\n    /**\r\n     * \r\n     * @param cell \r\n     * @returns \r\n     */\r\n    cellLegal(cell: BaseRender): boolean {\r\n        if (cell.renderNode.staticMask == StaticFlag.StaticBatch&&super.cellLegal(cell))\r\n            return true;\r\n        return false;\r\n    }\r\n}","import { ISceneRenderManager } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { BaseRender } from \"../../render/BaseRender\";\r\nimport { BVHSpatialConfig } from \"../bvh/SpatialManager\";\r\nimport { SceneRenderManager } from \"../SceneRenderManager\";\r\nimport { BVHRenderSpatial } from \"./BVHRenderSpatial\";\r\n\r\nexport class BVHSceneRenderManager extends SceneRenderManager {\r\n    /**@internal */\r\n    protected _sceneManagerOBJ: ISceneRenderManager;\r\n    /**@internal */\r\n    private _bvhRenderSpatial: BVHRenderSpatial;\r\n\r\n    private _allRenderList:SingletonList<BaseRender>;\r\n\r\n    /**\r\n     * \r\n     */\r\n    constructor(bvhConfig:BVHSpatialConfig = null) {\r\n        super();\r\n        this._bvhRenderSpatial = new BVHRenderSpatial(bvhConfig);\r\n        this._allRenderList = new SingletonList<BaseRender>();\r\n    }\r\n\r\n    /**\r\n    * get RenderList\r\n    */\r\n    get list(): SingletonList<BaseRender> {\r\n        return this._allRenderList;\r\n    }\r\n\r\n    set list(value: SingletonList<BaseRender>) {\r\n        for(let i = 0,n = value.length;i<n;i++){\r\n            let render = value.elements[i];\r\n            this.addRenderObject(render);\r\n        }\r\n    }\r\n\r\n    get bvhSpatial(){\r\n        return this._bvhRenderSpatial;\r\n    }\r\n\r\n    get otherList(){\r\n        return this._sceneManagerOBJ.list;\r\n    }\r\n\r\n    /**\r\n     * add Render Node\r\n     * @param object \r\n     */\r\n    addRenderObject(object: BaseRender): void {\r\n        if (!this._bvhRenderSpatial.addOne(object)) {\r\n            this._sceneManagerOBJ.addRenderObject(object);\r\n        }\r\n        this._allRenderList.add(object);\r\n    }\r\n\r\n    /**\r\n     * remove Render Node\r\n     * @param object \r\n     */\r\n    removeRenderObject(object: BaseRender): void {\r\n        if (!this._bvhRenderSpatial.removeOne(object))\r\n            this._sceneManagerOBJ.removeRenderObject(object);\r\n        this._allRenderList.remove(object);\r\n    }\r\n\r\n    /**\r\n     * remove motion Object\r\n     * @param object \r\n     */\r\n    removeMotionObject(object: BaseRender): void {\r\n        this._sceneManagerOBJ.removeMotionObject(object);\r\n    }\r\n\r\n    /**\r\n     * update All Motion Render Data\r\n     */\r\n    updateMotionObjects(): void {\r\n        this._bvhRenderSpatial.update();\r\n        this._sceneManagerOBJ.updateMotionObjects();\r\n\r\n    }\r\n\r\n    /**\r\n     * add motion Render Data\r\n     * @param object \r\n     */\r\n    addMotionObject(object: BaseRender): void {\r\n        if (this._bvhRenderSpatial.cellLegal(object)) {\r\n            this._bvhRenderSpatial.motionOne(object);\r\n        } else {\r\n            this._sceneManagerOBJ.addMotionObject(object);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy(): void {\r\n        this._sceneManagerOBJ.destroy();\r\n        this._bvhRenderSpatial.destroy();\r\n        this._allRenderList .destroy();\r\n    }\r\n}","import { Vector3 } from \"../../../maths/Vector3\";\r\nimport { ICameraCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { ICullPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICullPass\";\r\nimport { ISceneRenderManager } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { IShadowCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { Stat } from \"../../../utils/Stat\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { FrustumCulling } from \"../../graphics/FrustumCulling\";\r\nimport { BoundFrustum } from \"../../math/BoundFrustum\";\r\n\r\n\r\nexport class CullPassBase implements ICullPass {\r\n    protected _cullList: SingletonList<BaseRender> = new SingletonList();\r\n\r\n    get cullList(): SingletonList<BaseRender> {\r\n        return this._cullList;\r\n    }\r\n\r\n    /**\r\n     * TODO\r\n\t * \r\n\t * @param context \r\n\t * @param render \r\n\t * @returns \r\n\t */\r\n\tstatic cullDistanceVolume(context:RenderContext3D,render:BaseRender):boolean{\r\n\t\tlet camera = context.camera;\r\n\t\tif(!camera||!camera.transform) return false;\r\n\t\tlet bound = render.bounds;\r\n\t\tlet center = bound.getCenter();\r\n\t\tlet exten = bound.getExtent();\r\n\t\tlet dis:number = Vector3.distance(camera.transform.position,center);\r\n\t\tlet volum:number = Math.max(exten.x,exten.y,exten.z);\r\n\t\tif(volum/dis<render._ratioIgnor){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n    cullByCameraCullInfo(cameraCullInfo: ICameraCullInfo, renderManager: ISceneRenderManager): void {\r\n        this._cullList.length = 0;\r\n        var renders = renderManager.list.elements;\r\n        var boundFrustum: BoundFrustum = cameraCullInfo.boundFrustum;\r\n        var cullMask: number = cameraCullInfo.cullingMask;\r\n        let staticMask = cameraCullInfo.staticMask;\r\n        let context = RenderContext3D._instance;\r\n        for (var i: number = 0, n: number = renderManager.list.length; i < n; i++) {\r\n            var render = renders[i];\r\n            var canPass: boolean;\r\n            canPass = (Math.pow(2, render.renderNode.layer) & cullMask) != 0 && render._enabled && (render.renderbitFlag == 0);\r\n            canPass = canPass && (( render.renderNode.staticMask & staticMask) != 0);\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                if (!cameraCullInfo.useOcclusionCulling || render._needRender(boundFrustum, context)) {\r\n                    this.cullList.add(render);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    cullByShadowCullInfo(cullInfo: IShadowCullInfo, renderManager: ISceneRenderManager): void {\r\n        this._cullList.length = 0;\r\n        var renderList = renderManager.list;\r\n        var renders = renderList.elements;\r\n        for (var i: number = 0, n: number = renderList.length; i < n; i++) {\r\n            var render = renders[i];\r\n            var canPass: boolean = render.shadowCullPass();\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                let pass = FrustumCulling.cullingRenderBounds(render.bounds, cullInfo);\r\n                pass && this._cullList.add(render);\r\n                // if (pass) {\r\n                // \trender.distanceForSort = Vector3.distance(render.bounds.getCenter(), position);//TODO:,\r\n                // \tvar elements: RenderElement[] = render._renderElements;\r\n                // \tfor (var j: number = 0, m: number = elements.length; j < m; j++)\r\n                // \t\telements[j]._update(scene, context, null, null);\r\n                // }\r\n            }\r\n        }\r\n    }\r\n    cullingSpotShadow(cameraCullInfo: ICameraCullInfo, renderManager: ISceneRenderManager): void {\r\n        this._cullList.length = 0;\r\n        let renders = renderManager.list.elements;\r\n        let boundFrustum: BoundFrustum = cameraCullInfo.boundFrustum;\r\n        let context = RenderContext3D._instance;\r\n        for (let i = 0, n = renderManager.list.length; i < n; i++) {\r\n            let render = renders[i];\r\n            let canPass: boolean = render.castShadow && render._enabled && (render.renderbitFlag == 0);\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                if (render._needRender(boundFrustum, context))\r\n                    this._cullList.add(render);\r\n            }\r\n        }\r\n    }\r\n\r\n}","import { ICameraCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { ISceneRenderManager } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { IShadowCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { Stat } from \"../../../../utils/Stat\";\r\nimport { FrustumCulling } from \"../../../graphics/FrustumCulling\";\r\nimport { BoundFrustum } from \"../../../math/BoundFrustum\";\r\nimport { CullPassBase } from \"../../../RenderObjs/RenderObj/CullPass\";\r\nimport { BaseRender } from \"../../render/BaseRender\";\r\nimport { RenderContext3D } from \"../../render/RenderContext3D\";\r\nimport { BVHSceneRenderManager } from \"./BVHSceneRenderManager\";\r\n\r\n/**\r\n * BVHPass\r\n */\r\nexport class BVHCullPass extends CullPassBase {\r\n    protected _cullList: SingletonList<BaseRender> = new SingletonList();\r\n    /**\r\n     * \r\n     */\r\n    get cullList(): SingletonList<BaseRender> {\r\n        return this._cullList;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param cameraCullInfo \r\n     * @param renderManager \r\n     */\r\n    cullByCameraCullInfo(cameraCullInfo: ICameraCullInfo, renderManager: BVHSceneRenderManager): void {\r\n        this._cullList.length = 0;\r\n        //BVH\r\n        renderManager.bvhSpatial.getItemByCameraCullInfo(cameraCullInfo,this._cullList);\r\n        //Dynamic\r\n        var renderList = renderManager.otherList;\r\n        var renders = renderList.elements;\r\n        var boundFrustum: BoundFrustum = cameraCullInfo.boundFrustum;\r\n        var cullMask: number = cameraCullInfo.cullingMask;\r\n        let staticMask = cameraCullInfo.staticMask;\r\n        let context = RenderContext3D._instance;\r\n        for (var i: number = 0, n: number = renderList.length; i < n; i++) {\r\n            var render = renders[i];\r\n            var canPass: boolean;\r\n            canPass = (Math.pow(2, render.renderNode.layer) & cullMask) != 0 && render._enabled && (render.renderbitFlag == 0);\r\n            canPass = canPass && ((render.renderNode.staticMask & staticMask) != 0);\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                if (!cameraCullInfo.useOcclusionCulling || render._needRender(boundFrustum, context)) {\r\n                    this.cullList.add(render);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param cullInfo \r\n     * @param renderManager \r\n     */\r\n    cullByShadowCullInfo(cullInfo: IShadowCullInfo, renderManager: BVHSceneRenderManager): void {\r\n        this._cullList.length = 0;\r\n        //BVH\r\n        renderManager.bvhSpatial.getItemBySCI(cullInfo,this._cullList);\r\n        //Dynamic\r\n        var renderList = renderManager.otherList;\r\n        var renders = renderList.elements;\r\n        for (var i: number = 0, n: number = renderList.length; i < n; i++) {\r\n            var render = renders[i];\r\n            var canPass: boolean = render.castShadow && render._enabled && (render.renderbitFlag == 0);\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                let pass = FrustumCulling.cullingRenderBounds(render.bounds, cullInfo);\r\n                pass && this._cullList.add(render);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Spot\r\n     * @param cameraCullInfo \r\n     * @param renderManager \r\n     */\r\n    cullingSpotShadow(cameraCullInfo: ICameraCullInfo, renderManager: ISceneRenderManager): void {\r\n        //TODO\r\n    }\r\n} ","import { Camera } from \"../Camera\"\r\nimport { CommandBuffer } from \"./command/CommandBuffer\"\r\nimport { ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { RenderTargetFormat } from \"../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { RenderTexture } from \"../../../resource/RenderTexture\";\r\n\r\n/**\r\n * * <code>PostProcessRenderContext</code> \r\n */\r\nexport class PostProcessRenderContext {\r\n\t/** origan RenderTexture RT,RT*/\r\n\tsource: RenderTexture | null = null;\r\n\t/** forward effect target */\r\n\tindirectTarget:RenderTexture|null = null;\r\n\t/** dest RenderTexture RT*/\r\n\tdestination: RenderTexture | null = null;\r\n\t/** */\r\n\tcamera: Camera | null = null;\r\n\t/** */\r\n\tcompositeShaderData: ShaderData | null = null;\r\n\t/** */\r\n\tcommand: CommandBuffer | null = null;\r\n\t/** ,RT*/\r\n\tdeferredReleaseTextures: RenderTexture[] = [];\r\n\r\n\t/**\r\n\t * RTRT \r\n\t */\r\n\tcreateRTByContextReleaseTexture(width: number, height: number, colorFormat: RenderTargetFormat, depthFormat: RenderTargetFormat, mipmap: boolean = false, multiSamples: number = 1, depthTexture: boolean = false, sRGB: boolean = false){\r\n\t\tlet n =this.deferredReleaseTextures.length\r\n\t\tfor (let index = 0; index <n ; index++) {\r\n            let rt = this.deferredReleaseTextures[index];\r\n            if (rt.width == width && rt.height == height && rt.colorFormat == colorFormat && rt.depthStencilFormat == depthFormat && rt._generateMipmap == mipmap && rt.multiSamples == multiSamples && rt.generateDepthTexture == depthTexture && rt._gammaSpace == sRGB) {\r\n                rt._inPool = false;\r\n                let end = this.deferredReleaseTextures[n - 1];\r\n                this.deferredReleaseTextures[index] = end;\r\n                this.deferredReleaseTextures.length -= 1;\r\n                return rt;\r\n            }\r\n        }\r\n\t\treturn null;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { PostProcess } from \"../../component/PostProcess\";\r\nimport { PostProcessRenderContext } from \"./PostProcessRenderContext\";\r\n/**\r\n\t * <code>PostProcessEffect</code> \r\n\t */\r\nexport class PostProcessEffect {\r\n\r\n\t/**@internal */\r\n\tprotected _active:boolean;\r\n\t/**@internal */\r\n\tprotected _singleton:boolean;\r\n\r\n\t/**\r\n\t *  <code>PostProcessEffect</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tthis._active = true;\r\n\t\tthis._singleton = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tset singleton(value:boolean){\r\n\t\tthis._singleton = value;\r\n\t}\r\n\r\n\tget singleton(){\r\n\t\treturn this._singleton;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget active(){\r\n\t\treturn this._active;\r\n\t}\r\n\r\n\tset active(value:boolean){\r\n\t\tthis._active = value;\r\n\t}\r\n\r\n\t/**\r\n\t * cameraDepthTextureMode\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @returns \r\n\t */\r\n\tgetCameraDepthTextureModeFlag() {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * ,\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\teffectInit(postprocess:PostProcess) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t/**\r\n\t * Effect\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trelease(postprocess:PostProcess){\r\n\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @internal\r\n\t */\r\n\trender(context: PostProcessRenderContext): void {\r\n\r\n\t}\r\n}\r\n\r\n\r\n","#define SHADER_NAME BlitVS\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main()\r\n{\r\n    gl_Position = vec4(u_OffsetScale.x * 2.0 - 1.0 + (a_PositionTexcoord.x + 1.0) * u_OffsetScale.z, (1.0 - ((u_OffsetScale.y * 2.0 - 1.0 + (-a_PositionTexcoord.y + 1.0) * u_OffsetScale.w) + 1.0) / 2.0) * 2.0 - 1.0, 0.0, 1.0);\r\n\r\n    v_Texcoord0 = a_PositionTexcoord.zw;\r\n}","import { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { FilterMode } from \"../../../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { RenderTargetFormat } from \"../../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { WrapMode } from \"../../../../RenderEngine/RenderEnum/WrapMode\";\r\nimport { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData, ShaderDataType } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderDefine } from \"../../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { SubShader } from \"../../../../RenderEngine/RenderShader/SubShader\";\r\nimport { VertexMesh } from \"../../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\nimport { Material } from \"../../../../resource/Material\";\r\nimport { CommandBuffer } from \"../command/CommandBuffer\";\r\nimport { PostProcessEffect } from \"../PostProcessEffect\";\r\nimport { PostProcessRenderContext } from \"../PostProcessRenderContext\";\r\nimport BlitVS from \"../../../../d3/shader/postprocess/BlitScreen.vs\";\r\nimport BlitLUTShader from \"../../../../d3/shader/postprocess/BlitLUTScreen.fs\";\r\nimport { RenderState } from \"../../../../RenderEngine/RenderShader/RenderState\";\r\nimport { Texture2D } from \"../../../../resource/Texture2D\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { PostProcess } from \"../../../component/PostProcess\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\n\r\nexport enum ToneMappingType {\r\n\tNone,\r\n\tACES\r\n}\r\n\r\n/**\r\n * <code>ColorGradEffect</code> Effect\r\n */\r\nexport class ColorGradEffect extends PostProcessEffect {\r\n\tstatic SHADERDEFINE_ACES: ShaderDefine;\r\n\tstatic SHADERDEFINE_CUSTOMLUT: ShaderDefine;\r\n\r\n\tstatic SHADERVALUE_LUT: number;\r\n\tstatic SHADERVALUE_LUTPARAMS: number;\r\n\tstatic SHADERVALUE_CUSTOMLUT: number;\r\n\tstatic SHADERVALUE_CUSTOMLUTPARAMS: number;\r\n\r\n\t/**\r\n\t * bloom resource init\r\n\t */\r\n\tstatic init() {\r\n\t\tColorGradEffect.__initDefine__();\r\n\t\tlet attributeMap: { [name: string]: [number, ShaderDataType] } = {\r\n\t\t\t\"a_PositionTexcoord\": [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n\t\t};\r\n\r\n\t\tlet uniformMap = {\r\n\t\t\t\"u_OffsetScale\": ShaderDataType.Vector4,\r\n\t\t\t\"u_MainTex\": ShaderDataType.Texture2D,\r\n\t\t\t\"u_MainTex_TexelSize\": ShaderDataType.Vector4, //x:width,y:height,z:1/width,w:1/height\r\n\t\t};\r\n\t\tlet shader = Shader3D.add(\"blitLUTShader\");\r\n\t\tlet subShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tlet pass = subShader.addShaderPass(BlitVS, BlitLUTShader);\r\n\t\tpass.renderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\tpass.renderState.depthWrite = false;\r\n\t\tpass.renderState.cull = RenderState.CULL_NONE;\r\n\t\tpass.renderState.blend = RenderState.BLEND_DISABLE;\r\n\t}\r\n\r\n\tstatic __initDefine__() {\r\n\t\tColorGradEffect.SHADERDEFINE_ACES = Shader3D.getDefineByName(\"ACES\");\r\n\t\tColorGradEffect.SHADERDEFINE_CUSTOMLUT = Shader3D.getDefineByName(\"CUSTOMLUT\");\r\n\r\n\r\n\t\tColorGradEffect.SHADERVALUE_LUT = Shader3D.propertyNameToID(\"u_Lut\");\r\n\t\tColorGradEffect.SHADERVALUE_LUTPARAMS = Shader3D.propertyNameToID(\"u_LutParams\");\r\n\t\tColorGradEffect.SHADERVALUE_CUSTOMLUT = Shader3D.propertyNameToID(\"u_CustomLut\");\r\n\t\tColorGradEffect.SHADERVALUE_CUSTOMLUTPARAMS = Shader3D.propertyNameToID(\"u_CustomLutParams\");\r\n\t}\r\n\r\n\tprivate _needBuildLUT: boolean = false;\r\n\r\n\tprivate _lutCommond: CommandBuffer;\r\n\t_lutTex: RenderTexture;\r\n\tprivate _lutBuilderMat = new Material();\r\n\r\n\r\n\tprivate _LUTShader: Shader3D;\r\n\tprivate _lutShaderData: ShaderData;\r\n\tprivate _blitlutParams: Vector4;\r\n\r\n\t/**color Tone */\r\n\t/**@internal */\r\n\tprivate _toneMapping: ToneMappingType;\r\n\t/**@internal lut height size */\r\n\tprivate _lutSize = 32;\r\n\r\n\t// split toning\r\n\t/**@internal */\r\n\tprivate _enableSplitTone: boolean = false;\r\n\tprivate _splitShadow: Vector3 = new Vector3(0.5, 0.5, 0.5);\r\n\tprivate _splitBalance: number = 0;//-1-1\r\n\tprivate _splithighlights: Vector3 = new Vector3(0.5, 0.5, 0.5);\r\n\tprivate _u_SplitShadow: Vector4 = new Vector4(0, 0, 0);\r\n\r\n\t// shadows, midtones, highlights\r\n\tprivate _enableSMH: boolean = false;\r\n\t/**@internal */\r\n\tprivate _shadows: Vector3 = new Vector3(1, 1, 1);//0-5\r\n\t/**@internal */\r\n\tprivate _midtones: Vector3 = new Vector3(1, 1, 1);//0-5\r\n\t/**@internal */\r\n\tprivate _highlights: Vector3 = new Vector3(1, 1, 1);//0-5\r\n\t/**@internal */\r\n\tprivate _limits: Vector4 = new Vector4(0, 0.33, 0.55, 1);\r\n\r\n\t//lift gamma gain\r\n\tprivate _enableLiftGammaGain: boolean = false;\r\n\t/**@internal */\r\n\tprivate _lift: Vector3 = new Vector3(0, 0, 0);//-1-1\r\n\t/**@internal */\r\n\tprivate _gamma: Vector3 = new Vector3(1, 1, 1);//999-0.5\r\n\t/**@internal */\r\n\tprivate _gain: Vector3 = new Vector3(1, 1, 1);//0-2\r\n\r\n\t//white balance\r\n\tprivate _enableBalance: boolean = false;\r\n\t/**@internal tint,temperature */\r\n\tprivate _balance: Vector3 = new Vector3();\r\n\tprivate _tint: number = 0;//-100-100\r\n\tprivate _temperature: number = 0;//-100-1\r\n\r\n\t//Color Adjustments\r\n\t/**@internal */\r\n\tprivate _enableColorAdjust: boolean = false;\r\n\t/**@internal */\r\n\tprivate _postExposure = 1;//,1\r\n\t/**@internal */\r\n\tprivate _contrast = 1;//range 0-2//HueSatCon.z\r\n\t/**@internal */\r\n\tprivate _colorFilter = new Color(1, 1, 1);//\r\n\t/**@internal */\r\n\tprivate _HueShift = 0;//-0.5-0.5 HueSatCon.x\r\n\r\n\t/**@internal */\r\n\tprivate _saturation = 1;//0-2HueSatCon.y\r\n\r\n\t/**@internal _HueShift,_saturation,_contrast*/\r\n\tprivate _HueSatCon: Vector4 = new Vector4(0, 1, 1, 0);\r\n\r\n\t/**\r\n\t * Tone Map\r\n\t */\r\n\tpublic get toneMapping(): ToneMappingType {\r\n\t\treturn this._toneMapping;\r\n\t}\r\n\r\n\tpublic set toneMapping(value: ToneMappingType) {\r\n\t\tif (value == this._toneMapping)\r\n\t\t\treturn\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._toneMapping = value;\r\n\t}\r\n\r\n\t// split toning\r\n\t/**\r\n\t * Split Tone\r\n\t */\r\n\tpublic get enableSplitTone() {\r\n\t\treturn this._enableSplitTone;\r\n\t}\r\n\r\n\tpublic set enableSplitTone(value: boolean) {\r\n\t\tthis._enableSplitTone = value;\r\n\t\tthis._needBuildLUT = true;\r\n\t}\r\n\r\n\t/**\r\n\t * split shadow\r\n\t */\r\n\tpublic get splitShadow(): Vector3 {\r\n\t\treturn this._splitShadow;\r\n\t}\r\n\r\n\tpublic set splitShadow(value: Vector3) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._splitShadow);\r\n\t}\r\n\r\n\t/**\r\n\t * split hightLight\r\n\t */\r\n\tpublic get splithighlights(): Vector3 {\r\n\t\treturn this._splithighlights;\r\n\t}\r\n\tpublic set splithighlights(value: Vector3) {\r\n\t\tif (this._splithighlights.equal(value))\r\n\t\t\treturn;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._splithighlights);\r\n\t}\r\n\r\n\t/**\r\n\t * split balance\r\n\t */\r\n\tpublic get splitBalance(): number {\r\n\t\treturn this._splitBalance;\r\n\t}\r\n\r\n\tpublic set splitBalance(value: number) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._splitBalance = value;\r\n\t}\r\n\r\n\t// shadows, midtones, highlights\r\n\tpublic get enableSMH(): boolean {\r\n\t\treturn this._enableSMH;\r\n\t}\r\n\r\n\tpublic set enableSMH(value: boolean) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._enableSMH = value;\r\n\t}\r\n\r\n\t/**\r\n\t * shadows 0-5\r\n\t */\r\n\tpublic get shadows(): Vector3 {\r\n\t\treturn this._shadows;\r\n\t}\r\n\r\n\tpublic set shadows(value: Vector3) {\r\n\t\tif (this._shadows.equal(value))\r\n\t\t\treturn;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._shadows);\r\n\t}\r\n\r\n\t/**\r\n\t * midtones 0-5\r\n\t */\r\n\tpublic get midtones(): Vector3 {\r\n\t\treturn this._midtones;\r\n\t}\r\n\tpublic set midtones(value: Vector3) {\r\n\t\tif (this._midtones.equal(value))\r\n\t\t\treturn;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._midtones);\r\n\t}\r\n\r\n\t/**\r\n\t * highlights 0-5\r\n\t */\r\n\tpublic get highlights(): Vector3 {\r\n\t\treturn this._highlights;\r\n\t}\r\n\tpublic set highlights(value: Vector3) {\r\n\t\tif (this._highlights.equal(value))\r\n\t\t\treturn;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._highlights);\r\n\t}\r\n\r\n\t/**\r\n\t * shadow limit start 0-1\r\n\t */\r\n\tpublic get shadowLimitStart(): number {\r\n\t\treturn this._limits.x;\r\n\t}\r\n\r\n\tpublic set shadowLimitStart(value: number) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._limits.x = Math.min(value, this.shadowLimitEnd);\r\n\t}\r\n\r\n\t/**\r\n\t * shadow limit end 0-1\r\n\t */\r\n\tpublic get shadowLimitEnd(): number {\r\n\t\treturn this._limits.y;\r\n\t}\r\n\r\n\tpublic set shadowLimitEnd(value: number) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._limits.y = Math.max(value, this.shadowLimitStart);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * high Light limit start 0-1\r\n\t */\r\n\tpublic get highLightLimitStart(): number {\r\n\t\treturn this._limits.z;\r\n\t}\r\n\r\n\tpublic set highLightLimitStart(value: number) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._limits.z = Math.min(value, this.highLightLimitEnd);\r\n\t}\r\n\r\n\t/**\r\n\t * high Light limit end 0-1\r\n\t */\r\n\tpublic get highLightLimitEnd(): number {\r\n\t\treturn this._limits.w;\r\n\t}\r\n\r\n\tpublic set highLightLimitEnd(value: number) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._limits.w = Math.max(this.highLightLimitStart, value);\r\n\t}\r\n\r\n\r\n\t//lift gamma gain\r\n\tpublic get enableLiftGammaGain() {\r\n\t\treturn this._enableLiftGammaGain;\r\n\t}\r\n\r\n\tpublic set enableLiftGammaGain(value: boolean) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._enableLiftGammaGain = value;\r\n\t}\r\n\r\n\t/**\r\n\t * lift -1-1\r\n\t */\r\n\tpublic get lift(): Vector3 {\r\n\t\treturn this._lift;\r\n\t}\r\n\r\n\tpublic set lift(value: Vector3) {\r\n\t\tif (this.lift.equal(value))\r\n\t\t\treturn;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._lift);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * gamma 999-0.5\r\n\t */\r\n\tpublic get gamma(): Vector3 {\r\n\t\treturn this._gamma;\r\n\t}\r\n\r\n\tpublic set gamma(value: Vector3) {\r\n\t\tif (this._gamma.equal(value))\r\n\t\t\treturn;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._gamma);\r\n\t}\r\n\r\n\t/**\r\n\t * gain 0-2\r\n\t */\r\n\tpublic get gain(): Vector3 {\r\n\t\treturn this._gain;\r\n\t}\r\n\r\n\tpublic set gain(value: Vector3) {\r\n\t\tif (this._gain.equal(value))\r\n\t\t\treturn;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._gain);\r\n\t}\r\n\r\n\tprivate _StandardIlluminantY(x: number) {\r\n\t\treturn 2.87 * x - 3 * x * x - 0.27509507;\r\n\t};\r\n\r\n\tprivate _CIExyToLMS(x: number, y: number) {\r\n\t\tlet Y = 1;\r\n\t\tlet X = Y * x / y;\r\n\t\tlet Z = Y * (1 - x - y) / y;\r\n\r\n\t\tlet L = 0.7328 * X + 0.4296 * Y - 0.1624 * Z;\r\n\t\tlet M = -0.7036 * X + 1.6975 * Y + 0.0061 * Z;\r\n\t\tlet S = 0.0030 * X + 0.0136 * Y + 0.9834 * Z;\r\n\r\n\t\treturn new Vector3(L, M, S);\r\n\t}\r\n\r\n\t// Converts white balancing parameter to LMS coefficients.\r\n\tprivate _ColorBalanceToLMSCoeffs(temperature: number, tint: number) {\r\n\r\n\t\t// Range ~[-1.5;1.5] works best\r\n\t\tlet t1 = temperature / 65.0;\r\n\t\tlet t2 = tint / 65.0;\r\n\r\n\t\t// Get the CIE xy chromaticity of the reference white point.\r\n\t\t// Note: 0.31271 = x value on the D65 white point\r\n\t\tlet x = 0.31271 - t1 * (t1 < 0 ? 0.1 : 0.05);\r\n\t\tlet y = this._StandardIlluminantY(x) + t2 * 0.05;\r\n\r\n\t\t// Calculate the coefficients in the LMS space.\r\n\t\tlet w1 = new Vector3(0.949237, 1.03542, 1.08728);\r\n\t\tlet w2 = this._CIExyToLMS(x, y);\r\n\r\n\t\tthis._balance.set(w1.x / w2.x, w1.y / w2.y, w1.z / w2.z);\r\n\t}\r\n\r\n\t//balance\r\n\tpublic get enableBalance() {\r\n\t\treturn this._enableBalance;\r\n\t}\r\n\r\n\tpublic set enableBalance(value: boolean) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._enableBalance = value;\r\n\t}\r\n\r\n\t/**\r\n\t * tint -100 - 100\r\n\t */\r\n\tpublic get tint(): number {\r\n\t\treturn this._tint;\r\n\t}\r\n\r\n\r\n\tpublic set tint(value: number) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._tint = value;\r\n\t\tthis._ColorBalanceToLMSCoeffs(this._temperature, this._tint);\r\n\t}\r\n\r\n\t/**\r\n\t * temperature -100-100\r\n\t */\r\n\tpublic get temperature(): number {\r\n\t\treturn this._temperature;\r\n\t}\r\n\r\n\tpublic set temperature(value: number) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._temperature = value;\r\n\t\tthis._ColorBalanceToLMSCoeffs(this._temperature, this._tint);\r\n\t}\r\n\r\n\t//Color Adjustments\r\n\tpublic get enableColorAdjust() {\r\n\t\treturn this._enableColorAdjust;\r\n\t}\r\n\r\n\tpublic set enableColorAdjust(value: boolean) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._enableColorAdjust = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tpublic get postExposure() {\r\n\t\treturn this._postExposure;\r\n\t}\r\n\r\n\tpublic set postExposure(value) {\r\n\t\tthis._postExposure = value;\r\n\t}\r\n\r\n\t/**\r\n\t * contrastrange 0-2\r\n\t */\r\n\tpublic get contrast() {\r\n\t\treturn this._contrast;\r\n\t}\r\n\r\n\tpublic set contrast(value) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._contrast = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tpublic get colorFilter() {\r\n\t\treturn this._colorFilter;\r\n\t}\r\n\r\n\tpublic set colorFilter(value: Color) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._colorFilter);\r\n\t}\r\n\r\n\t/** -0.5-0.5*/\r\n\tpublic get HueShift() {\r\n\t\treturn this._HueShift;\r\n\t}\r\n\tpublic set HueShift(value) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._HueShift = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tpublic get saturation() {\r\n\t\treturn this._saturation;\r\n\t}\r\n\tpublic set saturation(value) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._saturation = value;\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t *  <code>BloomEffect</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.singleton = true;\r\n\t\tthis.active = true;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._toneMapping = ToneMappingType.None;\r\n\t\tthis._blitlutParams = new Vector4();\r\n\t\tthis._lutShaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n\t\tthis.lutSize = 32;\r\n\t\tthis._lutCommond = new CommandBuffer();\r\n\t\tthis._lutBuilderMat = new Material();\r\n\t}\r\n\r\n\r\n\r\n\tprivate get lutSize() {\r\n\t\treturn this._lutSize;\r\n\t}\r\n\tprivate set lutSize(value) {\r\n\t\tif (value > 32)//64*6 = 4096\r\n\t\t\treturn\r\n\t\tthis._lutSize = value;\r\n\t\tif (this._lutTex)\r\n\t\t\tthis._lutTex.destroy();\r\n\t\tthis._lutTex = new RenderTexture(this._lutSize * this._lutSize, this._lutSize, RenderTargetFormat.R16G16B16A16, null, false, 1, false, false);\r\n\t\tthis._lutTex.anisoLevel = 1;\r\n\t\tthis._lutTex.wrapModeU = WrapMode.Clamp;\r\n\t\tthis._lutTex.wrapModeV = WrapMode.Clamp;\r\n\t\tthis._lutTex.filterMode = FilterMode.Bilinear;\r\n\t}\r\n\r\n\r\n\r\n\tprivate default_balance = new Vector3(1, 1, 1);\r\n\tprivate default_splitShadow = new Vector4(0.5, 0.5, 0.5, 0.0);\r\n\tprivate default_splithighlights = new Vector3(0.5, 0.5, 0.5);\r\n\tprivate default_shadow = new Vector3(1, 1, 1);\r\n\tprivate default_midtones = new Vector3(1, 1, 1);\r\n\tprivate default_highlight = new Vector3(1, 1, 1);\r\n\tprivate default_limint = new Vector4(0.0, 0.3, 0.55, 1.0);\r\n\tprivate default_lift = new Vector3(0, 0, 0);\r\n\tprivate default_gamma = new Vector3(1, 1, 1);\r\n\tprivate default_gain = new Vector3(1, 1, 1);\r\n\tprivate default_ColorFilter = new Color(1, 1, 1, 1);\r\n\tprivate default_HueSatCon = new Vector4(0, 1, 1, 0);\r\n\t/**\r\n\t * @internal\r\n\t * LUT\r\n\t */\r\n\t_buildLUT() {\r\n\t\tif (!this._needBuildLUT)\r\n\t\t\treturn;\r\n\t\tlet lutHeight = this.lutSize;\r\n\t\tlet lutWidth = this.lutSize * this.lutSize;\r\n\t\tlet lutParams = new Vector4(lutHeight, 0.5 / lutWidth, 0.5 / lutHeight, lutHeight / (lutHeight - 1));\r\n\t\tthis._lutBuilderMat.setVector4(\"u_LutParams\", lutParams);\r\n\r\n\t\tif (this.enableBalance) {\r\n\t\t\tthis._ColorBalanceToLMSCoeffs(this.temperature, this.tint);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_ColorBalance\", this._balance);\r\n\t\t} else {\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_ColorBalance\", this.default_balance);\r\n\t\t}\r\n\r\n\t\tif (this.enableSplitTone) {\r\n\t\t\tthis._u_SplitShadow.setValue(this._splitShadow.x, this._splitShadow.y, this._splitShadow.z, this.splitBalance);\r\n\t\t\tthis._lutBuilderMat.setVector4(\"u_SplitShadows\", this._u_SplitShadow);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Splithighlights\", this._splithighlights);\r\n\t\t} else {\r\n\t\t\tthis._lutBuilderMat.setVector4(\"u_SplitShadows\", this.default_splitShadow);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Splithighlights\", this.default_splithighlights);\r\n\t\t}\r\n\r\n\t\tif (this.enableSMH) {\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Shadows\", this._shadows);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Midtones\", this._midtones);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Highlights\", this._highlights);\r\n\t\t\tthis._lutBuilderMat.setVector4(\"u_Limits\", this._limits);\r\n\t\t} else {\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Shadows\", this.default_shadow);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Midtones\", this.default_midtones);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Highlights\", this.default_highlight);\r\n\t\t\tthis._lutBuilderMat.setVector4(\"u_Limits\", this.default_limint);\r\n\t\t}\r\n\t\tif (this._enableLiftGammaGain) {\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Lift\", this._lift);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Gamma\", this._gamma);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Gain\", this._gain);\r\n\t\t} else {\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Lift\", this.default_lift);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Gamma\", this.default_gamma);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Gain\", this.default_gain);\r\n\t\t}\r\n\t\tif (this.enableColorAdjust) {\r\n\t\t\t//_HueShift,_saturation,_contrast\r\n\t\t\tthis._HueSatCon.setValue(this._HueShift, this.saturation, this._contrast, 0.0);\r\n\t\t\tthis._lutBuilderMat.setColor(\"u_ColorFilter\", this._colorFilter);\r\n\t\t\tthis._lutBuilderMat.setVector4(\"u_HueSatCon\", this._HueSatCon);\r\n\t\t} else {\r\n\t\t\tthis._lutBuilderMat.setColor(\"u_ColorFilter\", this.default_ColorFilter);\r\n\t\t\tthis._lutBuilderMat.setVector4(\"u_HueSatCon\", this.default_HueSatCon);\r\n\t\t}\r\n\r\n\r\n\r\n\t\tif (this._toneMapping == ToneMappingType.ACES) {\r\n\t\t\tthis._lutBuilderMat.addDefine(ColorGradEffect.SHADERDEFINE_ACES);\r\n\t\t} else {\r\n\t\t\tthis._lutBuilderMat.removeDefine(ColorGradEffect.SHADERDEFINE_ACES);\r\n\t\t}\r\n\t\tthis._lutCommond.blitScreenQuadByMaterial(Texture2D.whiteTexture, this._lutTex, null, this._lutBuilderMat);\r\n\t\tthis._lutCommond.context = RenderContext3D._instance;\r\n\t\tthis._lutCommond._apply();\r\n\t\tthis._lutCommond.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * ,\r\n\t */\r\n\teffectInit(postprocess: PostProcess) {\r\n\t\tsuper.effectInit(postprocess);\r\n\t\tthis._lutBuilderMat.setShaderName(\"LUTBuilder\");\r\n\t\tthis._LUTShader = Shader3D.find(\"blitLUTShader\");\r\n\t\tpostprocess._enableColorGrad = true;\r\n\t\tpostprocess._ColorGradEffect = this;\r\n\t\t// this._shader = Shader3D.find(\"PostProcessBloom\");\r\n\t\t// this._pyramid = new Array(BloomEffect.MAXPYRAMIDSIZE * 2);\r\n\t}\r\n\r\n\t/**\r\n\t * Effect\r\n\t */\r\n\trelease(postprocess: PostProcess) {\r\n\t\tsuper.release(postprocess);\r\n\t\tpostprocess._enableColorGrad = false;\r\n\t\tpostprocess._ColorGradEffect = null;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\trender(context: PostProcessRenderContext): void {\r\n\t\tlet cmd: CommandBuffer = context.command;\r\n\t\tlet source: RenderTexture = context.indirectTarget;\r\n\t\tif (true) {\r\n\t\t\tthis._blitlutParams.setValue(1 / this._lutTex.width, 1 / this._lutTex.height, this._lutTex.height - 1, this.enableColorAdjust ? this._postExposure : 1);\r\n\t\t\tthis._lutBuilderMat.removeDefine(ColorGradEffect.SHADERDEFINE_CUSTOMLUT);\r\n\t\t\tthis._lutShaderData.setTexture(ColorGradEffect.SHADERVALUE_LUT, this._lutTex);\r\n\t\t\tthis._lutShaderData.setVector(ColorGradEffect.SHADERVALUE_LUTPARAMS, this._blitlutParams);\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//TODO:CustomLUT\r\n\t\t\tthis._lutBuilderMat.addDefine(ColorGradEffect.SHADERDEFINE_CUSTOMLUT);\r\n\r\n\t\t}\r\n\t\tcmd.blitScreenTriangle(source, context.destination, null, this._LUTShader, this._lutShaderData);\r\n\t}\r\n\r\n}\r\n\r\n\r\n\r\n\r\n","/**\r\n * PBR\r\n */\r\nexport enum PBRRenderQuality {\r\n    /***/\r\n    High,\r\n    /***/\r\n    Low\r\n}","#define SHADER_NAME BlitLUTFS\r\n\r\n#include \"Color.glsl\";\r\n\r\n#include \"ColorGrading.glsl\";\r\n#include \"LUT.glsl\";\r\n\r\nuniform sampler2D u_Lut;\r\nuniform vec4 u_LutParams; // w postExposure\r\n\r\n#ifdef CUSTOMLUT\r\nuniform sampler2D u_CustomLut;\r\nuniform vec4 u_CustomLutParams;\r\n#endif // CUSTOMLUT\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main()\r\n{\r\n    gl_FragColor = texture2D(u_MainTex, v_Texcoord0);\r\n#ifdef Gamma_u_MainTex\r\n    gl_FragColor = gammaToLinear(gl_FragColor);\r\n#endif // Gamma_u_MainTex\r\n\r\n    vec3 color = gl_FragColor.rgb;\r\n    // gl_FragColor.rgb = applyLut(color, 1.0, u_Lut, u_LutParams);\r\n    color *= u_LutParams.w;\r\n    color = applyLut(u_Lut, linearToLogC(color), u_LutParams.xyz);\r\n\r\n#ifdef CUSTOMLUT\r\n\r\n    float contrib = u_CustomLutParams.w;\r\n    vec3 gamma = linearToGamma(color);\r\n    vec3 userLut = applyLut(u_CustomLut, gamma, u_CustomLutParams);\r\n    gamma = mix(gamma, userLut, contrib);\r\n    color = gammaToLinear(gamma);\r\n\r\n#endif // CUSTOMLUT\r\n\r\n    gl_FragColor.rgb = color;\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}\r\n","import { ILaya } from \"../../../ILaya\"\r\nimport { Texture2D } from \"../../resource/Texture2D\"\r\nimport { Camera } from \"../core/Camera\"\r\nimport { CommandBuffer } from \"../core/render/command/CommandBuffer\"\r\nimport { PostProcessEffect } from \"../core/render/PostProcessEffect\"\r\nimport { PostProcessRenderContext } from \"../core/render/PostProcessRenderContext\"\r\nimport { Viewport } from \"../math/Viewport\"\r\nimport { RenderContext3D } from \"../core/render/RenderContext3D\"\r\nimport { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\"\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\"\r\nimport { ShaderData } from \"../../RenderEngine/RenderShader/ShaderData\"\r\nimport { RenderTargetFormat } from \"../../RenderEngine/RenderEnum/RenderTargetFormat\"\r\nimport { DepthTextureMode } from \"../depthMap/DepthPass\"\r\nimport { RenderTexture } from \"../../resource/RenderTexture\"\r\nimport { ColorGradEffect } from \"../core/render/PostEffect/ColorGradEffect\"\r\nimport { LayaGL } from \"../../layagl/LayaGL\"\r\n\r\n/**\r\n * <code>PostProcess</code> \r\n */\r\nexport class PostProcess {\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_BLOOM_LOW: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_BLOOM: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_FINALPASS: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_MAINTEX: number;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_BLOOMTEX: number;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_AUTOEXPOSURETEX: number;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_BLOOM_DIRTTEX: number;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_BLOOMTEX_TEXELSIZE: number;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_BLOOM_DIRTTILEOFFSET: number;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_BLOOM_SETTINGS: number;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_BLOOM_COLOR: number;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n        PostProcess.SHADERDEFINE_BLOOM_LOW = Shader3D.getDefineByName(\"BLOOM_LOW\");\r\n        PostProcess.SHADERDEFINE_BLOOM = Shader3D.getDefineByName(\"BLOOM\");\r\n        PostProcess.SHADERDEFINE_FINALPASS = Shader3D.getDefineByName(\"FINALPASS\");\r\n        PostProcess.SHADERVALUE_MAINTEX = Shader3D.propertyNameToID(\"u_MainTex\");\r\n        PostProcess.SHADERVALUE_BLOOMTEX = Shader3D.propertyNameToID(\"u_BloomTex\");\r\n        PostProcess.SHADERVALUE_AUTOEXPOSURETEX = Shader3D.propertyNameToID(\"u_AutoExposureTex\");\r\n        PostProcess.SHADERVALUE_BLOOM_DIRTTEX = Shader3D.propertyNameToID(\"u_Bloom_DirtTex\");\r\n        PostProcess.SHADERVALUE_BLOOMTEX_TEXELSIZE = Shader3D.propertyNameToID(\"u_BloomTex_TexelSize\");\r\n        PostProcess.SHADERVALUE_BLOOM_DIRTTILEOFFSET = Shader3D.propertyNameToID(\"u_Bloom_DirtTileOffset\");\r\n        PostProcess.SHADERVALUE_BLOOM_SETTINGS = Shader3D.propertyNameToID(\"u_Bloom_Settings\");\r\n        PostProcess.SHADERVALUE_BLOOM_COLOR = Shader3D.propertyNameToID(\"u_Bloom_Color\");\r\n    }\r\n\r\n    /**@internal */\r\n    private _compositeShader: Shader3D = Shader3D.find(\"PostProcessComposite\");\r\n\r\n    /**@internal */\r\n    private _compositeShaderData: ShaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n\r\n    /**@internal */\r\n    private _effects: PostProcessEffect[] = [];\r\n\r\n    /**@internal */\r\n    private _enable: boolean = true;\r\n\r\n    /**@internal */\r\n    private _depthtextureFlag: DepthTextureMode;\r\n    /**@internal Effect*/\r\n    _ColorGradEffect: ColorGradEffect;\r\n    /**@internal Effect*/\r\n    _enableColorGrad: boolean = false;\r\n\r\n    /**@internal */\r\n    _context: PostProcessRenderContext | null = null;\r\n\r\n    /**\r\n     * CameraFlag\r\n     */\r\n    private recaculateCameraFlag() {\r\n        this._depthtextureFlag = DepthTextureMode.None;\r\n        let n = this.effects.length;\r\n        for (let i = 0; i < n; i++) {\r\n            this._depthtextureFlag |= this.effects[i].getCameraDepthTextureModeFlag();\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  <code>PostProcess</code> \r\n     */\r\n    constructor() {\r\n        this._context = new PostProcessRenderContext();\r\n        this._context.compositeShaderData = this._compositeShaderData;\r\n        this._context.command = new CommandBuffer();\r\n        this._depthtextureFlag = 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get enable(): boolean {\r\n        return this._enable;\r\n    }\r\n\r\n    set enable(value: boolean) {\r\n        this._enable = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     */\r\n    set commandContext(oriContext: RenderContext3D) {\r\n        this._context.command._context = oriContext;\r\n    }\r\n\r\n    /**\r\n     * IDEmain\r\n     * Effect\r\n     */\r\n    set effects(value: PostProcessEffect[]) {\r\n        this.clearEffect();\r\n        for (var i = 0, n = value.length; i < n; i++) {\r\n            if (value[i])\r\n                this.addEffect(value[i]);\r\n        }\r\n    }\r\n\r\n    get effects(): PostProcessEffect[] {\r\n        return this._effects;\r\n    }\r\n\r\n    /**\r\n     * ,\r\n     */\r\n    get cameraDepthTextureMode() {\r\n        return this._depthtextureFlag;\r\n    }\r\n\r\n    /**\r\n     *@internal\r\n     */\r\n    _init(camera: Camera): void {\r\n        this._context!.camera = camera;\r\n        this._context!.command!._camera = camera;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _render(camera: Camera): void {\r\n        this._init(camera);\r\n        var camera = this._context!.camera;\r\n        var viewport: Viewport = camera!.viewport;\r\n        var cameraTarget: RenderTexture = camera!._internalRenderTexture;\r\n        var screenTexture: RenderTexture = RenderTexture.createFromPool(cameraTarget.width, cameraTarget.height, camera._getRenderTextureFormat(), RenderTargetFormat.None, false, 1, false, true);\r\n        var Indirect: RenderTexture[] = [RenderTexture.createFromPool(cameraTarget.width, cameraTarget.height, camera._getRenderTextureFormat(), RenderTargetFormat.None, false, 1, false, true), RenderTexture.createFromPool(cameraTarget.width, cameraTarget.height, camera._getRenderTextureFormat(), RenderTargetFormat.None, false, 1, false, true)];\r\n        //var screenTexture: RenderTexture = cameraTarget;\r\n        this._context!.command!.clear();\r\n        this._context!.source = screenTexture;\r\n        this._context!.indirectTarget = screenTexture;\r\n        this._context!.destination = this._effects.length == 2 ? Indirect[0] : cameraTarget;\r\n        this._context!.compositeShaderData!.clearDefine();\r\n\r\n        this._context.command.blitScreenTriangle(cameraTarget, screenTexture);\r\n\r\n        this._context!.compositeShaderData!.setTexture(PostProcess.SHADERVALUE_AUTOEXPOSURETEX, Texture2D.whiteTexture);//TODO:\r\n        if (this._enableColorGrad) {\r\n            this._ColorGradEffect._buildLUT();\r\n        }\r\n        for (var i: number = 0, n: number = this._effects.length; i < n; i++) {\r\n            if (this._effects[i].active) {\r\n                this._effects[i].render(this._context!);\r\n                if (i == n - 2) {//last effect:destination RenderTexture is CameraTarget\r\n                    this._context.indirectTarget = this._context.destination;\r\n                    this._context.destination = cameraTarget;\r\n                } else {\r\n                    this._context.indirectTarget = this._context.destination;\r\n                    this._context.destination = Indirect[(i + 1) % 2];\r\n                }\r\n            } else if (i == n - 1) {//Effect Activefalse\r\n                this._context.command.blitScreenTriangle(this._context.indirectTarget, cameraTarget);\r\n            }\r\n        }\r\n\r\n        this._compositeShaderData.addDefine(PostProcess.SHADERDEFINE_FINALPASS);\r\n\r\n        var offScreenTex: RenderTexture = camera!._offScreenRenderTexture;\r\n        var dest = offScreenTex ? offScreenTex : null;//TODO:RenderTarget,null\r\n        this._context!.destination = dest;\r\n        var canvasWidth: number = camera!._getCanvasWidth(), canvasHeight: number = camera!._getCanvasHeight();\r\n        if (dest) {\r\n            camera!._screenOffsetScale.setValue(viewport.x / canvasWidth, (canvasHeight - viewport.y - viewport.height) / canvasHeight, viewport.width / canvasWidth, viewport.height / canvasHeight);\r\n            this._context!.command!.blitScreenTriangle(cameraTarget, dest, camera!._screenOffsetScale, null, this._compositeShaderData, 0);\r\n        }\r\n\r\n        //\r\n        RenderTexture.recoverToPool(screenTexture);\r\n        RenderTexture.recoverToPool(Indirect[0]);\r\n        RenderTexture.recoverToPool(Indirect[1]);\r\n        var tempRenderTextures: RenderTexture[] = this._context!.deferredReleaseTextures;\r\n        for (i = 0, n = tempRenderTextures.length; i < n; i++)\r\n            RenderTexture.recoverToPool(tempRenderTextures[i]);\r\n        tempRenderTextures.length = 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    addEffect(effect: PostProcessEffect): void {\r\n        if (effect.singleton && this.getEffect((effect as any).constructor)) {\r\n            console.error(\"Effect\");\r\n            return;\r\n        }\r\n        if (!this._enableColorGrad || effect instanceof ColorGradEffect) {\r\n            this._effects.push(effect);\r\n        } else {\r\n            this._effects.splice(this._effects.length - 1, 0, effect);\r\n        }\r\n\r\n        this.recaculateCameraFlag();\r\n        effect.effectInit(this);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param classReg \r\n     * @returns \r\n     */\r\n    getEffect(classReg: any): any {\r\n        let size: number = this._effects.length;\r\n        for (let i = 0; i < size; i++) {\r\n            let element = this._effects[i];\r\n            if (element instanceof classReg) {\r\n                return element;\r\n            }\r\n        }\r\n        return null\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    removeEffect(effect: PostProcessEffect): void {\r\n        var index: number = this._effects.indexOf(effect);\r\n        if (index !== -1) {\r\n            this._effects.splice(index, 1);\r\n            effect.release(this);\r\n            this.recaculateCameraFlag();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    clearEffect(): void {\r\n        let i = this.effects.length - 1;\r\n        for (; i >= 0; i--) {\r\n            this.removeEffect(this.effects[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     */\r\n    _applyPostProcessCommandBuffers(): void {\r\n        this._context!.command!._apply();\r\n    }\r\n}\r\n\r\n\r\n","import { HDRTextureInfo } from \"../../../RenderEngine/HDRTextureInfo\";\r\nimport { RenderCapable } from \"../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { TextureFormat } from \"../../../RenderEngine/RenderEnum/TextureFormat\";\r\nimport { WrapMode } from \"../../../RenderEngine/RenderEnum/WrapMode\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { Texture2D } from \"../../../resource/Texture2D\";\r\nimport { Base64Tool } from \"../../../utils/Base64Tool\";\r\n\r\n\r\nconst dfg_128 = \"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\"\r\n\r\nconst RGBDMaxRange = 255;\r\n/**\r\n * @internal\r\n */\r\nexport class PBRDefaultDFG {\r\n\r\n    // todo \r\n    private static _defaultDFG: Texture2D;\r\n    public static get defaultDFG(): Texture2D {\r\n        return PBRDefaultDFG._defaultDFG;\r\n    }\r\n    public static set defaultDFG(value: Texture2D) {\r\n        PBRDefaultDFG._defaultDFG = value;\r\n    }\r\n\r\n    static DefaultDfgTexture() {\r\n        let hdrBuffer = Base64Tool.decode(dfg_128);\r\n        let hdrInfo = HDRTextureInfo.getHDRInfo(hdrBuffer);\r\n\r\n        let supportFloatTex = LayaGL.renderEngine.getCapable(RenderCapable.TextureFormat_R32G32B32A32);\r\n        let supportFloatLinearFiltering = LayaGL.renderEngine.getCapable(RenderCapable.Texture_FloatLinearFiltering);\r\n\r\n        let tex: Texture2D;\r\n\r\n        if (supportFloatTex && supportFloatLinearFiltering) {\r\n            tex = new Texture2D(hdrInfo.width, hdrInfo.height, hdrInfo.format, false, false, false);\r\n            tex.setHDRData(hdrInfo);\r\n        }\r\n        else {\r\n            tex = new Texture2D(hdrInfo.width, hdrInfo.height, TextureFormat.R8G8B8A8, false, false, false);\r\n\r\n            let pixelCount = hdrInfo.width * hdrInfo.height;\r\n            let hdrPixelData = <Float32Array>hdrInfo.readScanLine();\r\n            let rgbdPixelData = new Uint8Array(pixelCount * 4);\r\n\r\n            for (let index = 0; index < pixelCount; index++) {\r\n\r\n                let r = hdrPixelData[index * 4];\r\n                let g = hdrPixelData[index * 4 + 1];\r\n                let b = hdrPixelData[index * 4 + 2];\r\n\r\n                let maxRGB = Math.max(r, g, b, 1e-5);\r\n                let d = Math.max(1.0, RGBDMaxRange / maxRGB);\r\n                d = Math.min(1, Math.max(0, (d / 255)));\r\n\r\n                rgbdPixelData[index * 4] = Math.min(1, Math.max(0, (r * d))) * 255;\r\n                rgbdPixelData[index * 4 + 1] = Math.min(1, Math.max(0, (g * d))) * 255;\r\n                rgbdPixelData[index * 4 + 2] = Math.min(1, Math.max(0, (b * d))) * 255;\r\n                rgbdPixelData[index * 4 + 3] = d * 255;\r\n            }\r\n\r\n            tex.setPixelsData(rgbdPixelData, false, false);\r\n        }\r\n\r\n        tex.lock = true;\r\n        tex.wrapModeU = WrapMode.Clamp;\r\n        tex.wrapModeV = WrapMode.Clamp;\r\n        tex.anisoLevel = 1;\r\n\r\n        this._defaultDFG = tex;\r\n    }\r\n\r\n}","import { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\n\r\nimport BRDFGLSL from \"./BRDF.glsl\";\r\nimport PBRGIGLSL from \"./pbrGI.glsl\";\r\n\r\nimport PBRCommonGLSL from \"./pbrCommon.glsl\";\r\nimport PBRVertexGLSL from \"./pbrVertex.glsl\";\r\nimport PBRFragGLSL from \"./pbrFrag.glsl\";\r\nimport PBRMetallicGLSL from \"./pbrMetallicFrag.glsl\";\r\nimport { PBRDefaultDFG } from \"./PBRDefaultDFG\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\n\r\nexport class PBRShaderLib {\r\n\r\n    /**\r\n     * emission\r\n     */\r\n    static DEFINE_EMISSION: ShaderDefine;\r\n\r\n    /**\r\n     * clear coat\r\n     */\r\n    static DEFINE_CLEARCOAT: ShaderDefine;\r\n    static DEFINE_CLEARCOAT_NORMAL: ShaderDefine;\r\n\r\n    /**\r\n     * anisotropy\r\n     */\r\n    static DEFINE_ANISOTROPY: ShaderDefine;\r\n\r\n    /**\r\n     * ior\r\n     */\r\n    static DEFINE_IOR: ShaderDefine;\r\n\r\n    /**\r\n     * iridescence\r\n     */\r\n    static DEFINE_IRIDESCENCE: ShaderDefine;\r\n\r\n    /**\r\n     * sheen\r\n     */\r\n    static DEFINE_SHEEN: ShaderDefine;\r\n\r\n    /**\r\n     * transmission\r\n     */\r\n    static DEFINE_TRANSMISSION: ShaderDefine;\r\n\r\n    /**\r\n     * thick / volume\r\n     */\r\n    static DEFINE_THICKNESS: ShaderDefine;\r\n\r\n    static init() {\r\n\r\n        PBRShaderLib.DEFINE_EMISSION = Shader3D.getDefineByName(\"EMISSION\");\r\n\r\n        PBRShaderLib.DEFINE_CLEARCOAT = Shader3D.getDefineByName(\"CLEARCOAT\");\r\n        PBRShaderLib.DEFINE_CLEARCOAT_NORMAL = Shader3D.getDefineByName(\"CLEARCOAT_NORMAL\");\r\n\r\n        PBRShaderLib.DEFINE_ANISOTROPY = Shader3D.getDefineByName(\"ANISOTROPIC\");\r\n\r\n        PBRShaderLib.DEFINE_IOR = Shader3D.getDefineByName(\"IOR\");\r\n\r\n        PBRShaderLib.DEFINE_IRIDESCENCE = Shader3D.getDefineByName(\"IRIDESCENCE\");\r\n\r\n        PBRShaderLib.DEFINE_SHEEN = Shader3D.getDefineByName(\"SHEEN\");\r\n\r\n        PBRShaderLib.DEFINE_TRANSMISSION = Shader3D.getDefineByName(\"TRANSMISSION\");\r\n\r\n        PBRShaderLib.DEFINE_THICKNESS = Shader3D.getDefineByName(\"THICKNESS\");\r\n\r\n        // pbr lib\r\n        Shader3D.addInclude(\"BRDF.glsl\", BRDFGLSL);\r\n        Shader3D.addInclude(\"PBRGI.glsl\", PBRGIGLSL);\r\n\r\n        Shader3D.addInclude(\"PBRCommon.glsl\", PBRCommonGLSL);\r\n        Shader3D.addInclude(\"PBRVertex.glsl\", PBRVertexGLSL);\r\n        Shader3D.addInclude(\"PBRFrag.glsl\", PBRFragGLSL);\r\n\r\n        PBRDefaultDFG.DefaultDfgTexture();\r\n        SubShader.regIncludeBindUnifrom(\"PBRGI.glsl\", { \"u_IBLDFG\": ShaderDataType.Texture2D }, { \"u_IBLDFG\": PBRDefaultDFG.defaultDFG });\r\n\r\n        Shader3D.addInclude(\"PBRMetallicFrag.glsl\", PBRMetallicGLSL);\r\n    }\r\n}","#if !defined(BRDF)\r\n    #define BRDF\r\n\r\n// Specular implementations\r\nfloat D_GGX(float roughness, float NoH, vec3 h, vec3 n)\r\n{\r\n    // todo \r\n    #if !defined(GL_FRAGMENT_PRECISION_HIGH)\r\n    vec3 NxH = cross(n, h);\r\n    float oneMinusNoHSquared = dot(NxH, NxH);\r\n    #else\r\n    float oneMinusNoHSquared = 1.0 - NoH * NoH;\r\n    #endif\r\n\r\n    float a = NoH * roughness;\r\n    float k = roughness / (oneMinusNoHSquared + a * a);\r\n    float d = k * k * INVERT_PI;\r\n\r\n    return saturateMediump(d);\r\n}\r\n\r\nfloat D_GGX_Anisotropic(float NoH, const vec3 h, const vec3 t, const vec3 b, float at, float ab)\r\n{\r\n    float ToH = dot(t, h);\r\n    float BoH = dot(b, h);\r\n    float a2 = at * ab;\r\n    highp vec3 v = vec3(ab * ToH, at * BoH, a2 * NoH);\r\n    highp float v2 = dot(v, v);\r\n    float w2 = a2 / v2;\r\n    return a2 * w2 * w2 * INVERT_PI;\r\n}\r\n\r\nfloat D_Charlie(float roughness, float NoH)\r\n{\r\n    float invR = 1.0 / roughness;\r\n    float cos2h = NoH * NoH;\r\n    float sin2h = max(1.0 - cos2h, 0.0078125);\r\n    return (2.0 + invR) * pow(sin2h, invR * 0.5) * 0.5 * INVERT_PI;\r\n}\r\n\r\nfloat V_SmithGGXCorrelated(float roughness, float NoV, float NoL)\r\n{\r\n    float a2 = roughness * roughness;\r\n    float lambdaV = NoL * sqrt((NoV - a2 * NoV) * NoV + a2);\r\n    float lambdaL = NoV * sqrt((NoL - a2 * NoL) * NoL + a2);\r\n    float v = 0.5 / (lambdaV + lambdaL);\r\n\r\n    return saturateMediump(v);\r\n}\r\n\r\nfloat V_SmithGGXCorrelated_Fast(float roughness, float NoV, float NoL)\r\n{\r\n    float v = 0.5 / mix(2.0 * NoL * NoV, NoL + NoV, roughness);\r\n    return saturateMediump(v);\r\n}\r\n\r\n// Kelemen 2001, \"A Microfacet Based Coupled Specular-Matte BRDF Model with Importance Sampling\"\r\nfloat V_kelemen(float LoH)\r\n{\r\n    return saturateMediump(0.25 / (LoH * LoH));\r\n}\r\n\r\nfloat lCharlieNumericHelper(float x, float alphaG)\r\n{\r\n    float oneMinusAlphaSq = (1.0 - alphaG) * (1.0 - alphaG);\r\n    float a = mix(21.5473, 25.3245, oneMinusAlphaSq);\r\n    float b = mix(3.82987, 3.32435, oneMinusAlphaSq);\r\n    float c = mix(0.19823, 0.16801, oneMinusAlphaSq);\r\n    float d = mix(-1.97760, -1.27393, oneMinusAlphaSq);\r\n    float e = mix(-4.32054, -4.85967, oneMinusAlphaSq);\r\n    return a / (1.0 + b * pow(x, c)) + d * x + e;\r\n}\r\n\r\nfloat lCharlie(float cosTheta, float alphaG)\r\n{\r\n    if (abs(cosTheta) < 0.5)\r\n\t{\r\n\t    return exp(lCharlieNumericHelper(cosTheta, alphaG));\r\n\t}\r\n    else\r\n\t{\r\n\t    return exp(2.0 * lCharlieNumericHelper(0.5, alphaG) - lCharlieNumericHelper(1.0 - cosTheta, alphaG));\r\n\t}\r\n}\r\n\r\nfloat V_Charlie(float NoL, float NoV, float roughness)\r\n{\r\n    float alphaG = roughness * roughness;\r\n    return clamp(1.0 / ((1.0 + lCharlie(NoV, alphaG) + lCharlie(NoL, alphaG)) * (4.0 * NoV * NoL)), 0.0, 1.0);\r\n}\r\n\r\n// Neubelt and Pettineo 2013, \"Crafting a Next-gen Material Pipeline for The Order: 1886\"\r\nfloat V_Neubelt(float NoV, float NoL)\r\n{\r\n    return saturateMediump(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\r\n}\r\n\r\nfloat V_SmithGGXCorrelated_Anisotropic(float at, float ab, float ToV, float BoV, float ToL, float BoL, float NoV, float NoL)\r\n{\r\n    float lambdaV = NoL * length(vec3(at * ToV, ab * BoV, NoV));\r\n    float lambdaL = NoV * length(vec3(at * ToL, ab * BoL, NoL));\r\n    float v = 0.5 / (lambdaV + lambdaL);\r\n    return saturateMediump(v);\r\n}\r\n\r\nvec3 F_Schlick(vec3 f0, float f90, float VoH)\r\n{\r\n    return f0 + (f90 - f0) * pow5(1.0 - VoH);\r\n}\r\n\r\nvec3 F_Schlick(vec3 f0, float VoH)\r\n{\r\n    return f0 + (1.0 - f0) * pow5(1.0 - VoH);\r\n}\r\n\r\nfloat F_Schlick(float f0, float f90, float VoH)\r\n{\r\n    return f0 + (f90 - f0) * pow5(1.0 - VoH);\r\n}\r\n\r\nfloat F_Schlick(float f0, float VoH)\r\n{\r\n    return f0 + (1.0 - f0) * pow5(1.0 - VoH);\r\n}\r\n\r\nvec3 F_Schlick(vec3 f0, vec3 f90, float VoH)\r\n{\r\n    return f0 + (f90 - f0) * pow5(1.0 - VoH);\r\n}\r\n\r\n    #ifdef IRIDESCENCE\r\n\r\n// CIE XYZ to REC.709\r\nconst mat3 XYZ_to_REC709_MAT = mat3(\r\n    vec3(3.2409699419, -0.9692436363, 0.0556300797),\r\n    vec3(-1.5373831776, 1.8759675015, -0.2039769589),\r\n    vec3(-0.498610760, 0.0415550574, 1.0569715142));\r\n\r\nfloat IorToFresnel0(float iorT, float iorI)\r\n{\r\n    return pow2((iorT - iorI) / (iorT + iorI));\r\n}\r\n\r\nvec3 IorToFresnel0(vec3 iorT, float iorI)\r\n{\r\n    return pow2((iorT - vec3(iorI)) / (iorT + vec3(iorI)));\r\n}\r\n\r\n// air to surfaceR0 ior\r\nvec3 Fresnel0ToIor(vec3 f0)\r\n{\r\n    vec3 sqrtF0 = sqrt(f0);\r\n    return (1.0 + sqrtF0) / (1.0 - sqrtF0);\r\n}\r\n\r\nvec3 evalSensitivity(float OPD, vec3 shift)\r\n{\r\n    float phase = 2.0 * PI * OPD * 1.0e-9;\r\n    vec3 val = vec3(5.4856e-13, 4.4201e-13, 5.2481e-13);\r\n    vec3 pos = vec3(1.6810e+06, 1.7953e+06, 2.2084e+06);\r\n    vec3 var = vec3(4.3278e+09, 9.3046e+09, 6.6121e+09);\r\n    vec3 xyz = val * sqrt(2.0 * PI * var) * cos(pos * phase + shift) * exp(-pow2(phase) * var);\r\n    xyz.x += 9.7470e-14 * sqrt(2.0 * PI * 4.5282e+09) * cos(2.2399e+06 * phase + shift[0]) * exp(-4.5282e+09 * pow2(phase));\r\n    xyz /= 1.0685e-7;\r\n    vec3 srgb = XYZ_to_REC709_MAT * xyz;\r\n    return srgb;\r\n}\r\n\r\n// https://belcour.github.io/blog/research/publication/2017/05/01/brdf-thin-film.html\r\nvec3 evalIridescence(float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0)\r\n{\r\n    vec3 I;\r\n    float iridescenceIor = mix(outsideIOR, eta2, smoothstep(0.0, 0.03, thinFilmThickness));\r\n\r\n    float sinTheta2Sq = pow2(outsideIOR / iridescenceIor) * (1.0 - pow2(cosTheta1));\r\n\r\n    float cosTheta2Sq = 1.0 - sinTheta2Sq;\r\n    if (cosTheta2Sq < 0.0)\r\n\t{\r\n\t    return vec3(1.0);\r\n\t}\r\n    float cosTheta2 = sqrt(cosTheta2Sq);\r\n\r\n    float R0 = IorToFresnel0(iridescenceIor, outsideIOR);\r\n    float R12 = F_Schlick(R0, cosTheta1);\r\n    float R21 = R12;\r\n    float T121 = 1.0 - R12;\r\n    float phi12 = 0.0;\r\n    if (iridescenceIor < outsideIOR)\r\n\tphi12 = PI;\r\n    float phi21 = PI - phi12;\r\n\r\n    vec3 baseIOR = Fresnel0ToIor(clamp(baseF0, 0.0, 0.9999));\r\n\r\n    vec3 R1 = IorToFresnel0(baseIOR, iridescenceIor);\r\n    vec3 R23 = F_Schlick(R1, cosTheta2);\r\n    vec3 phi23 = vec3(0.0);\r\n\r\n    if (baseIOR[0] < iridescenceIor)\r\n\tphi23[0] = PI;\r\n    if (baseIOR[1] < iridescenceIor)\r\n\tphi23[1] = PI;\r\n    if (baseIOR[2] < iridescenceIor)\r\n\tphi23[2] = PI;\r\n\r\n    float OPD = 2.0 * iridescenceIor * thinFilmThickness * cosTheta2;\r\n    vec3 phi = vec3(phi21) + phi23;\r\n\r\n    vec3 R123 = clamp(R12 * R23, 1e-5, 0.9999);\r\n    vec3 r123 = sqrt(R123);\r\n    vec3 Rs = pow2(T121) * R23 / (vec3(1.0) - R123);\r\n\r\n    vec3 C0 = R12 + Rs;\r\n    I = C0;\r\n\r\n    vec3 Cm = Rs - T121;\r\n    for (int m = 1; m <= 2; ++m)\r\n\t{\r\n\t    Cm *= r123;\r\n\t    vec3 Sm = 2.0 * evalSensitivity(float(m) * OPD, float(m) * phi);\r\n\t    I += Cm * Sm;\r\n\t}\r\n\r\n    return max(I, vec3(0.0));\r\n}\r\n    #endif // IRIDESCENCE\r\n\r\n// Specular dispatch\r\n\r\n// D\r\nfloat distribution(float roughness, float NoH, vec3 h, vec3 n)\r\n{\r\n    return D_GGX(roughness, NoH, h, n);\r\n}\r\n\r\n// V\r\nfloat visibility(float roughness, float NoV, float NoL)\r\n{\r\n    return V_SmithGGXCorrelated(roughness, NoV, NoL);\r\n}\r\n\r\n// F\r\nvec3 fresnel(vec3 f0, float LoH)\r\n{\r\n    float f90 = saturate(dot(f0, vec3(50.0 * 0.33)));\r\n    return F_Schlick(f0, f90, LoH);\r\n\r\n    // return F_Schlick(f0, LoH);\r\n}\r\n\r\nvec3 fresnel(vec3 f0, vec3 f90, float LoH)\r\n{\r\n    return F_Schlick(f0, f90, LoH);\r\n}\r\n\r\n// diffuse BRDF implementations\r\n\r\nfloat Fd_Lambert()\r\n{\r\n    // https://seblagarde.wordpress.com/2012/01/08/pi-or-not-to-pi-in-game-lighting-equation/\r\n    // return INVERT_PI;\r\n    return 1.0;\r\n}\r\n\r\nfloat Fd_Burley(float roughness, float NoV, float NoL, float LoH)\r\n{\r\n    float f90 = 0.5 + 2.0 * roughness * LoH * LoH;\r\n    float lightScatter = F_Schlick(1.0, f90, NoL);\r\n    float veiwScatter = F_Schlick(1.0, f90, NoV);\r\n    return lightScatter * veiwScatter * INVERT_PI;\r\n}\r\n\r\n    #ifdef IRIDESCENCE\r\nvec3 Fd_IridescenceLambert(vec3 f0, vec3 f90, vec3 iridescenceFresnel, float iridescenceFactor, float VoH)\r\n{\r\n    vec3 iridescenceFresnelMax = vec3(vecmax(iridescenceFresnel));\r\n    vec3 schlickFresnel = F_Schlick(f0, f90, VoH);\r\n\r\n    vec3 F = mix(schlickFresnel, iridescenceFresnelMax, iridescenceFactor);\r\n\r\n    return (1.0 - F) * Fd_Lambert();\r\n}\r\n    #endif // IRIDESCENCE\r\n\r\n#endif // BRDF","#if !defined(pbrGI_lib)\r\n    #define pbrGI_lib\r\n\r\n    #include \"globalIllumination.glsl\";\r\n\r\n    #ifdef ANISOTROPIC\r\nvec3 anisotropyBentNormal(const in Surface surface, const in PixelInfo info)\r\n{\r\n    float anisotropy = surface.anisotropy;\r\n    vec3 anisotropyDirection = info.anisotropicB;\r\n\r\n    vec3 n = info.normalWS;\r\n    vec3 v = info.viewDir;\r\n\r\n    // float tangentRoughness = mix(roughness, 1.0, anisotropy * anisotropy);\r\n    float roughness = surface.perceptualRoughness;\r\n    vec3 anisotropicTangent = cross(anisotropyDirection, v);\r\n    vec3 anisotropicNormal = cross(anisotropicTangent, anisotropyDirection);\r\n    float bendFactor = 1.0 - anisotropy * (1.0 - roughness);\r\n    float bendFactorPow4 = pow2(bendFactor) * pow2(bendFactor);\r\n    vec3 bentNormal = normalize(mix(anisotropicNormal, n, bendFactorPow4));\r\n\r\n    return bentNormal;\r\n}\r\n    #endif // ANISOTROPIC\r\n\r\n// \r\nvec3 getReflectedVector(const in vec3 n, const in vec3 v, const in vec3 positionWS)\r\n{\r\n    vec3 r;\r\n    r = reflect(-v, n);\r\n\r\n    #ifdef SPECCUBE_BOX_PROJECTION\r\n    r = getBoxProjectionReflectedVector(r, positionWS);\r\n    #endif // SPECCUBE_BOX_PROJECTION\r\n\r\n    return r;\r\n}\r\n\r\n    #ifdef IRIDESCENCE\r\nvoid iridescenceIBL(const in Surface surface, const in PixelInfo info, in vec3 E, inout vec3 Fd, inout vec3 Fr)\r\n{\r\n    vec3 dfg = info.dfg;\r\n    float NoV = info.NoV;\r\n    vec3 n = info.normalWS;\r\n    vec3 v = info.viewDir;\r\n    vec3 positionWS = info.positionWS;\r\n    vec3 iridescenceFresnel = info.iridescenceFresnel;\r\n\r\n    vec3 diffuseColor = surface.diffuseColor;\r\n    float roughness = surface.perceptualRoughness;\r\n    float occlusion = surface.occlusion;\r\n    float iridescenceFactor = surface.iridescence;\r\n\r\n    // diffuse\r\n    vec3 irradiance = diffuseIrradiance(n, positionWS, info.viewDir);\r\n    Fd += diffuseColor * irradiance * (1.0 - E) * occlusion;\r\n\r\n    // specular\r\n    vec3 iridescenceF0 = mix(surface.f0, iridescenceFresnel, vec3(iridescenceFactor));\r\n    vec3 Er = mix(dfg.xxx, dfg.yyy, iridescenceF0);\r\n\r\n\t#ifdef ANISOTROPIC\r\n    vec3 bentNormal = anisotropyBentNormal(surface, info);\r\n    vec3 r = getReflectedVector(bentNormal, v, positionWS);\r\n\t#else // ANISOTROPIC\r\n    vec3 r = getReflectedVector(n, v, positionWS);\r\n\t#endif // ANISOTROPIC\r\n\r\n    vec3 indirectSpecular = specularRadiance(r, roughness);\r\n    Fr += Er * indirectSpecular * occlusion * (1.0 + Er * (1.0 / dfg.y - 1.0));\r\n}\r\n    #endif // IRIDESCENCE\r\n\r\n    #ifdef SHEEN\r\nvoid sheenIBL(const in Surface surface, const in PixelInfo info, inout vec3 Fd, inout vec3 Fr)\r\n{\r\n    vec3 v = info.viewDir;\r\n    vec3 n = info.normalWS;\r\n    vec3 positionWS = info.positionWS;\r\n\r\n    float occlusion = surface.occlusion;\r\n    float roughness = surface.sheenPerceptualRoughness;\r\n\r\n    Fd *= info.sheenScaling;\r\n    Fr *= info.sheenScaling;\r\n\r\n    vec3 r = getReflectedVector(n, v, positionWS);\r\n    vec3 indirectSpecular = specularRadiance(r, roughness);\r\n\r\n    Fr += indirectSpecular * info.sheenDfg * surface.sheenColor * occlusion;\r\n}\r\n    #endif // SHEEN\r\n\r\n    #ifdef CLEARCOAT\r\nvoid clearCoatIBL(const in Surface surface, const in PixelInfo info, inout vec3 Fd, inout vec3 Fr)\r\n{\r\n    vec3 v = info.viewDir;\r\n    vec3 n = info.clearCoatNormal;\r\n    float NoV = info.clearCoatNoV;\r\n    vec3 positionWS = info.positionWS;\r\n\r\n    float clearCoat = surface.clearCoat;\r\n    float roughness = surface.clearCoatPerceptualRoughness;\r\n    float occlusion = surface.occlusion;\r\n\r\n    float Fc = F_Schlick(0.04, 1.0, NoV) * clearCoat;\r\n    float attenuation = 1.0 - Fc;\r\n    Fd *= attenuation;\r\n    Fr *= attenuation;\r\n\r\n    vec3 r = getReflectedVector(n, v, positionWS);\r\n    vec3 indirectSpecular = specularRadiance(r, roughness);\r\n\r\n    Fr += indirectSpecular * Fc * occlusion;\r\n}\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef TRANSMISSION\r\nvec3 getRefraction(const in Surface surface, const in PixelInfo info)\r\n{\r\n    vec3 position = info.positionWS;\r\n\r\n\t#ifdef THICKNESS\r\n\r\n    vec3 n = info.normalWS;\r\n    vec3 r = -info.viewDir;\r\n    float airIOR = 1.0;\r\n    float etaIR = airIOR / surface.ior;\r\n\r\n    vec3 refractionV = normalize(refract(r, n, etaIR)) * surface.thickness * info.worldScale.xyz;\r\n\r\n    position += refractionV;\r\n\r\n\t#endif // THICKNESS\r\n\r\n    vec4 p = u_ViewProjection * vec4(position, 1.0);\r\n    vec2 refractionUV = (p.xy / p.w) * 0.5 + 0.5;\r\n\r\n    float refractionLOD = u_OpaqueTextureParams.z * surface.perceptualRoughness * saturate(surface.ior * 2.0 - 2.0);\r\n    vec3 refraction = texture2DLodEXT(u_CameraOpaqueTexture, refractionUV, refractionLOD).xyz;\r\n\r\n    return refraction;\r\n}\r\n\r\nvec3 transmissionIBL(const in Surface surface, const in PixelInfo info, in vec3 E)\r\n{\r\n    // refraction\r\n    vec3 refraction = getRefraction(surface, info);\r\n\r\n\t#ifndef THICKNESS\r\n    E *= 1.0 + surface.transmission * (1.0 - E.g) / (1.0 + E.g);\r\n\t#endif // THICKNESS\r\n\r\n\t#ifdef THICKNESS\r\n\r\n    // ABSORPTION\r\n    vec3 attenuationColor = surface.attenuationColor;\r\n    float attenuationDistance = surface.attenuationDistance;\r\n    vec3 absorption = -log(attenuationColor) / (attenuationDistance);\r\n    vec3 T = exp(-absorption * info.worldScale.xyz * surface.thickness);\r\n\r\n\t#endif // THICKNESS\r\n\r\n    vec3 Ft = refraction;\r\n\r\n    Ft *= surface.diffuseColor;\r\n\r\n    Ft *= 1.0 - E;\r\n\r\n\t#ifdef THICKNESS\r\n    Ft *= T;\r\n\t#endif // THICKNESS\r\n\r\n    return Ft * surface.transmission;\r\n}\r\n\r\n    #endif // TRANSMISSION\r\n\r\nvoid baseIBL(const in Surface surface, const in PixelInfo info, in vec3 E, inout vec3 Fd, inout vec3 Fr)\r\n{\r\n    vec3 dfg = info.dfg;\r\n    float NoV = info.NoV;\r\n    vec3 n = info.normalWS;\r\n    vec3 v = info.viewDir;\r\n    vec3 positionWS = info.positionWS;\r\n\r\n    vec3 diffuseColor = surface.diffuseColor;\r\n    float roughness = surface.perceptualRoughness;\r\n    float occlusion = surface.occlusion;\r\n\r\n    #ifdef ANISOTROPIC\r\n    vec3 bentNormal = anisotropyBentNormal(surface, info);\r\n    vec3 r = getReflectedVector(bentNormal, v, positionWS);\r\n    #else // ANISOTROPIC\r\n    vec3 r = getReflectedVector(n, v, positionWS);\r\n    #endif // ANISOTROPIC\r\n\r\n    vec3 indirectSpecular = specularRadiance(r, roughness);\r\n\r\n    // todo\r\n    float specularAO = occlusion;\r\n    Fr += E * indirectSpecular * specularAO * info.energyCompensation;\r\n\r\n    #if defined(USELIGHTMAP)\r\n\r\n    vec2 lightmapUV = info.lightmapUV;\r\n    vec3 bakedlight = getBakedLightmapColor(lightmapUV, n);\r\n    Fd += bakedlight * diffuseColor;\r\n\r\n    #else // USELIGHTMAP\r\n\r\n    vec3 irradiance = diffuseIrradiance(n, positionWS, info.viewDir);\r\n    Fd += diffuseColor * irradiance * (1.0 - E) * occlusion;\r\n\r\n    #endif // USELIGHTMAP\r\n}\r\n\r\nvec3 getE(const in Surface surface, const in PixelInfo info)\r\n{\r\n    #ifdef IRIDESCENCE\r\n\r\n    vec3 dfg = info.dfg;\r\n    float NoV = info.NoV;\r\n    vec3 iridescenceFresnel = info.iridescenceFresnel;\r\n    vec3 f0 = surface.f0;\r\n    float iridescenceFactor = surface.iridescence;\r\n    vec3 iridescenceFresnelMax = vec3(vecmax(iridescenceFresnel));\r\n    vec3 schlickFresnel = F_Schlick(f0, vec3(1.0), NoV);\r\n    vec3 F = mix(schlickFresnel, iridescenceFresnelMax, iridescenceFactor);\r\n    vec3 E = mix(dfg.xxx, dfg.yyy, F);\r\n\r\n    #else // IRIDESCENCE\r\n\r\n    vec3 dfg = info.dfg;\r\n    vec3 f0 = surface.f0;\r\n    vec3 f90 = surface.f90;\r\n    // vec3 E = mix(dfg.xxx, dfg.yyy, f0);\r\n    vec3 E = (f90 - f0) * dfg.x + f0 * dfg.y;\r\n\r\n    #endif // IRIDESCENCE\r\n    return E;\r\n}\r\n\r\nvec3 PBRGI(const in Surface surface, const in PixelInfo info)\r\n{\r\n    vec3 Fd = vec3(0.0);\r\n    vec3 Fr = vec3(0.0);\r\n\r\n    vec3 E = getE(surface, info);\r\n\r\n    #ifdef IRIDESCENCE\r\n    iridescenceIBL(surface, info, E, Fd, Fr);\r\n    #else // IRIDESCENCE\r\n    baseIBL(surface, info, E, Fd, Fr);\r\n    #endif // IRIDESCENCE\r\n\r\n    // sheen\r\n    #ifdef SHEEN\r\n    sheenIBL(surface, info, Fd, Fr);\r\n    #endif // SHEEN\r\n\r\n    // clear coat\r\n    #ifdef CLEARCOAT\r\n    clearCoatIBL(surface, info, Fd, Fr);\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef TRANSMISSION\r\n    Fd *= (1.0 - surface.transmission);\r\n    vec3 Ft = transmissionIBL(surface, info, E);\r\n    #endif // TRANSMISSION\r\n\r\n    vec3 gi = Fd + Fr;\r\n\r\n    #ifdef TRANSMISSION\r\n    gi += Ft;\r\n    #endif // TRANSMISSION\r\n\r\n    return gi;\r\n}\r\n\r\n#endif // pbrGI_lib","#if !defined(pbrCommon_lib)\r\n    #define pbrCommon_lib\r\n\r\n// varying\r\nvarying vec3 v_PositionWS;\r\n\r\n// todo\r\nvarying vec3 v_NormalWS;\r\nvarying vec3 v_TangentWS;\r\nvarying vec3 v_BiNormalWS;\r\n\r\n    #ifdef UV\r\nvarying vec2 v_Texcoord0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\nvarying vec2 v_Texcoord1;\r\n\t#endif // LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\nvarying vec4 v_VertexColor;\r\n    #endif // COLOR\r\n\r\n// , vsfs\r\nstruct PixelParams {\r\n\r\n    vec3 positionWS;\r\n\r\n    vec3 normalWS;\r\n    vec3 tangentWS;\r\n    vec3 biNormalWS;\r\n    mat3 TBN;\r\n\r\n    #ifdef UV\r\n    vec2 uv0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\n    vec2 uv1;\r\n\t#endif // LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    vec4 vertexColor;\r\n    #endif // COLOR\r\n};\r\n\r\n#endif // pbrCommon_lib","#if !defined(pbrVertex_lib)\r\n    #define pbrVertex_lib\r\n\r\n    #include \"ShadingVertex.glsl\";\r\n\r\n    #ifdef THICKNESS\r\n// xyz: world scale, w: length(xyz)\r\nvarying vec4 v_WorldScale;\r\n    #endif // THICKNESS\r\n\r\nvoid initPixelParams(inout PixelParams params, in Vertex vertex)\r\n{\r\n    shadingPixelParams(params, vertex);\r\n    sharePixelParams(params);\r\n\r\n    #ifdef THICKNESS\r\n    mat4 worldMat = getWorldMatrix();\r\n    v_WorldScale.x = length(vec3(worldMat[0].xyz));\r\n    v_WorldScale.y = length(vec3(worldMat[1].xyz));\r\n    v_WorldScale.z = length(vec3(worldMat[2].xyz));\r\n    v_WorldScale.w = length(v_WorldScale.xyz);\r\n    #endif // THICKNESS\r\n}\r\n\r\n#endif // pbrVertex_lib","#if !defined(pbrFrag_lib)\r\n    #define pbrFrag_lib\r\n\r\n    #include \"PBRLighting.glsl\";\r\n\r\n    #ifdef THICKNESS\r\n// xyz: world scale, w: length(xyz)\r\nvarying vec4 v_WorldScale;\r\n    #endif // THICKNESS\r\n\r\nvoid getPixelInfo(inout PixelInfo info, const in PixelParams pixel, const in Surface surface)\r\n{\r\n    info.positionWS = pixel.positionWS;\r\n    info.vertexNormalWS = pixel.normalWS;\r\n\r\n    #ifdef TANGENT\r\n    info.normalWS = normalize(pixel.TBN * surface.normalTS);\r\n    #else // TANGENT\r\n    info.normalWS = pixel.normalWS;\r\n    #endif // TANGENT\r\n\r\n    info.tangentWS = pixel.tangentWS;\r\n    info.biNormalWS = pixel.biNormalWS;\r\n\r\n    info.viewDir = normalize(u_CameraPos - info.positionWS);\r\n    info.NoV = min(max(dot(info.normalWS, info.viewDir), MIN_N_DOT_V), 1.0);\r\n\r\n    info.dfg = prefilteredDFG_LUT(surface.perceptualRoughness, info.NoV);\r\n\r\n    #ifdef SHEEN\r\n    info.energyCompensation = vec3(1.0);\r\n    #else // SHEEN\r\n    info.energyCompensation = (1.0 + surface.f0 * (1.0 / info.dfg.y - 1.0));\r\n    #endif // SHEEN\r\n\r\n    #ifdef IRIDESCENCE\r\n    info.iridescenceFresnel = evalIridescence(1.0, surface.iridescenceIor, info.NoV, surface.iridescenceThickness, surface.f0);\r\n    #endif // IRIDESCENCE\r\n\r\n    #ifdef SHEEN\r\n    info.sheenDfg = prefilteredDFG_LUT(surface.sheenPerceptualRoughness, info.NoV).z;\r\n    info.sheenScaling = 1.0 - vecmax(surface.sheenColor) * info.sheenDfg;\r\n    #endif // SHEEN\r\n\r\n    #ifdef CLEARCOAT\r\n\t#ifdef CLEARCOAT_NORMAL\r\n    info.clearCoatNormal = normalize(pixel.TBN * surface.clearCoatNormalTS);\r\n\t#else // CLEARCOAT_NORMAL\r\n    info.clearCoatNormal = info.vertexNormalWS;\r\n\t#endif // CLEARCOAT_NORMAL\r\n    info.clearCoatNoV = min(max(dot(info.clearCoatNormal, info.viewDir), MIN_N_DOT_V), 1.0);\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef ANISOTROPIC\r\n    mat3 anisotropyTBN = mat3(info.tangentWS, info.biNormalWS * -1.0, info.normalWS);\r\n    info.anisotropicT = anisotropyTBN * normalize(vec3(surface.anisotropyDirection, 0.0));\r\n    info.anisotropicB = cross(info.vertexNormalWS, info.anisotropicT);\r\n    info.ToV = dot(info.anisotropicT, info.viewDir);\r\n    info.BoV = dot(info.anisotropicB, info.viewDir);\r\n    info.at = mix(surface.roughness, 1.0, pow2(surface.anisotropy));\r\n    info.ab = surface.roughness;\r\n    #endif // ANISOTROPIC\r\n\r\n    #ifdef THICKNESS\r\n    info.worldScale = v_WorldScale;\r\n    #endif // THICKNESS\r\n\r\n    #ifdef LIGHTMAP\r\n\t#ifdef UV1\r\n    info.lightmapUV = pixel.uv1;\r\n\t#endif // UV1\r\n    #endif // LIGHTMAP\r\n}\r\n\r\nvec3 PBRLighting(const in Surface surface, const in PixelInfo info)\r\n{\r\n    vec3 lightColor = vec3(0.0);\r\n    #ifdef DIRECTIONLIGHT\r\n    for (int i = 0; i < CalculateLightCount; i++)\r\n\t{\r\n\t    if (i >= DirectionCount)\r\n\t\tbreak;\r\n\t    DirectionLight directionLight = getDirectionLight(i, info.positionWS);\r\n\t    if (directionLight.lightMode == LightMode_Mix)\r\n\t\t{\r\n\t\t    continue;\r\n\t\t}\r\n\t    Light light = getLight(directionLight);\r\n\t    lightColor += PBRLighting(surface, info, light) * light.attenuation;\r\n\t}\r\n    #endif // DIRECTIONLIGHT\r\n\r\n    #if defined(POINTLIGHT) || defined(SPOTLIGHT)\r\n    ivec4 clusterInfo = getClusterInfo(u_View, u_Viewport, info.positionWS, gl_FragCoord, u_ProjectionParams);\r\n    #endif // POINTLIGHT || SPOTLIGHT\r\n\r\n    #ifdef POINTLIGHT\r\n    for (int i = 0; i < CalculateLightCount; i++)\r\n\t{\r\n\t    if (i >= clusterInfo.x)\r\n\t\tbreak;\r\n\t    PointLight pointLight = getPointLight(i, clusterInfo, info.positionWS);\r\n\t    if (pointLight.lightMode == LightMode_Mix)\r\n\t\t{\r\n\t\t    continue;\r\n\t\t}\r\n\t    Light light = getLight(pointLight, info.normalWS, info.positionWS);\r\n\t    lightColor += PBRLighting(surface, info, light) * light.attenuation;\r\n\t}\r\n    #endif // POINTLIGHT\r\n\r\n    #ifdef SPOTLIGHT\r\n    for (int i = 0; i < CalculateLightCount; i++)\r\n\t{\r\n\t    if (i >= clusterInfo.y)\r\n\t\tbreak;\r\n\t    SpotLight spotLight = getSpotLight(i, clusterInfo, info.positionWS);\r\n\t    if (spotLight.lightMode == LightMode_Mix)\r\n\t\t{\r\n\t\t    continue;\r\n\t\t}\r\n\t    Light light = getLight(spotLight, info.normalWS, info.positionWS);\r\n\t    lightColor += PBRLighting(surface, info, light) * light.attenuation;\r\n\t}\r\n    #endif // SPOTLIGHT\r\n\r\n    vec3 giColor = PBRGI(surface, info);\r\n\r\n    vec3 color = lightColor + giColor;\r\n\r\n    #ifdef EMISSION\r\n    color += surface.emissionColor;\r\n    #endif //  EMISSION\r\n    return color;\r\n}\r\n\r\n#endif // pbrFrag_lib","#if !defined(PBRMetallic_lib)\r\n    #define PBRMetallic_lib\r\n\r\n    #include \"ShadingFrag.glsl\";\r\n\r\n    #include \"PBRFrag.glsl\";\r\n\r\nstruct SurfaceInputs {\r\n    vec3 diffuseColor;\r\n    float alpha;\r\n    float alphaTest;\r\n    float metallic;\r\n    float smoothness;\r\n    float occlusion;\r\n    vec3 emissionColor;\r\n    vec3 normalTS;\r\n\r\n    #ifdef CLEARCOAT\r\n    float clearCoat;\r\n    float clearCoatRoughness;\r\n\t#ifdef CLEARCOAT_NORMAL\r\n    vec3 clearCoatNormalTS;\r\n\t#endif // CLEARCOAT_NORMAL\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef ANISOTROPIC\r\n    float anisotropy;\r\n    vec2 anisotropyDirection;\r\n    #endif // ANISOTROPIC\r\n};\r\n\r\nvoid initSurface(inout Surface surface, const in SurfaceInputs inputs, const in PixelParams pixel)\r\n{\r\n    surface.alpha = inputs.alpha;\r\n\r\n    surface.normalTS = inputs.normalTS;\r\n\r\n    vec3 baseColor = inputs.diffuseColor;\r\n    float metallic = inputs.metallic;\r\n    float perceptualRoughness = 1.0 - inputs.smoothness;\r\n\r\n    // default ior 1.5\r\n    float ior = 1.5;\r\n    surface.ior = 1.5;\r\n    vec3 f0 = vec3(0.04, 0.04, 0.04);\r\n\r\n    surface.perceptualRoughness = clamp(perceptualRoughness, MIN_PERCEPTUAL_ROUGHNESS, 1.0);\r\n    surface.roughness = surface.perceptualRoughness * surface.perceptualRoughness;\r\n    surface.diffuseColor = computeDiffuse(baseColor, metallic);\r\n    surface.f0 = computeF0(f0, baseColor, metallic);\r\n    surface.f90 = computeF90(surface.f0);\r\n\r\n    surface.occlusion = inputs.occlusion;\r\n\r\n    #ifdef EMISSION\r\n    surface.emissionColor = inputs.emissionColor;\r\n    #endif // EMISSION\r\n\r\n    #ifdef CLEARCOAT\r\n    surface.clearCoat = inputs.clearCoat;\r\n    surface.clearCoatPerceptualRoughness = clamp(inputs.clearCoatRoughness, MIN_PERCEPTUAL_ROUGHNESS, 1.0);\r\n    surface.clearCoatRoughness = surface.clearCoatPerceptualRoughness * surface.clearCoatPerceptualRoughness;\r\n\t#ifdef CLEARCOAT_NORMAL\r\n    surface.clearCoatNormalTS = inputs.clearCoatNormalTS;\r\n\t#endif // CLEARCOAT_NORMAL\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef ANISOTROPIC\r\n    surface.anisotropy = inputs.anisotropy;\r\n    surface.anisotropyDirection = inputs.anisotropyDirection;\r\n    #endif // ANISOTROPIC\r\n}\r\n\r\nvec4 PBR_Metallic_Flow(const in SurfaceInputs inputs, in PixelParams pixel)\r\n{\r\n    #ifdef ALPHATEST\r\n    if (inputs.alpha < inputs.alphaTest)\r\n\t{\r\n\t    discard;\r\n\t}\r\n    #endif // ALPHATEST\r\n\r\n    Surface surface;\r\n    initSurface(surface, inputs, pixel);\r\n\r\n    PixelInfo info;\r\n    getPixelInfo(info, pixel, surface);\r\n\r\n    vec3 surfaceColor = vec3(0.0);\r\n    surfaceColor += PBRLighting(surface, info);\r\n\r\n    return vec4(surfaceColor, surface.alpha);\r\n}\r\n\r\n#endif // PBRMetallic_lib\r\n","import { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { PBRRenderQuality } from \"./PBRRenderQuality\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Texture2D } from \"../../../resource/Texture2D\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { PBRShaderLib } from \"../../shader/pbr/PBRShaderLib\";\r\n\r\n/**\r\n * \r\n */\r\nexport enum PBRRenderMode {\r\n    /***/\r\n    Opaque,\r\n    /***/\r\n    Cutout,\r\n    /**_*/\r\n    Fade,\r\n    /**_*/\r\n    Transparent\r\n}\r\n\r\n/**\r\n * PBR,\r\n */\r\nexport class PBRMaterial extends Material {\r\n    /** @internal */\r\n    static SHADERDEFINE_ALBEDOTEXTURE: ShaderDefine;\r\n    /** @internal */\r\n    static SHADERDEFINE_NORMALTEXTURE: ShaderDefine;\r\n    /** @internal */\r\n    static SHADERDEFINE_OCCLUSIONTEXTURE: ShaderDefine;\r\n    /** @internal */\r\n    static SHADERDEFINE_PARALLAXTEXTURE: ShaderDefine;\r\n    /** @internal */\r\n    static SHADERDEFINE_EMISSIONTEXTURE: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_DETAILALBEDO: ShaderDefine;\r\n    /**@internal */\r\n    static SHADERDEFINE_DETAILNORMAL: ShaderDefine;\r\n\r\n    /** @internal */\r\n    static SHADERDEFINE_ENABLEVERTEXCOLOR: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_ANISOTROPYTEXTURE: ShaderDefine;\r\n\r\n    /** @internal */\r\n    static SHADERDEFINE_TRANSPARENTBLEND: ShaderDefine;\r\n    /**@internal */\r\n    static SHADERDEFINE_LAYA_PBR_BRDF_HIGH: ShaderDefine;\r\n    /**@internal */\r\n    static SHADERDEFINE_LAYA_PBR_BRDF_LOW: ShaderDefine;\r\n\r\n    /** @internal */\r\n    static ALBEDOTEXTURE: number;\r\n    /** @internal */\r\n    static ALBEDOCOLOR: number;\r\n    /** @internal */\r\n    static TILINGOFFSET: number;\r\n    /** @internal */\r\n    static NORMALTEXTURE: number;\r\n    /** @internal */\r\n    static NORMALSCALE: number;\r\n    /** @internal */\r\n    static SMOOTHNESS: number;\r\n    /** @internal */\r\n    static SMOOTHNESSSCALE: number;\r\n    /** @internal */\r\n    static OCCLUSIONTEXTURE: number;\r\n    /** @internal */\r\n    static OCCLUSIONSTRENGTH: number;\r\n    /** @internal */\r\n    static PARALLAXTEXTURE: number;\r\n    /** @internal */\r\n    static PARALLAXSCALE: number;\r\n    /** @internal */\r\n    static EMISSIONTEXTURE: number;\r\n    /** @internal */\r\n    static EMISSIONCOLOR: number;\r\n    /**@internal */\r\n    static EMISSIONIntensity: number\r\n\r\n    //Detail\r\n    /** @internal */\r\n    static DETAILALBEDOTEXTURE: number;\r\n    /**@internal */\r\n    static DETAILNORMALTEXTURE: number;\r\n    /**@internal */\r\n    static DETAILTILLINGOFFSET: number;\r\n    /**@internal */\r\n    static DETAILNORMALSCALE: number;\r\n\r\n    // clear coat\r\n    /**@internal */\r\n    static CLEARCOAT: number;\r\n    /**@internal */\r\n    static SHADERDEFINE_CLEARCOATTEXTURE: ShaderDefine;\r\n    /**@internal */\r\n    static CLEARCOATTEXTURE: number;\r\n    /**@internal */\r\n    static CLEARCOATROUGHNESS: number;\r\n    /**@internal */\r\n    static SHADERDEFINE_CLEARCOATROUGHNESSTEXTURE: ShaderDefine;\r\n    /**@internal */\r\n    static CLEARCOATROUGHNESSTEXTURE: number;\r\n    /** @internal */\r\n    static CLEARCOATNORMALTEXTURE: number;\r\n\r\n    // anisotropy\r\n    /** @internal */\r\n    static ANISOTROPY: number;\r\n    /** @internal */\r\n    static ANISOTROPYTEXTURE: number;\r\n    /** @internal */\r\n    static ANISOTROPYROTATION: number;\r\n\r\n    /** */\r\n    static renderQuality: PBRRenderQuality = PBRRenderQuality.High;\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    static __init__(): void {\r\n        PBRMaterial.SHADERDEFINE_ALBEDOTEXTURE = Shader3D.getDefineByName(\"ALBEDOTEXTURE\");\r\n        PBRMaterial.SHADERDEFINE_NORMALTEXTURE = Shader3D.getDefineByName(\"NORMALTEXTURE\");\r\n        PBRMaterial.SHADERDEFINE_PARALLAXTEXTURE = Shader3D.getDefineByName(\"PARALLAXTEXTURE\");\r\n        PBRMaterial.SHADERDEFINE_OCCLUSIONTEXTURE = Shader3D.getDefineByName(\"OCCLUSIONTEXTURE\");\r\n        PBRMaterial.SHADERDEFINE_EMISSIONTEXTURE = Shader3D.getDefineByName(\"EMISSIONTEXTURE\");\r\n        PBRMaterial.SHADERDEFINE_TRANSPARENTBLEND = Shader3D.getDefineByName(\"TRANSPARENTBLEND\");\r\n        PBRMaterial.SHADERDEFINE_LAYA_PBR_BRDF_HIGH = Shader3D.getDefineByName(\"LAYA_PBR_BRDF_HIGH\");\r\n        PBRMaterial.SHADERDEFINE_LAYA_PBR_BRDF_LOW = Shader3D.getDefineByName(\"LAYA_PBR_BRDF_LOW\");\r\n        //Detail\r\n        PBRMaterial.SHADERDEFINE_DETAILALBEDO = Shader3D.getDefineByName(\"DETAILTEXTURE\");\r\n        PBRMaterial.SHADERDEFINE_DETAILNORMAL = Shader3D.getDefineByName(\"DETAILNORMAL\");\r\n\r\n        PBRMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR = Shader3D.getDefineByName(\"ENABLEVERTEXCOLOR\");\r\n\r\n\r\n\r\n        PBRMaterial.ALBEDOTEXTURE = Shader3D.propertyNameToID(\"u_AlbedoTexture\");\r\n        PBRMaterial.ALBEDOCOLOR = Shader3D.propertyNameToID(\"u_AlbedoColor\");\r\n        PBRMaterial.TILINGOFFSET = Shader3D.propertyNameToID(\"u_TilingOffset\");\r\n        PBRMaterial.NORMALTEXTURE = Shader3D.propertyNameToID(\"u_NormalTexture\");\r\n        PBRMaterial.NORMALSCALE = Shader3D.propertyNameToID(\"u_NormalScale\");\r\n        PBRMaterial.SMOOTHNESS = Shader3D.propertyNameToID(\"u_Smoothness\");\r\n        PBRMaterial.OCCLUSIONTEXTURE = Shader3D.propertyNameToID(\"u_OcclusionTexture\");\r\n        PBRMaterial.OCCLUSIONSTRENGTH = Shader3D.propertyNameToID(\"u_OcclusionStrength\");\r\n        PBRMaterial.PARALLAXTEXTURE = Shader3D.propertyNameToID(\"u_ParallaxTexture\");\r\n        PBRMaterial.PARALLAXSCALE = Shader3D.propertyNameToID(\"u_ParallaxScale\");\r\n        PBRMaterial.EMISSIONTEXTURE = Shader3D.propertyNameToID(\"u_EmissionTexture\");\r\n        PBRMaterial.EMISSIONCOLOR = Shader3D.propertyNameToID(\"u_EmissionColor\");\r\n        PBRMaterial.EMISSIONIntensity = Shader3D.propertyNameToID(\"u_EmissionIntensity\");\r\n\r\n        //Detail\r\n        PBRMaterial.DETAILALBEDOTEXTURE = Shader3D.propertyNameToID(\"u_DetailAlbedoTexture\");\r\n        PBRMaterial.DETAILNORMALTEXTURE = Shader3D.propertyNameToID(\"u_DetailNormalTexture\");\r\n        PBRMaterial.DETAILTILLINGOFFSET = Shader3D.propertyNameToID(\"u_DetailTillingOffset\");\r\n        PBRMaterial.DETAILNORMALSCALE = Shader3D.propertyNameToID(\"u_DetailNormalScale\");\r\n\r\n        // clear coat\r\n        PBRMaterial.CLEARCOAT = Shader3D.propertyNameToID(\"u_ClearCoatFactor\");\r\n        PBRMaterial.SHADERDEFINE_CLEARCOATTEXTURE = Shader3D.getDefineByName(\"CLEARCOATMAP\");\r\n        PBRMaterial.CLEARCOATTEXTURE = Shader3D.propertyNameToID(\"u_ClearCoatTexture\");\r\n\r\n        PBRMaterial.CLEARCOATROUGHNESS = Shader3D.propertyNameToID(\"u_ClearCoatRoughness\");\r\n        PBRMaterial.SHADERDEFINE_CLEARCOATROUGHNESSTEXTURE = Shader3D.getDefineByName(\"CLEARCOAT_ROUGHNESSMAP\");\r\n        PBRMaterial.CLEARCOATROUGHNESSTEXTURE = Shader3D.propertyNameToID(\"u_ClearCoatRoughnessTexture\");\r\n        PBRMaterial.CLEARCOATNORMALTEXTURE = Shader3D.propertyNameToID(\"u_ClearCoatNormalTexture\");\r\n\r\n        // anisotropy\r\n        PBRMaterial.ANISOTROPY = Shader3D.propertyNameToID(\"u_AnisotropyStrength\");\r\n        PBRMaterial.SHADERDEFINE_ANISOTROPYTEXTURE = Shader3D.getDefineByName(\"ANISOTROPYMAP\");\r\n        PBRMaterial.ANISOTROPYTEXTURE = Shader3D.propertyNameToID(\"u_AnisotropyTexture\");\r\n        PBRMaterial.ANISOTROPYROTATION = Shader3D.propertyNameToID(\"u_AnisotropyRotation\");\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get albedoColor(): Color {\r\n        return this._shaderValues.getColor(PBRMaterial.ALBEDOCOLOR);\r\n    }\r\n\r\n    set albedoColor(value: Color) {\r\n        this._shaderValues.setColor(PBRMaterial.ALBEDOCOLOR, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get albedoTexture(): BaseTexture {\r\n        if (this.hasDefine(PBRMaterial.SHADERDEFINE_ALBEDOTEXTURE)) {\r\n            return this._shaderValues.getTexture(PBRMaterial.ALBEDOTEXTURE);\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    set albedoTexture(value: BaseTexture) {\r\n        if (value)\r\n            this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_ALBEDOTEXTURE);\r\n        else\r\n            this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_ALBEDOTEXTURE);\r\n\r\n        this._shaderValues.setTexture(PBRMaterial.ALBEDOTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get normalTexture(): BaseTexture {\r\n        if (this.hasDefine(PBRMaterial.SHADERDEFINE_NORMALTEXTURE)) {\r\n            return this._shaderValues.getTexture(PBRMaterial.NORMALTEXTURE);\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    set normalTexture(value: BaseTexture) {\r\n        if (value) {\r\n            this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_NORMALTEXTURE);\r\n        } else {\r\n            this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_NORMALTEXTURE);\r\n        }\r\n        this._shaderValues.setTexture(PBRMaterial.NORMALTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get normalTextureScale(): number {\r\n        return this._shaderValues.getNumber(PBRMaterial.NORMALSCALE);\r\n    }\r\n\r\n    set normalTextureScale(value: number) {\r\n        this._shaderValues.setNumber(PBRMaterial.NORMALSCALE, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get parallaxTexture(): BaseTexture {\r\n        return this._shaderValues.getTexture(PBRMaterial.PARALLAXTEXTURE);\r\n    }\r\n\r\n    set parallaxTexture(value: BaseTexture) {\r\n        if (value)\r\n            this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_PARALLAXTEXTURE);\r\n        else\r\n            this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_PARALLAXTEXTURE);\r\n        this._shaderValues.setTexture(PBRMaterial.PARALLAXTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get parallaxTextureScale(): number {\r\n        return this._shaderValues.getNumber(PBRMaterial.PARALLAXSCALE);\r\n    }\r\n\r\n    set parallaxTextureScale(value: number) {\r\n        this._shaderValues.setNumber(PBRMaterial.PARALLAXSCALE, Math.max(0.005, Math.min(0.08, value)));\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get occlusionTexture(): BaseTexture {\r\n        return this._shaderValues.getTexture(PBRMaterial.OCCLUSIONTEXTURE);\r\n    }\r\n\r\n    set occlusionTexture(value: BaseTexture) {\r\n        if (value)\r\n            this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_OCCLUSIONTEXTURE);\r\n        else\r\n            this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_OCCLUSIONTEXTURE);\r\n\r\n        this._shaderValues.setTexture(PBRMaterial.OCCLUSIONTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     * ,01\r\n     */\r\n    get occlusionTextureStrength(): number {\r\n        return this._shaderValues.getNumber(PBRMaterial.OCCLUSIONSTRENGTH);\r\n    }\r\n\r\n    set occlusionTextureStrength(value: number) {\r\n        this._shaderValues.setNumber(PBRMaterial.OCCLUSIONSTRENGTH, Math.max(0.0, Math.min(1.0, value)));\r\n    }\r\n\r\n    /**\r\n     * ,01\r\n     */\r\n    get smoothness(): number {\r\n        return this._shaderValues.getNumber(PBRMaterial.SMOOTHNESS);\r\n    }\r\n\r\n    set smoothness(value: number) {\r\n        this._shaderValues.setNumber(PBRMaterial.SMOOTHNESS, Math.max(0.0, Math.min(1.0, value)));\r\n    }\r\n\r\n    /**\r\n      * \r\n      */\r\n    get enableVertexColor(): boolean {\r\n        return this.hasDefine(PBRMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n    }\r\n\r\n    set enableVertexColor(value: boolean) {\r\n        if (value)\r\n            this.addDefine(PBRMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n        else\r\n            this.removeDefine(PBRMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get enableEmission(): boolean {\r\n        return this._shaderValues.hasDefine(PBRShaderLib.DEFINE_EMISSION);\r\n    }\r\n\r\n    set enableEmission(value: boolean) {\r\n        if (value)\r\n            this._shaderValues.addDefine(PBRShaderLib.DEFINE_EMISSION);\r\n        else\r\n            this._shaderValues.removeDefine(PBRShaderLib.DEFINE_EMISSION);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get emissionColor(): Color {\r\n        return this._shaderValues.getColor(PBRMaterial.EMISSIONCOLOR);\r\n    }\r\n\r\n    set emissionColor(value: Color) {\r\n        this._shaderValues.setColor(PBRMaterial.EMISSIONCOLOR, value);\r\n    }\r\n\r\n    set emissionIntensity(value: number) {\r\n        //u_EmissionIntensity\r\n        this._shaderValues.setNumber(PBRMaterial.EMISSIONIntensity, value);\r\n    }\r\n\r\n    get emissionIntensity() {\r\n        return this._shaderValues.getNumber(PBRMaterial.EMISSIONIntensity);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get emissionTexture(): BaseTexture {\r\n        return this._shaderValues.getTexture(PBRMaterial.EMISSIONTEXTURE);\r\n    }\r\n\r\n    set emissionTexture(value: BaseTexture) {\r\n        if (value)\r\n            this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_EMISSIONTEXTURE);\r\n        else\r\n            this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_EMISSIONTEXTURE);\r\n\r\n        this._shaderValues.setTexture(PBRMaterial.EMISSIONTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get tilingOffset(): Vector4 {\r\n        return (<Vector4>this._shaderValues.getVector(PBRMaterial.TILINGOFFSET));\r\n    }\r\n\r\n    set tilingOffset(value: Vector4) {\r\n        if (value) {\r\n            this._shaderValues.setVector(PBRMaterial.TILINGOFFSET, value);\r\n        }\r\n        else {\r\n            this._shaderValues.getVector(PBRMaterial.TILINGOFFSET).setValue(1.0, 1.0, 0.0, 0.0);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get detailAlbedoTexture(): BaseTexture {\r\n        return this._shaderValues.getTexture(PBRMaterial.DETAILALBEDOTEXTURE);\r\n    }\r\n\r\n    set detailAlbedoTexture(value: BaseTexture) {\r\n        if (value)\r\n            this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_DETAILALBEDO);\r\n        else\r\n            this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_DETAILALBEDO);\r\n\r\n        this._shaderValues.setTexture(PBRMaterial.DETAILALBEDOTEXTURE, value);\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get detailNormalTexture(): BaseTexture {\r\n        return this._shaderValues.getTexture(PBRMaterial.DETAILNORMALTEXTURE);\r\n    }\r\n\r\n    set detailNormalTexture(value: BaseTexture) {\r\n        if (value)\r\n            this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_DETAILNORMAL);\r\n        else\r\n            this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_DETAILNORMAL);\r\n        this._shaderValues.setTexture(PBRMaterial.DETAILNORMALTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n    * \r\n    */\r\n    get detailTilingOffset(): Vector4 {\r\n        return (<Vector4>this._shaderValues.getVector(PBRMaterial.DETAILTILLINGOFFSET));\r\n    }\r\n\r\n    set detailTilingOffset(value: Vector4) {\r\n        if (value) {\r\n            this._shaderValues.setVector(PBRMaterial.DETAILTILLINGOFFSET, value);\r\n        }\r\n        else {\r\n            this._shaderValues.getVector(PBRMaterial.DETAILTILLINGOFFSET).setValue(1.0, 1.0, 0.0, 0.0);\r\n        }\r\n    }\r\n\r\n    /**\r\n    * \r\n    */\r\n    get detailNormalScale(): number {\r\n        return this._shaderValues.getNumber(PBRMaterial.DETAILNORMALSCALE);\r\n    }\r\n\r\n    set detailNormalScale(value: number) {\r\n        this._shaderValues.setNumber(PBRMaterial.DETAILNORMALSCALE, value);\r\n    }\r\n\r\n\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    set renderMode(value: number) {\r\n        switch (value) {\r\n            case PBRRenderMode.Opaque:\r\n                this.alphaTest = false;\r\n                this.renderQueue = Material.RENDERQUEUE_OPAQUE;\r\n                this.depthWrite = true;\r\n                this.cull = RenderState.CULL_BACK;\r\n                this.blend = RenderState.BLEND_DISABLE;\r\n                this.depthTest = RenderState.DEPTHTEST_LESS;\r\n                this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_TRANSPARENTBLEND);\r\n                break;\r\n            case PBRRenderMode.Cutout:\r\n                this.renderQueue = Material.RENDERQUEUE_ALPHATEST;\r\n                this.alphaTest = true;\r\n                this.depthWrite = true;\r\n                this.cull = RenderState.CULL_BACK;\r\n                this.blend = RenderState.BLEND_DISABLE;\r\n                this.depthTest = RenderState.DEPTHTEST_LESS;\r\n                this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_TRANSPARENTBLEND);\r\n                break;\r\n            case PBRRenderMode.Fade:\r\n                this.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n                this.alphaTest = false;\r\n                this.depthWrite = false;\r\n                this.cull = RenderState.CULL_BACK;\r\n                this.blend = RenderState.BLEND_ENABLE_ALL;\r\n                this.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n                this.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n                this.depthTest = RenderState.DEPTHTEST_LESS;\r\n                this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_TRANSPARENTBLEND);\r\n                break;\r\n            case PBRRenderMode.Transparent:\r\n                this.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n                this.alphaTest = false;\r\n                this.depthWrite = false;\r\n                this.cull = RenderState.CULL_BACK;\r\n                this.blend = RenderState.BLEND_ENABLE_ALL;\r\n                this.blendSrc = RenderState.BLENDPARAM_ONE;\r\n                this.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n                this.depthTest = RenderState.DEPTHTEST_LESS;\r\n                this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_TRANSPARENTBLEND);\r\n                break;\r\n            default:\r\n                throw new Error(\"PBRMaterial:unknown renderMode value.\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  anisotropy\r\n     */\r\n    public get anisotropyEnable(): boolean {\r\n        return this.shaderData.hasDefine(PBRShaderLib.DEFINE_ANISOTROPY);\r\n    }\r\n    public set anisotropyEnable(value: boolean) {\r\n        if (value) {\r\n            this.shaderData.addDefine(PBRShaderLib.DEFINE_ANISOTROPY);\r\n        }\r\n        else {\r\n            this.shaderData.removeDefine(PBRShaderLib.DEFINE_ANISOTROPY);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * anisotropy \r\n     */\r\n    public get anisotropy(): number {\r\n        return this.getFloatByIndex(PBRMaterial.ANISOTROPY);\r\n    }\r\n    public set anisotropy(value: number) {\r\n        this.setFloatByIndex(PBRMaterial.ANISOTROPY, Math.min(1, Math.max(-1, value)));\r\n    }\r\n\r\n    /**\r\n     * anisotropy \r\n     */\r\n    public get anisotropyTexture(): Texture2D {\r\n        return <Texture2D>this.getTextureByIndex(PBRMaterial.ANISOTROPYTEXTURE);\r\n    }\r\n\r\n    public set anisotropyTexture(value: Texture2D) {\r\n        this.setTextureByIndex(PBRMaterial.ANISOTROPYTEXTURE, value);\r\n        if (value) {\r\n            this.addDefine(PBRMaterial.SHADERDEFINE_ANISOTROPYTEXTURE);\r\n        }\r\n        else {\r\n            this.removeDefine(PBRMaterial.SHADERDEFINE_ANISOTROPYTEXTURE);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * anisotropy   \r\n     */\r\n    public get anisotropyRotation(): number {\r\n        return this.getFloatByIndex(PBRMaterial.ANISOTROPYROTATION);\r\n    }\r\n    public set anisotropyRotation(value: number) {\r\n        value = Math.max(Math.min(value, 1.0), 0.0);\r\n        this.setFloatByIndex(PBRMaterial.ANISOTROPYROTATION, value);\r\n    }\r\n\r\n    /**\r\n     *  clear coat\r\n     */\r\n    public get clearCoatEnable(): boolean {\r\n        return this.shaderData.hasDefine(PBRShaderLib.DEFINE_CLEARCOAT);\r\n    }\r\n    public set clearCoatEnable(value: boolean) {\r\n        if (value) {\r\n            this.shaderData.addDefine(PBRShaderLib.DEFINE_CLEARCOAT);\r\n        }\r\n        else {\r\n            this.shaderData.removeDefine(PBRShaderLib.DEFINE_CLEARCOAT);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * clear coat  \r\n     */\r\n    public get clearCoat(): number {\r\n        return this.shaderData.getNumber(PBRMaterial.CLEARCOAT);\r\n    }\r\n    public set clearCoat(value: number) {\r\n        this.shaderData.setNumber(PBRMaterial.CLEARCOAT, value);\r\n    }\r\n\r\n    /**\r\n     * clear coat \r\n     */\r\n    public get clearCoatTexture(): BaseTexture {\r\n        return this.shaderData.getTexture(PBRMaterial.CLEARCOATTEXTURE);\r\n    }\r\n    public set clearCoatTexture(value: BaseTexture) {\r\n        if (value) {\r\n            this.shaderData.addDefine(PBRMaterial.SHADERDEFINE_CLEARCOATTEXTURE);\r\n        }\r\n        else {\r\n            this.shaderData.removeDefine(PBRMaterial.SHADERDEFINE_CLEARCOATTEXTURE);\r\n        }\r\n        this.shaderData.setTexture(PBRMaterial.CLEARCOATTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     * clear coat  \r\n     */\r\n    public get clearCoatRoughness(): number {\r\n        return this.shaderData.getNumber(PBRMaterial.CLEARCOATROUGHNESS);\r\n    }\r\n    public set clearCoatRoughness(value: number) {\r\n        this.shaderData.setNumber(PBRMaterial.CLEARCOATROUGHNESS, value);\r\n    }\r\n\r\n    /**\r\n     * clear coat  \r\n     */\r\n    public get clearCoatRoughnessTexture(): BaseTexture {\r\n        return this.shaderData.getTexture(PBRMaterial.CLEARCOATROUGHNESSTEXTURE);\r\n    }\r\n    public set clearCoatRoughnessTexture(value: BaseTexture) {\r\n        if (value) {\r\n            this.shaderData.addDefine(PBRMaterial.SHADERDEFINE_CLEARCOATROUGHNESSTEXTURE);\r\n        }\r\n        else {\r\n            this.shaderData.removeDefine(PBRMaterial.SHADERDEFINE_CLEARCOATROUGHNESSTEXTURE);\r\n        }\r\n        this.shaderData.setTexture(PBRMaterial.CLEARCOATROUGHNESSTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     * clear coat \r\n     */\r\n    public get clearCoatNormalTexture(): BaseTexture {\r\n        return this.shaderData.getTexture(PBRMaterial.CLEARCOATNORMALTEXTURE);\r\n    }\r\n    public set clearCoatNormalTexture(value: BaseTexture) {\r\n        if (value) {\r\n            this.shaderData.addDefine(PBRShaderLib.DEFINE_CLEARCOAT_NORMAL);\r\n        }\r\n        else {\r\n            this.shaderData.removeDefine(PBRShaderLib.DEFINE_CLEARCOAT_NORMAL);\r\n        }\r\n        this.shaderData.setTexture(PBRMaterial.CLEARCOATNORMALTEXTURE, value);\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n        this._shaderValues.setColor(PBRMaterial.ALBEDOCOLOR, new Color(1.0, 1.0, 1.0, 1.0));\r\n        this._shaderValues.setColor(PBRMaterial.EMISSIONCOLOR, new Color(1.0, 1.0, 1.0, 1.0));\r\n        this._shaderValues.setVector(PBRMaterial.TILINGOFFSET, new Vector4(1.0, 1.0, 0.0, 0.0));\r\n        this._shaderValues.setNumber(PBRMaterial.SMOOTHNESS, 0.5);\r\n        this._shaderValues.setNumber(PBRMaterial.OCCLUSIONSTRENGTH, 1.0);\r\n        this._shaderValues.setNumber(PBRMaterial.NORMALSCALE, 1.0);\r\n        this._shaderValues.setNumber(PBRMaterial.PARALLAXSCALE, 0.001);\r\n        this._shaderValues.setNumber(Material.ALPHATESTVALUE, 0.5);\r\n        this.renderMode = PBRRenderMode.Opaque;\r\n    }\r\n\r\n\r\n    //deprecated\r\n    /**\r\n     * @deprecated\r\n     * ,01\r\n     */\r\n    get smoothnessTextureScale(): number {\r\n        return this._shaderValues.getNumber(PBRMaterial.SMOOTHNESS);\r\n    }\r\n\r\n    set smoothnessTextureScale(value: number) {\r\n        this._shaderValues.setNumber(PBRMaterial.SMOOTHNESS, Math.max(0.0, Math.min(1.0, value)));\r\n    }\r\n}","import { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { PBRMaterial } from \"./PBRMaterial\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\n\r\n/**\r\n * PBR\r\n */\r\nexport enum PBRMetallicSmoothnessSource {\r\n\t/**Alpha*/\r\n\tMetallicGlossTextureAlpha,\r\n\t/**Alpha*/\r\n\tAlbedoTextureAlpha\r\n}\r\n\r\n/**\r\n * <code>PBRStandardMaterial</code> PBR\r\n */\r\nexport class PBRStandardMaterial extends PBRMaterial {\r\n\t/** @internal */\r\n\tstatic SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA: ShaderDefine;\r\n\t/** @internal */\r\n\tstatic SHADERDEFINE_METALLICGLOSSTEXTURE: ShaderDefine;\r\n\t/** @internal */\r\n\tstatic METALLICGLOSSTEXTURE: number;\r\n\t/** @internal */\r\n\tstatic METALLIC: number;\r\n\t/** */\r\n\tstatic defaultMaterial: PBRStandardMaterial;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tPBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE = Shader3D.getDefineByName(\"METALLICGLOSSTEXTURE\");\r\n\t\tPBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA = Shader3D.getDefineByName(\"SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\");\r\n\t\tPBRStandardMaterial.METALLICGLOSSTEXTURE = Shader3D.propertyNameToID(\"u_MetallicGlossTexture\");\r\n\t\tPBRStandardMaterial.METALLIC = Shader3D.propertyNameToID(\"u_Metallic\");\r\n\t\t// var shader: Shader3D = Shader3D.add(\"PBR\", true, true);\r\n\t\t// var subShader: SubShader = new SubShader();\r\n\t\t// shader.addSubShader(subShader);\r\n\t\t// subShader.addShaderPass(PBRVS, PBRPS, \"Forward\");\r\n\t\t// subShader.addShaderPass(PBRShadowCasterVS, PBRShadowCasterPS, \"ShadowCaster\");\r\n\t\t// subShader.addShaderPass(DepthNormalsTextureVS, DepthNormalsTextureFS, \"DepthNormal\");\r\n\t}\r\n\r\n\t/** @internal */\r\n\tprivate _smoothnessSource: PBRMetallicSmoothnessSource = 0;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget metallicGlossTexture(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(PBRStandardMaterial.METALLICGLOSSTEXTURE);\r\n\t}\r\n\r\n\tset metallicGlossTexture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis._shaderValues.addDefine(PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE);\r\n\t\telse\r\n\t\t\tthis._shaderValues.removeDefine(PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE);\r\n\r\n\t\tthis._shaderValues.setTexture(PBRStandardMaterial.METALLICGLOSSTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * ,01\r\n\t */\r\n\tget metallic(): number {\r\n\t\treturn this._shaderValues.getNumber(PBRStandardMaterial.METALLIC);\r\n\t}\r\n\r\n\tset metallic(value: number) {\r\n\t\tthis._shaderValues.setNumber(PBRStandardMaterial.METALLIC, Math.max(0.0, Math.min(1.0, value)));\r\n\t}\r\n\r\n\t/**\r\n\t * ,01\r\n\t */\r\n\tget smoothnessSource(): PBRMetallicSmoothnessSource {\r\n\t\treturn this._smoothnessSource;\r\n\t}\r\n\r\n\tset smoothnessSource(value: PBRMetallicSmoothnessSource) {\r\n\t\tif (value)\r\n\t\t\tthis._shaderValues.addDefine(PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA);\r\n\t\telse\r\n\t\t\tthis._shaderValues.removeDefine(PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA);\r\n\t\tthis._smoothnessSource = value;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>PBRStandardMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"PBR\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: PBRStandardMaterial = new PBRStandardMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n}\r\n\r\n\r\n","import { Vector2 } from \"../../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\nimport { IClone } from \"../../../../../utils/IClone\"\r\nimport { BoundBox } from \"../../../../math/BoundBox\"\r\nimport { Rand } from \"../../../../math/Rand\"\r\n\r\nexport enum ParticleSystemShapeType {\r\n\t/** */\r\n\tBox = 0,\r\n\t/** */\r\n\tCircle = 1,\r\n\t/** */\r\n\tCone = 2,\r\n\t/** */\r\n\tHemisphere = 3,\r\n\t/** */\r\n\tSphere = 4\r\n}\r\n\r\n\r\n/**\r\n * <code>BaseShape</code> \r\n */\r\nexport class BaseShape implements IClone {\r\n\t/***/\r\n\tenable: boolean = true;\r\n\t/***/\r\n\trandomDirection: number = 0;\r\n\r\n\t/** */\r\n\tshapeType: ParticleSystemShapeType;\r\n\r\n\t/**\r\n\t *  <code>BaseShape</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprotected _getShapeBoundBox(boundBox: BoundBox): void {\r\n\t\tthrow new Error(\"BaseShape: must override it.\");\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprotected _getSpeedBoundBox(boundBox: BoundBox): void {\r\n\t\tthrow new Error(\"BaseShape: must override it.\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tposition \r\n\t * @param\tdirection \r\n\t */\r\n\tgeneratePositionAndDirection(position: Vector3, direction: Vector3, rand: Rand = null, randomSeeds: Uint32Array = null): void {\r\n\t\tthrow new Error(\"BaseShape: must override it.\");\r\n\t}\r\n\r\n\t/** \r\n\t * @internal \r\n\t */\r\n\t_calculateProceduralBounds(boundBox: BoundBox, emitterPosScale: Vector3, minMaxBounds: Vector2): void {\r\n\t\tthis._getShapeBoundBox(boundBox);\r\n\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tVector3.multiply(min, emitterPosScale, min);\r\n\t\tVector3.multiply(max, emitterPosScale, max);\r\n\r\n\t\tvar speedBounds: BoundBox = new BoundBox(new Vector3(), new Vector3());\r\n\t\tif (this.randomDirection/* && (m_Type != kCone) && (m_Type != kConeShell)*/)//TODO:randomDirection01\r\n\t\t{\r\n\t\t\tspeedBounds.min = new Vector3(-1, -1, -1);\r\n\t\t\tspeedBounds.max = new Vector3(1, 1, 1);\r\n\t\t\t//minMaxBounds = Abs(minMaxBounds);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._getSpeedBoundBox(speedBounds);\r\n\t\t}\r\n\r\n\r\n\t\tvar maxSpeedBound: BoundBox = new BoundBox(new Vector3(), new Vector3());\r\n\t\tvar maxSpeedMin: Vector3 = maxSpeedBound.min;\r\n\t\tvar maxSpeedMax: Vector3 = maxSpeedBound.max;\r\n\t\tVector3.scale(speedBounds.min, minMaxBounds.y, maxSpeedMin);\r\n\t\tVector3.scale(speedBounds.max, minMaxBounds.y, maxSpeedMax);\r\n\t\tVector3.add(boundBox.min, maxSpeedMin, maxSpeedMin);\r\n\t\tVector3.add(boundBox.max, maxSpeedMax, maxSpeedMax);\r\n\r\n\t\tVector3.min(boundBox.min, maxSpeedMin, boundBox.min);\r\n\t\tVector3.max(boundBox.max, maxSpeedMin, boundBox.max);\r\n\r\n\r\n\t\tvar minSpeedBound: BoundBox = new BoundBox(new Vector3(), new Vector3());\r\n\t\tvar minSpeedMin: Vector3 = minSpeedBound.min;\r\n\t\tvar minSpeedMax: Vector3 = minSpeedBound.max;\r\n\t\tVector3.scale(speedBounds.min, minMaxBounds.x, minSpeedMin);\r\n\t\tVector3.scale(speedBounds.max, minMaxBounds.x, minSpeedMax);\r\n\r\n\t\tVector3.min(minSpeedBound.min, minSpeedMax, maxSpeedMin);\r\n\t\tVector3.max(minSpeedBound.min, minSpeedMax, maxSpeedMax);\r\n\r\n\t\tVector3.min(boundBox.min, maxSpeedMin, boundBox.min);\r\n\t\tVector3.max(boundBox.max, maxSpeedMin, boundBox.max);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destShape: BaseShape = (<BaseShape>destObject);\r\n\t\tdestShape.enable = this.enable;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destShape: BaseShape = new BaseShape();\r\n\t\tthis.cloneTo(destShape);\r\n\t\treturn destShape;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","export enum TrailAlignment {\r\n    /** */\r\n    View,\r\n    /** */\r\n    TransformZ\r\n}\r\n","export enum EPhysicsCapable {\r\n    Physics_Gravity,   //  \r\n    Physics_StaticCollider,  // \r\n    Physics_DynamicCollider, // \r\n    Physics_CharacterCollider,   // \r\n    Physics_BoxColliderShape,   // \r\n    Physics_SphereColliderShape,    // \r\n    Physics_CapsuleColliderShape,   // \r\n    Physics_CylinderColliderShape,  // \r\n    Physics_ConeColliderShape,  // \r\n    Physics_MeshColliderShape,  //  // _bt TODO\r\n    Physics_CompoundColliderShape,  //  // _bt TODO\r\n    Physics_CreateCorveMesh,  //CorveMesh // _bt TODO\r\n    physics_heightFieldColliderShape,\r\n    Physics_Joint,\r\n    Physics_FixedJoint,\r\n    Physics_SpringJoint,\r\n    Physics_HingeJoint,\r\n    Physics_D6Joint,\r\n}","import { Color } from \"../../../maths/Color\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { TextureCube } from \"../../../resource/TextureCube\";\r\nimport { Material } from \"../../../resource/Material\";\r\n\r\n/**\r\n * <code>SkyBoxMaterial</code> SkyBoxMaterial\r\n */\r\nexport class SkyBoxMaterial extends Material {\r\n\tstatic TINTCOLOR: number;\r\n\tstatic EXPOSURE: number;\r\n\tstatic ROTATION: number;\r\n\tstatic TEXTURECUBE: number;\r\n\r\n\t/** */\r\n\tstatic defaultMaterial: SkyBoxMaterial;\r\n\r\n\t/**\r\n\t* @internal\r\n\t*/\r\n\tstatic __initDefine__(): void {\r\n\t\tSkyBoxMaterial.TINTCOLOR = Shader3D.propertyNameToID(\"u_TintColor\");\r\n\t\tSkyBoxMaterial.EXPOSURE = Shader3D.propertyNameToID(\"u_Exposure\");\r\n\t\tSkyBoxMaterial.ROTATION = Shader3D.propertyNameToID(\"u_Rotation\");\r\n\t\tSkyBoxMaterial.TEXTURECUBE = Shader3D.propertyNameToID(\"u_CubeTexture\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget tintColor(): Color {\r\n\t\treturn this._shaderValues.getColor(SkyBoxMaterial.TINTCOLOR);\r\n\t}\r\n\r\n\tset tintColor(value: Color) {\r\n\t\tthis._shaderValues.setColor(SkyBoxMaterial.TINTCOLOR, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget exposure(): number {\r\n\t\treturn this._shaderValues.getNumber(SkyBoxMaterial.EXPOSURE);\r\n\t}\r\n\r\n\tset exposure(value: number) {\r\n\t\tthis._shaderValues.setNumber(SkyBoxMaterial.EXPOSURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget rotation(): number {\r\n\t\treturn this._shaderValues.getNumber(SkyBoxMaterial.ROTATION);\r\n\t}\r\n\r\n\tset rotation(value: number) {\r\n\t\tthis._shaderValues.setNumber(SkyBoxMaterial.ROTATION, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget textureCube(): TextureCube {\r\n\t\treturn (<TextureCube>this._shaderValues.getTexture(SkyBoxMaterial.TEXTURECUBE));\r\n\t}\r\n\r\n\tset textureCube(value: TextureCube) {\r\n\t\tthis._shaderValues.setTexture(SkyBoxMaterial.TEXTURECUBE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: SkyBoxMaterial = new SkyBoxMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SkyBoxMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"SkyBox\");\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Material } from \"../../../resource/Material\";\r\n\r\n/**\r\n * <code>SkyProceduralMaterial</code> SkyProceduralMaterial\r\n */\r\nexport class SkyProceduralMaterial extends Material {\r\n\t/** _*/\r\n\tstatic SUN_NODE: number = 0;\r\n\t/** _*/\r\n\tstatic SUN_SIMPLE: number = 1;\r\n\t/** _*/\r\n\tstatic SUN_HIGH_QUALITY: number = 2;\r\n\r\n\t/**@internal */\r\n\tstatic SUNSIZE: number;\r\n\t/**@internal */\r\n\tstatic SUNSIZECONVERGENCE: number;\r\n\t/**@internal */\r\n\tstatic ATMOSPHERETHICKNESS: number;\r\n\t/**@internal */\r\n\tstatic SKYTINT: number;\r\n\t/**@internal */\r\n\tstatic GROUNDTINT: number;\r\n\t/**@internal */\r\n\tstatic EXPOSURE: number;\r\n\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SUN_HIGH_QUALITY: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SUN_SIMPLE: ShaderDefine;\r\n\r\n\t/** */\r\n\tstatic defaultMaterial: SkyProceduralMaterial;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __initDefine__(): void {\r\n\t\tSkyProceduralMaterial.SHADERDEFINE_SUN_HIGH_QUALITY = Shader3D.getDefineByName(\"SUN_HIGH_QUALITY\");\r\n\t\tSkyProceduralMaterial.SHADERDEFINE_SUN_SIMPLE = Shader3D.getDefineByName(\"SUN_SIMPLE\");\r\n\t\tSkyProceduralMaterial.SUNSIZE = Shader3D.propertyNameToID(\"u_SunSize\");\r\n\t\tSkyProceduralMaterial.SUNSIZECONVERGENCE = Shader3D.propertyNameToID(\"u_SunSizeConvergence\");\r\n\t\tSkyProceduralMaterial.ATMOSPHERETHICKNESS = Shader3D.propertyNameToID(\"u_AtmosphereThickness\");\r\n\t\tSkyProceduralMaterial.SKYTINT = Shader3D.propertyNameToID(\"u_SkyTint\");\r\n\t\tSkyProceduralMaterial.GROUNDTINT = Shader3D.propertyNameToID(\"u_GroundTint\");\r\n\t\tSkyProceduralMaterial.EXPOSURE = Shader3D.propertyNameToID(\"u_Exposure\");\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _sunDisk: number;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget sunDisk(): number {\r\n\t\treturn this._sunDisk;\r\n\t}\r\n\r\n\tset sunDisk(value: number) {\r\n\t\tswitch (value) {\r\n\t\t\tcase SkyProceduralMaterial.SUN_HIGH_QUALITY:\r\n\t\t\t\tthis._shaderValues.removeDefine(SkyProceduralMaterial.SHADERDEFINE_SUN_SIMPLE);\r\n\t\t\t\tthis._shaderValues.addDefine(SkyProceduralMaterial.SHADERDEFINE_SUN_HIGH_QUALITY);\r\n\t\t\t\tbreak;\r\n\t\t\tcase SkyProceduralMaterial.SUN_SIMPLE:\r\n\t\t\t\tthis._shaderValues.removeDefine(SkyProceduralMaterial.SHADERDEFINE_SUN_HIGH_QUALITY);\r\n\t\t\t\tthis._shaderValues.addDefine(SkyProceduralMaterial.SHADERDEFINE_SUN_SIMPLE);\r\n\t\t\t\tbreak;\r\n\t\t\tcase SkyProceduralMaterial.SUN_NODE:\r\n\t\t\t\tthis._shaderValues.removeDefine(SkyProceduralMaterial.SHADERDEFINE_SUN_HIGH_QUALITY);\r\n\t\t\t\tthis._shaderValues.removeDefine(SkyProceduralMaterial.SHADERDEFINE_SUN_SIMPLE);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow \"SkyBoxProceduralMaterial: unknown sun value.\";\r\n\t\t}\r\n\t\tthis._sunDisk = value;\r\n\t}\r\n\r\n\t/**\r\n\t * ,01\r\n\t */\r\n\tget sunSize(): number {\r\n\t\treturn this._shaderValues.getNumber(SkyProceduralMaterial.SUNSIZE);\r\n\t}\r\n\r\n\tset sunSize(value: number) {\r\n\t\tvalue = Math.min(Math.max(0.0, value), 1.0);\r\n\t\tthis._shaderValues.setNumber(SkyProceduralMaterial.SUNSIZE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * ,020\r\n\t */\r\n\tget sunSizeConvergence(): number {\r\n\t\treturn this._shaderValues.getNumber(SkyProceduralMaterial.SUNSIZECONVERGENCE);\r\n\t}\r\n\r\n\tset sunSizeConvergence(value: number) {\r\n\t\tvalue = Math.min(Math.max(0.0, value), 20.0);\r\n\t\tthis._shaderValues.setNumber(SkyProceduralMaterial.SUNSIZECONVERGENCE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * ,05\r\n\t */\r\n\tget atmosphereThickness(): number {\r\n\t\treturn this._shaderValues.getNumber(SkyProceduralMaterial.ATMOSPHERETHICKNESS);\r\n\t}\r\n\r\n\tset atmosphereThickness(value: number) {\r\n\t\tvalue = Math.min(Math.max(0.0, value), 5.0);\r\n\t\tthis._shaderValues.setNumber(SkyProceduralMaterial.ATMOSPHERETHICKNESS, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget skyTint(): Color {\r\n\t\treturn (<Color>this._shaderValues.getColor(SkyProceduralMaterial.SKYTINT));\r\n\t}\r\n\r\n\tset skyTint(value: Color) {\r\n\t\tthis._shaderValues.setColor(SkyProceduralMaterial.SKYTINT, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget groundTint(): Color {\r\n\t\treturn this._shaderValues.getColor(SkyProceduralMaterial.GROUNDTINT);\r\n\t}\r\n\r\n\tset groundTint(value: Color) {\r\n\t\tthis._shaderValues.setColor(SkyProceduralMaterial.GROUNDTINT, value);\r\n\t}\r\n\r\n\t/**\r\n\t * ,08\r\n\t */\r\n\tget exposure(): number {\r\n\t\treturn this._shaderValues.getNumber(SkyProceduralMaterial.EXPOSURE);\r\n\t}\r\n\r\n\tset exposure(value: number) {\r\n\t\tvalue = Math.min(Math.max(0.0, value), 8.0);\r\n\t\tthis._shaderValues.setNumber(SkyProceduralMaterial.EXPOSURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SkyProceduralMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"SkyProcedural\");\r\n\t\tthis.sunDisk = SkyProceduralMaterial.SUN_HIGH_QUALITY;\r\n\t\tthis.sunSize = 0.04;\r\n\t\tthis.sunSizeConvergence = 5;\r\n\t\tthis.atmosphereThickness = 1.0;\r\n\t\tthis.skyTint = new Color(0.5, 0.5, 0.5, 1.0);\r\n\t\tthis.groundTint = new Color(0.369, 0.349, 0.341, 1.0);\r\n\t\tthis.exposure = 1.3;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: SkyProceduralMaterial = new SkyProceduralMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { Material } from \"../../../resource/Material\";\r\n\r\n/**\r\n * <code>UnlitMaterial</code> \r\n */\r\nexport class UnlitMaterial extends Material {\r\n\r\n\tstatic SHADERDEFINE_ALBEDOTEXTURE: ShaderDefine;\r\n\r\n\tstatic SHADERDEFINE_ENABLEVERTEXCOLOR: ShaderDefine;\r\n\r\n\tstatic ALBEDOTEXTURE: number;\r\n\r\n\tstatic ALBEDOCOLOR: number;\r\n\r\n\tstatic TILINGOFFSET: number;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __initDefine__(): void {\r\n\t\tUnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE = Shader3D.getDefineByName(\"ALBEDOTEXTURE\");\r\n\t\tUnlitMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR = Shader3D.getDefineByName(\"ENABLEVERTEXCOLOR\");\r\n\r\n\t\tUnlitMaterial.ALBEDOTEXTURE = Shader3D.propertyNameToID(\"u_AlbedoTexture\");\r\n\t\tUnlitMaterial.ALBEDOCOLOR = Shader3D.propertyNameToID(\"u_AlbedoColor\");\r\n\t\tUnlitMaterial.TILINGOFFSET = Shader3D.propertyNameToID(\"u_TilingOffset\");\r\n\t}\r\n\r\n\tprivate _albedoIntensity: number;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget albedoColor(): Color {\r\n\t\treturn this.getColorByIndex(UnlitMaterial.ALBEDOCOLOR);\r\n\t}\r\n\r\n\tset albedoColor(value: Color) {\r\n\t\tthis.setColorByIndex(UnlitMaterial.ALBEDOCOLOR, value.scale(this._albedoIntensity));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget albedoIntensity(): number {\r\n\t\treturn this._albedoIntensity;\r\n\t}\r\n\r\n\tset albedoIntensity(value: number) {\r\n\t\tthis._albedoIntensity = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget albedoTexture(): BaseTexture {\r\n\t\treturn this.getTextureByIndex(UnlitMaterial.ALBEDOTEXTURE);\r\n\t}\r\n\r\n\tset albedoTexture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE);\r\n\t\telse\r\n\t\t\tthis.removeDefine(UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE);\r\n\t\tthis.setTextureByIndex(UnlitMaterial.ALBEDOTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget tilingOffset(): Vector4 {\r\n\t\treturn (<Vector4>this.getVector4ByIndex(UnlitMaterial.TILINGOFFSET));\r\n\t}\r\n\r\n\tset tilingOffset(value: Vector4) {\r\n\t\tif (value) {\r\n\t\t\tthis.setVector4ByIndex(UnlitMaterial.TILINGOFFSET, value);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setVector4ByIndex(UnlitMaterial.TILINGOFFSET, new Vector4(1.0, 1.0, 0.0, 0.0));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget enableVertexColor(): boolean {\r\n\t\treturn this.hasDefine(UnlitMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n\t}\r\n\r\n\tset enableVertexColor(value: boolean) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(UnlitMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n\t\telse\r\n\t\t\tthis.removeDefine(UnlitMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n\t}\r\n\r\n\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"Unlit\");\r\n\t\tthis.renderMode = UnlitMaterial.RENDERMODE_OPAQUE;\r\n\t\tthis.albedoIntensity = 1.0;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: UnlitMaterial = new UnlitMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n\r\n\r\n\t//----------------deprecated----------------\r\n\t/**\r\n\t * @deprecated\r\n\t * _\r\n\t */\r\n\tstatic RENDERMODE_OPAQUE: number = 0;\r\n\t/**\r\n\t * @deprecated\r\n\t * _\r\n\t*/\r\n\tstatic RENDERMODE_CUTOUT: number = 1;\r\n\t/**\r\n\t * @deprecated\r\n\t * __ \r\n\t */\r\n\tstatic RENDERMODE_TRANSPARENT: number = 2;\r\n\t/**\r\n\t * @deprecated\r\n\t * __ \r\n\t */\r\n\tstatic RENDERMODE_ADDTIVE: number = 3;\r\n\t/**\r\n\t * @deprecated\r\n\t * \r\n\t */\r\n\tset renderMode(value: number) {\r\n\t\tswitch (value) {\r\n\t\t\tcase UnlitMaterial.RENDERMODE_OPAQUE:\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_OPAQUE;\r\n\t\t\t\tthis.depthWrite = true;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_DISABLE;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LESS;\r\n\t\t\t\tbreak;\r\n\t\t\tcase UnlitMaterial.RENDERMODE_CUTOUT:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_ALPHATEST;\r\n\t\t\t\tthis.alphaTest = true;\r\n\t\t\t\tthis.depthWrite = true;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_DISABLE;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LESS;\r\n\t\t\t\tbreak;\r\n\t\t\tcase UnlitMaterial.RENDERMODE_TRANSPARENT:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LESS;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"UnlitMaterial : renderMode value error.\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\n","import { RenderableSprite3D } from \"./RenderableSprite3D\";\r\nimport { MeshFilter } from \"./MeshFilter\";\r\nimport { MeshRenderer } from \"./MeshRenderer\";\r\nimport { Material } from \"../../resource/Material\";\r\nimport { Mesh } from \"../resource/models/Mesh\"\r\nimport { Node } from \"../../display/Node\"\r\nimport { Loader } from \"../../net/Loader\";\r\nimport { Sprite3D } from \"./Sprite3D\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\n\r\n/**\r\n * @deprecated\r\n * <code>MeshSprite3D</code> \r\n */\r\nexport class MeshSprite3D extends RenderableSprite3D {\r\n    private _meshFilter: MeshFilter;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get meshFilter(): MeshFilter {\r\n        return (<MeshFilter>this._meshFilter);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get meshRenderer(): MeshRenderer {\r\n        return (<MeshRenderer>this._render);\r\n    }\r\n\r\n    /**\r\n     *  <code>MeshSprite3D</code> \r\n     * @param mesh ,\r\n     * @param name \r\n     */\r\n    constructor(mesh: Mesh = null, name: string = null) {\r\n        super(name);\r\n        this._meshFilter = this.addComponent(MeshFilter);\r\n        this._render = this.addComponent(MeshRenderer);\r\n        (mesh) && (this._meshFilter.sharedMesh = mesh);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n        var render: MeshRenderer = this.meshRenderer;\r\n        var lightmapIndex: any = data.lightmapIndex;\r\n        (lightmapIndex != null) && (render.lightmapIndex = lightmapIndex);\r\n        var lightmapScaleOffsetArray: any[] = data.lightmapScaleOffset;\r\n        (lightmapScaleOffsetArray) && (render.lightmapScaleOffset = new Vector4(lightmapScaleOffsetArray[0], lightmapScaleOffsetArray[1], lightmapScaleOffsetArray[2], lightmapScaleOffsetArray[3]));\r\n        (data.meshPath != undefined) && (this.meshFilter.sharedMesh = Loader.getRes(data.meshPath));\r\n        (data.enableRender != undefined) && (render._enabled = data.enableRender);\r\n        (data.receiveShadows != undefined) && (render.receiveShadow = data.receiveShadows);\r\n        (data.castShadow != undefined) && (render.castShadow = data.castShadow);\r\n        var materials: any[] = data.materials;\r\n        if (materials) {\r\n            var sharedMaterials: Material[] = render.sharedMaterials;\r\n            var materialCount: number = materials.length;\r\n            sharedMaterials.length = materialCount;\r\n            for (var i: number = 0; i < materialCount; i++) {\r\n                sharedMaterials[i] = Loader.getRes(materials[i].path);\r\n            }\r\n\r\n            render.sharedMaterials = sharedMaterials;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _cloneTo(destObject: any, rootSprite: Node, dstSprite: Node): void {\r\n        super._cloneTo(destObject, rootSprite, dstSprite);//,\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Node {\r\n        return new Sprite3D();\r\n    }\r\n\r\n}\r\n\r\n","/**\r\n\t * ...\r\n\t * @author ...\r\n\t */\r\nexport class GradientMode {\r\n\t/**\r\n\t * ,,\r\n\t */\r\n\tstatic Blend: number = 0;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tstatic Fixed: number = 1;\r\n}\r\n\r\n","import { GradientMode } from \"./GradientMode\";\r\nimport { IClone } from \"../../utils/IClone\";\r\nimport { Color } from \"../../maths/Color\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\n\r\n\r\n/**\r\n * <code>Gradient</code> \r\n */\r\nexport class Gradient implements IClone {\r\n\tprivate _mode: number = 0;\r\n\tprivate _maxColorRGBKeysCount: number = 0;\r\n\tprivate _maxColorAlphaKeysCount: number = 0;\r\n\tprivate _colorRGBKeysCount: number = 0;\r\n\tprivate _colorAlphaKeysCount: number = 0;\r\n\r\n\t/**\r\n\t * @internal \r\n\t * element key range\r\n\t * x: colorkey min\r\n\t * y: colorkey max\r\n\t * z: alphakey min\r\n\t * w: alphakey max\r\n\t*/\r\n\t_keyRanges: Vector4 = new Vector4(1, 0, 1, 0);\r\n\r\n\t/**@internal */\r\n\t_alphaElements: Float32Array = null;\r\n\t/**@internal */\r\n\t_rgbElements: Float32Array = null;\r\n\r\n\t/**@internal */\r\n\t__alphaElements: Float32Array = null;\r\n\t/**@internal */\r\n\t__rgbElements: Float32Array = null;\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget rgbElements(): Float32Array {\r\n\t\tif (this._colorRGBKeysCount < 2) {\r\n\t\t\tif (this.__rgbElements == null) {\r\n\t\t\t\tthis.__rgbElements = new Float32Array(8);\r\n\t\t\t}\r\n\t\t\tlet rgbElements = this.__rgbElements;\r\n\t\t\trgbElements[1] = rgbElements[5] = this._rgbElements[1];\r\n\t\t\trgbElements[2] = rgbElements[6] = this._rgbElements[2];\r\n\t\t\trgbElements[3] = rgbElements[7] = this._rgbElements[3];\r\n\t\t\trgbElements[0] = 0;\r\n\t\t\trgbElements[4] = 1;\r\n\t\t\treturn rgbElements;\r\n\t\t} else {\r\n\t\t\treturn this._rgbElements;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *  alpha\r\n\t * @return  alpha\r\n\t */\r\n\tget alphaElements(): Float32Array {\r\n\t\tif (this._colorAlphaKeysCount < 2) {\r\n\t\t\tif (this.__alphaElements == null) {\r\n\t\t\t\tthis.__alphaElements = new Float32Array(4);\r\n\t\t\t}\r\n\t\t\tlet alphaElements = this.__alphaElements;\r\n\t\t\talphaElements[1] = alphaElements[3] = this._alphaElements[1];\r\n\t\t\talphaElements[0] = 0;\r\n\t\t\talphaElements[2] = 1;\r\n\t\t\treturn alphaElements;\r\n\t\t} else {\r\n\t\t\treturn this._alphaElements;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget mode(): number {\r\n\t\treturn this._mode;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset mode(value: number) {\r\n\t\tthis._mode = value;\r\n\t}\r\n\r\n\t/**\r\n\t * RGB\r\n\t * @return RGB\r\n\t */\r\n\tget colorRGBKeysCount(): number {\r\n\t\treturn this._colorRGBKeysCount;\r\n\t}\r\n\r\n\t/**\r\n\t * Alpha\r\n\t * @return Alpha\r\n\t */\r\n\tget colorAlphaKeysCount(): number {\r\n\t\treturn this._colorAlphaKeysCount;\r\n\t}\r\n\r\n\t/**\r\n\t * RGB\r\n\t * @return RGB\r\n\t */\r\n\tget maxColorRGBKeysCount(): number {\r\n\t\treturn this._maxColorRGBKeysCount;\r\n\t}\r\n\r\n\t/**\r\n\t * Alpha\r\n\t * @return Alpha\r\n\t */\r\n\tget maxColorAlphaKeysCount(): number {\r\n\t\treturn this._maxColorAlphaKeysCount;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Gradient</code> \r\n\t * @param maxColorRGBKeyCount RGB\r\n\t * @param maxColorAlphaKeyCount Alpha\r\n\t */\r\n\tconstructor(maxColorRGBKeyCount: number, maxColorAlphaKeyCount: number) {\r\n\t\tthis._maxColorRGBKeysCount = maxColorRGBKeyCount;\r\n\t\tthis._maxColorAlphaKeysCount = maxColorAlphaKeyCount;\r\n\t\tthis._rgbElements = new Float32Array(maxColorRGBKeyCount * 4);\r\n\t\tthis._alphaElements = new Float32Array(maxColorAlphaKeyCount * 2);\r\n\t}\r\n\r\n\t/**\r\n\t * RGB\r\n\t * @param\tkey 01\r\n\t * @param\tvalue RGB\r\n\t */\r\n\taddColorRGB(key: number, value: Color): void {\r\n\t\tif (this._colorRGBKeysCount < this._maxColorRGBKeysCount) {\r\n\t\t\tvar offset: number = this._colorRGBKeysCount * 4;\r\n\t\t\tthis._rgbElements[offset] = key;\r\n\t\t\tthis._rgbElements[offset + 1] = value.r;\r\n\t\t\tthis._rgbElements[offset + 2] = value.g;\r\n\t\t\tthis._rgbElements[offset + 3] = value.b;\r\n\t\t\tthis._colorRGBKeysCount++;\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Gradient:warning:data count must lessEqual than \" + this._maxColorRGBKeysCount);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Alpha\r\n\t * @param\tkey 01\r\n\t * @param\tvalue Alpha\r\n\t */\r\n\taddColorAlpha(key: number, value: number): void {\r\n\t\tif (this._colorAlphaKeysCount < this._maxColorAlphaKeysCount) {\r\n\t\t\tvar offset: number = this._colorAlphaKeysCount * 2;\r\n\t\t\tthis._alphaElements[offset] = key;\r\n\t\t\tthis._alphaElements[offset + 1] = value;\r\n\t\t\tthis._colorAlphaKeysCount++;\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Gradient:warning:data count must lessEqual than \" + this._maxColorAlphaKeysCount);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * RGB\r\n\t * @param   index \r\n\t * @param\tkey 01\r\n\t * @param\tvalue RGB\r\n\t */\r\n\tupdateColorRGB(index: number, key: number, value: Color): void {//TODO:key\r\n\t\tif (index < this._colorRGBKeysCount) {\r\n\t\t\tvar offset: number = index * 4;\r\n\t\t\tthis._rgbElements[offset] = key;\r\n\t\t\tthis._rgbElements[offset + 1] = value.r;\r\n\t\t\tthis._rgbElements[offset + 2] = value.g;\r\n\t\t\tthis._rgbElements[offset + 3] = value.b;\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Gradient:warning:index must lessEqual than colorRGBKeysCount:\" + this._colorRGBKeysCount);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Alpha\r\n\t * @param   index \r\n\t * @param\tkey 01\r\n\t * @param\tvalue Alpha\r\n\t */\r\n\tupdateColorAlpha(index: number, key: number, value: number): void {\r\n\t\tif (index < this._colorAlphaKeysCount) {\r\n\t\t\tvar offset: number = index * 2;\r\n\t\t\tthis._alphaElements[offset] = key;\r\n\t\t\tthis._alphaElements[offset + 1] = value;\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Gradient:warning:index must lessEqual than colorAlphaKeysCount:\" + this._colorAlphaKeysCount);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * RGB\r\n\t * @param  lerpFactor \r\n\t * @param  out \r\n\t * @param  \r\n\t * @return \r\n\t */\r\n\tevaluateColorRGB(lerpFactor: number, out: Color, startSearchIndex: number = 0, reverseSearch: boolean = false): number {\r\n\t\tlerpFactor = Math.min(Math.max(lerpFactor, 0.0), 1.0);\r\n\r\n\t\tvar rgbElements: Float32Array = this._rgbElements;\r\n\t\tvar curIndex: number = startSearchIndex;\r\n\r\n\t\tif (reverseSearch) {\r\n\t\t\tfor (var i: number = curIndex; i >= 0; i--) {\r\n\t\t\t\tvar offset: number = i * 4;\r\n\t\t\t\tvar left: number = rgbElements[offset];\r\n\t\t\t\tif (lerpFactor === left) {\r\n\t\t\t\t\tout.r = rgbElements[offset + 1];\r\n\t\t\t\t\tout.g = rgbElements[offset + 2];\r\n\t\t\t\t\tout.b = rgbElements[offset + 3];\r\n\t\t\t\t\treturn curIndex;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch (this._mode) {\r\n\t\t\t\t\tcase GradientMode.Blend:\r\n\t\t\t\t\t\tif (lerpFactor > left) {\r\n\t\t\t\t\t\t\tvar right: number = rgbElements[offset + 4];\r\n\t\t\t\t\t\t\tif (lerpFactor > right)\r\n\t\t\t\t\t\t\t\tthrow \"Gradient:wrong startSearchIndex.\";\r\n\t\t\t\t\t\t\tvar diff: number = right - left;\r\n\t\t\t\t\t\t\tvar y1: number = right - lerpFactor;\r\n\t\t\t\t\t\t\tvar y2: number = lerpFactor - left;\r\n\t\t\t\t\t\t\tout.r = (y1 * rgbElements[offset + 1] + y2 * rgbElements[offset + 5]) / diff;\r\n\t\t\t\t\t\t\tout.g = (y1 * rgbElements[offset + 2] + y2 * rgbElements[offset + 6]) / diff;\r\n\t\t\t\t\t\t\tout.b = (y1 * rgbElements[offset + 3] + y2 * rgbElements[offset + 7]) / diff;\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex--;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tcase GradientMode.Fixed:\r\n\t\t\t\t\t\tif (lerpFactor > left) {\r\n\t\t\t\t\t\t\tif (lerpFactor > rgbElements[offset + 4])\r\n\t\t\t\t\t\t\t\tthrow \"Gradient:wrong startSearchIndex.\";\r\n\t\t\t\t\t\t\tout.r = rgbElements[offset + 5];\r\n\t\t\t\t\t\t\tout.g = rgbElements[offset + 6];\r\n\t\t\t\t\t\t\tout.b = rgbElements[offset + 7];\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex--;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow \"Gradient:unknown mode.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (var i: number = 0, n: number = this._rgbElements.length; i < n; i++) {\r\n\t\t\t\toffset = i * 4;\r\n\t\t\t\tvar right: number = rgbElements[offset];\r\n\t\t\t\tif (lerpFactor === right) {\r\n\t\t\t\t\tout.r = rgbElements[offset + 1];\r\n\t\t\t\t\tout.g = rgbElements[offset + 2];\r\n\t\t\t\t\tout.b = rgbElements[offset + 3];\r\n\t\t\t\t\treturn curIndex;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch (this._mode) {\r\n\t\t\t\t\tcase GradientMode.Blend:\r\n\t\t\t\t\t\tif (lerpFactor < right) {\r\n\t\t\t\t\t\t\tvar left: number = rgbElements[offset - 4];\r\n\t\t\t\t\t\t\tif (lerpFactor < left)\r\n\t\t\t\t\t\t\t\tthrow \"Gradient:wrong startSearchIndex.\";\r\n\t\t\t\t\t\t\tvar diff: number = right - left;\r\n\t\t\t\t\t\t\tvar y1: number = right - lerpFactor;\r\n\t\t\t\t\t\t\tvar y2: number = lerpFactor - left;\r\n\t\t\t\t\t\t\tout.r = (y1 * rgbElements[offset - 3] + y2 * rgbElements[offset + 1]) / diff;\r\n\t\t\t\t\t\t\tout.g = (y1 * rgbElements[offset - 2] + y2 * rgbElements[offset + 2]) / diff;\r\n\t\t\t\t\t\t\tout.b = (y1 * rgbElements[offset - 1] + y2 * rgbElements[offset + 3]) / diff;\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex++;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tcase GradientMode.Fixed:\r\n\t\t\t\t\t\tif (lerpFactor < right) {\r\n\t\t\t\t\t\t\tif (lerpFactor < rgbElements[offset - 4])\r\n\t\t\t\t\t\t\t\tthrow \"Gradient:wrong startSearchIndex.\";\r\n\t\t\t\t\t\t\tout.r = rgbElements[offset + 1];\r\n\t\t\t\t\t\t\tout.g = rgbElements[offset + 2];\r\n\t\t\t\t\t\t\tout.b = rgbElements[offset + 3];\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex++;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow \"Gradient:unknown mode.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn curIndex;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param  lerpFactor \r\n\t * @param  out \r\n\t * @param  \r\n\t * @return  \r\n\t */\r\n\tevaluateColorAlpha(lerpFactor: number, outColor: Color, startSearchIndex: number = 0, reverseSearch: boolean = false): number {\r\n\t\tlerpFactor = Math.min(Math.max(lerpFactor, 0.0), 1.0);\r\n\t\tvar alphaElements: Float32Array = this._alphaElements;\r\n\t\tvar curIndex: number = startSearchIndex;\r\n\r\n\t\tif (reverseSearch) {\r\n\t\t\tfor (var i: number = curIndex; i >= 0; i--) {\r\n\t\t\t\tvar offset: number = i * 2;\r\n\t\t\t\tvar left: number = alphaElements[offset];\r\n\t\t\t\tif (lerpFactor === left) {\r\n\t\t\t\t\toutColor.a = alphaElements[offset + 1];\r\n\t\t\t\t\treturn curIndex;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch (this._mode) {\r\n\t\t\t\t\tcase GradientMode.Blend:\r\n\t\t\t\t\t\tif (lerpFactor > left) {\r\n\t\t\t\t\t\t\tvar right: number = alphaElements[offset + 2];\r\n\t\t\t\t\t\t\tif (lerpFactor > right)\r\n\t\t\t\t\t\t\t\tthrow \"Gradient:wrong startSearchIndex.\";\r\n\r\n\t\t\t\t\t\t\tvar diff: number = right - left;\r\n\t\t\t\t\t\t\tvar x1: number = right - lerpFactor;\r\n\t\t\t\t\t\t\tvar x2: number = lerpFactor - left;\r\n\t\t\t\t\t\t\toutColor.a = (x1 * alphaElements[offset + 1] + x2 * alphaElements[offset + 3]) / diff;\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex--;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tcase GradientMode.Fixed:\r\n\t\t\t\t\t\tif (lerpFactor > left) {\r\n\t\t\t\t\t\t\tif (lerpFactor > alphaElements[offset + 2])\r\n\t\t\t\t\t\t\t\tthrow \"Gradient:wrong startSearchIndex.\";\r\n\t\t\t\t\t\t\toutColor.a = alphaElements[offset + 3];\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex--;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow \"Gradient:unknown mode.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (var i: number = curIndex, n: number = this._alphaElements.length; i < n; i++) {\r\n\t\t\t\tvar offset: number = i * 2;\r\n\t\t\t\tvar right: number = alphaElements[offset];\r\n\t\t\t\tif (lerpFactor === right) {\r\n\t\t\t\t\toutColor.a = alphaElements[offset + 1];\r\n\t\t\t\t\treturn curIndex;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch (this._mode) {\r\n\t\t\t\t\tcase GradientMode.Blend:\r\n\t\t\t\t\t\tif (lerpFactor < right) {\r\n\t\t\t\t\t\t\tvar left: number = alphaElements[offset - 2];\r\n\t\t\t\t\t\t\tif (lerpFactor < left)\r\n\t\t\t\t\t\t\t\tthrow \"Gradient:wrong startSearchIndex.\";\r\n\t\t\t\t\t\t\tvar diff: number = right - left;\r\n\t\t\t\t\t\t\tvar x1: number = right - lerpFactor;\r\n\t\t\t\t\t\t\tvar x2: number = lerpFactor - left;\r\n\t\t\t\t\t\t\toutColor.a = (x1 * alphaElements[offset - 1] + x2 * alphaElements[offset + 1]) / diff;\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex++;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tcase GradientMode.Fixed:\r\n\t\t\t\t\t\tif (lerpFactor < right) {\r\n\t\t\t\t\t\t\tif (lerpFactor < alphaElements[offset - 2])\r\n\t\t\t\t\t\t\t\tthrow \"Gradient:wrong startSearchIndex.\";\r\n\t\t\t\t\t\t\toutColor.a = alphaElements[offset + 1];\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex++;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow \"Gradient:unknown mode.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn curIndex;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientDataColor: Gradient = (<Gradient>destObject);\r\n\t\tvar i: number, n: number;\r\n\t\tdestGradientDataColor._colorAlphaKeysCount = this._colorAlphaKeysCount;\r\n\t\tlet destAlphaElements = destGradientDataColor._alphaElements = new Float32Array(this._alphaElements.length);\r\n\r\n\t\tfor (i = 0, n = this._alphaElements.length; i < n; i++)\r\n\t\t\tdestAlphaElements[i] = this._alphaElements[i];\r\n\r\n\t\tdestGradientDataColor._colorRGBKeysCount = this._colorRGBKeysCount;\r\n\t\tvar destRGBElements: Float32Array = destGradientDataColor._rgbElements = new Float32Array(this._rgbElements.length);\r\n\t\tfor (i = 0, n = this._rgbElements.length; i < n; i++)\r\n\t\t\tdestRGBElements[i] = this._rgbElements[i];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientDataColor: Gradient = new Gradient(this._maxColorRGBKeysCount, this._maxColorAlphaKeysCount);\r\n\t\tthis.cloneTo(destGradientDataColor);\r\n\t\treturn destGradientDataColor;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { IClone } from \"../../../../utils/IClone\"\r\n\r\n/**\r\n * <code>Burst</code> \r\n */\r\nexport class Burst implements IClone {\r\n\t/** ,*/\r\n\tprivate _time: number;\r\n\t/** */\r\n\tprivate _minCount: number;\r\n\t/** */\r\n\tprivate _maxCount: number;\r\n\r\n\t/**\r\n\t * ,\r\n\t * @return ,\r\n\t */\r\n\tget time(): number {\r\n\t\treturn this._time;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget minCount(): number {\r\n\t\treturn this._minCount;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget maxCount(): number {\r\n\t\treturn this._maxCount;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Burst</code> \r\n\t * @param time ,\r\n\t * @param minCount \r\n\t * @param time \r\n\t */\r\n\tconstructor(time: number = 0, minCount: number = 0, maxCount: number = 0) {\r\n\t\tthis._time = time;\r\n\t\tthis._minCount = minCount;\r\n\t\tthis._maxCount = maxCount;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destBurst: Burst = (<Burst>destObject);\r\n\t\tdestBurst._time = this._time;\r\n\t\tdestBurst._minCount = this._minCount;\r\n\t\tdestBurst._maxCount = this._maxCount;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destBurst: Burst = new Burst(this._time, this._minCount, this._maxCount);\r\n\t\tthis.cloneTo(destBurst);\r\n\t\treturn destBurst;\r\n\t}\r\n}\r\n\r\n","import { Gradient } from \"../../Gradient\"\r\nimport { IClone } from \"../../../../utils/IClone\"\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\n\r\n/**\r\n * <code>GradientColor</code> \r\n */\r\nexport class GradientColor implements IClone {\r\n\t/**\r\n\t *  <code>GradientColor</code> \r\n\t * @param constant \r\n\t */\r\n\tstatic createByConstant(constant: Vector4): GradientColor {\r\n\t\tvar gradientColor: GradientColor = new GradientColor();\r\n\t\tgradientColor._type = 0;\r\n\t\tgradientColor._constant = constant;\r\n\t\treturn gradientColor;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientColor</code> \r\n\t * @param gradient \r\n\t */\r\n\tstatic createByGradient(gradient: Gradient): GradientColor {\r\n\t\tvar gradientColor: GradientColor = new GradientColor();\r\n\t\tgradientColor._type = 1;\r\n\t\tgradientColor._gradient = gradient;\r\n\t\treturn gradientColor;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientColor</code> \r\n\t * @param minConstant \r\n\t * @param maxConstant \r\n\t */\r\n\tstatic createByRandomTwoConstant(minConstant: Vector4, maxConstant: Vector4): GradientColor {\r\n\t\tvar gradientColor: GradientColor = new GradientColor();\r\n\t\tgradientColor._type = 2;\r\n\t\tgradientColor._constantMin = minConstant;\r\n\t\tgradientColor._constantMax = maxConstant;\r\n\t\treturn gradientColor;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientColor</code> \r\n\t * @param minGradient \r\n\t * @param maxGradient \r\n\t */\r\n\tstatic createByRandomTwoGradient(minGradient: Gradient, maxGradient: Gradient): GradientColor {\r\n\t\tvar gradientColor: GradientColor = new GradientColor();\r\n\t\tgradientColor._type = 3;\r\n\t\tgradientColor._gradientMin = minGradient;\r\n\t\tgradientColor._gradientMax = maxGradient;\r\n\t\treturn gradientColor;\r\n\t}\r\n\r\n\tprivate _type: number = 0;\r\n\r\n\tprivate _constant: Vector4 = null;\r\n\tprivate _constantMin: Vector4 = null;\r\n\tprivate _constantMax: Vector4 = null;\r\n\tprivate _gradient: Gradient = null;\r\n\tprivate _gradientMin: Gradient = null;\r\n\tprivate _gradientMax: Gradient = null;\r\n\r\n\t/**\r\n\t *,0,1,2,3\r\n\t */\r\n\tget type(): number {\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constant(): Vector4 {\r\n\t\treturn this._constant;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMin(): Vector4 {\r\n\t\treturn this._constantMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMax(): Vector4 {\r\n\t\treturn this._constantMax;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget gradient(): Gradient {\r\n\t\treturn this._gradient;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget gradientMin(): Gradient {\r\n\t\treturn this._gradientMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget gradientMax(): Gradient {\r\n\t\treturn this._gradientMax;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientColor,new</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientColor: GradientColor = (<GradientColor>destObject);\r\n\t\tdestGradientColor._type = this._type;\r\n\t\tthis._constant.cloneTo(destGradientColor._constant);\r\n\t\tthis._constantMin.cloneTo(destGradientColor._constantMin);\r\n\t\tthis._constantMax.cloneTo(destGradientColor._constantMax);\r\n\t\tthis._gradient.cloneTo(destGradientColor._gradient);\r\n\t\tthis._gradientMin.cloneTo(destGradientColor._gradientMin);\r\n\t\tthis._gradientMax.cloneTo(destGradientColor._gradientMax);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientColor: GradientColor = new GradientColor();\r\n\t\tthis.cloneTo(destGradientColor);\r\n\t\treturn destGradientColor;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { GradientColor } from \"./GradientColor\";\r\n/**\r\n * <code>ColorOverLifetime</code> \r\n */\r\nexport class ColorOverLifetime {\r\n\tprivate _color: GradientColor;\r\n\r\n\t/***/\r\n\tenable: boolean;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget color(): GradientColor {\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>ColorOverLifetime</code> \r\n\t */\r\n\tconstructor(color: GradientColor) {\r\n\t\tthis._color = color;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destColorOverLifetime: ColorOverLifetime = (<ColorOverLifetime>destObject);\r\n\t\tthis._color.cloneTo(destColorOverLifetime._color);\r\n\t\tdestColorOverLifetime.enable = this.enable;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destColor: GradientColor;\r\n\t\tswitch (this._color.type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tdestColor = GradientColor.createByConstant(this._color.constant.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tdestColor = GradientColor.createByGradient(this._color.gradient.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tdestColor = GradientColor.createByRandomTwoConstant(this._color.constantMin.clone(), this._color.constantMax.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tdestColor = GradientColor.createByRandomTwoGradient(this._color.gradientMin.clone(), this._color.gradientMax.clone());\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tvar destColorOverLifetime: ColorOverLifetime = new ColorOverLifetime(destColor);\r\n\t\tdestColorOverLifetime.enable = this.enable;\r\n\t\treturn destColorOverLifetime;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { GradientDataInt } from \"./GradientDataInt\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\n\r\n\r\n/**\r\n * <code>FrameOverTime</code> \r\n */\r\nexport class FrameOverTime implements IClone {\r\n\t/**\r\n\t *  <code>FrameOverTime</code> \r\n\t * @param\tconstant \r\n\t * @return \r\n\t */\r\n\tstatic createByConstant(constant: number = 0): FrameOverTime {\r\n\t\tvar rotationOverLifetime: FrameOverTime = new FrameOverTime();\r\n\t\trotationOverLifetime._type = 0;\r\n\t\trotationOverLifetime._constant = constant;\r\n\t\treturn rotationOverLifetime;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>FrameOverTime</code> \r\n\t * @param\toverTime \r\n\t * @return \r\n\t */\r\n\tstatic createByOverTime(overTime: GradientDataInt): FrameOverTime {\r\n\t\tvar rotationOverLifetime: FrameOverTime = new FrameOverTime();\r\n\t\trotationOverLifetime._type = 1;\r\n\t\trotationOverLifetime._overTime = overTime;\r\n\t\treturn rotationOverLifetime;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>FrameOverTime</code> \r\n\t * @param\tconstantMin \r\n\t * @param\tconstantMax \r\n\t * @return \r\n\t */\r\n\tstatic createByRandomTwoConstant(constantMin: number = 0, constantMax: number = 0): FrameOverTime {\r\n\t\tvar rotationOverLifetime: FrameOverTime = new FrameOverTime();\r\n\t\trotationOverLifetime._type = 2;\r\n\t\trotationOverLifetime._constantMin = constantMin;\r\n\t\trotationOverLifetime._constantMax = constantMax;\r\n\t\treturn rotationOverLifetime;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>FrameOverTime</code> \r\n\t * @param\tgradientFrameMin \r\n\t * @param\tgradientFrameMax \r\n\t * @return \r\n\t */\r\n\tstatic createByRandomTwoOverTime(gradientFrameMin: GradientDataInt, gradientFrameMax: GradientDataInt): FrameOverTime {\r\n\t\tvar rotationOverLifetime: FrameOverTime = new FrameOverTime();\r\n\t\trotationOverLifetime._type = 3;\r\n\t\trotationOverLifetime._overTimeMin = gradientFrameMin;\r\n\t\trotationOverLifetime._overTimeMax = gradientFrameMax;\r\n\t\treturn rotationOverLifetime;\r\n\t}\r\n\r\n\tprivate _type: number = 0;\r\n\r\n\tprivate _constant: number = 0;\r\n\r\n\tprivate _overTime: GradientDataInt = null;\r\n\r\n\tprivate _constantMin: number = 0;\r\n\tprivate _constantMax: number = 0;\r\n\r\n\tprivate _overTimeMin: GradientDataInt = null;\r\n\tprivate _overTimeMax: GradientDataInt = null;\r\n\r\n\t/**\r\n\t *,0123\r\n\t */\r\n\tget type(): number {\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constant(): number {\r\n\t\treturn this._constant;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget frameOverTimeData(): GradientDataInt {\r\n\t\treturn this._overTime;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMin(): number {\r\n\t\treturn this._constantMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMax(): number {\r\n\t\treturn this._constantMax;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget frameOverTimeDataMin(): GradientDataInt {\r\n\t\treturn this._overTimeMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget frameOverTimeDataMax(): GradientDataInt {\r\n\t\treturn this._overTimeMax;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>FrameOverTime,new</code> \r\n\t */\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destFrameOverTime: FrameOverTime = (<FrameOverTime>destObject);\r\n\t\tdestFrameOverTime._type = this._type;\r\n\t\tdestFrameOverTime._constant = this._constant;\r\n\t\t(this._overTime) && (this._overTime.cloneTo(destFrameOverTime._overTime));\r\n\t\tdestFrameOverTime._constantMin = this._constantMin;\r\n\t\tdestFrameOverTime._constantMax = this._constantMax;\r\n\t\t(this._overTimeMin) && (this._overTimeMin.cloneTo(destFrameOverTime._overTimeMin));\r\n\t\t(this._overTimeMax) && (this._overTimeMax.cloneTo(destFrameOverTime._overTimeMax));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destFrameOverTime: FrameOverTime = new FrameOverTime();\r\n\t\tthis.cloneTo(destFrameOverTime);\r\n\t\treturn destFrameOverTime;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { GradientDataNumber } from \"./GradientDataNumber\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\n\r\n\r\n/**\r\n * <code>GradientRotation</code> \r\n */\r\nexport class GradientAngularVelocity implements IClone {\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tconstant \r\n\t * @return \r\n\t */\r\n\tstatic createByConstant(constant: number): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 0;\r\n\t\tgradientAngularVelocity._separateAxes = false;\r\n\t\tgradientAngularVelocity._constant = constant;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tseparateConstant \r\n\t * @return \r\n\t */\r\n\tstatic createByConstantSeparate(separateConstant: Vector3): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 0;\r\n\t\tgradientAngularVelocity._separateAxes = true;\r\n\t\tgradientAngularVelocity._constantSeparate = separateConstant;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tgradient \r\n\t * @return \r\n\t */\r\n\tstatic createByGradient(gradient: GradientDataNumber): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 1;\r\n\t\tgradientAngularVelocity._separateAxes = false;\r\n\t\tgradientAngularVelocity._gradient = gradient;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tgradientX X\r\n\t * @param\tgradientY Y\r\n\t * @param\tgradientZ Z\r\n\t * @return  \r\n\t */\r\n\tstatic createByGradientSeparate(gradientX: GradientDataNumber, gradientY: GradientDataNumber, gradientZ: GradientDataNumber): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 1;\r\n\t\tgradientAngularVelocity._separateAxes = true;\r\n\t\tgradientAngularVelocity._gradientX = gradientX;\r\n\t\tgradientAngularVelocity._gradientY = gradientY;\r\n\t\tgradientAngularVelocity._gradientZ = gradientZ;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tconstantMin \r\n\t * @param\tconstantMax \r\n\t * @return \r\n\t */\r\n\tstatic createByRandomTwoConstant(constantMin: number, constantMax: number): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 2;\r\n\t\tgradientAngularVelocity._separateAxes = false;\r\n\t\tgradientAngularVelocity._constantMin = constantMin;\r\n\t\tgradientAngularVelocity._constantMax = constantMax;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tseparateConstantMin  \r\n\t * @param\tseparateConstantMax  \r\n\t * @return  \r\n\t */\r\n\tstatic createByRandomTwoConstantSeparate(separateConstantMin: Vector3, separateConstantMax: Vector3): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 2;\r\n\t\tgradientAngularVelocity._separateAxes = true;\r\n\t\tgradientAngularVelocity._constantMinSeparate = separateConstantMin;\r\n\t\tgradientAngularVelocity._constantMaxSeparate = separateConstantMax;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tgradientMin \r\n\t * @param\tgradientMax \r\n\t * @return  \r\n\t */\r\n\tstatic createByRandomTwoGradient(gradientMin: GradientDataNumber, gradientMax: GradientDataNumber): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 3;\r\n\t\tgradientAngularVelocity._separateAxes = false;\r\n\t\tgradientAngularVelocity._gradientMin = gradientMin;\r\n\t\tgradientAngularVelocity._gradientMax = gradientMax;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tgradientXMin  X\r\n\t * @param\tgradientXMax  X\r\n\t * @param\tgradientYMin  Y\r\n\t * @param\tgradientYMax  Y\r\n\t * @param\tgradientZMin  Z\r\n\t * @param\tgradientZMax  Z\r\n\t * @return  \r\n\t */\r\n\tstatic createByRandomTwoGradientSeparate(gradientXMin: GradientDataNumber, gradientXMax: GradientDataNumber, gradientYMin: GradientDataNumber, gradientYMax: GradientDataNumber, gradientZMin: GradientDataNumber, gradientZMax: GradientDataNumber, gradientWMin: GradientDataNumber, gradientWMax: GradientDataNumber): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 3;\r\n\t\tgradientAngularVelocity._separateAxes = true;\r\n\t\tgradientAngularVelocity._gradientXMin = gradientXMin;\r\n\t\tgradientAngularVelocity._gradientXMax = gradientXMax;\r\n\t\tgradientAngularVelocity._gradientYMin = gradientYMin;\r\n\t\tgradientAngularVelocity._gradientYMax = gradientYMax;\r\n\t\tgradientAngularVelocity._gradientZMin = gradientZMin;\r\n\t\tgradientAngularVelocity._gradientZMax = gradientZMax;\r\n\t\tgradientAngularVelocity._gradientWMin = gradientWMin;\r\n\t\tgradientAngularVelocity._gradientWMax = gradientWMax;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\tprivate _type: number = 0;\r\n\tprivate _separateAxes: boolean = false;\r\n\r\n\tprivate _constant: number = 0;\r\n\tprivate _constantSeparate: Vector3 = null;\r\n\r\n\tprivate _gradient: GradientDataNumber = null;\r\n\tprivate _gradientX: GradientDataNumber = null;\r\n\tprivate _gradientY: GradientDataNumber = null;\r\n\tprivate _gradientZ: GradientDataNumber = null;\r\n\tprivate _gradientW: GradientDataNumber = null;\r\n\r\n\tprivate _constantMin: number = 0;\r\n\tprivate _constantMax: number = 0;\r\n\tprivate _constantMinSeparate: Vector3 = null;\r\n\tprivate _constantMaxSeparate: Vector3 = null;\r\n\r\n\tprivate _gradientMin: GradientDataNumber = null;\r\n\tprivate _gradientMax: GradientDataNumber = null;\r\n\tprivate _gradientXMin: GradientDataNumber = null;\r\n\tprivate _gradientXMax: GradientDataNumber = null;\r\n\tprivate _gradientYMin: GradientDataNumber = null;\r\n\tprivate _gradientYMax: GradientDataNumber = null;\r\n\tprivate _gradientZMin: GradientDataNumber = null;\r\n\tprivate _gradientZMax: GradientDataNumber = null;\r\n\tprivate _gradientWMin: GradientDataNumber = null;\r\n\tprivate _gradientWMax: GradientDataNumber = null;\r\n\r\n\t/**\r\n\t *,0123\r\n\t */\r\n\tget type(): number {\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget separateAxes(): boolean {\r\n\t\treturn this._separateAxes;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constant(): number {\r\n\t\treturn this._constant;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantSeparate(): Vector3 {\r\n\t\treturn this._constantSeparate;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget gradient(): GradientDataNumber {\r\n\t\treturn this._gradient;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientX(): GradientDataNumber {\r\n\t\treturn this._gradientX;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget gradientY(): GradientDataNumber {\r\n\t\treturn this._gradientY;\r\n\t}\r\n\r\n\t/**\r\n\t *Z\r\n\t */\r\n\tget gradientZ(): GradientDataNumber {\r\n\t\treturn this._gradientZ;\r\n\t}\r\n\r\n\t/**\r\n\t *Z\r\n\t */\r\n\tget gradientW(): GradientDataNumber {\r\n\t\treturn this._gradientW;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMin(): number {\r\n\t\treturn this._constantMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMax(): number {\r\n\t\treturn this._constantMax;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMinSeparate(): Vector3 {\r\n\t\treturn this._constantMinSeparate;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMaxSeparate(): Vector3 {\r\n\t\treturn this._constantMaxSeparate;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget gradientMin(): GradientDataNumber {\r\n\t\treturn this._gradientMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget gradientMax(): GradientDataNumber {\r\n\t\treturn this._gradientMax;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientXMin(): GradientDataNumber {\r\n\t\treturn this._gradientXMin;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientXMax(): GradientDataNumber {\r\n\t\treturn this._gradientXMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget gradientYMin(): GradientDataNumber {\r\n\t\treturn this._gradientYMin;\r\n\t}\r\n\r\n\t/**\r\n\t *Y\r\n\t */\r\n\tget gradientYMax(): GradientDataNumber {\r\n\t\treturn this._gradientYMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientZMin(): GradientDataNumber {\r\n\t\treturn this._gradientZMin;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientZMax(): GradientDataNumber {\r\n\t\treturn this._gradientZMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientWMin(): GradientDataNumber {\r\n\t\treturn this._gradientWMin;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientWMax(): GradientDataNumber {\r\n\t\treturn this._gradientWMax;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity,new</code> \r\n\t */\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientAngularVelocity: GradientAngularVelocity = (<GradientAngularVelocity>destObject);\r\n\t\tdestGradientAngularVelocity._type = this._type;\r\n\t\tdestGradientAngularVelocity._separateAxes = this._separateAxes;\r\n\t\tdestGradientAngularVelocity._constant = this._constant;\r\n\t\tthis._constantSeparate.cloneTo(destGradientAngularVelocity._constantSeparate);\r\n\t\tthis._gradient.cloneTo(destGradientAngularVelocity._gradient);\r\n\t\tthis._gradientX.cloneTo(destGradientAngularVelocity._gradientX);\r\n\t\tthis._gradientY.cloneTo(destGradientAngularVelocity._gradientY);\r\n\t\tthis._gradientZ.cloneTo(destGradientAngularVelocity._gradientZ);\r\n\t\tdestGradientAngularVelocity._constantMin = this._constantMin;\r\n\t\tdestGradientAngularVelocity._constantMax = this._constantMax;\r\n\t\tthis._constantMinSeparate.cloneTo(destGradientAngularVelocity._constantMinSeparate);\r\n\t\tthis._constantMaxSeparate.cloneTo(destGradientAngularVelocity._constantMaxSeparate);\r\n\t\tthis._gradientMin.cloneTo(destGradientAngularVelocity._gradientMin);\r\n\t\tthis._gradientMax.cloneTo(destGradientAngularVelocity._gradientMax);\r\n\t\tthis._gradientXMin.cloneTo(destGradientAngularVelocity._gradientXMin);\r\n\t\tthis._gradientXMax.cloneTo(destGradientAngularVelocity._gradientXMax);\r\n\t\tthis._gradientYMin.cloneTo(destGradientAngularVelocity._gradientYMin);\r\n\t\tthis._gradientYMax.cloneTo(destGradientAngularVelocity._gradientYMax);\r\n\t\tthis._gradientZMin.cloneTo(destGradientAngularVelocity._gradientZMin);\r\n\t\tthis._gradientZMax.cloneTo(destGradientAngularVelocity._gradientZMax);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tthis.cloneTo(destGradientAngularVelocity);\r\n\t\treturn destGradientAngularVelocity;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { IClone } from \"../../../../utils/IClone\"\r\n\r\n/**\r\n * <code>GradientDataInt</code> \r\n */\r\nexport class GradientDataInt implements IClone {\r\n\tprivate _currentLength: number = 0;\r\n\t/**@internal */\r\n\t_elements: Float32Array;//TODO:int\r\n\r\n\t/***/\r\n\tget gradientCount(): number {\r\n\t\treturn this._currentLength / 2;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientDataInt</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tthis._elements = new Float32Array(8);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tkey 01\r\n\t * @param\tvalue \r\n\t */\r\n\tadd(key: number, value: number): void {\r\n\t\tif (this._currentLength < 8) {\r\n\t\t\tif ((this._currentLength === 6) && ((key !== 1))) {\r\n\t\t\t\tkey = 1;\r\n\t\t\t\tconsole.log(\"Warning:the forth key is  be force set to 1.\");\r\n\t\t\t}\r\n\r\n\t\t\tthis._elements[this._currentLength++] = key;\r\n\t\t\tthis._elements[this._currentLength++] = value;\r\n\t\t} else {\r\n\t\t\tconsole.log(\"Warning:data count must lessEqual than 4\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientDataInt: GradientDataInt = <GradientDataInt>destObject;\r\n\t\tdestGradientDataInt._currentLength = this._currentLength;\r\n\t\tvar destElements: Float32Array = destGradientDataInt._elements;\r\n\t\tfor (var i: number = 0, n: number = this._elements.length; i < n; i++) {\r\n\t\t\tdestElements[i] = this._elements[i];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientDataInt: GradientDataInt = new GradientDataInt();\r\n\t\tthis.cloneTo(destGradientDataInt);\r\n\t\treturn destGradientDataInt;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { IClone } from \"../../../../utils/IClone\"\r\n\r\n/**\r\n * <code>GradientDataNumber</code> \r\n */\r\nexport class GradientDataNumber implements IClone {\r\n\tprivate _currentLength: number = 0;\r\n\t/**@internal */\r\n\t_elements: Float32Array;\r\n\r\n\t/***/\r\n\tget gradientCount(): number {\r\n\t\treturn this._currentLength / 2;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientDataNumber</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tthis._elements = new Float32Array(8);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tkey 01\r\n\t * @param\tvalue \r\n\t */\r\n\tadd(key: number, value: number): void {\r\n\t\tif (this._currentLength < 8) {\r\n\r\n\t\t\tif ((this._currentLength === 6) && ((key !== 1))) {\r\n\t\t\t\tkey = 1;\r\n\t\t\t\tconsole.log(\"GradientDataNumber warning:the forth key is  be force set to 1.\");\r\n\t\t\t}\r\n\r\n\t\t\tthis._elements[this._currentLength++] = key;\r\n\t\t\tthis._elements[this._currentLength++] = value;\r\n\t\t} else {\r\n\t\t\tconsole.log(\"GradientDataNumber warning:data count must lessEqual than 4\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tindex \r\n\t * @return\tvalue \r\n\t */\r\n\tgetKeyByIndex(index: number): number {\r\n\t\treturn this._elements[index * 2];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tindex \r\n\t * @return\tvalue \r\n\t */\r\n\tgetValueByIndex(index: number): number {\r\n\t\treturn this._elements[index * 2 + 1];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tgetAverageValue(): number {\r\n\t\tvar total: number = 0;\r\n\t\tvar count: number = 0;\r\n\t\tfor (var i: number = 0, n: number = this._currentLength - 2; i < n; i += 2) {\r\n\t\t\tvar subValue: number = this._elements[i + 1];\r\n\t\t\tsubValue += this._elements[i + 3];\r\n\t\t\tsubValue = subValue * (this._elements[i + 2] - this._elements[i]);\r\n\t\t\ttotal += subValue;\r\n\t\t\tcount++;\r\n\t\t}\r\n\t\treturn total / count;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientDataNumber: GradientDataNumber = <GradientDataNumber>destObject;\r\n\t\tdestGradientDataNumber._currentLength = this._currentLength;\r\n\t\tvar destElements: Float32Array = destGradientDataNumber._elements;\r\n\t\tfor (var i: number = 0, n: number = this._elements.length; i < n; i++)\r\n\t\t\tdestElements[i] = this._elements[i];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientDataNumber: GradientDataNumber = new GradientDataNumber();\r\n\t\tthis.cloneTo(destGradientDataNumber);\r\n\t\treturn destGradientDataNumber;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { GradientDataNumber } from \"./GradientDataNumber\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>GradientSize</code> \r\n */\r\nexport class GradientSize implements IClone {\r\n\t/**\r\n\t *  <code>GradientSize</code> \r\n\t * @param\tgradient \r\n\t * @return  \r\n\t */\r\n\tstatic createByGradient(gradient: GradientDataNumber): GradientSize {\r\n\t\tvar gradientSize: GradientSize = new GradientSize();\r\n\t\tgradientSize._type = 0;\r\n\t\tgradientSize._separateAxes = false;\r\n\t\tgradientSize._gradient = gradient;\r\n\t\treturn gradientSize;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientSize</code> \r\n\t * @param\tgradientX X\r\n\t * @param\tgradientY Y\r\n\t * @param\tgradientZ Z\r\n\t * @return  \r\n\t */\r\n\tstatic createByGradientSeparate(gradientX: GradientDataNumber, gradientY: GradientDataNumber, gradientZ: GradientDataNumber): GradientSize {\r\n\t\tvar gradientSize: GradientSize = new GradientSize();\r\n\t\tgradientSize._type = 0;\r\n\t\tgradientSize._separateAxes = true;\r\n\t\tgradientSize._gradientX = gradientX;\r\n\t\tgradientSize._gradientY = gradientY;\r\n\t\tgradientSize._gradientZ = gradientZ;\r\n\t\treturn gradientSize;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientSize</code> \r\n\t * @param\tconstantMin \r\n\t * @param\tconstantMax \r\n\t * @return \r\n\t */\r\n\tstatic createByRandomTwoConstant(constantMin: number, constantMax: number): GradientSize {\r\n\t\tvar gradientSize: GradientSize = new GradientSize();\r\n\t\tgradientSize._type = 1;\r\n\t\tgradientSize._separateAxes = false;\r\n\t\tgradientSize._constantMin = constantMin;\r\n\t\tgradientSize._constantMax = constantMax;\r\n\t\treturn gradientSize;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientSize</code> \r\n\t * @param\tconstantMinSeparate .\r\n\t * @param\tconstantMaxSeparate \r\n\t * @return   \r\n\t */\r\n\tstatic createByRandomTwoConstantSeparate(constantMinSeparate: Vector3, constantMaxSeparate: Vector3): GradientSize {\r\n\t\tvar gradientSize: GradientSize = new GradientSize();\r\n\t\tgradientSize._type = 1;\r\n\t\tgradientSize._separateAxes = true;\r\n\t\tgradientSize._constantMinSeparate = constantMinSeparate;\r\n\t\tgradientSize._constantMaxSeparate = constantMaxSeparate;\r\n\t\treturn gradientSize;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientSize</code> \r\n\t * @param\tgradientMin \r\n\t * @param\tgradientMax \r\n\t * @return \r\n\t */\r\n\tstatic createByRandomTwoGradient(gradientMin: GradientDataNumber, gradientMax: GradientDataNumber): GradientSize {\r\n\t\tvar gradientSize: GradientSize = new GradientSize();\r\n\t\tgradientSize._type = 2;\r\n\t\tgradientSize._separateAxes = false;\r\n\t\tgradientSize._gradientMin = gradientMin;\r\n\t\tgradientSize._gradientMax = gradientMax;\r\n\t\treturn gradientSize;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientSize</code> \r\n\t * @param\tgradientXMin X\r\n\t * @param\tgradientXMax X\r\n\t * @param\tgradientYMin Y\r\n\t * @param\tgradientYMax Y\r\n\t * @param\tgradientZMin Z\r\n\t * @param\tgradientZMax Z\r\n\t * @return  \r\n\t */\r\n\tstatic createByRandomTwoGradientSeparate(gradientXMin: GradientDataNumber, gradientXMax: GradientDataNumber, gradientYMin: GradientDataNumber, gradientYMax: GradientDataNumber, gradientZMin: GradientDataNumber, gradientZMax: GradientDataNumber): GradientSize {\r\n\t\tvar gradientSize: GradientSize = new GradientSize();\r\n\t\tgradientSize._type = 2;\r\n\t\tgradientSize._separateAxes = true;\r\n\t\tgradientSize._gradientXMin = gradientXMin;\r\n\t\tgradientSize._gradientXMax = gradientXMax;\r\n\t\tgradientSize._gradientYMin = gradientYMin;\r\n\t\tgradientSize._gradientYMax = gradientYMax;\r\n\t\tgradientSize._gradientZMin = gradientZMin;\r\n\t\tgradientSize._gradientZMax = gradientZMax;\r\n\t\treturn gradientSize;\r\n\t}\r\n\r\n\tprivate _type: number = 0;\r\n\tprivate _separateAxes: boolean = false;\r\n\r\n\tprivate _gradient: GradientDataNumber = null;\r\n\tprivate _gradientX: GradientDataNumber = null;\r\n\tprivate _gradientY: GradientDataNumber = null;\r\n\tprivate _gradientZ: GradientDataNumber = null;\r\n\r\n\r\n\tprivate _constantMin: number = 0;\r\n\tprivate _constantMax: number = 0;\r\n\tprivate _constantMinSeparate: Vector3 = null;\r\n\tprivate _constantMaxSeparate: Vector3 = null;\r\n\r\n\r\n\tprivate _gradientMin: GradientDataNumber = null;\r\n\tprivate _gradientMax: GradientDataNumber = null;\r\n\tprivate _gradientXMin: GradientDataNumber = null;\r\n\tprivate _gradientXMax: GradientDataNumber = null;\r\n\tprivate _gradientYMin: GradientDataNumber = null;\r\n\tprivate _gradientYMax: GradientDataNumber = null;\r\n\tprivate _gradientZMin: GradientDataNumber = null;\r\n\tprivate _gradientZMax: GradientDataNumber = null;\r\n\r\n\t/**\r\n\t *012\r\n\t */\r\n\tget type(): number {\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget separateAxes(): boolean {\r\n\t\treturn this._separateAxes;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget gradient(): GradientDataNumber {\r\n\t\treturn this._gradient;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientX(): GradientDataNumber {\r\n\t\treturn this._gradientX;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget gradientY(): GradientDataNumber {\r\n\t\treturn this._gradientY;\r\n\t}\r\n\r\n\t/**\r\n\t *Z\r\n\t */\r\n\tget gradientZ(): GradientDataNumber {\r\n\t\treturn this._gradientZ;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget constantMin(): number {\r\n\t\treturn this._constantMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMax(): number {\r\n\t\treturn this._constantMax;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMinSeparate(): Vector3 {\r\n\t\treturn this._constantMinSeparate;\r\n\t}\r\n\r\n\t/**\r\n\t *  \r\n\t */\r\n\tget constantMaxSeparate(): Vector3 {\r\n\t\treturn this._constantMaxSeparate;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget gradientMin(): GradientDataNumber {\r\n\t\treturn this._gradientMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget gradientMax(): GradientDataNumber {\r\n\t\treturn this._gradientMax;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientXMin(): GradientDataNumber {\r\n\t\treturn this._gradientXMin;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientXMax(): GradientDataNumber {\r\n\t\treturn this._gradientXMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget gradientYMin(): GradientDataNumber {\r\n\t\treturn this._gradientYMin;\r\n\t}\r\n\r\n\t/**\r\n\t *Y\r\n\t */\r\n\tget gradientYMax(): GradientDataNumber {\r\n\t\treturn this._gradientYMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientZMin(): GradientDataNumber {\r\n\t\treturn this._gradientZMin;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientZMax(): GradientDataNumber {\r\n\t\treturn this._gradientZMax;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientSize,new</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tgetMaxSizeInGradient(meshMode: boolean = false): number {\r\n\t\tvar i: number, n: number;\r\n\t\tvar maxSize: number = -Number.MAX_VALUE;\r\n\t\tswitch (this._type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tif (this._separateAxes) {\r\n\t\t\t\t\tfor (i = 0, n = this._gradientX.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientX.getValueByIndex(i));\r\n\t\t\t\t\tfor (i = 0, n = this._gradientY.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientY.getValueByIndex(i));\r\n\t\t\t\t\tif (meshMode) {\r\n\t\t\t\t\t\tfor (i = 0, n = this._gradientZ.gradientCount; i < n; i++) {\r\n\t\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientZ.getValueByIndex(i));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (i = 0, n = this._gradient.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradient.getValueByIndex(i));\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tif (this._separateAxes) {\r\n\t\t\t\t\tmaxSize = Math.max(this._constantMinSeparate.x, this._constantMaxSeparate.x);\r\n\t\t\t\t\tmaxSize = Math.max(maxSize, this._constantMinSeparate.y);\r\n\t\t\t\t\tif (meshMode) {\r\n\t\t\t\t\t\tmaxSize = maxSize = Math.max(maxSize, this._constantMaxSeparate.z);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmaxSize = Math.max(this._constantMin, this._constantMax);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (this._separateAxes) {\r\n\t\t\t\t\tfor (i = 0, n = this._gradientXMin.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientXMin.getValueByIndex(i));\r\n\t\t\t\t\tfor (i = 0, n = this._gradientXMax.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientXMax.getValueByIndex(i));\r\n\r\n\t\t\t\t\tfor (i = 0, n = this._gradientYMin.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientYMin.getValueByIndex(i));\r\n\t\t\t\t\tfor (i = 0, n = this._gradientZMax.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientZMax.getValueByIndex(i));\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (meshMode) {\r\n\t\t\t\t\t\tfor (i = 0, n = this._gradientZMin.gradientCount; i < n; i++) {\r\n\t\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientZMin.getValueByIndex(i));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (i = 0, n = this._gradientZMax.gradientCount; i < n; i++) {\r\n\t\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientZMax.getValueByIndex(i));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (i = 0, n = this._gradientMin.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientMin.getValueByIndex(i));\r\n\t\t\t\t\tfor (i = 0, n = this._gradientMax.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientMax.getValueByIndex(i));\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn maxSize;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientSize: GradientSize = (<GradientSize>destObject);\r\n\t\tdestGradientSize._type = this._type;\r\n\t\tdestGradientSize._separateAxes = this._separateAxes;\r\n\t\tthis._gradient.cloneTo(destGradientSize._gradient);\r\n\t\tthis._gradientX.cloneTo(destGradientSize._gradientX);\r\n\t\tthis._gradientY.cloneTo(destGradientSize._gradientY);\r\n\t\tthis._gradientZ.cloneTo(destGradientSize._gradientZ);\r\n\t\tdestGradientSize._constantMin = this._constantMin;\r\n\t\tdestGradientSize._constantMax = this._constantMax;\r\n\t\tthis._constantMinSeparate.cloneTo(destGradientSize._constantMinSeparate);\r\n\t\tthis._constantMaxSeparate.cloneTo(destGradientSize._constantMaxSeparate);\r\n\t\tthis._gradientMin.cloneTo(destGradientSize._gradientMin);\r\n\t\tthis._gradientMax.cloneTo(destGradientSize._gradientMax);\r\n\t\tthis._gradientXMin.cloneTo(destGradientSize._gradientXMin);\r\n\t\tthis._gradientXMax.cloneTo(destGradientSize._gradientXMax);\r\n\t\tthis._gradientYMin.cloneTo(destGradientSize._gradientYMin);\r\n\t\tthis._gradientYMax.cloneTo(destGradientSize._gradientYMax);\r\n\t\tthis._gradientZMin.cloneTo(destGradientSize._gradientZMin);\r\n\t\tthis._gradientZMax.cloneTo(destGradientSize._gradientZMax);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientSize: GradientSize = new GradientSize();\r\n\t\tthis.cloneTo(destGradientSize);\r\n\t\treturn destGradientSize;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { GradientDataNumber } from \"./GradientDataNumber\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>GradientVelocity</code> \r\n */\r\nexport class GradientVelocity implements IClone {\r\n\t/**\r\n\t *  <code>GradientVelocity</code> \r\n\t * @param\tconstant \r\n\t * @return \r\n\t */\r\n\tstatic createByConstant(constant: Vector3): GradientVelocity {\r\n\t\tvar gradientVelocity: GradientVelocity = new GradientVelocity();\r\n\t\tgradientVelocity._type = 0;\r\n\t\tgradientVelocity._constant = constant;\r\n\t\treturn gradientVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientVelocity</code> \r\n\t * @param\tgradientX X\r\n\t * @param\tgradientY Y\r\n\t * @param\tgradientZ Z\r\n\t * @return  \r\n\t */\r\n\tstatic createByGradient(gradientX: GradientDataNumber, gradientY: GradientDataNumber, gradientZ: GradientDataNumber): GradientVelocity {\r\n\t\tvar gradientVelocity: GradientVelocity = new GradientVelocity();\r\n\t\tgradientVelocity._type = 1;\r\n\t\tgradientVelocity._gradientX = gradientX;\r\n\t\tgradientVelocity._gradientY = gradientY;\r\n\t\tgradientVelocity._gradientZ = gradientZ;\r\n\t\treturn gradientVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientVelocity</code> \r\n\t * @param\tconstantMin \r\n\t * @param\tconstantMax \r\n\t * @return \r\n\t */\r\n\tstatic createByRandomTwoConstant(constantMin: Vector3, constantMax: Vector3): GradientVelocity {\r\n\t\tvar gradientVelocity: GradientVelocity = new GradientVelocity();\r\n\t\tgradientVelocity._type = 2;\r\n\t\tgradientVelocity._constantMin = constantMin;\r\n\t\tgradientVelocity._constantMax = constantMax;\r\n\t\treturn gradientVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientVelocity</code> \r\n\t * @param\tgradientXMin X\r\n\t * @param\tgradientXMax X\r\n\t * @param\tgradientYMin Y\r\n\t * @param\tgradientYMax Y\r\n\t * @param\tgradientZMin Z\r\n\t * @param\tgradientZMax Z\r\n\t * @return  \r\n\t */\r\n\tstatic createByRandomTwoGradient(gradientXMin: GradientDataNumber, gradientXMax: GradientDataNumber, gradientYMin: GradientDataNumber, gradientYMax: GradientDataNumber, gradientZMin: GradientDataNumber, gradientZMax: GradientDataNumber): GradientVelocity {\r\n\t\tvar gradientVelocity: GradientVelocity = new GradientVelocity();\r\n\t\tgradientVelocity._type = 3;\r\n\t\tgradientVelocity._gradientXMin = gradientXMin;\r\n\t\tgradientVelocity._gradientXMax = gradientXMax;\r\n\t\tgradientVelocity._gradientYMin = gradientYMin;\r\n\t\tgradientVelocity._gradientYMax = gradientYMax;\r\n\t\tgradientVelocity._gradientZMin = gradientZMin;\r\n\t\tgradientVelocity._gradientZMax = gradientZMax;\r\n\t\treturn gradientVelocity;\r\n\t}\r\n\r\n\tprivate _type: number = 0;\r\n\tprivate _constant: Vector3 = null;\r\n\r\n\t\r\n\tprivate _gradientX: GradientDataNumber = null;\r\n\tprivate _gradientY: GradientDataNumber = null;\r\n\tprivate _gradientZ: GradientDataNumber = null;\r\n\r\n\t\r\n\tprivate _constantMin: Vector3 = null;\r\n\tprivate _constantMax: Vector3 = null;\r\n\r\n\t\r\n\tprivate _gradientXMin: GradientDataNumber = null;\r\n\tprivate _gradientXMax: GradientDataNumber = null;\r\n\tprivate _gradientYMin: GradientDataNumber = null;\r\n\tprivate _gradientYMax: GradientDataNumber = null;\r\n\tprivate _gradientZMin: GradientDataNumber = null;\r\n\tprivate _gradientZMax: GradientDataNumber = null;\r\n\r\n\t/**\r\n\t *0123\r\n\t */\r\n\tget type(): number {\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\t/***/\r\n\tget constant(): Vector3 {\r\n\t\treturn this._constant;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientX(): GradientDataNumber {\r\n\t\treturn this._gradientX;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget gradientY(): GradientDataNumber {\r\n\t\treturn this._gradientY;\r\n\t}\r\n\r\n\t/**\r\n\t *Z\r\n\t */\r\n\tget gradientZ(): GradientDataNumber {\r\n\t\treturn this._gradientZ;\r\n\t}\r\n\r\n\t/***/\r\n\tget constantMin(): Vector3 {\r\n\t\treturn this._constantMin;\r\n\t}\r\n\r\n\t/***/\r\n\tget constantMax(): Vector3 {\r\n\t\treturn this._constantMax;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientXMin(): GradientDataNumber {\r\n\t\treturn this._gradientXMin;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientXMax(): GradientDataNumber {\r\n\t\treturn this._gradientXMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget gradientYMin(): GradientDataNumber {\r\n\t\treturn this._gradientYMin;\r\n\t}\r\n\r\n\t/**\r\n\t *Y\r\n\t */\r\n\tget gradientYMax(): GradientDataNumber {\r\n\t\treturn this._gradientYMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientZMin(): GradientDataNumber {\r\n\t\treturn this._gradientZMin;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientZMax(): GradientDataNumber {\r\n\t\treturn this._gradientZMax;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientVelocity,new</code> \r\n\t */\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientVelocity: GradientVelocity = (<GradientVelocity>destObject);\r\n\t\tdestGradientVelocity._type = this._type;\r\n\t\tthis._constant.cloneTo(destGradientVelocity._constant);\r\n\t\tthis._gradientX.cloneTo(destGradientVelocity._gradientX);\r\n\t\tthis._gradientY.cloneTo(destGradientVelocity._gradientY);\r\n\t\tthis._gradientZ.cloneTo(destGradientVelocity._gradientZ);\r\n\t\tthis._constantMin.cloneTo(destGradientVelocity._constantMin);\r\n\t\tthis._constantMax.cloneTo(destGradientVelocity._constantMax);\r\n\t\tthis._gradientXMin.cloneTo(destGradientVelocity._gradientXMin);\r\n\t\tthis._gradientXMax.cloneTo(destGradientVelocity._gradientXMax);\r\n\t\tthis._gradientYMin.cloneTo(destGradientVelocity._gradientYMin);\r\n\t\tthis._gradientYMax.cloneTo(destGradientVelocity._gradientYMax);\r\n\t\tthis._gradientZMin.cloneTo(destGradientVelocity._gradientZMin);\r\n\t\tthis._gradientZMax.cloneTo(destGradientVelocity._gradientZMax);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientVelocity: GradientVelocity = new GradientVelocity();\r\n\t\tthis.cloneTo(destGradientVelocity);\r\n\t\treturn destGradientVelocity;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { GradientAngularVelocity } from \"./GradientAngularVelocity\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\n\r\n/**\r\n * <code>RotationOverLifetime</code> \r\n */\r\nexport class RotationOverLifetime implements IClone {\r\n\tprivate _angularVelocity: GradientAngularVelocity;\r\n\r\n\t/***/\r\n\tenable: boolean;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget angularVelocity(): GradientAngularVelocity {\r\n\t\treturn this._angularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>RotationOverLifetime,new</code> \r\n\t */\r\n\tconstructor(angularVelocity: GradientAngularVelocity) {\r\n\t\tthis._angularVelocity = angularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destRotationOverLifetime: RotationOverLifetime = (<RotationOverLifetime>destObject);\r\n\t\tthis._angularVelocity.cloneTo(destRotationOverLifetime._angularVelocity);\r\n\t\tdestRotationOverLifetime.enable = this.enable;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destAngularVelocity: GradientAngularVelocity;\r\n\t\tswitch (this._angularVelocity.type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tif (this._angularVelocity.separateAxes)\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByConstantSeparate(this._angularVelocity.constantSeparate.clone());\r\n\t\t\t\telse\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByConstant(this._angularVelocity.constant);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tif (this._angularVelocity.separateAxes)\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByGradientSeparate(this._angularVelocity.gradientX.clone(), this._angularVelocity.gradientY.clone(), this._angularVelocity.gradientZ.clone());\r\n\t\t\t\telse\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByGradient(this._angularVelocity.gradient.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (this._angularVelocity.separateAxes)\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(), this._angularVelocity.constantMaxSeparate.clone());\r\n\t\t\t\telse\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByRandomTwoConstant(this._angularVelocity.constantMin, this._angularVelocity.constantMax);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tif (this._angularVelocity.separateAxes)\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(), this._angularVelocity.gradientYMin.clone(), this._angularVelocity.gradientZMin.clone(), this._angularVelocity.gradientWMin.clone(), this._angularVelocity.gradientXMax.clone(), this._angularVelocity.gradientYMax.clone(), this._angularVelocity.gradientZMax.clone(), this._angularVelocity.gradientWMax.clone());\r\n\t\t\t\telse\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(), this._angularVelocity.gradientMax.clone());\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tvar destRotationOverLifetime: RotationOverLifetime = new RotationOverLifetime(destAngularVelocity);\r\n\t\tdestRotationOverLifetime.enable = this.enable;\r\n\t\treturn destRotationOverLifetime;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { IClone } from \"../../utils/IClone\"\r\n\r\n/**\r\n * <code>BoundBox</code> \r\n */\r\nexport class BoundBox implements IClone {\r\n\t/**@internal */\r\n\tprivate static _tempVector30: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempVector31: Vector3 = new Vector3();\r\n\r\n\t/***/\r\n\tmin: Vector3;\r\n\t/***/\r\n\tmax: Vector3;\r\n\r\n\t/**\r\n\t *  <code>BoundBox</code> \r\n\t * @param\tmin \r\n\t * @param\tmax \r\n\t */\r\n\tconstructor(min: Vector3, max: Vector3) {\r\n\t\tthis.min = min;\r\n\t\tthis.max = max;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _rotateExtents(extents: Vector3, rotation: Matrix4x4, out: Vector3): void {\r\n\t\tvar extentsX: number = extents.x;\r\n\t\tvar extentsY: number = extents.y;\r\n\t\tvar extentsZ: number = extents.z;\r\n\t\tvar matElements: Float32Array = rotation.elements;\r\n\t\tout.x = Math.abs(matElements[0] * extentsX) + Math.abs(matElements[4] * extentsY) + Math.abs(matElements[8] * extentsZ);\r\n\t\tout.y = Math.abs(matElements[1] * extentsX) + Math.abs(matElements[5] * extentsY) + Math.abs(matElements[9] * extentsZ);\r\n\t\tout.z = Math.abs(matElements[2] * extentsX) + Math.abs(matElements[6] * extentsY) + Math.abs(matElements[10] * extentsZ);\r\n\t}\r\n\r\n\t/**\r\n\t * 8\r\n\t * @param\tcorners \r\n\t */\r\n\tgetCorners(corners: Vector3[]): void {\r\n\t\tcorners.length = 8;\r\n\t\tvar minX: number = this.min.x;\r\n\t\tvar minY: number = this.min.y;\r\n\t\tvar minZ: number = this.min.z;\r\n\t\tvar maxX: number = this.max.x;\r\n\t\tvar maxY: number = this.max.y;\r\n\t\tvar maxZ: number = this.max.z;\r\n\t\tcorners[0] = new Vector3(minX, maxY, maxZ);\r\n\t\tcorners[1] = new Vector3(maxX, maxY, maxZ);\r\n\t\tcorners[2] = new Vector3(maxX, minY, maxZ);\r\n\t\tcorners[3] = new Vector3(minX, minY, maxZ);\r\n\t\tcorners[4] = new Vector3(minX, maxY, minZ);\r\n\t\tcorners[5] = new Vector3(maxX, maxY, minZ);\r\n\t\tcorners[6] = new Vector3(maxX, minY, minZ);\r\n\t\tcorners[7] = new Vector3(minX, minY, minZ);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tout\r\n\t */\r\n\tgetCenter(out: Vector3): void {\r\n\t\tVector3.add(this.min, this.max, out);\r\n\t\tVector3.scale(out, 0.5, out);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tout\r\n\t */\r\n\tgetExtent(out: Vector3): void {\r\n\t\tVector3.subtract(this.max, this.min, out);\r\n\t\tVector3.scale(out, 0.5, out);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tcenter\r\n\t */\r\n\tsetCenterAndExtent(center: Vector3, extent: Vector3): void {\r\n\t\tVector3.subtract(center, extent, this.min);\r\n\t\tVector3.add(center, extent, this.max);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\ttranform(matrix: Matrix4x4, out: BoundBox): void {\r\n\t\tvar center: Vector3 = BoundBox._tempVector30;\r\n\t\tvar extent: Vector3 = BoundBox._tempVector31;\r\n\t\tthis.getCenter(center);\r\n\t\tthis.getExtent(extent);\r\n\t\tVector3.transformCoordinate(center, matrix, center);\r\n\t\tthis._rotateExtents(extent, matrix, extent);\r\n\t\tout.setCenterAndExtent(center, extent);\r\n\t}\r\n\r\n\ttoDefault(): void {\r\n\t\tthis.min.toDefault();\r\n\t\tthis.max.toDefault();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tpoints \r\n\t * @param\tout \r\n\t */\r\n\tstatic createfromPoints(points: Vector3[], out: BoundBox): void {\r\n\t\tif (points == null)\r\n\t\t\tthrow new Error(\"points\");\r\n\r\n\t\tvar min: Vector3 = out.min;\r\n\t\tvar max: Vector3 = out.max;\r\n\t\tmin.x = Number.MAX_VALUE;\r\n\t\tmin.y = Number.MAX_VALUE;\r\n\t\tmin.z = Number.MAX_VALUE;\r\n\t\tmax.x = -Number.MAX_VALUE;\r\n\t\tmax.y = -Number.MAX_VALUE;\r\n\t\tmax.z = -Number.MAX_VALUE;\r\n\r\n\t\tfor (var i: number = 0, n: number = points.length; i < n; ++i) {\r\n\t\t\tVector3.min(min, points[i], min);\r\n\t\t\tVector3.max(max, points[i], max);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tbox1 1\r\n\t * @param\tbox2 2\r\n\t * @param\tout \r\n\t */\r\n\tstatic merge(box1: BoundBox, box2: BoundBox, out: BoundBox): void {\r\n\t\tVector3.min(box1.min, box2.min, out.min);\r\n\t\tVector3.max(box1.max, box2.max, out.max);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: BoundBox): void {\r\n\t\tvar dest: BoundBox = (<BoundBox>destObject);\r\n\t\tthis.min.cloneTo(dest.min);\r\n\t\tthis.max.cloneTo(dest.max);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: BoundBox = new BoundBox(new Vector3(), new Vector3());\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n}\r\n\r\n\r\n\r\n","import { Vector2 } from \"../../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\nimport { Rand } from \"../../../../math/Rand\"\r\n\r\n/**\r\n * @internal\r\n * @author ...\r\n */\r\nexport class ShapeUtils {\r\n\tstatic _randomPointUnitArcCircle(arc: number, out: Vector2, rand: Rand = null): void {\r\n\t\tvar angle: number;\r\n\t\tif (rand)\r\n\t\t\tangle = rand.getFloat() * arc;\r\n\t\telse\r\n\t\t\tangle = Math.random() * arc;\r\n\t\tout.x = Math.cos(angle);\r\n\t\tout.y = Math.sin(angle);\r\n\t}\r\n\r\n\tstatic _randomPointInsideUnitArcCircle(arc: number, out: Vector2, rand: Rand = null): void {\r\n\t\tShapeUtils._randomPointUnitArcCircle(arc, out, rand);\r\n\t\tvar range: number;\r\n\t\tif (rand)\r\n\t\t\trange = Math.pow(rand.getFloat(), 1.0 / 2.0);\r\n\t\telse\r\n\t\t\trange = Math.pow(Math.random(), 1.0 / 2.0);\r\n\t\tout.x = out.x * range;\r\n\t\tout.y = out.y * range;\r\n\t}\r\n\r\n\tstatic _randomPointUnitCircle(out: Vector2, rand: Rand = null): void {\r\n\t\tvar angle: number;\r\n\t\tif (rand)\r\n\t\t\tangle = rand.getFloat() * Math.PI * 2;\r\n\t\telse\r\n\t\t\tangle = Math.random() * Math.PI * 2;\r\n\t\tout.x = Math.cos(angle);\r\n\t\tout.y = Math.sin(angle);\r\n\t}\r\n\r\n\tstatic _randomPointInsideUnitCircle(out: Vector2, rand: Rand = null): void {\r\n\t\tShapeUtils._randomPointUnitCircle(out);\r\n\t\tvar range: number;\r\n\t\tif (rand)\r\n\t\t\trange = Math.pow(rand.getFloat(), 1.0 / 2.0);\r\n\t\telse\r\n\t\t\trange = Math.pow(Math.random(), 1.0 / 2.0);\r\n\t\tout.x = out.x * range;\r\n\t\tout.y = out.y * range;\r\n\t}\r\n\r\n\tstatic _randomPointUnitSphere(out: Vector3, rand: Rand = null): void {\r\n\t\tvar z: number;\r\n\t\tvar a: number;\r\n\t\tif (rand) {\r\n\t\t\tz = out.z = rand.getFloat() * 2 - 1.0;\r\n\t\t\ta = rand.getFloat() * Math.PI * 2;\r\n\t\t} else {\r\n\t\t\tz = out.z = Math.random() * 2 - 1.0;\r\n\t\t\ta = Math.random() * Math.PI * 2;\r\n\t\t}\r\n\r\n\t\tvar r: number = Math.sqrt(1.0 - z * z);\r\n\r\n\t\tout.x = r * Math.cos(a);\r\n\t\tout.y = r * Math.sin(a);\r\n\t}\r\n\r\n\tstatic _randomPointInsideUnitSphere(out: Vector3, rand: Rand = null): void {\r\n\t\t;\r\n\t\tShapeUtils._randomPointUnitSphere(out);\r\n\t\tvar range: number;\r\n\t\tif (rand)\r\n\t\t\trange = Math.pow(rand.getFloat(), 1.0 / 3.0);\r\n\t\telse\r\n\t\t\trange = Math.pow(Math.random(), 1.0 / 3.0);\r\n\t\tout.x = out.x * range;\r\n\t\tout.y = out.y * range;\r\n\t\tout.z = out.z * range;\r\n\t}\r\n\r\n\tstatic _randomPointInsideHalfUnitBox(out: Vector3, rand: Rand = null): void {\r\n\t\tif (rand) {\r\n\t\t\tout.x = (rand.getFloat() - 0.5);\r\n\t\t\tout.y = (rand.getFloat() - 0.5);\r\n\t\t\tout.z = (rand.getFloat() - 0.5);\r\n\t\t} else {\r\n\t\t\tout.x = (Math.random() - 0.5);\r\n\t\t\tout.y = (Math.random() - 0.5);\r\n\t\t\tout.z = (Math.random() - 0.5);\r\n\t\t}\r\n\t}\r\n\r\n\tconstructor() {\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { BaseShape, ParticleSystemShapeType } from \"./BaseShape\";\r\nimport { ShapeUtils } from \"./ShapeUtils\";\r\nimport { BoundBox } from \"../../../../math/BoundBox\"\r\nimport { Rand } from \"../../../../math/Rand\"\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>BoxShape</code> \r\n */\r\nexport class BoxShape extends BaseShape {\r\n\t/**X*/\r\n\tx: number;\r\n\t/**Y*/\r\n\ty: number;\r\n\t/**Z*/\r\n\tz: number;\r\n\r\n\t/**\r\n\t *  <code>BoxShape</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.shapeType = ParticleSystemShapeType.Box;\r\n\t\tthis.x = 1.0;\r\n\t\tthis.y = 1.0;\r\n\t\tthis.z = 1.0;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getShapeBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = -this.x * 0.5;\r\n\t\tmin.y = -this.y * 0.5;\r\n\t\tmin.z = -this.z * 0.5;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = this.x * 0.5;\r\n\t\tmax.y = this.y * 0.5;\r\n\t\tmax.z = this.z * 0.5;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getSpeedBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = 0.0;\r\n\t\tmin.y = 0.0;\r\n\t\tmin.z = 0.0;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = 0.0;\r\n\t\tmax.y = 1.0;\r\n\t\tmax.z = 0.0;\r\n\t}\r\n\r\n\t/**\r\n\t *  \r\n\t * @param\tposition \r\n\t * @param\tdirection \r\n\t * @override\r\n\t */\r\n\tgeneratePositionAndDirection(position: Vector3, direction: Vector3, rand: Rand = null, randomSeeds: Uint32Array = null): void {\r\n\t\tif (rand) {\r\n\t\t\trand.seed = randomSeeds[16];\r\n\t\t\tShapeUtils._randomPointInsideHalfUnitBox(position, rand);\r\n\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t} else {\r\n\t\t\tShapeUtils._randomPointInsideHalfUnitBox(position);\r\n\t\t}\r\n\t\tposition.x = this.x * position.x;\r\n\t\tposition.y = this.y * position.y;\r\n\t\tposition.z = this.z * position.z;\r\n\t\tif (this.randomDirection) {\r\n\t\t\tif (rand) {\r\n\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction, rand);\r\n\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t} else {\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdirection.x = 0.0;\r\n\t\t\tdirection.y = 0.0;\r\n\t\t\tdirection.z = 1.0;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param destObject \r\n\t * @override\r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tsuper.cloneTo(destObject);\r\n\t\tvar destShape: BoxShape = (<BoxShape>destObject);\r\n\t\tdestShape.x = this.x;\r\n\t\tdestShape.y = this.y;\r\n\t\tdestShape.z = this.z;\r\n\t\tdestShape.randomDirection = this.randomDirection;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destShape: BoxShape = new BoxShape();\r\n\t\tthis.cloneTo(destShape);\r\n\t\treturn destShape;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { BaseShape, ParticleSystemShapeType } from \"./BaseShape\";\r\nimport { ShapeUtils } from \"./ShapeUtils\";\r\nimport { BoundBox } from \"../../../../math/BoundBox\"\r\nimport { Rand } from \"../../../../math/Rand\"\r\nimport { Vector2 } from \"../../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>CircleShape</code> \r\n */\r\nexport class CircleShape extends BaseShape {\r\n\t/** @internal */\r\n\tprotected static _tempPositionPoint: Vector2 = new Vector2();\r\n\r\n\t/***/\r\n\tradius: number;\r\n\t/***/\r\n\tarc: number;\r\n\t/***/\r\n\temitFromEdge: boolean;\r\n\r\n\t/**\r\n\t *  <code>CircleShape</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.shapeType = ParticleSystemShapeType.Circle;\r\n\t\tthis.radius = 1.0;\r\n\t\tthis.arc = 360.0 / 180.0 * Math.PI;\r\n\t\tthis.emitFromEdge = false;\r\n\t}\r\n\r\n\t/**\r\n\t * 0-360\r\n\t */\r\n\tset arcDEG(deg: number) {\r\n\t\tthis.arc = deg / 180 * Math.PI;\r\n\t}\r\n\r\n\tget arcDEG() {\r\n\t\treturn this.arc * 180 / Math.PI;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getShapeBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.z = -this.radius;\r\n\t\tmin.y = 0;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.z = this.radius;\r\n\t\tmax.y = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getSpeedBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.y = -1;\r\n\t\tmin.z = 0;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.y = 1;\r\n\t\tmax.z = 0;\r\n\t}\r\n\r\n\t/**\r\n\t *  \r\n\t * @param\tposition \r\n\t * @param\tdirection \r\n\t * @override\r\n\t */\r\n\tgeneratePositionAndDirection(position: Vector3, direction: Vector3, rand: Rand = null, randomSeeds: Uint32Array = null): void {\r\n\t\tvar positionPoint: Vector2 = CircleShape._tempPositionPoint;\r\n\t\tif (rand) {\r\n\t\t\trand.seed = randomSeeds[16];\r\n\t\t\tif (this.emitFromEdge)\r\n\t\t\t\tShapeUtils._randomPointUnitArcCircle(this.arc, CircleShape._tempPositionPoint, rand);\r\n\t\t\telse\r\n\t\t\t\tShapeUtils._randomPointInsideUnitArcCircle(this.arc, CircleShape._tempPositionPoint, rand);\r\n\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t} else {\r\n\t\t\tif (this.emitFromEdge)\r\n\t\t\t\tShapeUtils._randomPointUnitArcCircle(this.arc, CircleShape._tempPositionPoint);\r\n\t\t\telse\r\n\t\t\t\tShapeUtils._randomPointInsideUnitArcCircle(this.arc, CircleShape._tempPositionPoint);\r\n\t\t}\r\n\r\n\t\tposition.x = -positionPoint.x;\r\n\t\tposition.y = positionPoint.y;\r\n\t\tposition.z = 0;\r\n\r\n\t\tVector3.scale(position, this.radius, position);\r\n\r\n\t\tif (this.randomDirection) {\r\n\t\t\tif (rand) {\r\n\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction, rand);\r\n\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t} else {\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tposition.cloneTo(direction);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param destObject \r\n\t * @override\r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tsuper.cloneTo(destObject);\r\n\t\tvar destShape: CircleShape = (<CircleShape>destObject);\r\n\t\tdestShape.radius = this.radius;\r\n\t\tdestShape.arc = this.arc;\r\n\t\tdestShape.emitFromEdge = this.emitFromEdge;\r\n\t\tdestShape.randomDirection = this.randomDirection;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destShape: CircleShape = new CircleShape();\r\n\t\tthis.cloneTo(destShape);\r\n\t\treturn destShape;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { BaseShape, ParticleSystemShapeType } from \"./BaseShape\";\r\nimport { ShapeUtils } from \"./ShapeUtils\";\r\nimport { BoundBox } from \"../../../../math/BoundBox\"\r\nimport { Rand } from \"../../../../math/Rand\"\r\nimport { Vector2 } from \"../../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>ConeShape</code> \r\n */\r\nexport class ConeShape extends BaseShape {\r\n\t/** @internal */\r\n\tprotected static _tempPositionPoint: Vector2 = new Vector2();\r\n\t/** @internal */\r\n\tprotected static _tempDirectionPoint: Vector2 = new Vector2();\r\n\r\n\t/***/\r\n\tangle: number;\r\n\t/***/\r\n\tradius: number;\r\n\t/***/\r\n\tlength: number;\r\n\t/**,0Base,1BaseShell,2Volume,3VolumeShell*/\r\n\temitType: number;\r\n\r\n\t/**\r\n\t *  <code>ConeShape</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.shapeType = ParticleSystemShapeType.Cone;\r\n\t\tthis.angle = 25.0 / 180.0 * Math.PI;\r\n\t\tthis.radius = 1.0;\r\n\t\tthis.length = 5.0;\r\n\t\tthis.emitType = 0;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * 0-360\r\n\t */\r\n\tset angleDEG(deg: number) {\r\n\t\tthis.angle = deg / 180 * Math.PI;\r\n\t}\r\n\r\n\tget angleDEG(){\r\n\t\treturn this.angle*180/Math.PI;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getShapeBoundBox(boundBox: BoundBox): void {\r\n\t\tconst coneRadius2: number = this.radius + this.length * Math.sin(this.angle);\r\n\t\tconst coneLength: number = this.length * Math.cos(this.angle);\r\n\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.y = -coneRadius2;\r\n\t\tmin.z = 0;\r\n\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.y = coneRadius2;\r\n\t\tmax.z = coneLength;//TODO:\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getSpeedBoundBox(boundBox: BoundBox): void {\r\n\t\tconst sinA: number = Math.sin(this.angle);\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.y = -sinA;\r\n\t\tmin.z = 0;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.y = sinA;\r\n\t\tmax.z = 1;\r\n\t}\r\n\r\n\t/**\r\n\t *  \r\n\t * @param\tposition \r\n\t * @param\tdirection \r\n\t * @override\r\n\t */\r\n\tgeneratePositionAndDirection(position: Vector3, direction: Vector3, rand: Rand = null, randomSeeds: Uint32Array = null): void {\r\n\t\tvar positionPointE: Vector2 = ConeShape._tempPositionPoint;\r\n\t\tvar positionX: number;\r\n\t\tvar positionY: number;\r\n\t\tvar directionPointE: Vector2;\r\n\r\n\t\tvar dirCosA: number = Math.cos(this.angle);\r\n\t\tvar dirSinA: number = Math.sin(this.angle);\r\n\t\tswitch (this.emitType) {\r\n\t\t\tcase 0:\r\n\t\t\t\tif (rand) {\r\n\t\t\t\t\trand.seed = randomSeeds[16];\r\n\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempPositionPoint, rand);\r\n\t\t\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempPositionPoint);\r\n\t\t\t\t}\r\n\t\t\t\tpositionX = positionPointE.x;\r\n\t\t\t\tpositionY = positionPointE.y;\r\n\t\t\t\tposition.x = positionX * this.radius;\r\n\t\t\t\tposition.y = positionY * this.radius;\r\n\t\t\t\tposition.z = 0;\r\n\r\n\t\t\t\tif (this.randomDirection) {\r\n\t\t\t\t\tif (rand) {\r\n\t\t\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempDirectionPoint, rand);\r\n\t\t\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempDirectionPoint);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdirectionPointE = ConeShape._tempDirectionPoint;\r\n\t\t\t\t\tdirection.x = directionPointE.x * dirSinA;\r\n\t\t\t\t\tdirection.y = directionPointE.y * dirSinA;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdirection.x = positionX * dirSinA;\r\n\t\t\t\t\tdirection.y = positionY * dirSinA;\r\n\t\t\t\t}\r\n\t\t\t\tdirection.z = dirCosA;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tif (rand) {\r\n\t\t\t\t\trand.seed = randomSeeds[16];\r\n\t\t\t\t\tShapeUtils._randomPointUnitCircle(ConeShape._tempPositionPoint, rand);\r\n\t\t\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tShapeUtils._randomPointUnitCircle(ConeShape._tempPositionPoint);\r\n\t\t\t\t}\r\n\t\t\t\tpositionX = positionPointE.x;\r\n\t\t\t\tpositionY = positionPointE.y;\r\n\t\t\t\tposition.x = positionX * this.radius;\r\n\t\t\t\tposition.y = positionY * this.radius;\r\n\t\t\t\tposition.z = 0;\r\n\r\n\t\t\t\tif (this.randomDirection) {\r\n\t\t\t\t\tif (rand) {\r\n\t\t\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempDirectionPoint, rand);\r\n\t\t\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempDirectionPoint);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdirectionPointE = ConeShape._tempDirectionPoint;\r\n\t\t\t\t\tdirection.x = directionPointE.x * dirSinA;\r\n\t\t\t\t\tdirection.y = directionPointE.y * dirSinA;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdirection.x = positionX * dirSinA;\r\n\t\t\t\t\tdirection.y = positionY * dirSinA;\r\n\t\t\t\t}\r\n\t\t\t\tdirection.z = dirCosA;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (rand) {\r\n\t\t\t\t\trand.seed = randomSeeds[16];\r\n\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempPositionPoint, rand);\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempPositionPoint);\r\n\t\t\t\t}\r\n\t\t\t\tpositionX = positionPointE.x;\r\n\t\t\t\tpositionY = positionPointE.y;\r\n\t\t\t\tposition.x = positionX * this.radius;\r\n\t\t\t\tposition.y = positionY * this.radius;\r\n\t\t\t\tposition.z = 0;\r\n\r\n\t\t\t\tdirection.x = positionX * dirSinA;\r\n\t\t\t\tdirection.y = positionY * dirSinA;\r\n\t\t\t\tdirection.z = dirCosA;\r\n\r\n\t\t\t\tVector3.normalize(direction, direction);\r\n\t\t\t\tif (rand) {\r\n\t\t\t\t\tVector3.scale(direction, this.length * rand.getFloat(), direction);\r\n\t\t\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tVector3.scale(direction, this.length * Math.random(), direction);\r\n\t\t\t\t}\r\n\t\t\t\tVector3.add(position, direction, position);\r\n\r\n\t\t\t\tif (this.randomDirection) {\r\n\t\t\t\t\tif (rand) {\r\n\t\t\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\t\t\tShapeUtils._randomPointUnitSphere(direction, rand);\r\n\t\t\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tShapeUtils._randomPointUnitSphere(direction);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tif (rand) {\r\n\t\t\t\t\trand.seed = randomSeeds[16];\r\n\t\t\t\t\tShapeUtils._randomPointUnitCircle(ConeShape._tempPositionPoint, rand);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tShapeUtils._randomPointUnitCircle(ConeShape._tempPositionPoint);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpositionX = positionPointE.x;\r\n\t\t\t\tpositionY = positionPointE.y;\r\n\t\t\t\tposition.x = positionX * this.radius;\r\n\t\t\t\tposition.y = positionY * this.radius;\r\n\t\t\t\tposition.z = 0;\r\n\r\n\t\t\t\tdirection.x = positionX * dirSinA;\r\n\t\t\t\tdirection.y = positionY * dirSinA;\r\n\t\t\t\tdirection.z = dirCosA;\r\n\r\n\t\t\t\tVector3.normalize(direction, direction);\r\n\t\t\t\tif (rand) {\r\n\t\t\t\t\tVector3.scale(direction, this.length * rand.getFloat(), direction);\r\n\t\t\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tVector3.scale(direction, this.length * Math.random(), direction);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tVector3.add(position, direction, position);\r\n\r\n\t\t\t\tif (this.randomDirection) {\r\n\t\t\t\t\tif (rand) {\r\n\t\t\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\t\t\tShapeUtils._randomPointUnitSphere(direction, rand);\r\n\t\t\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tShapeUtils._randomPointUnitSphere(direction);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"ConeShape:emitType is invalid.\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tsuper.cloneTo(destObject);\r\n\t\tvar destShape: ConeShape = (<ConeShape>destObject);\r\n\t\tdestShape.angle = this.angle;\r\n\t\tdestShape.radius = this.radius;\r\n\t\tdestShape.length = this.length;\r\n\t\tdestShape.emitType = this.emitType;\r\n\t\tdestShape.randomDirection = this.randomDirection;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destShape: ConeShape = new ConeShape();\r\n\t\tthis.cloneTo(destShape);\r\n\t\treturn destShape;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { BaseShape, ParticleSystemShapeType } from \"./BaseShape\";\r\nimport { ShapeUtils } from \"./ShapeUtils\";\r\nimport { BoundBox } from \"../../../../math/BoundBox\"\r\nimport { Rand } from \"../../../../math/Rand\"\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\n\r\n\r\n/**\r\n * <code>HemisphereShape</code> \r\n */\r\nexport class HemisphereShape extends BaseShape {\r\n\t/***/\r\n\tradius: number;\r\n\t/***/\r\n\temitFromShell: boolean;\r\n\r\n\t/**\r\n\t *  <code>HemisphereShape</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.shapeType = ParticleSystemShapeType.Hemisphere;\r\n\t\tthis.radius = 1.0;\r\n\t\tthis.emitFromShell = false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getShapeBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.y = min.z = -this.radius;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.y = this.radius;\r\n\t\tmax.z = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getSpeedBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.y = -1;\r\n\t\tmin.z = 0;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.y = max.z = 1;\r\n\t}\r\n\r\n\t/**\r\n\t *  \r\n\t * @param\tposition \r\n\t * @param\tdirection \r\n\t * @override\r\n\t */\r\n\tgeneratePositionAndDirection(position: Vector3, direction: Vector3, rand: Rand = null, randomSeeds: Uint32Array = null): void {\r\n\t\tif (rand) {\r\n\t\t\trand.seed = randomSeeds[16];\r\n\t\t\tif (this.emitFromShell)\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(position, rand);\r\n\t\t\telse\r\n\t\t\t\tShapeUtils._randomPointInsideUnitSphere(position, rand);\r\n\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t} else {\r\n\t\t\tif (this.emitFromShell)\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(position);\r\n\t\t\telse\r\n\t\t\t\tShapeUtils._randomPointInsideUnitSphere(position);\r\n\t\t}\r\n\r\n\t\tVector3.scale(position, this.radius, position);\r\n\r\n\t\tvar z: number = position.z;\r\n\t\t(z < 0.0) && (position.z = z * -1.0);\r\n\r\n\t\tif (this.randomDirection) {\r\n\t\t\tif (rand) {\r\n\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction, rand);\r\n\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t} else {\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tposition.cloneTo(direction);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tsuper.cloneTo(destObject);\r\n\t\tvar destShape: HemisphereShape = (<HemisphereShape>destObject);\r\n\t\tdestShape.radius = this.radius;\r\n\t\tdestShape.emitFromShell = this.emitFromShell;\r\n\t\tdestShape.randomDirection = this.randomDirection;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destShape: HemisphereShape = new HemisphereShape();\r\n\t\tthis.cloneTo(destShape);\r\n\t\treturn destShape;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { BaseShape, ParticleSystemShapeType } from \"./BaseShape\";\r\nimport { ShapeUtils } from \"./ShapeUtils\";\r\nimport { BoundBox } from \"../../../../math/BoundBox\"\r\nimport { Rand } from \"../../../../math/Rand\"\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>SphereShape</code> \r\n */\r\nexport class SphereShape extends BaseShape {\r\n\t/***/\r\n\tradius: number;\r\n\t/***/\r\n\temitFromShell: boolean;\r\n\r\n\t/**\r\n\t *  <code>SphereShape</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.shapeType = ParticleSystemShapeType.Sphere;\r\n\t\tthis.radius = 1.0;\r\n\t\tthis.emitFromShell = false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getShapeBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.y = min.z = -this.radius;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.y = max.z = this.radius;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getSpeedBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.y = min.z = -1;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.y = max.z = 1;\r\n\t}\r\n\r\n\t/**\r\n\t *  \r\n\t * @param\tposition \r\n\t * @param\tdirection \r\n\t * @override\r\n\t */\r\n\tgeneratePositionAndDirection(position: Vector3, direction: Vector3, rand: Rand = null, randomSeeds: Uint32Array = null): void {\r\n\t\tif (rand) {\r\n\t\t\trand.seed = randomSeeds[16];\r\n\t\t\tif (this.emitFromShell)\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(position, rand);\r\n\t\t\telse\r\n\t\t\t\tShapeUtils._randomPointInsideUnitSphere(position, rand);\r\n\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t} else {\r\n\t\t\tif (this.emitFromShell)\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(position);\r\n\t\t\telse\r\n\t\t\t\tShapeUtils._randomPointInsideUnitSphere(position);\r\n\t\t}\r\n\r\n\t\tVector3.scale(position, this.radius, position);\r\n\r\n\t\tif (this.randomDirection) {\r\n\t\t\tif (rand) {\r\n\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction, rand);\r\n\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t} else {\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tposition.cloneTo(direction);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tsuper.cloneTo(destObject);\r\n\t\tvar destShape: SphereShape = (<SphereShape>destObject);\r\n\t\tdestShape.radius = this.radius;\r\n\t\tdestShape.emitFromShell = this.emitFromShell;\r\n\t\tdestShape.randomDirection = this.randomDirection;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destShape: SphereShape = new SphereShape();\r\n\t\tthis.cloneTo(destShape);\r\n\t\treturn destShape;\r\n\t}\r\n}\r\n\r\n\r\n","import { GradientSize } from \"./GradientSize\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\n\r\n/**\r\n * <code>SizeOverLifetime</code> \r\n */\r\nexport class SizeOverLifetime implements IClone {\r\n\tprivate _size: GradientSize;\r\n\r\n\t/***/\r\n\tenable: boolean;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget size(): GradientSize {\r\n\t\treturn this._size;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SizeOverLifetime</code> \r\n\t */\r\n\tconstructor(size: GradientSize) {\r\n\t\tthis._size = size;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destSizeOverLifetime: SizeOverLifetime = (<SizeOverLifetime>destObject);\r\n\t\tthis._size.cloneTo(destSizeOverLifetime._size);\r\n\t\tdestSizeOverLifetime.enable = this.enable;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destSize: GradientSize;\r\n\t\tswitch (this._size.type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tif (this._size.separateAxes)\r\n\t\t\t\t\tdestSize = GradientSize.createByGradientSeparate(this._size.gradientX.clone(), this._size.gradientY.clone(), this._size.gradientZ.clone());\r\n\t\t\t\telse\r\n\t\t\t\t\tdestSize = GradientSize.createByGradient(this._size.gradient.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tif (this._size.separateAxes)\r\n\t\t\t\t\tdestSize = GradientSize.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(), this._size.constantMaxSeparate.clone());\r\n\t\t\t\telse\r\n\t\t\t\t\tdestSize = GradientSize.createByRandomTwoConstant(this._size.constantMin, this._size.constantMax);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (this._size.separateAxes)\r\n\t\t\t\t\tdestSize = GradientSize.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(), this._size.gradientYMin.clone(), this._size.gradientZMin.clone(), this._size.gradientXMax.clone(), this._size.gradientYMax.clone(), this._size.gradientZMax.clone());\r\n\t\t\t\telse\r\n\t\t\t\t\tdestSize = GradientSize.createByRandomTwoGradient(this._size.gradientMin.clone(), this._size.gradientMax.clone());\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tvar destSizeOverLifetime: SizeOverLifetime = new SizeOverLifetime(destSize);\r\n\t\tdestSizeOverLifetime.enable = this.enable;\r\n\t\treturn destSizeOverLifetime;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { IClone } from \"../../../../utils/IClone\"\r\n\r\n/**\r\n * <code>StartFrame</code> \r\n */\r\nexport class StartFrame implements IClone {\r\n\t/**\r\n\t *  <code>StartFrame</code> \r\n\t * @param\tconstant  \r\n\t * @return \r\n\t */\r\n\tstatic createByConstant(constant: number = 0): StartFrame {\r\n\t\tvar rotationOverLifetime: StartFrame = new StartFrame();\r\n\t\trotationOverLifetime._type = 0;\r\n\t\trotationOverLifetime._constant = constant;\r\n\t\treturn rotationOverLifetime;\r\n\t}\r\n\r\n\t/**\r\n\t *   <code>StartFrame</code> \r\n\t * @param\tconstantMin \r\n\t * @param\tconstantMax \r\n\t * @return \r\n\t */\r\n\tstatic createByRandomTwoConstant(constantMin: number = 0, constantMax: number = 0): StartFrame {\r\n\t\tvar rotationOverLifetime: StartFrame = new StartFrame();\r\n\t\trotationOverLifetime._type = 1;\r\n\t\trotationOverLifetime._constantMin = constantMin;\r\n\t\trotationOverLifetime._constantMax = constantMax;\r\n\t\treturn rotationOverLifetime;\r\n\t}\r\n\r\n\r\n\tprivate _type: number = 0;\r\n\tprivate _constant: number = 0;\r\n\tprivate _constantMin: number = 0;\r\n\tprivate _constantMax: number = 0;\r\n\r\n\t/**\r\n\t *,01\r\n\t */\r\n\tget type(): number {\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constant(): number {\r\n\t\treturn this._constant;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMin(): number {\r\n\t\treturn this._constantMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMax(): number {\r\n\t\treturn this._constantMax;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>StartFrame,new</code> \r\n\t */\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destStartFrame: StartFrame = (<StartFrame>destObject);\r\n\t\tdestStartFrame._type = this._type;\r\n\t\tdestStartFrame._constant = this._constant;\r\n\t\tdestStartFrame._constantMin = this._constantMin;\r\n\t\tdestStartFrame._constantMax = this._constantMax;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destStartFrame: StartFrame = new StartFrame();\r\n\t\tthis.cloneTo(destStartFrame);\r\n\t\treturn destStartFrame;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { FrameOverTime } from \"./FrameOverTime\";\r\nimport { StartFrame } from \"./StartFrame\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\nimport { Vector2 } from \"../../../../maths/Vector2\";\r\n\r\n/**\r\n * <code>TextureSheetAnimation</code> \r\n */\r\nexport class TextureSheetAnimation implements IClone {\r\n\t/**@internal */\r\n\tprivate _frame: FrameOverTime;\r\n\t/**@internal */\r\n\tprivate _startFrame: StartFrame;\r\n\r\n\t/***/\r\n\ttiles: Vector2;\r\n\t/**,0whole sheet1singal row*/\r\n\ttype: number = 0;\r\n\t/**type1*/\r\n\trandomRow: boolean = false;\r\n\t/**,type1*/\r\n\trowIndex: number = 0;\r\n\t/***/\r\n\tcycles: number = 0;\r\n\t/**UV,0Noting,1Everything,,*/\r\n\tenableUVChannels: number = 0;\r\n\t/***/\r\n\tenable: boolean = false;\r\n\r\n\t/***/\r\n\tget frame(): FrameOverTime {\r\n\t\treturn this._frame;\r\n\t}\r\n\r\n\t/***/\r\n\tget startFrame(): StartFrame {\r\n\t\treturn this._startFrame;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>TextureSheetAnimation</code> \r\n\t * @param frame \r\n\t * @param  startFrame \r\n\t */\r\n\tconstructor(frame: FrameOverTime, startFrame: StartFrame) {\r\n\t\tthis.tiles = new Vector2(1, 1);\r\n\t\tthis.type = 0;\r\n\t\tthis.randomRow = true;\r\n\t\tthis.rowIndex = 0;\r\n\t\tthis.cycles = 1;\r\n\t\tthis.enableUVChannels = 1;//TODO:\r\n\t\tthis._frame = frame;\r\n\t\tthis._startFrame = startFrame;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destTextureSheetAnimation: TextureSheetAnimation = (<TextureSheetAnimation>destObject);\r\n\t\tthis.tiles.cloneTo(destTextureSheetAnimation.tiles);\r\n\t\tdestTextureSheetAnimation.type = this.type;\r\n\t\tdestTextureSheetAnimation.randomRow = this.randomRow;\r\n\t\tdestTextureSheetAnimation.rowIndex = this.rowIndex;\r\n\t\tdestTextureSheetAnimation.cycles = this.cycles;\r\n\t\tdestTextureSheetAnimation.enableUVChannels = this.enableUVChannels;\r\n\t\tdestTextureSheetAnimation.enable = this.enable;\r\n\t\tthis._frame.cloneTo(destTextureSheetAnimation._frame);\r\n\t\tthis._startFrame.cloneTo(destTextureSheetAnimation._startFrame);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destFrame: FrameOverTime;\r\n\t\tswitch (this._frame.type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tdestFrame = FrameOverTime.createByConstant(this._frame.constant);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tdestFrame = FrameOverTime.createByOverTime(this._frame.frameOverTimeData.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tdestFrame = FrameOverTime.createByRandomTwoConstant(this._frame.constantMin, this._frame.constantMax);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tdestFrame = FrameOverTime.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(), this._frame.frameOverTimeDataMax.clone());\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tvar destStartFrame: StartFrame;\r\n\t\tswitch (this._startFrame.type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tdestStartFrame = StartFrame.createByConstant(this._startFrame.constant);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tdestStartFrame = StartFrame.createByRandomTwoConstant(this._startFrame.constantMin, this._startFrame.constantMax);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tvar destTextureSheetAnimation: TextureSheetAnimation = new TextureSheetAnimation(destFrame, destStartFrame);\r\n\t\tthis.cloneTo(destTextureSheetAnimation);\r\n\t\treturn destTextureSheetAnimation;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { IClone } from \"../../../../utils/IClone\";\r\nimport { GradientVelocity } from \"./GradientVelocity\";\r\n\r\n/**\r\n * <code>VelocityOverLifetime</code> \r\n */\r\nexport class VelocityOverLifetime implements IClone {\r\n\t/**@internal */\r\n\tprivate _velocity: GradientVelocity;\r\n\r\n\t/***/\r\n\tenable: boolean = false;\r\n\t/**,0local,1world*/\r\n\tspace: number = 0;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget velocity(): GradientVelocity {\r\n\t\treturn this._velocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>VelocityOverLifetime</code> \r\n\t */\r\n\tconstructor(velocity: GradientVelocity) {\r\n\t\tthis._velocity = velocity;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destVelocityOverLifetime: VelocityOverLifetime = (<VelocityOverLifetime>destObject);\r\n\t\tthis._velocity.cloneTo(destVelocityOverLifetime._velocity);\r\n\t\tdestVelocityOverLifetime.enable = this.enable;\r\n\t\tdestVelocityOverLifetime.space = this.space;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destVelocity: GradientVelocity;\r\n\t\tswitch (this._velocity.type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tdestVelocity = GradientVelocity.createByConstant(this._velocity.constant.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tdestVelocity = GradientVelocity.createByGradient(this._velocity.gradientX.clone(), this._velocity.gradientY.clone(), this._velocity.gradientZ.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tdestVelocity = GradientVelocity.createByRandomTwoConstant(this._velocity.constantMin.clone(), this._velocity.constantMax.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tdestVelocity = GradientVelocity.createByRandomTwoGradient(this._velocity.gradientXMin.clone(), this._velocity.gradientXMax.clone(), this._velocity.gradientYMin.clone(), this._velocity.gradientYMax.clone(), this._velocity.gradientZMin.clone(), this._velocity.gradientZMax.clone());\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tvar destVelocityOverLifetime: VelocityOverLifetime = new VelocityOverLifetime(destVelocity);\r\n\t\tdestVelocityOverLifetime.enable = this.enable;\r\n\t\tdestVelocityOverLifetime.space = this.space;\r\n\t\treturn destVelocityOverLifetime;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","\r\n\r\n/**\r\n * @internal\r\n * @author ...\r\n */\r\nexport class VertexShuriKenParticle {\r\n\t//TODO Attribute\r\n\tstatic PARTICLE_DIRECTIONTIME: number = 0;\r\n\tstatic PARTICLE_POSITION0: number = 1;\r\n\tstatic PARTICLE_COLOR0: number = 2;\r\n\tstatic PARTICLE_TEXTURECOORDINATE0: number = 3;\r\n\tstatic PARTICLE_SHAPEPOSITIONSTARTLIFETIME: number = 4;\r\n\tstatic PARTICLE_CORNERTEXTURECOORDINATE0: number = 5;\r\n\tstatic PARTICLE_STARTCOLOR0: number = 6;\r\n\tstatic PARTICLE_ENDCOLOR0: number = 7;\r\n\tstatic PARTICLE_STARTSIZE: number = 8;\r\n\tstatic PARTICLE_STARTROTATION: number = 9;\r\n\tstatic PARTICLE_STARTSPEED: number = 10;\r\n\tstatic PARTICLE_RANDOM0: number = 11;\r\n\tstatic PARTICLE_RANDOM1: number = 12;\r\n\tstatic PARTICLE_SIMULATIONWORLDPOSTION: number = 13;\r\n\tstatic PARTICLE_SIMULATIONWORLDROTATION: number = 14;\r\n\tstatic PARTICLE_SIMULATIONUV:number = 15;\r\n\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { VertexShuriKenParticle } from \"./VertexShuriKenParticle\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\n\r\n/**\r\n * @internal\r\n * <code>VertexShurikenParticle</code> \r\n */\r\nexport class VertexShurikenParticleBillboard extends VertexShuriKenParticle {\r\n\t/**@internal */\r\n\tprivate static _vertexDeclaration: VertexDeclaration;\r\n\r\n\tstatic get vertexDeclaration(): VertexDeclaration {\r\n\t\treturn VertexShurikenParticleBillboard._vertexDeclaration;\r\n\t}\r\n\r\n\tprivate static _vertexInstanceMeshDeclaration: VertexDeclaration;\r\n\r\n\tstatic get vertexInstanceMeshDeclaration(): VertexDeclaration {\r\n\t\treturn VertexShurikenParticleBillboard._vertexInstanceMeshDeclaration;\r\n\t}\r\n\r\n\tprivate static _vertexInstanceParticleDeclaration: VertexDeclaration;\r\n\r\n\tstatic get vertexInstanceParticleDeclaration(): VertexDeclaration {\r\n\t\treturn VertexShurikenParticleBillboard._vertexInstanceParticleDeclaration;\r\n\t}\r\n\r\n\tprivate static _billboardVertexArray: Float32Array;\r\n\tstatic get billboardVertexArray(): Float32Array {\r\n\t\treturn VertexShurikenParticleBillboard._billboardVertexArray;\r\n\t}\r\n\r\n\tprivate static _billboardIndexArray: Uint16Array;\r\n\tstatic get billboardIndexArray(): Uint16Array {\r\n\t\treturn VertexShurikenParticleBillboard._billboardIndexArray;\r\n\t}\r\n\tstatic set billboardIndexArray(value: Uint16Array) {\r\n\t\tVertexShurikenParticleBillboard._billboardIndexArray = value;\r\n\t}\r\n\r\n\t/**\r\n\t  * @internal\r\n\t  */\r\n\tstatic __init__(): void {\r\n\t\tVertexShurikenParticleBillboard._vertexDeclaration = new VertexDeclaration(168, [\r\n\t\t\tnew VertexElement(0, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_CORNERTEXTURECOORDINATE0),\r\n\t\t\tnew VertexElement(16, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SHAPEPOSITIONSTARTLIFETIME),\r\n\t\t\tnew VertexElement(32, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_DIRECTIONTIME),\r\n\t\t\tnew VertexElement(48, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_STARTCOLOR0),\r\n\t\t\tnew VertexElement(64, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTSIZE),\r\n\t\t\tnew VertexElement(76, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTROTATION),\r\n\t\t\tnew VertexElement(88, VertexElementFormat.Single, VertexShuriKenParticle.PARTICLE_STARTSPEED),\r\n\t\t\tnew VertexElement(92, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM0),\r\n\t\t\tnew VertexElement(108, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM1),\r\n\t\t\tnew VertexElement(124, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDPOSTION),//TODO:local\r\n\t\t\tnew VertexElement(136, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDROTATION),\r\n\t\t\tnew VertexElement(152, VertexElementFormat.Vector4,VertexShuriKenParticle.PARTICLE_SIMULATIONUV)\r\n\t\t]);\r\n\r\n\r\n\t\tVertexShurikenParticleBillboard._vertexInstanceMeshDeclaration = new VertexDeclaration(16, [\r\n\t\t\tnew VertexElement(0, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_CORNERTEXTURECOORDINATE0)\r\n\t\t]);\r\n\r\n\t\tVertexShurikenParticleBillboard._vertexInstanceParticleDeclaration = new VertexDeclaration(152, [\r\n\t\t\tnew VertexElement(0, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SHAPEPOSITIONSTARTLIFETIME),\r\n\t\t\tnew VertexElement(16, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_DIRECTIONTIME),\r\n\t\t\tnew VertexElement(32, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_STARTCOLOR0),\r\n\t\t\tnew VertexElement(48, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTSIZE),\r\n\t\t\tnew VertexElement(60, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTROTATION),\r\n\t\t\tnew VertexElement(72, VertexElementFormat.Single, VertexShuriKenParticle.PARTICLE_STARTSPEED),\r\n\t\t\tnew VertexElement(76, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM0),\r\n\t\t\tnew VertexElement(92, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM1),\r\n\t\t\tnew VertexElement(108, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDPOSTION),//TODO:local\r\n\t\t\tnew VertexElement(120, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDROTATION),\r\n\t\t\tnew VertexElement(136, VertexElementFormat.Vector4,VertexShuriKenParticle.PARTICLE_SIMULATIONUV)\r\n\t\t])\r\n\r\n\t\tVertexShurikenParticleBillboard._billboardIndexArray = new Uint16Array([\r\n\t\t\t0, 2, 1, 0, 3, 2\r\n\t\t]);\r\n\r\n\t\tVertexShurikenParticleBillboard._billboardVertexArray = new Float32Array([\r\n\t\t\t-0.5, -0.5, 0, 1,\r\n\t\t\t0.5, -0.5, 1, 1,\r\n\t\t\t0.5, 0.5, 1, 0,\r\n\t\t\t-0.5, 0.5, 0, 0\r\n\t\t]);\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _cornerTextureCoordinate: Vector4;\r\n\t/**@internal */\r\n\tprivate _positionStartLifeTime: Vector4;\r\n\t/**@internal */\r\n\tprivate _velocity: Vector3;\r\n\t/**@internal */\r\n\tprivate _startColor: Vector4;\r\n\t/**@internal */\r\n\tprivate _startSize: Vector3;\r\n\t/**@internal */\r\n\tprivate _startRotation0: Vector3;\r\n\t/**@internal */\r\n\tprivate _startRotation1: Vector3;\r\n\t/**@internal */\r\n\tprivate _startRotation2: Vector3;\r\n\t/**@internal */\r\n\tprivate _startLifeTime: number;\r\n\t/**@internal */\r\n\tprivate _time: number;\r\n\t/**@internal */\r\n\tprivate _startSpeed: number;\r\n\t/**@internal */\r\n\tprivate _randoms0: Vector4;\r\n\t/**@internal */\r\n\tprivate _randoms1: Vector4;\r\n\t/**@internal */\r\n\tprivate _simulationWorldPostion: Vector3;\r\n\r\n\tget cornerTextureCoordinate(): Vector4 {\r\n\t\treturn this._cornerTextureCoordinate;\r\n\t}\r\n\r\n\tget positionStartLifeTime(): Vector4 {\r\n\t\treturn this._positionStartLifeTime;\r\n\t}\r\n\r\n\tget velocity(): Vector3 {\r\n\t\treturn this._velocity;\r\n\t}\r\n\r\n\tget startColor(): Vector4 {\r\n\t\treturn this._startColor;\r\n\t}\r\n\r\n\tget startSize(): Vector3 {\r\n\t\treturn this._startSize;\r\n\t}\r\n\r\n\tget startRotation0(): Vector3 {\r\n\t\treturn this._startRotation0;\r\n\t}\r\n\r\n\tget startRotation1(): Vector3 {\r\n\t\treturn this._startRotation1;\r\n\t}\r\n\r\n\tget startRotation2(): Vector3 {\r\n\t\treturn this._startRotation2;\r\n\t}\r\n\r\n\tget startLifeTime(): number {\r\n\t\treturn this._startLifeTime;\r\n\t}\r\n\r\n\tget time(): number {\r\n\t\treturn this._time;\r\n\t}\r\n\r\n\tget startSpeed(): number {\r\n\t\treturn this._startSpeed;\r\n\t}\r\n\r\n\tget random0(): Vector4 {\r\n\t\treturn this._randoms0;\r\n\t}\r\n\r\n\tget random1(): Vector4 {\r\n\t\treturn this._randoms1;\r\n\t}\r\n\r\n\tget simulationWorldPostion(): Vector3 {\r\n\t\treturn this._simulationWorldPostion;\r\n\t}\r\n\r\n\tconstructor(cornerTextureCoordinate: Vector4, positionStartLifeTime: Vector4, velocity: Vector3, startColor: Vector4, startSize: Vector3, startRotation0: Vector3, startRotation1: Vector3, startRotation2: Vector3, ageAddScale: number, time: number, startSpeed: number, randoms0: Vector4, randoms1: Vector4, simulationWorldPostion: Vector3) {\r\n\t\tsuper();\r\n\t\tthis._cornerTextureCoordinate = cornerTextureCoordinate;\r\n\t\tthis._positionStartLifeTime = positionStartLifeTime;\r\n\t\tthis._velocity = velocity;\r\n\t\tthis._startColor = startColor;\r\n\t\tthis._startSize = startSize;\r\n\t\tthis._startRotation0 = startRotation0;\r\n\t\tthis._startRotation1 = startRotation1;\r\n\t\tthis._startRotation2 = startRotation2;\r\n\t\tthis._startLifeTime = ageAddScale;\r\n\t\tthis._time = time;\r\n\t\tthis._startSpeed = startSpeed;\r\n\t\tthis._randoms0 = randoms0;\r\n\t\tthis._randoms1 = randoms1;\r\n\t\tthis._simulationWorldPostion = simulationWorldPostion;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { VertexShuriKenParticle } from \"./VertexShuriKenParticle\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\n\r\n/**\r\n * @internal\r\n * <code>VertexShurikenParticle</code> \r\n */\r\nexport class VertexShurikenParticleMesh extends VertexShuriKenParticle {\r\n\t/**@internal */\r\n\tprivate static _vertexDeclaration: VertexDeclaration;\r\n\r\n\t/**\r\n  * @internal\r\n  */\r\n\tstatic __init__(): void {\r\n\t\tVertexShurikenParticleMesh._vertexDeclaration = new VertexDeclaration(188, [new VertexElement(0, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_POSITION0),\r\n\t\tnew VertexElement(12, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_COLOR0),\r\n\t\tnew VertexElement(28, VertexElementFormat.Vector2, VertexShuriKenParticle.PARTICLE_TEXTURECOORDINATE0),\r\n\t\tnew VertexElement(36, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SHAPEPOSITIONSTARTLIFETIME),\r\n\t\tnew VertexElement(52, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_DIRECTIONTIME),\r\n\t\tnew VertexElement(68, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_STARTCOLOR0),\r\n\t\tnew VertexElement(84, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTSIZE),\r\n\t\tnew VertexElement(96, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTROTATION),\r\n\t\tnew VertexElement(108, VertexElementFormat.Single, VertexShuriKenParticle.PARTICLE_STARTSPEED),\r\n\t\tnew VertexElement(112, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM0),\r\n\t\tnew VertexElement(128, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM1),\r\n\t\tnew VertexElement(144, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDPOSTION),//TODO:local\r\n\t\tnew VertexElement(156, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDROTATION),\r\n\t\tnew VertexElement(172,VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SIMULATIONUV)]);\r\n\t\t\r\n\t\t\r\n\t\tVertexShurikenParticleMesh._vertexInstanceMeshDeclaration = new VertexDeclaration(36, [\r\n\t\t\tnew VertexElement(0, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_POSITION0),\r\n\t\t\tnew VertexElement(12, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_COLOR0),\r\n\t\t\tnew VertexElement(28, VertexElementFormat.Vector2, VertexShuriKenParticle.PARTICLE_TEXTURECOORDINATE0)\r\n\t\t]);\r\n\r\n\t\tVertexShurikenParticleMesh._vertexInstanceParticleDeclaration = new VertexDeclaration(152, [\r\n\t\t\tnew VertexElement(0, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SHAPEPOSITIONSTARTLIFETIME),\r\n\t\t\tnew VertexElement(16, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_DIRECTIONTIME),\r\n\t\t\tnew VertexElement(32, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_STARTCOLOR0),\r\n\t\t\tnew VertexElement(48, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTSIZE),\r\n\t\t\tnew VertexElement(60, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTROTATION),\r\n\t\t\tnew VertexElement(72, VertexElementFormat.Single, VertexShuriKenParticle.PARTICLE_STARTSPEED),\r\n\t\t\tnew VertexElement(76, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM0),\r\n\t\t\tnew VertexElement(92, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM1),\r\n\t\t\tnew VertexElement(108, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDPOSTION),//TODO:local\r\n\t\t\tnew VertexElement(120, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDROTATION),\r\n\t\t\tnew VertexElement(136,VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SIMULATIONUV)\r\n\t\t]);\r\n\t}\r\n\r\n\tstatic get vertexDeclaration(): VertexDeclaration {\r\n\t\treturn VertexShurikenParticleMesh._vertexDeclaration;\r\n\t}\r\n\r\n\tprivate static _vertexInstanceMeshDeclaration: VertexDeclaration;\r\n\tstatic get vertexInstanceMeshDeclaration(): VertexDeclaration {\r\n\t\treturn VertexShurikenParticleMesh._vertexInstanceMeshDeclaration;\r\n\t}\r\n\r\n\tprivate static _vertexInstanceParticleDeclaration: VertexDeclaration;\r\n\tstatic get vertexInstanceParticleDeclaration(): VertexDeclaration {\r\n\t\treturn VertexShurikenParticleMesh._vertexInstanceParticleDeclaration;\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _cornerTextureCoordinate: Vector4;\r\n\t/**@internal */\r\n\tprivate _positionStartLifeTime: Vector4;\r\n\t/**@internal */\r\n\tprivate _velocity: Vector3;\r\n\t/**@internal */\r\n\tprivate _startColor: Vector4;\r\n\t/**@internal */\r\n\tprivate _startSize: Vector3;\r\n\t/**@internal */\r\n\tprivate _startRotation0: Vector3;\r\n\t/**@internal */\r\n\tprivate _startRotation1: Vector3;\r\n\t/**@internal */\r\n\tprivate _startRotation2: Vector3;\r\n\t/**@internal */\r\n\tprivate _startLifeTime: number;\r\n\t/**@internal */\r\n\tprivate _time: number;\r\n\t/**@internal */\r\n\tprivate _startSpeed: number;\r\n\t/**@internal */\r\n\tprivate _randoms0: Vector4;\r\n\t/**@internal */\r\n\tprivate _randoms1: Vector4;\r\n\t/**@internal */\r\n\tprivate _simulationWorldPostion: Vector3;\r\n\r\n\tget cornerTextureCoordinate(): Vector4 {\r\n\t\treturn this._cornerTextureCoordinate;\r\n\t}\r\n\r\n\tget position(): Vector4 {\r\n\t\treturn this._positionStartLifeTime;\r\n\t}\r\n\r\n\tget velocity(): Vector3 {\r\n\t\treturn this._velocity;\r\n\t}\r\n\r\n\tget startColor(): Vector4 {\r\n\t\treturn this._startColor;\r\n\t}\r\n\r\n\tget startSize(): Vector3 {\r\n\t\treturn this._startSize;\r\n\t}\r\n\r\n\tget startRotation0(): Vector3 {\r\n\t\treturn this._startRotation0;\r\n\t}\r\n\r\n\tget startRotation1(): Vector3 {\r\n\t\treturn this._startRotation1;\r\n\t}\r\n\r\n\tget startRotation2(): Vector3 {\r\n\t\treturn this._startRotation2;\r\n\t}\r\n\r\n\tget startLifeTime(): number {\r\n\t\treturn this._startLifeTime;\r\n\t}\r\n\r\n\tget time(): number {\r\n\t\treturn this._time;\r\n\t}\r\n\r\n\tget startSpeed(): number {\r\n\t\treturn this._startSpeed;\r\n\t}\r\n\r\n\tget random0(): Vector4 {\r\n\t\treturn this._randoms0;\r\n\t}\r\n\r\n\tget random1(): Vector4 {\r\n\t\treturn this._randoms1;\r\n\t}\r\n\r\n\tget simulationWorldPostion(): Vector3 {\r\n\t\treturn this._simulationWorldPostion;\r\n\t}\r\n\r\n\tconstructor(cornerTextureCoordinate: Vector4, positionStartLifeTime: Vector4, velocity: Vector3, startColor: Vector4, startSize: Vector3, startRotation0: Vector3, startRotation1: Vector3, startRotation2: Vector3, ageAddScale: number, time: number, startSpeed: number, randoms0: Vector4, randoms1: Vector4, simulationWorldPostion: Vector3) {\r\n\t\tsuper();\r\n\t\tthis._cornerTextureCoordinate = cornerTextureCoordinate;\r\n\t\tthis._positionStartLifeTime = positionStartLifeTime;\r\n\t\tthis._velocity = velocity;\r\n\t\tthis._startColor = startColor;\r\n\t\tthis._startSize = startSize;\r\n\t\tthis._startRotation0 = startRotation0;\r\n\t\tthis._startRotation1 = startRotation1;\r\n\t\tthis._startRotation2 = startRotation2;\r\n\t\tthis._startLifeTime = ageAddScale;\r\n\t\tthis._time = time;\r\n\t\tthis._startSpeed = startSpeed;\r\n\t\tthis._randoms0 = randoms0;\r\n\t\tthis._randoms1 = randoms1;\r\n\t\tthis._simulationWorldPostion = simulationWorldPostion;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","/**\r\n\t * <code>Rand</code> 32\r\n\t */\r\nexport class Rand {\r\n\t/**\r\n\t * 3232\r\n\t * @param 32\r\n\t * @return 32\r\n\t */\r\n\tstatic getFloatFromInt(v: number): number {\r\n\t\t// take 23 bits of integer, and divide by 2^23-1\r\n\t\treturn (v & 0x007FFFFF) * (1.0 / 8388607.0)\r\n\t}\r\n\r\n\t/**\r\n\t * 328\r\n\t * @param 32\r\n\t * @return 8\r\n\t */\r\n\tstatic getByteFromInt(v: number): number {//TODO\r\n\t\t// take the most significant byte from the 23-bit value\r\n\t\treturn (v & 0x007FFFFF) >>> 15/*(23-8)*/;\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _temp: Uint32Array = new Uint32Array(1);\r\n\r\n\t/***/\r\n\tseeds: Uint32Array = new Uint32Array(4);\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget seed(): number {\r\n\t\treturn this.seeds[0];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tseed \r\n\t */\r\n\tset seed(seed: number) {\r\n\t\tthis.seeds[0] = seed;\r\n\t\tthis.seeds[1] = this.seeds[0] * 0x6C078965/*1812433253U*/ + 1;\r\n\t\tthis.seeds[2] = this.seeds[1] * 0x6C078965/*1812433253U*/ + 1;\r\n\t\tthis.seeds[3] = this.seeds[2] * 0x6C078965/*1812433253U*/ + 1;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Rand</code> \r\n\t * @param\tseed  32\r\n\t */\r\n\tconstructor(seed: number) {\r\n\t\tthis.seeds[0] = seed;\r\n\t\tthis.seeds[1] = this.seeds[0] * 0x6C078965/*1812433253U*/ + 1;\r\n\t\tthis.seeds[2] = this.seeds[1] * 0x6C078965/*1812433253U*/ + 1;\r\n\t\tthis.seeds[3] = this.seeds[2] * 0x6C078965/*1812433253U*/ + 1;\r\n\t}\r\n\r\n\t/**\r\n\t * 32\r\n\t * @return 32\r\n\t */\r\n\tgetUint(): number {\r\n\t\tthis._temp[0] = this.seeds[0] ^ (this.seeds[0] << 11);\r\n\t\tthis.seeds[0] = this.seeds[1];\r\n\t\tthis.seeds[1] = this.seeds[2];\r\n\t\tthis.seeds[2] = this.seeds[3];\r\n\t\tthis.seeds[3] = (this.seeds[3] ^ (this.seeds[3] >>> 19)) ^ (this._temp[0] ^ (this._temp[0] >>> 8));\r\n\t\treturn this.seeds[3];\r\n\t}\r\n\r\n\t/**\r\n\t * 01\r\n\t * @return 01\r\n\t */\r\n\tgetFloat(): number {\r\n\t\tthis.getUint();\r\n\t\treturn (this.seeds[3] & 0x007FFFFF) * (1.0 / 8388607.0);\r\n\t}\r\n\r\n\t/**\r\n\t * -11\r\n\t * @return -11\r\n\t */\r\n\tgetSignedFloat(): number {\r\n\t\treturn this.getFloat() * 2.0 - 1.0;\r\n\t}\r\n\r\n}\r\n\r\n","import { IClone } from \"../../../../utils/IClone\";\r\nimport { Burst } from \"./Burst\";\r\n\r\n/**\r\n * <code>Emission</code> \r\n */\r\nexport class Emission implements IClone {\r\n\t/** @internal */\r\n\tprivate _destroyed: boolean;\r\n\t/** @internal */\r\n\tprivate _emissionRate: number = 10;\r\n\r\n\tprivate _emissionRateOverDistance: number = 0;\r\n\r\n\t/**@internal ,*/\r\n\t_bursts: Burst[];\r\n\r\n\t/***/\r\n\tenable: boolean;\r\n\r\n\t/**\r\n\t * \r\n\t * @param emissionRate  (/)\r\n\t */\r\n\tset emissionRate(value: number) {\r\n\t\tif (value < 0)\r\n\t\t\tthrow new Error(\"ParticleBaseShape:emissionRate value must large or equal than 0.\");\r\n\t\tthis._emissionRate = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return  (/)\r\n\t */\r\n\tget emissionRate(): number {\r\n\t\treturn this._emissionRate;\r\n\t}\r\n\r\n\tget emissionRateOverDistance(): number {\r\n\t\treturn this._emissionRateOverDistance;\r\n\t}\r\n\r\n\tset emissionRateOverDistance(value: number) {\r\n\t\tvalue = Math.max(0, value);\r\n\t\tthis._emissionRateOverDistance = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget destroyed(): boolean {\r\n\t\treturn this._destroyed;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Emission</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tthis._destroyed = false;\r\n\t\tthis._bursts = [];\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tdestroy(): void {\r\n\t\tthis._bursts = null;\r\n\t\tthis._destroyed = true;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tgetBurstsCount(): number {\r\n\t\treturn this._bursts.length;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param index \r\n\t * @return \r\n\t */\r\n\tgetBurstByIndex(index: number): Burst {\r\n\t\treturn this._bursts[index];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param burst \r\n\t */\r\n\taddBurst(burst: Burst): void {\r\n\t\tvar burstsCount: number = this._bursts.length;\r\n\t\tif (burstsCount > 0)\r\n\t\t\tfor (var i: number = 0; i < burstsCount; i++) {\r\n\t\t\t\tif (this._bursts[i].time > burst.time)\r\n\t\t\t\t\tthis._bursts.splice(i, 0, burst);\r\n\t\t\t}\r\n\t\tthis._bursts.push(burst);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param burst \r\n\t */\r\n\tremoveBurst(burst: Burst): void {\r\n\t\tvar index: number = this._bursts.indexOf(burst);\r\n\t\tif (index !== -1) {\r\n\t\t\tthis._bursts.splice(index, 1);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param index \r\n\t */\r\n\tremoveBurstByIndex(index: number): void {\r\n\t\tthis._bursts.splice(index, 1);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tclearBurst(): void {\r\n\t\tthis._bursts.length = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destEmission: Emission = (<Emission>destObject);\r\n\r\n\t\tvar destBursts: Burst[] = destEmission._bursts;\r\n\t\tdestBursts.length = this._bursts.length;\r\n\t\tfor (var i: number = 0, n: number = this._bursts.length; i < n; i++) {\r\n\t\t\tvar destBurst: Burst = destBursts[i];\r\n\t\t\tif (destBurst)\r\n\t\t\t\tthis._bursts[i].cloneTo(destBurst);\r\n\t\t\telse\r\n\t\t\t\tdestBursts[i] = this._bursts[i].clone();\r\n\t\t}\r\n\r\n\t\tdestEmission._emissionRate = this._emissionRate;\r\n\t\tdestEmission._emissionRateOverDistance = this._emissionRateOverDistance;\r\n\t\tdestEmission.enable = this.enable;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destEmission: Emission = new Emission();\r\n\t\tthis.cloneTo(destEmission);\r\n\t\treturn destEmission;\r\n\t}\r\n}\r\n\r\n\r\n","import { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class ShuriKenParticle3DShaderDeclaration {\r\n\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_RENDERMODE_BILLBOARD: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_COLORKEYCOUNT_8: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_COLOROVERLIFETIME: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_RANDOMCOLOROVERLIFETIME: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_VELOCITYOVERLIFETIMECURVE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_TEXTURESHEETANIMATIONCURVE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ROTATIONOVERLIFETIME: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ROTATIONOVERLIFETIMECURVE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SIZEOVERLIFETIMECURVE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_RENDERMODE_MESH: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHAPE: ShaderDefine;\r\n\r\n\r\n\t//Base\r\n\t/**@internal */\r\n\tstatic WORLDPOSITION: number;\r\n\t/**@internal */\r\n\tstatic WORLDROTATION: number;\r\n\t/**@internal */\r\n\tstatic POSITIONSCALE: number;\r\n\t/**@internal */\r\n\tstatic SIZESCALE: number;\r\n\t/**@internal */\r\n\tstatic SCALINGMODE: number;\r\n\t/**@internal */\r\n\tstatic GRAVITY: number;\r\n\t/**@internal */\r\n\tstatic THREEDSTARTROTATION: number;\r\n\t/**@internal */\r\n\tstatic STRETCHEDBILLBOARDLENGTHSCALE: number;\r\n\t/**@internal */\r\n\tstatic STRETCHEDBILLBOARDSPEEDSCALE: number;\r\n\t/**@internal */\r\n\tstatic SIMULATIONSPACE: number;\r\n\t/**@internal */\r\n\tstatic CURRENTTIME: number;\r\n\t/**@internal */\r\n\tstatic DRAG: number;\r\n\r\n\t//VelocityOverLifetime\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYCONST: number;\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYGRADIENTX: number;\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYGRADIENTY: number;\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYGRADIENTZ: number;\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYCONSTMAX: number;\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYGRADIENTXMAX: number;\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYGRADIENTYMAX: number;\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYGRADIENTZMAX: number;\r\n\t/**@internal */\r\n\tstatic VOLSPACETYPE: number;\r\n\r\n\t//ColorOverLifetime\r\n\t/**@internal */\r\n\tstatic COLOROVERLIFEGRADIENTALPHAS: number;\r\n\t/**@internal */\r\n\tstatic COLOROVERLIFEGRADIENTCOLORS: number;\r\n\t/**@internal */\r\n\tstatic COLOROVERLIFEGRADIENTRANGES: number;\r\n\t/**@internal */\r\n\tstatic MAXCOLOROVERLIFEGRADIENTALPHAS: number;\r\n\t/**@internal */\r\n\tstatic MAXCOLOROVERLIFEGRADIENTCOLORS: number;\r\n\t/**@internal */\r\n\tstatic MAXCOLOROVERLIFEGRADIENTRANGES: number;\r\n\r\n\t//SizeOverLifetime\r\n\t/**@internal */\r\n\tstatic SOLSIZEGRADIENT: number;\r\n\t/**@internal */\r\n\tstatic SOLSIZEGRADIENTX: number;\r\n\t/**@internal */\r\n\tstatic SOLSIZEGRADIENTY: number;\r\n\t/**@internal */\r\n\tstatic SOLSizeGradientZ: number;\r\n\t/**@internal */\r\n\tstatic SOLSizeGradientMax: number;\r\n\t/**@internal */\r\n\tstatic SOLSIZEGRADIENTXMAX: number;\r\n\t/**@internal */\r\n\tstatic SOLSIZEGRADIENTYMAX: number;\r\n\t/**@internal */\r\n\tstatic SOLSizeGradientZMAX: number;\r\n\r\n\t//RotationOverLifetime\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYCONST: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYCONSTSEPRARATE: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENT: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTX: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTY: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTZ: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYCONSTMAX: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYCONSTMAXSEPRARATE: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTMAX: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTXMAX: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTYMAX: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTZMAX: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTWMAX: number;\r\n\r\n\t//TextureSheetAnimation\r\n\t/**@internal */\r\n\tstatic TEXTURESHEETANIMATIONCYCLES: number;\r\n\t/**@internal */\r\n\tstatic TEXTURESHEETANIMATIONSUBUVLENGTH: number;\r\n\t/**@internal */\r\n\tstatic TEXTURESHEETANIMATIONGRADIENTUVS: number;\r\n\t/**@internal */\r\n\tstatic TEXTURESHEETANIMATIONGRADIENTMAXUVS: number;\r\n\r\n\r\n\t/**\r\n\t * init\r\n\t */\r\n\tstatic __init__() {\r\n\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_BILLBOARD = Shader3D.getDefineByName(\"SPHERHBILLBOARD\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD = Shader3D.getDefineByName(\"STRETCHEDBILLBOARD\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD = Shader3D.getDefineByName(\"HORIZONTALBILLBOARD\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD = Shader3D.getDefineByName(\"VERTICALBILLBOARD\");\r\n\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLORKEYCOUNT_8 = Shader3D.getDefineByName(\"COLORKEYCOUNT_8\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLOROVERLIFETIME = Shader3D.getDefineByName(\"COLOROVERLIFETIME\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RANDOMCOLOROVERLIFETIME = Shader3D.getDefineByName(\"RANDOMCOLOROVERLIFETIME\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT = Shader3D.getDefineByName(\"VELOCITYOVERLIFETIMECONSTANT\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE = Shader3D.getDefineByName(\"VELOCITYOVERLIFETIMECURVE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT = Shader3D.getDefineByName(\"VELOCITYOVERLIFETIMERANDOMCONSTANT\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE = Shader3D.getDefineByName(\"VELOCITYOVERLIFETIMERANDOMCURVE\");\r\n\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE = Shader3D.getDefineByName(\"TEXTURESHEETANIMATIONCURVE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE = Shader3D.getDefineByName(\"TEXTURESHEETANIMATIONRANDOMCURVE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIME = Shader3D.getDefineByName(\"ROTATIONOVERLIFETIME\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE = Shader3D.getDefineByName(\"ROTATIONOVERLIFETIMESEPERATE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT = Shader3D.getDefineByName(\"ROTATIONOVERLIFETIMECONSTANT\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE = Shader3D.getDefineByName(\"ROTATIONOVERLIFETIMECURVE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS = Shader3D.getDefineByName(\"ROTATIONOVERLIFETIMERANDOMCONSTANTS\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES = Shader3D.getDefineByName(\"ROTATIONOVERLIFETIMERANDOMCURVES\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMECURVE = Shader3D.getDefineByName(\"SIZEOVERLIFETIMECURVE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE = Shader3D.getDefineByName(\"SIZEOVERLIFETIMECURVESEPERATE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES = Shader3D.getDefineByName(\"SIZEOVERLIFETIMERANDOMCURVES\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE = Shader3D.getDefineByName(\"SIZEOVERLIFETIMERANDOMCURVESSEPERATE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_MESH = Shader3D.getDefineByName(\"RENDERMODE_MESH\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SHAPE = Shader3D.getDefineByName(\"SHAPE\");\r\n\r\n\r\n\r\n\t\t//Base\r\n\t\tShuriKenParticle3DShaderDeclaration.WORLDPOSITION = Shader3D.propertyNameToID(\"u_WorldPosition\");\r\n\t\tShuriKenParticle3DShaderDeclaration.WORLDROTATION = Shader3D.propertyNameToID(\"u_WorldRotation\");\r\n\t\tShuriKenParticle3DShaderDeclaration.POSITIONSCALE = Shader3D.propertyNameToID(\"u_PositionScale\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SIZESCALE = Shader3D.propertyNameToID(\"u_SizeScale\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SCALINGMODE = Shader3D.propertyNameToID(\"u_ScalingMode\");\r\n\t\tShuriKenParticle3DShaderDeclaration.GRAVITY = Shader3D.propertyNameToID(\"u_Gravity\");\r\n\t\tShuriKenParticle3DShaderDeclaration.THREEDSTARTROTATION = Shader3D.propertyNameToID(\"u_ThreeDStartRotation\");\r\n\t\tShuriKenParticle3DShaderDeclaration.STRETCHEDBILLBOARDLENGTHSCALE = Shader3D.propertyNameToID(\"u_StretchedBillboardLengthScale\");\r\n\t\tShuriKenParticle3DShaderDeclaration.STRETCHEDBILLBOARDSPEEDSCALE = Shader3D.propertyNameToID(\"u_StretchedBillboardSpeedScale\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SIMULATIONSPACE = Shader3D.propertyNameToID(\"u_SimulationSpace\");\r\n\t\tShuriKenParticle3DShaderDeclaration.CURRENTTIME = Shader3D.propertyNameToID(\"u_CurrentTime\");\r\n\t\tShuriKenParticle3DShaderDeclaration.DRAG = Shader3D.propertyNameToID(\"u_DragConstanct\");\r\n\r\n\t\t//VelocityOverLifetime\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYCONST = Shader3D.propertyNameToID(\"u_VOLVelocityConst\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTX = Shader3D.propertyNameToID(\"u_VOLVelocityGradientX\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTY = Shader3D.propertyNameToID(\"u_VOLVelocityGradientY\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTZ = Shader3D.propertyNameToID(\"u_VOLVelocityGradientZ\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYCONSTMAX = Shader3D.propertyNameToID(\"u_VOLVelocityConstMax\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTXMAX = Shader3D.propertyNameToID(\"u_VOLVelocityGradientMaxX\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTYMAX = Shader3D.propertyNameToID(\"u_VOLVelocityGradientMaxY\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTZMAX = Shader3D.propertyNameToID(\"u_VOLVelocityGradientMaxZ\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLSPACETYPE = Shader3D.propertyNameToID(\"u_VOLSpaceType\");\r\n\r\n\t\t//ColorOverLifetime\r\n\t\tShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTALPHAS = Shader3D.propertyNameToID(\"u_ColorOverLifeGradientAlphas\");\r\n\t\tShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTCOLORS = Shader3D.propertyNameToID(\"u_ColorOverLifeGradientColors\");\r\n\t\tShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTRANGES = Shader3D.propertyNameToID(\"u_ColorOverLifeGradientRanges\");\r\n\t\tShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTALPHAS = Shader3D.propertyNameToID(\"u_MaxColorOverLifeGradientAlphas\");\r\n\t\tShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTCOLORS = Shader3D.propertyNameToID(\"u_MaxColorOverLifeGradientColors\");\r\n\t\tShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTRANGES = Shader3D.propertyNameToID(\"u_MaxColorOverLifeGradientRanges\");\r\n\r\n\t\t//SizeOverLifetime\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENT = Shader3D.propertyNameToID(\"u_SOLSizeGradient\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTX = Shader3D.propertyNameToID(\"u_SOLSizeGradientX\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTY = Shader3D.propertyNameToID(\"u_SOLSizeGradientY\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSizeGradientZ = Shader3D.propertyNameToID(\"u_SOLSizeGradientZ\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSizeGradientMax = Shader3D.propertyNameToID(\"u_SOLSizeGradientMax\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTXMAX = Shader3D.propertyNameToID(\"u_SOLSizeGradientMaxX\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTYMAX = Shader3D.propertyNameToID(\"u_SOLSizeGradientMaxY\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSizeGradientZMAX = Shader3D.propertyNameToID(\"u_SOLSizeGradientMaxZ\");\r\n\r\n\t\t//RotationOverLifetime\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONST = Shader3D.propertyNameToID(\"u_ROLAngularVelocityConst\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTSEPRARATE = Shader3D.propertyNameToID(\"u_ROLAngularVelocityConstSeprarate\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENT = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradient\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTX = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientX\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTY = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientY\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTZ = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientZ\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTMAX = Shader3D.propertyNameToID(\"u_ROLAngularVelocityConstMax\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTMAXSEPRARATE = Shader3D.propertyNameToID(\"u_ROLAngularVelocityConstMaxSeprarate\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTMAX = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientMax\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTXMAX = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientMaxX\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTYMAX = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientMaxY\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTZMAX = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientMaxZ\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTWMAX = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientMaxW\");\r\n\r\n\t\t//TextureSheetAnimation\r\n\t\tShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONCYCLES = Shader3D.propertyNameToID(\"u_TSACycles\");\r\n\t\tShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONSUBUVLENGTH = Shader3D.propertyNameToID(\"u_TSASubUVLength\");\r\n\t\tShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONGRADIENTUVS = Shader3D.propertyNameToID(\"u_TSAGradientUVs\");\r\n\t\tShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONGRADIENTMAXUVS = Shader3D.propertyNameToID(\"u_TSAMaxGradientUVs\");\r\n\r\n\r\n\r\n\r\n\t\tlet uniformMap = LayaGL.renderOBJCreate.createGlobalUniformMap(\"ShurikenSprite3D\");\r\n\t\t//TODO\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.WORLDPOSITION, 'u_WorldPosition',ShaderDataType.Vector3),\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.WORLDROTATION, 'u_WorldRotation',ShaderDataType.Vector4);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.POSITIONSCALE, 'u_PositionScale',ShaderDataType.Vector3);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SIZESCALE, 'u_SizeScale',ShaderDataType.Vector3);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SCALINGMODE, 'u_ScalingMode',ShaderDataType.Int);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.GRAVITY, 'u_Gravity',ShaderDataType.Vector3);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.THREEDSTARTROTATION, 'u_ThreeDStartRotation',ShaderDataType.Bool);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.STRETCHEDBILLBOARDLENGTHSCALE, 'u_StretchedBillboardLengthScale',ShaderDataType.Float);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.STRETCHEDBILLBOARDSPEEDSCALE, 'u_StretchedBillboardSpeedScale',ShaderDataType.Float);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SIMULATIONSPACE, 'u_SimulationSpace',ShaderDataType.Int);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.CURRENTTIME, 'u_CurrentTime',ShaderDataType.Vector2);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTALPHAS, 'u_ColorOverLifeGradientAlphas',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTCOLORS, 'u_ColorOverLifeGradientColors',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTRANGES, 'u_ColorOverLifeGradientRanges',ShaderDataType.Vector4);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTALPHAS, 'u_MaxColorOverLifeGradientAlphas',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTCOLORS, 'u_MaxColorOverLifeGradientColors',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTRANGES, 'u_MaxColorOverLifeGradientRanges',ShaderDataType.Vector4);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYCONST, 'u_VOLVelocityConst',ShaderDataType.Vector3);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTX, 'u_VOLVelocityGradientX',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTY, 'u_VOLVelocityGradientY',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTZ, 'u_VOLVelocityGradientZ',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYCONSTMAX, 'u_VOLVelocityConstMax',ShaderDataType.Vector3);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTXMAX, 'u_VOLVelocityGradientMaxX',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTYMAX, 'u_VOLVelocityGradientMaxY',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTZMAX, 'u_VOLVelocityGradientMaxZ',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLSPACETYPE, 'u_VOLSpaceType',ShaderDataType.Int);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENT, 'u_SOLSizeGradient',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTX, 'u_SOLSizeGradientX',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTY, 'u_SOLSizeGradientY',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSizeGradientZ, 'u_SOLSizeGradientZ',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSizeGradientMax, 'u_SOLSizeGradientMax',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTXMAX, 'u_SOLSizeGradientMaxX',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTYMAX, 'u_SOLSizeGradientMaxY',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSizeGradientZMAX, 'u_SOLSizeGradientMaxZ',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONST, 'u_ROLAngularVelocityConst',ShaderDataType.Float);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTSEPRARATE, 'u_ROLAngularVelocityConstSeprarate',ShaderDataType.Vector3);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENT, 'u_ROLAngularVelocityGradient',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTX, 'u_ROLAngularVelocityGradientX',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTY, 'u_ROLAngularVelocityGradientY',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTZ, 'u_ROLAngularVelocityGradientZ',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTMAX, 'u_ROLAngularVelocityConstMax',ShaderDataType.Float);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTMAXSEPRARATE, 'u_ROLAngularVelocityConstMaxSeprarate',ShaderDataType.Vector3);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTMAX, 'u_ROLAngularVelocityGradientMax',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTXMAX, 'u_ROLAngularVelocityGradientMaxX',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTYMAX, 'u_ROLAngularVelocityGradientMaxY',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTZMAX, 'u_ROLAngularVelocityGradientMaxZ',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTWMAX, 'u_ROLAngularVelocityGradientMaxW',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONCYCLES, 'u_TSACycles',ShaderDataType.Float);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONSUBUVLENGTH, 'u_TSASubUVLength',ShaderDataType.Vector2);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONGRADIENTUVS, 'u_TSAGradientUVs',ShaderDataType.Vector2);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONGRADIENTMAXUVS, 'u_TSAMaxGradientUVs',ShaderDataType.Vector2);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.DRAG, 'u_DragConstanct',ShaderDataType.Vector2);\r\n\t}\r\n}","import { MathUtil } from \"../../../maths/MathUtil\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { Rand } from \"../../math/Rand\";\r\nimport { ColorOverLifetime } from \"./module/ColorOverLifetime\";\r\nimport { FrameOverTime } from \"./module/FrameOverTime\";\r\nimport { GradientColor } from \"./module/GradientColor\";\r\nimport { GradientDataNumber } from \"./module/GradientDataNumber\";\r\nimport { GradientSize } from \"./module/GradientSize\";\r\nimport { SizeOverLifetime } from \"./module/SizeOverLifetime\";\r\nimport { StartFrame } from \"./module/StartFrame\";\r\nimport { TextureSheetAnimation } from \"./module/TextureSheetAnimation\";\r\nimport { ShurikenParticleRenderer } from \"./ShurikenParticleRenderer\";\r\nimport { ShurikenParticleSystem } from \"./ShurikenParticleSystem\";\r\n\r\n/**\r\n *  @internal\r\n */\r\nexport class ShurikenParticleData {\r\n\t/**@internal */\r\n\tprivate static _tempVector30: Vector3 = new Vector3();\r\n\r\n\tstatic startLifeTime: number;\r\n\tstatic startColor: Vector4 = new Vector4();\r\n\tstatic startSize: Float32Array = new Float32Array(3);\r\n\tstatic startRotation: Float32Array = new Float32Array(3);\r\n\tstatic startUVInfo: Float32Array = new Float32Array(4);\r\n\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static _getStartLifetimeFromGradient(startLifeTimeGradient: GradientDataNumber, emissionTime: number): number {\r\n\t\tfor (var i: number = 1, n: number = startLifeTimeGradient.gradientCount; i < n; i++) {\r\n\t\t\tvar key: number = startLifeTimeGradient.getKeyByIndex(i);\r\n\t\t\tif (key >= emissionTime) {\r\n\t\t\t\tvar lastKey: number = startLifeTimeGradient.getKeyByIndex(i - 1);\r\n\t\t\t\tvar age: number = (emissionTime - lastKey) / (key - lastKey);\r\n\t\t\t\treturn MathUtil.lerp(startLifeTimeGradient.getValueByIndex(i - 1), startLifeTimeGradient.getValueByIndex(i), age)\r\n\t\t\t}\r\n\t\t}\r\n\t\tthrow new Error(\"ShurikenParticleData: can't get value foam startLifeTimeGradient.\");\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static _randomInvertRoationArray(rotatonE: Vector3, outE: Vector3, randomizeRotationDirection: number, rand: Rand, randomSeeds: Uint32Array): void {\r\n\t\tvar randDic: number;\r\n\t\tif (rand) {\r\n\t\t\trand.seed = randomSeeds[6];\r\n\t\t\trandDic = rand.getFloat();\r\n\t\t\trandomSeeds[6] = rand.seed;\r\n\t\t} else {\r\n\t\t\trandDic = Math.random();\r\n\t\t}\r\n\t\tif (randDic < randomizeRotationDirection) {\r\n\t\t\toutE.x = -rotatonE.x;\r\n\t\t\toutE.y = -rotatonE.y;\r\n\t\t\toutE.z = -rotatonE.z;\r\n\t\t} else {\r\n\t\t\toutE.x = rotatonE.x;\r\n\t\t\toutE.y = rotatonE.y;\r\n\t\t\toutE.z = rotatonE.z;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static _randomInvertRoation(rotaton: number, randomizeRotationDirection: number, rand: Rand, randomSeeds: Uint32Array): number {\r\n\t\tvar randDic: number;\r\n\t\tif (rand) {\r\n\t\t\trand.seed = randomSeeds[6];\r\n\t\t\trandDic = rand.getFloat();\r\n\t\t\trandomSeeds[6] = rand.seed;\r\n\t\t} else {\r\n\t\t\trandDic = Math.random();\r\n\t\t}\r\n\t\tif (randDic < randomizeRotationDirection)\r\n\t\t\trotaton = -rotaton;\r\n\t\treturn rotaton;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic create(particleSystem: ShurikenParticleSystem, particleRender: ShurikenParticleRenderer): void {\r\n\t\tvar autoRandomSeed: boolean = particleSystem.autoRandomSeed;\r\n\t\tvar rand: Rand = particleSystem._rand;\r\n\t\tvar randomSeeds: Uint32Array = particleSystem._randomSeeds;\r\n\r\n\t\t//StartColor\r\n\t\tswitch (particleSystem.startColorType) {\r\n\t\t\tcase 0:\r\n\t\t\t\tvar constantStartColor: Vector4 = particleSystem.startColorConstant;\r\n\t\t\t\tShurikenParticleData.startColor.x = constantStartColor.x;\r\n\t\t\t\tShurikenParticleData.startColor.y = constantStartColor.y;\r\n\t\t\t\tShurikenParticleData.startColor.z = constantStartColor.z;\r\n\t\t\t\tShurikenParticleData.startColor.w = constantStartColor.w;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\tVector4.lerp(particleSystem.startColorConstantMin, particleSystem.startColorConstantMax, Math.random(), ShurikenParticleData.startColor);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trand.seed = randomSeeds[3];\r\n\t\t\t\t\tVector4.lerp(particleSystem.startColorConstantMin, particleSystem.startColorConstantMax, rand.getFloat(), ShurikenParticleData.startColor);\r\n\t\t\t\t\trandomSeeds[3] = rand.seed;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tvar colorOverLifetime: ColorOverLifetime = particleSystem.colorOverLifetime;\r\n\t\tif (colorOverLifetime && colorOverLifetime.enable) {\r\n\t\t\tvar color: GradientColor = colorOverLifetime.color;\r\n\t\t\tswitch (color.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tShurikenParticleData.startColor.x = ShurikenParticleData.startColor.x * color.constant.x;\r\n\t\t\t\t\tShurikenParticleData.startColor.y = ShurikenParticleData.startColor.y * color.constant.y;\r\n\t\t\t\t\tShurikenParticleData.startColor.z = ShurikenParticleData.startColor.z * color.constant.z;\r\n\t\t\t\t\tShurikenParticleData.startColor.w = ShurikenParticleData.startColor.w * color.constant.w;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tvar colorRandom: number;\r\n\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\tcolorRandom = Math.random();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trand.seed = randomSeeds[10];\r\n\t\t\t\t\t\tcolorRandom = rand.getFloat();\r\n\t\t\t\t\t\trandomSeeds[10] = rand.seed;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar minConstantColor: Vector4 = color.constantMin;\r\n\t\t\t\t\tvar maxConstantColor: Vector4 = color.constantMax;\r\n\t\t\t\t\tShurikenParticleData.startColor.x = ShurikenParticleData.startColor.x * MathUtil.lerp(minConstantColor.x, maxConstantColor.x, colorRandom);\r\n\t\t\t\t\tShurikenParticleData.startColor.y = ShurikenParticleData.startColor.y * MathUtil.lerp(minConstantColor.y, maxConstantColor.y, colorRandom);\r\n\t\t\t\t\tShurikenParticleData.startColor.z = ShurikenParticleData.startColor.z * MathUtil.lerp(minConstantColor.z, maxConstantColor.z, colorRandom);\r\n\t\t\t\t\tShurikenParticleData.startColor.w = ShurikenParticleData.startColor.w * MathUtil.lerp(minConstantColor.w, maxConstantColor.w, colorRandom);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//StartSize\r\n\t\tvar particleSize: Float32Array = ShurikenParticleData.startSize;\r\n\t\tswitch (particleSystem.startSizeType) {\r\n\t\t\tcase 0:\r\n\t\t\t\tif (particleSystem.threeDStartSize) {\r\n\t\t\t\t\tvar startSizeConstantSeparate: Vector3 = particleSystem.startSizeConstantSeparate;\r\n\t\t\t\t\tparticleSize[0] = startSizeConstantSeparate.x;\r\n\t\t\t\t\tparticleSize[1] = startSizeConstantSeparate.y;\r\n\t\t\t\t\tparticleSize[2] = startSizeConstantSeparate.z;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparticleSize[0] = particleSize[1] = particleSize[2] = particleSystem.startSizeConstant;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (particleSystem.threeDStartSize) {\r\n\t\t\t\t\tvar startSizeConstantMinSeparate: Vector3 = particleSystem.startSizeConstantMinSeparate;\r\n\t\t\t\t\tvar startSizeConstantMaxSeparate: Vector3 = particleSystem.startSizeConstantMaxSeparate;\r\n\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\tparticleSize[0] = MathUtil.lerp(startSizeConstantMinSeparate.x, startSizeConstantMaxSeparate.x, Math.random());\r\n\t\t\t\t\t\tparticleSize[1] = MathUtil.lerp(startSizeConstantMinSeparate.y, startSizeConstantMaxSeparate.y, Math.random());\r\n\t\t\t\t\t\tparticleSize[2] = MathUtil.lerp(startSizeConstantMinSeparate.z, startSizeConstantMaxSeparate.z, Math.random());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trand.seed = randomSeeds[4];\r\n\t\t\t\t\t\tparticleSize[0] = MathUtil.lerp(startSizeConstantMinSeparate.x, startSizeConstantMaxSeparate.x, rand.getFloat());\r\n\t\t\t\t\t\tparticleSize[1] = MathUtil.lerp(startSizeConstantMinSeparate.y, startSizeConstantMaxSeparate.y, rand.getFloat());\r\n\t\t\t\t\t\tparticleSize[2] = MathUtil.lerp(startSizeConstantMinSeparate.z, startSizeConstantMaxSeparate.z, rand.getFloat());\r\n\t\t\t\t\t\trandomSeeds[4] = rand.seed;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\tparticleSize[0] = particleSize[1] = particleSize[2] = MathUtil.lerp(particleSystem.startSizeConstantMin, particleSystem.startSizeConstantMax, Math.random());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trand.seed = randomSeeds[4];\r\n\t\t\t\t\t\tparticleSize[0] = particleSize[1] = particleSize[2] = MathUtil.lerp(particleSystem.startSizeConstantMin, particleSystem.startSizeConstantMax, rand.getFloat());\r\n\t\t\t\t\t\trandomSeeds[4] = rand.seed;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tvar sizeOverLifetime: SizeOverLifetime = particleSystem.sizeOverLifetime;\r\n\t\tif (sizeOverLifetime && sizeOverLifetime.enable && sizeOverLifetime.size.type === 1) {\r\n\t\t\tvar size: GradientSize = sizeOverLifetime.size;\r\n\t\t\tif (size.separateAxes) {\r\n\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\tparticleSize[0] = particleSize[0] * MathUtil.lerp(size.constantMinSeparate.x, size.constantMaxSeparate.x, Math.random());\r\n\t\t\t\t\tparticleSize[1] = particleSize[1] * MathUtil.lerp(size.constantMinSeparate.y, size.constantMaxSeparate.y, Math.random());\r\n\t\t\t\t\tparticleSize[2] = particleSize[2] * MathUtil.lerp(size.constantMinSeparate.z, size.constantMaxSeparate.z, Math.random());\r\n\t\t\t\t} else {\r\n\t\t\t\t\trand.seed = randomSeeds[11];\r\n\t\t\t\t\tparticleSize[0] = particleSize[0] * MathUtil.lerp(size.constantMinSeparate.x, size.constantMaxSeparate.x, rand.getFloat());\r\n\t\t\t\t\tparticleSize[1] = particleSize[1] * MathUtil.lerp(size.constantMinSeparate.y, size.constantMaxSeparate.y, rand.getFloat());\r\n\t\t\t\t\tparticleSize[2] = particleSize[2] * MathUtil.lerp(size.constantMinSeparate.z, size.constantMaxSeparate.z, rand.getFloat());\r\n\t\t\t\t\trandomSeeds[11] = rand.seed;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar randomSize: number;\r\n\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\trandomSize = MathUtil.lerp(size.constantMin, size.constantMax, Math.random());\r\n\t\t\t\t} else {\r\n\t\t\t\t\trand.seed = randomSeeds[11];\r\n\t\t\t\t\trandomSize = MathUtil.lerp(size.constantMin, size.constantMax, rand.getFloat());\r\n\t\t\t\t\trandomSeeds[11] = rand.seed;\r\n\t\t\t\t}\r\n\t\t\t\tparticleSize[0] = particleSize[0] * randomSize;\r\n\t\t\t\tparticleSize[1] = particleSize[1] * randomSize;\r\n\t\t\t\tparticleSize[2] = particleSize[2] * randomSize;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//StartRotation//TODO:renderMode23\r\n\t\tvar renderMode: number = particleRender.renderMode;\r\n\t\tif (renderMode !== 1) {\r\n\t\t\tswitch (particleSystem.startRotationType) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tif (particleSystem.threeDStartRotation) {\r\n\t\t\t\t\t\tvar startRotationConstantSeparate: Vector3 = particleSystem.startRotationConstantSeparate;\r\n\t\t\t\t\t\tvar randomRotationE: Vector3 = ShurikenParticleData._tempVector30;\r\n\t\t\t\t\t\tShurikenParticleData._randomInvertRoationArray(startRotationConstantSeparate, randomRotationE, particleSystem.randomizeRotationDirection, autoRandomSeed ? null : rand, randomSeeds);\r\n\t\t\t\t\t\tShurikenParticleData.startRotation[0] = randomRotationE.x;\r\n\t\t\t\t\t\tShurikenParticleData.startRotation[1] = randomRotationE.y;\r\n\t\t\t\t\t\tif (renderMode !== 4)\r\n\t\t\t\t\t\t\tShurikenParticleData.startRotation[2] = -randomRotationE.z;\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tShurikenParticleData.startRotation[2] = randomRotationE.z;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tShurikenParticleData.startRotation[0] = ShurikenParticleData._randomInvertRoation(particleSystem.startRotationConstant, particleSystem.randomizeRotationDirection, autoRandomSeed ? null : rand, randomSeeds);\r\n\t\t\t\t\t\tShurikenParticleData.startRotation[1] = 0;\r\n\t\t\t\t\t\tShurikenParticleData.startRotation[2] = 0;//0,TODO:meshZ,X\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tif (particleSystem.threeDStartRotation) {\r\n\t\t\t\t\t\tvar startRotationConstantMinSeparate: Vector3 = particleSystem.startRotationConstantMinSeparate;\r\n\t\t\t\t\t\tvar startRotationConstantMaxSeparate: Vector3 = particleSystem.startRotationConstantMaxSeparate;\r\n\t\t\t\t\t\tvar lerpRoationE: Vector3 = ShurikenParticleData._tempVector30;\r\n\t\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\t\tlerpRoationE.x = MathUtil.lerp(startRotationConstantMinSeparate.x, startRotationConstantMaxSeparate.x, Math.random());\r\n\t\t\t\t\t\t\tlerpRoationE.y = MathUtil.lerp(startRotationConstantMinSeparate.y, startRotationConstantMaxSeparate.y, Math.random());\r\n\t\t\t\t\t\t\tlerpRoationE.z = MathUtil.lerp(startRotationConstantMinSeparate.z, startRotationConstantMaxSeparate.z, Math.random());\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trand.seed = randomSeeds[5];\r\n\t\t\t\t\t\t\tlerpRoationE.x = MathUtil.lerp(startRotationConstantMinSeparate.x, startRotationConstantMaxSeparate.x, rand.getFloat());\r\n\t\t\t\t\t\t\tlerpRoationE.y = MathUtil.lerp(startRotationConstantMinSeparate.y, startRotationConstantMaxSeparate.y, rand.getFloat());\r\n\t\t\t\t\t\t\tlerpRoationE.z = MathUtil.lerp(startRotationConstantMinSeparate.z, startRotationConstantMaxSeparate.z, rand.getFloat());\r\n\t\t\t\t\t\t\trandomSeeds[5] = rand.seed;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tShurikenParticleData._randomInvertRoationArray(lerpRoationE, lerpRoationE, particleSystem.randomizeRotationDirection, autoRandomSeed ? null : rand, randomSeeds);\r\n\t\t\t\t\t\tShurikenParticleData.startRotation[0] = lerpRoationE.x;\r\n\t\t\t\t\t\tShurikenParticleData.startRotation[1] = lerpRoationE.y;\r\n\t\t\t\t\t\tif (renderMode !== 4)\r\n\t\t\t\t\t\t\tShurikenParticleData.startRotation[2] = -lerpRoationE.z;\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tShurikenParticleData.startRotation[2] = lerpRoationE.z;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\t\tShurikenParticleData.startRotation[0] = ShurikenParticleData._randomInvertRoation(MathUtil.lerp(particleSystem.startRotationConstantMin, particleSystem.startRotationConstantMax, Math.random()), particleSystem.randomizeRotationDirection, autoRandomSeed ? null : rand, randomSeeds);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trand.seed = randomSeeds[5];\r\n\t\t\t\t\t\t\tShurikenParticleData.startRotation[0] = ShurikenParticleData._randomInvertRoation(MathUtil.lerp(particleSystem.startRotationConstantMin, particleSystem.startRotationConstantMax, rand.getFloat()), particleSystem.randomizeRotationDirection, autoRandomSeed ? null : rand, randomSeeds);\r\n\t\t\t\t\t\t\trandomSeeds[5] = rand.seed;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//StartLifetime\r\n\t\tswitch (particleSystem.startLifetimeType) {\r\n\t\t\tcase 0:\r\n\t\t\t\tShurikenParticleData.startLifeTime = particleSystem.startLifetimeConstant;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tShurikenParticleData.startLifeTime = ShurikenParticleData._getStartLifetimeFromGradient(particleSystem.startLifeTimeGradient, particleSystem.emissionTime);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\tShurikenParticleData.startLifeTime = MathUtil.lerp(particleSystem.startLifetimeConstantMin, particleSystem.startLifetimeConstantMax, Math.random());\r\n\t\t\t\t} else {\r\n\t\t\t\t\trand.seed = randomSeeds[7];\r\n\t\t\t\t\tShurikenParticleData.startLifeTime = MathUtil.lerp(particleSystem.startLifetimeConstantMin, particleSystem.startLifetimeConstantMax, rand.getFloat());\r\n\t\t\t\t\trandomSeeds[7] = rand.seed;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tvar emissionTime: number = particleSystem.emissionTime;\r\n\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\tShurikenParticleData.startLifeTime = MathUtil.lerp(ShurikenParticleData._getStartLifetimeFromGradient(particleSystem.startLifeTimeGradientMin, emissionTime), ShurikenParticleData._getStartLifetimeFromGradient(particleSystem.startLifeTimeGradientMax, emissionTime), Math.random());\r\n\t\t\t\t} else {\r\n\t\t\t\t\trand.seed = randomSeeds[7];\r\n\t\t\t\t\tShurikenParticleData.startLifeTime = MathUtil.lerp(ShurikenParticleData._getStartLifetimeFromGradient(particleSystem.startLifeTimeGradientMin, emissionTime), ShurikenParticleData._getStartLifetimeFromGradient(particleSystem.startLifeTimeGradientMax, emissionTime), rand.getFloat());\r\n\t\t\t\t\trandomSeeds[7] = rand.seed;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\r\n\t\t//StartUV\r\n\t\tvar textureSheetAnimation: TextureSheetAnimation = particleSystem.textureSheetAnimation;\r\n\t\tvar enableSheetAnimation: boolean = textureSheetAnimation && textureSheetAnimation.enable;\r\n\t\tif (enableSheetAnimation) {\r\n\t\t\tvar title: Vector2 = textureSheetAnimation.tiles;\r\n\t\t\tvar titleX: number = title.x, titleY: number = title.y;\r\n\t\t\tvar subU: number = 1.0 / titleX, subV: number = 1.0 / titleY;\r\n\r\n\t\t\tvar startFrameCount: number;\r\n\t\t\tvar startFrame: StartFrame = textureSheetAnimation.startFrame;\r\n\t\t\tswitch (startFrame.type) {\r\n\t\t\t\tcase 0://\r\n\t\t\t\t\tstartFrameCount = startFrame.constant;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1://\r\n\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\tstartFrameCount = MathUtil.lerp(startFrame.constantMin, startFrame.constantMax, Math.random());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trand.seed = randomSeeds[14];\r\n\t\t\t\t\t\tstartFrameCount = MathUtil.lerp(startFrame.constantMin, startFrame.constantMax, rand.getFloat());\r\n\t\t\t\t\t\trandomSeeds[14] = rand.seed;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tvar frame: FrameOverTime = textureSheetAnimation.frame;\r\n\t\t\tvar cycles: number = textureSheetAnimation.cycles;\r\n\t\t\tswitch (frame.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tstartFrameCount += frame.constant * cycles;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\tstartFrameCount += MathUtil.lerp(frame.constantMin, frame.constantMax, Math.random()) * cycles;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trand.seed = randomSeeds[15];\r\n\t\t\t\t\t\tstartFrameCount += MathUtil.lerp(frame.constantMin, frame.constantMax, rand.getFloat()) * cycles;\r\n\t\t\t\t\t\trandomSeeds[15] = rand.seed;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tvar startRow: number = 0;//TODO:case 2 \r\n\t\t\tswitch (textureSheetAnimation.type) {\r\n\t\t\t\tcase 0://Whole Sheet\r\n\t\t\t\t\tstartRow = Math.floor(startFrameCount / titleX);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1://Singal Row\r\n\t\t\t\t\tif (textureSheetAnimation.randomRow) {\r\n\t\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\t\tstartRow = Math.floor(Math.random() * titleY);\r\n\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trand.seed = randomSeeds[13];\r\n\t\t\t\t\t\t\tstartRow = Math.floor(rand.getFloat() * titleY);\r\n\t\t\t\t\t\t\trandomSeeds[13] = rand.seed;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tstartRow = textureSheetAnimation.rowIndex;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tvar startCol: number = Math.floor(startFrameCount % titleX);\r\n\t\t\tShurikenParticleData.startUVInfo = ShurikenParticleData.startUVInfo;\r\n\t\t\tShurikenParticleData.startUVInfo[0] = subU;\r\n\t\t\tShurikenParticleData.startUVInfo[1] = subV;\r\n\t\t\tShurikenParticleData.startUVInfo[2] = startCol * subU;\r\n\t\t\tShurikenParticleData.startUVInfo[3] = startRow * subV;\r\n\t\t} else {\r\n\t\t\tShurikenParticleData.startUVInfo = ShurikenParticleData.startUVInfo;\r\n\t\t\tShurikenParticleData.startUVInfo[0] = 1.0;\r\n\t\t\tShurikenParticleData.startUVInfo[1] = 1.0;\r\n\t\t\tShurikenParticleData.startUVInfo[2] = 0.0;\r\n\t\t\tShurikenParticleData.startUVInfo[3] = 0.0;\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { MathUtil } from \"../../../maths/MathUtil\";\r\nimport { Resource } from \"../../../resource/Resource\";\r\nimport { Stat } from \"../../../utils/Stat\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { VertexShurikenParticleBillboard } from \"../../graphics/Vertex/VertexShurikenParticleBillboard\";\r\nimport { VertexShurikenParticleMesh } from \"../../graphics/Vertex/VertexShurikenParticleMesh\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Rand } from \"../../math/Rand\";\r\nimport { Mesh } from \"../../resource/models/Mesh\";\r\nimport { GeometryElement } from \"../GeometryElement\";\r\nimport { Gradient } from \"../Gradient\";\r\nimport { IClone } from \"../../../utils/IClone\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { Scene3D } from \"../scene/Scene3D\";\r\nimport { Transform3D } from \"../Transform3D\";\r\nimport { Burst } from \"./module/Burst\";\r\nimport { ColorOverLifetime } from \"./module/ColorOverLifetime\";\r\nimport { Emission } from \"./module/Emission\";\r\nimport { FrameOverTime } from \"./module/FrameOverTime\";\r\nimport { GradientAngularVelocity } from \"./module/GradientAngularVelocity\";\r\nimport { GradientColor } from \"./module/GradientColor\";\r\nimport { GradientDataNumber } from \"./module/GradientDataNumber\";\r\nimport { GradientSize } from \"./module/GradientSize\";\r\nimport { GradientVelocity } from \"./module/GradientVelocity\";\r\nimport { RotationOverLifetime } from \"./module/RotationOverLifetime\";\r\nimport { BaseShape, ParticleSystemShapeType } from \"./module/shape/BaseShape\";\r\nimport { SizeOverLifetime } from \"./module/SizeOverLifetime\";\r\nimport { TextureSheetAnimation } from \"./module/TextureSheetAnimation\";\r\nimport { VelocityOverLifetime } from \"./module/VelocityOverLifetime\";\r\nimport { ShuriKenParticle3DShaderDeclaration } from \"./ShuriKenParticle3DShaderDeclaration\";\r\nimport { ShurikenParticleData } from \"./ShurikenParticleData\";\r\nimport { ShurikenParticleRenderer } from \"./ShurikenParticleRenderer\";\r\nimport { SphereShape } from \"./module/shape/SphereShape\";\r\nimport { HemisphereShape } from \"./module/shape/HemisphereShape\";\r\nimport { ConeShape } from \"./module/shape/ConeShape\";\r\nimport { CircleShape } from \"./module/shape/CircleShape\";\r\nimport { BoxShape } from \"./module/shape/BoxShape\";\r\nimport { VertexShuriKenParticle } from \"../../graphics/Vertex/VertexShuriKenParticle\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\n\r\n\r\n/**\r\n * <code>ShurikenParticleSystem</code> 3D\r\n */\r\nexport class ShurikenParticleSystem extends GeometryElement implements IClone {\r\n    /** @internal 0:Burst,1:,2:StartDelay,3:StartColor,4:StartSize,5:StartRotation,6:randomizeRotationDirection,7:StartLifetime,8:StartSpeed,9:VelocityOverLifetime,10:ColorOverLifetime,11:SizeOverLifetime,12:RotationOverLifetime,13-15:TextureSheetAnimation,16-17:Shape*/\r\n    static _RANDOMOFFSET: Uint32Array = new Uint32Array([0x23571a3e, 0xc34f56fe, 0x13371337, 0x12460f3b, 0x6aed452e, 0xdec4aea1, 0x96aa4de3, 0x8d2c8431, 0xf3857f6f, 0xe0fbd834, 0x13740583, 0x591bc05c, 0x40eb95e4, 0xbc524e5f, 0xaf502044, 0xa614b381, 0x1034e524, 0xfc524e5f]);\r\n\r\n    /** @internal */\r\n    protected static halfKSqrtOf2: number = 1.42 * 0.5;\r\n\r\n    /** @internal */\r\n    protected static g: number = 9.8;\r\n\r\n    /** @internal */\r\n    static _maxElapsedTime: number = 1.0 / 3.0;\r\n\r\n    /**@internal */\r\n    protected static _tempVector30: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected static _tempVector31: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected static _tempVector32: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected static _tempVector33: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected static _tempVector34: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected static _tempVector35: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected static _tempVector36: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected static _tempVector37: Vector3 = new Vector3();\r\n    /** @internal */\r\n    protected static _tempPosition: Vector3 = new Vector3();\r\n    /** @internal */\r\n    protected static _tempDirection: Vector3 = new Vector3();\r\n\r\n    /**@internal */\r\n    protected static _type: number = GeometryElement._typeCounter++;\r\n    /** @internal */\r\n    _bounds: Bounds = null;\r\n    /** @internal ,  */\r\n    _gravityOffset: Vector2 = new Vector2();\r\n\r\n    /** @internal */\r\n    _customBounds: Bounds = null;\r\n\r\n    /** @internal */\r\n    _useCustomBounds: boolean = false;\r\n\r\n    /** @internal */\r\n    protected _owner: Sprite3D = null;\r\n    /** @internal */\r\n    protected _ownerRender: ShurikenParticleRenderer = null;\r\n    /**@internal */\r\n    protected _vertices: Float32Array = null;\r\n    /**@internal */\r\n    protected _floatCountPerVertex: number = 0;\r\n    /**@internal */\r\n    protected _startLifeTimeIndex: number = 0;\r\n    /**@internal */\r\n    protected _timeIndex: number = 0;\r\n    /**@internal */\r\n    protected _simulationUV_Index: number = 0\r\n    /**@internal */\r\n    protected _simulateUpdate: boolean = false;\r\n\r\n\r\n    /**@internal */\r\n    protected _firstActiveElement: number = 0;\r\n    /**@internal */\r\n    protected _firstNewElement: number = 0;\r\n    /**@internal */\r\n    protected _firstFreeElement: number = 0;\r\n    /**@internal */\r\n    protected _firstRetiredElement: number = 0;\r\n    /**@internal */\r\n    protected _drawCounter: number = 0;\r\n    /**@internal */\r\n    protected _bufferMaxParticles: number = 0;\r\n    /**@internal */\r\n    protected _emission: Emission = null;\r\n    /**@internal */\r\n    protected _shape: BaseShape = null;\r\n\r\n    /**@internal */\r\n    protected _isEmitting: boolean = false;\r\n    /**@internal */\r\n    protected _isPlaying: boolean = false;\r\n    /**@internal */\r\n    protected _isPaused: boolean = false;\r\n    /**@internal */\r\n    protected _playStartDelay: number = 0;\r\n    /**@internal */\r\n    protected _frameRateTime: number = 0;\r\n    /**@internal */\r\n    protected _emissionTime: number = 0;\r\n    /**@internal */\r\n    protected _totalDelayTime: number = 0;\r\n    /** @internal  */\r\n    protected _emissionDistance: number = 0;\r\n    protected _emissionLastPosition: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected _burstsIndex: number = 0;\r\n    ///**@internal */\r\n    //protected var _minEmissionTime:Number;\r\n    /**@internal */\r\n    protected _velocityOverLifetime: VelocityOverLifetime = null;\r\n    /**@internal */\r\n    protected _colorOverLifetime: ColorOverLifetime = null;\r\n    /**@internal */\r\n    protected _sizeOverLifetime: SizeOverLifetime = null;\r\n    /**@internal */\r\n    protected _rotationOverLifetime: RotationOverLifetime = null;\r\n    /**@internal */\r\n    protected _textureSheetAnimation: TextureSheetAnimation = null;\r\n    /**@internal */\r\n    protected _startLifetimeType: number = 0;\r\n    /**@internal */\r\n    protected _startLifetimeConstant: number = 0;\r\n    /**@internal */\r\n    protected _startLifeTimeGradient: GradientDataNumber = null;\r\n    /**@internal */\r\n    protected _startLifetimeConstantMin: number = 0;\r\n    /**@internal */\r\n    protected _startLifetimeConstantMax: number = 0;\r\n    /**@internal */\r\n    protected _startLifeTimeGradientMin: GradientDataNumber = null;\r\n    /**@internal */\r\n    protected _startLifeTimeGradientMax: GradientDataNumber = null;\r\n    /**@internal */\r\n    protected _maxStartLifetime: number = 0;\r\n\r\n    /** @internal */\r\n    protected _uvLength: Vector2 = new Vector2();//TODO:\r\n    /** @internal */\r\n    protected _vertexStride: number = 0;\r\n    /** @internal */\r\n    protected _indexStride: number = 0;\r\n    /**@internal */\r\n    protected _vertexBuffer: VertexBuffer3D = null;\r\n    /**@internal */\r\n    protected _indexBuffer: IndexBuffer3D = null;\r\n    /** @internal */\r\n    protected _bufferState: BufferState = new BufferState();\r\n\r\n    /**@internal */\r\n    protected _updateMask: number = 0;\r\n\r\n    /**@internal */\r\n    _currentTime: number = 0;\r\n    /**@internal */\r\n    _startUpdateLoopCount: number = 0;\r\n    /**@internal */\r\n    _rand: Rand = null;\r\n    /**@internal */\r\n    _randomSeeds: Uint32Array = null;\r\n\r\n    /***/\r\n    duration: number = 0;\r\n    /***/\r\n    looping: boolean = false;\r\n    /***/\r\n    prewarm: boolean = false;\r\n    /**0,1prewarm*/\r\n    startDelayType: number = 0;\r\n    /**prewarm*/\r\n    startDelay: number = 0;\r\n    /**prewarm*/\r\n    startDelayMin: number = 0;\r\n    /**prewarm*/\r\n    startDelayMax: number = 0;\r\n\r\n    /**0213*/\r\n    startSpeedType: number = 0;\r\n    /**,0*/\r\n    startSpeedConstant: number = 0;\r\n    /**,1*/\r\n    startSpeedConstantMin: number = 0;\r\n    /**,1*/\r\n    startSpeedConstantMax: number = 0;\r\n\r\n    /**02*/\r\n    dragType: number = 0;\r\n    /**,0*/\r\n    dragConstant: number = 0;\r\n    /**,1*/\r\n    dragSpeedConstantMin: number = 0;\r\n    /**,1*/\r\n    dragSpeedConstantMax: number = 0;\r\n\r\n\r\n\r\n    /**3D*/\r\n    threeDStartSize: boolean = false;\r\n    /**,02133D*/\r\n    startSizeType: number = 0;\r\n    /**0*/\r\n    startSizeConstant: number = 0;\r\n    /**0*/\r\n    startSizeConstantSeparate: Vector3 = null;\r\n    /**2*/\r\n    startSizeConstantMin: number = 0;\r\n    /**2*/\r\n    startSizeConstantMax: number = 0;\r\n    /**2*/\r\n    startSizeConstantMinSeparate: Vector3 = null;\r\n    /**2*/\r\n    startSizeConstantMaxSeparate: Vector3 = null;\r\n\r\n    /**3D*/\r\n    threeDStartRotation: boolean = false;\r\n    /**,02,2,3D*/\r\n    startRotationType: number = 0;\r\n    /**0*/\r\n    startRotationConstant: number = 0;\r\n    /**0*/\r\n    startRotationConstantSeparate: Vector3 = null;\r\n    /**1*/\r\n    startRotationConstantMin: number = 0;\r\n    /**1*/\r\n    startRotationConstantMax: number = 0;\r\n    /**1*/\r\n    startRotationConstantMinSeparate: Vector3 = null;\r\n    /**1*/\r\n    startRotationConstantMaxSeparate: Vector3 = null;\r\n\r\n    /**0.01.0*/\r\n    randomizeRotationDirection: number = 0;\r\n\r\n    /**02,2*/\r\n    startColorType: number = 0;\r\n    /**0*/\r\n    startColorConstant: Vector4 = new Vector4(1, 1, 1, 1);\r\n    /**1*/\r\n    startColorConstantMin: Vector4 = new Vector4(0, 0, 0, 0);\r\n    /**1*/\r\n    startColorConstantMax: Vector4 = new Vector4(1, 1, 1, 1);\r\n\r\n    /***/\r\n    gravityModifier: number = 0;\r\n    /**,0World,1LocalCustom*/\r\n    simulationSpace: number = 0;\r\n    /** */\r\n    simulationSpeed: number = 1.0;\r\n    /**0Hiercachy,1Local,2World*/\r\n    scaleMode: number = 1;\r\n    /***/\r\n    playOnAwake: boolean = false;\r\n\r\n    /**,:play()*/\r\n    randomSeed: Uint32Array = null;\r\n    /** */\r\n    autoRandomSeed: boolean = false;\r\n\r\n    /**,*/\r\n    isPerformanceMode: boolean = false;\r\n\r\n    /***/\r\n    get maxParticles(): number {\r\n        return this._bufferMaxParticles - 1;\r\n    }\r\n\r\n    set maxParticles(value: number) {//TODO:\r\n        var newMaxParticles: number = value + 1;\r\n        if (newMaxParticles !== this._bufferMaxParticles) {\r\n            this._bufferMaxParticles = newMaxParticles;\r\n            this._initBufferDatas();\r\n        }\r\n\r\n        this._updateParticlesSimulationRestart(0);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get emission(): Emission {\r\n        return this._emission;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get aliveParticleCount(): number {\r\n        if (this._firstNewElement >= this._firstRetiredElement)\r\n            return this._firstNewElement - this._firstRetiredElement;\r\n        else\r\n            return this._bufferMaxParticles - this._firstRetiredElement + this._firstNewElement;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get emissionTime(): number {\r\n        return this._emissionTime > this.duration ? this.duration : this._emissionTime;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shape(): BaseShape {\r\n        return this._shape;\r\n    }\r\n\r\n    set shape(value: BaseShape) {\r\n        if (this._shape !== value) {\r\n            if (value && value.enable)\r\n                this._ownerRender._shaderValues.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SHAPE);\r\n            else\r\n                this._ownerRender._shaderValues.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SHAPE);\r\n            this._shape = value;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get isAlive(): boolean {\r\n        if (this._isPlaying || this.aliveParticleCount > 0)//TODO:retired\r\n            return true;\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get isEmitting(): boolean {\r\n        return this._isEmitting;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get isPlaying(): boolean {\r\n        return this._isPlaying;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get isPaused(): boolean {\r\n        return this._isPaused;\r\n    }\r\n\r\n    /**\r\n     * ,012,3\r\n     */\r\n    get startLifetimeType(): number {\r\n        return this._startLifetimeType;\r\n    }\r\n\r\n    set startLifetimeType(value: number) {\r\n        //if (value !== _startLifetimeType){\r\n        var i: number, n: number;\r\n        switch (this.startLifetimeType) {\r\n            case 0:\r\n                this._maxStartLifetime = this.startLifetimeConstant;\r\n                break;\r\n            case 1:\r\n                this._maxStartLifetime = -Number.MAX_VALUE;\r\n                var startLifeTimeGradient: GradientDataNumber = startLifeTimeGradient;\r\n                for (i = 0, n = startLifeTimeGradient.gradientCount; i < n; i++)\r\n                    this._maxStartLifetime = Math.max(this._maxStartLifetime, startLifeTimeGradient.getValueByIndex(i));\r\n                break;\r\n            case 2:\r\n                this._maxStartLifetime = Math.max(this.startLifetimeConstantMin, this.startLifetimeConstantMax);\r\n                break;\r\n            case 3:\r\n                this._maxStartLifetime = -Number.MAX_VALUE;\r\n                var startLifeTimeGradientMin: GradientDataNumber = startLifeTimeGradientMin;\r\n                for (i = 0, n = startLifeTimeGradientMin.gradientCount; i < n; i++)\r\n                    this._maxStartLifetime = Math.max(this._maxStartLifetime, startLifeTimeGradientMin.getValueByIndex(i));\r\n                var startLifeTimeGradientMax: GradientDataNumber = startLifeTimeGradientMax;\r\n                for (i = 0, n = startLifeTimeGradientMax.gradientCount; i < n; i++)\r\n                    this._maxStartLifetime = Math.max(this._maxStartLifetime, startLifeTimeGradientMax.getValueByIndex(i));\r\n                break;\r\n        }\r\n        this._startLifetimeType = value;\r\n        //}\r\n    }\r\n\r\n    /**\r\n     * 0,\r\n     */\r\n    get startLifetimeConstant(): number {\r\n        return this._startLifetimeConstant;\r\n    }\r\n\r\n    set startLifetimeConstant(value: number) {\r\n        if (this._startLifetimeType === 0)\r\n            this._maxStartLifetime = value;\r\n        this._startLifetimeConstant = value;\r\n    }\r\n\r\n    /**\r\n     * 1,\r\n     */\r\n    get startLifeTimeGradient(): GradientDataNumber {\r\n        return this._startLifeTimeGradient;\r\n    }\r\n\r\n    set startLifeTimeGradient(value: GradientDataNumber) {//if (_startLifeTimeGradient !== value)GradientDataNumber,startLifeTime\r\n        if (this._startLifetimeType === 1) {\r\n            this._maxStartLifetime = -Number.MAX_VALUE;\r\n            for (var i: number = 0, n: number = value.gradientCount; i < n; i++)\r\n                this._maxStartLifetime = Math.max(this._maxStartLifetime, value.getValueByIndex(i));\r\n        }\r\n        this._startLifeTimeGradient = value;\r\n    }\r\n\r\n    /**\r\n     * 2,\r\n     */\r\n    get startLifetimeConstantMin(): number {\r\n        return this._startLifetimeConstantMin;\r\n    }\r\n\r\n    set startLifetimeConstantMin(value: number) {\r\n        if (this._startLifetimeType === 2)\r\n            this._maxStartLifetime = Math.max(value, this._startLifetimeConstantMax);\r\n        this._startLifetimeConstantMin = value;\r\n    }\r\n\r\n\r\n    /**\r\n     * 2,\r\n     */\r\n    get startLifetimeConstantMax(): number {\r\n        return this._startLifetimeConstantMax;\r\n    }\r\n\r\n    set startLifetimeConstantMax(value: number) {\r\n        if (this._startLifetimeType === 2)\r\n            this._maxStartLifetime = Math.max(this._startLifetimeConstantMin, value);\r\n        this._startLifetimeConstantMax = value;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * 3,\r\n     */\r\n    get startLifeTimeGradientMin(): GradientDataNumber {\r\n        return this._startLifeTimeGradientMin;\r\n    }\r\n\r\n    set startLifeTimeGradientMin(value: GradientDataNumber) {\r\n        if (this._startLifetimeType === 3) {\r\n            var i: number, n: number;\r\n            this._maxStartLifetime = -Number.MAX_VALUE;\r\n            for (i = 0, n = value.gradientCount; i < n; i++)\r\n                this._maxStartLifetime = Math.max(this._maxStartLifetime, value.getValueByIndex(i));\r\n            for (i = 0, n = this._startLifeTimeGradientMax.gradientCount; i < n; i++)\r\n                this._maxStartLifetime = Math.max(this._maxStartLifetime, this._startLifeTimeGradientMax.getValueByIndex(i));\r\n        }\r\n        this._startLifeTimeGradientMin = value;\r\n    }\r\n\r\n    /**\r\n     * 3,\r\n     */\r\n    get startLifeTimeGradientMax(): GradientDataNumber {\r\n        return this._startLifeTimeGradientMax;\r\n    }\r\n\r\n    set startLifeTimeGradientMax(value: GradientDataNumber) {\r\n        if (this._startLifetimeType === 3) {\r\n            var i: number, n: number;\r\n            this._maxStartLifetime = -Number.MAX_VALUE;\r\n            for (i = 0, n = this._startLifeTimeGradientMin.gradientCount; i < n; i++)\r\n                this._maxStartLifetime = Math.max(this._maxStartLifetime, this._startLifeTimeGradientMin.getValueByIndex(i));\r\n            for (i = 0, n = value.gradientCount; i < n; i++)\r\n                this._maxStartLifetime = Math.max(this._maxStartLifetime, value.getValueByIndex(i));\r\n        }\r\n        this._startLifeTimeGradientMax = value;\r\n    }\r\n\r\n    /**\r\n     * ,:,\r\n     */\r\n    get velocityOverLifetime(): VelocityOverLifetime {\r\n        return this._velocityOverLifetime;\r\n    }\r\n\r\n    set velocityOverLifetime(value: VelocityOverLifetime) {\r\n        var shaDat: ShaderData = this._ownerRender._shaderValues;\r\n\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE);\r\n\r\n        this._velocityOverLifetime = value;\r\n\r\n        if (value) {\r\n            var velocity: GradientVelocity = value.velocity;\r\n            var velocityType: number = velocity.type;\r\n\r\n            if (value.enable) {\r\n                switch (velocityType) {\r\n                    case 0:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT);\r\n                        shaDat.setVector3(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYCONST, velocity.constant);\r\n                        break;\r\n                    case 1:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTX, velocity.gradientX._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTY, velocity.gradientY._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTZ, velocity.gradientZ._elements);\r\n                        break;\r\n                    case 2:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT);\r\n                        shaDat.setVector3(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYCONST, velocity.constantMin);\r\n                        shaDat.setVector3(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYCONSTMAX, velocity.constantMax);\r\n                        break;\r\n                    case 3:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTX, velocity.gradientXMin._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTXMAX, velocity.gradientXMax._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTY, velocity.gradientYMin._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTYMAX, velocity.gradientYMax._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTZ, velocity.gradientZMin._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTZMAX, velocity.gradientZMax._elements);\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n            shaDat.setInt(ShuriKenParticle3DShaderDeclaration.VOLSPACETYPE, value.space);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ,:,\r\n     */\r\n    get colorOverLifetime(): ColorOverLifetime {\r\n        return this._colorOverLifetime;\r\n    }\r\n\r\n    set colorOverLifetime(value: ColorOverLifetime) {\r\n        var shaDat: ShaderData = this._ownerRender._shaderValues;\r\n\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLOROVERLIFETIME);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RANDOMCOLOROVERLIFETIME);\r\n\r\n        this._colorOverLifetime = value;\r\n\r\n        if (value) {\r\n            var color: GradientColor = value.color;\r\n            if (value.enable) {\r\n                switch (color.type) {\r\n                    case 1:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLOROVERLIFETIME);\r\n\r\n                        let gradientColor: Gradient = color.gradient;\r\n                        let alphaElements:Float32Array = gradientColor.alphaElements;\r\n                        let rgbElements:Float32Array = gradientColor.rgbElements;\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTALPHAS, alphaElements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTCOLORS, rgbElements);\r\n                        let ranges = gradientColor._keyRanges;\r\n                        ranges.setValue(1, 0, 1, 0);\r\n                        for (let index = 0,n = Math.min(2,gradientColor.colorRGBKeysCount); index < n; index++) {\r\n                            let colorKey = rgbElements[index * 4];\r\n                            ranges.x = Math.min(ranges.x, colorKey);\r\n                            ranges.y = Math.max(ranges.y, colorKey);\r\n                        }\r\n                        for (let index = 0,n = Math.min(2,gradientColor.colorAlphaKeysCount); index < n; index++) {\r\n                            let alphaKey = alphaElements[index * 2];\r\n                            ranges.z = Math.min(ranges.z, alphaKey);\r\n                            ranges.w = Math.max(ranges.w, alphaKey);\r\n                        }\r\n                        shaDat.setVector(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTRANGES, ranges);\r\n\r\n                        if (gradientColor.maxColorAlphaKeysCount == 8) {\r\n                            shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLORKEYCOUNT_8);\r\n                        }\r\n                        else {\r\n                            shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLORKEYCOUNT_8);\r\n                        }\r\n                        break;\r\n                    case 3:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RANDOMCOLOROVERLIFETIME);\r\n\r\n                        let minGradientColor: Gradient = color.gradientMin;\r\n                        let maxGradientColor: Gradient = color.gradientMax;\r\n\r\n                        let minalphaElements:Float32Array = minGradientColor.alphaElements;\r\n                        let minrgbElements:Float32Array = minGradientColor.rgbElements;\r\n\r\n                        let maxalphaElements:Float32Array = maxGradientColor.alphaElements;\r\n                        let maxrgbElements:Float32Array = maxGradientColor.rgbElements;\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTALPHAS, minalphaElements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTCOLORS, minrgbElements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTALPHAS, maxalphaElements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTCOLORS, maxrgbElements);\r\n\r\n                        let minRanges = minGradientColor._keyRanges;\r\n                        minRanges.setValue(1, 0, 1, 0);\r\n                        for (let index = 0,n = Math.max(2,minGradientColor.colorRGBKeysCount); index < n; index++) {\r\n                            let colorKey = minrgbElements[index * 4];\r\n                            minRanges.x = Math.min(minRanges.x, colorKey);\r\n                            minRanges.y = Math.max(minRanges.y, colorKey);\r\n                        }\r\n                        for (let index = 0,n = Math.max(2,minGradientColor.colorAlphaKeysCount); index < n; index++) {\r\n                            let alphaKey = minalphaElements[index * 2];\r\n                            minRanges.z = Math.min(minRanges.z, alphaKey);\r\n                            minRanges.w = Math.max(minRanges.w, alphaKey);\r\n                        }\r\n                        shaDat.setVector(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTRANGES, minRanges);\r\n                        let maxRanges = maxGradientColor._keyRanges;\r\n                        maxRanges.setValue(1, 0, 1, 0);\r\n                        for (let index = 0,n = Math.max(2,maxGradientColor.colorRGBKeysCount); index < n; index++) {\r\n                            let colorKey = maxrgbElements[index * 4];\r\n                            maxRanges.x = Math.min(maxRanges.x, colorKey);\r\n                            maxRanges.y = Math.max(maxRanges.y, colorKey);\r\n                        }\r\n                        for (let index = 0,n = Math.max(2,maxGradientColor.colorAlphaKeysCount); index < n; index++) {\r\n                            let alphaKey = maxalphaElements[index * 2];\r\n                            maxRanges.z = Math.min(maxRanges.z, alphaKey);\r\n                            maxRanges.w = Math.max(maxRanges.w, alphaKey);\r\n                        }\r\n                        shaDat.setVector(ShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTRANGES, maxRanges);\r\n\r\n                        let maxkeyCount = Math.max(minGradientColor.maxColorAlphaKeysCount, maxGradientColor.maxColorAlphaKeysCount);\r\n                        if (maxkeyCount == 8) {\r\n                            shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLORKEYCOUNT_8);\r\n                        }\r\n                        else {\r\n                            shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLORKEYCOUNT_8);\r\n                        }\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ,:,\r\n     */\r\n    get sizeOverLifetime(): SizeOverLifetime {\r\n        return this._sizeOverLifetime;\r\n    }\r\n\r\n    set sizeOverLifetime(value: SizeOverLifetime) {\r\n        var shaDat: ShaderData = this._ownerRender._shaderValues;\r\n\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMECURVE);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE);\r\n\r\n        this._sizeOverLifetime = value;\r\n\r\n        if (value) {\r\n            var size: GradientSize = value.size;\r\n            var sizeSeparate: boolean = size.separateAxes;\r\n            var sizeType: number = size.type;\r\n            if (value.enable) {\r\n                switch (sizeType) {\r\n                    case 0:\r\n                        if (sizeSeparate) {\r\n                            shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE);\r\n\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTX, size.gradientX._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTY, size.gradientY._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSizeGradientZ, size.gradientZ._elements);\r\n                        }\r\n                        else {\r\n                            shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMECURVE);\r\n\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENT, size.gradient._elements);\r\n                        }\r\n                        break;\r\n                    case 2:\r\n                        if (sizeSeparate) {\r\n                            shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE);\r\n\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTX, size.gradientXMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTXMAX, size.gradientXMax._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTY, size.gradientYMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTYMAX, size.gradientYMax._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSizeGradientZ, size.gradientZMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSizeGradientZMAX, size.gradientZMax._elements);\r\n                        }\r\n                        else {\r\n                            shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES);\r\n\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENT, size.gradientMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSizeGradientMax, size.gradientMax._elements);\r\n                        }\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ,:,\r\n     */\r\n    get rotationOverLifetime(): RotationOverLifetime {\r\n        return this._rotationOverLifetime;\r\n    }\r\n\r\n    set rotationOverLifetime(value: RotationOverLifetime) {\r\n        var shaDat: ShaderData = this._ownerRender._shaderValues;\r\n\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIME);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES);\r\n\r\n        this._rotationOverLifetime = value;\r\n\r\n        if (value) {\r\n            var rotation: GradientAngularVelocity = value.angularVelocity;\r\n\r\n            if (!rotation)//TODO:RotationOverLifetime\r\n                return\r\n\r\n            var rotationSeparate: boolean = rotation.separateAxes;\r\n            var rotationType: number = rotation.type;\r\n            if (value.enable) {\r\n                if (rotationSeparate) {\r\n                    shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE);\r\n                }\r\n                else {\r\n                    shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIME);\r\n                }\r\n                switch (rotationType) {\r\n                    case 0:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT);\r\n                        if (rotationSeparate) {\r\n                            shaDat.setVector3(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTSEPRARATE, rotation.constantSeparate);\r\n                        }\r\n                        else {\r\n                            shaDat.setNumber(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONST, rotation.constant);\r\n                        }\r\n                        break;\r\n                    case 1:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE);\r\n                        if (rotationSeparate) {\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTX, rotation.gradientX._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTY, rotation.gradientY._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTZ, rotation.gradientZ._elements);\r\n                        }\r\n                        else {\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENT, rotation.gradient._elements);\r\n                        }\r\n                        break;\r\n                    case 2:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS);\r\n                        if (rotationSeparate) {\r\n                            shaDat.setVector3(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTSEPRARATE, rotation.constantMinSeparate);\r\n                            shaDat.setVector3(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTMAXSEPRARATE, rotation.constantMaxSeparate);\r\n                        }\r\n                        else {\r\n                            shaDat.setNumber(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONST, rotation.constantMin);\r\n                            shaDat.setNumber(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTMAX, rotation.constantMax);\r\n                        }\r\n                        break;\r\n                    case 3:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES);\r\n                        if (rotationSeparate) {\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTX, rotation.gradientXMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTXMAX, rotation.gradientXMax._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTY, rotation.gradientYMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTYMAX, rotation.gradientYMax._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTZ, rotation.gradientZMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTZMAX, rotation.gradientZMax._elements);\r\n                            //shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTW, rotation.gradientWMin._elements);\r\n                            //shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTWMAX, rotation.gradientWMax._elements);\r\n                        }\r\n                        else {\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENT, rotation.gradientMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTMAX, rotation.gradientMax._elements);\r\n                        }\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ,:,\r\n     */\r\n    get textureSheetAnimation(): TextureSheetAnimation {\r\n        return this._textureSheetAnimation;\r\n    }\r\n\r\n    set textureSheetAnimation(value: TextureSheetAnimation) {\r\n        var shaDat: ShaderData = this._ownerRender._shaderValues;\r\n\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE);\r\n\r\n        this._textureSheetAnimation = value;\r\n\r\n        if (value) {\r\n            var frameOverTime: FrameOverTime = value.frame;\r\n            var textureAniType: number = frameOverTime.type;\r\n            if (value.enable) {\r\n                switch (textureAniType) {\r\n                    case 1:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE);\r\n\r\n                        shaDat.setNumber(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONCYCLES, value.cycles);\r\n                        var title: Vector2 = value.tiles;\r\n                        var _uvLengthE: Vector2 = this._uvLength;\r\n                        _uvLengthE.x = 1.0 / title.x;\r\n                        _uvLengthE.y = 1.0 / title.y;\r\n                        shaDat.setVector2(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONSUBUVLENGTH, this._uvLength);\r\n\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONGRADIENTUVS, frameOverTime.frameOverTimeData._elements);\r\n                        break;\r\n                    case 3:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE);\r\n\r\n                        shaDat.setNumber(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONCYCLES, value.cycles);\r\n                        var title: Vector2 = value.tiles;\r\n                        var _uvLengthE: Vector2 = this._uvLength;\r\n                        _uvLengthE.x = 1.0 / title.x;\r\n                        _uvLengthE.y = 1.0 / title.y;\r\n                        shaDat.setVector2(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONSUBUVLENGTH, this._uvLength);\r\n\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONGRADIENTUVS, frameOverTime.frameOverTimeDataMin._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONGRADIENTMAXUVS, frameOverTime.frameOverTimeDataMax._elements);\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    constructor(render: ShurikenParticleRenderer, meshTopology: MeshTopology = MeshTopology.Triangles, drawType: DrawType = DrawType.DrawElement) {\r\n        super(meshTopology, drawType);\r\n        this.indexFormat = IndexFormat.UInt16;\r\n\r\n        this._firstActiveElement = 0;\r\n        this._firstNewElement = 0;\r\n        this._firstFreeElement = 0;\r\n        this._firstRetiredElement = 0;\r\n\r\n        this._owner = render.owner as Sprite3D;\r\n        this._ownerRender = render;\r\n        this._useCustomBounds = false;\r\n\r\n        this._currentTime = 0;\r\n        this._bounds = new Bounds(new Vector3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE), new Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE));\r\n        this.bufferState = this._bufferState = new BufferState();\r\n        this._isEmitting = false;\r\n        this._isPlaying = false;\r\n        this._isPaused = false;\r\n        this._burstsIndex = 0;\r\n        this._frameRateTime = 0;\r\n        this._emissionTime = 0;\r\n        this._totalDelayTime = 0;\r\n        this._simulateUpdate = false;\r\n\r\n        this._bufferMaxParticles = 1;\r\n        this.duration = 5.0;\r\n        this.looping = true;\r\n        this.prewarm = false;\r\n        this.startDelayType = 0;\r\n        this.startDelay = 0.0;\r\n        this.startDelayMin = 0.0;\r\n        this.startDelayMax = 0.0;\r\n\r\n        this._startLifetimeType = 0;\r\n        this._startLifetimeConstant = 5.0;\r\n        this._startLifeTimeGradient = new GradientDataNumber();\r\n        this._startLifetimeConstantMin = 0.0;\r\n        this._startLifetimeConstantMax = 5.0;\r\n        this._startLifeTimeGradientMin = new GradientDataNumber();\r\n        this._startLifeTimeGradientMax = new GradientDataNumber();\r\n        this._maxStartLifetime = 5.0;//_startLifetimeType0_startLifetimeConstant5.0,5.0\r\n\r\n        this.startSpeedType = 0;\r\n        this.startSpeedConstant = 5.0;\r\n        this.startSpeedConstantMin = 0.0;\r\n        this.startSpeedConstantMax = 5.0;\r\n\r\n        //drag\r\n        this.dragType = 0;\r\n        this.dragConstant = 0;\r\n        this.dragSpeedConstantMin = 0;\r\n        this.dragSpeedConstantMax = 0;\r\n\r\n        this.threeDStartSize = false;\r\n        this.startSizeType = 0;\r\n        this.startSizeConstant = 1;\r\n        this.startSizeConstantSeparate = new Vector3(1, 1, 1);\r\n        this.startSizeConstantMin = 0;\r\n        this.startSizeConstantMax = 1;\r\n        this.startSizeConstantMinSeparate = new Vector3(0, 0, 0);\r\n        this.startSizeConstantMaxSeparate = new Vector3(1, 1, 1);\r\n\r\n        this.threeDStartRotation = false;\r\n        this.startRotationType = 0;\r\n        this.startRotationConstant = 0;\r\n        this.startRotationConstantSeparate = new Vector3(0, 0, 0);\r\n        this.startRotationConstantMin = 0.0;\r\n        this.startRotationConstantMax = 0.0;\r\n        this.startRotationConstantMinSeparate = new Vector3(0, 0, 0);\r\n        this.startRotationConstantMaxSeparate = new Vector3(0, 0, 0);\r\n\r\n        this.gravityModifier = 0.0;\r\n        this.simulationSpace = 1;\r\n        this.scaleMode = 1;\r\n        this.playOnAwake = true;\r\n        this._rand = new Rand(0);\r\n        this.autoRandomSeed = true;\r\n        this.randomSeed = new Uint32Array(1);\r\n        this._randomSeeds = new Uint32Array(ShurikenParticleSystem._RANDOMOFFSET.length);\r\n        this.isPerformanceMode = true;\r\n\r\n        this._emission = new Emission();\r\n        this._emission.enable = true;\r\n        //set GeometryElement\r\n\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getVertexBuffer(index: number = 0): VertexBuffer3D {\r\n        if (index === 0)\r\n            return this._vertexBuffer;\r\n        else\r\n            return null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getIndexBuffer(): IndexBuffer3D {\r\n        return this._indexBuffer;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _generateBounds(): void {\r\n        var particleRender: ShurikenParticleRenderer = this._ownerRender;\r\n        var boundsMin: Vector3 = this._bounds.getMin();\r\n        var boundsMax: Vector3 = this._bounds.getMax();\r\n\r\n        // lifeTime\r\n        var time: number = 0;\r\n        switch (this.startLifetimeType) {\r\n            case 0: // \r\n                time = this._startLifetimeConstant;\r\n                break;\r\n            case 2: // \r\n                time = this._startLifetimeConstantMax;\r\n                break;\r\n            case 1: // \r\n            case 3: // \r\n            default:\r\n                // todo \r\n                break;\r\n        }\r\n\r\n        // speed\r\n        var speedOrigan: number = 0;\r\n        switch (this.startSpeedType) {\r\n            case 0: // \r\n                speedOrigan = this.startSpeedConstant;\r\n                break;\r\n            case 2: // \r\n                speedOrigan = this.startSpeedConstantMax;\r\n                break;\r\n            case 1:\r\n            case 3:\r\n            default:\r\n                // todo \r\n                break;\r\n        }\r\n\r\n        // size\r\n        var maxSizeScale = 0;\r\n        if (this.threeDStartSize) {\r\n            switch (this.startSizeType) {\r\n                case 0: // \r\n                    maxSizeScale = Math.max(this.startSizeConstantSeparate.x, this.startSizeConstantSeparate.y, this.startSizeConstantSeparate.z);\r\n                    break;\r\n                case 2: // \r\n                    maxSizeScale = Math.max(this.startSizeConstantMaxSeparate.x, this.startSizeConstantMaxSeparate.y, this.startSizeConstantMaxSeparate.z);\r\n                    break;\r\n                case 1:\r\n                case 3:\r\n                default:\r\n                    // todo \r\n                    break;\r\n            }\r\n        }\r\n        else {\r\n            switch (this.startSizeType) {\r\n                case 0: // \r\n                    maxSizeScale = this.startSizeConstant;\r\n                    break;\r\n                case 2: // \r\n                    maxSizeScale = this.startSizeConstantMax;\r\n                    break;\r\n                case 1:\r\n                case 3:\r\n                default:\r\n                    // todo \r\n                    break;\r\n            }\r\n        }\r\n\r\n        // shape\r\n        var zDirectionSpeed: Vector3 = ShurikenParticleSystem._tempVector30;\r\n        var fDirectionSpeed: Vector3 = ShurikenParticleSystem._tempVector31;\r\n        var zEmisionOffsetXYZ: Vector3 = ShurikenParticleSystem._tempVector32;\r\n        var fEmisionOffsetXYZ: Vector3 = ShurikenParticleSystem._tempVector33;\r\n\r\n        zDirectionSpeed.setValue(0, 0, 1);\r\n        fDirectionSpeed.setValue(0, 0, 0);\r\n        zEmisionOffsetXYZ.setValue(0, 0, 0);\r\n        fEmisionOffsetXYZ.setValue(0, 0, 0);\r\n\r\n        if (this.shape && this.shape.enable) {\r\n            switch (this.shape.shapeType) {\r\n                case ParticleSystemShapeType.Sphere:\r\n                    var sphere: SphereShape = <SphereShape>this.shape;\r\n                    zDirectionSpeed.setValue(1, 1, 1);\r\n                    fDirectionSpeed.setValue(1, 1, 1);\r\n                    zEmisionOffsetXYZ.setValue(sphere.radius, sphere.radius, sphere.radius);\r\n                    fEmisionOffsetXYZ.setValue(sphere.radius, sphere.radius, sphere.radius);\r\n                    break;\r\n                case ParticleSystemShapeType.Hemisphere:\r\n                    var hemiShpere: HemisphereShape = <HemisphereShape>this.shape;\r\n                    zDirectionSpeed.setValue(1, 1, 1);\r\n                    fDirectionSpeed.setValue(1, 1, 1);\r\n                    zEmisionOffsetXYZ.setValue(hemiShpere.radius, hemiShpere.radius, hemiShpere.radius);\r\n                    fEmisionOffsetXYZ.setValue(hemiShpere.radius, hemiShpere.radius, 0.0);\r\n                    break;\r\n                case ParticleSystemShapeType.Cone:\r\n                    var cone: ConeShape = <ConeShape>this.shape;\r\n                    // Base || BaseShell\r\n                    if (cone.emitType == 0 || cone.emitType == 1) {\r\n                        // todo angle define\r\n                        // var angle: number = cone.angle * Math.PI / 180;\r\n                        var angle: number = cone.angle;\r\n                        var sinAngle: number = Math.sin(angle);\r\n                        zDirectionSpeed.setValue(sinAngle, sinAngle, 1.0);\r\n                        fDirectionSpeed.setValue(sinAngle, sinAngle, 0.0);\r\n                        zEmisionOffsetXYZ.setValue(cone.radius, cone.radius, 0.0);\r\n                        fEmisionOffsetXYZ.setValue(cone.radius, cone.radius, 0.0);\r\n                        break;\r\n                    }\r\n                    // Volume || VolumeShell\r\n                    else if (cone.emitType == 2 || cone.emitType == 3) {\r\n                        // var angle: number = cone.angle * Math.PI / 180;\r\n                        var angle: number = cone.angle;\r\n                        var sinAngle: number = Math.sin(angle);\r\n                        var coneLength: number = cone.length;\r\n                        zDirectionSpeed.setValue(sinAngle, sinAngle, 1.0);\r\n                        fDirectionSpeed.setValue(sinAngle, sinAngle, 0.0);\r\n                        var tanAngle: number = Math.tan(angle);\r\n                        var rPLCT: number = cone.radius + coneLength * tanAngle;\r\n                        zEmisionOffsetXYZ.setValue(rPLCT, rPLCT, coneLength);\r\n                        fEmisionOffsetXYZ.setValue(rPLCT, rPLCT, 0.0);\r\n                    }\r\n                    break;\r\n                case ParticleSystemShapeType.Box:\r\n                    var box: BoxShape = <BoxShape>this.shape;\r\n                    if (this.shape.randomDirection != 0) {\r\n                        zDirectionSpeed.setValue(1, 1, 1);\r\n                        fDirectionSpeed.setValue(1, 1, 1);\r\n                    }\r\n                    zEmisionOffsetXYZ.setValue(box.x / 2, box.y / 2, box.z / 2);\r\n                    fEmisionOffsetXYZ.setValue(box.x / 2, box.y / 2, box.z / 2);\r\n                    break;\r\n                case ParticleSystemShapeType.Circle:\r\n                    var circle: CircleShape = <CircleShape>this.shape;\r\n                    zDirectionSpeed.setValue(1, 1, 1);\r\n                    fDirectionSpeed.setValue(1, 1, 1);\r\n                    zEmisionOffsetXYZ.setValue(circle.radius, circle.radius, 0);\r\n                    fEmisionOffsetXYZ.setValue(circle.radius, circle.radius, 0);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n\r\n        // size\r\n        var meshSize: number = 0;\r\n        //  mesh \r\n        var meshMode: boolean = particleRender.renderMode == 4;\r\n        switch (particleRender.renderMode) {\r\n            case 0: // billboard\r\n            case 1:\r\n            case 2:\r\n            case 3:\r\n                meshSize = ShurikenParticleSystem.halfKSqrtOf2;// Math.sqrt(2) / 2.0;\r\n                break;\r\n            case 4: // mesh\r\n                var meshBounds: Bounds = particleRender.mesh.bounds;\r\n                meshSize = Math.sqrt(Math.pow(meshBounds.getExtent().x, 2.0) + Math.pow(meshBounds.getExtent().y, 2.0) + Math.pow(meshBounds.getExtent().z, 2.0));\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        var endSizeOffset: Vector3 = ShurikenParticleSystem._tempVector36;\r\n        endSizeOffset.setValue(1, 1, 1);\r\n        if (this.sizeOverLifetime && this.sizeOverLifetime.enable) {\r\n            var gradientSize: GradientSize = this.sizeOverLifetime.size;\r\n            var maxSize: number = gradientSize.getMaxSizeInGradient(meshMode);\r\n\r\n            endSizeOffset.setValue(maxSize, maxSize, maxSize);\r\n        }\r\n\r\n        var offsetSize: number = meshSize * maxSizeScale;\r\n        Vector3.scale(endSizeOffset, offsetSize, endSizeOffset);\r\n\r\n        // var distance: number = speedOrigan * time;\r\n        var speedZOffset: Vector3 = ShurikenParticleSystem._tempVector34;\r\n        var speedFOffset: Vector3 = ShurikenParticleSystem._tempVector35;\r\n\r\n        if (speedOrigan > 0) {\r\n            Vector3.scale(zDirectionSpeed, speedOrigan, speedZOffset);\r\n            Vector3.scale(fDirectionSpeed, speedOrigan, speedFOffset);\r\n        }\r\n        else {\r\n            Vector3.scale(zDirectionSpeed, -speedOrigan, speedFOffset);\r\n            Vector3.scale(fDirectionSpeed, -speedOrigan, speedZOffset);\r\n        }\r\n\r\n        if (this.velocityOverLifetime && this.velocityOverLifetime.enable) {\r\n            var gradientVelocity: GradientVelocity = this.velocityOverLifetime.velocity;\r\n            var velocitySpeedOffset: Vector3 = ShurikenParticleSystem._tempVector37;\r\n            velocitySpeedOffset.setValue(0, 0, 0);\r\n            switch (gradientVelocity.type) {\r\n                case 0: // \r\n                    gradientVelocity.constant.cloneTo(velocitySpeedOffset);\r\n                    break;\r\n                case 2: // \r\n                    gradientVelocity.constantMax.cloneTo(velocitySpeedOffset);\r\n                    break;\r\n                case 1: // \r\n                    // todo  \r\n                    var curveX: number = gradientVelocity.gradientX.getAverageValue();\r\n                    var curveY: number = gradientVelocity.gradientY.getAverageValue();\r\n                    var curveZ: number = gradientVelocity.gradientZ.getAverageValue();\r\n                    velocitySpeedOffset.setValue(curveX, curveY, curveZ);\r\n                    break;\r\n                case 3: // \r\n                    var xMax: number = gradientVelocity.gradientXMax.getAverageValue();\r\n                    var yMax: number = gradientVelocity.gradientYMax.getAverageValue();\r\n                    var zMax: number = gradientVelocity.gradientZMax.getAverageValue();\r\n                    velocitySpeedOffset.setValue(xMax, yMax, zMax);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n\r\n            //  world\r\n            if (this.velocityOverLifetime.space == 1) {\r\n                Vector3.transformV3ToV3(velocitySpeedOffset, this._owner.transform.worldMatrix, velocitySpeedOffset);\r\n            }\r\n\r\n            Vector3.add(speedZOffset, velocitySpeedOffset, speedZOffset);\r\n            Vector3.subtract(speedFOffset, velocitySpeedOffset, speedFOffset);\r\n\r\n            Vector3.max(speedZOffset, Vector3.ZERO, speedZOffset);\r\n            Vector3.max(speedFOffset, Vector3.ZERO, speedFOffset);\r\n        }\r\n\r\n        Vector3.scale(speedZOffset, time, speedZOffset);\r\n        Vector3.scale(speedFOffset, time, speedFOffset);\r\n\r\n        //gravity\r\n        var gravity: number = this.gravityModifier;\r\n        if (gravity != 0) {\r\n            // \r\n            var gravityOffset: number = 0.5 * ShurikenParticleSystem.g * gravity * time * time;\r\n\r\n            var speedZOffsetY = speedZOffset.y - gravityOffset;\r\n            var speedFOffsetY = speedFOffset.y + gravityOffset;\r\n\r\n            speedZOffsetY = speedZOffsetY > 0 ? speedZOffsetY : 0;\r\n            speedFOffsetY = speedFOffsetY > 0 ? speedFOffsetY : 0;\r\n\r\n            this._gravityOffset.setValue(speedZOffset.y - speedZOffsetY, speedFOffsetY - speedFOffset.y);\r\n        }\r\n\r\n        // speedOrigan * directionSpeed * time + directionoffset + size * maxsizeScale\r\n        Vector3.add(speedZOffset, endSizeOffset, boundsMax);\r\n        Vector3.add(boundsMax, zEmisionOffsetXYZ, boundsMax);\r\n\r\n        Vector3.add(speedFOffset, endSizeOffset, boundsMin);\r\n        Vector3.add(boundsMin, fEmisionOffsetXYZ, boundsMin);\r\n        Vector3.scale(boundsMin, -1, boundsMin);\r\n\r\n        this._bounds.setMin(boundsMin);\r\n        this._bounds.setMax(boundsMax);\r\n    }\r\n\r\n    /**\r\n     *   \r\n     */\r\n    get customBounds(): Bounds {\r\n        return this._customBounds;\r\n    }\r\n\r\n    set customBounds(value: Bounds) {\r\n        if (value) {\r\n            this._useCustomBounds = true;\r\n            if (!this._customBounds) {\r\n                this._customBounds = new Bounds(new Vector3(), new Vector3());\r\n                this._ownerRender.geometryBounds = this._customBounds;\r\n            }\r\n            this._customBounds = value;\r\n\r\n        }\r\n        else {\r\n            this._useCustomBounds = false;\r\n            this._customBounds = null;\r\n            this._ownerRender.geometryBounds = null;\r\n        }\r\n\r\n\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _simulationSupported(): boolean {\r\n\r\n        if (this.simulationSpace == 0 && this.emission.emissionRateOverDistance > 0) {\r\n            return false;\r\n        }\r\n\r\n        // todo other propertys break procedural \r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    protected _updateEmission(): void {\r\n        if (!this.isAlive)\r\n            return;\r\n        if (this._simulateUpdate) {\r\n            this._simulateUpdate = false;\r\n        }\r\n        else {\r\n            var elapsedTime: number = ((this._startUpdateLoopCount !== Stat.loopCount && !this._isPaused) && (<Scene3D>this._owner._scene)) ? ((<Scene3D>this._owner._scene)).timer._delta / 1000.0 : 0;\r\n            elapsedTime = Math.min(ShurikenParticleSystem._maxElapsedTime, elapsedTime * this.simulationSpeed);\r\n            this._updateParticles(elapsedTime);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    protected _updateParticles(elapsedTime: number): void {\r\n        if (this._ownerRender.renderMode === 4 && !this._ownerRender.mesh)//renderMode=4mesh\r\n            return;\r\n\r\n        this._currentTime += elapsedTime;//\r\n        this._retireActiveParticles();\r\n        this._freeRetiredParticles();\r\n\r\n        //if (_firstActiveElement === _firstFreeElement){\r\n        //_frameRateTime = 0//TODO:\r\n        //_currentTime = 0;\r\n        //}\r\n        //if (_firstRetiredElement === _firstActiveElement)\r\n        //_drawCounter = 0;\r\n\r\n        this._totalDelayTime += elapsedTime;\r\n        if (this._totalDelayTime < this._playStartDelay) {\r\n            return;\r\n        }\r\n\r\n\r\n        if (this._emission.enable && this._isEmitting && !this._isPaused) {\r\n            this._advanceTime(elapsedTime, this._currentTime);\r\n            if (this.emission.emissionRateOverDistance > 0) {\r\n                this._advanceDistance(this._currentTime);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _updateParticlesSimulationRestart(time: number): void {\r\n        this._firstActiveElement = 0;\r\n        this._firstNewElement = 0;\r\n        this._firstFreeElement = 0;\r\n        this._firstRetiredElement = 0;\r\n\r\n        this._burstsIndex = 0;\r\n        this._frameRateTime = time;//TOD0:time \r\n        this._emissionTime = 0;\r\n        this._emissionDistance = 0;\r\n        this._totalDelayTime = 0;\r\n        this._currentTime = time;\r\n\r\n\r\n        var delayTime: number = time;\r\n        if (delayTime < this._playStartDelay) {\r\n            this._totalDelayTime = delayTime;\r\n            return;\r\n        }\r\n\r\n        if (this._emission.enable) {\r\n            this._advanceTime(time, time);//TODO:timetimebrust\r\n            if (this.emission.emissionRateOverDistance > 0) {\r\n                this._advanceDistance(this._currentTime);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _retireActiveParticles(): void {\r\n        const epsilon: number = 0.0001;\r\n        while (this._firstActiveElement != this._firstNewElement) {\r\n            var index: number = this._firstActiveElement * this._floatCountPerVertex * this._vertexStride;\r\n            var timeIndex: number = index + this._timeIndex;//11Time\r\n\r\n            var particleAge: number = this._currentTime - this._vertices[timeIndex];\r\n            if (particleAge + epsilon < this._vertices[index + this._startLifeTimeIndex]/*_maxLifeTime*/)//7lifeTime,particleAge>0\r\n                break;\r\n\r\n            this._vertices[timeIndex] = this._drawCounter;\r\n            this._firstActiveElement++;\r\n            if (this._firstActiveElement >= this._bufferMaxParticles)\r\n                this._firstActiveElement = 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _freeRetiredParticles(): void {\r\n        while (this._firstRetiredElement != this._firstActiveElement) {\r\n            var age: number = this._drawCounter - this._vertices[this._firstRetiredElement * this._floatCountPerVertex * this._vertexStride + this._timeIndex];//11Time\r\n            //TODObug\r\n            if (false)\r\n                if (age < 3)//GPUCPUBUG\r\n                    break;\r\n\r\n            this._firstRetiredElement++;\r\n            if (this._firstRetiredElement >= this._bufferMaxParticles)\r\n                this._firstRetiredElement = 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal5\r\n     * \r\n     */\r\n    protected _burst(fromTime: number, toTime: number): number {\r\n        var totalEmitCount: number = 0;\r\n        var bursts: Burst[] = this._emission._bursts;\r\n        for (var n: number = bursts.length; this._burstsIndex < n; this._burstsIndex++) {//TODO:_burstsIndex\r\n            var burst: Burst = bursts[this._burstsIndex];\r\n            var burstTime: number = burst.time;\r\n            if (fromTime <= burstTime && burstTime < toTime) {\r\n                var emitCount: number;\r\n                if (this.autoRandomSeed) {\r\n                    emitCount = MathUtil.lerp(burst.minCount, burst.maxCount, Math.random());\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[0];\r\n                    emitCount = MathUtil.lerp(burst.minCount, burst.maxCount, this._rand.getFloat());\r\n                    this._randomSeeds[0] = this._rand.seed;\r\n                }\r\n                totalEmitCount += emitCount;\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n        return totalEmitCount;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _advanceTime(elapsedTime: number, emitTime: number): void {\r\n        var i: number;\r\n        var lastEmissionTime: number = this._emissionTime;\r\n        this._emissionTime += elapsedTime;\r\n        var totalEmitCount: number = 0;\r\n        if (this._emissionTime > this.duration) {\r\n            if (this.looping) {//TODO:while\r\n                totalEmitCount += this._burst(lastEmissionTime, this._emissionTime);//_emissionTimedurationtimedurationburst ////TODO:_playbackTime//TODO:\r\n                this._emissionTime -= this.duration;\r\n                this._burstsIndex = 0;\r\n                totalEmitCount += this._burst(0, this._emissionTime);\r\n            } else {\r\n                totalEmitCount = Math.min(this.maxParticles - this.aliveParticleCount, totalEmitCount);\r\n                for (i = 0; i < totalEmitCount; i++)\r\n                    this.emit(emitTime);\r\n\r\n                this._isPlaying = false;\r\n                this.stop();\r\n                return;\r\n            }\r\n        } else {\r\n            totalEmitCount += this._burst(lastEmissionTime, this._emissionTime);\r\n        }\r\n        //maxParticles\r\n        totalEmitCount = Math.min(this.maxParticles - this.aliveParticleCount, totalEmitCount);\r\n        for (i = 0; i < totalEmitCount; i++)\r\n            this.emit(emitTime);\r\n        //\r\n        var emissionRate: number = this.emission.emissionRate;\r\n        if (emissionRate > 0) {\r\n            //\r\n            var minEmissionTime: number = 1 / emissionRate;\r\n            this._frameRateTime += minEmissionTime;\r\n            this._frameRateTime = this._currentTime - (this._currentTime - this._frameRateTime) % this._maxStartLifetime;//,TODO:\r\n            while (this._frameRateTime <= emitTime) {\r\n                if (this.emit(this._frameRateTime))\r\n                    this._frameRateTime += minEmissionTime;\r\n                else\r\n                    break;\r\n            }\r\n            this._frameRateTime = Math.floor(emitTime / minEmissionTime) * minEmissionTime;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _advanceDistance(emitTime: number): void {\r\n        let position = this._owner.transform.position;\r\n        let offsetDistance: number = Vector3.distance(position, this._emissionLastPosition);\r\n\r\n        let rateOverDistance = this.emission.emissionRateOverDistance;\r\n\r\n        let distance = this._emissionDistance + offsetDistance;\r\n\r\n        let ed = 1.0 / rateOverDistance;\r\n        if (distance > ed) {\r\n            let emitCount = distance * rateOverDistance;\r\n            emitCount = Math.floor(emitCount);\r\n            emitCount = Math.min(this.maxParticles - this.aliveParticleCount, emitCount);\r\n            for (let index = 0; index < emitCount; index++) {\r\n                this.emit(emitTime);\r\n            }\r\n            // console.log(\"emission distance: \", distance, \", count: \", emitCount);\r\n\r\n            this._emissionDistance = 0;\r\n        }\r\n        else {\r\n            this._emissionDistance = distance;\r\n        }\r\n\r\n        position.cloneTo(this._emissionLastPosition);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _initBufferDatas(): void {\r\n        if (this._vertexBuffer) {//maxCountrenderModeMesh\r\n            var memorySize: number = this._vertexBuffer._byteLength + this._indexBuffer.indexCount * 2;\r\n            this._vertexBuffer.destroy();\r\n            this._indexBuffer.destroy();\r\n            Resource._addMemory(-memorySize, -memorySize);\r\n            //TODO:some time use clone will cause this call twice(from 'maxParticleCount' and 'renderMode'),this should optimization rewrite with special clone fun.\r\n        }\r\n        var render: ShurikenParticleRenderer = this._ownerRender;\r\n        var renderMode: number = render.renderMode;\r\n\r\n        if (renderMode !== -1 && this.maxParticles > 0) {\r\n            var indices: Uint16Array, i: number, j: number, m: number, indexOffset: number, perPartOffset: number, vertexDeclaration: VertexDeclaration;\r\n            var vbMemorySize: number = 0, memorySize: number = 0;\r\n            var mesh: Mesh = render.mesh;\r\n            if (renderMode === 4) {\r\n                if (mesh) {\r\n                    // var vertexBufferCount: number = mesh._vertexBuffers.length;\r\n                    // if (vertexBufferCount > 1) {\r\n                    // \tthrow new Error(\"ShurikenParticleSystem: submesh Count mesh be One or all subMeshes have the same vertexDeclaration.\");\r\n                    // } else {\r\n                    vertexDeclaration = VertexShurikenParticleMesh.vertexDeclaration;\r\n                    this._floatCountPerVertex = vertexDeclaration.vertexStride / 4;\r\n                    this._simulationUV_Index = vertexDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_SIMULATIONUV).offset / 4;\r\n                    this._startLifeTimeIndex = 12;\r\n                    this._timeIndex = 16;\r\n                    this._vertexStride = mesh._vertexCount;\r\n                    var totalVertexCount: number = this._bufferMaxParticles * this._vertexStride;\r\n                    var vbCount: number = Math.floor(totalVertexCount / 65535) + 1;\r\n                    var lastVBVertexCount: number = totalVertexCount % 65535;\r\n                    if (vbCount > 1) {//TODO:\r\n                        throw new Error(\"ShurikenParticleSystem:the maxParticleCount multiply mesh vertexCount is large than 65535.\");\r\n                    }\r\n\r\n                    vbMemorySize = vertexDeclaration.vertexStride * lastVBVertexCount;\r\n                    this._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vbMemorySize, BufferUsage.Dynamic, false);\r\n                    this._vertexBuffer.vertexDeclaration = vertexDeclaration;\r\n                    this._vertices = new Float32Array(this._floatCountPerVertex * lastVBVertexCount);\r\n\r\n                    // if (render.renderMode == 4) {\r\n                    // \tthis.initVertexWithMesh(this._vertices, mesh);\r\n                    // }\r\n\r\n                    this._indexStride = mesh._indexBuffer.indexCount;\r\n                    var indexDatas: Uint16Array = mesh._indexBuffer.getData();\r\n                    var indexCount: number = this._bufferMaxParticles * this._indexStride;\r\n                    this._indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, indexCount, BufferUsage.Static, false);\r\n                    indices = new Uint16Array(indexCount);\r\n\r\n                    memorySize = vbMemorySize + indexCount * 2;\r\n\r\n                    indexOffset = 0;\r\n                    for (i = 0; i < this._bufferMaxParticles; i++) {\r\n                        var indexValueOffset: number = i * this._vertexStride;\r\n                        for (j = 0, m = indexDatas.length; j < m; j++)\r\n                            indices[indexOffset++] = indexValueOffset + indexDatas[j];\r\n                    }\r\n                    this._indexBuffer.setData(indices);\r\n                    this._bufferState.applyState([this._vertexBuffer], this._indexBuffer);\r\n                    this.bufferState = this._bufferState;\r\n                }\r\n            } else {\r\n                vertexDeclaration = VertexShurikenParticleBillboard.vertexDeclaration;\r\n                this._floatCountPerVertex = vertexDeclaration.vertexStride / 4;\r\n                this._startLifeTimeIndex = 7;\r\n                this._simulationUV_Index = vertexDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_SIMULATIONUV).offset / 4;\r\n                this._timeIndex = 11;\r\n                this._vertexStride = 4;\r\n                vbMemorySize = vertexDeclaration.vertexStride * this._bufferMaxParticles * this._vertexStride;\r\n                this._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vbMemorySize, BufferUsage.Dynamic, false);\r\n                this._vertexBuffer.vertexDeclaration = vertexDeclaration;\r\n                this._vertices = new Float32Array(this._floatCountPerVertex * this._bufferMaxParticles * this._vertexStride);\r\n\r\n\r\n                for (i = 0; i < this._bufferMaxParticles; i++) {\r\n                    perPartOffset = i * this._floatCountPerVertex * this._vertexStride;\r\n                    this._vertices[perPartOffset] = -0.5;\r\n                    this._vertices[perPartOffset + 1] = -0.5;\r\n                    this._vertices[perPartOffset + 2] = 0;\r\n                    this._vertices[perPartOffset + 3] = 1;\r\n\r\n                    perPartOffset += this._floatCountPerVertex;\r\n                    this._vertices[perPartOffset] = 0.5;\r\n                    this._vertices[perPartOffset + 1] = -0.5;\r\n                    this._vertices[perPartOffset + 2] = 1;\r\n                    this._vertices[perPartOffset + 3] = 1;\r\n\r\n                    perPartOffset += this._floatCountPerVertex\r\n                    this._vertices[perPartOffset] = 0.5;\r\n                    this._vertices[perPartOffset + 1] = 0.5;\r\n                    this._vertices[perPartOffset + 2] = 1;\r\n                    this._vertices[perPartOffset + 3] = 0;\r\n\r\n                    perPartOffset += this._floatCountPerVertex\r\n                    this._vertices[perPartOffset] = -0.5;\r\n                    this._vertices[perPartOffset + 1] = 0.5;\r\n                    this._vertices[perPartOffset + 2] = 0;\r\n                    this._vertices[perPartOffset + 3] = 0;\r\n                }\r\n\r\n                this._indexStride = 6;\r\n                this._indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, this._bufferMaxParticles * 6, BufferUsage.Static, false);\r\n                indices = new Uint16Array(this._bufferMaxParticles * 6);\r\n                for (i = 0; i < this._bufferMaxParticles; i++) {\r\n                    indexOffset = i * 6;\r\n                    var firstVertex: number = i * this._vertexStride, secondVertex: number = firstVertex + 2;\r\n                    indices[indexOffset++] = firstVertex;\r\n                    indices[indexOffset++] = secondVertex;\r\n                    indices[indexOffset++] = firstVertex + 1;\r\n                    indices[indexOffset++] = firstVertex;\r\n                    indices[indexOffset++] = firstVertex + 3;\r\n                    indices[indexOffset++] = secondVertex;\r\n                }\r\n                this._indexBuffer.setData(indices);\r\n\r\n                memorySize = vbMemorySize + this._bufferMaxParticles * 6 * 2;\r\n                this._bufferState.applyState([this._vertexBuffer], this._indexBuffer);\r\n                this.bufferState = this._bufferState;\r\n            }\r\n\r\n            Resource._addMemory(memorySize, memorySize);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    destroy(): void {\r\n        super.destroy();\r\n        if (this._vertexBuffer) {\r\n            var memorySize: number = this._vertexBuffer._byteLength;\r\n            Resource._addMemory(-memorySize, -memorySize);\r\n            this._vertexBuffer.destroy();\r\n            this._vertexBuffer = null;\r\n        }\r\n        if (this._indexBuffer) {\r\n            var memorySize: number = this._indexBuffer._byteLength;\r\n            Resource._addMemory(-memorySize, -memorySize);\r\n            this._indexBuffer.destroy();\r\n            this._indexBuffer = null;\r\n        }\r\n        this._emission.destroy();\r\n        this._bounds = null;\r\n        this._customBounds = null;\r\n        this._bufferState = null;\r\n        this._owner = null;\r\n        this._vertices = null;\r\n        this._indexBuffer = null;\r\n        this._emission = null;\r\n        this._shape = null;\r\n        this.startLifeTimeGradient = null;\r\n        this.startLifeTimeGradientMin = null;\r\n        this.startLifeTimeGradientMax = null;\r\n        this.startSizeConstantSeparate = null;\r\n        this.startSizeConstantMinSeparate = null;\r\n        this.startSizeConstantMaxSeparate = null;\r\n        this.startRotationConstantSeparate = null;\r\n        this.startRotationConstantMinSeparate = null;\r\n        this.startRotationConstantMaxSeparate = null;\r\n        this.startColorConstant = null;\r\n        this.startColorConstantMin = null;\r\n        this.startColorConstantMax = null;\r\n        this._velocityOverLifetime = null;\r\n        this._colorOverLifetime = null;\r\n        this._sizeOverLifetime = null;\r\n        this._rotationOverLifetime = null;\r\n        this._textureSheetAnimation = null;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    emit(time: number): boolean {\r\n        var position: Vector3 = ShurikenParticleSystem._tempPosition;\r\n        var direction: Vector3 = ShurikenParticleSystem._tempDirection;\r\n        if (this._shape && this._shape.enable) {\r\n            if (this.autoRandomSeed)\r\n                this._shape.generatePositionAndDirection(position, direction);\r\n            else\r\n                this._shape.generatePositionAndDirection(position, direction, this._rand, this._randomSeeds);\r\n        } else {\r\n            position.x = position.y = position.z = 0;\r\n            direction.x = direction.y = 0;\r\n            direction.z = 1;\r\n        }\r\n\r\n        return this.addParticle(position, direction, time);//TODO:\r\n    }\r\n\r\n    //\r\n    addParticle(position: Vector3, direction: Vector3, time: number): boolean {//TODO:\r\n        Vector3.normalize(direction, direction);\r\n        //\r\n        var nextFreeParticle: number = this._firstFreeElement + 1;\r\n        if (nextFreeParticle >= this._bufferMaxParticles)\r\n            nextFreeParticle = 0;\r\n\r\n        if (nextFreeParticle === this._firstRetiredElement)\r\n            return false;\r\n\r\n        var transform: Transform3D = this._owner.transform;\r\n        ShurikenParticleData.create(this, this._ownerRender);\r\n\r\n        var particleAge: number = this._currentTime - time;\r\n        if (particleAge >= ShurikenParticleData.startLifeTime)//,TODO:\r\n            return true;\r\n\r\n        var pos: Vector3, rot: Quaternion;\r\n        if (this.simulationSpace == 0) {\r\n            pos = transform.position;\r\n            rot = transform.rotation;\r\n        }\r\n\r\n        //StartSpeed\r\n        var startSpeed: number;\r\n        switch (this.startSpeedType) {\r\n            case 0:\r\n                startSpeed = this.startSpeedConstant;\r\n                break;\r\n            case 2:\r\n                if (this.autoRandomSeed) {\r\n                    startSpeed = MathUtil.lerp(this.startSpeedConstantMin, this.startSpeedConstantMax, Math.random());\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[8];\r\n                    startSpeed = MathUtil.lerp(this.startSpeedConstantMin, this.startSpeedConstantMax, this._rand.getFloat());\r\n                    this._randomSeeds[8] = this._rand.seed;\r\n                }\r\n                break;\r\n        }\r\n\r\n\r\n        var randomVelocityX: number, randomVelocityY: number, randomVelocityZ: number, randomColor: number, randomSize: number, randomRotation: number, randomTextureAnimation: number;\r\n        var needRandomVelocity: boolean = this._velocityOverLifetime && this._velocityOverLifetime.enable;\r\n        if (needRandomVelocity) {\r\n            var velocityType: number = this._velocityOverLifetime.velocity.type;\r\n            if (velocityType === 2 || velocityType === 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomVelocityX = Math.random();\r\n                    randomVelocityY = Math.random();\r\n                    randomVelocityZ = Math.random();\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[9];\r\n                    randomVelocityX = this._rand.getFloat();\r\n                    randomVelocityY = this._rand.getFloat();\r\n                    randomVelocityZ = this._rand.getFloat();\r\n                    this._randomSeeds[9] = this._rand.seed;\r\n                }\r\n            } else {\r\n                needRandomVelocity = false;\r\n            }\r\n        } else {\r\n            needRandomVelocity = false;\r\n        }\r\n        var needRandomColor: boolean = this._colorOverLifetime && this._colorOverLifetime.enable;\r\n        if (needRandomColor) {\r\n            var colorType: number = this._colorOverLifetime.color.type;\r\n            if (colorType === 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomColor = Math.random();\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[10];\r\n                    randomColor = this._rand.getFloat();\r\n                    this._randomSeeds[10] = this._rand.seed;\r\n                }\r\n            } else {\r\n                needRandomColor = false;\r\n            }\r\n        } else {\r\n            needRandomColor = false;\r\n        }\r\n        var needRandomSize: boolean = this._sizeOverLifetime && this._sizeOverLifetime.enable;\r\n        if (needRandomSize) {\r\n            var sizeType: number = this._sizeOverLifetime.size.type;\r\n            if (sizeType === 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomSize = Math.random();\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[11];\r\n                    randomSize = this._rand.getFloat();\r\n                    this._randomSeeds[11] = this._rand.seed;\r\n                }\r\n            } else {\r\n                needRandomSize = false;\r\n            }\r\n        } else {\r\n            needRandomSize = false;\r\n        }\r\n        var needRandomRotation: boolean = this._rotationOverLifetime && this._rotationOverLifetime.enable;\r\n        if (needRandomRotation) {\r\n            var rotationType: number = this._rotationOverLifetime.angularVelocity.type;\r\n            if (rotationType === 2 || rotationType === 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomRotation = Math.random();\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[12];\r\n                    randomRotation = this._rand.getFloat();\r\n                    this._randomSeeds[12] = this._rand.seed;\r\n                }\r\n            } else {\r\n                needRandomRotation = false;\r\n            }\r\n        } else {\r\n            needRandomRotation = false;\r\n        }\r\n        var needRandomTextureAnimation: boolean = this._textureSheetAnimation && this._textureSheetAnimation.enable;\r\n        if (needRandomTextureAnimation) {\r\n            var textureAnimationType: number = this._textureSheetAnimation.frame.type;\r\n            if (textureAnimationType === 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomTextureAnimation = Math.random();\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[15];\r\n                    randomTextureAnimation = this._rand.getFloat();\r\n                    this._randomSeeds[15] = this._rand.seed;\r\n                }\r\n            } else {\r\n                needRandomTextureAnimation = false;\r\n            }\r\n        } else {\r\n            needRandomTextureAnimation = false;\r\n        }\r\n\r\n        var startIndex: number = this._firstFreeElement * this._floatCountPerVertex * this._vertexStride;\r\n        var subU: number = ShurikenParticleData.startUVInfo[0];\r\n        var subV: number = ShurikenParticleData.startUVInfo[1];\r\n        var startU: number = ShurikenParticleData.startUVInfo[2];\r\n        var startV: number = ShurikenParticleData.startUVInfo[3];\r\n\r\n        var meshVertices: Float32Array, meshVertexStride: number, meshPosOffset: number, meshCorOffset: number, meshUVOffset: number, meshVertexIndex: number;\r\n        var render: ShurikenParticleRenderer = this._ownerRender;\r\n        if (render.renderMode === 4) {\r\n            var meshVB: VertexBuffer3D = render.mesh._vertexBuffer;\r\n            meshVertices = meshVB.getFloat32Data();\r\n            var meshVertexDeclaration: VertexDeclaration = meshVB.vertexDeclaration;\r\n            meshPosOffset = meshVertexDeclaration.getVertexElementByUsage(VertexMesh.MESH_POSITION0)._offset / 4;\r\n            var colorElement: VertexElement = meshVertexDeclaration.getVertexElementByUsage(VertexMesh.MESH_COLOR0);\r\n            meshCorOffset = colorElement ? colorElement._offset / 4 : -1;\r\n            var uvElement: VertexElement = meshVertexDeclaration.getVertexElementByUsage(VertexMesh.MESH_TEXTURECOORDINATE0);\r\n            meshUVOffset = uvElement ? uvElement._offset / 4 : -1;\r\n            meshVertexStride = meshVertexDeclaration.vertexStride / 4;\r\n            meshVertexIndex = 0;\r\n        }\r\n\r\n        for (var i: number = startIndex, n: number = startIndex + this._floatCountPerVertex * this._vertexStride; i < n; i += this._floatCountPerVertex) {\r\n            var offset: number;\r\n            if (render.renderMode === 4) {\r\n                offset = i;\r\n                var vertexOffset: number = meshVertexStride * (meshVertexIndex++);\r\n                var meshOffset: number = vertexOffset + meshPosOffset;\r\n                this._vertices[offset++] = meshVertices[meshOffset++];\r\n                this._vertices[offset++] = meshVertices[meshOffset++];\r\n                this._vertices[offset++] = meshVertices[meshOffset];\r\n                if (meshCorOffset === -1) {\r\n                    this._vertices[offset++] = 1.0;\r\n                    this._vertices[offset++] = 1.0;\r\n                    this._vertices[offset++] = 1.0;\r\n                    this._vertices[offset++] = 1.0;\r\n                }\r\n                else {\r\n                    meshOffset = vertexOffset + meshCorOffset;\r\n                    this._vertices[offset++] = meshVertices[meshOffset++];\r\n                    this._vertices[offset++] = meshVertices[meshOffset++];\r\n                    this._vertices[offset++] = meshVertices[meshOffset++];\r\n                    this._vertices[offset++] = meshVertices[meshOffset];\r\n                }\r\n                if (meshUVOffset === -1) {\r\n                    this._vertices[offset++] = 0.0;\r\n                    this._vertices[offset++] = 0.0;\r\n                }\r\n                else {\r\n                    meshOffset = vertexOffset + meshUVOffset;\r\n                    this._vertices[offset++] = meshVertices[meshOffset++];\r\n                    this._vertices[offset++] = meshVertices[meshOffset];\r\n                }\r\n            } else {\r\n                offset = i + 4;\r\n            }\r\n\r\n            this._vertices[offset++] = position.x;\r\n            this._vertices[offset++] = position.y;\r\n            this._vertices[offset++] = position.z;\r\n\r\n            this._vertices[offset++] = ShurikenParticleData.startLifeTime;\r\n\r\n            this._vertices[offset++] = direction.x;\r\n            this._vertices[offset++] = direction.y;\r\n            this._vertices[offset++] = direction.z;\r\n            this._vertices[offset++] = time;\r\n\r\n            this._vertices[offset++] = ShurikenParticleData.startColor.x;\r\n            this._vertices[offset++] = ShurikenParticleData.startColor.y;\r\n            this._vertices[offset++] = ShurikenParticleData.startColor.z;\r\n            this._vertices[offset++] = ShurikenParticleData.startColor.w;\r\n\r\n            this._vertices[offset++] = ShurikenParticleData.startSize[0];\r\n            this._vertices[offset++] = ShurikenParticleData.startSize[1];\r\n            this._vertices[offset++] = ShurikenParticleData.startSize[2];\r\n\r\n            this._vertices[offset++] = ShurikenParticleData.startRotation[0];\r\n            this._vertices[offset++] = ShurikenParticleData.startRotation[1];\r\n            this._vertices[offset++] = ShurikenParticleData.startRotation[2];\r\n\r\n            //StartSpeed\r\n            this._vertices[offset++] = startSpeed;\r\n\r\n            //this._vertices[offset] = Math.random();\r\n\r\n\r\n            needRandomColor && (this._vertices[offset + 1] = randomColor);\r\n            needRandomSize && (this._vertices[offset + 2] = randomSize);\r\n            needRandomRotation && (this._vertices[offset + 3] = randomRotation);\r\n            needRandomTextureAnimation && (this._vertices[offset + 4] = randomTextureAnimation);\r\n            if (needRandomVelocity) {\r\n                this._vertices[offset + 5] = randomVelocityX;\r\n                this._vertices[offset + 6] = randomVelocityY;\r\n                this._vertices[offset + 7] = randomVelocityZ;\r\n            }\r\n\r\n            switch (this.simulationSpace) {\r\n                case 0:\r\n                    offset += 8;\r\n                    this._vertices[offset++] = pos.x;\r\n                    this._vertices[offset++] = pos.y;\r\n                    this._vertices[offset++] = pos.z;\r\n                    this._vertices[offset++] = rot.x;\r\n                    this._vertices[offset++] = rot.y;\r\n                    this._vertices[offset++] = rot.z;\r\n                    this._vertices[offset++] = rot.w;\r\n                    break;\r\n                case 1:\r\n                    break;\r\n                default:\r\n                    throw new Error(\"ShurikenParticleMaterial: SimulationSpace value is invalid.\");\r\n            }\r\n            offset = i + this._simulationUV_Index;\r\n            this._vertices[offset++] = startU;\r\n            this._vertices[offset++] = startV;\r\n            this._vertices[offset++] = subU;\r\n            this._vertices[offset] = subV;\r\n        }\r\n\r\n        this._firstFreeElement = nextFreeParticle;\r\n        return true;\r\n    }\r\n\r\n    addNewParticlesToVertexBuffer(): void {\r\n        var start: number;\r\n        var byteStride: number = this._vertexStride * this._floatCountPerVertex * 4;\r\n        if (this._firstNewElement < this._firstFreeElement) {\r\n            start = this._firstNewElement * byteStride;\r\n            this._vertexBuffer.setData(this._vertices.buffer, start, start, (this._firstFreeElement - this._firstNewElement) * byteStride);\r\n\r\n        } else {\r\n            start = this._firstNewElement * byteStride;\r\n            this._vertexBuffer.setData(this._vertices.buffer, start, start, (this._bufferMaxParticles - this._firstNewElement) * byteStride);\r\n\r\n            if (this._firstFreeElement > 0) {\r\n                this._vertexBuffer.setData(this._vertices.buffer, 0, 0, this._firstFreeElement * byteStride);\r\n\r\n            }\r\n        }\r\n        this._firstNewElement = this._firstFreeElement;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    _getType(): number {\r\n        return ShurikenParticleSystem._type;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _prepareRender(state: RenderContext3D): boolean {\r\n        if (this._updateMask != Stat.loopCount) {\r\n            this._updateMask = Stat.loopCount;\r\n            this._updateEmission();\r\n            //, setData  here\r\n            if (this._firstNewElement != this._firstFreeElement)\r\n                this.addNewParticlesToVertexBuffer();\r\n            this._drawCounter++;\r\n        }\r\n\r\n\r\n        if (this._firstActiveElement != this._firstFreeElement)\r\n            return true;\r\n        else\r\n            return false;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    _updateRenderParams(state: RenderContext3D): void {\r\n        //this._bufferState.bind();\r\n        var indexCount: number;\r\n        this.clearRenderParams();\r\n        if (this._firstActiveElement < this._firstFreeElement) {\r\n            indexCount = (this._firstFreeElement - this._firstActiveElement) * this._indexStride;\r\n            this.setDrawElemenParams(indexCount, 2 * this._firstActiveElement * this._indexStride);\r\n            // LayaGL.renderDrawConatext.drawElements(MeshTopology.Triangles, indexCount, IndexFormat.UInt16, 2 * this._firstActiveElement * this._indexStride);\r\n            // Stat.trianglesFaces += indexCount / 3;\r\n            // Stat.renderBatches++;\r\n        } else {\r\n            indexCount = (this._bufferMaxParticles - this._firstActiveElement) * this._indexStride;\r\n            this.setDrawElemenParams(indexCount, 2 * this._firstActiveElement * this._indexStride);\r\n            // LayaGL.renderDrawConatext.drawElements(MeshTopology.Triangles, indexCount, IndexFormat.UInt16, 2 * this._firstActiveElement * this._indexStride);\r\n            // Stat.trianglesFaces += indexCount / 3;\r\n            // Stat.renderBatches++;\r\n            if (this._firstFreeElement > 0) {\r\n                indexCount = this._firstFreeElement * this._indexStride;\r\n                this.setDrawElemenParams(indexCount, 0);\r\n                // LayaGL.renderDrawConatext.drawElements(MeshTopology.Triangles, indexCount, IndexFormat.UInt16, 0);\r\n                // Stat.trianglesFaces += indexCount / 3;\r\n                // Stat.renderBatches++;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    play(): void {\r\n        this._burstsIndex = 0;\r\n        this._isEmitting = true;\r\n        this._isPlaying = true;\r\n        this._isPaused = false;\r\n        this._emissionTime = 0;\r\n        this._emissionDistance = 0;\r\n        this._owner.transform.position.cloneTo(this._emissionLastPosition);\r\n        this._totalDelayTime = 0;\r\n\r\n        if (!this.autoRandomSeed) {\r\n            for (var i: number = 0, n: number = this._randomSeeds.length; i < n; i++)\r\n                this._randomSeeds[i] = this.randomSeed[0] + ShurikenParticleSystem._RANDOMOFFSET[i];\r\n        }\r\n\r\n        switch (this.startDelayType) {\r\n            case 0:\r\n                this._playStartDelay = this.startDelay;\r\n                break;\r\n            case 1:\r\n                if (this.autoRandomSeed) {\r\n                    this._playStartDelay = MathUtil.lerp(this.startDelayMin, this.startDelayMax, Math.random());\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[2];\r\n                    this._playStartDelay = MathUtil.lerp(this.startDelayMin, this.startDelayMax, this._rand.getFloat());\r\n                    this._randomSeeds[2] = this._rand.seed;\r\n                }\r\n                break;\r\n            default:\r\n                throw new Error(\"Utils3D: startDelayType is invalid.\");\r\n        }\r\n        this._frameRateTime = this._currentTime + this._playStartDelay;//,\r\n\r\n        this._startUpdateLoopCount = Stat.loopCount;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    pause(): void {\r\n        this._isPaused = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param time .restarttrue,\r\n     * @param restart \r\n     */\r\n    simulate(time: number, restart: boolean = true): void {\r\n        this._simulateUpdate = true;\r\n\r\n        if (restart) {\r\n            this._updateParticlesSimulationRestart(time);\r\n        }\r\n        else {\r\n            this._isPaused = false;//\r\n            this._updateParticles(time);\r\n        }\r\n\r\n        this.pause();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    stop(): void {\r\n        this._burstsIndex = 0;\r\n        this._isEmitting = false;\r\n        this._emissionTime = 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {\r\n        var dest: ShurikenParticleSystem = (<ShurikenParticleSystem>destObject);\r\n\r\n        dest._useCustomBounds = this._useCustomBounds;\r\n        (this._customBounds) && (this._customBounds.cloneTo(dest._customBounds));\r\n\r\n        dest.duration = this.duration;\r\n        dest.looping = this.looping;\r\n        dest.prewarm = this.prewarm;\r\n        dest.startDelayType = this.startDelayType;\r\n        dest.startDelay = this.startDelay;\r\n        dest.startDelayMin = this.startDelayMin;\r\n        dest.startDelayMax = this.startDelayMax;\r\n\r\n        dest._maxStartLifetime = this._maxStartLifetime;\r\n        dest.startLifetimeType = this.startLifetimeType;\r\n        dest.startLifetimeConstant = this.startLifetimeConstant;\r\n        this.startLifeTimeGradient.cloneTo(dest.startLifeTimeGradient);\r\n        dest.startLifetimeConstantMin = this.startLifetimeConstantMin;\r\n        dest.startLifetimeConstantMax = this.startLifetimeConstantMax;\r\n        this.startLifeTimeGradientMin.cloneTo(dest.startLifeTimeGradientMin);\r\n        this.startLifeTimeGradientMax.cloneTo(dest.startLifeTimeGradientMax);\r\n\r\n        dest.startSpeedType = this.startSpeedType;\r\n        dest.startSpeedConstant = this.startSpeedConstant;\r\n        dest.startSpeedConstantMin = this.startSpeedConstantMin;\r\n        dest.startSpeedConstantMax = this.startSpeedConstantMax;\r\n\r\n        dest.dragType = this.dragType;\r\n        dest.dragConstant = this.dragConstant;\r\n        dest.dragSpeedConstantMax = this.dragSpeedConstantMax;\r\n        dest.dragSpeedConstantMin = this.dragSpeedConstantMin;\r\n\r\n        dest.threeDStartSize = this.threeDStartSize;\r\n        dest.startSizeType = this.startSizeType;\r\n        dest.startSizeConstant = this.startSizeConstant;\r\n        this.startSizeConstantSeparate.cloneTo(dest.startSizeConstantSeparate);\r\n        dest.startSizeConstantMin = this.startSizeConstantMin;\r\n        dest.startSizeConstantMax = this.startSizeConstantMax;\r\n        this.startSizeConstantMinSeparate.cloneTo(dest.startSizeConstantMinSeparate);\r\n        this.startSizeConstantMaxSeparate.cloneTo(dest.startSizeConstantMaxSeparate);\r\n\r\n        dest.threeDStartRotation = this.threeDStartRotation;\r\n        dest.startRotationType = this.startRotationType;\r\n        dest.startRotationConstant = this.startRotationConstant;\r\n        this.startRotationConstantSeparate.cloneTo(dest.startRotationConstantSeparate);\r\n        dest.startRotationConstantMin = this.startRotationConstantMin;\r\n        dest.startRotationConstantMax = this.startRotationConstantMax;\r\n        this.startRotationConstantMinSeparate.cloneTo(dest.startRotationConstantMinSeparate);\r\n        this.startRotationConstantMaxSeparate.cloneTo(dest.startRotationConstantMaxSeparate);\r\n\r\n        dest.randomizeRotationDirection = this.randomizeRotationDirection;\r\n\r\n        dest.startColorType = this.startColorType;\r\n        this.startColorConstant.cloneTo(dest.startColorConstant);\r\n        this.startColorConstantMin.cloneTo(dest.startColorConstantMin);\r\n        this.startColorConstantMax.cloneTo(dest.startColorConstantMax);\r\n\r\n        dest.gravityModifier = this.gravityModifier;\r\n        dest.simulationSpace = this.simulationSpace;\r\n        dest.simulationSpeed = this.simulationSpeed;\r\n        dest.scaleMode = this.scaleMode;\r\n        dest.playOnAwake = this.playOnAwake;\r\n        dest.autoRandomSeed = this.autoRandomSeed;\r\n        dest.randomSeed[0] = this.randomSeed[0];\r\n\r\n        dest.maxParticles = this.maxParticles;\r\n\r\n        //TODO:\r\n        (this._emission) && (dest._emission = this._emission.clone());\r\n        (this.shape) && (dest.shape = this.shape.clone());\r\n        (this.velocityOverLifetime) && (dest.velocityOverLifetime = this.velocityOverLifetime.clone());\r\n        (this.colorOverLifetime) && (dest.colorOverLifetime = this.colorOverLifetime.clone());\r\n        (this.sizeOverLifetime) && (dest.sizeOverLifetime = this.sizeOverLifetime.clone());\r\n        (this.rotationOverLifetime) && (dest.rotationOverLifetime = this.rotationOverLifetime.clone());\r\n        (this.textureSheetAnimation) && (dest.textureSheetAnimation = this.textureSheetAnimation.clone());\r\n        //\r\n\r\n        dest.isPerformanceMode = this.isPerformanceMode;\r\n\r\n        dest._isEmitting = this._isEmitting;\r\n        dest._isPlaying = this._isPlaying;\r\n        dest._isPaused = this._isPaused;\r\n        dest._playStartDelay = this._playStartDelay;\r\n        dest._frameRateTime = this._frameRateTime;\r\n        dest._emissionTime = this._emissionTime;\r\n        dest._totalDelayTime = this._totalDelayTime;\r\n        dest._burstsIndex = this._burstsIndex;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): any {\r\n        var dest: ShurikenParticleSystem = new ShurikenParticleSystem(null);\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n}\r\n\r\n\r\n","import { MathUtil } from \"../../../maths/MathUtil\";\r\nimport { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\nimport { VertexShuriKenParticle } from \"../../graphics/Vertex/VertexShuriKenParticle\";\r\nimport { VertexShurikenParticleBillboard } from \"../../graphics/Vertex/VertexShurikenParticleBillboard\";\r\nimport { VertexShurikenParticleMesh } from \"../../graphics/Vertex/VertexShurikenParticleMesh\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { Mesh } from \"../../resource/models/Mesh\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { ShurikenParticleData } from \"./ShurikenParticleData\";\r\nimport { ShurikenParticleRenderer } from \"./ShurikenParticleRenderer\";\r\nimport { ShurikenParticleSystem } from \"./ShurikenParticleSystem\";\r\n\r\nexport class ShurikenParticleInstanceSystem extends ShurikenParticleSystem {\r\n\r\n    private _instanceParticleVertexBuffer: VertexBuffer3D = null;\r\n    private _instanceVertex: Float32Array = null;\r\n\r\n\r\n    private _meshIndexCount: number;\r\n    private _meshFloatCountPreVertex: number;\r\n\r\n    /**\r\n     *  float \r\n     */\r\n    private _floatCountPerParticleData: number;\r\n\r\n    constructor(render: ShurikenParticleRenderer) {\r\n        super(render,MeshTopology.Triangles,DrawType.DrawElementInstance);\r\n    }\r\n\r\n    /***\r\n     *  mesh vb\r\n     */\r\n    private _initMeshVertex(vertex: Float32Array, mesh: Mesh) {\r\n        let meshVertexBuffer = mesh._vertexBuffer;\r\n        let meshVertices = meshVertexBuffer.getFloat32Data();\r\n        let meshVertexDeclaration = meshVertexBuffer.vertexDeclaration;\r\n\r\n        let meshPosOffset = meshVertexDeclaration.getVertexElementByUsage(VertexMesh.MESH_POSITION0)._offset / 4;\r\n\r\n        let colorElement: VertexElement = meshVertexDeclaration.getVertexElementByUsage(VertexMesh.MESH_COLOR0);\r\n        let meshColorOffset = colorElement ? colorElement._offset / 4 : -1;\r\n\r\n        let uvElement: VertexElement = meshVertexDeclaration.getVertexElementByUsage(VertexMesh.MESH_TEXTURECOORDINATE0);\r\n        let meshUVOffset = uvElement ? uvElement._offset / 4 : -1;\r\n\r\n        let meshVertexStride = meshVertexDeclaration.vertexStride / 4;\r\n        let meshVertexIndex = 0;\r\n\r\n        let vertexCount = mesh.vertexCount;\r\n\r\n        let perParticleDataCount = this._vertexBuffer.vertexDeclaration.vertexStride / 4;\r\n        for (let index = 0; index < vertexCount; index++) {\r\n            let startIndex = index * perParticleDataCount;\r\n            let indexOffset = startIndex;\r\n            let vertexOffset = meshVertexStride * meshVertexIndex++;\r\n\r\n            // position\r\n            let positionOffset = vertexOffset + meshPosOffset;\r\n            vertex[indexOffset++] = meshVertices[positionOffset++];\r\n            vertex[indexOffset++] = meshVertices[positionOffset++];\r\n            vertex[indexOffset++] = meshVertices[positionOffset++];\r\n\r\n            // color\r\n            if (meshColorOffset == -1) {\r\n                vertex[indexOffset++] = 1;\r\n                vertex[indexOffset++] = 1;\r\n                vertex[indexOffset++] = 1;\r\n                vertex[indexOffset++] = 1;\r\n            }\r\n            else {\r\n                let colorOffset = vertexOffset + meshColorOffset;\r\n                vertex[indexOffset++] = meshVertices[colorOffset++];\r\n                vertex[indexOffset++] = meshVertices[colorOffset++];\r\n                vertex[indexOffset++] = meshVertices[colorOffset++];\r\n                vertex[indexOffset++] = meshVertices[colorOffset++];\r\n            }\r\n\r\n            // uv\r\n            if (meshUVOffset == -1) {\r\n                vertex[indexOffset++] = 0;\r\n                vertex[indexOffset++] = 0;\r\n            }\r\n            else {\r\n                let uvOffset = vertexOffset + meshUVOffset;\r\n                vertex[indexOffset++] = meshVertices[uvOffset++];\r\n                vertex[indexOffset++] = meshVertices[uvOffset++];\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  buffer\r\n     * @returns \r\n     */\r\n    _initBufferDatas(): void {\r\n        // todo  Resource._addMemory\r\n        if (this._vertexBuffer) {\r\n            // this._instanceBufferState.destroy();\r\n            this._vertexBuffer.destroy();\r\n            this._instanceParticleVertexBuffer.destroy();\r\n            this._indexBuffer.destroy();\r\n        }\r\n        let render: ShurikenParticleRenderer = this._ownerRender;\r\n        let renderMode: number = render.renderMode;\r\n\r\n        if (renderMode == -1 || this.maxParticles <= 0) {\r\n            return;\r\n        }\r\n\r\n        if (renderMode == 4) {\r\n            let mesh = render.mesh;\r\n            if (mesh) {\r\n                let meshDeclaration = VertexShurikenParticleMesh.vertexInstanceMeshDeclaration;\r\n                let particleDeclaration = VertexShurikenParticleMesh.vertexInstanceParticleDeclaration;\r\n\r\n                this._meshIndexCount = mesh.indexCount;\r\n                this._simulationUV_Index = particleDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_SIMULATIONUV).offset / 4;\r\n                this._floatCountPerParticleData = particleDeclaration.vertexStride / 4;\r\n                this._startLifeTimeIndex = particleDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_SHAPEPOSITIONSTARTLIFETIME)._offset / 4 + 3;\r\n                this._timeIndex = particleDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_DIRECTIONTIME)._offset / 4 + 3;\r\n\r\n                let indexCount = mesh.indexCount;\r\n                this._indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(mesh.indexFormat, indexCount, BufferUsage.Static,false);\r\n                this._indexBuffer.setData(mesh._indexBuffer.getData());\r\n\r\n                let meshVertexCount = mesh.vertexCount;\r\n                let vbSize = meshDeclaration.vertexStride * meshVertexCount;\r\n                this._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vbSize, BufferUsage.Static,false);\r\n                this._vertexBuffer.vertexDeclaration = meshDeclaration;\r\n                //  mesh  ?\r\n                //  vertexElement  \r\n                let meshVertex = new Float32Array(vbSize / 4);\r\n                this._initMeshVertex(meshVertex, mesh);\r\n\r\n                this._vertexBuffer.setData(meshVertex.buffer);\r\n\r\n                let particleCount = this._bufferMaxParticles;\r\n                let particleVbSize = particleCount * particleDeclaration.vertexStride;\r\n                this._instanceVertex = new Float32Array(particleVbSize / 4);\r\n                this._instanceParticleVertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(particleVbSize, BufferUsage.Dynamic,false);\r\n                this._instanceParticleVertexBuffer.vertexDeclaration = particleDeclaration;\r\n                this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer);\r\n                this._instanceParticleVertexBuffer.instanceBuffer = true;\r\n                this._bufferState.applyState([this._vertexBuffer,this._instanceParticleVertexBuffer],this._indexBuffer)\r\n            }\r\n\r\n        }\r\n        else {\r\n            let billboardDeclaration = VertexShurikenParticleBillboard.vertexInstanceMeshDeclaration;\r\n            let particleDeclaration = VertexShurikenParticleBillboard.vertexInstanceParticleDeclaration;\r\n\r\n            this._meshIndexCount = 6;\r\n            this._simulationUV_Index = particleDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_SIMULATIONUV).offset / 4;\r\n            this._floatCountPerParticleData = particleDeclaration.vertexStride / 4;\r\n            this._startLifeTimeIndex = particleDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_SHAPEPOSITIONSTARTLIFETIME)._offset / 4 + 3;\r\n            this._timeIndex = particleDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_DIRECTIONTIME)._offset / 4 + 3;\r\n\r\n            let indexArray = VertexShurikenParticleBillboard.billboardIndexArray;\r\n            let indexCount = indexArray.length;\r\n            this._indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, indexCount, BufferUsage.Static,false);\r\n            this._indexBuffer.setData(indexArray);\r\n\r\n            let meshVBSize = this._meshIndexCount * billboardDeclaration.vertexStride;\r\n            this._vertexBuffer =Laya3DRender.renderOBJCreate.createVertexBuffer3D(meshVBSize,BufferUsage.Static,false);\r\n            this._vertexBuffer.vertexDeclaration = billboardDeclaration;\r\n            this._vertexBuffer.setData(VertexShurikenParticleBillboard.billboardVertexArray.buffer);\r\n            let particleCount = this._bufferMaxParticles;\r\n            let particleVbSize = particleCount * particleDeclaration.vertexStride;\r\n            this._instanceVertex = new Float32Array(particleVbSize / 4);\r\n            this._instanceParticleVertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(particleVbSize, BufferUsage.Dynamic,false);\r\n            this._instanceParticleVertexBuffer.vertexDeclaration = particleDeclaration;\r\n            this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer);\r\n            this._instanceParticleVertexBuffer.instanceBuffer = true;\r\n            // this._instanceBufferState.bind();\r\n            // this._instanceBufferState.applyIndexBuffer(this._indexBuffer);\r\n            // this._instanceBufferState.applyVertexBuffer(this._vertexBuffer);\r\n            // this._instanceBufferState.applyInstanceVertexBuffer(this._instanceParticleVertexBuffer);\r\n            // this._instanceBufferState.unBind();\r\n            this._bufferState.applyState([this._vertexBuffer,this._instanceParticleVertexBuffer],this._indexBuffer);\r\n        }\r\n\r\n        // let memorySize = this._instanceParticleVertexBuffer._byteLength + this._indexBuffer._byteLength + this._vertexBuffer._byteLength;\r\n\r\n        // Resource._addMemory(memorySize, memorySize);\r\n    }\r\n\r\n    protected _retireActiveParticles(): void {\r\n        const epsilon: number = 0.0001;\r\n        let firstActive = this._firstActiveElement;\r\n        while (this._firstActiveElement != this._firstNewElement) {\r\n            let index = this._firstActiveElement * this._floatCountPerParticleData;\r\n            let timeIndex = index + this._timeIndex;\r\n\r\n            let particleAge = this._currentTime - this._instanceVertex[timeIndex];\r\n            if (particleAge + epsilon < this._instanceVertex[index + this._startLifeTimeIndex]) {\r\n                break;\r\n            }\r\n\r\n            this._instanceVertex[timeIndex] = this._drawCounter;\r\n            this._firstActiveElement++;\r\n            if (this._firstActiveElement >= this._bufferMaxParticles) {\r\n                this._firstActiveElement = 0;\r\n            }\r\n        }\r\n        \r\n        if (this._firstActiveElement != firstActive) {\r\n            let byteStride = this._floatCountPerParticleData * 4;\r\n            if (this._firstActiveElement < this._firstFreeElement) {\r\n                let activeStart = this._firstActiveElement * byteStride;\r\n                this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer, 0, activeStart, (this._firstFreeElement - this._firstActiveElement) * byteStride);\r\n            }\r\n            else {\r\n                let start = this._firstActiveElement * byteStride;\r\n                let a = this._bufferMaxParticles - this._firstActiveElement;\r\n                this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer, 0, start, a * byteStride);\r\n\r\n                if (this._firstFreeElement > 0) {\r\n                    this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer, a * byteStride, 0, this._firstFreeElement * byteStride);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _freeRetiredParticles(): void {\r\n        while (this._firstRetiredElement != this._firstActiveElement) {\r\n            let age = this._drawCounter - this._instanceVertex[this._firstRetiredElement * this._floatCountPerParticleData + this._timeIndex];\r\n\r\n            //TODObug\r\n            if (false)\r\n                if (age < 3)//GPUCPUBUG\r\n                    break;\r\n            this._firstRetiredElement++;\r\n            if (this._firstRetiredElement >= this._bufferMaxParticles)\r\n                this._firstRetiredElement = 0;\r\n        }\r\n    }\r\n\r\n    addParticle(position: Vector3, direction: Vector3, time: number): boolean {\r\n        Vector3.normalize(direction, direction);\r\n\r\n        //\r\n        let nextFreeParticle = this._firstFreeElement + 1;\r\n        if (nextFreeParticle >= this._bufferMaxParticles) {\r\n            nextFreeParticle = 0;\r\n        }\r\n\r\n        if (nextFreeParticle == this._firstRetiredElement) {\r\n            return false;\r\n        }\r\n\r\n        let transform = this._owner.transform;\r\n        ShurikenParticleData.create(this, this._ownerRender);\r\n\r\n        let particleAge = this._currentTime - time;\r\n\r\n        if (particleAge >= ShurikenParticleData.startLifeTime) {\r\n            return true;\r\n        }\r\n\r\n        let pos: Vector3, rot: Quaternion;\r\n        if (this.simulationSpace == 0) {\r\n            pos = transform.position;\r\n            rot = transform.rotation;\r\n        }\r\n\r\n        //StartSpeed\r\n        let startSpeed = 0;\r\n        switch (this.startSpeedType) {\r\n            case 0:\r\n                startSpeed = this.startSpeedConstant;\r\n                break;\r\n            case 2:\r\n                if (this.autoRandomSeed) {\r\n                    startSpeed = MathUtil.lerp(this.startSpeedConstantMin, this.startSpeedConstantMax, Math.random());\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[8];\r\n                    startSpeed = MathUtil.lerp(this.startSpeedConstantMin, this.startSpeedConstantMax, this._rand.getFloat());\r\n                    this._randomSeeds[8] = this._rand.seed;\r\n                }\r\n                break;\r\n        }\r\n\r\n        let randomVelocityX: number, randomVelocityY: number, randomVelocityZ: number;\r\n        let needRandomVelocity = this._velocityOverLifetime && this._velocityOverLifetime.enable;\r\n        if (needRandomVelocity) {\r\n            let velocityType = this._velocityOverLifetime.velocity.type;\r\n            if (velocityType == 2 || velocityType == 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomVelocityX = Math.random();\r\n                    randomVelocityY = Math.random();\r\n                    randomVelocityZ = Math.random();\r\n                }\r\n                else {\r\n                    this._rand.seed = this._randomSeeds[9];\r\n                    randomVelocityX = this._rand.getFloat();\r\n                    randomVelocityY = this._rand.getFloat();\r\n                    randomVelocityZ = this._rand.getFloat();\r\n                    this._randomSeeds[9] = this._rand.seed;\r\n                }\r\n            }\r\n            else {\r\n                needRandomVelocity = false;\r\n            }\r\n        }\r\n        else {\r\n            needRandomVelocity = false;\r\n        }\r\n\r\n        let randomColor: number;\r\n        let needRandomColor = this._colorOverLifetime && this._colorOverLifetime.enable;\r\n        if (needRandomColor) {\r\n            let colorType = this._colorOverLifetime.color.type;\r\n            if (colorType == 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomColor = Math.random();\r\n                }\r\n                else {\r\n                    this._rand.seed = this._randomSeeds[10];\r\n                    randomColor = this._rand.getFloat();\r\n                    this._randomSeeds[10] = this._rand.seed;\r\n                }\r\n            }\r\n            else {\r\n                needRandomColor = false;\r\n            }\r\n        }\r\n        else {\r\n            needRandomColor = false;\r\n        }\r\n\r\n        let randomSize: number;\r\n        let needRandomSize = this._sizeOverLifetime && this._sizeOverLifetime.enable;\r\n        if (needRandomSize) {\r\n            let sizeType = this._sizeOverLifetime.size.type;\r\n            if (sizeType == 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomSize = Math.random();\r\n                }\r\n                else {\r\n                    this._rand.seed = this._randomSeeds[11];\r\n                    randomSize = this._rand.getFloat();\r\n                    this.randomSeed[11] = this._rand.seed;\r\n                }\r\n            }\r\n            else {\r\n                needRandomSize = false;\r\n            }\r\n        }\r\n        else {\r\n            needRandomSize = false;\r\n        }\r\n\r\n        let randomRotation: number;\r\n        let needRandomRotation = this._rotationOverLifetime && this._rotationOverLifetime.enable;\r\n        if (needRandomRotation) {\r\n            let rotationType = this._rotationOverLifetime.angularVelocity.type;\r\n            if (rotationType == 2 || rotationType == 3) {\r\n                if (this.autoRandomSeed) {\r\n\r\n                    randomRotation = Math.random();\r\n                }\r\n                else {\r\n                    this._rand.seed = this._randomSeeds[12];\r\n                    randomRotation = this._rand.getFloat();\r\n                    this._randomSeeds[12] = this._rand.seed;\r\n                }\r\n            }\r\n            else {\r\n                needRandomRotation = false;\r\n            }\r\n        }\r\n        else {\r\n            needRandomRotation = false;\r\n        }\r\n\r\n        let randomTextureAnimation: number;\r\n        let needRandomTextureAnimation = this._textureSheetAnimation && this._textureSheetAnimation.enable;\r\n        if (needRandomTextureAnimation) {\r\n            let textureAnimationType = this._textureSheetAnimation.frame.type;\r\n            if (textureAnimationType == 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomTextureAnimation = Math.random();\r\n                }\r\n                else {\r\n                    this._rand.seed = this._randomSeeds[15];\r\n                    randomTextureAnimation = this._rand.getFloat();\r\n                    this._randomSeeds[15] = this._rand.seed;\r\n                }\r\n            }\r\n            else {\r\n                needRandomTextureAnimation = false;\r\n            }\r\n        }\r\n        else {\r\n            needRandomTextureAnimation = false;\r\n        }\r\n\r\n        // todo uv \r\n        let subU: number = ShurikenParticleData.startUVInfo[0];\r\n        let subV: number = ShurikenParticleData.startUVInfo[1];\r\n        let startU: number = ShurikenParticleData.startUVInfo[2];\r\n        let startV: number = ShurikenParticleData.startUVInfo[3];\r\n\r\n        let render: ShurikenParticleRenderer = this._ownerRender;\r\n        if (render.renderMode == 4) {\r\n\r\n        }\r\n        else {\r\n            // todo, quad  uv ?\r\n        }\r\n\r\n        //  , \r\n        let startIndex = this._firstFreeElement * this._floatCountPerParticleData;\r\n\r\n        let offset = startIndex;\r\n        this._instanceVertex[offset++] = position.x;\r\n        this._instanceVertex[offset++] = position.y;\r\n        this._instanceVertex[offset++] = position.z;\r\n\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startLifeTime;\r\n\r\n        this._instanceVertex[offset++] = direction.x;\r\n        this._instanceVertex[offset++] = direction.y;\r\n        this._instanceVertex[offset++] = direction.z;\r\n        this._instanceVertex[offset++] = time;\r\n\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startColor.x;\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startColor.y;\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startColor.z;\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startColor.w;\r\n\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startSize[0];\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startSize[1];\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startSize[2];\r\n\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startRotation[0];\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startRotation[1];\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startRotation[2];\r\n\r\n        //StartSpeed\r\n        this._instanceVertex[offset++] = startSpeed;\r\n        needRandomColor && (this._instanceVertex[offset + 1] = randomColor);\r\n        needRandomSize && (this._instanceVertex[offset + 2] = randomSize);\r\n        needRandomRotation && (this._instanceVertex[offset + 3] = randomRotation);\r\n        needRandomTextureAnimation && (this._instanceVertex[offset + 4] = randomTextureAnimation);\r\n        if (needRandomVelocity) {\r\n            this._instanceVertex[offset + 5] = randomVelocityX;\r\n            this._instanceVertex[offset + 6] = randomVelocityY;\r\n            this._instanceVertex[offset + 7] = randomVelocityZ;\r\n        }\r\n\r\n        switch (this.simulationSpace) {\r\n            case 0:\r\n                offset += 8;\r\n                this._instanceVertex[offset++] = pos.x;\r\n                this._instanceVertex[offset++] = pos.y;\r\n                this._instanceVertex[offset++] = pos.z;\r\n                this._instanceVertex[offset++] = rot.x;\r\n                this._instanceVertex[offset++] = rot.y;\r\n                this._instanceVertex[offset++] = rot.z;\r\n                this._instanceVertex[offset++] = rot.w;\r\n                break;\r\n            case 1:\r\n                break;\r\n            default:\r\n                throw new Error(\"ShurikenParticleMaterial: SimulationSpace value is invalid.\");\r\n        }\r\n        offset = startIndex + this._simulationUV_Index;\r\n        this._instanceVertex[offset++] = startU;\r\n        this._instanceVertex[offset++] = startV;\r\n        this._instanceVertex[offset++] = subU;\r\n        this._instanceVertex[offset++] = subV;\r\n\r\n        this._firstFreeElement = nextFreeParticle;\r\n        return true;\r\n    }\r\n\r\n    addNewParticlesToVertexBuffer(): void {\r\n        let byteStride = this._floatCountPerParticleData * 4;\r\n        // instance buffer ,   0  buffer\r\n        if (this._firstActiveElement < this._firstFreeElement) {\r\n            let start = this._firstActiveElement * byteStride;\r\n            this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer, 0, start, (this._firstFreeElement - this._firstActiveElement) * byteStride);\r\n        }\r\n        else {\r\n            let start = this._firstActiveElement * byteStride;\r\n            let a = this._bufferMaxParticles - this._firstActiveElement;\r\n            this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer, 0, start, a * byteStride);\r\n\r\n            if (this._firstFreeElement > 0) {\r\n                this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer, a * byteStride, 0, this._firstFreeElement * byteStride);\r\n            }\r\n        }\r\n\r\n        this._firstNewElement = this._firstFreeElement;\r\n    }\r\n\r\n    _updateRenderParams(stage: RenderContext3D) {\r\n        //this._instanceBufferState.bind();\r\n        // instance buffer  0 \r\n        this.clearRenderParams();\r\n        if (this._firstActiveElement < this._firstFreeElement) {\r\n            let indexCount = this._firstFreeElement - this._firstActiveElement;\r\n            this.setDrawElemenParams(this._meshIndexCount,0);\r\n            this.instanceCount = indexCount;\r\n          //  LayaGL.renderDrawConatext.drawElementsInstanced(MeshTopology.Triangles, this._meshIndexCount, IndexFormat.UInt16, 0, indexCount);\r\n          //  Stat.trianglesFaces += this._meshIndexCount / 3 * indexCount;\r\n          //  Stat.renderBatches++;\r\n        }\r\n        else {\r\n            let indexCount = this._bufferMaxParticles - this._firstActiveElement;\r\n            if (this._firstFreeElement > 0) {\r\n                indexCount += this._firstFreeElement;\r\n            }\r\n            this.setDrawElemenParams(this._meshIndexCount,0);\r\n            this.instanceCount = indexCount;\r\n            //LayaGL.renderEngine.getDrawContext().drawElementsInstanced(MeshTopology.Triangles, this._meshIndexCount, IndexFormat.UInt16, 0, indexCount);\r\n            //Stat.trianglesFaces += this._meshIndexCount / 3 * indexCount;\r\n            //Stat.renderBatches++;\r\n        }\r\n    }\r\n\r\n    destroy(): void {\r\n        // todo\r\n        super.destroy();\r\n\r\n        if (this._indexBuffer) {\r\n            this._indexBuffer.destroy();\r\n        }\r\n        if (this._vertexBuffer) {\r\n            this._vertexBuffer.destroy();\r\n        }\r\n        if (this._instanceParticleVertexBuffer) {\r\n            this._instanceParticleVertexBuffer.destroy();\r\n        }\r\n\r\n        this._instanceVertex = null;\r\n        this._meshIndexCount = null;\r\n        this._meshFloatCountPreVertex = null;\r\n    }\r\n}\r\n","import { Material } from \"../../../resource/Material\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\"\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\n\r\n\r\n/**\r\n * <code>ShurikenParticleMaterial</code> \r\n */\r\nexport class ShurikenParticleMaterial extends Material {\r\n\t/**_*/\r\n\tstatic RENDERMODE_ALPHABLENDED: number = 0;\r\n\t/**_*/\r\n\tstatic RENDERMODE_ADDTIVE: number = 1;\r\n\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DIFFUSEMAP: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_TINTCOLOR: ShaderDefine;\r\n\t/**@interanl */\r\n\tstatic SHADERDEFINE_ADDTIVEFOG: ShaderDefine;\r\n\r\n\t/**@internal */\r\n\tstatic DIFFUSETEXTURE: number;\r\n\t/**@internal */\r\n\tstatic TINTCOLOR: number;\r\n\t/**@internal */\r\n\tstatic TILINGOFFSET: number;\r\n\r\n\t/** */\r\n\tstatic defaultMaterial: ShurikenParticleMaterial;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __initDefine__(): void {\r\n\t\tShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP = Shader3D.getDefineByName(\"DIFFUSEMAP\");\r\n\t\tShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR = Shader3D.getDefineByName(\"TINTCOLOR\");\r\n\t\tShurikenParticleMaterial.SHADERDEFINE_ADDTIVEFOG = Shader3D.getDefineByName(\"ADDTIVEFOG\");\r\n\t\tShurikenParticleMaterial.DIFFUSETEXTURE = Shader3D.propertyNameToID(\"u_texture\");\r\n\t\tShurikenParticleMaterial.TINTCOLOR = Shader3D.propertyNameToID(\"u_Tintcolor\");\r\n\t\tShurikenParticleMaterial.TILINGOFFSET = Shader3D.propertyNameToID(\"u_TilingOffset\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget color(): Color {\r\n\t\treturn this._shaderValues.getColor(ShurikenParticleMaterial.TINTCOLOR);\r\n\t}\r\n\r\n\tset color(value: Color) {\r\n\t\tif (value)\r\n\t\t\tthis._shaderValues.addDefine(ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR);\r\n\t\telse\r\n\t\t\tthis._shaderValues.removeDefine(ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR);\r\n\r\n\t\tthis._shaderValues.setColor(ShurikenParticleMaterial.TINTCOLOR, value);\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget tilingOffset(): Vector4 {\r\n\t\treturn (<Vector4>this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET));\r\n\t}\r\n\r\n\tset tilingOffset(value: Vector4) {\r\n\t\tif (value) {\r\n\t\t\tthis._shaderValues.setVector(ShurikenParticleMaterial.TILINGOFFSET, value);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET).setValue(1.0, 1.0, 0.0, 0.0);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget texture(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(ShurikenParticleMaterial.DIFFUSETEXTURE);\r\n\t}\r\n\r\n\tset texture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis._shaderValues.addDefine(ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP);\r\n\t\telse\r\n\t\t\tthis._shaderValues.removeDefine(ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP);\r\n\r\n\t\tthis._shaderValues.setTexture(ShurikenParticleMaterial.DIFFUSETEXTURE, value);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t *  <code>ShurikenParticleMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"PARTICLESHURIKEN\");\r\n\t\t// this._shaderValues.setColor(ShurikenParticleMaterial.TINTCOLOR, new Color(0.5, 0.5, 0.5, 0.5));\r\n\t\t// this._shaderValues.setVector(ShurikenParticleMaterial.TILINGOFFSET, new Vector4(1.0, 1.0, 0.0, 0.0));\r\n\t\tthis.renderMode = ShurikenParticleMaterial.RENDERMODE_ALPHABLENDED;//\r\n\t}\r\n\r\n\t/**\r\n\t* \r\n\t* @return\t \r\n\t* @override\r\n\t*/\r\n\tclone(): any {\r\n\t\tvar dest: ShurikenParticleMaterial = new ShurikenParticleMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n\r\n\t//----------------deprecated----------------\r\n\t/**\r\n\t * @deprecated\r\n\t * \r\n\t */\r\n\tset renderMode(value: number) {\r\n\t\tswitch (value) {\r\n\t\t\tcase ShurikenParticleMaterial.RENDERMODE_ADDTIVE:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_NONE;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis._shaderValues.addDefine(ShurikenParticleMaterial.SHADERDEFINE_ADDTIVEFOG);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShurikenParticleMaterial.RENDERMODE_ALPHABLENDED:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_NONE;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis._shaderValues.removeDefine(ShurikenParticleMaterial.SHADERDEFINE_ADDTIVEFOG);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"ShurikenParticleMaterial : renderMode value error.\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * X\r\n\t */\r\n\tget tilingOffsetX(): number {\r\n\t\treturn this._MainTex_STX;\r\n\t}\r\n\r\n\tset tilingOffsetX(x: number) {\r\n\t\tthis._MainTex_STX = x;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * Y\r\n\t */\r\n\tget tilingOffsetY(): number {\r\n\t\treturn this._MainTex_STY;\r\n\t}\r\n\r\n\tset tilingOffsetY(y: number) {\r\n\t\tthis._MainTex_STY = y;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * Z\r\n\t */\r\n\tget tilingOffsetZ(): number {\r\n\t\treturn this._MainTex_STZ;\r\n\t}\r\n\r\n\tset tilingOffsetZ(z: number) {\r\n\t\tthis._MainTex_STZ = z;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * W\r\n\t */\r\n\tget tilingOffsetW(): number {\r\n\t\treturn this._MainTex_STW;\r\n\t}\r\n\r\n\tset tilingOffsetW(w: number) {\r\n\t\tthis._MainTex_STW = w;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _TintColor(): Color {\r\n\t\treturn this.color;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _TintColor(value: Color) {\r\n\t\tthis.color = value;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _TintColorR(): number {\r\n\t\treturn this.color.r;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _TintColorR(value: number) {\r\n\t\tthis.color.r = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _TintColorG(): number {\r\n\t\treturn this.color.g;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _TintColorG(value: number) {\r\n\t\tthis.color.g = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _TintColorB(): number {\r\n\t\treturn this.color.b;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _TintColorB(value: number) {\r\n\t\tthis.color.b = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal \r\n\t */\r\n\tget _TintColorA(): number {\r\n\t\treturn this.color.a;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _TintColorA(value: number) {\r\n\t\tthis.color.a = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _MainTex_ST(): Vector4 {\r\n\t\treturn this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET)\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _MainTex_ST(value: Vector4) {\r\n\t\tvar tilOff: Vector4 = (<Vector4>this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET));\r\n\t\ttilOff.setValue(value.x, value.y, value.z, value.w);\r\n\t\tthis.tilingOffset = tilOff;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _MainTex_STX(): number {\r\n\t\treturn this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET).x;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _MainTex_STX(x: number) {\r\n\t\tvar tilOff: Vector4 = (<Vector4>this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET));\r\n\t\ttilOff.x = x;\r\n\t\tthis.tilingOffset = tilOff;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _MainTex_STY(): number {\r\n\t\treturn this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET).y;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _MainTex_STY(y: number) {\r\n\t\tvar tilOff: Vector4 = (<Vector4>this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET));\r\n\t\ttilOff.y = y;\r\n\t\tthis.tilingOffset = tilOff;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _MainTex_STZ(): number {\r\n\t\treturn this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET).z;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _MainTex_STZ(z: number) {\r\n\t\tvar tilOff: Vector4 = (<Vector4>this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET));\r\n\t\ttilOff.z = z;\r\n\t\tthis.tilingOffset = tilOff;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _MainTex_STW(): number {\r\n\t\treturn this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET).w;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _MainTex_STW(w: number) {\r\n\t\tvar tilOff: Vector4 = (<Vector4>this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET));\r\n\t\ttilOff.w = w;\r\n\t\tthis.tilingOffset = tilOff;\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * R\r\n\t */\r\n\tget colorR(): number {\r\n\t\treturn this._TintColorR;\r\n\t}\r\n\r\n\tset colorR(value: number) {\r\n\t\tthis._TintColorR = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * G\r\n\t */\r\n\tget colorG(): number {\r\n\t\treturn this._TintColorG;\r\n\t}\r\n\r\n\tset colorG(value: number) {\r\n\t\tthis._TintColorG = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * B\r\n\t */\r\n\tget colorB(): number {\r\n\t\treturn this._TintColorB;\r\n\t}\r\n\r\n\tset colorB(value: number) {\r\n\t\tthis._TintColorB = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * Z\r\n\t */\r\n\tget colorA(): number {\r\n\t\treturn this._TintColorA;\r\n\t}\r\n\r\n\tset colorA(value: number) {\r\n\t\tthis._TintColorA = value;\r\n\t}\r\n}\r\n\r\n\r\n","import { BoundFrustum } from \"../../math/BoundFrustum\";\r\nimport { Mesh } from \"../../resource/models/Mesh\";\r\nimport { BaseRender } from \"../render/BaseRender\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { Transform3D } from \"../Transform3D\";\r\nimport { ShurikenParticleSystem } from \"./ShurikenParticleSystem\";\r\nimport { ShuriKenParticle3DShaderDeclaration } from \"./ShuriKenParticle3DShaderDeclaration\";\r\nimport { ShurikenParticleInstanceSystem } from \"./ShurikenParticleInstanceSystem\";\r\nimport { RenderElement } from \"../render/RenderElement\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { ShurikenParticleMaterial } from \"./ShurikenParticleMaterial\";\r\nimport { Component } from \"../../../components/Component\";\r\nimport { RenderCapable } from \"../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { ShaderData, ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Stat } from \"../../../utils/Stat\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { LayaEnv } from \"../../../../LayaEnv\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\n\r\n\r\n/**\r\n * <code>ShurikenParticleRender</code> 3D\r\n */\r\nexport class ShurikenParticleRenderer extends BaseRender {\r\n    /***/\r\n    static gravity: Vector3 = new Vector3(0, -9.81, 0);\r\n    /** @internal */\r\n    private _finalGravity: Vector3 = new Vector3();\r\n    private _dragConstant: Vector2 = new Vector2();\r\n\r\n\r\n    /**@internal */\r\n    private _renderMode: number;\r\n    /**@internal */\r\n    private _mesh: Mesh = null;\r\n\r\n    /**@interanl */\r\n    _particleSystem: ShurikenParticleSystem;\r\n    /**,*/\r\n    stretchedBillboardCameraSpeedScale: number = 0;\r\n    /***/\r\n    stretchedBillboardSpeedScale: number = 0;\r\n    /***/\r\n    stretchedBillboardLengthScale: number = 2;\r\n\r\n    get particleSystem(): ShurikenParticleSystem {\r\n        return this._particleSystem;\r\n    }\r\n\r\n    ///***/\r\n    //public var sortingMode:int;\r\n\r\n    /**\r\n     * ,0BILLBOARD1STRETCHEDBILLBOARD2HORIZONTALBILLBOARD3VERTICALBILLBOARD4MESH\r\n     */\r\n    get renderMode(): number {\r\n        return this._renderMode;\r\n    }\r\n\r\n    set renderMode(value: number) {\r\n        if (this._renderMode !== value) {\r\n            var defineDatas: ShaderData = this._shaderValues;\r\n            switch (this._renderMode) {\r\n                case 0:\r\n                    defineDatas.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_BILLBOARD);\r\n                    break;\r\n                case 1:\r\n                    defineDatas.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);\r\n                    break;\r\n                case 2:\r\n                    defineDatas.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);\r\n                    break;\r\n                case 3:\r\n                    defineDatas.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);\r\n                    break;\r\n                case 4:\r\n                    defineDatas.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_MESH);\r\n                    break;\r\n            }\r\n            this._renderMode = value;\r\n            switch (value) {\r\n                case 0:\r\n                    defineDatas.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_BILLBOARD);\r\n                    break;\r\n                case 1:\r\n                    defineDatas.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);\r\n                    break;\r\n                case 2:\r\n                    defineDatas.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);\r\n                    break;\r\n                case 3:\r\n                    defineDatas.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);\r\n                    break;\r\n                case 4:\r\n                    defineDatas.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_MESH);\r\n                    break;\r\n                default:\r\n                    throw new Error(\"ShurikenParticleRender: unknown renderMode Value.\");\r\n            }\r\n            var parSys: ShurikenParticleSystem = this._particleSystem;\r\n            (parSys) && (parSys._initBufferDatas());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Mesh,rendderMode4\r\n     */\r\n    get mesh(): Mesh {\r\n        return this._mesh;\r\n    }\r\n\r\n    set mesh(value: Mesh) {\r\n        if (this._mesh !== value) {\r\n            (this._mesh) && (this._mesh._removeReference());\r\n            this._mesh = value;\r\n            (value) && (value._addReference());\r\n            this._particleSystem._initBufferDatas();\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  <code>ShurikenParticleRender</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this.renderMode = 0;\r\n        this._supportOctree = false;\r\n    }\r\n\r\n    protected _getcommonUniformMap(): Array<string> {\r\n        return [\"Sprite3D\", \"ShurikenSprite3D\"];\r\n    }\r\n\r\n\r\n    protected _onAdded(): void {\r\n        super._onAdded();\r\n        if (!LayaGL.renderEngine.getCapable(RenderCapable.DrawElement_Instance)) {\r\n            this._particleSystem = new ShurikenParticleSystem(this);\r\n        } else\r\n            this._particleSystem = new ShurikenParticleInstanceSystem(this);\r\n\r\n        var elements: RenderElement[] = this._renderElements;\r\n        var element: RenderElement = elements[0] = new RenderElement();\r\n        element.setTransform((this.owner as Sprite3D)._transform);\r\n        element.render = this;\r\n        element.setGeometry(this._particleSystem);\r\n        element.material = ShurikenParticleMaterial.defaultMaterial;\r\n    }\r\n\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n\r\n        Stat.particleRenderNode++;\r\n        (this._particleSystem.playOnAwake && LayaEnv.isPlaying) && (this._particleSystem.play());\r\n    }\r\n\r\n    protected _onDisable(): void {\r\n        super._onDisable();\r\n\r\n        Stat.particleRenderNode--;\r\n        (this._particleSystem.isAlive) && (this._particleSystem.simulate(0, true));\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @internal\r\n     * @override\r\n     */\r\n    protected _calculateBoundingBox(): void {\r\n        var particleSystem: ShurikenParticleSystem = this._particleSystem;\r\n        var bounds: Bounds;\r\n        if (particleSystem._useCustomBounds) {\r\n            bounds = particleSystem.customBounds;\r\n            bounds._tranform((this.owner as Sprite3D).transform.worldMatrix, this._bounds);\r\n        }\r\n        else if (particleSystem._simulationSupported()) {\r\n            // todo need update Bounds\r\n            particleSystem._generateBounds();\r\n            bounds = particleSystem._bounds;\r\n            bounds._tranform((this.owner as Sprite3D).transform.worldMatrix, this._bounds);\r\n            // \r\n            if (particleSystem.gravityModifier != 0) {\r\n                var max: Vector3 = this._bounds.getMax();\r\n                var min: Vector3 = this._bounds.getMin();\r\n                var gravityOffset: Vector2 = particleSystem._gravityOffset;\r\n                max.y -= gravityOffset.x;\r\n                min.y -= gravityOffset.y;\r\n                this._bounds.setMax(max);\r\n                this._bounds.setMin(min);\r\n            }\r\n        }\r\n        else {\r\n            var min: Vector3 = this._bounds.getMin();\r\n            min.setValue(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE);\r\n            this._bounds.setMin(min);\r\n            var max: Vector3 = this._bounds.getMax();\r\n            max.setValue(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);\r\n            this._bounds.setMax(max);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @internal\r\n     * @override\r\n     */\r\n    _needRender(boundFrustum: BoundFrustum, context: RenderContext3D): boolean {\r\n        if (!Stat.enableParticle)\r\n            return false;\r\n        if (boundFrustum) {\r\n            if (boundFrustum.intersects(this.bounds)) {\r\n                if (this._particleSystem.isAlive)\r\n                    return true;\r\n                else\r\n                    return false;\r\n            } else {\r\n                return false;\r\n            }\r\n        } else {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @internal\r\n     * @override\r\n     */\r\n    _renderUpdate(context: RenderContext3D, transfrom: Transform3D): void {\r\n        var particleSystem: ShurikenParticleSystem = this._particleSystem;\r\n        var sv: ShaderData = this._shaderValues;\r\n        var transform: Transform3D = (this.owner as Sprite3D).transform;\r\n        switch (particleSystem.simulationSpace) {\r\n            case 0: //World\r\n                break;\r\n            case 1: //Local\r\n                sv.setVector3(ShuriKenParticle3DShaderDeclaration.WORLDPOSITION, transform.position);\r\n                sv.setShaderData(ShuriKenParticle3DShaderDeclaration.WORLDROTATION, ShaderDataType.Vector4, transform.rotation);\r\n                break;\r\n            default:\r\n                throw new Error(\"ShurikenParticleMaterial: SimulationSpace value is invalid.\");\r\n        }\r\n\r\n        switch (particleSystem.scaleMode) {\r\n            case 0:\r\n                var scale: Vector3 = transform.getWorldLossyScale();\r\n                sv.setVector3(ShuriKenParticle3DShaderDeclaration.POSITIONSCALE, scale);\r\n                sv.setVector3(ShuriKenParticle3DShaderDeclaration.SIZESCALE, scale);\r\n                break;\r\n            case 1:\r\n                var localScale: Vector3 = transform.localScale;\r\n                sv.setVector3(ShuriKenParticle3DShaderDeclaration.POSITIONSCALE, localScale);\r\n                sv.setVector3(ShuriKenParticle3DShaderDeclaration.SIZESCALE, localScale);\r\n                break;\r\n            case 2:\r\n                sv.setVector3(ShuriKenParticle3DShaderDeclaration.POSITIONSCALE, transform.getWorldLossyScale());\r\n                sv.setVector3(ShuriKenParticle3DShaderDeclaration.SIZESCALE, Vector3.ONE);\r\n                break;\r\n        }\r\n\r\n        switch (particleSystem.dragType) {\r\n            case 0:\r\n                this._dragConstant.setValue(particleSystem.dragSpeedConstantMin, particleSystem.dragSpeedConstantMin);\r\n                sv.setVector2(ShuriKenParticle3DShaderDeclaration.DRAG, this._dragConstant);\r\n                break;\r\n            case 2:\r\n                this._dragConstant.setValue(particleSystem.dragSpeedConstantMin, particleSystem.dragSpeedConstantMax);\r\n                sv.setVector2(ShuriKenParticle3DShaderDeclaration.DRAG, this._dragConstant);\r\n                break;\r\n            default:\r\n                this._dragConstant.setValue(0, 0);\r\n                break;\r\n        }\r\n\r\n        Vector3.scale(ShurikenParticleRenderer.gravity, particleSystem.gravityModifier, this._finalGravity);\r\n        sv.setVector3(ShuriKenParticle3DShaderDeclaration.GRAVITY, this._finalGravity);\r\n        sv.setInt(ShuriKenParticle3DShaderDeclaration.SIMULATIONSPACE, particleSystem.simulationSpace);\r\n        sv.setBool(ShuriKenParticle3DShaderDeclaration.THREEDSTARTROTATION, particleSystem.threeDStartRotation);\r\n        sv.setInt(ShuriKenParticle3DShaderDeclaration.SCALINGMODE, particleSystem.scaleMode);\r\n        sv.setNumber(ShuriKenParticle3DShaderDeclaration.STRETCHEDBILLBOARDLENGTHSCALE, this.stretchedBillboardLengthScale);\r\n        sv.setNumber(ShuriKenParticle3DShaderDeclaration.STRETCHEDBILLBOARDSPEEDSCALE, this.stretchedBillboardSpeedScale);\r\n        sv.setNumber(ShuriKenParticle3DShaderDeclaration.CURRENTTIME, particleSystem._currentTime);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    get bounds(): Bounds {\r\n        if (this.boundsChange) {\r\n            this._calculateBoundingBox();\r\n            this.boundsChange = false;\r\n        }\r\n        return this._bounds;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    _cloneTo(dest: Component): void {\r\n        let parRender = dest as ShurikenParticleRenderer;\r\n        this._particleSystem.cloneTo(parRender._particleSystem);\r\n        parRender.sharedMaterial = this.sharedMaterial;\r\n        parRender.renderMode = this.renderMode;\r\n        parRender.mesh = this.mesh;\r\n        parRender.stretchedBillboardCameraSpeedScale = this.stretchedBillboardCameraSpeedScale;\r\n        parRender.stretchedBillboardSpeedScale = this.stretchedBillboardSpeedScale;\r\n        parRender.stretchedBillboardLengthScale = this.stretchedBillboardLengthScale;\r\n        parRender.sortingFudge = this.sortingFudge;\r\n    }\r\n\r\n    protected _onDestroy() {\r\n        (this._mesh) && (this._mesh._removeReference(), this._mesh = null);\r\n        this._particleSystem.destroy();\r\n        this._particleSystem = null;\r\n        super._onDestroy();\r\n    }\r\n\r\n}\r\n\r\n\r\n","import { Node } from \"../../../display/Node\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { Loader } from \"../../../net/Loader\";\r\nimport { Texture } from \"../../../resource/Texture\";\r\nimport { Gradient } from \"../Gradient\";\r\nimport { RenderableSprite3D } from \"../RenderableSprite3D\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Burst } from \"./module/Burst\";\r\nimport { ColorOverLifetime } from \"./module/ColorOverLifetime\";\r\nimport { Emission } from \"./module/Emission\";\r\nimport { FrameOverTime } from \"./module/FrameOverTime\";\r\nimport { GradientAngularVelocity } from \"./module/GradientAngularVelocity\";\r\nimport { GradientColor } from \"./module/GradientColor\";\r\nimport { GradientDataInt } from \"./module/GradientDataInt\";\r\nimport { GradientDataNumber } from \"./module/GradientDataNumber\";\r\nimport { GradientSize } from \"./module/GradientSize\";\r\nimport { GradientVelocity } from \"./module/GradientVelocity\";\r\nimport { RotationOverLifetime } from \"./module/RotationOverLifetime\";\r\nimport { BaseShape } from \"./module/shape/BaseShape\";\r\nimport { BoxShape } from \"./module/shape/BoxShape\";\r\nimport { CircleShape } from \"./module/shape/CircleShape\";\r\nimport { ConeShape } from \"./module/shape/ConeShape\";\r\nimport { HemisphereShape } from \"./module/shape/HemisphereShape\";\r\nimport { SphereShape } from \"./module/shape/SphereShape\";\r\nimport { SizeOverLifetime } from \"./module/SizeOverLifetime\";\r\nimport { StartFrame } from \"./module/StartFrame\";\r\nimport { TextureSheetAnimation } from \"./module/TextureSheetAnimation\";\r\nimport { VelocityOverLifetime } from \"./module/VelocityOverLifetime\";\r\nimport { ShurikenParticleMaterial } from \"./ShurikenParticleMaterial\";\r\nimport { ShurikenParticleRenderer } from \"./ShurikenParticleRenderer\";\r\nimport { ShurikenParticleSystem } from \"./ShurikenParticleSystem\";\r\n\r\n/**\r\n * <code>ShuriKenParticle3D</code> 3D\r\n */\r\nexport class ShuriKenParticle3D extends RenderableSprite3D {\r\n\r\n\t/** @internal */\r\n\tprivate _particleSystem: ShurikenParticleSystem;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget particleSystem(): ShurikenParticleSystem {\r\n\t\treturn this._particleSystem;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget particleRenderer(): ShurikenParticleRenderer {\r\n\t\treturn <ShurikenParticleRenderer>this._render;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Particle3D</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper(null);\r\n\t\tthis._render = this.addComponent(ShurikenParticleRenderer) as ShurikenParticleRenderer;\r\n\t\tthis._particleSystem = (this._render as ShurikenParticleRenderer)._particleSystem;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_parseModule(module: any, moduleData: any): void {\r\n\t\tfor (var t in moduleData) {\r\n\t\t\tswitch (t) {\r\n\t\t\t\tcase \"bases\":\r\n\t\t\t\t\tvar bases = moduleData.bases;\r\n\t\t\t\t\tfor (var k in bases)\r\n\t\t\t\t\t\tmodule[k] = bases[k];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"vector2s\":\r\n\t\t\t\t\tvar vector2s = moduleData.vector2s;\r\n\t\t\t\t\tfor (var k in vector2s) {\r\n\t\t\t\t\t\tvar vec2: Vector2 = module[k];\r\n\t\t\t\t\t\tvar vec2Data: number[] = vector2s[k];\r\n\t\t\t\t\t\tvec2.setValue(vec2Data[0], vec2Data[1]);\r\n\t\t\t\t\t\tmodule[k] = vec2;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"vector3s\":\r\n\t\t\t\t\tvar vector3s = moduleData.vector3s;\r\n\t\t\t\t\tfor (var k in vector3s) {\r\n\t\t\t\t\t\tvar vec3: Vector3 = module[k];\r\n\t\t\t\t\t\tvar vec3Data: number[] = vector3s[k];\r\n\t\t\t\t\t\tvec3.setValue(vec3Data[0], vec3Data[1], vec3Data[2]);\r\n\t\t\t\t\t\tmodule[k] = vec3;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"vector4s\":\r\n\t\t\t\t\tvar vector4s = moduleData.vector4s;\r\n\t\t\t\t\tfor (var k in vector4s) {\r\n\t\t\t\t\t\tvar vec4: Vector4 = module[k];\r\n\t\t\t\t\t\tvar vec4Data: number[] = vector4s[k];\r\n\t\t\t\t\t\tvec4.setValue(vec4Data[0], vec4Data[1], vec4Data[2], vec4Data[3]);\r\n\t\t\t\t\t\tmodule[k] = vec4;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"gradientDataNumbers\":\r\n\t\t\t\t\tvar gradientDataNumbers: object = moduleData.gradientDataNumbers;\r\n\t\t\t\t\tfor (var k in gradientDataNumbers) {\r\n\t\t\t\t\t\tvar gradientNumber: GradientDataNumber = module[k];\r\n\t\t\t\t\t\tvar gradientNumberData: any[] = moduleData[k];\r\n\t\t\t\t\t\tfor (var i: number = 0, n: number = gradientNumberData.length; i < n; i++) {\r\n\t\t\t\t\t\t\tvar valueData: any = gradientNumberData[i];\r\n\t\t\t\t\t\t\tgradientNumber.add(valueData.key, valueData.value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tmodule[k] = gradientNumber;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"resources\":\r\n\t\t\t\t\tvar resources: any = moduleData.resources;\r\n\t\t\t\t\tfor (var k in resources) {\r\n\t\t\t\t\t\tlet res = Loader.getRes(resources[k]);\r\n\t\t\t\t\t\tif (res && (res instanceof Texture)) {\r\n\t\t\t\t\t\t\tres = res.bitmap;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tmodule[k] = res;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"bursts\":\r\n\t\t\t\t\tvar burstsData: any[] = moduleData.bursts;\r\n\t\t\t\t\tfor (var i: number = 0, n: number = burstsData.length; i < n; i++) {\r\n\t\t\t\t\t\tvar brust: any = burstsData[i];\r\n\t\t\t\t\t\tmodule.addBurst(new Burst(brust.time, brust.min, brust.max));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"randomSeed\":\r\n\t\t\t\t\tmodule.randomSeed[0] = moduleData.randomSeed;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"shapeType\"://TODO:remove in the fulther\r\n\t\t\t\tcase \"type\":\r\n\t\t\t\tcase \"color\":\r\n\t\t\t\tcase \"size\":\r\n\t\t\t\tcase \"frame\":\r\n\t\t\t\tcase \"startFrame\":\r\n\t\t\t\tcase \"angularVelocity\":\r\n\t\t\t\tcase \"velocity\":\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow \"ShurikenParticle3D:unknown type.\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_parse(data: any, spriteMap: any): void {\r\n\t\tsuper._parse(data, spriteMap);\r\n\t\tif (data.main) {\r\n\t\t\tvar particleSystem: ShurikenParticleSystem = this.particleSystem;\r\n\t\t\tvar particleRender: ShurikenParticleRenderer = this.particleRenderer;\r\n\t\t\tthis._parseModule(particleRender, data.renderer);//Renderer\r\n\t\t\tthis._parseModule(particleSystem, data.main);//particleSystem\r\n\t\t\tthis._parseModule(particleSystem.emission, data.emission);//Emission\r\n\r\n\t\t\t//Shape\r\n\t\t\tvar shapeData: any = data.shape;\r\n\t\t\tif (shapeData) {\r\n\t\t\t\tvar shape: BaseShape;\r\n\t\t\t\tswitch (shapeData.shapeType) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tshape = new SphereShape();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tshape = new HemisphereShape();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tshape = new ConeShape();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tshape = new BoxShape();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 7:\r\n\t\t\t\t\t\tshape = new CircleShape();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow \"ShuriKenParticle3D:unknown shape type.\";\r\n\t\t\t\t}\r\n\t\t\t\tthis._parseModule(shape, shapeData);\r\n\t\t\t\tparticleSystem.shape = shape;\r\n\t\t\t}\r\n\r\n\t\t\t//VelocityOverLifetime\r\n\t\t\tvar velocityOverLifetimeData: any = data.velocityOverLifetime;\r\n\t\t\tif (velocityOverLifetimeData) {\r\n\t\t\t\tvar velocityData: any = velocityOverLifetimeData.velocity;\r\n\t\t\t\tvar velocity: GradientVelocity;\r\n\t\t\t\tswitch (velocityData.type) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tvar constantData: any[] = velocityData.constant;\r\n\t\t\t\t\t\tvelocity = GradientVelocity.createByConstant(constantData ? new Vector3(constantData[0], constantData[1], constantData[2]) : new Vector3(0, 0, 0));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tvelocity = GradientVelocity.createByGradient(this._initParticleVelocity(velocityData.gradientX), this._initParticleVelocity(velocityData.gradientY), this._initParticleVelocity(velocityData.gradientZ));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tvar constantMinData: any[] = velocityData.constantMin;\r\n\t\t\t\t\t\tvar constantMaxData: any[] = velocityData.constantMax;\r\n\t\t\t\t\t\tvelocity = GradientVelocity.createByRandomTwoConstant(constantMinData ? new Vector3(constantMinData[0], constantMinData[1], constantMinData[2]) : new Vector3(0, 0, 0), constantMaxData ? new Vector3(constantMaxData[0], constantMaxData[1], constantMaxData[2]) : new Vector3(0, 0, 0));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tvelocity = GradientVelocity.createByRandomTwoGradient(this._initParticleVelocity(velocityData.gradientXMin), this._initParticleVelocity(velocityData.gradientXMax), this._initParticleVelocity(velocityData.gradientYMin), this._initParticleVelocity(velocityData.gradientYMax), this._initParticleVelocity(velocityData.gradientZMin), this._initParticleVelocity(velocityData.gradientZMax));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tvar velocityOverLifetime: VelocityOverLifetime = new VelocityOverLifetime(velocity);\r\n\t\t\t\tthis._parseModule(velocityOverLifetime, velocityOverLifetimeData);\r\n\t\t\t\tparticleSystem.velocityOverLifetime = velocityOverLifetime;\r\n\t\t\t}\r\n\r\n\t\t\t//ColorOverLifetime\r\n\t\t\tvar colorOverLifetimeData: any = data.colorOverLifetime;\r\n\r\n\t\t\tif (colorOverLifetimeData) {\r\n\t\t\t\tvar colorData: any = colorOverLifetimeData.color;\r\n\t\t\t\tlet maxKeyCount = colorData.maxKeyCount;\r\n\t\t\t\tvar color: GradientColor;\r\n\t\t\t\tswitch (colorData.type) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tvar constColorData: any[] = colorData.constant;\r\n\t\t\t\t\t\tcolor = GradientColor.createByConstant(constColorData ? new Vector4(constColorData[0], constColorData[1], constColorData[2], constColorData[3]) : new Vector4(0, 0, 0, 0));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tcolor = GradientColor.createByGradient(this._initParticleColor(colorData.gradient, maxKeyCount));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tvar minConstColorData: any[] = colorData.constantMin;\r\n\t\t\t\t\t\tvar maxConstColorData: any[] = colorData.constantMax;\r\n\t\t\t\t\t\tcolor = GradientColor.createByRandomTwoConstant(minConstColorData ? new Vector4(minConstColorData[0], minConstColorData[1], minConstColorData[2], minConstColorData[3]) : new Vector4(0, 0, 0, 0), minConstColorData ? new Vector4(maxConstColorData[0], maxConstColorData[1], maxConstColorData[2], maxConstColorData[3]) : new Vector4(0, 0, 0, 0));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tcolor = GradientColor.createByRandomTwoGradient(this._initParticleColor(colorData.gradientMin, maxKeyCount), this._initParticleColor(colorData.gradientMax, maxKeyCount));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tvar colorOverLifetime: ColorOverLifetime = new ColorOverLifetime(color);\r\n\t\t\t\tthis._parseModule(colorOverLifetime, colorOverLifetimeData);\r\n\t\t\t\tparticleSystem.colorOverLifetime = colorOverLifetime;\r\n\t\t\t}\r\n\r\n\t\t\t//SizeOverLifetime\r\n\t\t\tvar sizeOverLifetimeData: any = data.sizeOverLifetime;\r\n\t\t\tif (sizeOverLifetimeData) {\r\n\t\t\t\tvar sizeData: any = sizeOverLifetimeData.size;\r\n\t\t\t\tvar size: GradientSize;\r\n\t\t\t\tswitch (sizeData.type) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tif (sizeData.separateAxes) {\r\n\t\t\t\t\t\t\tsize = GradientSize.createByGradientSeparate(this._initParticleSize(sizeData.gradientX), this._initParticleSize(sizeData.gradientY), this._initParticleSize(sizeData.gradientZ));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsize = GradientSize.createByGradient(this._initParticleSize(sizeData.gradient));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tif (sizeData.separateAxes) {\r\n\t\t\t\t\t\t\tvar constantMinSeparateData: any[] = sizeData.constantMinSeparate;\r\n\t\t\t\t\t\t\tvar constantMaxSeparateData: any[] = sizeData.constantMaxSeparate;\r\n\t\t\t\t\t\t\tsize = GradientSize.createByRandomTwoConstantSeparate(constantMinSeparateData ? new Vector3(constantMinSeparateData[0], constantMinSeparateData[1], constantMinSeparateData[2]) : new Vector3(0, 0, 0), constantMaxSeparateData ? new Vector3(constantMaxSeparateData[0], constantMaxSeparateData[1], constantMaxSeparateData[2]) : new Vector3(0, 0, 0));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsize = GradientSize.createByRandomTwoConstant(sizeData.constantMin || 0, sizeData.constantMax || 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tif (sizeData.separateAxes) {\r\n\t\t\t\t\t\t\tsize = GradientSize.createByRandomTwoGradientSeparate(this._initParticleSize(sizeData.gradientXMin), this._initParticleSize(sizeData.gradientYMin), this._initParticleSize(sizeData.gradientZMin), this._initParticleSize(sizeData.gradientXMax), this._initParticleSize(sizeData.gradientYMax), this._initParticleSize(sizeData.gradientZMax));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsize = GradientSize.createByRandomTwoGradient(this._initParticleSize(sizeData.gradientMin), this._initParticleSize(sizeData.gradientMax));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tvar sizeOverLifetime: SizeOverLifetime = new SizeOverLifetime(size);\r\n\t\t\t\tthis._parseModule(sizeOverLifetime, sizeOverLifetimeData);\r\n\t\t\t\tparticleSystem.sizeOverLifetime = sizeOverLifetime;\r\n\t\t\t}\r\n\r\n\t\t\t//RotationOverLifetime\r\n\t\t\tvar rotationOverLifetimeData: any = data.rotationOverLifetime;\r\n\t\t\tif (rotationOverLifetimeData) {\r\n\t\t\t\tvar angularVelocityData: any = rotationOverLifetimeData.angularVelocity;\r\n\t\t\t\tvar angularVelocity: GradientAngularVelocity;\r\n\t\t\t\tswitch (angularVelocityData.type) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\t\tvar conSep: any[] = angularVelocityData.constantSeparate;\r\n\t\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByConstantSeparate(conSep ? new Vector3(conSep[0], conSep[1], conSep[2]) : new Vector3(0, 0, Math.PI / 4));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByConstant(angularVelocityData.constant || Math.PI / 4);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByGradientSeparate(this._initParticleRotation(angularVelocityData.gradientX), this._initParticleRotation(angularVelocityData.gradientY), this._initParticleRotation(angularVelocityData.gradientZ));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByGradient(this._initParticleRotation(angularVelocityData.gradient));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\t\tvar minSep: any[] = angularVelocityData.constantMinSeparate;//TODO:Y\r\n\t\t\t\t\t\t\tvar maxSep: any[] = angularVelocityData.constantMaxSeparate;//TODO:Y\r\n\t\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByRandomTwoConstantSeparate(minSep ? new Vector3(minSep[0], minSep[1], minSep[2]) : new Vector3(0, 0, 0), maxSep ? new Vector3(maxSep[0], maxSep[1], maxSep[2]) : new Vector3(0, 0, Math.PI / 4));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByRandomTwoConstant(angularVelocityData.constantMin || 0, angularVelocityData.constantMax || Math.PI / 4);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\t\t//TODO:\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByRandomTwoGradient(this._initParticleRotation(angularVelocityData.gradientMin), this._initParticleRotation(angularVelocityData.gradientMax));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tvar rotationOverLifetime: RotationOverLifetime = new RotationOverLifetime(angularVelocity);\r\n\t\t\t\tthis._parseModule(rotationOverLifetime, rotationOverLifetimeData);\r\n\t\t\t\tparticleSystem.rotationOverLifetime = rotationOverLifetime;\r\n\t\t\t}\r\n\r\n\t\t\t//TextureSheetAnimation\r\n\t\t\tvar textureSheetAnimationData: any = data.textureSheetAnimation;\r\n\t\t\tif (textureSheetAnimationData) {\r\n\t\t\t\tvar frameData: any = textureSheetAnimationData.frame;\r\n\t\t\t\tvar frameOverTime: FrameOverTime;\r\n\t\t\t\tswitch (frameData.type) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tframeOverTime = FrameOverTime.createByConstant(frameData.constant);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tframeOverTime = FrameOverTime.createByOverTime(this._initParticleFrame(frameData.overTime));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tframeOverTime = FrameOverTime.createByRandomTwoConstant(frameData.constantMin, frameData.constantMax);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tframeOverTime = FrameOverTime.createByRandomTwoOverTime(this._initParticleFrame(frameData.overTimeMin), this._initParticleFrame(frameData.overTimeMax));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tvar startFrameData: any = textureSheetAnimationData.startFrame;\r\n\t\t\t\tvar startFrame: StartFrame;\r\n\t\t\t\tswitch (startFrameData.type) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tstartFrame = StartFrame.createByConstant(startFrameData.constant);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tstartFrame = StartFrame.createByRandomTwoConstant(startFrameData.constantMin, startFrameData.constantMax);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tvar textureSheetAnimation: TextureSheetAnimation = new TextureSheetAnimation(frameOverTime, startFrame);\r\n\t\t\t\tthis._parseModule(textureSheetAnimation, textureSheetAnimationData);\r\n\t\t\t\tparticleSystem.textureSheetAnimation = textureSheetAnimation;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {//legacy\r\n\t\t\tthis._parseOld(data);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * <p></p>\r\n\t * @param\tdestroyChild true,\r\n\t * @override\r\n\t */\r\n\tdestroy(destroyChild: boolean = true): void {\r\n\t\tif (this._destroyed)\r\n\t\t\treturn;\r\n\t\tsuper.destroy(destroyChild);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Node {\r\n\t\treturn new Sprite3D();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate _parseOld(data: any): void {\r\n\t\tconst anglelToRad: number = Math.PI / 180.0;\r\n\t\tvar i: number, n: number;\r\n\r\n\t\t//Render\r\n\t\tvar particleRender: ShurikenParticleRenderer = this.particleRenderer;\r\n\t\tvar material: ShurikenParticleMaterial;\r\n\r\n\t\tvar materialData: any = data.material;\r\n\t\t(materialData) && (material = Loader.getRes(materialData.path));\r\n\r\n\t\tparticleRender.sharedMaterial = material;\r\n\t\tvar meshPath: string = data.meshPath;\r\n\t\t(meshPath) && (particleRender.mesh = Loader.getRes(meshPath));\r\n\r\n\t\tparticleRender.renderMode = data.renderMode;\r\n\t\tparticleRender.stretchedBillboardCameraSpeedScale = data.stretchedBillboardCameraSpeedScale;\r\n\t\tparticleRender.stretchedBillboardSpeedScale = data.stretchedBillboardSpeedScale;\r\n\t\tparticleRender.stretchedBillboardLengthScale = data.stretchedBillboardLengthScale;\r\n\t\tparticleRender.sortingFudge = data.sortingFudge ? data.sortingFudge : 0.0;\r\n\r\n\t\t//particleSystem\r\n\t\tvar particleSystem: ShurikenParticleSystem = this.particleSystem;\r\n\t\tparticleSystem.isPerformanceMode = data.isPerformanceMode;\r\n\r\n\t\tparticleSystem.duration = data.duration;\r\n\t\tparticleSystem.looping = data.looping;\r\n\t\tparticleSystem.prewarm = data.prewarm;\r\n\r\n\t\tparticleSystem.startDelayType = data.startDelayType;\r\n\t\tparticleSystem.startDelay = data.startDelay;\r\n\t\tparticleSystem.startDelayMin = data.startDelayMin;\r\n\t\tparticleSystem.startDelayMax = data.startDelayMax;\r\n\r\n\t\tparticleSystem.startLifetimeType = data.startLifetimeType;\r\n\t\tparticleSystem.startLifetimeConstant = data.startLifetimeConstant;\r\n\t\tparticleSystem.startLifeTimeGradient = ShuriKenParticle3D._initStartLife(data.startLifetimeGradient);\r\n\t\tparticleSystem.startLifetimeConstantMin = data.startLifetimeConstantMin;\r\n\t\tparticleSystem.startLifetimeConstantMax = data.startLifetimeConstantMax;\r\n\t\tparticleSystem.startLifeTimeGradientMin = ShuriKenParticle3D._initStartLife(data.startLifetimeGradientMin);\r\n\t\tparticleSystem.startLifeTimeGradientMax = ShuriKenParticle3D._initStartLife(data.startLifetimeGradientMax);\r\n\r\n\t\tparticleSystem.startSpeedType = data.startSpeedType;\r\n\t\tparticleSystem.startSpeedConstant = data.startSpeedConstant;\r\n\t\tparticleSystem.startSpeedConstantMin = data.startSpeedConstantMin;\r\n\t\tparticleSystem.startSpeedConstantMax = data.startSpeedConstantMax;\r\n\r\n\t\t//parse Drag TODO:\r\n\r\n\t\tparticleSystem.threeDStartSize = data.threeDStartSize;\r\n\t\tparticleSystem.startSizeType = data.startSizeType;\r\n\t\tparticleSystem.startSizeConstant = data.startSizeConstant;\r\n\t\tvar startSizeConstantSeparateArray: any[] = data.startSizeConstantSeparate;\r\n\t\tvar startSizeConstantSeparateElement: Vector3 = particleSystem.startSizeConstantSeparate;\r\n\t\tstartSizeConstantSeparateElement.x = startSizeConstantSeparateArray[0];\r\n\t\tstartSizeConstantSeparateElement.y = startSizeConstantSeparateArray[1];\r\n\t\tstartSizeConstantSeparateElement.z = startSizeConstantSeparateArray[2];\r\n\t\tparticleSystem.startSizeConstantMin = data.startSizeConstantMin;\r\n\t\tparticleSystem.startSizeConstantMax = data.startSizeConstantMax;\r\n\t\tvar startSizeConstantMinSeparateArray: any[] = data.startSizeConstantMinSeparate;\r\n\t\tvar startSizeConstantMinSeparateElement: Vector3 = particleSystem.startSizeConstantMinSeparate;\r\n\t\tstartSizeConstantMinSeparateElement.x = startSizeConstantMinSeparateArray[0];\r\n\t\tstartSizeConstantMinSeparateElement.y = startSizeConstantMinSeparateArray[1];\r\n\t\tstartSizeConstantMinSeparateElement.z = startSizeConstantMinSeparateArray[2];\r\n\t\tvar startSizeConstantMaxSeparateArray: any[] = data.startSizeConstantMaxSeparate;\r\n\t\tvar startSizeConstantMaxSeparateElement: Vector3 = particleSystem.startSizeConstantMaxSeparate;\r\n\t\tstartSizeConstantMaxSeparateElement.x = startSizeConstantMaxSeparateArray[0];\r\n\t\tstartSizeConstantMaxSeparateElement.y = startSizeConstantMaxSeparateArray[1];\r\n\t\tstartSizeConstantMaxSeparateElement.z = startSizeConstantMaxSeparateArray[2];\r\n\r\n\t\tparticleSystem.threeDStartRotation = data.threeDStartRotation;\r\n\t\tparticleSystem.startRotationType = data.startRotationType;\r\n\t\tparticleSystem.startRotationConstant = data.startRotationConstant * anglelToRad;\r\n\t\tvar startRotationConstantSeparateArray: any[] = data.startRotationConstantSeparate;\r\n\t\tvar startRotationConstantSeparateElement: Vector3 = particleSystem.startRotationConstantSeparate;\r\n\t\tstartRotationConstantSeparateElement.x = startRotationConstantSeparateArray[0] * anglelToRad;\r\n\t\tstartRotationConstantSeparateElement.y = startRotationConstantSeparateArray[1] * anglelToRad;\r\n\t\tstartRotationConstantSeparateElement.z = startRotationConstantSeparateArray[2] * anglelToRad;\r\n\t\tparticleSystem.startRotationConstantMin = data.startRotationConstantMin * anglelToRad;\r\n\t\tparticleSystem.startRotationConstantMax = data.startRotationConstantMax * anglelToRad;\r\n\t\tvar startRotationConstantMinSeparateArray: any[] = data.startRotationConstantMinSeparate;\r\n\t\tvar startRotationConstantMinSeparateElement: Vector3 = particleSystem.startRotationConstantMinSeparate;\r\n\t\tstartRotationConstantMinSeparateElement.x = startRotationConstantMinSeparateArray[0] * anglelToRad;\r\n\t\tstartRotationConstantMinSeparateElement.y = startRotationConstantMinSeparateArray[1] * anglelToRad;\r\n\t\tstartRotationConstantMinSeparateElement.z = startRotationConstantMinSeparateArray[2] * anglelToRad;\r\n\t\tvar startRotationConstantMaxSeparateArray: any[] = data.startRotationConstantMaxSeparate;\r\n\t\tvar startRotationConstantMaxSeparateElement: Vector3 = particleSystem.startRotationConstantMaxSeparate;\r\n\t\tstartRotationConstantMaxSeparateElement.x = startRotationConstantMaxSeparateArray[0] * anglelToRad;\r\n\t\tstartRotationConstantMaxSeparateElement.y = startRotationConstantMaxSeparateArray[1] * anglelToRad;\r\n\t\tstartRotationConstantMaxSeparateElement.z = startRotationConstantMaxSeparateArray[2] * anglelToRad;\r\n\r\n\t\tparticleSystem.randomizeRotationDirection = data.randomizeRotationDirection;\r\n\r\n\t\tparticleSystem.startColorType = data.startColorType;\r\n\t\tvar startColorConstantArray: any[] = data.startColorConstant;\r\n\t\tvar startColorConstantElement: Vector4 = particleSystem.startColorConstant;\r\n\t\tstartColorConstantElement.x = startColorConstantArray[0];\r\n\t\tstartColorConstantElement.y = startColorConstantArray[1];\r\n\t\tstartColorConstantElement.z = startColorConstantArray[2];\r\n\t\tstartColorConstantElement.w = startColorConstantArray[3];\r\n\t\tvar startColorConstantMinArray: any[] = data.startColorConstantMin;\r\n\t\tvar startColorConstantMinElement: Vector4 = particleSystem.startColorConstantMin;\r\n\t\tstartColorConstantMinElement.x = startColorConstantMinArray[0];\r\n\t\tstartColorConstantMinElement.y = startColorConstantMinArray[1];\r\n\t\tstartColorConstantMinElement.z = startColorConstantMinArray[2];\r\n\t\tstartColorConstantMinElement.w = startColorConstantMinArray[3];\r\n\t\tvar startColorConstantMaxArray: any[] = data.startColorConstantMax;\r\n\t\tvar startColorConstantMaxElement: Vector4 = particleSystem.startColorConstantMax;\r\n\t\tstartColorConstantMaxElement.x = startColorConstantMaxArray[0];\r\n\t\tstartColorConstantMaxElement.y = startColorConstantMaxArray[1];\r\n\t\tstartColorConstantMaxElement.z = startColorConstantMaxArray[2];\r\n\t\tstartColorConstantMaxElement.w = startColorConstantMaxArray[3];\r\n\r\n\t\tparticleSystem.gravityModifier = data.gravityModifier;\r\n\r\n\t\tparticleSystem.simulationSpace = data.simulationSpace;\r\n\t\t(data.simulationSpeed !== undefined) && (particleSystem.simulationSpeed = data.simulationSpeed);\r\n\r\n\t\tparticleSystem.scaleMode = data.scaleMode;\r\n\r\n\t\tparticleSystem.playOnAwake = data.playOnAwake;\r\n\t\tparticleSystem.maxParticles = data.maxParticles;\r\n\r\n\t\tvar autoRandomSeed: any = data.autoRandomSeed;\r\n\t\t(autoRandomSeed != null) && (particleSystem.autoRandomSeed = autoRandomSeed);\r\n\t\tvar randomSeed: any = data.randomSeed;\r\n\t\t(randomSeed != null) && (particleSystem.randomSeed[0] = randomSeed);\r\n\r\n\t\t//Emission\r\n\t\tvar emissionData: any = data.emission;\r\n\t\tvar emission: Emission = particleSystem.emission;\r\n\t\tif (emissionData) {\r\n\t\t\temission.emissionRate = emissionData.emissionRate;\r\n\t\t\tvar burstsData: any[] = emissionData.bursts;\r\n\t\t\tif (burstsData)\r\n\t\t\t\tfor (i = 0, n = burstsData.length; i < n; i++) {\r\n\t\t\t\t\tvar brust: any = burstsData[i];\r\n\t\t\t\t\temission.addBurst(new Burst(brust.time, brust.min, brust.max));\r\n\t\t\t\t}\r\n\t\t\temission.enable = emissionData.enable;\r\n\t\t} else {\r\n\t\t\temission.enable = false;\r\n\t\t}\r\n\r\n\t\t//Shape\r\n\t\tvar shapeData: any = data.shape;\r\n\t\tif (shapeData) {\r\n\t\t\tvar shape: BaseShape;\r\n\t\t\tswitch (shapeData.shapeType) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tvar sphereShape: SphereShape;\r\n\t\t\t\t\tshape = sphereShape = new SphereShape();\r\n\t\t\t\t\tsphereShape.radius = shapeData.sphereRadius;\r\n\t\t\t\t\tsphereShape.emitFromShell = shapeData.sphereEmitFromShell;\r\n\t\t\t\t\tsphereShape.randomDirection = shapeData.sphereRandomDirection;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tvar hemiSphereShape: HemisphereShape;\r\n\t\t\t\t\tshape = hemiSphereShape = new HemisphereShape();\r\n\t\t\t\t\themiSphereShape.radius = shapeData.hemiSphereRadius;\r\n\t\t\t\t\themiSphereShape.emitFromShell = shapeData.hemiSphereEmitFromShell;\r\n\t\t\t\t\themiSphereShape.randomDirection = shapeData.hemiSphereRandomDirection;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tvar coneShape: ConeShape;\r\n\t\t\t\t\tshape = coneShape = new ConeShape();\r\n\t\t\t\t\tconeShape.angle = shapeData.coneAngle * anglelToRad;\r\n\t\t\t\t\tconeShape.radius = shapeData.coneRadius;\r\n\t\t\t\t\tconeShape.length = shapeData.coneLength;\r\n\t\t\t\t\tconeShape.emitType = shapeData.coneEmitType;\r\n\t\t\t\t\tconeShape.randomDirection = shapeData.coneRandomDirection;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tvar boxShape: BoxShape;\r\n\t\t\t\t\tshape = boxShape = new BoxShape();\r\n\t\t\t\t\tboxShape.x = shapeData.boxX;\r\n\t\t\t\t\tboxShape.y = shapeData.boxY;\r\n\t\t\t\t\tboxShape.z = shapeData.boxZ;\r\n\t\t\t\t\tboxShape.randomDirection = shapeData.boxRandomDirection;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 7:\r\n\t\t\t\t\tvar circleShape: CircleShape;\r\n\t\t\t\t\tshape = circleShape = new CircleShape();\r\n\t\t\t\t\tcircleShape.radius = shapeData.circleRadius;\r\n\t\t\t\t\tcircleShape.arc = shapeData.circleArc * anglelToRad;\r\n\t\t\t\t\tcircleShape.emitFromEdge = shapeData.circleEmitFromEdge;\r\n\t\t\t\t\tcircleShape.randomDirection = shapeData.circleRandomDirection;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t/**\r\n\t\t\t\t * -------------------------------------------------------------\r\n\t\t\t\t */\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tvar tempShape: CircleShape;\r\n\t\t\t\t\tshape = tempShape = new CircleShape();\r\n\t\t\t\t\ttempShape.radius = shapeData.circleRadius;\r\n\t\t\t\t\ttempShape.arc = shapeData.circleArc * anglelToRad;\r\n\t\t\t\t\ttempShape.emitFromEdge = shapeData.circleEmitFromEdge;\r\n\t\t\t\t\ttempShape.randomDirection = shapeData.circleRandomDirection;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tshape.enable = shapeData.enable;\r\n\t\t\tparticleSystem.shape = shape;\r\n\t\t}\r\n\r\n\t\t//VelocityOverLifetime\r\n\t\tvar velocityOverLifetimeData: any = data.velocityOverLifetime;\r\n\t\tif (velocityOverLifetimeData) {\r\n\t\t\tvar velocityData: any = velocityOverLifetimeData.velocity;\r\n\t\t\tvar velocity: GradientVelocity;\r\n\t\t\tswitch (velocityData.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tvar constantData: any[] = velocityData.constant;\r\n\t\t\t\t\tvelocity = GradientVelocity.createByConstant(new Vector3(constantData[0], constantData[1], constantData[2]));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tvelocity = GradientVelocity.createByGradient(this._initParticleVelocity(velocityData.gradientX), this._initParticleVelocity(velocityData.gradientY), this._initParticleVelocity(velocityData.gradientZ));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tvar constantMinData: any[] = velocityData.constantMin;\r\n\t\t\t\t\tvar constantMaxData: any[] = velocityData.constantMax;\r\n\t\t\t\t\tvelocity = GradientVelocity.createByRandomTwoConstant(new Vector3(constantMinData[0], constantMinData[1], constantMinData[2]), new Vector3(constantMaxData[0], constantMaxData[1], constantMaxData[2]));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tvelocity = GradientVelocity.createByRandomTwoGradient(this._initParticleVelocity(velocityData.gradientXMin), this._initParticleVelocity(velocityData.gradientXMax), this._initParticleVelocity(velocityData.gradientYMin), this._initParticleVelocity(velocityData.gradientYMax), this._initParticleVelocity(velocityData.gradientZMin), this._initParticleVelocity(velocityData.gradientZMax));\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvar velocityOverLifetime: VelocityOverLifetime = new VelocityOverLifetime(velocity);\r\n\t\t\tvelocityOverLifetime.space = velocityOverLifetimeData.space;\r\n\t\t\tvelocityOverLifetime.enable = velocityOverLifetimeData.enable;\r\n\t\t\tparticleSystem.velocityOverLifetime = velocityOverLifetime;\r\n\t\t}\r\n\r\n\t\t//ColorOverLifetime\r\n\t\tvar colorOverLifetimeData: any = data.colorOverLifetime;\r\n\t\tif (colorOverLifetimeData) {\r\n\t\t\tvar colorData: any = colorOverLifetimeData.color;\r\n\t\t\tvar color: GradientColor;\r\n\t\t\tswitch (colorData.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tvar constColorData: any[] = colorData.constant;\r\n\t\t\t\t\tcolor = GradientColor.createByConstant(new Vector4(constColorData[0], constColorData[1], constColorData[2], constColorData[3]));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tcolor = GradientColor.createByGradient(this._initParticleColor(colorData.gradient));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tvar minConstColorData: any[] = colorData.constantMin;\r\n\t\t\t\t\tvar maxConstColorData: any[] = colorData.constantMax;\r\n\t\t\t\t\tcolor = GradientColor.createByRandomTwoConstant(new Vector4(minConstColorData[0], minConstColorData[1], minConstColorData[2], minConstColorData[3]), new Vector4(maxConstColorData[0], maxConstColorData[1], maxConstColorData[2], maxConstColorData[3]));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tcolor = GradientColor.createByRandomTwoGradient(this._initParticleColor(colorData.gradientMin), this._initParticleColor(colorData.gradientMax));\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvar colorOverLifetime: ColorOverLifetime = new ColorOverLifetime(color);\r\n\t\t\tcolorOverLifetime.enable = colorOverLifetimeData.enable;\r\n\t\t\tparticleSystem.colorOverLifetime = colorOverLifetime;\r\n\t\t}\r\n\r\n\t\t//SizeOverLifetime\r\n\t\tvar sizeOverLifetimeData: any = data.sizeOverLifetime;\r\n\t\tif (sizeOverLifetimeData) {\r\n\t\t\tvar sizeData: any = sizeOverLifetimeData.size;\r\n\t\t\tvar size: GradientSize;\r\n\t\t\tswitch (sizeData.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tif (sizeData.separateAxes) {\r\n\t\t\t\t\t\tsize = GradientSize.createByGradientSeparate(this._initParticleSize(sizeData.gradientX), this._initParticleSize(sizeData.gradientY), this._initParticleSize(sizeData.gradientZ));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsize = GradientSize.createByGradient(this._initParticleSize(sizeData.gradient));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tif (sizeData.separateAxes) {\r\n\t\t\t\t\t\tvar constantMinSeparateData: any[] = sizeData.constantMinSeparate;\r\n\t\t\t\t\t\tvar constantMaxSeparateData: any[] = sizeData.constantMaxSeparate;\r\n\t\t\t\t\t\tsize = GradientSize.createByRandomTwoConstantSeparate(new Vector3(constantMinSeparateData[0], constantMinSeparateData[1], constantMinSeparateData[2]), new Vector3(constantMaxSeparateData[0], constantMaxSeparateData[1], constantMaxSeparateData[2]));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsize = GradientSize.createByRandomTwoConstant(sizeData.constantMin, sizeData.constantMax);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tif (sizeData.separateAxes) {\r\n\t\t\t\t\t\tsize = GradientSize.createByRandomTwoGradientSeparate(this._initParticleSize(sizeData.gradientXMin), this._initParticleSize(sizeData.gradientYMin), this._initParticleSize(sizeData.gradientZMin), this._initParticleSize(sizeData.gradientXMax), this._initParticleSize(sizeData.gradientYMax), this._initParticleSize(sizeData.gradientZMax));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsize = GradientSize.createByRandomTwoGradient(this._initParticleSize(sizeData.gradientMin), this._initParticleSize(sizeData.gradientMax));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvar sizeOverLifetime: SizeOverLifetime = new SizeOverLifetime(size);\r\n\t\t\tsizeOverLifetime.enable = sizeOverLifetimeData.enable;\r\n\t\t\tparticleSystem.sizeOverLifetime = sizeOverLifetime;\r\n\t\t}\r\n\r\n\t\t//RotationOverLifetime\r\n\t\tvar rotationOverLifetimeData: any = data.rotationOverLifetime;\r\n\t\tif (rotationOverLifetimeData) {\r\n\t\t\tvar angularVelocityData: any = rotationOverLifetimeData.angularVelocity;\r\n\t\t\tvar angularVelocity: GradientAngularVelocity;\r\n\t\t\tswitch (angularVelocityData.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\tvar conSep: any[] = angularVelocityData.constantSeparate;\r\n\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByConstantSeparate(new Vector3(conSep[0] * anglelToRad, conSep[1] * anglelToRad, conSep[2] * anglelToRad));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByConstant(angularVelocityData.constant * anglelToRad);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByGradientSeparate(this._initParticleRotation(angularVelocityData.gradientX), this._initParticleRotation(angularVelocityData.gradientY), this._initParticleRotation(angularVelocityData.gradientZ));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByGradient(this._initParticleRotation(angularVelocityData.gradient));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\tvar minSep: any[] = angularVelocityData.constantMinSeparate;//TODO:Y\r\n\t\t\t\t\t\tvar maxSep: any[] = angularVelocityData.constantMaxSeparate;//TODO:Y\r\n\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByRandomTwoConstantSeparate(new Vector3(minSep[0] * anglelToRad, minSep[1] * anglelToRad, minSep[2] * anglelToRad), new Vector3(maxSep[0] * anglelToRad, maxSep[1] * anglelToRad, maxSep[2] * anglelToRad));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByRandomTwoConstant(angularVelocityData.constantMin * anglelToRad, angularVelocityData.constantMax * anglelToRad);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\t//TODO:\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByRandomTwoGradient(this._initParticleRotation(angularVelocityData.gradientMin), this._initParticleRotation(angularVelocityData.gradientMax));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvar rotationOverLifetime: RotationOverLifetime = new RotationOverLifetime(angularVelocity);\r\n\t\t\trotationOverLifetime.enable = rotationOverLifetimeData.enable;\r\n\t\t\tparticleSystem.rotationOverLifetime = rotationOverLifetime;\r\n\t\t}\r\n\r\n\t\t//TextureSheetAnimation\r\n\t\tvar textureSheetAnimationData: any = data.textureSheetAnimation;\r\n\t\tif (textureSheetAnimationData) {\r\n\t\t\tvar frameData: any = textureSheetAnimationData.frame;\r\n\t\t\tvar frameOverTime: FrameOverTime;\r\n\t\t\tswitch (frameData.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tframeOverTime = FrameOverTime.createByConstant(frameData.constant);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tframeOverTime = FrameOverTime.createByOverTime(this._initParticleFrame(frameData.overTime));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tframeOverTime = FrameOverTime.createByRandomTwoConstant(frameData.constantMin, frameData.constantMax);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tframeOverTime = FrameOverTime.createByRandomTwoOverTime(this._initParticleFrame(frameData.overTimeMin), this._initParticleFrame(frameData.overTimeMax));\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvar startFrameData: any = textureSheetAnimationData.startFrame;\r\n\t\t\tvar startFrame: StartFrame;\r\n\t\t\tswitch (startFrameData.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tstartFrame = StartFrame.createByConstant(startFrameData.constant);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tstartFrame = StartFrame.createByRandomTwoConstant(startFrameData.constantMin, startFrameData.constantMax);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvar textureSheetAnimation: TextureSheetAnimation = new TextureSheetAnimation(frameOverTime, startFrame);\r\n\t\t\ttextureSheetAnimation.enable = textureSheetAnimationData.enable;\r\n\t\t\tvar tilesData: any[] = textureSheetAnimationData.tiles;\r\n\t\t\ttextureSheetAnimation.tiles = new Vector2(tilesData[0], tilesData[1]);\r\n\t\t\ttextureSheetAnimation.type = textureSheetAnimationData.type;\r\n\t\t\ttextureSheetAnimation.randomRow = textureSheetAnimationData.randomRow;\r\n\t\t\tvar rowIndex: any = textureSheetAnimationData.rowIndex;\r\n\t\t\t(rowIndex !== undefined) && (textureSheetAnimation.rowIndex = rowIndex);\r\n\t\t\ttextureSheetAnimation.cycles = textureSheetAnimationData.cycles;\r\n\t\t\tparticleSystem.textureSheetAnimation = textureSheetAnimation;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate _initParticleColor(gradientColorData: any, maxkeyCount: number = 4): Gradient {\r\n\t\tvar gradientColor: Gradient = new Gradient(maxkeyCount, maxkeyCount);\r\n\t\tif (!gradientColorData) {\r\n\t\t\tgradientColor.addColorAlpha(0, 1);\r\n\t\t\tgradientColor.addColorAlpha(1, 1);\r\n\t\t\tgradientColor.addColorRGB(0, new Color(1.0, 1.0, 1.0, 1.0));\r\n\t\t\tgradientColor.addColorRGB(1, new Color(1.0, 1.0, 1.0, 1.0));\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar alphasData: any[] = gradientColorData.alphas;\r\n\t\t\tvar i: number, n: number;\r\n\t\t\tif (!alphasData) {//\r\n\t\t\t\tgradientColor.addColorAlpha(0, 1);\r\n\t\t\t\tgradientColor.addColorAlpha(1, 1);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (i = 0, n = alphasData.length; i < n; i++) {\r\n\t\t\t\t\tif (i == maxkeyCount - 1 && n > maxkeyCount) {\r\n\t\t\t\t\t\ti = n - 1;\r\n\t\t\t\t\t\tconsole.warn(`GradientDataColor warning:alpha data length is large than ${maxkeyCount}, will ignore the middle data.`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar alphaData: any = alphasData[i];\r\n\t\t\t\t\tgradientColor.addColorAlpha(alphaData.key, alphaData.value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar rgbsData: any[] = gradientColorData.rgbs;\r\n\t\t\tif (!rgbsData) {//\r\n\t\t\t\tgradientColor.addColorRGB(0, new Color(1.0, 1.0, 1.0, 1.0));\r\n\t\t\t\tgradientColor.addColorRGB(1, new Color(1.0, 1.0, 1.0, 1.0));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (i = 0, n = rgbsData.length; i < n; i++) {\r\n\t\t\t\t\tif (i == maxkeyCount - 1 && n > maxkeyCount) {\r\n\t\t\t\t\t\ti = n - 1;\r\n\t\t\t\t\t\tconsole.warn(`GradientDataColor warning:rgb data length is large than ${maxkeyCount}, will ignore the middle data.`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar rgbData: any = rgbsData[i];\r\n\t\t\t\t\tvar rgbValue: any[] = rgbData.value;\r\n\t\t\t\t\tgradientColor.addColorRGB(rgbData.key, new Color(rgbValue[0], rgbValue[1], rgbValue[2], 1.0));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn gradientColor;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate _initParticleFrame(overTimeFramesData: any): GradientDataInt {\r\n\t\tvar overTimeFrame: GradientDataInt = new GradientDataInt();\r\n\t\tif (overTimeFramesData) {\r\n\t\t\tvar framesData: any[] = overTimeFramesData.frames;\r\n\t\t\tfor (var i: number = 0, n: number = framesData.length; i < n; i++) {\r\n\t\t\t\tvar frameData: any = framesData[i];\r\n\t\t\t\toverTimeFrame.add(frameData.key, frameData.value);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\toverTimeFrame.add(0, 0);\r\n\t\t\toverTimeFrame.add(1, 1);\r\n\t\t}\r\n\r\n\t\treturn overTimeFrame;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate static _initStartLife(gradientData: any): GradientDataNumber {\r\n\t\tvar gradient: GradientDataNumber = new GradientDataNumber();\r\n\t\tvar startLifetimesData: any[] = gradientData.startLifetimes;\r\n\t\tfor (var i: number = 0, n: number = startLifetimesData.length; i < n; i++) {\r\n\t\t\tvar valueData: any = startLifetimesData[i];\r\n\t\t\tgradient.add(valueData.key, valueData.value);\r\n\t\t}\r\n\t\treturn gradient\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate _initParticleVelocity(gradientData: any): GradientDataNumber {\r\n\t\tvar gradient: GradientDataNumber = new GradientDataNumber();\r\n\t\tvar velocitysData: any[] = gradientData.velocitys;\r\n\t\tfor (var i: number = 0, n: number = velocitysData.length; i < n; i++) {\r\n\t\t\tvar valueData: any = velocitysData[i];\r\n\t\t\tgradient.add(valueData.key, valueData.value);\r\n\t\t}\r\n\t\treturn gradient;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate _initParticleSize(gradientSizeData: any): GradientDataNumber {\r\n\t\tvar gradientSize: GradientDataNumber = new GradientDataNumber();\r\n\t\tif (gradientSizeData) {\r\n\t\t\tvar sizesData: any[] = gradientSizeData.sizes;\r\n\t\t\tfor (var i: number = 0, n: number = sizesData.length; i < n; i++) {\r\n\t\t\t\tvar valueData: any = sizesData[i];\r\n\t\t\t\tgradientSize.add(valueData.key, valueData.value);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tgradientSize.add(0, 0);\r\n\t\t\tgradientSize.add(1, 1);\r\n\t\t}\r\n\t\treturn gradientSize;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate _initParticleRotation(gradientData: any): GradientDataNumber {\r\n\t\tvar gradient: GradientDataNumber = new GradientDataNumber();\r\n\t\tvar angularVelocitysData: any[] = gradientData.angularVelocitys;\r\n\t\tfor (var i: number = 0, n: number = angularVelocitysData.length; i < n; i++) {\r\n\t\t\tvar valueData: any = angularVelocitysData[i];\r\n\t\t\tgradient.add(valueData.key, valueData.value / 180.0 * Math.PI);\r\n\t\t}\r\n\t\treturn gradient;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\";\r\n/**\r\n * @internal\r\n * @author \r\n */\r\nexport class PixelLineVertex {\r\n\tprivate static _vertexDeclaration: VertexDeclaration;\r\n\r\n\tstatic get vertexDeclaration(): VertexDeclaration {\r\n\t\treturn PixelLineVertex._vertexDeclaration;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tPixelLineVertex._vertexDeclaration = new VertexDeclaration(28,\r\n\t\t\t[new VertexElement(0, VertexElementFormat.Vector3, VertexMesh.MESH_POSITION0),\r\n\t\t\tnew VertexElement(12, VertexElementFormat.Vector4, VertexMesh.MESH_COLOR0)]);\r\n\t}\r\n\r\n\tget vertexDeclaration(): VertexDeclaration {\r\n\t\treturn PixelLineVertex._vertexDeclaration;\r\n\t}\r\n\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Event } from \"../../events/Event\";\r\nimport { EventDispatcher } from \"../../events/EventDispatcher\";\r\nimport { MathUtils3D } from \"../../maths/MathUtils3D\";\r\nimport { Matrix3x3 } from \"../../maths/Matrix3x3\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Sprite3D } from \"./Sprite3D\";\r\n\r\n/**\r\n * <code>Transform3D</code> 3D\r\n */\r\nexport class Transform3D extends EventDispatcher {\r\n\t/** @internal */\r\n\tprotected static _tempVector30: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\tprotected static _tempQuaternion0: Quaternion = new Quaternion();\r\n\t/** @internal */\r\n\tprotected static _tempMatrix0: Matrix4x4 = new Matrix4x4();\r\n\t/** @internal */\r\n\tprotected static _tempMatrix3x30: Matrix3x3 = new Matrix3x3();\r\n\t/** @internal */\r\n\tprotected static _tempMatrix3x31: Matrix3x3 = new Matrix3x3();\r\n\t/** @internal */\r\n\tprotected static _tempMatrix3x32: Matrix3x3 = new Matrix3x3();\r\n\t/** @internal */\r\n\tprotected static _tempMatrix3x33: Matrix3x3 = new Matrix3x3();\r\n\r\n\t/**@internal */\r\n\tstatic TRANSFORM_LOCALQUATERNION: number = 0x01;\r\n\t/**@internal */\r\n\tstatic TRANSFORM_LOCALEULER: number = 0x02;\r\n\t/**@internal */\r\n\tstatic TRANSFORM_LOCALMATRIX: number = 0x04;\r\n\t/**@internal */\r\n\tstatic TRANSFORM_WORLDPOSITION: number = 0x08;\r\n\t/**@internal */\r\n\tstatic TRANSFORM_WORLDQUATERNION: number = 0x10;\r\n\t/**@internal */\r\n\tstatic TRANSFORM_WORLDSCALE: number = 0x20;\r\n\t/**@internal */\r\n\tstatic TRANSFORM_WORLDMATRIX: number = 0x40;\r\n\t/**@internal */\r\n\tstatic TRANSFORM_WORLDEULER: number = 0x80;\r\n\r\n\t/**@internal */\r\n\tstatic _angleToRandin: number = 180 / Math.PI;\r\n\r\n\t/** @internal */\r\n\tprotected _owner: Sprite3D;\r\n\t/** @internal */\r\n\tprotected _localPosition: Vector3 = new Vector3(0, 0, 0);\r\n\t/** @internal */\r\n\tprotected _localRotation: Quaternion = new Quaternion(0, 0, 0, 1);\r\n\t/** @internal */\r\n\tprotected _localScale: Vector3 = new Vector3(1, 1, 1);\r\n\t/**@internal */\r\n\tprotected _localRotationEuler: Vector3 = new Vector3(0, 0, 0);\r\n\t/** @internal */\r\n\tprotected _localMatrix: Matrix4x4 = new Matrix4x4();\r\n\r\n\t/** @internal */\r\n\tprotected _position: Vector3 = new Vector3(0, 0, 0);\r\n\t/** @internal */\r\n\tprotected _rotation: Quaternion = new Quaternion(0, 0, 0, 1);\r\n\t/** @internal */\r\n\tprotected _scale: Vector3 = new Vector3(1, 1, 1);\r\n\t/**@internal */\r\n\tprotected _rotationEuler: Vector3 = new Vector3(0, 0, 0);\r\n\t/** @internal */\r\n\tprotected _worldMatrix: Matrix4x4 = new Matrix4x4();\r\n\r\n\t/** @internal */\r\n\t_children: Transform3D[] | null = null;\r\n\t/**@internal true */\r\n\tprotected _isDefaultMatrix: boolean = false;\r\n\tprotected _faceInvert: boolean = false;\r\n\tprotected _frontFaceValue: number = 1;\r\n\r\n\t/** @internal */\r\n\t_parent: Transform3D | null = null;\r\n\t/**@internal */\r\n\t_transformFlag: number = 0;\r\n\r\n\r\n\t/**@internal */\r\n\tget isDefaultMatrix(): boolean {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_LOCALMATRIX)) {\r\n\t\t\tlet localMat = this.localMatrix;\r\n\t\t}\r\n\t\treturn this._isDefaultMatrix;\r\n\t}\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tget _isFrontFaceInvert(): boolean {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_WORLDSCALE)) {\r\n\t\t\tvar scale: Vector3 = this.getWorldLossyScale();\r\n\t\t\tvar isInvert: boolean = scale.x < 0;\r\n\t\t\t(scale.y < 0) && (isInvert = !isInvert);\r\n\t\t\t(scale.z < 0) && (isInvert = !isInvert);\r\n\t\t\tthis._faceInvert = isInvert;\r\n\t\t\tthis._frontFaceValue = this._faceInvert ? -1 : 1;\r\n\t\t}\r\n\t\treturn this._faceInvert;\r\n\t}\r\n\r\n\tgetFrontFaceValue(): number {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_WORLDSCALE)) {\r\n\t\t\tlet value = this._isFrontFaceInvert;\r\n\t\t}\r\n\t\treturn this._frontFaceValue;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget owner(): Sprite3D {\r\n\t\treturn this._owner;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget worldNeedUpdate(): boolean {\r\n\t\treturn this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX);\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localPositionX(): number {\r\n\t\treturn this._localPosition.x;\r\n\t}\r\n\r\n\tset localPositionX(x: number) {\r\n\t\tthis._localPosition.x = x;\r\n\t\tthis.localPosition = this._localPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localPositionY(): number {\r\n\t\treturn this._localPosition.y;\r\n\t}\r\n\r\n\tset localPositionY(y: number) {\r\n\t\tthis._localPosition.y = y;\r\n\t\tthis.localPosition = this._localPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localPositionZ(): number {\r\n\t\treturn this._localPosition.z;\r\n\t}\r\n\r\n\tset localPositionZ(z: number) {\r\n\t\tthis._localPosition.z = z;\r\n\t\tthis.localPosition = this._localPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localPosition(): Vector3 {\r\n\t\treturn this._localPosition;\r\n\t}\r\n\r\n\tset localPosition(value: Vector3) {\r\n\t\tif (this._localPosition !== value)\r\n\t\t\tvalue.cloneTo(this._localPosition);\r\n\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALMATRIX, true);\r\n\t\tthis._onWorldPositionTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localRotationX(): number {\r\n\t\treturn this.localRotation.x;\r\n\t}\r\n\r\n\tset localRotationX(x: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.x = x;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localRotationY(): number {\r\n\t\treturn this.localRotation.y;\r\n\t}\r\n\r\n\tset localRotationY(y: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.y = y;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localRotationZ(): number {\r\n\t\treturn this.localRotation.z;\r\n\t}\r\n\r\n\tset localRotationZ(z: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.z = z;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * W\r\n\t */\r\n\tget localRotationW(): number {\r\n\t\treturn this.localRotation.w;\r\n\t}\r\n\r\n\tset localRotationW(w: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.w = w;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localRotation(): Quaternion {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_LOCALQUATERNION)) {\r\n\t\t\tvar eulerE: Vector3 = this._localRotationEuler;\r\n\t\t\tQuaternion.createFromYawPitchRoll(eulerE.y / Transform3D._angleToRandin, eulerE.x / Transform3D._angleToRandin, eulerE.z / Transform3D._angleToRandin, this._localRotation);\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALQUATERNION, false);\r\n\t\t}\r\n\t\treturn this._localRotation;\r\n\t}\r\n\r\n\tset localRotation(value: Quaternion) {\r\n\t\tif (this._localRotation !== value)\r\n\t\t\tvalue.cloneTo(this._localRotation);\r\n\t\tthis._localRotation.normalize(this._localRotation);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALEULER | Transform3D.TRANSFORM_LOCALMATRIX, true);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALQUATERNION, false);\r\n\t\tthis._onWorldRotationTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localScaleX(): number {\r\n\t\treturn this._localScale.x;\r\n\t}\r\n\r\n\tset localScaleX(value: number) {\r\n\t\tthis._localScale.x = value;\r\n\t\tthis.localScale = this._localScale;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localScaleY(): number {\r\n\t\treturn this._localScale.y;\r\n\t}\r\n\r\n\tset localScaleY(value: number) {\r\n\t\tthis._localScale.y = value;\r\n\t\tthis.localScale = this._localScale;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localScaleZ(): number {\r\n\t\treturn this._localScale.z;\r\n\t}\r\n\r\n\tset localScaleZ(value: number) {\r\n\t\tthis._localScale.z = value;\r\n\t\tthis.localScale = this._localScale;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localScale(): Vector3 {\r\n\t\treturn this._localScale;\r\n\t}\r\n\r\n\tset localScale(value: Vector3) {\r\n\t\tif (this._localScale !== value)\r\n\t\t\tvalue.cloneTo(this._localScale);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALMATRIX, true);\r\n\t\tthis._onWorldScaleTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localRotationEulerX(): number {\r\n\t\treturn this.localRotationEuler.x;\r\n\t}\r\n\r\n\tset localRotationEulerX(value: number) {\r\n\t\tlet rot = this.localRotationEuler;\r\n\t\trot.x = value;\r\n\t\tthis.localRotationEuler = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localRotationEulerY(): number {\r\n\t\treturn this.localRotationEuler.y;\r\n\t}\r\n\r\n\tset localRotationEulerY(value: number) {\r\n\t\tlet rot = this.localRotationEuler;\r\n\t\trot.y = value;\r\n\t\tthis.localRotationEuler = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localRotationEulerZ(): number {\r\n\t\treturn this.localRotationEuler.z;\r\n\t}\r\n\r\n\tset localRotationEulerZ(value: number) {\r\n\t\tlet rot = this.localRotationEuler;\r\n\t\trot.z = value;\r\n\t\tthis.localRotationEuler = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localRotationEuler(): Vector3 {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_LOCALEULER)) {\r\n\t\t\tthis._localRotation.getYawPitchRoll(Transform3D._tempVector30);\r\n\t\t\tvar euler: Vector3 = Transform3D._tempVector30;\r\n\t\t\tvar localRotationEuler: Vector3 = this._localRotationEuler;\r\n\t\t\tlocalRotationEuler.x = euler.y * Transform3D._angleToRandin;\r\n\t\t\tlocalRotationEuler.y = euler.x * Transform3D._angleToRandin;\r\n\t\t\tlocalRotationEuler.z = euler.z * Transform3D._angleToRandin;\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALEULER, false);\r\n\t\t}\r\n\t\treturn this._localRotationEuler;\r\n\t}\r\n\r\n\tset localRotationEuler(value: Vector3) {\r\n\t\tif (this._localRotationEuler !== value)\r\n\t\t\tvalue.cloneTo(this._localRotationEuler);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALEULER, false);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALQUATERNION | Transform3D.TRANSFORM_LOCALMATRIX, true);\r\n\t\tthis._onWorldRotationTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localMatrix(): Matrix4x4 {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_LOCALMATRIX)) {\r\n\t\t\tMatrix4x4.createAffineTransformation(this._localPosition, this.localRotation, this._localScale, this._localMatrix);\r\n\t\t\tthis._isDefaultMatrix = this._localMatrix.isIdentity();\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALMATRIX, false);\r\n\t\t}\r\n\t\treturn this._localMatrix;\r\n\t}\r\n\r\n\tset localMatrix(value: Matrix4x4) {\r\n\t\tif (this._localMatrix !== value)\r\n\t\t\tvalue.cloneTo(this._localMatrix);\r\n\t\tthis._isDefaultMatrix = this._localMatrix.isIdentity();\r\n\t\tthis._localMatrix.decomposeTransRotScale(this._localPosition, this._localRotation, this._localScale);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALEULER, true);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALMATRIX, false);\r\n\t\tthis._onWorldTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget position(): Vector3 {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION)) {\r\n\t\t\tif (this._parent != null) {\r\n\t\t\t\tvar worldMatE = this.worldMatrix.elements;\r\n\t\t\t\tthis._position.x = worldMatE[12];\r\n\t\t\t\tthis._position.y = worldMatE[13];\r\n\t\t\t\tthis._position.z = worldMatE[14];\r\n\t\t\t} else {\r\n\t\t\t\tthis._localPosition.cloneTo(this._position);\r\n\t\t\t}\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION, false);\r\n\t\t}\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tset position(value: Vector3) {\r\n\t\tif (this._parent != null) {\r\n\t\t\tvar parentInvMat: Matrix4x4 = Transform3D._tempMatrix0;\r\n\t\t\tthis._parent.worldMatrix.invert(parentInvMat);\r\n\t\t\tVector3.transformCoordinate(value, parentInvMat, this._localPosition);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvalue.cloneTo(this._localPosition);\r\n\t\t}\r\n\t\tthis.localPosition = this._localPosition;\r\n\t\tif (this._position !== value)\r\n\t\t\tvalue.cloneTo(this._position);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION, false);\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget rotation(): Quaternion {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_WORLDQUATERNION)) {\r\n\t\t\tif (this._parent != null)\r\n\t\t\t\tQuaternion.multiply(this._parent.rotation, this.localRotation, this._rotation);//localRotation_localRotation,\r\n\t\t\telse\r\n\t\t\t\tthis.localRotation.cloneTo(this._rotation);\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDQUATERNION, false);\r\n\t\t}\r\n\t\treturn this._rotation;\r\n\t}\r\n\r\n\tset rotation(value: Quaternion) {\r\n\t\tif (this._parent != null) {\r\n\t\t\tthis._parent.rotation.invert(Transform3D._tempQuaternion0);\r\n\t\t\tQuaternion.multiply(Transform3D._tempQuaternion0, value, this._localRotation);\r\n\t\t} else {\r\n\t\t\tvalue.cloneTo(this._localRotation);\r\n\t\t}\r\n\t\tthis.localRotation = this._localRotation;\r\n\t\tif (value !== this._rotation)\r\n\t\t\tvalue.cloneTo(this._rotation);\r\n\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDQUATERNION, false);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * xyz\r\n\t */\r\n\tget rotationEuler(): Vector3 {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_WORLDEULER)) {\r\n\t\t\tthis.rotation.getYawPitchRoll(Transform3D._tempVector30);//rotation,\r\n\t\t\tvar eulerE: Vector3 = Transform3D._tempVector30;\r\n\t\t\tvar rotationEulerE: Vector3 = this._rotationEuler;\r\n\t\t\trotationEulerE.x = eulerE.y * Transform3D._angleToRandin;\r\n\t\t\trotationEulerE.y = eulerE.x * Transform3D._angleToRandin;\r\n\t\t\trotationEulerE.z = eulerE.z * Transform3D._angleToRandin;\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDEULER, false);\r\n\t\t}\r\n\t\treturn this._rotationEuler;\r\n\t}\r\n\r\n\tset rotationEuler(value: Vector3) {\r\n\t\tQuaternion.createFromYawPitchRoll(value.y / Transform3D._angleToRandin, value.x / Transform3D._angleToRandin, value.z / Transform3D._angleToRandin, this._rotation);\r\n\t\tthis.rotation = this._rotation;\r\n\t\tif (this._rotationEuler !== value)\r\n\t\t\tvalue.cloneTo(this._rotationEuler);\r\n\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDEULER, false);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget worldMatrix(): Matrix4x4 {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX)) {\r\n\t\t\tif (this._parent != null) {\r\n\t\t\t\t//\r\n\t\t\t\tlet effectiveTrans = this._parent;\r\n\r\n\t\t\t\twhile (effectiveTrans._parent && effectiveTrans.isDefaultMatrix) {\r\n\t\t\t\t\teffectiveTrans = effectiveTrans._parent;\r\n\t\t\t\t}\r\n\t\t\t\tMatrix4x4.multiply(effectiveTrans.worldMatrix, this.localMatrix, this._worldMatrix);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tthis.localMatrix.cloneTo(this._worldMatrix);\r\n\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX, false);\r\n\t\t}\r\n\t\treturn this._worldMatrix;\r\n\t}\r\n\r\n\tset worldMatrix(value: Matrix4x4) {\r\n\t\tif (this._parent === null) {\r\n\t\t\tvalue.cloneTo(this._localMatrix);\r\n\t\t} else {\r\n\t\t\tthis._parent.worldMatrix.invert(this._localMatrix);\r\n\t\t\tMatrix4x4.multiply(this._localMatrix, value, this._localMatrix);\r\n\t\t}\r\n\t\tthis.localMatrix = this._localMatrix;\r\n\t\tif (this._worldMatrix !== value)\r\n\t\t\tvalue.cloneTo(this._worldMatrix);\r\n\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX, false);\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Transform3D</code> \r\n\t * @internal\r\n\t * @param owner \r\n\t */\r\n\tconstructor(owner: Sprite3D) {\r\n\t\tsuper();\r\n\t\tthis._owner = owner;\r\n\t\tthis._children = [];\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALQUATERNION | Transform3D.TRANSFORM_LOCALEULER | Transform3D.TRANSFORM_LOCALMATRIX, false);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION | Transform3D.TRANSFORM_WORLDQUATERNION | Transform3D.TRANSFORM_WORLDEULER | Transform3D.TRANSFORM_WORLDSCALE | Transform3D.TRANSFORM_WORLDMATRIX, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_getScaleMatrix(): Matrix3x3 {\r\n\t\tvar invRotation: Quaternion = Transform3D._tempQuaternion0;\r\n\t\tvar invRotationMat: Matrix3x3 = Transform3D._tempMatrix3x30;\r\n\t\tvar worldRotScaMat: Matrix3x3 = Transform3D._tempMatrix3x31;\r\n\t\tvar scaMat: Matrix3x3 = Transform3D._tempMatrix3x32;\r\n\t\tMatrix3x3.createFromMatrix4x4(this.worldMatrix, worldRotScaMat)\r\n\t\tthis.rotation.invert(invRotation);\r\n\t\tMatrix3x3.createRotationQuaternion(invRotation, invRotationMat);\r\n\t\tMatrix3x3.multiply(invRotationMat, worldRotScaMat, scaMat);\r\n\t\treturn scaMat;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setTransformFlag(type: number, value: boolean): void {\r\n\t\tif (value)\r\n\t\t\tthis._transformFlag |= type;\r\n\t\telse\r\n\t\t\tthis._transformFlag &= ~type;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_getTransformFlag(type: number): boolean {\r\n\t\treturn (this._transformFlag & type) != 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setParent(value: Transform3D): void {\r\n\t\tif (this._parent !== value) {\r\n\t\t\tif (this._parent) {\r\n\t\t\t\tvar parentChilds: Transform3D[] = this._parent._children!;\r\n\t\t\t\tvar index: number = parentChilds.indexOf(this);\r\n\t\t\t\tparentChilds.splice(index, 1);\r\n\t\t\t}\r\n\t\t\tif (value) {\r\n\t\t\t\tvalue._children!.push(this);\r\n\t\t\t\t(value) && (this._onWorldTransform());\r\n\t\t\t}\r\n\t\t\tthis._parent = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_onWorldPositionRotationTransform(): void {\r\n\t\tif (!this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDQUATERNION) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDEULER)) {\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX | Transform3D.TRANSFORM_WORLDPOSITION | Transform3D.TRANSFORM_WORLDQUATERNION | Transform3D.TRANSFORM_WORLDEULER, true);\r\n\t\t\tthis.event(Event.TRANSFORM_CHANGED, this._transformFlag);\r\n\t\t}\r\n\t\tfor (var i: number = 0, n: number = this._children!.length; i < n; i++)\r\n\t\t\tthis._children![i]._onWorldPositionRotationTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_onWorldPositionScaleTransform(): void {\r\n\t\tif (!this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDSCALE)) {\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX | Transform3D.TRANSFORM_WORLDPOSITION | Transform3D.TRANSFORM_WORLDSCALE, true);\r\n\t\t\tthis.event(Event.TRANSFORM_CHANGED, this._transformFlag);\r\n\t\t}\r\n\t\tfor (var i: number = 0, n: number = this._children!.length; i < n; i++)\r\n\t\t\tthis._children![i]._onWorldPositionScaleTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_onWorldPositionTransform(): void {\r\n\t\tif (!this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION)) {\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX | Transform3D.TRANSFORM_WORLDPOSITION, true);\r\n\t\t\tthis.event(Event.TRANSFORM_CHANGED, this._transformFlag);\r\n\t\t}\r\n\t\tfor (var i: number = 0, n: number = this._children!.length; i < n; i++)\r\n\t\t\tthis._children![i]._onWorldPositionTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _onWorldRotationTransform(): void {\r\n\t\tif (!this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDQUATERNION) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDEULER)) {\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX | Transform3D.TRANSFORM_WORLDQUATERNION | Transform3D.TRANSFORM_WORLDEULER, true);\r\n\t\t\tthis.event(Event.TRANSFORM_CHANGED, this._transformFlag);\r\n\t\t}\r\n\t\tfor (var i: number = 0, n: number = this._children!.length; i < n; i++)\r\n\t\t\tthis._children![i]._onWorldPositionRotationTransform();//\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_onWorldScaleTransform(): void {\r\n\t\tif (!this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDSCALE)) {\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX | Transform3D.TRANSFORM_WORLDSCALE, true);\r\n\t\t\tthis.event(Event.TRANSFORM_CHANGED, this._transformFlag);\r\n\t\t}\r\n\t\tfor (var i: number = 0, n: number = this._children!.length; i < n; i++)\r\n\t\t\tthis._children![i]._onWorldPositionScaleTransform();//\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_onWorldTransform(): void {\r\n\t\tif (!this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDQUATERNION) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDEULER) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDSCALE)) {\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX | Transform3D.TRANSFORM_WORLDPOSITION | Transform3D.TRANSFORM_WORLDQUATERNION | Transform3D.TRANSFORM_WORLDEULER | Transform3D.TRANSFORM_WORLDSCALE, true);\r\n\t\t\tthis.event(Event.TRANSFORM_CHANGED, this._transformFlag);\r\n\t\t}\r\n\t\tfor (var i: number = 0, n: number = this._children!.length; i < n; i++)\r\n\t\t\tthis._children![i]._onWorldTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param \ttranslation \r\n\t * @param \tisLocal \r\n\t */\r\n\ttranslate(translation: Vector3, isLocal: boolean = true): void {\r\n\t\tif (isLocal) {\r\n\t\t\tMatrix4x4.createFromQuaternion(this.localRotation, Transform3D._tempMatrix0);\r\n\t\t\tVector3.transformCoordinate(translation, Transform3D._tempMatrix0, Transform3D._tempVector30);\r\n\t\t\tVector3.add(this.localPosition, Transform3D._tempVector30, this._localPosition);\r\n\t\t\tthis.localPosition = this._localPosition;\r\n\t\t} else {\r\n\t\t\tVector3.add(this.position, translation, this._position);\r\n\t\t\tthis.position = this._position;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param \trotations \r\n\t * @param \tisLocal \r\n\t * @param \tisRadian \r\n\t */\r\n\trotate(rotation: Vector3, isLocal: boolean = true, isRadian: boolean = true): void {\r\n\t\tvar rot: Vector3;\r\n\t\tif (isRadian) {\r\n\t\t\trot = rotation;\r\n\t\t} else {\r\n\t\t\tVector3.scale(rotation, Math.PI / 180.0, Transform3D._tempVector30);\r\n\t\t\trot = Transform3D._tempVector30;\r\n\t\t}\r\n\r\n\t\tQuaternion.createFromYawPitchRoll(rot.y, rot.x, rot.z, Transform3D._tempQuaternion0);\r\n\t\tif (isLocal) {\r\n\t\t\tQuaternion.multiply(this._localRotation, Transform3D._tempQuaternion0, this._localRotation);\r\n\t\t\tthis.localRotation = this._localRotation;\r\n\t\t} else {\r\n\t\t\tQuaternion.multiply(Transform3D._tempQuaternion0, this.rotation, this._rotation);\r\n\t\t\tthis.rotation = this._rotation;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param forward \r\n\t */\r\n\tgetForward(forward: Vector3): void {\r\n\t\tvar worldMatElem: Float32Array = this.worldMatrix.elements;\r\n\t\tforward.x = -worldMatElem[8];\r\n\t\tforward.y = -worldMatElem[9];\r\n\t\tforward.z = -worldMatElem[10];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param up \r\n\t */\r\n\tgetUp(up: Vector3): void {\r\n\t\tvar worldMatElem: Float32Array = this.worldMatrix.elements;\r\n\t\tup.x = worldMatElem[4];\r\n\t\tup.y = worldMatElem[5];\r\n\t\tup.z = worldMatElem[6];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param \r\n\t */\r\n\tgetRight(right: Vector3): void {\r\n\t\tvar worldMatElem: Float32Array = this.worldMatrix.elements;\r\n\t\tright.x = worldMatElem[0];\r\n\t\tright.y = worldMatElem[1];\r\n\t\tright.z = worldMatElem[2];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\ttarget \r\n\t * @param\tup \r\n\t * @param\tisLocal \r\n\t */\r\n\tlookAt(target: Vector3, up: Vector3, isLocal: boolean = false, isCamera: boolean = true): void {\r\n\t\tvar eye: Vector3;\r\n\t\tif (isLocal) {\r\n\t\t\teye = this._localPosition;\r\n\t\t\tif (Math.abs(eye.x - target.x) < MathUtils3D.zeroTolerance && Math.abs(eye.y - target.y) < MathUtils3D.zeroTolerance && Math.abs(eye.z - target.z) < MathUtils3D.zeroTolerance)\r\n\t\t\t\treturn;\r\n\t\t\tif (isCamera) {\r\n\t\t\t\tQuaternion.lookAt(this._localPosition, target, up, this._localRotation);\r\n\t\t\t\tthis._localRotation.invert(this._localRotation);\r\n\t\t\t} else {\r\n\t\t\t\tVector3.subtract(this.localPosition, target, Transform3D._tempVector30);\r\n\t\t\t\tQuaternion.rotationLookAt(Transform3D._tempVector30, up, this.localRotation);\r\n\t\t\t\tthis._localRotation.invert(this._localRotation);\r\n\t\t\t}\r\n\r\n\t\t\tthis.localRotation = this._localRotation;\r\n\t\t} else {\r\n\t\t\tvar worldPosition: Vector3 = this.position;\r\n\t\t\teye = worldPosition;\r\n\t\t\tif (Math.abs(eye.x - target.x) < MathUtils3D.zeroTolerance && Math.abs(eye.y - target.y) < MathUtils3D.zeroTolerance && Math.abs(eye.z - target.z) < MathUtils3D.zeroTolerance)\r\n\t\t\t\treturn;\r\n\t\t\tif (isCamera) {\r\n\t\t\t\tQuaternion.lookAt(worldPosition, target, up, this._rotation);\r\n\t\t\t\tthis._rotation.invert(this._rotation);\r\n\t\t\t} else {\r\n\t\t\t\tVector3.subtract(this.position, target, Transform3D._tempVector30);\r\n\t\t\t\tQuaternion.rotationLookAt(Transform3D._tempVector30, up, this._rotation);\r\n\t\t\t\tthis._rotation.invert(this._rotation);\r\n\t\t\t}\r\n\t\t\tthis.rotation = this._rotation;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param target \r\n\t * @param up \r\n\t * @param isLocal \r\n\t */\r\n\tobjLookat(target: Vector3, up: Vector3, isLocal: boolean = false): void {\r\n\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * \r\n\t * Vector3,Matrix3x3\r\n\t * @return\t\r\n\t */\r\n\tgetWorldLossyScale(): Vector3 {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_WORLDSCALE)) {\r\n\t\t\tif (this._parent !== null) {\r\n\t\t\t\tvar scaMatE = this._getScaleMatrix().elements;\r\n\t\t\t\tthis._scale.x = scaMatE[0];\r\n\t\t\t\tthis._scale.y = scaMatE[4];\r\n\t\t\t\tthis._scale.z = scaMatE[8];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._localScale.cloneTo(this._scale);\r\n\t\t\t}\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDSCALE, false);\r\n\t\t}\r\n\t\treturn this._scale;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * Vector3,Matrix3x3\r\n\t * @return\t\r\n\t */\r\n\tsetWorldLossyScale(value: Vector3) {\r\n\t\tif (this._parent !== null) {\r\n\t\t\tvar scaleMat: Matrix3x3 = Transform3D._tempMatrix3x33;\r\n\t\t\tvar localScaleMat: Matrix3x3 = Transform3D._tempMatrix3x33;\r\n\t\t\tvar localScaleMatE: Float32Array = localScaleMat.elements;\r\n\t\t\tvar parInvScaleMat: Matrix3x3 = this._parent._getScaleMatrix();\r\n\t\t\tparInvScaleMat.invert(parInvScaleMat);\r\n\t\t\tMatrix3x3.createFromScaling(value, scaleMat);\r\n\t\t\tMatrix3x3.multiply(parInvScaleMat, scaleMat, localScaleMat);\r\n\t\t\tthis._localScale.x = localScaleMatE[0];\r\n\t\t\tthis._localScale.y = localScaleMatE[4];\r\n\t\t\tthis._localScale.z = localScaleMatE[8];\r\n\t\t} else {\r\n\t\t\tvalue.cloneTo(this._localScale);\r\n\t\t}\r\n\t\tthis.localScale = this._localScale;\r\n\t\tif (this._scale !== value)\r\n\t\t\tvalue.cloneTo(this._scale);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDSCALE, false);\r\n\t}\r\n\r\n\t//----------------------------------------Discard-------------------------------------------------\r\n\t/**\r\n\t * @deprecated\r\n\t */\r\n\tget scale(): Vector3 {\r\n\t\tconsole.warn(\"Transfrm3D: discard function,please use getWorldLossyScale instead.\");\r\n\t\treturn this.getWorldLossyScale();\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t */\r\n\tset scale(value: Vector3) {\r\n\t\tconsole.warn(\"Transfrm3D: discard function,please use setWorldLossyScale instead.\");\r\n\t\tthis.setWorldLossyScale(value);\r\n\t}\r\n\r\n\tlocalToGlobal(value: Vector3, out: Vector3): void {\r\n\t\tVector3.transformV3ToV3(value, this.worldMatrix, out);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t\t* @param pos\r\n\t\t* @param out\r\n\t\t* \r\n\t\t*/\r\n\tglobalToLocal(pos: Vector3, out: Vector3): void {\r\n\t\tthis.worldMatrix.invert(Transform3D._tempMatrix0);\r\n\t\tVector3.transformV3ToV3(pos, Transform3D._tempMatrix0, out);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param pos\r\n\t * @param out\r\n\t * \r\n\t */\r\n\ttoLocalNormal(pos: Vector3, out: Vector3): void {\r\n\t\tthis.worldMatrix.invert(Transform3D._tempMatrix0);\r\n\t\tVector3.TransformNormal(pos, Transform3D._tempMatrix0, out);\r\n\t}\r\n\r\n\ttoDir(forward: Vector3, dir: Vector3) {\r\n\t\t//TODO \r\n\t\tvar wmat: Matrix4x4 = this.worldMatrix;\r\n\t\t//var newForward:Vector3 = new Vector3();\r\n\t\t//var newRot:Quaternion = new Quaternion();\r\n\r\n\t\t//Vector3.TransformNormal(forward,wmat,newForward);\r\n\t\t//Vector3.normalize(newForward,newForward);\r\n\t\t//rotationTo(newRot,newForward,dir);\r\n\t\tthis.rotationTo(this.rotation, forward, dir);\r\n\t\t//Quaternion.multiply(rotation,newRot,rotation)\r\n\t\t//DEBUG\r\n\t\t//Quaternion.createFromAxisAngle(new Vector3(0,1,0),75*Math.PI/180,newRot)\r\n\t\t//DEBUG\r\n\t\tthis.rotation = this.rotation;\r\n\t}\r\n\r\n\tstatic tmpVec3: Vector3 = new Vector3();\r\n\t/**\r\n\t *  glmatrix\r\n\t * a,b\r\n\t * Sets a quaternion to represent the shortest rotation from one\r\n\t * vector to another.\r\n\t *\r\n\t * Both vectors are assumed to be unit length.\r\n\t *\r\n\t * @param {quat} out the receiving quaternion.\r\n\t * @param {vec3} a the initial vector\r\n\t * @param {vec3} b the destination vector\r\n\t * @returns {quat} out\r\n\t */\r\n\trotationTo(out: Quaternion, a: Vector3, b: Vector3): boolean {\r\n\t\tvar dot: number = Vector3.dot(a, b);\r\n\t\tVector3.Up\r\n\t\tif (dot < -0.999999) {// 180\r\n\t\t\tVector3.cross(Vector3.UnitX, a, Transform3D.tmpVec3);\r\n\t\t\tif (Vector3.scalarLength(Transform3D.tmpVec3) < 0.000001)\r\n\t\t\t\tVector3.cross(Vector3.UnitY, a, Transform3D.tmpVec3);\r\n\t\t\tVector3.normalize(Transform3D.tmpVec3, Transform3D.tmpVec3);\r\n\t\t\tQuaternion.createFromAxisAngle(Transform3D.tmpVec3, Math.PI, out);\r\n\t\t\treturn true\r\n\t\t} else if (dot > 0.999999) {// \r\n\t\t\tout.x = 0;\r\n\t\t\tout.y = 0;\r\n\t\t\tout.z = 0;\r\n\t\t\tout.w = 1;\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\t// cos(a/2)=((1+dot)/2), cos(a/2)sin(a/2)=sin(a)/2 \r\n\t\t\tVector3.cross(a, b, Transform3D.tmpVec3);\r\n\t\t\tout.x = Transform3D.tmpVec3.x;\r\n\t\t\tout.y = Transform3D.tmpVec3.y;\r\n\t\t\tout.z = Transform3D.tmpVec3.z;\r\n\t\t\tout.w = 1 + dot;\r\n\t\t\tout.normalize(out);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\";\r\n\r\nexport class SkinnedMeshSprite3DShaderDeclaration {\r\n\t/**,*/\r\n\tstatic SHADERDEFINE_BONE: ShaderDefine;\r\n\tstatic SHADERDEFINE_SIMPLEBONE:ShaderDefine;\r\n}","import { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { SkinRenderElementOBJ } from \"../../RenderObjs/RenderObj/SkinRenderElementOBJ\";\r\nimport { SkinnedMeshRenderer } from \"../SkinnedMeshRenderer\";\r\nimport { RenderElement } from \"./RenderElement\"\r\n/**\r\n * @internal\r\n */\r\nexport class SkinRenderElement extends RenderElement{\r\n\t/**\r\n\t * \r\n\t */\r\n\t_renderElementOBJ:SkinRenderElementOBJ;\r\n\r\n\r\n    /**@internal */\r\n\tset render(value:SkinnedMeshRenderer){\r\n\t\tthis._baseRender = value;\r\n\t\tthis._renderElementOBJ._renderShaderData = value._shaderValues;\r\n\t}\r\n\r\n    get render():SkinnedMeshRenderer{\r\n\t\treturn this._baseRender as SkinnedMeshRenderer;\r\n\t}\r\n\r\n    setSkinData(value:Float32Array[]){\r\n        this._renderElementOBJ.skinnedData = value;\r\n    }\r\n\r\n    constructor(){\r\n        super();\r\n    }\r\n\r\n    protected _createRenderElementOBJ(){\r\n\t\tthis._renderElementOBJ = Laya3DRender.renderOBJCreate.createSkinRenderElement() as SkinRenderElementOBJ;\r\n\t}\r\n\r\n    _render(context:IRenderContext3D): void {\r\n\t\tthis._renderElementOBJ._render(context);\r\n    }\r\n}","import { Event } from \"../../events/Event\";\r\nimport { Stat } from \"../../utils/Stat\";\r\nimport { Mesh, skinnedMatrixCache } from \"../resource/models/Mesh\";\r\nimport { SubMesh } from \"../resource/models/SubMesh\";\r\nimport { Utils3D } from \"../utils/Utils3D\";\r\nimport { MeshRenderer } from \"./MeshRenderer\";\r\nimport { Sprite3D } from \"./Sprite3D\";\r\nimport { Transform3D } from \"./Transform3D\";\r\nimport { RenderContext3D } from \"./render/RenderContext3D\";\r\nimport { SkinnedMeshSprite3DShaderDeclaration } from \"./SkinnedMeshSprite3DShaderDeclaration\";\r\nimport { Component } from \"../../components/Component\";\r\nimport { SkinRenderElement } from \"./render/SkinRenderElement\";\r\nimport { Material } from \"../../resource/Material\";\r\nimport { BlinnPhongMaterial } from \"./material/BlinnPhongMaterial\";\r\nimport { Scene3D } from \"./scene/Scene3D\";\r\nimport { Bounds } from \"../math/Bounds\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { BoundFrustum } from \"../math/BoundFrustum\";\r\n/**\r\n * <code>SkinMeshRenderer</code> \r\n */\r\nexport class SkinnedMeshRenderer extends MeshRenderer {\r\n\r\n    /**@internal */\r\n    protected _cacheMesh: Mesh;\r\n\r\n    _bones: Sprite3D[] = [];\r\n\r\n    /**@internal */\r\n    _renderElements: SkinRenderElement[];\r\n    /** @internal */\r\n    _skinnedData: any[];\r\n    /** @internal */\r\n    private _skinnedDataLoopMarks: Uint32Array;\r\n    /**@internal */\r\n    protected _localBounds: Bounds;\r\n    // /**@internal */\r\n    // protected _cacheAnimator: Animator;\r\n    /**@internal */\r\n    protected _cacheRootBone: Sprite3D;\r\n\r\n    /**@internal */\r\n    protected _inverseBindPosesBufferForNative: Float32Array = null;\r\n\r\n    /**@internal */\r\n    protected _skinnedMatrixCachesBufferForNative: Int32Array = null;\r\n    /**@internal */\r\n    protected _bonesTransformForNative: Transform3D[] = null;\r\n    /**\r\n     * \r\n     */\r\n    get localBounds(): Bounds {\r\n        return this._localBounds;\r\n    }\r\n\r\n    set localBounds(value: Bounds) {\r\n        this._localBounds = value;\r\n        this.geometryBounds = this._localBounds;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get rootBone(): Sprite3D {\r\n        return this._cacheRootBone;\r\n    }\r\n\r\n    set rootBone(value: Sprite3D) {\r\n        if (this._cacheRootBone != value) {\r\n            if (this._cacheRootBone)\r\n                this._cacheRootBone.transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange);\r\n            else\r\n                (this.owner as Sprite3D).transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange);\r\n\r\n            if (value)\r\n                value.transform.on(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange);\r\n            else\r\n                (this.owner as Sprite3D).transform.on(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange);\r\n\r\n            this._cacheRootBone = value;\r\n            this._onWorldMatNeedChange(Transform3D.TRANSFORM_WORLDPOSITION | Transform3D.TRANSFORM_WORLDQUATERNION | Transform3D.TRANSFORM_WORLDSCALE);\r\n\r\n            let count = this._renderElements.length;\r\n            for (var i: number = 0; i < count; i++) {\r\n                var renderElement: SkinRenderElement = this._renderElements[i];\r\n                renderElement.setTransform(value.transform);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get bones(): Sprite3D[] {\r\n        return this._bones;\r\n    }\r\n\r\n    /**\r\n     *  <code>SkinnedMeshRender</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._localBounds = new Bounds(Vector3.ZERO, Vector3.ZERO);\r\n        this._shaderValues.addDefine(SkinnedMeshSprite3DShaderDeclaration.SHADERDEFINE_BONE);\r\n    }\r\n\r\n\r\n\r\n\r\n    protected _computeSkinnedData(): void {\r\n        if (this._cacheMesh) {\r\n            var bindPoses: Matrix4x4[] = this._cacheMesh._inverseBindPoses;\r\n            var pathMarks: skinnedMatrixCache[] = this._cacheMesh._skinnedMatrixCaches;\r\n            for (var i: number = 0, n: number = this._cacheMesh.subMeshCount; i < n; i++) {\r\n                var subMeshBoneIndices: Uint16Array[] = ((<SubMesh>this._cacheMesh.getSubMesh(i)))._boneIndicesList;\r\n                var subData: Float32Array[] = this._skinnedData[i];\r\n                for (var j: number = 0, m: number = subMeshBoneIndices.length; j < m; j++) {\r\n                    var boneIndices: Uint16Array = subMeshBoneIndices[j];\r\n                    this._computeSubSkinnedData(bindPoses, boneIndices, subData[j], pathMarks);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _computeSubSkinnedData(bindPoses: Matrix4x4[], boneIndices: Uint16Array, data: Float32Array, matrixCaches: skinnedMatrixCache[]): void {\r\n        for (let k: number = 0, q: number = boneIndices.length; k < q; k++) {\r\n            let index: number = boneIndices[k];\r\n            if (this._skinnedDataLoopMarks[index] === Stat.loopCount) {\r\n                let c: skinnedMatrixCache = matrixCaches[index];\r\n                let preData: Float32Array = this._skinnedData[c.subMeshIndex][c.batchIndex];\r\n                let srcIndex: number = c.batchBoneIndex * 16;\r\n                let dstIndex: number = k * 16;\r\n                for (let d: number = 0; d < 16; d++)\r\n                    data[dstIndex + d] = preData[srcIndex + d];\r\n            } else {\r\n                let bone = this._bones[index];\r\n                if (bone)\r\n                    Utils3D._mulMatrixArray(bone.transform.worldMatrix.elements, bindPoses[index].elements, 0, data, k * 16);\r\n                this._skinnedDataLoopMarks[index] = Stat.loopCount;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _computeSkinnedDataForNative(): void {\r\n        if (this._cacheMesh) {\r\n            var bindPoses: Matrix4x4[] = this._cacheMesh._inverseBindPoses;\r\n            var pathMarks: skinnedMatrixCache[] = this._cacheMesh._skinnedMatrixCaches;\r\n            if (this._inverseBindPosesBufferForNative == null) {\r\n                this._inverseBindPosesBufferForNative = new Float32Array(bindPoses.length * 16);\r\n                var offset: number = 0;\r\n                for (var i: number = 0, n: number = bindPoses.length; i < n; i++) {\r\n                    this._inverseBindPosesBufferForNative.set(bindPoses[i].elements, offset);\r\n                    offset += 16;\r\n                }\r\n            }\r\n            if (this._skinnedMatrixCachesBufferForNative == null) {\r\n                this._skinnedMatrixCachesBufferForNative = new Int32Array(pathMarks.length * 3);\r\n                var j: number = 0;\r\n                for (var i: number = 0, n: number = pathMarks.length; i < n; i++) {\r\n                    if (!pathMarks[i]) {\r\n                        break;\r\n                    }\r\n                    this._skinnedMatrixCachesBufferForNative[j] = pathMarks[i].subMeshIndex;\r\n                    this._skinnedMatrixCachesBufferForNative[j + 1] = pathMarks[i].batchIndex;\r\n                    this._skinnedMatrixCachesBufferForNative[j + 2] = pathMarks[i].batchBoneIndex;\r\n                    j += 3;\r\n                }\r\n            }\r\n            if (this._bonesTransformForNative == null) {\r\n                this._bonesTransformForNative = [];\r\n                for (var i: number = 0, n: number = this._bones.length; i < n; i++) {\r\n                    let bone = this._bones[i];\r\n                    if (bone) {\r\n                        this._bonesTransformForNative[i] = (bone.transform as any)._nativeObj;\r\n                    }\r\n                    else {\r\n                        this._bonesTransformForNative[i] = null;\r\n                    }\r\n                }\r\n            }\r\n\r\n            for (var i: number = 0, n: number = this._cacheMesh.subMeshCount; i < n; i++) {\r\n                var subMeshBoneIndices: Uint16Array[] = ((<SubMesh>this._cacheMesh.getSubMesh(i)))._boneIndicesList;\r\n                var subData: Float32Array[] = this._skinnedData[i];\r\n                for (var j: number = 0, m: number = subMeshBoneIndices.length; j < m; j++) {\r\n                    var boneIndices: Uint16Array = subMeshBoneIndices[j];\r\n                    (window as any).conch.computeSubSkinnedDataForNative(this._inverseBindPosesBufferForNative, boneIndices, subData[j], this._skinnedMatrixCachesBufferForNative, this._bonesTransformForNative, this._skinnedDataLoopMarks, this._skinnedData);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n    * @inheritDoc\r\n    * @internal\r\n    * @override\r\n    */\r\n    _needRender(boundFrustum: BoundFrustum, context: RenderContext3D): boolean {\r\n        if (!Stat.enableSkin)\r\n            return false;\r\n        return super._needRender(boundFrustum, context);\r\n    }\r\n\r\n    /**\r\n     *@inheritDoc\r\n     *@override\r\n     *@internal\r\n     */\r\n    _createRenderElement(): SkinRenderElement {\r\n        let renderelement = new SkinRenderElement();\r\n        return renderelement;\r\n    }\r\n    /**\r\n     * @internal\r\n     */\r\n    _onSkinMeshChange(mesh: Mesh): void {\r\n        if (mesh && this._mesh != mesh) {\r\n            this._changeVertexDefine(mesh);\r\n            this._changeMorphData(mesh);\r\n            this._mesh = mesh;\r\n            var count: number = mesh.subMeshCount;\r\n            this._renderElements.length = count;\r\n            for (var i: number = 0; i < count; i++) {\r\n                var renderElement: SkinRenderElement = this._renderElements[i];\r\n                if (!renderElement) {\r\n                    var material: Material = this.sharedMaterials[i];\r\n                    renderElement = this._renderElements[i] = this._renderElements[i] ? this._renderElements[i] : this._createRenderElement();\r\n                    if (this._cacheRootBone) {\r\n                        renderElement.setTransform(this._cacheRootBone._transform);\r\n                    } else {\r\n                        renderElement.setTransform((this.owner as Sprite3D)._transform);\r\n                    }\r\n                    renderElement.render = this;\r\n                    renderElement.material = material ? material : BlinnPhongMaterial.defaultMaterial;//,\r\n                }\r\n                renderElement.setGeometry(mesh.getSubMesh(i));\r\n            }\r\n        } else if (!mesh) {\r\n            this._renderElements.length = 0;\r\n            this._mesh = null;\r\n            this._changeVertexDefine(null);\r\n            this._changeMorphData(null);\r\n        }\r\n        this.boundsChange = true;\r\n        // if (this._octreeNode && this._indexInOctreeMotionList === -1) {\r\n        // \tthis._octreeNode.getManagerNode().addMotionObject(this);\r\n        // }\r\n    }\r\n    /**\r\n    *@inheritDoc\r\n    *@override\r\n    *@internal\r\n    */\r\n    _onMeshChange(value: Mesh): void {\r\n        this._onSkinMeshChange(value);\r\n        if (!value)\r\n            return;\r\n        this._cacheMesh = (<Mesh>value);\r\n\r\n        var subMeshCount: number = value.subMeshCount;\r\n        this._skinnedData = [];\r\n        this._skinnedDataLoopMarks = new Uint32Array(value._inverseBindPoses.length);\r\n        for (var i: number = 0; i < subMeshCount; i++) {\r\n            var subBoneIndices: Uint16Array[] = ((<SubMesh>value.getSubMesh(i)))._boneIndicesList;\r\n            var subCount: number = subBoneIndices.length;\r\n            var subData: Float32Array[] = this._skinnedData[i] = [];\r\n            for (var j: number = 0; j < subCount; j++)\r\n                subData[j] = new Float32Array(subBoneIndices[j].length * 16);\r\n            this._renderElements[i].setSkinData(subData);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    protected _calculateBoundingBox(): void {//TODO:boundingSphere\r\n        if (this._cacheRootBone)\r\n            this._localBounds._tranform(this._cacheRootBone.transform.worldMatrix, this._bounds);\r\n        else\r\n            this._localBounds._tranform((this.owner as Sprite3D).transform.worldMatrix, this._bounds);\r\n    }\r\n\r\n    _setBelongScene(scene: Scene3D): void {\r\n        super._setBelongScene(scene);\r\n        Stat.skinRenderNode++;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setUnBelongScene() {\r\n        super._setUnBelongScene();\r\n        Stat.skinRenderNode--;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _renderUpdate(context: RenderContext3D, transform: Transform3D): void {\r\n        this._applyReflection();\r\n        if (this.bones.length > 0) {\r\n            this._computeSkinnedData();\r\n            this._shaderValues.setMatrix4x4(Sprite3D.WORLDMATRIX, Matrix4x4.DEFAULT);\r\n            this._worldParams.x = 1;\r\n            this._shaderValues.setVector(Sprite3D.WORLDINVERTFRONT, this._worldParams);\r\n        } else {\r\n            this._shaderValues.setMatrix4x4(Sprite3D.WORLDMATRIX, transform.worldMatrix);\r\n            this._worldParams.x = transform.getFrontFaceValue();\r\n            this._shaderValues.setVector(Sprite3D.WORLDINVERTFRONT, this._worldParams);\r\n        }\r\n\r\n        this._mesh.morphTargetData && this._applyMorphdata();\r\n    }\r\n\r\n    // /**\r\n    //  * @inheritDoc\r\n    //  * @override\r\n    //  * @internal\r\n    //  */\r\n    // _renderUpdateWithCamera(context: RenderContext3D, transform: Transform3D): void {\r\n    // \tvar projectionView: Matrix4x4 = context.projectionViewMatrix;\r\n    // \tthis._shaderValues.setMatrix4x4(Sprite3D.MVPMATRIX, projectionView);\r\n    // }\r\n\r\n    /**\r\n     * @override\r\n     * @param dest \r\n     */\r\n    _cloneTo(dest: Component): void {\r\n        let render = (dest as SkinnedMeshRenderer);\r\n\r\n        render._inverseBindPosesBufferForNative = null;\r\n        render._skinnedMatrixCachesBufferForNative = null;\r\n        render._bonesTransformForNative = null;\r\n\r\n        //get common parent\r\n        let getCommomParent = (rootNode: Sprite3D, rootCheckNode: Sprite3D): Sprite3D => {\r\n            let nodeArray: Sprite3D[] = [];\r\n            let node = rootNode;\r\n            while (!!node) {\r\n                if (node instanceof Sprite3D)\r\n                    nodeArray.push(node);\r\n                node = node.parent as Sprite3D;\r\n            }\r\n            let checkNode: Sprite3D = rootCheckNode;\r\n            while (!!checkNode && nodeArray.indexOf(checkNode) == -1) {\r\n                checkNode = checkNode.parent as Sprite3D;\r\n            }\r\n            return checkNode;\r\n        }\r\n        let cloneHierachFun = (rootNode: Sprite3D, rootCheckNode: Sprite3D, destNode: Sprite3D): Sprite3D => {\r\n            let rootparent: Sprite3D = getCommomParent(rootNode, rootCheckNode);\r\n            if (!rootparent)\r\n                return null;\r\n            let path: number[] = [];\r\n            Utils3D._getHierarchyPath(rootparent, rootNode, path);\r\n            let pathcheck: number[] = [];\r\n            Utils3D._getHierarchyPath(rootparent, rootCheckNode, pathcheck);\r\n            let destParent = Utils3D._getParentNodeByHierarchyPath(destNode, path);\r\n            if (!destParent)\r\n                return null;\r\n            return Utils3D._getNodeByHierarchyPath(destParent, pathcheck) as Sprite3D;\r\n        }\r\n        //rootBone Clone\r\n        var rootBone: Sprite3D = this.rootBone;\r\n        if (rootBone) {\r\n            let node = cloneHierachFun(this.owner as Sprite3D, this.rootBone as Sprite3D, render.owner as Sprite3D);\r\n            if (node)\r\n                render.rootBone = node;\r\n            else\r\n                render.rootBone = rootBone;\r\n        }\r\n        //BonesClone\r\n        var bones: Sprite3D[] = this.bones;\r\n        var destBone: Sprite3D[] = render.bones;\r\n        let n = destBone.length = bones.length;\r\n        for (var i = 0; i < n; i++) {\r\n            let ceckNode = bones[i];\r\n            destBone[i] = cloneHierachFun(this.owner as Sprite3D, ceckNode, render.owner as Sprite3D);\r\n        }\r\n        //bounds\r\n        var lbb: Bounds = this.localBounds;\r\n        (lbb) && (lbb.cloneTo(render.localBounds));\r\n        (render.localBounds) && (render.localBounds = render.localBounds);\r\n        super._cloneTo(dest);\r\n    }\r\n\r\n    protected _onDestroy() {\r\n        if (this._cacheRootBone)\r\n            (!this._cacheRootBone._destroyed) && (this._cacheRootBone.transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange));\r\n        else\r\n            (this.owner && !this.owner._destroyed) && ((this.owner as Sprite3D).transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange));\r\n        super._onDestroy();\r\n    }\r\n}\r\n\r\n","import { Node } from \"../../display/Node\";\r\nimport { Loader } from \"../../net/Loader\";\r\nimport { Mesh } from \"../resource/models/Mesh\";\r\nimport { MeshFilter } from \"./MeshFilter\";\r\nimport { RenderableSprite3D } from \"./RenderableSprite3D\";\r\nimport { SkinnedMeshRenderer } from \"./SkinnedMeshRenderer\";\r\nimport { Sprite3D } from \"./Sprite3D\";\r\nimport { Material } from \"../../resource/Material\";\r\nimport { SkinnedMeshSprite3DShaderDeclaration } from \"./SkinnedMeshSprite3DShaderDeclaration\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\n\r\n/**\r\n * <code>SkinnedMeshSprite3D</code> \r\n */\r\nexport class SkinnedMeshSprite3D extends RenderableSprite3D {\r\n    /**@internal */\r\n    static _tempArray0: any[] = [];\r\n\r\n    /***/\r\n    static BONES: number;\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n        SkinnedMeshSprite3DShaderDeclaration.SHADERDEFINE_BONE = Shader3D.getDefineByName(\"BONE\");\r\n        SkinnedMeshSprite3DShaderDeclaration.SHADERDEFINE_SIMPLEBONE = Shader3D.getDefineByName(\"SIMPLEBONE\");\r\n        const commandUniform = LayaGL.renderOBJCreate.createGlobalUniformMap(\"Custom\");\r\n        SkinnedMeshSprite3D.BONES = Shader3D.propertyNameToID(\"u_Bones\");\r\n        commandUniform.addShaderUniform(SkinnedMeshSprite3D.BONES, \"u_Bones\", ShaderDataType.Buffer);\r\n    }\r\n\r\n    /** @internal */\r\n    private _meshFilter: MeshFilter;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get meshFilter(): MeshFilter {\r\n        return this._meshFilter;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get skinnedMeshRenderer(): SkinnedMeshRenderer {\r\n        return (<SkinnedMeshRenderer>this._render);\r\n    }\r\n\r\n    /**\r\n     *  <code>MeshSprite3D</code> \r\n     * @param mesh ,\r\n     * @param name \r\n     */\r\n    constructor(mesh: Mesh = null, name: string = null) {\r\n        super(name);\r\n        this._meshFilter = this.addComponent(MeshFilter);\r\n        this._render = this.addComponent(SkinnedMeshRenderer);\r\n        (mesh) && (this._meshFilter.sharedMesh = mesh);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n        var render: SkinnedMeshRenderer = this.skinnedMeshRenderer;\r\n        var lightmapIndex: any = data.lightmapIndex;\r\n        (lightmapIndex != null) && (render.lightmapIndex = lightmapIndex);\r\n        var lightmapScaleOffsetArray: any[] = data.lightmapScaleOffset;\r\n        (lightmapScaleOffsetArray) && (render.lightmapScaleOffset = new Vector4(lightmapScaleOffsetArray[0], lightmapScaleOffsetArray[1], lightmapScaleOffsetArray[2], lightmapScaleOffsetArray[3]));\r\n        (data.enableRender != undefined) && (render.enabled = data.enableRender);\r\n        (data.receiveShadows != undefined) && (render.receiveShadow = data.receiveShadows);\r\n        (data.castShadow != undefined) && (render.castShadow = data.castShadow);\r\n        var meshPath: string;\r\n        meshPath = data.meshPath;\r\n        if (meshPath) {\r\n            var mesh: Mesh = Loader.getRes(meshPath);//mesh\r\n            (mesh) && (this.meshFilter.sharedMesh = mesh);\r\n        }\r\n\r\n        var materials: any[] = data.materials;\r\n        if (materials) {\r\n            var sharedMaterials: Material[] = render.sharedMaterials;\r\n            var materialCount: number = materials.length;\r\n            sharedMaterials.length = materialCount;\r\n            for (var i: number = 0; i < materialCount; i++) {\r\n                sharedMaterials[i] = Loader.getRes(materials[i].path);\r\n            }\r\n            render.sharedMaterials = sharedMaterials;\r\n        }\r\n\r\n        var boundBox: any = data.boundBox;\r\n        var min: any[] = boundBox.min;\r\n        var max: any[] = boundBox.max;\r\n        render.localBounds.setMin(new Vector3(min[0], min[1], min[2]));\r\n        render.localBounds.setMax(new Vector3(max[0], max[1], max[2]));\r\n        render.localBounds = render.localBounds;\r\n        if (spriteMap) {\r\n            var rootBoneData: number = data.rootBone;\r\n            render.rootBone = spriteMap[rootBoneData];\r\n            var bonesData: any[] = data.bones;\r\n            var n: number;\r\n            for (i = 0, n = bonesData.length; i < n; i++)\r\n                (render as SkinnedMeshRenderer).bones.push(spriteMap[bonesData[i]]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _cloneTo(destObject: any, srcRoot: Node, dstRoot: Node): void {\r\n        super._cloneTo(destObject, srcRoot, dstRoot);//,\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    destroy(destroyChild: boolean = true): void {\r\n        if (this._destroyed)\r\n            return;\r\n        super.destroy(destroyChild);\r\n        this._meshFilter.destroy();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Node {\r\n        return new Sprite3D();\r\n    }\r\n\r\n}\r\n\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { Material, MaterialRenderMode } from \"../../../resource/Material\";\r\n\r\n/**\r\n * <code>TrailMaterial</code> \r\n */\r\nexport class TrailMaterial extends Material {\r\n\r\n\r\n\t/** */\r\n\tstatic defaultMaterial: TrailMaterial;\r\n\t/**@internal */\r\n\tstatic MAINTEXTURE: number;\r\n\t/**@internal */\r\n\tstatic TINTCOLOR: number;\r\n\t/**@internal */\r\n\tstatic TILINGOFFSET: number;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __initDefine__(): void {\r\n\t\tTrailMaterial.MAINTEXTURE = Shader3D.propertyNameToID(\"u_MainTexture\");\r\n\t\tTrailMaterial.TINTCOLOR = Shader3D.propertyNameToID(\"u_MainColor\");\r\n\t\tTrailMaterial.TILINGOFFSET = Shader3D.propertyNameToID(\"u_TilingOffset\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget color(): Color {\r\n\t\treturn (<Color>this._shaderValues.getColor(TrailMaterial.TINTCOLOR));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset color(value: Color) {\r\n\t\tthis._shaderValues.setColor(TrailMaterial.TINTCOLOR, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget texture(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(TrailMaterial.MAINTEXTURE);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset texture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis._shaderValues.addDefine(TrailMaterial.SHADERDEFINE_MAINTEXTURE);\r\n\t\telse\r\n\t\t\tthis._shaderValues.removeDefine(TrailMaterial.SHADERDEFINE_MAINTEXTURE);\r\n\t\tthis._shaderValues.setTexture(TrailMaterial.MAINTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget tilingOffset(): Vector4 {\r\n\t\treturn (<Vector4>this._shaderValues.getVector(TrailMaterial.TILINGOFFSET));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset tilingOffset(value: Vector4) {\r\n\t\tif (value) {\r\n\t\t\tthis._shaderValues.setVector(TrailMaterial.TILINGOFFSET, value);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._shaderValues.getVector(TrailMaterial.TILINGOFFSET).setValue(1.0, 1.0, 0.0, 0.0);\r\n\t\t}\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"Trail\");\r\n\t\tthis.materialRenderMode = MaterialRenderMode.RENDERMODE_ALPHABLENDED;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: TrailMaterial = new TrailMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n\t//----------------deprecated----------------\r\n\t/**\r\n\t * @deprecated\r\n\t * _\r\n\t */\r\n\tstatic RENDERMODE_ALPHABLENDED: number = 0;\r\n\r\n\t/**\r\n\t* @deprecated\r\n\t* _\r\n\t*/\r\n\tstatic RENDERMODE_ADDTIVE: number = 1;\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * materialRenderMode\r\n\t */\r\n\tset renderMode(value: number) {\r\n\t\tswitch (value) {\r\n\t\t\tcase TrailMaterial.RENDERMODE_ADDTIVE:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_NONE;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis._shaderValues.addDefine(TrailMaterial.SHADERDEFINE_ADDTIVEFOG);\r\n\t\t\t\tbreak;\r\n\t\t\tcase TrailMaterial.RENDERMODE_ALPHABLENDED:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_NONE;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis._shaderValues.removeDefine(TrailMaterial.SHADERDEFINE_ADDTIVEFOG);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"ShurikenParticleMaterial : renderMode value error.\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\n","\r\nexport class TrailTextureMode {\r\n\t/**\r\n\t * \r\n\t */\r\n\tstatic Stretch: number = 0;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tstatic Tile: number = 1;\r\n\r\n}\r\n\r\n\r\n","import { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\";\r\nimport { IVertex } from \"../../graphics/IVertex\"\r\n/**\r\n * <code>VertexTrail</code> \r\n * @internal\r\n */\r\nexport class VertexTrail implements IVertex {\r\n\t/**@internal */\r\n\tstatic TRAIL_POSITION0: number = 0;\r\n\t/**@internal */\r\n\tstatic TRAIL_OFFSETVECTOR: number = 1;\r\n\t/**@internal */\r\n\tstatic TRAIL_TIME0: number = 2;\r\n\t/**@internal */\r\n\tstatic TRAIL_TEXTURECOORDINATE0Y: number = 3;\r\n\t/**@internal */\r\n\tstatic TRAIL_TEXTURECOORDINATE0X: number = 4;\r\n\t/**@internal */\r\n\tstatic TRAIL_COLOR: number = 5;\r\n\r\n\t/**@internal */\r\n\tprivate static _vertexDeclaration1: VertexDeclaration;\r\n\t/**@internal */\r\n\tprivate static _vertexDeclaration2: VertexDeclaration;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic get vertexDeclaration1(): VertexDeclaration {\r\n\t\treturn VertexTrail._vertexDeclaration1;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic get vertexDeclaration2(): VertexDeclaration {\r\n\t\treturn VertexTrail._vertexDeclaration2;\r\n\t}\r\n\r\n\tget vertexDeclaration(): VertexDeclaration {\r\n\t\treturn VertexTrail._vertexDeclaration1;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tVertexTrail._vertexDeclaration1 = new VertexDeclaration(32,\r\n\t\t\t[new VertexElement(0, VertexElementFormat.Vector3, VertexTrail.TRAIL_POSITION0),\r\n\t\t\tnew VertexElement(12, VertexElementFormat.Vector3, VertexTrail.TRAIL_OFFSETVECTOR),\r\n\t\t\tnew VertexElement(24, VertexElementFormat.Single, VertexTrail.TRAIL_TIME0),\r\n\t\t\tnew VertexElement(28, VertexElementFormat.Single, VertexTrail.TRAIL_TEXTURECOORDINATE0Y)]);\r\n\t\tVertexTrail._vertexDeclaration2 = new VertexDeclaration(20,\r\n\t\t\t[new VertexElement(0, VertexElementFormat.Single, VertexTrail.TRAIL_TEXTURECOORDINATE0X),\r\n\t\t\tnew VertexElement(4, VertexElementFormat.Color, VertexTrail.TRAIL_COLOR)]);\r\n\t}\r\n}\r\n\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { MathUtils3D } from \"../../../maths/MathUtils3D\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { Resource } from \"../../../resource/Resource\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { Camera } from \"../Camera\";\r\nimport { GeometryElement } from \"../GeometryElement\";\r\nimport { Gradient } from \"../Gradient\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { TrailTextureMode } from \"../TrailTextureMode\";\r\nimport { TrailAlignment } from \"./TrailAlignment\";\r\nimport { TrailFilter } from \"./TrailFilter\";\r\nimport { VertexTrail } from \"./VertexTrail\";\r\n\r\n/**\r\n * <code>TrailGeometry</code> \r\n */\r\nexport class TrailGeometry extends GeometryElement {\r\n\t/** _*/\r\n\tstatic ALIGNMENT_VIEW: number = 0;\r\n\t/** _*/\r\n\tstatic ALIGNMENT_TRANSFORM_Z: number = 1;\r\n\r\n\t/**@internal */\r\n\tprivate static _tempVector30: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempVector31: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempVector32: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempVector33: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempVector34: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempVector35: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempVector36: Vector3 = new Vector3();\r\n\r\n\t/**@internal */\r\n\tprivate static _type: number = GeometryElement._typeCounter++;\r\n\r\n\t/**@internal */\r\n\tprivate _floatCountPerVertices1: number = 8;\r\n\t/**@internal */\r\n\tprivate _floatCountPerVertices2: number = 5;\r\n\t/**@internal */\r\n\tprivate _increaseSegementCount: number = 16;\r\n\t/**@internal */\r\n\tprivate _activeIndex: number = 0;\r\n\t/**@internal */\r\n\tprivate _endIndex: number = 0;\r\n\t/**@internal */\r\n\tprivate _needAddFirstVertex: boolean = false;\r\n\t/**@internal */\r\n\tprivate _isTempEndVertex: boolean = false;\r\n\t/**@internal */\r\n\tprivate _subBirthTime: Float32Array;\r\n\t/**@internal */\r\n\tprivate _subDistance: Float64Array;\r\n\t/**@internal */\r\n\tprivate _segementCount: number;\r\n\t/**@internal */\r\n\tprivate _vertices1: Float32Array = null;\r\n\t/**@internal */\r\n\tprivate _vertices2: Float32Array = null;\r\n\t/**@internal */\r\n\tprivate _vertexBuffer1: VertexBuffer3D;\r\n\t/**@internal */\r\n\tprivate _vertexBuffer2: VertexBuffer3D;\r\n\t/**@internal */\r\n\tprivate _lastFixedVertexPosition: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprotected _owner: TrailFilter;\r\n\r\n\tprivate tmpColor: Color = new Color();\r\n\t/** @private */\r\n\tprivate _disappearBoundsMode: Boolean = false;\r\n\r\n\tconstructor(owner: TrailFilter) {\r\n\t\tsuper(MeshTopology.TriangleStrip, DrawType.DrawArray);\r\n\t\tthis._owner = owner;\r\n\t\t//_segementCount\r\n\t\tthis.bufferState = new BufferState();\r\n\t\tthis._segementCount = this._increaseSegementCount;\r\n\r\n\t\tthis._resizeData(this._segementCount, this.bufferState);\r\n\t\t// var bounds: Bounds = this._owner._owner.trailRenderer.bounds;\r\n\t\t// var sprite3dPosition: Vector3 = this._owner._owner.transform.position;\r\n\t\t// bounds.setMin(sprite3dPosition);\r\n\t\t// bounds.setMax(sprite3dPosition);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _resizeData(segementCount: number, bufferState: BufferState): void {\r\n\t\tthis._subBirthTime = new Float32Array(segementCount);\r\n\t\tthis._subDistance = new Float64Array(segementCount);\r\n\r\n\t\tvar vertexCount: number = segementCount * 2;\r\n\t\tvar vertexDeclaration1: VertexDeclaration = VertexTrail.vertexDeclaration1;\r\n\t\tvar vertexDeclaration2: VertexDeclaration = VertexTrail.vertexDeclaration2;\r\n\t\tvar vertexBuffers: VertexBuffer3D[] = [];\r\n\t\tvar vertexbuffer1Size: number = vertexCount * vertexDeclaration1.vertexStride;\r\n\t\tvar vertexbuffer2Size: number = vertexCount * vertexDeclaration2.vertexStride;\r\n\t\tvar memorySize: number = vertexbuffer1Size + vertexbuffer2Size;\r\n\t\tthis._vertices1 = new Float32Array(vertexCount * this._floatCountPerVertices1);\r\n\t\tthis._vertices2 = new Float32Array(vertexCount * this._floatCountPerVertices2);\r\n\t\tthis._vertexBuffer1 = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vertexbuffer1Size, BufferUsage.Dynamic, false);\r\n\t\tthis._vertexBuffer1.vertexDeclaration = vertexDeclaration1;\r\n\t\tthis._vertexBuffer2 = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vertexbuffer2Size, BufferUsage.Dynamic, false);\r\n\t\tthis._vertexBuffer2.vertexDeclaration = vertexDeclaration2;\r\n\r\n\t\tvertexBuffers.push(this._vertexBuffer1);\r\n\t\tvertexBuffers.push(this._vertexBuffer2);\r\n\t\t// bufferState.bind();\r\n\t\t// bufferState.applyVertexBuffers(vertexBuffers);\r\n\t\t// bufferState.unBind();\r\n\t\tbufferState.applyState(vertexBuffers, null);\r\n\t\tResource._addMemory(memorySize, memorySize);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _resetData(): void {\r\n\t\tvar count: number = this._endIndex - this._activeIndex;\r\n\t\t//_resizeData\r\n\t\tvar oldVertices1: Float32Array = new Float32Array(this._vertices1.buffer, this._floatCountPerVertices1 * 2 * this._activeIndex * 4, this._floatCountPerVertices1 * 2 * count);\r\n\t\tvar oldVertices2: Float32Array = new Float32Array(this._vertices2.buffer, this._floatCountPerVertices2 * 2 * this._activeIndex * 4, this._floatCountPerVertices2 * 2 * count);\r\n\t\tvar oldSubDistance: Float64Array = new Float64Array(this._subDistance.buffer, this._activeIndex * 8, count);//\r\n\t\tvar oldSubBirthTime: Float32Array = new Float32Array(this._subBirthTime.buffer, this._activeIndex * 4, count);//\r\n\r\n\t\tif (count === this._segementCount) {//count=_segementCount,\r\n\t\t\tvar memorySize: number = this._vertexBuffer1._byteLength + this._vertexBuffer2._byteLength;\r\n\t\t\tResource._addMemory(-memorySize, -memorySize);\r\n\t\t\tthis._vertexBuffer1.destroy();\r\n\t\t\tthis._vertexBuffer2.destroy();\r\n\t\t\tthis._segementCount += this._increaseSegementCount;\r\n\t\t\tthis._resizeData(this._segementCount, this.bufferState);\r\n\t\t}\r\n\r\n\t\tthis._vertices1.set(oldVertices1, 0);\r\n\t\tthis._vertices2.set(oldVertices2, 0);\r\n\t\tthis._subDistance.set(oldSubDistance, 0);\r\n\t\tthis._subBirthTime.set(oldSubBirthTime, 0);\r\n\r\n\t\tthis._endIndex = count;\r\n\t\tthis._activeIndex = 0;\r\n\t\tthis._vertexBuffer1.setData(this._vertices1.buffer, 0, this._floatCountPerVertices1 * 2 * this._activeIndex * 4, this._floatCountPerVertices1 * 2 * count * 4);\r\n\t\tthis._vertexBuffer2.setData(this._vertices2.buffer, 0, this._floatCountPerVertices2 * 2 * this._activeIndex * 4, this._floatCountPerVertices2 * 2 * count * 4);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * Trail\r\n\t */\r\n\t_updateTrail(camera: Camera, lastPosition: Vector3, position: Vector3): void {\r\n\t\tif (!Vector3.equals(lastPosition, position)) {//\r\n\t\t\tif ((this._endIndex - this._activeIndex) === 0)\r\n\t\t\t\tthis._addTrailByFirstPosition(camera, position);//,\r\n\t\t\telse\r\n\t\t\t\tthis._addTrailByNextPosition(camera, position);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * TrailRenderElement\r\n\t */\r\n\tprivate _addTrailByFirstPosition(camera: Camera, position: Vector3): void {\r\n\t\t(this._endIndex === this._segementCount) && (this._resetData());\r\n\t\tthis._subDistance[this._endIndex] = 0;\r\n\t\tthis._subBirthTime[this._endIndex] = this._owner._curtime;\r\n\t\tthis._endIndex++;\r\n\t\tposition.cloneTo(this._lastFixedVertexPosition);\r\n\t\tthis._needAddFirstVertex = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * TrailRenderElement\r\n\t */\r\n\tprivate _addTrailByNextPosition(camera: Camera, position: Vector3): void {\r\n\t\tvar delVector3: Vector3 = TrailGeometry._tempVector30;\r\n\t\tvar pointAtoBVector3: Vector3 = TrailGeometry._tempVector31;\r\n\t\tswitch (this._owner.alignment) {\r\n\t\t\tcase TrailAlignment.View:\r\n\t\t\t\tvar cameraMatrix: Matrix4x4 = camera.viewMatrix;\r\n\t\t\t\tVector3.transformCoordinate(position, cameraMatrix, TrailGeometry._tempVector33);\r\n\t\t\t\tVector3.transformCoordinate(this._lastFixedVertexPosition, cameraMatrix, TrailGeometry._tempVector34);\r\n\t\t\t\tVector3.subtract(TrailGeometry._tempVector33, TrailGeometry._tempVector34, delVector3);\r\n\t\t\t\tVector3.cross(TrailGeometry._tempVector33, delVector3, pointAtoBVector3);\r\n\t\t\t\tbreak;\r\n\t\t\tcase TrailAlignment.TransformZ:\r\n\t\t\t\tVector3.subtract(position, this._lastFixedVertexPosition, delVector3);\r\n\t\t\t\tvar forward: Vector3 = TrailGeometry._tempVector32;\r\n\t\t\t\t(this._owner._ownerRender.owner as Sprite3D).transform.getForward(forward);\r\n\t\t\t\tVector3.cross(delVector3, forward, pointAtoBVector3);//viewforward\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tVector3.normalize(pointAtoBVector3, pointAtoBVector3);\r\n\t\tVector3.scale(pointAtoBVector3, this._owner.widthMultiplier / 2, pointAtoBVector3);\r\n\r\n\t\tvar delLength: number = Vector3.scalarLength(delVector3);\r\n\t\tvar tempEndIndex: number;\r\n\t\tvar offset: number;\r\n\r\n\t\tif (this._needAddFirstVertex) {\r\n\t\t\tthis._updateVerticesByPositionData(position, pointAtoBVector3, this._endIndex - 1);//\r\n\t\t\tthis._needAddFirstVertex = false;\r\n\t\t}\r\n\r\n\t\tif (delLength - this._owner.minVertexDistance >= MathUtils3D.zeroTolerance) {//\r\n\t\t\tif (this._isTempEndVertex) {\r\n\t\t\t\ttempEndIndex = this._endIndex - 1;\r\n\t\t\t\toffset = delLength - this._subDistance[tempEndIndex];\r\n\t\t\t\tthis._updateVerticesByPosition(position, pointAtoBVector3, delLength, tempEndIndex);\r\n\t\t\t\tthis._owner._totalLength += offset;//\r\n\t\t\t} else {\r\n\t\t\t\t(this._endIndex === this._segementCount) && (this._resetData());\r\n\t\t\t\tthis._updateVerticesByPosition(position, pointAtoBVector3, delLength, this._endIndex);\r\n\t\t\t\tthis._owner._totalLength += delLength;\r\n\t\t\t\tthis._endIndex++;\r\n\t\t\t}\r\n\t\t\tposition.cloneTo(this._lastFixedVertexPosition);\r\n\t\t\tthis._isTempEndVertex = false;\r\n\t\t} else {\r\n\t\t\tif (this._isTempEndVertex) {\r\n\t\t\t\ttempEndIndex = this._endIndex - 1;\r\n\t\t\t\toffset = delLength - this._subDistance[tempEndIndex];\r\n\t\t\t\tthis._updateVerticesByPosition(position, pointAtoBVector3, delLength, tempEndIndex);\r\n\t\t\t\tthis._owner._totalLength += offset;//\r\n\t\t\t} else {\r\n\t\t\t\t(this._endIndex === this._segementCount) && (this._resetData());\r\n\t\t\t\tthis._updateVerticesByPosition(position, pointAtoBVector3, delLength, this._endIndex);\r\n\t\t\t\tthis._owner._totalLength += delLength;\r\n\t\t\t\tthis._endIndex++;\r\n\t\t\t}\r\n\t\t\tthis._isTempEndVertex = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * \r\n\t */\r\n\tprivate _updateVerticesByPositionData(position: Vector3, pointAtoBVector3: Vector3, index: number): void {\r\n\t\tvar vertexOffset: number = this._floatCountPerVertices1 * 2 * index;\r\n\t\tvar curtime: number = this._owner._curtime;\r\n\t\tthis._vertices1[vertexOffset] = position.x;\r\n\t\tthis._vertices1[vertexOffset + 1] = position.y;\r\n\t\tthis._vertices1[vertexOffset + 2] = position.z;\r\n\t\tthis._vertices1[vertexOffset + 3] = -pointAtoBVector3.x;\r\n\t\tthis._vertices1[vertexOffset + 4] = -pointAtoBVector3.y;\r\n\t\tthis._vertices1[vertexOffset + 5] = -pointAtoBVector3.z;\r\n\t\tthis._vertices1[vertexOffset + 6] = curtime;\r\n\t\tthis._vertices1[vertexOffset + 7] = 1.0;\r\n\r\n\t\tthis._vertices1[vertexOffset + 8] = position.x;\r\n\t\tthis._vertices1[vertexOffset + 9] = position.y;\r\n\t\tthis._vertices1[vertexOffset + 10] = position.z;\r\n\t\tthis._vertices1[vertexOffset + 11] = pointAtoBVector3.x;\r\n\t\tthis._vertices1[vertexOffset + 12] = pointAtoBVector3.y;\r\n\t\tthis._vertices1[vertexOffset + 13] = pointAtoBVector3.z;\r\n\t\tthis._vertices1[vertexOffset + 14] = curtime;\r\n\t\tthis._vertices1[vertexOffset + 15] = 0.0;\r\n\r\n\t\t//\r\n\t\tvar bounds: Bounds = this._owner._ownerRender.bounds;\r\n\t\tvar min: Vector3 = bounds.getMin();\r\n\t\tvar max: Vector3 = bounds.getMax();\r\n\t\tvar up: Vector3 = TrailGeometry._tempVector35;\r\n\t\tvar down: Vector3 = TrailGeometry._tempVector36;\r\n\t\tvar out: Vector3 = TrailGeometry._tempVector32;\r\n\t\tVector3.add(position, pointAtoBVector3, up);\r\n\t\tVector3.subtract(position, pointAtoBVector3, down);\r\n\r\n\t\tVector3.min(down, up, out);\r\n\t\tVector3.min(min, out, min);\r\n\t\tbounds.setMin(min);\r\n\r\n\t\tVector3.max(up, down, out);\r\n\t\tVector3.max(max, out, max);\r\n\t\tbounds.setMax(max);\r\n\r\n\r\n\t\tvar floatCount: number = this._floatCountPerVertices1 * 2;\r\n\t\tthis._vertexBuffer1.setData(this._vertices1.buffer, vertexOffset * 4, vertexOffset * 4, floatCount * 4);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * \r\n\t */\r\n\tprivate _updateVerticesByPosition(position: Vector3, pointAtoBVector3: Vector3, delDistance: number, index: number): void {\r\n\t\tthis._updateVerticesByPositionData(position, pointAtoBVector3, index);\r\n\t\tthis._subDistance[index] = delDistance;\r\n\t\tthis._subBirthTime[index] = this._owner._curtime;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * VertexBuffer2\r\n\t */\r\n\t_updateVertexBufferUV(): void {\r\n\t\tvar bounds: Bounds;\r\n\t\tvar min: Vector3, max: Vector3;\r\n\t\tif (this._disappearBoundsMode) {//\r\n\t\t\tbounds = this._owner._ownerRender.bounds;\r\n\t\t\tvar sprite3dPosition: Vector3 = (this._owner._ownerRender.owner as Sprite3D).transform.position;\r\n\t\t\tbounds.setMin(sprite3dPosition);\r\n\t\t\tbounds.setMax(sprite3dPosition);\r\n\t\t\tmin = bounds.getMin();\r\n\t\t\tmax = bounds.getMax();\r\n\t\t}\r\n\t\tvar vertexCount: number = this._endIndex;\r\n\t\tvar curLength: number = 0;\r\n\r\n\t\tvar gradient: Gradient = this._owner.colorGradient;\r\n\t\tvar startAlphaIndex: number = gradient.colorAlphaKeysCount - 1;\r\n\t\tvar startColorIndex: number = gradient.colorRGBKeysCount - 1;\r\n\r\n\t\tvar totalLength: number = this._owner._totalLength;\r\n\t\tvar stride: number = this._floatCountPerVertices2 * 2;\r\n\t\tfor (var i: number = this._activeIndex; i < vertexCount; i++) {\r\n\t\t\t(i !== this._activeIndex) && (curLength += this._subDistance[i]);\r\n\t\t\tvar uvX: number;\r\n\t\t\tvar lerpFactor: number;\r\n\t\t\tif (this._owner.textureMode == TrailTextureMode.Stretch) {\r\n\t\t\t\tuvX = 1.0 - curLength / totalLength;\r\n\t\t\t\tlerpFactor = uvX;\r\n\t\t\t} else {\r\n\t\t\t\tlerpFactor = 1.0 - curLength / totalLength;\r\n\t\t\t\tuvX = 1.0 - (totalLength - curLength);\r\n\t\t\t}\r\n\r\n\t\t\tstartColorIndex = gradient.evaluateColorRGB(lerpFactor, this.tmpColor, startColorIndex, true);\r\n\t\t\tstartAlphaIndex = gradient.evaluateColorAlpha(lerpFactor, this.tmpColor, startAlphaIndex, true);\r\n\r\n\t\t\tvar index: number = i * stride;\r\n\t\t\tthis._vertices2[index + 0] = uvX;\r\n\t\t\tthis._vertices2[index + 1] = this.tmpColor.r;\r\n\t\t\tthis._vertices2[index + 2] = this.tmpColor.g;\r\n\t\t\tthis._vertices2[index + 3] = this.tmpColor.b;\r\n\t\t\tthis._vertices2[index + 4] = this.tmpColor.a;\r\n\r\n\t\t\tthis._vertices2[index + 5] = uvX;\r\n\t\t\tthis._vertices2[index + 6] = this.tmpColor.r;\r\n\t\t\tthis._vertices2[index + 7] = this.tmpColor.g;\r\n\t\t\tthis._vertices2[index + 8] = this.tmpColor.b;\r\n\t\t\tthis._vertices2[index + 9] = this.tmpColor.a;\r\n\r\n\t\t\tif (this._disappearBoundsMode) {\r\n\t\t\t\tvar posOffset = this._floatCountPerVertices1 * 2 * i;\r\n\t\t\t\tvar pos: Vector3 = TrailGeometry._tempVector32;\r\n\t\t\t\tvar up: Vector3 = TrailGeometry._tempVector33;\r\n\t\t\t\tvar side: Vector3 = TrailGeometry._tempVector34;\r\n\r\n\t\t\t\tpos.setValue(this._vertices1[posOffset + 0], this._vertices1[posOffset + 1], this._vertices1[posOffset + 2]);\r\n\t\t\t\tup.setValue(this._vertices1[posOffset + 3], this._vertices1[posOffset + 4], this._vertices1[posOffset + 5]);\r\n\r\n\t\t\t\tVector3.add(pos, up, side);\r\n\t\t\t\tVector3.min(side, min, min);\r\n\t\t\t\tVector3.max(side, max, max);\r\n\t\t\t\tVector3.subtract(pos, up, side);\r\n\t\t\t\tVector3.min(side, min, min);\r\n\t\t\t\tVector3.max(side, max, max);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._disappearBoundsMode) {\r\n\t\t\tbounds.setMin(min);\r\n\t\t\tbounds.setMax(max);\r\n\t\t\tthis._disappearBoundsMode = false;\r\n\t\t}\r\n\t\tvar offset: number = this._activeIndex * stride;\r\n\t\tthis._vertexBuffer2.setData(this._vertices2.buffer, offset * 4, offset * 4, (vertexCount * stride - offset) * 4);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_updateDisappear(): void {\r\n\t\tvar count: number = this._endIndex;\r\n\t\tfor (var i: number = this._activeIndex; i < count; i++) {\r\n\t\t\tif (this._owner._curtime - this._subBirthTime[i] >= this._owner.time + MathUtils3D.zeroTolerance) {\r\n\t\t\t\tvar nextIndex: number = i + 1;\r\n\t\t\t\tif (nextIndex !== count)\r\n\t\t\t\t\tthis._owner._totalLength -= this._subDistance[nextIndex];//\r\n\r\n\t\t\t\tif (this._isTempEndVertex && (nextIndex === count - 1)) {//\r\n\t\t\t\t\tvar fixedPos: Vector3 = this._lastFixedVertexPosition;\r\n\t\t\t\t\tfixedPos.x = this._vertices1[0];\r\n\t\t\t\t\tfixedPos.y = this._vertices1[1];\r\n\t\t\t\t\tfixedPos.z = this._vertices1[2];\r\n\t\t\t\t\tthis._isTempEndVertex = false;\r\n\t\t\t\t}\r\n\t\t\t\tthis._activeIndex++;\r\n\t\t\t\tthis._disappearBoundsMode = true;\r\n\t\t\t} else {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\t_getType(): number {\r\n\t\treturn TrailGeometry._type;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\t_prepareRender(state: RenderContext3D): boolean {\r\n\t\treturn this._endIndex - this._activeIndex > 1;//01\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\t_updateRenderParams(state: RenderContext3D): void {\r\n\t\t//this._bufferState.bind();\r\n\t\tthis.clearRenderParams();\r\n\t\tvar start: number = this._activeIndex * 2;\r\n\t\tvar count: number = this._endIndex * 2 - start;\r\n\t\tthis.setDrawArrayParams(start, count);\r\n\t\t// LayaGL.renderDrawConatext.drawArrays(MeshTopology.TriangleStrip,start,count);\r\n\t\t// Stat.trianglesFaces += count - 2;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tdestroy(): void {\r\n\t\tsuper.destroy();\r\n\t\tvar memorySize: number = this._vertexBuffer1._byteLength + this._vertexBuffer2._byteLength;\r\n\t\tResource._addMemory(-memorySize, -memorySize);\r\n\t\tthis.bufferState.destroy();\r\n\t\tthis._vertexBuffer1.destroy();\r\n\t\tthis._vertexBuffer2.destroy();\r\n\r\n\t\tthis.bufferState = null;\r\n\t\tthis._vertices1 = null;\r\n\t\tthis._vertexBuffer1 = null;\r\n\t\tthis._vertices2 = null;\r\n\t\tthis._vertexBuffer2 = null;\r\n\t\tthis._subBirthTime = null;\r\n\t\tthis._subDistance = null;\r\n\t\tthis._lastFixedVertexPosition = null;\r\n\t\tthis._disappearBoundsMode = false;\r\n\t}\r\n\r\n\tclear(): void {\r\n\t\tthis._activeIndex = 0;\r\n\t\tthis._endIndex = 0;\r\n\t\tthis._disappearBoundsMode = false;\r\n\t\tthis._subBirthTime.fill(0);\r\n\t\tthis._subDistance.fill(0);\r\n\t\tthis._segementCount = 0;\r\n\t\tthis._isTempEndVertex = false;\r\n\t\tthis._needAddFirstVertex = false;\r\n\t\tthis._lastFixedVertexPosition.setValue(0, 0, 0);\r\n\t}\r\n}\r\n\r\n","import { Camera } from \"../Camera\";\r\nimport { FloatKeyframe } from \"../FloatKeyframe\";\r\nimport { GeometryElement } from \"../GeometryElement\";\r\nimport { GradientMode } from \"../GradientMode\";\r\nimport { BaseRender } from \"../render/BaseRender\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { RenderElement } from \"../render/RenderElement\";\r\nimport { TrailGeometry } from \"./TrailGeometry\";\r\nimport { TrailMaterial } from \"./TrailMaterial\";\r\nimport { TrailRenderer } from \"./TrailRenderer\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { TrailAlignment } from \"./TrailAlignment\";\r\nimport { TrailTextureMode } from \"../TrailTextureMode\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Gradient } from \"../Gradient\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\n\r\n\r\n/**\r\n * <code>TrailFilter</code> \r\n */\r\nexport class TrailFilter {\r\n\tstatic CURTIME: number;\r\n\tstatic LIFETIME: number;\r\n\tstatic WIDTHCURVE: number;\r\n\tstatic WIDTHCURVEKEYLENGTH: number;\r\n\r\n\tstatic __init__() {\r\n\t\tTrailFilter.CURTIME = Shader3D.propertyNameToID(\"u_CurTime\");\r\n\t\tTrailFilter.LIFETIME = Shader3D.propertyNameToID(\"u_LifeTime\");\r\n\t\tTrailFilter.WIDTHCURVE = Shader3D.propertyNameToID(\"u_WidthCurve\");\r\n\t\tTrailFilter.WIDTHCURVEKEYLENGTH = Shader3D.propertyNameToID(\"u_WidthCurveKeyLength\");\r\n\r\n\t\tconst spriteParms = LayaGL.renderOBJCreate.createGlobalUniformMap(\"TrailRender\");\r\n\t\tspriteParms.addShaderUniform(TrailFilter.CURTIME, \"u_CurTime\", ShaderDataType.Float);\r\n\t\tspriteParms.addShaderUniform(TrailFilter.LIFETIME, \"u_LifeTime\", ShaderDataType.Float);\r\n\t\tspriteParms.addShaderUniform(TrailFilter.WIDTHCURVE, \"u_WidthCurve\", ShaderDataType.Buffer);\r\n\t\tspriteParms.addShaderUniform(TrailFilter.WIDTHCURVEKEYLENGTH, \"u_WidthCurveKeyLength\", ShaderDataType.Int);\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _minVertexDistance: number;\r\n\t/**@internal */\r\n\tprivate _widthMultiplier: number;\r\n\t/**@internal */\r\n\tprivate _time: number;\r\n\t/**@internal */\r\n\tprivate _widthCurve: FloatKeyframe[];\r\n\t/**@internal */\r\n\tprivate _colorGradient: Gradient;\r\n\t/**@internal */\r\n\tprivate _textureMode: TrailTextureMode = TrailTextureMode.Stretch;\r\n\t/**@internal */\r\n\tprivate _trialGeometry: GeometryElement;\r\n\t/**@internal */\r\n\t_totalLength: number = 0;\r\n\r\n\t_ownerRender: TrailRenderer;\r\n\t_lastPosition: Vector3 = new Vector3();\r\n\r\n\t_curtime: number = 0;\r\n\r\n\t/***/\r\n\talignment: TrailAlignment = TrailAlignment.View;\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget time(): number {\r\n\t\treturn this._time;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset time(value: number) {\r\n\t\tthis._time = value;\r\n\t\tthis._ownerRender._shaderValues.setNumber(TrailFilter.LIFETIME, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget minVertexDistance(): number {\r\n\t\treturn this._minVertexDistance;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset minVertexDistance(value: number) {\r\n\t\tthis._minVertexDistance = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget widthMultiplier(): number {\r\n\t\treturn this._widthMultiplier;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset widthMultiplier(value: number) {\r\n\t\tthis._widthMultiplier = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget widthCurve(): FloatKeyframe[] {\r\n\t\treturn this._widthCurve;\r\n\t}\r\n\r\n\t/**\r\n\t * 10\r\n\t * @param value \r\n\t */\r\n\tset widthCurve(value: FloatKeyframe[]) {\r\n\t\tthis._widthCurve = value;\r\n\t\tvar widthCurveFloatArray: Float32Array = new Float32Array(value.length * 4);\r\n\t\tvar i: number, j: number, index: number = 0;\r\n\t\tfor (i = 0, j = value.length; i < j; i++) {\r\n\t\t\twidthCurveFloatArray[index++] = value[i].time;\r\n\t\t\twidthCurveFloatArray[index++] = value[i].inTangent;\r\n\t\t\twidthCurveFloatArray[index++] = value[i].outTangent;\r\n\t\t\twidthCurveFloatArray[index++] = value[i].value;\r\n\t\t}\r\n\t\tthis._ownerRender._shaderValues.setBuffer(TrailFilter.WIDTHCURVE, widthCurveFloatArray);\r\n\t\tthis._ownerRender._shaderValues.setInt(TrailFilter.WIDTHCURVEKEYLENGTH, value.length);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget colorGradient(): Gradient {\r\n\t\treturn this._colorGradient;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset colorGradient(value: Gradient) {\r\n\t\tthis._colorGradient = value;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget textureMode(): TrailTextureMode {\r\n\t\treturn this._textureMode;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset textureMode(value: TrailTextureMode) {\r\n\t\tthis._textureMode = value;\r\n\t}\r\n\r\n\tconstructor(owner: TrailRenderer) {\r\n\t\tthis._ownerRender = owner;\r\n\t\tthis._initDefaultData();\r\n\t\tthis.addRenderElement();\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\taddRenderElement(): void {\r\n\t\tvar render: TrailRenderer = (<TrailRenderer>this._ownerRender);\r\n\t\tvar elements: RenderElement[] = render._renderElements;\r\n\t\tvar material: TrailMaterial = (<TrailMaterial>render.sharedMaterials[0]);\r\n\t\t(material) || (material = TrailMaterial.defaultMaterial);\r\n\t\tvar element: RenderElement = new RenderElement();\r\n\t\telement.setTransform((this._ownerRender.owner as Sprite3D)._transform);\r\n\t\telement.render = render;\r\n\t\telement.material = material;\r\n\t\tthis._trialGeometry = new TrailGeometry(this);\r\n\t\telement.setGeometry(this._trialGeometry);\r\n\t\telements.push(element);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_update(state: RenderContext3D): void {\r\n\t\tvar render: BaseRender = this._ownerRender;\r\n\t\tconst scene = this._ownerRender.owner.scene\r\n\t\tif (!scene)\r\n\t\t\treturn;\r\n\t\tthis._curtime += scene.timer._delta / 1000;\r\n\t\t//\r\n\t\trender._shaderValues.setNumber(TrailFilter.CURTIME, this._curtime);\r\n\t\t//\r\n\t\tvar curPos: Vector3 = (this._ownerRender.owner as Sprite3D).transform.position;\r\n\t\tvar element: TrailGeometry = (<TrailGeometry>render._renderElements[0]._geometry);\r\n\t\telement._updateDisappear();\r\n\t\telement._updateTrail((<Camera>state.camera), this._lastPosition, curPos);\r\n\t\telement._updateVertexBufferUV();\r\n\t\t//lastPosition\r\n\t\tcurPos.cloneTo(this._lastPosition);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_initDefaultData(): void {\r\n\t\tthis.time = 5.0;\r\n\t\tthis.minVertexDistance = 0.1;\r\n\t\tthis.widthMultiplier = 1;\r\n\t\tthis.textureMode = TrailTextureMode.Stretch;\r\n\r\n\t\tvar widthKeyFrames: FloatKeyframe[] = [];\r\n\t\tvar widthKeyFrame1: FloatKeyframe = new FloatKeyframe();\r\n\t\twidthKeyFrame1.time = 0;\r\n\t\twidthKeyFrame1.inTangent = 0;\r\n\t\twidthKeyFrame1.outTangent = 0;\r\n\t\twidthKeyFrame1.value = 1;\r\n\t\twidthKeyFrames.push(widthKeyFrame1);\r\n\t\tvar widthKeyFrame2: FloatKeyframe = new FloatKeyframe();\r\n\t\twidthKeyFrame2.time = 1;\r\n\t\twidthKeyFrame2.inTangent = 0;\r\n\t\twidthKeyFrame2.outTangent = 0;\r\n\t\twidthKeyFrame2.value = 1;\r\n\t\twidthKeyFrames.push(widthKeyFrame2);\r\n\t\tthis.widthCurve = widthKeyFrames;\r\n\r\n\t\tvar gradient: Gradient = new Gradient(2, 2);\r\n\t\tgradient.mode = GradientMode.Blend;\r\n\t\tgradient.addColorRGB(0, Color.WHITE);\r\n\t\tgradient.addColorRGB(1, Color.WHITE);\r\n\t\tgradient.addColorAlpha(0, 1);\r\n\t\tgradient.addColorAlpha(1, 1);\r\n\t\tthis.colorGradient = gradient;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tdestroy(): void {\r\n\t\tthis._trialGeometry.destroy();\r\n\t\tthis._trialGeometry = null;\r\n\t\tthis._widthCurve = null;\r\n\t\tthis._colorGradient = null;\r\n\t}\r\n\r\n\tclear(): void {\r\n\t\t(<TrailGeometry>this._trialGeometry).clear();\r\n\t\tthis._lastPosition.setValue(0, 0, 0);\r\n\t\tthis._curtime = 0;\r\n\t\tthis._totalLength = 0;\r\n\t}\r\n}\r\n\r\n","import { Sprite3D } from \"../Sprite3D\"\r\nimport { Transform3D } from \"../Transform3D\"\r\nimport { BaseRender } from \"../render/BaseRender\"\r\nimport { RenderContext3D } from \"../render/RenderContext3D\"\r\nimport { TrailFilter } from \"./TrailFilter\";\r\nimport { FloatKeyframe } from \"../FloatKeyframe\";\r\nimport { Gradient } from \"../Gradient\";\r\nimport { Component } from \"../../../components/Component\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { TrailTextureMode } from \"../TrailTextureMode\"\r\nimport { TrailAlignment } from \"./TrailAlignment\"\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\n\r\n/**\r\n * <code>TrailRenderer</code> \r\n */\r\nexport class TrailRenderer extends BaseRender {\r\n\r\n    /**@internal */\r\n    _trailFilter: TrailFilter;\r\n\r\n    protected _projectionViewWorldMatrix: Matrix4x4 = new Matrix4x4();\r\n\r\n    /**\r\n     * \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._supportOctree = false;\r\n\r\n    }\r\n\r\n    protected _getcommonUniformMap():Array<string>{\r\n        return [\"Sprite3D\",\"TrailRender\"];\r\n    }\r\n\r\n\r\n    protected _onAdded(): void {\r\n        this._trailFilter = new TrailFilter(this);\r\n    }\r\n\r\n    /**\r\n     * s\r\n     * @return  \r\n     */\r\n    get time(): number {\r\n        return this._trailFilter.time;\r\n    }\r\n\r\n    /**\r\n     * s\r\n     * @param value \r\n     */\r\n    set time(value: number) {\r\n        this._trailFilter.time = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return  \r\n     */\r\n    get minVertexDistance(): number {\r\n        return this._trailFilter.minVertexDistance;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value \r\n     */\r\n    set minVertexDistance(value: number) {\r\n        this._trailFilter.minVertexDistance = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return  \r\n     */\r\n    get widthMultiplier(): number {\r\n        return this._trailFilter.widthMultiplier;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value \r\n     */\r\n    set widthMultiplier(value: number) {\r\n        this._trailFilter.widthMultiplier = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return  \r\n     */\r\n    get widthCurve(): FloatKeyframe[] {\r\n        return this._trailFilter.widthCurve;\r\n    }\r\n\r\n    /**\r\n     * 10\r\n     * @param value \r\n     */\r\n    set widthCurve(value: FloatKeyframe[]) {\r\n        this._trailFilter.widthCurve = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return  \r\n     */\r\n    get colorGradient(): Gradient {\r\n        return this._trailFilter.colorGradient;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value \r\n     */\r\n    set colorGradient(value: Gradient) {\r\n        this._trailFilter.colorGradient = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return  \r\n     */\r\n    get textureMode(): TrailTextureMode {\r\n        return this._trailFilter.textureMode;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value \r\n     */\r\n    set textureMode(value: TrailTextureMode) {\r\n        this._trailFilter.textureMode = value;\r\n    }\r\n\r\n    get alignment(): TrailAlignment {\r\n        return this._trailFilter.alignment;\r\n    }\r\n\r\n    set alignment(value: TrailAlignment) {\r\n        this._trailFilter.alignment = value;\r\n    }\r\n\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n\r\n        (this.owner as Sprite3D)._transform.position.cloneTo(this._trailFilter._lastPosition);//\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this._calculateBoundingBox();\r\n    }\r\n\r\n    /**\r\n     * ,,\r\n     */\r\n    get bounds(): Bounds {\r\n        return this._bounds;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @internal\r\n     * @override\r\n     */\r\n    protected _calculateBoundingBox(): void {\r\n        let context = RenderContext3D._instance;\r\n        this.boundsChange = false;\r\n        this._trailFilter._update(context);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @internal\r\n     * @override\r\n     */\r\n    _renderUpdate(state: RenderContext3D, transform: Transform3D): void {\r\n        super._renderUpdate(state, transform);\r\n    }\r\n\r\n    clear(): void {\r\n        this._trailFilter.clear();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onDestroy() {\r\n        this._trailFilter.destroy();\r\n        super._onDestroy();\r\n    }\r\n\r\n    _cloneTo(dest: Component): void {\r\n        super._cloneTo(dest);\r\n        let render = dest as TrailRenderer;\r\n        render.time = this.time;\r\n        render.minVertexDistance = this.minVertexDistance;\r\n        //render.widthCurve = this.widthCurve;\r\n        var widthCurve: FloatKeyframe[] = [];\r\n        var widthCurveData: any[] = this.widthCurve;\r\n        for (let i = 0, n = this.widthCurve.length; i < n; i++) {\r\n            widthCurve.push(widthCurveData[i].clone());\r\n        }\r\n        render.widthCurve = widthCurve;\r\n        render.colorGradient = this.colorGradient.clone();\r\n        render.textureMode = this.textureMode;\r\n        render.alignment = this.alignment;\r\n    }\r\n\r\n}\r\n\r\n","import { TrailFilter } from \"./TrailFilter\";\r\nimport { TrailRenderer } from \"./TrailRenderer\";\r\nimport { FloatKeyframe } from \"../FloatKeyframe\"\r\nimport { Gradient } from \"../Gradient\"\r\nimport { RenderableSprite3D } from \"../RenderableSprite3D\"\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { Node } from \"../../../display/Node\"\r\nimport { Loader } from \"../../../net/Loader\"\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Color } from \"../../../maths/Color\";\r\n\r\n/**\r\n * <code>TrailSprite3D</code> \r\n */\r\nexport class TrailSprite3D extends RenderableSprite3D {\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void { }\r\n\r\n\t/** @internal */\r\n\tprivate _geometryFilter: TrailFilter;\r\n\r\n\t/**\r\n\t * Trail\r\n\t */\r\n\tget trailFilter(): TrailFilter {\r\n\t\treturn (<TrailFilter>this._geometryFilter);\r\n\t}\r\n\r\n\t/**\r\n\t * Trail\r\n\t */\r\n\tget trailRenderer(): TrailRenderer {\r\n\t\treturn (<TrailRenderer>this._render);\r\n\t}\r\n\r\n\tconstructor(name: string = null) {\r\n\t\tsuper(name);\r\n\t\tthis._render = this.addComponent(TrailRenderer);\r\n\t\tthis._geometryFilter = (this._render as TrailRenderer)._trailFilter;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_parse(data: any, spriteMap: any): void {\r\n\t\tsuper._parse(data, spriteMap);\r\n\t\tvar render: TrailRenderer = (<TrailRenderer>this._render);\r\n\t\tvar filter: TrailFilter = (<TrailFilter>this._geometryFilter);\r\n\t\tvar i: number, j: number;\r\n\t\tvar materials: any[] = data.materials;\r\n\t\tif (materials) {\r\n\t\t\tvar sharedMaterials: Material[] = render.sharedMaterials;\r\n\t\t\tvar materialCount: number = materials.length;\r\n\t\t\tsharedMaterials.length = materialCount;\r\n\t\t\tfor (i = 0; i < materialCount; i++)\r\n\t\t\t\tsharedMaterials[i] = Loader.getRes(materials[i].path);\r\n\t\t\trender.sharedMaterials = sharedMaterials;\r\n\t\t}\r\n\t\t//\r\n\t\tfilter.time = data.time;\r\n\t\t//\r\n\t\tfilter.minVertexDistance = data.minVertexDistance;\r\n\t\tfilter.widthMultiplier = data.widthMultiplier;\r\n\t\tfilter.textureMode = data.textureMode;\r\n\t\t(data.alignment != null) && (filter.alignment = data.alignment);\r\n\t\t//widthCurve\r\n\t\tvar widthCurve: FloatKeyframe[] = [];\r\n\t\tvar widthCurveData: any[] = data.widthCurve;\r\n\t\tfor (i = 0, j = widthCurveData.length; i < j; i++) {\r\n\t\t\tvar trailkeyframe: FloatKeyframe = new FloatKeyframe();\r\n\t\t\ttrailkeyframe.time = widthCurveData[i].time;\r\n\t\t\ttrailkeyframe.inTangent = widthCurveData[i].inTangent;\r\n\t\t\ttrailkeyframe.outTangent = widthCurveData[i].outTangent;\r\n\t\t\ttrailkeyframe.value = widthCurveData[i].value;\r\n\t\t\twidthCurve.push(trailkeyframe);\r\n\t\t}\r\n\t\tfilter.widthCurve = widthCurve;\r\n\t\t//colorGradient\r\n\t\tvar colorGradientData: any = data.colorGradient;\r\n\t\tvar colorKeys: any[] = colorGradientData.colorKeys;\r\n\t\tvar alphaKeys: any[] = colorGradientData.alphaKeys;\r\n\t\tvar colorGradient: Gradient = new Gradient(colorKeys.length, alphaKeys.length);\r\n\t\tcolorGradient.mode = colorGradientData.mode;\r\n\r\n\t\tfor (i = 0, j = colorKeys.length; i < j; i++) {\r\n\t\t\tvar colorKey: any = colorKeys[i];\r\n\t\t\tcolorGradient.addColorRGB(colorKey.time, new Color(colorKey.value[0], colorKey.value[1], colorKey.value[2], 1.0));\r\n\t\t}\r\n\r\n\t\tfor (i = 0, j = alphaKeys.length; i < j; i++) {\r\n\t\t\tvar alphaKey: any = alphaKeys[i];\r\n\t\t\tcolorGradient.addColorAlpha(alphaKey.time, alphaKey.value);\r\n\t\t}\r\n\t\tfilter.colorGradient = colorGradient;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_cloneTo(destObject: any, srcSprite: Node, dstSprite: Node): void {\r\n\t\tsuper._cloneTo(destObject, srcSprite, dstSprite);\r\n\t}\r\n\r\n\tclear(): void {\r\n\t\t(this._render as TrailRenderer).clear();\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Node {\r\n\t\treturn new Sprite3D();\r\n\t}\r\n}\r\n\r\n","import { GeometryElement } from \"../core/GeometryElement\";\r\nimport { RenderContext3D } from \"../core/render/RenderContext3D\";\r\nimport { SubMeshRenderElement } from \"../core/render/SubMeshRenderElement\";\r\nimport { SubMesh } from \"../resource/models/SubMesh\";\r\nimport { VertexBuffer3D } from \"./VertexBuffer3D\";\r\nimport { BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { MeshTopology } from \"../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { DrawType } from \"../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { VertexMesh } from \"../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * \r\n * @internal\r\n */\r\nexport class SubMeshInstanceBatch extends GeometryElement {\r\n\t/** @internal */\r\n\tstatic instance: SubMeshInstanceBatch;\r\n\t/** @internal */\r\n\tstatic maxInstanceCount: number = 1024;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tSubMeshInstanceBatch.instance = new SubMeshInstanceBatch();\r\n\t}\r\n\r\n\t/** @internal */\r\n\tinstanceWorldMatrixData: Float32Array = new Float32Array(SubMeshInstanceBatch.maxInstanceCount * 16);\r\n\t/** @internal */\r\n\tinstanceWorldMatrixBuffer: VertexBuffer3D;\r\n\t/**SimpleAnimator */\r\n\t/** @internal */\r\n\tinstanceSimpleAnimatorData: Float32Array = new Float32Array(SubMeshInstanceBatch.maxInstanceCount * 4);\r\n\t/** @internal */\r\n\tinstanceSimpleAnimatorBuffer: VertexBuffer3D;\r\n\r\n\t/**\r\n\t *  <code>InstanceSubMesh</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper(MeshTopology.Triangles, DrawType.DrawElementInstance);\r\n\t\tthis.indexFormat = IndexFormat.UInt16;\r\n\t\tthis.instanceWorldMatrixBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(this.instanceWorldMatrixData.length * 4, BufferUsage.Dynamic, false);\r\n\t\tthis.instanceWorldMatrixBuffer.vertexDeclaration = VertexMesh.instanceWorldMatrixDeclaration;\r\n\t\tthis.instanceWorldMatrixBuffer.instanceBuffer = true;\r\n\t\t//SImpleAnimator\r\n\t\tthis.instanceSimpleAnimatorBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(this.instanceSimpleAnimatorData.length * 4, BufferUsage.Dynamic, false);\r\n\t\tthis.instanceSimpleAnimatorBuffer.vertexDeclaration = VertexMesh.instanceSimpleAnimatorDeclaration;\r\n\t\tthis.instanceSimpleAnimatorBuffer.instanceBuffer = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\t_updateRenderParams(state: RenderContext3D): void {\r\n\t\tvar element: SubMeshRenderElement = (<SubMeshRenderElement>state.renderElement);\r\n\t\tvar subMesh: SubMesh = element.instanceSubMesh;\r\n\t\tvar count: number = element.instanceBatchElementList.length;\r\n\t\tvar indexCount: number = subMesh._indexCount;\r\n\t\t//subMesh._mesh._instanceBufferState.bind();\r\n\t\tthis.clearRenderParams();\r\n\t\tthis.bufferState = subMesh._mesh._instanceBufferState;\r\n\t\tthis.instanceCount = count;\r\n\t\tthis.setDrawElemenParams(indexCount, subMesh._indexStart * 2);\r\n\t\t//LayaGL.renderDrawConatext.drawElementsInstanced(MeshTopology.Triangles, indexCount, IndexFormat.UInt16, subMesh._indexStart * 2, count);\r\n\t\t//Stat.renderBatches++;\r\n\t\t//Stat.savedRenderBatches += count - 1;\r\n\t\t//Stat.trianglesFaces += indexCount * count / 3;\r\n\t}\r\n\r\n\r\n}\r\n\r\n","import { IVertex } from \"../IVertex\"\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\"\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\n\r\n/**\r\n * @internal\r\n * <code>VertexPositionTerrain</code> 12\r\n */\r\nexport class VertexPositionTerrain implements IVertex {\r\n\tstatic TERRAIN_POSITION0: number = 0;\r\n\tstatic TERRAIN_NORMAL0: number = 1;\r\n\tstatic TERRAIN_TEXTURECOORDINATE0: number = 2;\r\n\tstatic TERRAIN_TEXTURECOORDINATE1: number = 3;\r\n\r\n\tprivate static _vertexDeclaration: VertexDeclaration;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tVertexPositionTerrain._vertexDeclaration = new VertexDeclaration(40, [new VertexElement(0, VertexElementFormat.Vector3, VertexPositionTerrain.TERRAIN_POSITION0),\r\n\t\tnew VertexElement(12, VertexElementFormat.Vector3, VertexPositionTerrain.TERRAIN_NORMAL0),\r\n\t\tnew VertexElement(24, VertexElementFormat.Vector2, VertexPositionTerrain.TERRAIN_TEXTURECOORDINATE0),\r\n\t\tnew VertexElement(32, VertexElementFormat.Vector2, VertexPositionTerrain.TERRAIN_TEXTURECOORDINATE1)]);\r\n\t}\r\n\r\n\tstatic get vertexDeclaration(): VertexDeclaration {\r\n\t\treturn VertexPositionTerrain._vertexDeclaration;\r\n\t}\r\n\r\n\tprivate _position: Vector3;\r\n\tprivate _normal: Vector3;\r\n\tprivate _textureCoord0: Vector2;\r\n\tprivate _textureCoord1: Vector2;\r\n\r\n\tget position(): Vector3 {\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tget normal(): Vector3 {\r\n\t\treturn this._normal;\r\n\t}\r\n\r\n\tget textureCoord0(): Vector2 {\r\n\t\treturn this._textureCoord0;\r\n\t}\r\n\r\n\tget textureCoord1(): Vector2 {\r\n\t\treturn this._textureCoord1;\r\n\t}\r\n\r\n\tget vertexDeclaration(): VertexDeclaration {\r\n\t\treturn VertexPositionTerrain._vertexDeclaration;\r\n\t}\r\n\r\n\tconstructor(position: Vector3, normal: Vector3, textureCoord0: Vector2, textureCoord1: Vector2) {\r\n\t\tthis._position = position;\r\n\t\tthis._normal = normal;\r\n\t\tthis._textureCoord0 = textureCoord0;\r\n\t\tthis._textureCoord1 = textureCoord1;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { ILaya3D } from \"../../../../ILaya3D\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { DefineDatas } from \"../../../RenderEngine/RenderShader/DefineDatas\";\r\nimport { ShaderInstance } from \"../../../RenderEngine/RenderShader/ShaderInstance\";\r\nimport { ShaderPass } from \"../../../RenderEngine/RenderShader/ShaderPass\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { MeshInstanceGeometry } from \"../../graphics/MeshInstanceGeometry\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { InstanceRenderElementOBJ } from \"../../RenderObjs/RenderObj/InstanceRenderElementOBJ\";\r\nimport { Mesh } from \"../../resource/models/Mesh\";\r\nimport { Camera } from \"../Camera\";\r\nimport { MeshSprite3DShaderDeclaration } from \"../MeshSprite3DShaderDeclaration\";\r\nimport { RenderableSprite3D } from \"../RenderableSprite3D\";\r\nimport { SimpleSkinnedMeshRenderer } from \"../SimpleSkinnedMeshRenderer\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Transform3D } from \"../Transform3D\";\r\nimport { BaseRender } from \"./BaseRender\";\r\nimport { RenderContext3D } from \"./RenderContext3D\";\r\nimport { RenderElement } from \"./RenderElement\";\r\n\r\nexport class InstanceRenderElement extends RenderElement {\r\n    /** @internal */\r\n    static maxInstanceCount: number = 1024;\r\n    /**@internal */\r\n    private static _pool: InstanceRenderElement[] = [];\r\n\r\n    static create(): InstanceRenderElement {\r\n        let elemet = InstanceRenderElement._pool.length > 0 ? InstanceRenderElement._pool.pop() : new InstanceRenderElement();\r\n        elemet._isInPool = false;\r\n        elemet.clear();\r\n        return elemet;\r\n    }\r\n    /**@internal */\r\n    _instanceBatchElementList: SingletonList<RenderElement>\r\n    /**@internal */\r\n    _isInPool: boolean;\r\n    /**\r\n     * @internal\r\n     *  \r\n     * */\r\n    _isUpdataData: boolean;\r\n    /** @internal */\r\n    _invertFrontFace: boolean;\r\n    /**@internal recover renderData*/\r\n    private oriRendertype: number;\r\n    /**@internal */\r\n    private _InvertFront: boolean = false;\r\n\r\n    constructor() {\r\n        super();\r\n        this.setGeometry(new MeshInstanceGeometry(null));\r\n        this._instanceBatchElementList = new SingletonList();\r\n        this._isUpdataData = true;\r\n        this._invertFrontFace = false;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    getInvertFront(): boolean {\r\n        return this._invertFrontFace;\r\n    }\r\n\r\n    set InvertFront(value: boolean) {\r\n        this._InvertFront = value;\r\n\r\n    }\r\n\r\n    protected _createRenderElementOBJ() {\r\n        this._renderElementOBJ = Laya3DRender.renderOBJCreate.createInstanceRenderElement();\r\n    }\r\n\r\n    compileShader(context: IRenderContext3D) {\r\n        var passes: ShaderPass[] = this._subShader._passes;\r\n        this._renderElementOBJ._clearShaderInstance();\r\n        for (var j: number = 0, m: number = passes.length; j < m; j++) {\r\n            var pass: ShaderPass = passes[j];\r\n            //NOTE:this will cause maybe a shader not render but do prepare beforebut the developer can avoide this manual,for example shaderCaster=false.\r\n            if (pass._pipelineMode !== context.pipelineMode)\r\n                continue;\r\n            var comDef: DefineDatas = RenderElement._compileDefine;\r\n\r\n            // todo\r\n            context.sceneShaderData._defineDatas.cloneTo(comDef);\r\n            if (this.render) {\r\n                comDef.addDefineDatas(this.render._shaderValues._defineDatas);\r\n                pass.nodeCommonMap = this.render._commonUniformMap;\r\n            } else {\r\n                pass.nodeCommonMap = null;\r\n            }\r\n\r\n\r\n            comDef.addDefineDatas(this._renderElementOBJ._materialShaderData._defineDatas);\r\n            //add Instance Define\r\n            comDef.add(MeshSprite3DShaderDeclaration.SHADERDEFINE_GPU_INSTANCE);\r\n\r\n            var shaderIns: ShaderInstance = pass.withCompile(comDef);\r\n            this._renderElementOBJ._addShaderInstance(shaderIns);\r\n        }\r\n    }\r\n\r\n\r\n    _renderUpdatePre(context: RenderContext3D) {\r\n        var sceneMark: number = ILaya3D.Scene3D._updateMark;\r\n        var transform: Transform3D = this.transform;\r\n        context.renderElement = this;\r\n        //model local\r\n        var modelDataRender: boolean = (!!this.render) ? (sceneMark !== this.render._sceneUpdateMark || this.renderType !== this.render._updateRenderType) : false;\r\n        if (modelDataRender) {\r\n            this.render._renderUpdate(context, transform);\r\n            this.render._sceneUpdateMark = sceneMark;\r\n        }\r\n        //camera\r\n        var updateMark: number = Camera._updateMark;\r\n        if (true) {//\r\n            this.render._renderUpdateWithCamera(context, transform);\r\n            this.oriRendertype = this.render._updateRenderType\r\n            this.render._updateMark = updateMark;\r\n            this.render._updateRenderType = this.renderType;\r\n            if (this._isUpdataData) {\r\n                let mesh = (this._geometry as MeshInstanceGeometry).subMesh._mesh;\r\n                this.updateInstanceData(mesh);\r\n                this._isUpdataData = false;\r\n            }\r\n        }\r\n\r\n        const subUbo = (!!this.render) ? this.render._subUniformBufferData : false;\r\n        if (subUbo) {\r\n            subUbo._needUpdate && BaseRender._transLargeUbO.updateSubData(subUbo);\r\n        }\r\n        this._renderElementOBJ._isRender = this._geometry._prepareRender(context);\r\n        this._geometry._updateRenderParams(context);\r\n        this.compileShader(context._contextOBJ);\r\n        this._geometry.instanceCount = this._instanceBatchElementList.length;\r\n        this._renderElementOBJ._invertFront = this.getInvertFront();\r\n    }\r\n\r\n    updateInstanceData(mesh: Mesh) {\r\n        mesh._setInstanceBuffer();\r\n        (this._renderElementOBJ as InstanceRenderElementOBJ).clear();\r\n        this._geometry.bufferState = mesh._instanceBufferState;\r\n        switch (mesh._instanceBufferStateType) {\r\n            case Mesh.MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR:\r\n                //worldMatrix\r\n                var worldMatrixData: Float32Array = (this._renderElementOBJ as InstanceRenderElementOBJ).getUpdateData(0, 16 * InstanceRenderElement.maxInstanceCount);\r\n                (this._renderElementOBJ as InstanceRenderElementOBJ).addUpdateBuffer(mesh._instanceWorldVertexBuffer, 16);\r\n                var insBatches = this._instanceBatchElementList;\r\n                var elements = insBatches.elements;\r\n                var count: number = insBatches.length;\r\n                (this._renderElementOBJ as InstanceRenderElementOBJ).drawCount = count;\r\n                let bone = (elements[0].render as SimpleSkinnedMeshRenderer).rootBone;\r\n                if (bone) {\r\n                    for (var i: number = 0; i < count; i++) {\r\n                        var mat: Matrix4x4 = (((elements[i].render) as SimpleSkinnedMeshRenderer).rootBone as Sprite3D)._transform.worldMatrix;\r\n                        worldMatrixData.set(mat.elements, i * 16);\r\n                    }\r\n                }\r\n                else {\r\n                    for (var i: number = 0; i < count; i++)\r\n                        worldMatrixData.set(elements[i].transform.worldMatrix.elements, i * 16);\r\n                }\r\n                //simpleAnimationData\r\n                var simpleAnimatorData: Float32Array = (this._renderElementOBJ as InstanceRenderElementOBJ).getUpdateData(1, 4 * InstanceRenderElement.maxInstanceCount);\r\n                if (bone) {\r\n                    for (var i: number = 0; i < count; i++) {\r\n                        var render: SimpleSkinnedMeshRenderer = (elements[i].render) as SimpleSkinnedMeshRenderer;\r\n                        render._computeAnimatorParamsData();\r\n                        var simpleAnimatorParams: Vector4 = render._simpleAnimatorParams;\r\n                        var offset: number = i * 4;\r\n                        simpleAnimatorData[offset] = simpleAnimatorParams.x;\r\n                        simpleAnimatorData[offset + 1] = simpleAnimatorParams.y;\r\n                    }\r\n                }\r\n                else {\r\n                    for (var i: number = 0; i < count; i++) {\r\n                        simpleAnimatorData[offset] = 0;\r\n                        simpleAnimatorData[offset + 1] = 0;\r\n                    }\r\n                }\r\n                (this._renderElementOBJ as InstanceRenderElementOBJ).addUpdateBuffer(mesh._instanceSimpleAniVertexBuffer, 4)\r\n                break;\r\n            case Mesh.MESH_INSTANCEBUFFER_TYPE_NORMAL:\r\n\r\n                var worldMatrixData: Float32Array = (this._renderElementOBJ as InstanceRenderElementOBJ).getUpdateData(0, 16 * InstanceRenderElement.maxInstanceCount);\r\n                (this._renderElementOBJ as InstanceRenderElementOBJ).addUpdateBuffer(mesh._instanceWorldVertexBuffer, 16);\r\n                var insBatches = this._instanceBatchElementList;\r\n                var elements: RenderElement[] = insBatches.elements;\r\n                var count: number = insBatches.length;\r\n                (this._renderElementOBJ as InstanceRenderElementOBJ).drawCount = count;\r\n                for (var i: number = 0; i < count; i++)\r\n                    worldMatrixData.set(elements[i].transform.worldMatrix.elements, i * 16);\r\n\r\n                let haveLightMap: boolean = this.render._shaderValues.hasDefine(RenderableSprite3D.SAHDERDEFINE_LIGHTMAP);\r\n                if (haveLightMap && mesh._instanceLightMapVertexBuffer) {\r\n                    var lightMapData: Float32Array = (this._renderElementOBJ as InstanceRenderElementOBJ).getUpdateData(1, 4 * InstanceRenderElement.maxInstanceCount);\r\n                    for (var i: number = 0; i < count; i++) {\r\n                        let lightmapScaleOffset = elements[i]._baseRender.lightmapScaleOffset;\r\n                        var offset: number = i * 4;\r\n                        lightMapData[offset] = lightmapScaleOffset.x;\r\n                        lightMapData[offset + 1] = lightmapScaleOffset.y;\r\n                        lightMapData[offset + 2] = lightmapScaleOffset.z;\r\n                        lightMapData[offset + 3] = lightmapScaleOffset.w;\r\n                    }\r\n                    (this._renderElementOBJ as InstanceRenderElementOBJ).addUpdateBuffer(mesh._instanceLightMapVertexBuffer, 4)\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    clear() {\r\n        this._instanceBatchElementList.length = 0;\r\n    }\r\n    recover(): void {\r\n        InstanceRenderElement._pool.push(this);\r\n        this.render._updateRenderType = this.oriRendertype;\r\n        this._isInPool = true;\r\n    }\r\n}","import { GeometryElement } from \"../../core/GeometryElement\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Mesh } from \"./Mesh\";\r\nimport { RenderCapable } from \"../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { SkinnedMeshRenderer } from \"../../core/SkinnedMeshRenderer\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\n\r\n\r\n/**\r\n * <code>SubMesh</code> \r\n */\r\nexport class SubMesh extends GeometryElement {\r\n\r\n\t/**@internal */\r\n\tprivate static _type: number = GeometryElement._typeCounter++;\r\n\r\n\t/** @internal */\r\n\t_mesh: Mesh;\r\n\r\n\t/** @internal */\r\n\t_boneIndicesList: Uint16Array[];\r\n\t/** @internal */\r\n\t_subIndexBufferStart: number[];\r\n\t/** @internal */\r\n\t_subIndexBufferCount: number[];\r\n\r\n\t/** @internal */\r\n\t_indexInMesh: number;\r\n\t/** @internal */\r\n\t_indexStart: number;\r\n\t/** @internal */\r\n\t_indexCount: number;\r\n\t/** @internal */\r\n\t_indices: Uint16Array | Uint32Array;\r\n\t/**@internal []*/\r\n\t_vertexBuffer: VertexBuffer3D;\r\n\t/**@internal []*/\r\n\t_indexBuffer: IndexBuffer3D;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget indexCount(): number {\r\n\t\treturn this._indexCount;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SubMesh</code> \r\n\t * @param\tmesh  \r\n\t */\r\n\tconstructor(mesh: Mesh) {\r\n\t\tsuper(MeshTopology.Triangles, DrawType.DrawElement);\r\n\t\tthis.indexFormat = mesh.indexFormat;\r\n\t\tif (mesh.indexFormat === IndexFormat.UInt32 && !LayaGL.renderEngine.getCapable(RenderCapable.Element_Index_Uint32)) {\r\n\t\t\tconsole.warn(\"SubMesh:this device do not support IndexFormat.UInt32.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._mesh = mesh;\r\n\t\tthis._boneIndicesList = [];\r\n\t\tthis._subIndexBufferStart = [];\r\n\t\tthis._subIndexBufferCount = [];\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setIndexRange(indexStart: number, indexCount: number, indexFormat: IndexFormat = IndexFormat.UInt16): void {\r\n\t\tthis._indexStart = indexStart;\r\n\t\tthis._indexCount = indexCount;\r\n\t\tif (this._indexBuffer.canRead) {\r\n\t\t\tif (indexFormat == IndexFormat.UInt16) {\r\n\t\t\t\tthis._indices = new Uint16Array(this._indexBuffer.getData().buffer, indexStart * 2, indexCount);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._indices = new Uint32Array(this._indexBuffer.getData().buffer, indexStart * 4, indexCount);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\t_getType(): number {\r\n\t\treturn SubMesh._type;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\t_prepareRender(state: RenderContext3D): boolean {\r\n\t\tthis._mesh._uploadVerticesData();\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\t_updateRenderParams(state: RenderContext3D): void {\r\n\t\tvar mesh: Mesh = this._mesh;\r\n\r\n\t\tvar skinnedDatas: any[] = (state.renderElement && !!(state.renderElement.render)) ? (<SkinnedMeshRenderer>state.renderElement.render)._skinnedData : null;\r\n\t\tvar byteCount: number;\r\n\t\tswitch (mesh._indexFormat) {\r\n\t\t\tcase IndexFormat.UInt32:\r\n\t\t\t\tbyteCount = 4;\r\n\t\t\t\tbreak;\r\n\t\t\tcase IndexFormat.UInt16:\r\n\t\t\t\tbyteCount = 2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase IndexFormat.UInt8:\r\n\t\t\t\tbyteCount = 1;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tthis.clearRenderParams();\r\n\t\tthis.bufferState = mesh._bufferState;\r\n\t\tif (skinnedDatas) {\r\n\t\t\tfor (var i: number = 0, n: number = this._boneIndicesList.length; i < n; i++) {\r\n\t\t\t\tthis.setDrawElemenParams(this._subIndexBufferCount[i], this._subIndexBufferStart[i] * byteCount);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.setDrawElemenParams(this._indexCount, this._indexStart * byteCount);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tgetIndices(): Uint16Array | Uint32Array {\r\n\t\tif (this._mesh._isReadable)\r\n\t\t\treturn this._indices.slice();\r\n\t\telse\r\n\t\t\tthrow \"SubMesh:can't get indices on subMesh,mesh's isReadable must be true.\";\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param indices \r\n\t */\r\n\tsetIndices(indices: Uint16Array): void {\r\n\t\tthis._indexBuffer.setData(indices, this._indexStart, 0, this._indexCount);\r\n\t}\r\n\r\n\t/**\r\n\t * {@inheritDoc GeometryElement.destroy}\r\n\t * @override\r\n\t */\r\n\tdestroy(): void {\r\n\t\tif (this._destroyed)\r\n\t\t\treturn;\r\n\t\tsuper.destroy();\r\n\t\tthis._indexBuffer.destroy();\r\n\t\tthis._indexBuffer = null;\r\n\t\tthis._mesh = null;\r\n\t\tthis._boneIndicesList = null;\r\n\t\tthis._subIndexBufferStart = null;\r\n\t\tthis._subIndexBufferCount = null;\r\n\t}\r\n}\r\n\r\n","import { ILaya } from \"../../../../ILaya\";\r\nimport { Loader } from \"../../../net/Loader\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { Resource } from \"../../../resource/Resource\";\r\nimport { Handler } from \"../../../utils/Handler\";\r\nimport { IClone } from \"../../../utils/IClone\";\r\nimport { InstanceRenderElement } from \"../../core/render/InstanceRenderElement\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { SubMesh } from \"./SubMesh\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { MorphTargetData } from \"./MorphTargetData\";\r\nimport { Config } from \"../../../../Config\";\r\nimport { Laya3D } from \"../../../../Laya3D\";\r\nimport { EPhysicsCapable } from \"../../../Physics3D/physicsEnum/EPhycisCapable\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\n/**\r\n * @internal\r\n */\r\nexport class skinnedMatrixCache {\r\n    readonly subMeshIndex: number;\r\n    readonly batchIndex: number;\r\n    readonly batchBoneIndex: number;\r\n    constructor(subMeshIndex: number, batchIndex: number, batchBoneIndex: number) {\r\n        this.subMeshIndex = subMeshIndex;\r\n        this.batchIndex = batchIndex;\r\n        this.batchBoneIndex = batchBoneIndex;\r\n    }\r\n}\r\n\r\n/**\r\n * <code>Mesh</code> \r\n */\r\nexport class Mesh extends Resource implements IClone {\r\n\r\n    static MESH_INSTANCEBUFFER_TYPE_NORMAL: number = 0;\r\n\r\n    static MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR: number = 1;\r\n\r\n    /** @internal */\r\n    private _tempVector30: Vector3 = new Vector3()\r\n    /** @internal */\r\n    private _tempVector31: Vector3 = new Vector3();\r\n    // /** @internal */\r\n    // private _tempVector32: Vector3 = new Vector3();\r\n    // /** @internal */\r\n    // private static _nativeTempVector30: number;\r\n    // /** @internal */\r\n    // private static _nativeTempVector31: number;\r\n    // /** @internal */\r\n    // private static _nativeTempVector32: number;\r\n    /**@internal */\r\n    _convexMesh: any;\r\n    /**@interanl */\r\n    _triangleMesh: any;\r\n    /**@internal */\r\n    __convexMesh: Mesh;\r\n    /**\r\n      * @internal\r\n      */\r\n    static __init__(): void {\r\n        // var physics3D: any = Physics3D._bullet;\r\n        // if (physics3D) {\r\n        //     Mesh._nativeTempVector30 = physics3D.btVector3_create(0, 0, 0);\r\n        //     Mesh._nativeTempVector31 = physics3D.btVector3_create(0, 0, 0);\r\n        //     Mesh._nativeTempVector32 = physics3D.btVector3_create(0, 0, 0);\r\n        // }\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param url \r\n     * @param complete \r\n     */\r\n    static load(url: string, complete: Handler): void {\r\n        ILaya.loader.load(url, complete, null, Loader.MESH);\r\n    }\r\n\r\n    /** @internal */\r\n    private _btTriangleMesh: number;\r\n    /** @internal */\r\n    private _minVerticesUpdate: number = -1;\r\n    /** @internal */\r\n    private _maxVerticesUpdate: number = -1;\r\n    /** @internal */\r\n    private _needUpdateBounds: boolean = true;\r\n    /** @internal */\r\n    private _bounds: Bounds;\r\n\r\n    /** @internal */\r\n    _isReadable: boolean;\r\n    /** @internal */\r\n    _bufferState: BufferState = new BufferState();\r\n    /** @internal */\r\n    _instanceBufferState: BufferState;\r\n    /** @internal */\r\n    _instanceBufferStateType: number = 0;\r\n    /**@internal */\r\n    _instanceWorldVertexBuffer: VertexBuffer3D\r\n    /**@internal */\r\n    _instanceSimpleAniVertexBuffer: VertexBuffer3D\r\n    /**@internal */\r\n    _instanceLightMapVertexBuffer: VertexBuffer3D\r\n    /** @internal */\r\n    _subMeshes: SubMesh[];\r\n    /** @internal */\r\n    _vertexBuffer: VertexBuffer3D = null;\r\n    /** @internal */\r\n    _indexBuffer: IndexBuffer3D = null;\r\n\r\n    /** @internal */\r\n    _boneNames: string[];\r\n    /** @internal */\r\n    _inverseBindPoses: Matrix4x4[];\r\n    /** @internal */\r\n    _skinnedMatrixCaches: skinnedMatrixCache[] = [];\r\n    /** @internal */\r\n    _vertexCount: number = 0;\r\n    /** @internal */\r\n    _indexFormat: IndexFormat = IndexFormat.UInt16;\r\n\r\n    /** @internal */\r\n    instanceWorldMatrixData: Float32Array;\r\n    /** @internal */\r\n    instanceSimpleAnimatorData: Float32Array;\r\n    /** @internal */\r\n    instanceLightMapScaleOffsetData: Float32Array;\r\n\r\n    morphTargetData: MorphTargetData;\r\n\r\n    /** @internal */\r\n    _width: number;\r\n\r\n    /** @internal */\r\n    _height: number;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get inverseAbsoluteBindPoses(): Matrix4x4[] {\r\n        return this._inverseBindPoses;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get vertexCount(): number {\r\n        return this._vertexCount;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get indexCount(): number {\r\n        return this._indexBuffer.indexCount;\r\n    }\r\n\r\n    /**\r\n     * SubMesh\r\n     */\r\n    get subMeshCount(): number {\r\n        return this._subMeshes.length;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get bounds(): Bounds {\r\n        return this._bounds;\r\n    }\r\n\r\n    set bounds(value: Bounds) {\r\n        if (this._bounds !== value)\r\n            value.cloneTo(this._bounds);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get indexFormat(): IndexFormat {\r\n        return this._indexFormat;\r\n    }\r\n\r\n\r\n    /**\r\n     * indexformat\r\n     */\r\n    set indexFormat(value: IndexFormat) {\r\n        this._indexFormat = value\r\n        this._subMeshes.forEach(element => {\r\n            element.indexFormat = value;\r\n        });\r\n    }\r\n\r\n    /**\r\n     *  <code>Mesh</code> ,\r\n     * @param isReadable \r\n     */\r\n    constructor(isReadable: boolean = true) {\r\n        super();\r\n        this._bounds = new Bounds(new Vector3(), new Vector3());\r\n        this._isReadable = isReadable;\r\n        this._subMeshes = [];\r\n        this.destroyedImmediately = Config.destroyResourceImmediatelyDefault;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _getPositionElement(vertexBuffer: VertexBuffer3D): VertexElement {\r\n        var vertexElements: any[] = vertexBuffer.vertexDeclaration._vertexElements;\r\n        for (var i: number = 0, n: number = vertexElements.length; i < n; i++) {\r\n            var vertexElement: VertexElement = vertexElements[i];\r\n            if (vertexElement._elementFormat === VertexElementFormat.Vector3 && vertexElement._elementUsage === VertexMesh.MESH_POSITION0)\r\n                return vertexElement;\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _getVerticeElementData(data: Array<Vector2 | Vector3 | Vector4 | Color>, elementUsage: number): void {\r\n        data.length = this._vertexCount;\r\n        var verDec: VertexDeclaration = this._vertexBuffer.vertexDeclaration;\r\n        var element: VertexElement = verDec.getVertexElementByUsage(elementUsage);\r\n        if (element) {\r\n            var uint8Vertices: Uint8Array = this._vertexBuffer.getUint8Data();\r\n            var floatVertices: Float32Array = this._vertexBuffer.getFloat32Data();\r\n            var uint8VerStr: number = verDec.vertexStride;\r\n            var floatVerStr: number = uint8VerStr / 4;\r\n            var uint8EleOffset: number = element._offset;\r\n            var floatEleOffset: number = uint8EleOffset / 4;\r\n\r\n            switch (elementUsage) {\r\n                case VertexMesh.MESH_TEXTURECOORDINATE0:\r\n                case VertexMesh.MESH_TEXTURECOORDINATE1:\r\n                    for (var i: number = 0; i < this._vertexCount; i++) {\r\n                        var offset: number = floatVerStr * i + floatEleOffset;\r\n                        data[i] = new Vector2(floatVertices[offset], floatVertices[offset + 1]);\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_POSITION0:\r\n                case VertexMesh.MESH_NORMAL0:\r\n                    for (var i: number = 0; i < this._vertexCount; i++) {\r\n                        var offset: number = floatVerStr * i + floatEleOffset;\r\n                        data[i] = new Vector3(floatVertices[offset], floatVertices[offset + 1], floatVertices[offset + 2]);\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_TANGENT0:\r\n                case VertexMesh.MESH_BLENDWEIGHT0:\r\n                    for (var i: number = 0; i < this._vertexCount; i++) {\r\n                        var offset: number = floatVerStr * i + floatEleOffset;\r\n                        data[i] = new Vector4(floatVertices[offset], floatVertices[offset + 1], floatVertices[offset + 2], floatVertices[offset + 3]);\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_COLOR0:\r\n                    for (var i: number = 0; i < this._vertexCount; i++) {\r\n                        var offset: number = floatVerStr * i + floatEleOffset;\r\n                        data[i] = new Color(floatVertices[offset], floatVertices[offset + 1], floatVertices[offset + 2], floatVertices[offset + 3]);\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_BLENDINDICES0:\r\n                    for (var i: number = 0; i < this._vertexCount; i++) {\r\n                        var offset: number = uint8VerStr * i + uint8EleOffset;\r\n                        data[i] = new Vector4(uint8Vertices[offset], uint8Vertices[offset + 1], uint8Vertices[offset + 2], uint8Vertices[offset + 3]);\r\n                    }\r\n                    break;\r\n                default:\r\n                    throw \"Mesh:Unknown elementUsage.\";\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _setVerticeElementData(data: Array<Vector2 | Vector3 | Vector4 | Color>, elementUsage: number): void {\r\n        var verDec: VertexDeclaration = this._vertexBuffer.vertexDeclaration;\r\n        var element: VertexElement = verDec.getVertexElementByUsage(elementUsage);\r\n        if (element) {\r\n            var uint8Vertices: Uint8Array = this._vertexBuffer.getUint8Data();\r\n            var floatVertices: Float32Array = this._vertexBuffer.getFloat32Data();\r\n            var uint8VerStr: number = verDec.vertexStride;\r\n            var float8VerStr: number = uint8VerStr / 4;\r\n            var uint8EleOffset: number = element._offset;\r\n            var floatEleOffset: number = uint8EleOffset / 4;\r\n            switch (elementUsage) {\r\n                case VertexMesh.MESH_TEXTURECOORDINATE0:\r\n                case VertexMesh.MESH_TEXTURECOORDINATE1:\r\n                    for (var i: number = 0, n: number = data.length; i < n; i++) {\r\n                        var offset: number = float8VerStr * i + floatEleOffset;\r\n                        var vec2: Vector2 = <Vector2>data[i];\r\n                        floatVertices[offset] = vec2.x;\r\n                        floatVertices[offset + 1] = vec2.y;\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_POSITION0:\r\n                case VertexMesh.MESH_NORMAL0:\r\n                    for (var i: number = 0, n: number = data.length; i < n; i++) {\r\n                        var offset: number = float8VerStr * i + floatEleOffset;\r\n                        var vec3: Vector3 = <Vector3>data[i];\r\n                        floatVertices[offset] = vec3.x;\r\n                        floatVertices[offset + 1] = vec3.y;\r\n                        floatVertices[offset + 2] = vec3.z;\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_TANGENT0:\r\n                case VertexMesh.MESH_BLENDWEIGHT0:\r\n                    for (var i: number = 0, n: number = data.length; i < n; i++) {\r\n                        var offset: number = float8VerStr * i + floatEleOffset;\r\n                        var vec4: Vector4 = <Vector4>data[i];\r\n                        floatVertices[offset] = vec4.x;\r\n                        floatVertices[offset + 1] = vec4.y;\r\n                        floatVertices[offset + 2] = vec4.z;\r\n                        floatVertices[offset + 3] = vec4.w;\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_COLOR0:\r\n                    for (var i: number = 0, n: number = data.length; i < n; i++) {\r\n                        var offset: number = float8VerStr * i + floatEleOffset;\r\n                        var cor: Color = <Color>data[i];\r\n                        floatVertices[offset] = cor.r;\r\n                        floatVertices[offset + 1] = cor.g;\r\n                        floatVertices[offset + 2] = cor.b;\r\n                        floatVertices[offset + 3] = cor.a;\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_BLENDINDICES0:\r\n                    for (var i: number = 0, n: number = data.length; i < n; i++) {\r\n                        var offset: number = uint8VerStr * i + uint8EleOffset;\r\n                        var vec4: Vector4 = <Vector4>data[i];\r\n                        uint8Vertices[offset] = vec4.x;\r\n                        uint8Vertices[offset + 1] = vec4.y;\r\n                        uint8Vertices[offset + 2] = vec4.z;\r\n                        uint8Vertices[offset + 3] = vec4.w;\r\n                    }\r\n                    break;\r\n                default:\r\n                    throw \"Mesh:Unknown elementUsage.\";\r\n            }\r\n            this._minVerticesUpdate = 0;\r\n            this._maxVerticesUpdate = Number.MAX_SAFE_INTEGER;\r\n        }\r\n        else {\r\n            console.warn(\"Mesh: the mesh don't have  this VertexElement.\");\r\n            //TODO:vertexBuffer\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _disposeResource(): void {\r\n        for (var i: number = 0, n: number = this._subMeshes.length; i < n; i++)\r\n            this._subMeshes[i].destroy();\r\n        //this._btTriangleMesh && Physics3D._bullet.btStridingMeshInterface_destroy(this._btTriangleMesh);\r\n        this._vertexBuffer && this._vertexBuffer.destroy();\r\n        this._indexBuffer && this._indexBuffer.destroy();\r\n        this._bufferState.destroy();\r\n        this._instanceBufferState && this._instanceBufferState.destroy();\r\n        this._instanceWorldVertexBuffer && this._instanceWorldVertexBuffer.destroy();\r\n        this._instanceSimpleAniVertexBuffer && this._instanceSimpleAniVertexBuffer.destroy();\r\n        this._instanceLightMapVertexBuffer && this._instanceLightMapVertexBuffer.destroy();\r\n        this.instanceWorldMatrixData && (this.instanceWorldMatrixData = null);\r\n        this.instanceSimpleAnimatorData && (this.instanceSimpleAnimatorData = null);\r\n        this.instanceLightMapScaleOffsetData && (this.instanceLightMapScaleOffsetData = null);\r\n        this._setCPUMemory(0);\r\n        this._setGPUMemory(0);\r\n        this._bufferState = null;\r\n        this._instanceBufferState = null;\r\n        this._vertexBuffer = null;\r\n        this._indexBuffer = null;\r\n        this._subMeshes = null;\r\n        this._btTriangleMesh = null;\r\n        this._indexBuffer = null;\r\n        this._boneNames = null;\r\n        this._inverseBindPoses = null;\r\n        this.morphTargetData && (this.morphTargetData.destroy());\r\n        this.__convexMesh && this.__convexMesh.destroy();\r\n    }\r\n\r\n    /**\r\n     *@internal\r\n     */\r\n    _setSubMeshes(subMeshes: SubMesh[]): void {\r\n        this._subMeshes = subMeshes\r\n        for (var i: number = 0, n: number = subMeshes.length; i < n; i++)\r\n            subMeshes[i]._indexInMesh = i;\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setBuffer(vertexBuffer: VertexBuffer3D, indexBuffer: IndexBuffer3D): void {\r\n        var bufferState: BufferState = this._bufferState;\r\n        bufferState.applyState([vertexBuffer], indexBuffer);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setInstanceBuffer() {\r\n        if (this._instanceBufferState)\r\n            return;\r\n        var instanceBufferState: BufferState = this._instanceBufferState = new BufferState();\r\n        var instanceBufferStateType = this._instanceBufferStateType;\r\n        let vertexArray = [];\r\n        vertexArray.push(this._vertexBuffer);\r\n        //new Instance VertexBuffer3D\r\n        let instanceBuffer3D: VertexBuffer3D = this._instanceWorldVertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(InstanceRenderElement.maxInstanceCount * 16 * 4, BufferUsage.Dynamic, false);;\r\n        instanceBuffer3D.vertexDeclaration = VertexMesh.instanceWorldMatrixDeclaration;\r\n        instanceBuffer3D.instanceBuffer = true;\r\n        vertexArray.push(instanceBuffer3D);\r\n        this.instanceWorldMatrixData = new Float32Array(InstanceRenderElement.maxInstanceCount * 16);\r\n        switch (instanceBufferStateType) {\r\n            case Mesh.MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR:\r\n                //new SimpleVertexBuffer3D\r\n                let instanceSimpleAnimatorBuffer = this._instanceSimpleAniVertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(InstanceRenderElement.maxInstanceCount * 4 * 4, BufferUsage.Dynamic, false);\r\n                instanceSimpleAnimatorBuffer.vertexDeclaration = VertexMesh.instanceSimpleAnimatorDeclaration;\r\n                instanceSimpleAnimatorBuffer.instanceBuffer = true;\r\n                this.instanceSimpleAnimatorData = new Float32Array(InstanceRenderElement.maxInstanceCount * 4);\r\n                vertexArray.push(instanceSimpleAnimatorBuffer);\r\n                break;\r\n            case Mesh.MESH_INSTANCEBUFFER_TYPE_NORMAL:\r\n                //have uv1\r\n                if (this.getVertexDeclaration().getVertexElementByUsage(VertexMesh.MESH_TEXTURECOORDINATE1)) {\r\n                    let instanceLightMapVertexBuffer = this._instanceLightMapVertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(InstanceRenderElement.maxInstanceCount * 4 * 4, BufferUsage.Dynamic, false);\r\n                    instanceLightMapVertexBuffer.vertexDeclaration = VertexMesh.instanceLightMapScaleOffsetDeclaration;\r\n                    instanceLightMapVertexBuffer.instanceBuffer = true;\r\n                    this.instanceLightMapScaleOffsetData = new Float32Array(InstanceRenderElement.maxInstanceCount * 4);\r\n                    vertexArray.push(instanceLightMapVertexBuffer);\r\n                }\r\n                break;\r\n        }\r\n        instanceBufferState.applyState(vertexArray, this._indexBuffer);\r\n    }\r\n\r\n    // /**\r\n    //  * @internal\r\n    //  */\r\n    // _getPhysicMesh(): any {\r\n    //     //if (!this._btTriangleMesh) {//TODO Mesh\r\n    //     var bt: any = Physics3D._bullet;\r\n    //     var triangleMesh: number = bt.btTriangleMesh_create();//TODO:btTriangleMesh,\r\n    //     var nativePositio0: number = Mesh._nativeTempVector30;\r\n    //     var nativePositio1: number = Mesh._nativeTempVector31;\r\n    //     var nativePositio2: number = Mesh._nativeTempVector32;\r\n    //     var position0: Vector3 = this._tempVector30;\r\n    //     var position1: Vector3 = this._tempVector31;\r\n    //     var position2: Vector3 = this._tempVector32;\r\n\r\n    //     var vertexBuffer: VertexBuffer3D = this._vertexBuffer;\r\n    //     var positionElement: VertexElement = this._getPositionElement(vertexBuffer);\r\n    //     var verticesData: Float32Array = vertexBuffer.getFloat32Data();\r\n    //     var floatCount: number = vertexBuffer.vertexDeclaration.vertexStride / 4;\r\n    //     var posOffset: number = positionElement._offset / 4;\r\n\r\n    //     var indices: Uint16Array = this._indexBuffer.getData();//TODO:API\r\n    //     for (var i: number = 0, n: number = indices.length; i < n; i += 3) {\r\n    //         var p0Index: number = indices[i] * floatCount + posOffset;\r\n    //         var p1Index: number = indices[i + 1] * floatCount + posOffset;\r\n    //         var p2Index: number = indices[i + 2] * floatCount + posOffset;\r\n    //         position0.setValue(verticesData[p0Index], verticesData[p0Index + 1], verticesData[p0Index + 2]);\r\n    //         position1.setValue(verticesData[p1Index], verticesData[p1Index + 1], verticesData[p1Index + 2]);\r\n    //         position2.setValue(verticesData[p2Index], verticesData[p2Index + 1], verticesData[p2Index + 2]);\r\n\r\n    //         Utils3D._convertToBulletVec3(position0, nativePositio0);\r\n    //         Utils3D._convertToBulletVec3(position1, nativePositio1);\r\n    //         Utils3D._convertToBulletVec3(position2, nativePositio2);\r\n    //         bt.btTriangleMesh_addTriangle(triangleMesh, nativePositio0, nativePositio1, nativePositio2, false);\r\n    //     }\r\n    //     this._btTriangleMesh = triangleMesh;\r\n    //     //}\r\n    //     return this._btTriangleMesh;\r\n    // }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _uploadVerticesData(): void {\r\n        var min: number = this._minVerticesUpdate;\r\n        var max: number = this._maxVerticesUpdate;\r\n        if (min !== -1 && max !== -1) {\r\n            var offset: number = min;\r\n            this._vertexBuffer.setData(this._vertexBuffer.getUint8Data().buffer, offset, offset, max - min);\r\n            this._minVerticesUpdate = -1;\r\n            this._maxVerticesUpdate = -1;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param index \r\n     */\r\n    getSubMesh(index: number): SubMesh {\r\n        return this._subMeshes[index];\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param positions \r\n     * @remark \r\n     */\r\n    getPositions(positions: Vector3[]): void {\r\n        if (this._isReadable)\r\n            this._getVerticeElementData(positions, VertexMesh.MESH_POSITION0);\r\n        else\r\n            throw \"Mesh:can't get positions on mesh,isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param positions \r\n     */\r\n    setPositions(positions: Vector3[]): void {\r\n        if (this._isReadable) {\r\n            this._setVerticeElementData(positions, VertexMesh.MESH_POSITION0);\r\n            this._needUpdateBounds = true;\r\n        }\r\n        else {\r\n            throw \"Mesh:setPosition() need isReadable must be true or use setVertices().\";\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param colors \r\n     * @remark \r\n     */\r\n    getColors(colors: Color[]): void {\r\n        if (this._isReadable)\r\n            this._getVerticeElementData(colors, VertexMesh.MESH_COLOR0);\r\n        else\r\n            throw \"Mesh:can't get colors on mesh,isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param colors  \r\n     */\r\n    setColors(colors: Color[]): void {\r\n        if (this._isReadable)\r\n            this._setVerticeElementData(colors, VertexMesh.MESH_COLOR0);\r\n        else\r\n            throw \"Mesh:setColors() need isReadable must be true or use setVertices().\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param uvs \r\n     * @param channel \r\n     * @remark \r\n     */\r\n    getUVs(uvs: Vector2[], channel: number = 0): void {\r\n        if (this._isReadable) {\r\n            switch (channel) {\r\n                case 0:\r\n                    this._getVerticeElementData(uvs, VertexMesh.MESH_TEXTURECOORDINATE0);\r\n                    break;\r\n                case 1:\r\n                    this._getVerticeElementData(uvs, VertexMesh.MESH_TEXTURECOORDINATE1);\r\n                    break;\r\n                default:\r\n                    throw \"Mesh:Invalid channel.\";\r\n            }\r\n        }\r\n        else {\r\n            throw \"Mesh:can't get uvs on mesh,isReadable must be true.\";\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param uvs \r\n     * @param channel \r\n     */\r\n    setUVs(uvs: Vector2[], channel: number = 0): void {\r\n        if (this._isReadable) {\r\n            switch (channel) {\r\n                case 0:\r\n                    this._setVerticeElementData(uvs, VertexMesh.MESH_TEXTURECOORDINATE0);\r\n                    break;\r\n                case 1:\r\n                    this._setVerticeElementData(uvs, VertexMesh.MESH_TEXTURECOORDINATE1);\r\n                    break;\r\n                default:\r\n                    throw \"Mesh:Invalid channel.\";\r\n            }\r\n        }\r\n        else {\r\n            throw \"Mesh:setUVs() need isReadable must be true or use setVertices().\";\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param normals \r\n     * @remark \r\n     */\r\n    getNormals(normals: Vector3[]): void {\r\n        if (this._isReadable)\r\n            this._getVerticeElementData(normals, VertexMesh.MESH_NORMAL0);\r\n        else\r\n            throw \"Mesh:can't get colors on mesh,isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param normals  \r\n     */\r\n    setNormals(normals: Vector3[]): void {\r\n        if (this._isReadable)\r\n            this._setVerticeElementData(normals, VertexMesh.MESH_NORMAL0);\r\n        else\r\n            throw \"Mesh:setNormals() need must be true or use setVertices().\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param tangents \r\n     */\r\n    getTangents(tangents: Vector4[]): void {\r\n        if (this._isReadable)\r\n            this._getVerticeElementData(tangents, VertexMesh.MESH_TANGENT0);\r\n        else\r\n            throw \"Mesh:can't get colors on mesh,isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param tangents \r\n     */\r\n    setTangents(tangents: Vector4[]): void {\r\n        if (this._isReadable)\r\n            this._setVerticeElementData(tangents, VertexMesh.MESH_TANGENT0);\r\n        else\r\n            throw \"Mesh:setTangents() need isReadable must be true or use setVertices().\";\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @param boneWeights \r\n    */\r\n    getBoneWeights(boneWeights: Vector4[]): void {\r\n        if (this._isReadable)\r\n            this._getVerticeElementData(boneWeights, VertexMesh.MESH_BLENDWEIGHT0);\r\n        else\r\n            throw \"Mesh:can't get boneWeights on mesh,isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @param boneWeights \r\n    */\r\n    setBoneWeights(boneWeights: Vector4[]): void {\r\n        if (this._isReadable)\r\n            this._setVerticeElementData(boneWeights, VertexMesh.MESH_BLENDWEIGHT0);\r\n        else\r\n            throw \"Mesh:setBoneWeights() need isReadable must be true or use setVertices().\";\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @param boneIndices \r\n    */\r\n    getBoneIndices(boneIndices: Vector4[]): void {\r\n        if (this._isReadable)\r\n            this._getVerticeElementData(boneIndices, VertexMesh.MESH_BLENDINDICES0);\r\n        else\r\n            throw \"Mesh:can't get boneIndices on mesh,isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @param boneWeights \r\n    */\r\n    setBoneIndices(boneIndices: Vector4[]): void {\r\n        if (this._isReadable)\r\n            this._setVerticeElementData(boneIndices, VertexMesh.MESH_BLENDINDICES0);\r\n        else\r\n            throw \"Mesh:setBoneIndices() need isReadable must be true or use setVertices().\";\r\n    }\r\n\r\n\r\n    /**\r\n     * Mesh,\r\n     */\r\n    markAsUnreadbale(): void {\r\n        this._uploadVerticesData();\r\n        this._vertexBuffer.markAsUnreadbale();\r\n        this._isReadable = false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    getVertexDeclaration(): VertexDeclaration {\r\n        return this._vertexBuffer._vertexDeclaration;\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @return \r\n    */\r\n    getVertices(): ArrayBuffer {\r\n        if (this._isReadable)\r\n            return this._vertexBuffer.getUint8Data().buffer.slice(0);\r\n        else\r\n            throw \"Mesh:can't get vertices on mesh,isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @param vertices \r\n    */\r\n    setVertices(vertices: ArrayBuffer): void {\r\n        this._vertexBuffer.setData(vertices);\r\n        this._needUpdateBounds = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return \r\n     */\r\n    getIndices(): Uint8Array | Uint16Array | Uint32Array {\r\n        if (this._isReadable)\r\n            return this._indexBuffer.getData().slice();\r\n        else\r\n            throw \"Mesh:can't get indices on subMesh,mesh's isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param indices \r\n     */\r\n    setIndices(indices: Uint8Array | Uint16Array | Uint32Array): void {\r\n        var format: IndexFormat;\r\n        if (indices instanceof Uint32Array)\r\n            format = IndexFormat.UInt32;\r\n        else if (indices instanceof Uint16Array)\r\n            format = IndexFormat.UInt16;\r\n        else if (indices instanceof Uint8Array)\r\n            format = IndexFormat.UInt8;\r\n\r\n        var indexBuffer: IndexBuffer3D = this._indexBuffer;\r\n        if (this._indexFormat !== format || indexBuffer.indexCount !== indices.length) {//format chang and length chang will recreate the indexBuffer\r\n            indexBuffer.destroy();\r\n            this._indexBuffer = indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(format, indices.length, BufferUsage.Static, this._isReadable);\r\n        }\r\n        indexBuffer.setData(indices);\r\n        this.indexFormat = format;\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    calculateBounds(): void {\r\n        if (this._isReadable) {\r\n            if (this._needUpdateBounds) {\r\n                var min: Vector3 = this._tempVector30;\r\n                var max: Vector3 = this._tempVector31;\r\n                min.x = min.y = min.z = Number.MAX_VALUE;\r\n                max.x = max.y = max.z = -Number.MAX_VALUE;\r\n\r\n                var vertexBuffer: VertexBuffer3D = this._vertexBuffer;\r\n                var positionElement: VertexElement = this._getPositionElement(vertexBuffer);\r\n                var verticesData: Float32Array = vertexBuffer.getFloat32Data();\r\n                var floatCount: number = vertexBuffer.vertexDeclaration.vertexStride / 4;\r\n                var posOffset: number = positionElement._offset / 4;\r\n                for (var j: number = 0, m: number = verticesData.length; j < m; j += floatCount) {\r\n                    var ofset: number = j + posOffset;\r\n                    var pX: number = verticesData[ofset];\r\n                    var pY: number = verticesData[ofset + 1];\r\n                    var pZ: number = verticesData[ofset + 2];\r\n                    min.x = Math.min(min.x, pX);\r\n                    min.y = Math.min(min.y, pY);\r\n                    min.z = Math.min(min.z, pZ);\r\n                    max.x = Math.max(max.x, pX);\r\n                    max.y = Math.max(max.y, pY);\r\n                    max.z = Math.max(max.z, pZ);\r\n                }\r\n                this._bounds.setMin(min);\r\n                this._bounds.setMax(max);\r\n                this._needUpdateBounds = false;\r\n            }\r\n        }\r\n        else {\r\n            throw \"Mesh:can't calculate bounds on subMesh,mesh's isReadable must be true.\";\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * Corve\r\n     */\r\n    getCorveMesh(): Mesh {\r\n        if (this._convexMesh == null) {\r\n            return null;\r\n        }\r\n        if (this.__convexMesh == null && Laya3D._PhysicsCreateUtil && Laya3D._PhysicsCreateUtil.getPhysicsCapable(EPhysicsCapable.Physics_CreateCorveMesh)) {\r\n            this.__convexMesh = Laya3D._PhysicsCreateUtil.createCorveMesh(this);\r\n        }\r\n        return this.__convexMesh;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {//[IClone]\r\n        var destMesh: Mesh = <Mesh>destObject;\r\n        var vb: VertexBuffer3D = this._vertexBuffer;\r\n        var destVB: VertexBuffer3D = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vb._byteLength, vb.bufferUsage, vb.canRead);\r\n        destVB.vertexDeclaration = vb.vertexDeclaration;\r\n        destVB.setData(vb.getUint8Data().slice().buffer);\r\n        destMesh._vertexBuffer = destVB;\r\n        destMesh._vertexCount = this._vertexCount;\r\n        var ib: IndexBuffer3D = this._indexBuffer;\r\n        var destIB: IndexBuffer3D = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, ib.indexCount, ib.bufferUsage, ib.canRead);\r\n        destIB.setData(ib.getData().slice());\r\n        destMesh._indexBuffer = destIB;\r\n\r\n        destMesh._setBuffer(destMesh._vertexBuffer, destIB);\r\n        destMesh._instanceBufferStateType = this._instanceBufferStateType;\r\n\r\n        destMesh._setCPUMemory(this.cpuMemory);\r\n        destMesh._setGPUMemory(this.gpuMemory);\r\n\r\n        var i: number;\r\n        var boneNames: string[] = this._boneNames;\r\n        if (boneNames) {\r\n            var destBoneNames: string[] = destMesh._boneNames = [];\r\n            for (i = 0; i < boneNames.length; i++)\r\n                destBoneNames[i] = boneNames[i];\r\n        }\r\n\r\n        var inverseBindPoses: Matrix4x4[] = this._inverseBindPoses;\r\n        if (inverseBindPoses) {\r\n            var destInverseBindPoses: Matrix4x4[] = destMesh._inverseBindPoses = [];\r\n            for (i = 0; i < inverseBindPoses.length; i++)\r\n                destInverseBindPoses[i] = inverseBindPoses[i];\r\n        }\r\n\r\n        var cacheLength: number = this._skinnedMatrixCaches.length;\r\n        destMesh._skinnedMatrixCaches.length = cacheLength;\r\n        for (i = 0; i < cacheLength; i++) {\r\n            var skinnedCache: skinnedMatrixCache = this._skinnedMatrixCaches[i];\r\n            if (skinnedCache)\r\n                destMesh._skinnedMatrixCaches[i] = new skinnedMatrixCache(skinnedCache.subMeshIndex, skinnedCache.batchIndex, skinnedCache.batchBoneIndex);\r\n        }\r\n\r\n        for (i = 0; i < this.subMeshCount; i++) {\r\n            var subMesh: SubMesh = this._subMeshes[i];\r\n            var subIndexBufferStart: number[] = subMesh._subIndexBufferStart;\r\n            var subIndexBufferCount: number[] = subMesh._subIndexBufferCount;\r\n            var boneIndicesList: Uint16Array[] = subMesh._boneIndicesList;\r\n            var destSubmesh: SubMesh = new SubMesh(destMesh);\r\n\r\n            destSubmesh._subIndexBufferStart.length = subIndexBufferStart.length;\r\n            destSubmesh._subIndexBufferCount.length = subIndexBufferCount.length;\r\n            destSubmesh._boneIndicesList.length = boneIndicesList.length;\r\n\r\n            for (var j: number = 0; j < subIndexBufferStart.length; j++)\r\n                destSubmesh._subIndexBufferStart[j] = subIndexBufferStart[j];\r\n            for (j = 0; j < subIndexBufferCount.length; j++)\r\n                destSubmesh._subIndexBufferCount[j] = subIndexBufferCount[j];\r\n            for (j = 0; j < boneIndicesList.length; j++)\r\n                destSubmesh._boneIndicesList[j] = new Uint16Array(boneIndicesList[j]);\r\n\r\n            destSubmesh._indexBuffer = destIB;\r\n            destSubmesh._indexStart = subMesh._indexStart;\r\n            destSubmesh._indexCount = subMesh._indexCount;\r\n            destSubmesh._indices = new Uint16Array(destIB.getData().buffer, subMesh._indexStart * 2, subMesh._indexCount);\r\n            var vertexBuffer: VertexBuffer3D = destMesh._vertexBuffer;\r\n            destSubmesh._vertexBuffer = vertexBuffer;\r\n            destMesh._subMeshes.push(destSubmesh);\r\n        }\r\n        destMesh._setSubMeshes(destMesh._subMeshes);\r\n\r\n        if (this.morphTargetData) {\r\n            destMesh.morphTargetData = this.morphTargetData.clone();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): any {//[IClone]\r\n        var dest: Mesh = new Mesh();\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n\r\n\r\n\r\n    //------------------------------------------NATIVE----------------------------------------------------\r\n    /** @internal */\r\n    _inverseBindPosesBuffer: ArrayBuffer;\r\n}\r\n\r\n\r\n\r\n","import { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Mesh } from \"./Mesh\";\r\nimport { SubMesh } from \"./SubMesh\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * <code>PrimitiveMesh</code> \r\n */\r\nexport class PrimitiveMesh {\r\n\r\n\tstatic __init__(): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic _createMesh(vertexDeclaration: VertexDeclaration, vertices: Float32Array, indices: Uint16Array): Mesh {\r\n\t\tvar mesh: Mesh = new Mesh();\r\n\t\tvar subMesh: SubMesh = new SubMesh(mesh);\r\n\t\tvar vertexBuffer: VertexBuffer3D = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vertices.length * 4, BufferUsage.Static, true);\r\n\t\tvertexBuffer.vertexDeclaration = vertexDeclaration;\r\n\t\tvertexBuffer.setData(vertices.buffer);\r\n\t\tmesh._vertexBuffer = vertexBuffer;\r\n\t\tmesh._vertexCount = vertexBuffer._byteLength / vertexDeclaration.vertexStride;\r\n\t\tvar indexBuffer: IndexBuffer3D = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, indices.length, BufferUsage.Static, true);\r\n\t\tindexBuffer.setData(indices);\r\n\t\tmesh._indexBuffer = indexBuffer;\r\n\r\n\t\tmesh._setBuffer(vertexBuffer, indexBuffer);\r\n\t\t//mesh._setInstanceBuffer(mesh._instanceBufferStateType);\r\n\t\tsubMesh._vertexBuffer = vertexBuffer;\r\n\t\tsubMesh._indexBuffer = indexBuffer;\r\n\t\tsubMesh._setIndexRange(0, indexBuffer.indexCount);\r\n\r\n\t\tvar subIndexBufferStart: number[] = subMesh._subIndexBufferStart;\r\n\t\tvar subIndexBufferCount: number[] = subMesh._subIndexBufferCount;\r\n\t\tvar boneIndicesList: Uint16Array[] = subMesh._boneIndicesList;\r\n\t\tsubIndexBufferStart.length = 1;\r\n\t\tsubIndexBufferCount.length = 1;\r\n\t\tboneIndicesList.length = 1;\r\n\t\tsubIndexBufferStart[0] = 0;\r\n\t\tsubIndexBufferCount[0] = indexBuffer.indexCount;\r\n\r\n\t\tvar subMeshes: SubMesh[] = [];\r\n\t\tsubMeshes.push(subMesh);\r\n\t\tmesh._setSubMeshes(subMeshes);\r\n\t\tmesh.calculateBounds();\r\n\t\tvar memorySize: number = vertexBuffer._byteLength + indexBuffer._byteLength;\r\n\t\tmesh._setCPUMemory(memorySize);\r\n\t\tmesh._setGPUMemory(memorySize);\r\n\t\treturn mesh;\r\n\t}\r\n\r\n\t/**\r\n\t * Box\r\n\t * @param long \r\n\t * @param height \r\n\t * @param width \r\n\t * @return\r\n\t */\r\n\tstatic createBox(long: number = 1, height: number = 1, width: number = 1): Mesh {\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n\r\n\t\tvar halfLong: number = long / 2;\r\n\t\tvar halfHeight: number = height / 2;\r\n\t\tvar halfWidth: number = width / 2;\r\n\r\n\t\tvar vertices: Float32Array = new Float32Array([\r\n\t\t\t//\r\n\t\t\t-halfLong, halfHeight, -halfWidth, 0, 1, 0, 0, 0, halfLong, halfHeight, -halfWidth, 0, 1, 0, 1, 0, halfLong, halfHeight, halfWidth, 0, 1, 0, 1, 1, -halfLong, halfHeight, halfWidth, 0, 1, 0, 0, 1,\r\n\t\t\t//\r\n\t\t\t-halfLong, -halfHeight, -halfWidth, 0, -1, 0, 0, 1, halfLong, -halfHeight, -halfWidth, 0, -1, 0, 1, 1, halfLong, -halfHeight, halfWidth, 0, -1, 0, 1, 0, -halfLong, -halfHeight, halfWidth, 0, -1, 0, 0, 0,\r\n\t\t\t//\r\n\t\t\t-halfLong, halfHeight, -halfWidth, -1, 0, 0, 0, 0, -halfLong, halfHeight, halfWidth, -1, 0, 0, 1, 0, -halfLong, -halfHeight, halfWidth, -1, 0, 0, 1, 1, -halfLong, -halfHeight, -halfWidth, -1, 0, 0, 0, 1,\r\n\t\t\t//\r\n\t\t\thalfLong, halfHeight, -halfWidth, 1, 0, 0, 1, 0, halfLong, halfHeight, halfWidth, 1, 0, 0, 0, 0, halfLong, -halfHeight, halfWidth, 1, 0, 0, 0, 1, halfLong, -halfHeight, -halfWidth, 1, 0, 0, 1, 1,\r\n\t\t\t//\r\n\t\t\t-halfLong, halfHeight, halfWidth, 0, 0, 1, 0, 0, halfLong, halfHeight, halfWidth, 0, 0, 1, 1, 0, halfLong, -halfHeight, halfWidth, 0, 0, 1, 1, 1, -halfLong, -halfHeight, halfWidth, 0, 0, 1, 0, 1,\r\n\t\t\t//\r\n\t\t\t-halfLong, halfHeight, -halfWidth, 0, 0, -1, 1, 0, halfLong, halfHeight, -halfWidth, 0, 0, -1, 0, 0, halfLong, -halfHeight, -halfWidth, 0, 0, -1, 0, 1, -halfLong, -halfHeight, -halfWidth, 0, 0, -1, 1, 1]);\r\n\r\n\t\tvar indices: Uint16Array = new Uint16Array([\r\n\t\t\t//\r\n\t\t\t0, 1, 2, 2, 3, 0,\r\n\t\t\t//\r\n\t\t\t4, 7, 6, 6, 5, 4,\r\n\t\t\t//\r\n\t\t\t8, 9, 10, 10, 11, 8,\r\n\t\t\t//\r\n\t\t\t12, 15, 14, 14, 13, 12,\r\n\t\t\t//\r\n\t\t\t16, 17, 18, 18, 19, 16,\r\n\t\t\t//\r\n\t\t\t20, 23, 22, 22, 21, 20]);\r\n\t\treturn PrimitiveMesh._createMesh(vertexDeclaration, vertices, indices);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param radius \r\n\t * @param height \r\n\t * @param stacks ,\r\n\t * @param slices \r\n\t */\r\n\tstatic createCapsule(radius: number = 0.5, height: number = 2, stacks: number = 16, slices: number = 32): Mesh {\r\n\t\tvar vertexCount: number = (stacks + 1) * (slices + 1) * 2 + (slices + 1) * 2;\r\n\t\tvar indexCount: number = (3 * stacks * (slices + 1)) * 2 * 2 + 2 * slices * 3;\r\n\r\n\t\t//\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n\t\t//,/\r\n\t\tvar vertexFloatStride: number = vertexDeclaration.vertexStride / 4;\r\n\t\t//\r\n\t\tvar vertices: Float32Array = new Float32Array(vertexCount * vertexFloatStride);\r\n\t\t//\r\n\t\tvar indices: Uint16Array = new Uint16Array(indexCount);\r\n\r\n\t\tvar stackAngle: number = (Math.PI / 2.0) / stacks;\r\n\t\tvar sliceAngle: number = (Math.PI * 2.0) / slices;\r\n\r\n\t\t//\r\n\t\tvar hcHeight: number = height / 2 - radius;\r\n\r\n\t\tvar posX: number = 0;\r\n\t\tvar posY: number = 0;\r\n\t\tvar posZ: number = 0;\r\n\r\n\t\tvar vc: number = 0;\r\n\t\tvar ic: number = 0;\r\n\r\n\t\tvar verticeCount: number = 0;\r\n\r\n\t\tvar stack: number, slice: number;\r\n\r\n\t\t//\r\n\t\tfor (stack = 0; stack <= stacks; stack++) {\r\n\r\n\t\t\tfor (slice = 0; slice <= slices; slice++) {\r\n\r\n\t\t\t\tposX = radius * Math.cos(stack * stackAngle) * Math.cos(slice * sliceAngle + Math.PI);\r\n\t\t\t\tposY = radius * Math.sin(stack * stackAngle);\r\n\t\t\t\tposZ = radius * Math.cos(stack * stackAngle) * Math.sin(slice * sliceAngle + Math.PI);\r\n\r\n\t\t\t\t//pos\r\n\t\t\t\tvertices[vc++] = posX;\r\n\t\t\t\tvertices[vc++] = posY + hcHeight;\r\n\t\t\t\tvertices[vc++] = posZ;\r\n\r\n\t\t\t\t//normal\r\n\t\t\t\tvertices[vc++] = posX;\r\n\t\t\t\tvertices[vc++] = posY;\r\n\t\t\t\tvertices[vc++] = posZ;\r\n\r\n\t\t\t\t//uv\r\n\t\t\t\tvertices[vc++] = 1 - slice / slices;\r\n\t\t\t\tvertices[vc++] = (1 - stack / stacks) * ((Math.PI * radius / 2) / (height + Math.PI * radius));\r\n\r\n\t\t\t\tif (stack < stacks) {\r\n\r\n\t\t\t\t\t// First\r\n\t\t\t\t\tindices[ic++] = (stack * (slices + 1)) + slice + (slices + 1);\r\n\t\t\t\t\tindices[ic++] = (stack * (slices + 1)) + slice;\r\n\t\t\t\t\tindices[ic++] = (stack * (slices + 1)) + slice + 1;\r\n\t\t\t\t\t// Second\r\n\t\t\t\t\tindices[ic++] = (stack * (slices + 1)) + slice + (slices);\r\n\t\t\t\t\tindices[ic++] = (stack * (slices + 1)) + slice;\r\n\t\t\t\t\tindices[ic++] = (stack * (slices + 1)) + slice + (slices + 1);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tverticeCount += (stacks + 1) * (slices + 1);\r\n\r\n\t\t//\r\n\t\tfor (stack = 0; stack <= stacks; stack++) {\r\n\r\n\t\t\tfor (slice = 0; slice <= slices; slice++) {\r\n\r\n\t\t\t\tposX = radius * Math.cos(stack * stackAngle) * Math.cos(slice * sliceAngle + Math.PI);\r\n\t\t\t\tposY = radius * Math.sin(-stack * stackAngle);\r\n\t\t\t\tposZ = radius * Math.cos(stack * stackAngle) * Math.sin(slice * sliceAngle + Math.PI);\r\n\r\n\t\t\t\t//pos\r\n\t\t\t\tvertices[vc++] = posX;\r\n\t\t\t\tvertices[vc++] = posY - hcHeight;\r\n\t\t\t\tvertices[vc++] = posZ;\r\n\r\n\t\t\t\t//normal\r\n\t\t\t\tvertices[vc++] = posX;\r\n\t\t\t\tvertices[vc++] = posY;\r\n\t\t\t\tvertices[vc++] = posZ;\r\n\r\n\t\t\t\t//uv\r\n\t\t\t\tvertices[vc++] = 1 - slice / slices;\r\n\t\t\t\tvertices[vc++] = ((stack / stacks) * (Math.PI * radius / 2) + (height + Math.PI * radius / 2)) / (height + Math.PI * radius);\r\n\r\n\t\t\t\tif (stack < stacks) {\r\n\r\n\t\t\t\t\t// First\r\n\t\t\t\t\tindices[ic++] = verticeCount + (stack * (slices + 1)) + slice;\r\n\t\t\t\t\tindices[ic++] = verticeCount + (stack * (slices + 1)) + slice + (slices + 1);\r\n\t\t\t\t\tindices[ic++] = verticeCount + (stack * (slices + 1)) + slice + 1;\r\n\t\t\t\t\t// Second\r\n\t\t\t\t\tindices[ic++] = verticeCount + (stack * (slices + 1)) + slice;\r\n\t\t\t\t\tindices[ic++] = verticeCount + (stack * (slices + 1)) + slice + (slices);\r\n\t\t\t\t\tindices[ic++] = verticeCount + (stack * (slices + 1)) + slice + (slices + 1);\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tverticeCount += (stacks + 1) * (slices + 1);\r\n\r\n\t\t//\r\n\t\tfor (slice = 0; slice <= slices; slice++) {\r\n\t\t\tposX = radius * Math.cos(slice * sliceAngle + Math.PI);\r\n\t\t\tposY = hcHeight;\r\n\t\t\tposZ = radius * Math.sin(slice * sliceAngle + Math.PI);\r\n\r\n\t\t\t//pos\r\n\t\t\tvertices[vc++] = posX;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posX;\r\n\t\t\tvertices[vc++] = posY;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = -posY;\r\n\t\t\tvertices[vc++] = posZ;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posZ;\r\n\t\t\t//normal\r\n\t\t\tvertices[vc++] = posX;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posX;\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = 0;\r\n\t\t\tvertices[vc++] = posZ;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posZ;\r\n\t\t\t//uv    \r\n\t\t\tvertices[vc++] = 1 - slice * 1 / slices;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = 1 - slice * 1 / slices;\r\n\t\t\tvertices[vc++] = (Math.PI * radius / 2) / (height + Math.PI * radius);\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = (Math.PI * radius / 2 + height) / (height + Math.PI * radius);\r\n\t\t}\r\n\r\n\t\tfor (slice = 0; slice < slices; slice++) {\r\n\r\n\t\t\tindices[ic++] = slice + verticeCount + (slices + 1);\r\n\t\t\tindices[ic++] = slice + verticeCount + 1;\r\n\t\t\tindices[ic++] = slice + verticeCount;\r\n\r\n\t\t\tindices[ic++] = slice + verticeCount + (slices + 1);\r\n\t\t\tindices[ic++] = slice + verticeCount + (slices + 1) + 1;\r\n\t\t\tindices[ic++] = slice + verticeCount + 1;\r\n\t\t}\r\n\r\n\t\tverticeCount += 2 * (slices + 1);\r\n\t\treturn PrimitiveMesh._createMesh(vertexDeclaration, vertices, indices);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param radius \r\n\t * @param height \r\n\t * @param slices \r\n\t */\r\n\tstatic createCone(radius: number = 0.5, height: number = 1, slices: number = 32): Mesh {\r\n\t\t//(this._released) || (dispose());//\r\n\t\tvar vertexCount: number = (slices + 1 + 1) + (slices + 1) * 2;\r\n\t\tvar indexCount: number = 6 * slices + 3 * slices;\r\n\r\n\t\t//\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n\t\t//,/\r\n\t\tvar vertexFloatStride: number = vertexDeclaration.vertexStride / 4;\r\n\t\t//\r\n\t\tvar vertices: Float32Array = new Float32Array(vertexCount * vertexFloatStride);\r\n\t\t//\r\n\t\tvar indices: Uint16Array = new Uint16Array(indexCount);\r\n\r\n\t\tvar sliceAngle: number = (Math.PI * 2.0) / slices;\r\n\r\n\t\tvar halfHeight: number = height / 2;\r\n\t\tvar curAngle: number = 0;\r\n\t\tvar verticeCount: number = 0;\r\n\r\n\t\tvar posX: number = 0;\r\n\t\tvar posY: number = 0;\r\n\t\tvar posZ: number = 0;\r\n\r\n\t\tvar normal: Vector3 = new Vector3();\r\n\t\tvar downV3: Vector3 = new Vector3(0, -1, 0);\r\n\t\tvar upPoint: Vector3 = new Vector3(0, halfHeight, 0);\r\n\t\tvar downPoint: Vector3 = new Vector3();\r\n\t\tvar v3: Vector3 = new Vector3();\r\n\t\tvar q4: Quaternion = new Quaternion();\r\n\t\tvar rotateAxis: Vector3 = new Vector3();\r\n\t\tvar rotateRadius: number;\r\n\r\n\t\tvar vc: number = 0;\r\n\t\tvar ic: number = 0;\r\n\r\n\t\t//\r\n\t\tfor (var rv: number = 0; rv <= slices; rv++) {\r\n\t\t\tcurAngle = rv * sliceAngle;\r\n\t\t\tposX = Math.cos(curAngle + Math.PI) * radius;\r\n\t\t\tposY = halfHeight;\r\n\t\t\tposZ = Math.sin(curAngle + Math.PI) * radius;\r\n\r\n\t\t\t//pos\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posX;\r\n\t\t\tvertices[vc++] = posY;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = -posY;\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posZ;\r\n\r\n\t\t\tnormal.x = posX;\r\n\t\t\tnormal.y = 0;\r\n\t\t\tnormal.z = posZ;\r\n\t\t\tdownPoint.x = posX;\r\n\t\t\tdownPoint.y = -posY;\r\n\t\t\tdownPoint.z = posZ;\r\n\t\t\tVector3.subtract(downPoint, upPoint, v3);\r\n\t\t\tVector3.normalize(v3, v3);\r\n\t\t\trotateRadius = Math.acos(Vector3.dot(downV3, v3));\r\n\t\t\tVector3.cross(downV3, v3, rotateAxis);\r\n\t\t\tVector3.normalize(rotateAxis, rotateAxis);\r\n\t\t\tQuaternion.createFromAxisAngle(rotateAxis, rotateRadius, q4);\r\n\t\t\tVector3.normalize(normal, normal);\r\n\t\t\tVector3.transformQuat(normal, q4, normal);\r\n\t\t\tVector3.normalize(normal, normal);\r\n\t\t\t//normal\r\n\t\t\tvertices[vc++] = normal.x;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = normal.x;\r\n\t\t\tvertices[vc++] = normal.y;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = normal.y;\r\n\t\t\tvertices[vc++] = normal.z;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = normal.z;\r\n\t\t\t//uv    \r\n\t\t\tvertices[vc++] = 1 - rv * 1 / slices;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = 1 - rv * 1 / slices;\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = 1;\r\n\r\n\t\t}\r\n\r\n\t\tvc += (slices + 1) * 8;\r\n\r\n\t\tfor (var ri: number = 0; ri < slices; ri++) {\r\n\t\t\tindices[ic++] = ri + verticeCount + (slices + 1);\r\n\t\t\tindices[ic++] = ri + verticeCount + 1;\r\n\t\t\tindices[ic++] = ri + verticeCount;\r\n\r\n\t\t\tindices[ic++] = ri + verticeCount + (slices + 1);\r\n\t\t\tindices[ic++] = ri + verticeCount + (slices + 1) + 1;\r\n\t\t\tindices[ic++] = ri + verticeCount + 1;\r\n\r\n\t\t}\r\n\r\n\t\tverticeCount += 2 * (slices + 1);\r\n\r\n\t\t//\r\n\t\tfor (var bv: number = 0; bv <= slices; bv++) {\r\n\t\t\tif (bv === 0) {\r\n\t\t\t\t//pos\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\tvertices[vc++] = -halfHeight;\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\t//normal\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\tvertices[vc++] = -1;\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\t//uv\r\n\t\t\t\tvertices[vc++] = 0.5;\r\n\t\t\t\tvertices[vc++] = 0.5;\r\n\t\t\t}\r\n\r\n\t\t\tcurAngle = bv * sliceAngle;\r\n\t\t\tposX = Math.cos(curAngle + Math.PI) * radius;\r\n\t\t\tposY = -halfHeight;\r\n\t\t\tposZ = Math.sin(curAngle + Math.PI) * radius;\r\n\r\n\t\t\t//pos\r\n\t\t\tvertices[vc++] = posX;\r\n\t\t\tvertices[vc++] = posY;\r\n\t\t\tvertices[vc++] = posZ;\r\n\t\t\t//normal\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc++] = -1;\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\t//uv\r\n\t\t\tvertices[vc++] = 0.5 + Math.cos(curAngle) * 0.5;\r\n\t\t\tvertices[vc++] = 0.5 + Math.sin(curAngle) * 0.5;\r\n\r\n\t\t}\r\n\r\n\t\tfor (var bi: number = 0; bi < slices; bi++) {\r\n\t\t\tindices[ic++] = 0 + verticeCount;\r\n\t\t\tindices[ic++] = bi + 2 + verticeCount;\r\n\t\t\tindices[ic++] = bi + 1 + verticeCount;\r\n\t\t}\r\n\r\n\t\tverticeCount += slices + 1 + 1;\r\n\t\treturn PrimitiveMesh._createMesh(vertexDeclaration, vertices, indices);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param radius \r\n\t * @param height \r\n\t * @param slices \r\n\t */\r\n\tstatic createCylinder(radius: number = 0.5, height: number = 2, slices: number = 32): Mesh {\r\n\t\t//(this._released) || (dispose());//\r\n\t\tvar vertexCount: number = (slices + 1 + 1) + (slices + 1) * 2 + (slices + 1 + 1);\r\n\t\tvar indexCount: number = 3 * slices + 6 * slices + 3 * slices;\r\n\r\n\t\t//\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n\t\t//,/\r\n\t\tvar vertexFloatStride: number = vertexDeclaration.vertexStride / 4;\r\n\t\t//\r\n\t\tvar vertices: Float32Array = new Float32Array(vertexCount * vertexFloatStride);\r\n\t\t//\r\n\t\tvar indices: Uint16Array = new Uint16Array(indexCount);\r\n\r\n\t\tvar sliceAngle: number = (Math.PI * 2.0) / slices;\r\n\r\n\t\tvar halfHeight: number = height / 2;\r\n\t\tvar curAngle: number = 0;\r\n\t\tvar verticeCount: number = 0;\r\n\t\tvar posX: number = 0;\r\n\t\tvar posY: number = 0;\r\n\t\tvar posZ: number = 0;\r\n\r\n\t\tvar vc: number = 0;\r\n\t\tvar ic: number = 0;\r\n\r\n\t\t//\r\n\t\tfor (var tv: number = 0; tv <= slices; tv++) {\r\n\r\n\t\t\tif (tv === 0) {\r\n\t\t\t\t//pos\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\tvertices[vc++] = halfHeight;\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\t//normal\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\tvertices[vc++] = 1;\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\t//uv\r\n\t\t\t\tvertices[vc++] = 0.5;\r\n\t\t\t\tvertices[vc++] = 0.5;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcurAngle = tv * sliceAngle;\r\n\t\t\tposX = Math.cos(curAngle) * radius;\r\n\t\t\tposY = halfHeight;\r\n\t\t\tposZ = Math.sin(curAngle) * radius;\r\n\r\n\t\t\t//pos\r\n\t\t\tvertices[vc++] = posX;\r\n\t\t\tvertices[vc++] = posY;\r\n\t\t\tvertices[vc++] = posZ;\r\n\t\t\t//normal\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc++] = 1;\r\n\t\t\tvertices[vc++] = 0;\r\n\r\n\t\t\t//uv\r\n\t\t\tvertices[vc++] = 0.5 + Math.cos(curAngle) * 0.5;\r\n\t\t\tvertices[vc++] = 0.5 + Math.sin(curAngle) * 0.5;\r\n\t\t}\r\n\r\n\t\tfor (var ti: number = 0; ti < slices; ti++) {\r\n\t\t\tindices[ic++] = 0;\r\n\t\t\tindices[ic++] = ti + 1;\r\n\t\t\tindices[ic++] = ti + 2;\r\n\t\t}\r\n\t\tverticeCount += slices + 1 + 1;\r\n\r\n\t\t//\r\n\t\tfor (var rv: number = 0; rv <= slices; rv++) {\r\n\t\t\tcurAngle = rv * sliceAngle;\r\n\t\t\tposX = Math.cos(curAngle + Math.PI) * radius;\r\n\t\t\tposY = halfHeight;\r\n\t\t\tposZ = Math.sin(curAngle + Math.PI) * radius;\r\n\r\n\t\t\t//pos\r\n\t\t\tvertices[vc++] = posX;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posX;\r\n\t\t\tvertices[vc++] = posY;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = -posY;\r\n\t\t\tvertices[vc++] = posZ;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posZ;\r\n\t\t\t//normal\r\n\t\t\tvertices[vc++] = posX;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posX;\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = 0;\r\n\t\t\tvertices[vc++] = posZ;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posZ;\r\n\t\t\t//uv    \r\n\t\t\tvertices[vc++] = 1 - rv * 1 / slices;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = 1 - rv * 1 / slices;\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = 1;\r\n\r\n\t\t}\r\n\r\n\t\tvc += (slices + 1) * 8;\r\n\r\n\t\tfor (var ri: number = 0; ri < slices; ri++) {\r\n\t\t\tindices[ic++] = ri + verticeCount + (slices + 1);\r\n\t\t\tindices[ic++] = ri + verticeCount + 1;\r\n\t\t\tindices[ic++] = ri + verticeCount;\r\n\r\n\t\t\tindices[ic++] = ri + verticeCount + (slices + 1);\r\n\t\t\tindices[ic++] = ri + verticeCount + (slices + 1) + 1;\r\n\t\t\tindices[ic++] = ri + verticeCount + 1;\r\n\r\n\t\t}\r\n\r\n\t\tverticeCount += 2 * (slices + 1);\r\n\r\n\t\t//\r\n\t\tfor (var bv: number = 0; bv <= slices; bv++) {\r\n\t\t\tif (bv === 0) {\r\n\t\t\t\t//pos\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\tvertices[vc++] = -halfHeight;\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\t//normal\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\tvertices[vc++] = -1;\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\t//uv\r\n\t\t\t\tvertices[vc++] = 0.5;\r\n\t\t\t\tvertices[vc++] = 0.5;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcurAngle = bv * sliceAngle;\r\n\t\t\tposX = Math.cos(curAngle + Math.PI) * radius;\r\n\t\t\tposY = -halfHeight;\r\n\t\t\tposZ = Math.sin(curAngle + Math.PI) * radius;\r\n\r\n\t\t\t//pos\r\n\t\t\tvertices[vc++] = posX;\r\n\t\t\tvertices[vc++] = posY;\r\n\t\t\tvertices[vc++] = posZ;\r\n\t\t\t//normal\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc++] = -1;\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\t//uv\r\n\t\t\tvertices[vc++] = 0.5 + Math.cos(curAngle) * 0.5;\r\n\t\t\tvertices[vc++] = 0.5 + Math.sin(curAngle) * 0.5;\r\n\r\n\t\t}\r\n\r\n\t\tfor (var bi: number = 0; bi < slices; bi++) {\r\n\t\t\tindices[ic++] = 0 + verticeCount;\r\n\t\t\tindices[ic++] = bi + 2 + verticeCount;\r\n\t\t\tindices[ic++] = bi + 1 + verticeCount;\r\n\t\t}\r\n\r\n\t\tverticeCount += slices + 1 + 1;\r\n\t\treturn PrimitiveMesh._createMesh(vertexDeclaration, vertices, indices);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param long  \r\n\t * @param width \r\n\t */\r\n\tstatic createPlane(long: number = 10, width: number = 10, stacks: number = 10, slices: number = 10): Mesh {\r\n\t\tvar vertexCount: number = (stacks + 1) * (slices + 1);\r\n\t\tvar indexCount: number = stacks * slices * 2 * 3;\r\n\t\tvar indices: Uint16Array = new Uint16Array(indexCount);\r\n\t\t//\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n\t\t//,/\r\n\t\tvar vertexFloatStride: number = vertexDeclaration.vertexStride / 4;\r\n\t\t//\r\n\t\tvar vertices: Float32Array = new Float32Array(vertexCount * vertexFloatStride);\r\n\r\n\t\tvar halfLong: number = long / 2;\r\n\t\tvar halfWidth: number = width / 2;\r\n\t\tvar stacksLong: number = long / stacks;\r\n\t\tvar slicesWidth: number = width / slices;\r\n\r\n\t\tvar verticeCount: number = 0;\r\n\r\n\t\tfor (var i: number = 0; i <= slices; i++) {\r\n\r\n\t\t\tfor (var j: number = 0; j <= stacks; j++) {\r\n\r\n\t\t\t\tvertices[verticeCount++] = j * stacksLong - halfLong;\r\n\t\t\t\tvertices[verticeCount++] = 0;\r\n\t\t\t\tvertices[verticeCount++] = i * slicesWidth - halfWidth;\r\n\t\t\t\tvertices[verticeCount++] = 0;\r\n\t\t\t\tvertices[verticeCount++] = 1;\r\n\t\t\t\tvertices[verticeCount++] = 0;\r\n\t\t\t\tvertices[verticeCount++] = j * 1 / stacks;\r\n\t\t\t\tvertices[verticeCount++] = i * 1 / slices;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar indiceIndex: number = 0;\r\n\r\n\t\tfor (i = 0; i < slices; i++) {\r\n\r\n\t\t\tfor (j = 0; j < stacks; j++) {\r\n\r\n\t\t\t\tindices[indiceIndex++] = (i + 1) * (stacks + 1) + j;\r\n\t\t\t\tindices[indiceIndex++] = i * (stacks + 1) + j;\r\n\t\t\t\tindices[indiceIndex++] = (i + 1) * (stacks + 1) + j + 1;\r\n\r\n\t\t\t\tindices[indiceIndex++] = i * (stacks + 1) + j;\r\n\t\t\t\tindices[indiceIndex++] = i * (stacks + 1) + j + 1;\r\n\t\t\t\tindices[indiceIndex++] = (i + 1) * (stacks + 1) + j + 1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn PrimitiveMesh._createMesh(vertexDeclaration, vertices, indices);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param long  \r\n\t * @param width \r\n\t */\r\n\tstatic createQuad(long: number = 1, width: number = 1): Mesh {\r\n\t\t//\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n\t\tvar halfLong: number = long / 2;\r\n\t\tvar halfWidth: number = width / 2;\r\n\r\n\t\tvar vertices: Float32Array = new Float32Array([-halfLong, halfWidth, 0, 0, 0, 1, 0, 0, halfLong, halfWidth, 0, 0, 0, 1, 1, 0, -halfLong, -halfWidth, 0, 0, 0, 1, 0, 1, halfLong, -halfWidth, 0, 0, 0, 1, 1, 1]);\r\n\t\tvar indices: Uint16Array = new Uint16Array([0, 1, 2, 3, 2, 1]);\r\n\r\n\t\treturn PrimitiveMesh._createMesh(vertexDeclaration, vertices, indices);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param radius \r\n\t * @param stacks \r\n\t * @param slices \r\n\t */\r\n\tstatic createSphere(radius: number = 0.5, stacks: number = 32, slices: number = 32): Mesh {\r\n\t\tvar vertexCount: number = (stacks + 1) * (slices + 1);\r\n\t\tvar indexCount: number = (3 * stacks * (slices + 1)) * 2;\r\n\r\n\t\tvar indices: Uint16Array = new Uint16Array(indexCount);\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n\t\tvar vertexFloatStride: number = vertexDeclaration.vertexStride / 4;\r\n\t\tvar vertices: Float32Array = new Float32Array(vertexCount * vertexFloatStride);\r\n\r\n\t\tvar stackAngle: number = Math.PI / stacks;\r\n\t\tvar sliceAngle: number = (Math.PI * 2.0) / slices;\r\n\r\n\t\t// Generate the group of Stacks for the sphere  \r\n\t\tvar vertexIndex: number = 0;\r\n\t\tvertexCount = 0;\r\n\t\tindexCount = 0;\r\n\r\n\t\tfor (var stack: number = 0; stack < (stacks + 1); stack++) {\r\n\t\t\tvar r: number = Math.sin(stack * stackAngle);\r\n\t\t\tvar y: number = Math.cos(stack * stackAngle);\r\n\r\n\t\t\t// Generate the group of segments for the current Stack  \r\n\t\t\tfor (var slice: number = 0; slice < (slices + 1); slice++) {\r\n\t\t\t\tvar x: number = r * Math.sin(slice * sliceAngle + Math.PI * 1 / 2);\r\n\t\t\t\tvar z: number = r * Math.cos(slice * sliceAngle + Math.PI * 1 / 2);\r\n\t\t\t\tvertices[vertexCount + 0] = x * radius;\r\n\t\t\t\tvertices[vertexCount + 1] = y * radius;\r\n\t\t\t\tvertices[vertexCount + 2] = z * radius;\r\n\r\n\t\t\t\tvertices[vertexCount + 3] = x;\r\n\t\t\t\tvertices[vertexCount + 4] = y;\r\n\t\t\t\tvertices[vertexCount + 5] = z;\r\n\r\n\t\t\t\tvertices[vertexCount + 6] = slice / slices;\r\n\t\t\t\tvertices[vertexCount + 7] = stack / stacks;\r\n\t\t\t\tvertexCount += vertexFloatStride;\r\n\t\t\t\tif (stack != (stacks - 1)) {\r\n\t\t\t\t\t// First Face\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + (slices + 1);\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex;\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + 1;\r\n\t\t\t\t\t// Second \r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + (slices);\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex;\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + (slices + 1);\r\n\t\t\t\t\tvertexIndex++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn PrimitiveMesh._createMesh(vertexDeclaration, vertices, indices);\r\n\t}\r\n}\r\n\r\n","#if !defined(Utils_lib)\r\n    #define Utils_lib\r\n\r\n#endif // Utils_lib","#define SHADER_NAME BlitFS\r\n\r\n#include \"Color.glsl\";\r\n#include \"FastApproximateAntiAliasing.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main()\r\n{\r\n#ifdef FXAA\r\n    gl_FragColor = FXAAMain(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.zw);\r\n#else\r\n    vec4 mainColor = texture2D(u_MainTex, v_Texcoord0);\r\n    #ifdef Gamma_u_MainTex\r\n    mainColor = gammaToLinear(mainColor);\r\n    #endif // Gamma_u_AlbedoTexture\r\n    gl_FragColor = mainColor;\r\n#endif\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}\r\n","import { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport BlitVS from \"./BlitScreen.vs\";\r\nimport BlitFS from \"./BlitScreen.fs\";\r\nimport FXAA from \"./FastApproximateAntiAliasing.glsl\";\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\n\r\nimport ColorGradingGLSL from \"./ColorGrading.glsl\";\r\nimport TonemappingGLSL from \"./Tonemapping.glsl\";\r\nimport LUTGLSL from \"./LUT.glsl\";\r\n\r\nimport LUTBuilderFS from \"./LUTBuilder.fs\";\r\n\r\nexport class BlitScreenShaderInit {\r\n\r\n    static init() {\r\n        Shader3D.addInclude(\"FastApproximateAntiAliasing.glsl\", FXAA);\r\n\r\n        Shader3D.addInclude(\"ColorGrading.glsl\", ColorGradingGLSL);\r\n        Shader3D.addInclude(\"Tonemapping.glsl\", TonemappingGLSL);\r\n        Shader3D.addInclude(\"LUT.glsl\", LUTGLSL);\r\n\r\n        let attributeMap: { [name: string]: [number, ShaderDataType] } = {\r\n            \"a_PositionTexcoord\": [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n        };\r\n\r\n        let uniformMap = {\r\n            \"u_OffsetScale\": ShaderDataType.Vector4,\r\n            \"u_MainTex\": ShaderDataType.Texture2D,\r\n            \"u_MainTex_TexelSize\": ShaderDataType.Vector4, //x:width,y:height,z:1/width,w:1/height\r\n        };\r\n\r\n        let shader = Shader3D.add(\"BlitScreen\");\r\n        let subShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(subShader);\r\n        let blitPass = subShader.addShaderPass(BlitVS, BlitFS);\r\n        blitPass.statefirst = true;\r\n        let blitState = blitPass.renderState;\r\n        blitState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n        blitState.depthWrite = false;\r\n        blitState.cull = RenderState.CULL_NONE;\r\n        blitState.blend = RenderState.BLEND_DISABLE;\r\n\r\n        let transparentShader = Shader3D.add(\"BlitScreen_Transparnet\");\r\n        let transparentSubShader = new SubShader(attributeMap, uniformMap);\r\n        transparentShader.addSubShader(transparentSubShader);\r\n        let blitPassTrans = transparentSubShader.addShaderPass(BlitVS, BlitFS);\r\n        blitPass.statefirst = true;\r\n        blitState = blitPassTrans.renderState;\r\n        blitState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n        blitState.depthWrite = false;\r\n        blitState.cull = RenderState.CULL_NONE;\r\n        blitState.blend = RenderState.BLEND_ENABLE_ALL;\r\n        blitState.srcBlend = RenderState.BLENDPARAM_SRC_ALPHA;\r\n        blitState.dstBlend = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n\r\n        this.lutBuilderInit();\r\n    }\r\n\r\n    private static lutBuilderInit() {\r\n\r\n        let attributeMap: { [name: string]: [number, ShaderDataType] } = {\r\n            \"a_PositionTexcoord\": [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n        };\r\n\r\n        let uniformMap = {\r\n            \"u_OffsetScale\": ShaderDataType.Vector4,\r\n            \"u_MainTex\": ShaderDataType.Texture2D,\r\n            \"u_MainTex_TexelSize\": ShaderDataType.Vector4, //x:width,y:height,z:1/width,w:1/height\r\n            \"u_LutParams\": ShaderDataType.Vector4\r\n        };\r\n\r\n        let shader = Shader3D.add(\"LUTBuilder\");\r\n        let subShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(subShader);\r\n        let pass = subShader.addShaderPass(BlitVS, LUTBuilderFS);\r\n        pass.renderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n        pass.renderState.depthWrite = false;\r\n        pass.renderState.cull = RenderState.CULL_NONE;\r\n        pass.renderState.blend = RenderState.BLEND_DISABLE;\r\n        pass.statefirst = true;\r\n    }\r\n\r\n}","#if !defined(FXAA_lib)\r\n    #define FXAA_lib\r\n#ifdef FXAA\r\n    #define EDGE_THRESHOLD_MIN 0.0312\r\n    #define EDGE_THRESHOLD_MAX 0.125\r\n    #define QUALITY(q)\t       ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))\r\n    #define ITERATIONS\t       12\r\n    #define SUBPIXEL_QUALITY   0.75\r\n\r\nfloat rgb2luma(in vec3 rgb)\r\n{\r\n    return dot(rgb, vec3(0.299, 0.587, 0.114));\r\n}\r\n\r\nvec3 textureOffsetbyScreenSize(in sampler2D mainTex, in vec2 uv, in vec2 offset, in vec2 inverseScreenSize)\r\n{\r\n    vec2 sampleruv = uv + inverseScreenSize * offset; // u_texturesize\r\n    return texture2D(mainTex, sampleruv).rgb;\r\n}\r\n\r\nvec4 FXAAMain(in sampler2D mainTex, in vec2 texuv, in vec2 inverseScreenSize)\r\n{\r\n\r\n    vec4 mainColor = texture2D(mainTex, texuv);\r\n    vec3 colorCenter = mainColor.rgb;\r\n    // Luma at the current fragment\r\n    float lumaCenter = rgb2luma(colorCenter);\r\n\r\n    // Luma at the four direct neighbours of the current fragment.\r\n    float lumaDown = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(0, -1), inverseScreenSize));\r\n    float lumaUp = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(0, 1), inverseScreenSize));\r\n    float lumaLeft = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(-1, 0), inverseScreenSize));\r\n    float lumaRight = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(1, 0), inverseScreenSize));\r\n\r\n    // Find the maximum and minimum luma around the current fragment.\r\n    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));\r\n    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));\r\n\r\n    // Compute the delta.\r\n    float lumaRange = lumaMax - lumaMin;\r\n\r\n    // If the luma variation is lower that a threshold (or if we are in a really dark area), we are not on an edge, don't perform any AA.\r\n    if (lumaRange < max(EDGE_THRESHOLD_MIN, lumaMax * EDGE_THRESHOLD_MAX))\r\n\t{\r\n\t    return mainColor;\r\n\t}\r\n\r\n    // Query the 4 remaining corners lumas.\r\n    float lumaDownLeft = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(-1, -1), inverseScreenSize));\r\n    float lumaUpRight = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(1, 1), inverseScreenSize));\r\n    float lumaUpLeft = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(-1, 1), inverseScreenSize));\r\n    float lumaDownRight = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(1, -1), inverseScreenSize));\r\n\r\n    // Combine the four edges lumas (using intermediary variables for future computations with the same values).\r\n    float lumaDownUp = lumaDown + lumaUp;\r\n    float lumaLeftRight = lumaLeft + lumaRight;\r\n\r\n    // Same for corners\r\n    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;\r\n    float lumaDownCorners = lumaDownLeft + lumaDownRight;\r\n    float lumaRightCorners = lumaDownRight + lumaUpRight;\r\n    float lumaUpCorners = lumaUpRight + lumaUpLeft;\r\n\r\n    // Compute an estimation of the gradient along the horizontal and vertical axis.\r\n    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);\r\n    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);\r\n\r\n    // Is the local edge horizontal or vertical ?\r\n    bool isHorizontal = (edgeHorizontal >= edgeVertical);\r\n\r\n    // Choose the step size (one pixel) accordingly.\r\n    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;\r\n\r\n    // Select the two neighboring texels lumas in the opposite direction to the local edge.\r\n    float luma1 = isHorizontal ? lumaDown : lumaLeft;\r\n    float luma2 = isHorizontal ? lumaUp : lumaRight;\r\n    // Compute gradients in this direction.\r\n    float gradient1 = luma1 - lumaCenter;\r\n    float gradient2 = luma2 - lumaCenter;\r\n\r\n    // Which direction is the steepest ?\r\n    bool is1Steepest = abs(gradient1) >= abs(gradient2);\r\n\r\n    // Gradient in the corresponding direction, normalized.\r\n    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));\r\n\r\n    // Average luma in the correct direction.\r\n    float lumaLocalAverage = 0.0;\r\n    if (is1Steepest)\r\n\t{\r\n\t    // Switch the direction\r\n\t    stepLength = -stepLength;\r\n\t    lumaLocalAverage = 0.5 * (luma1 + lumaCenter);\r\n\t}\r\n    else\r\n\t{\r\n\t    lumaLocalAverage = 0.5 * (luma2 + lumaCenter);\r\n\t}\r\n\r\n    // Shift UV in the correct direction by half a pixel.\r\n    vec2 currentUv = texuv;\r\n    if (isHorizontal)\r\n\t{\r\n\t    currentUv.y += stepLength * 0.5;\r\n\t}\r\n    else\r\n\t{\r\n\t    currentUv.x += stepLength * 0.5;\r\n\t}\r\n\r\n    // Compute offset (for each iteration step) in the right direction.\r\n    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);\r\n    // Compute UVs to explore on each side of the edge, orthogonally. The QUALITY allows us to step faster.\r\n    vec2 uv1 = currentUv - offset * QUALITY(0);\r\n    vec2 uv2 = currentUv + offset * QUALITY(0);\r\n\r\n    // Read the lumas at both current extremities of the exploration segment, and compute the delta wrt to the local average luma.\r\n    float lumaEnd1 = rgb2luma(textureOffsetbyScreenSize(mainTex, uv1, vec2(0.0, 0.0), inverseScreenSize));\r\n    float lumaEnd2 = rgb2luma(textureOffsetbyScreenSize(mainTex, uv2, vec2(0.0, 0.0), inverseScreenSize));\r\n    lumaEnd1 -= lumaLocalAverage;\r\n    lumaEnd2 -= lumaLocalAverage;\r\n\r\n    // If the luma deltas at the current extremities is larger than the local gradient, we have reached the side of the edge.\r\n    bool reached1 = abs(lumaEnd1) >= gradientScaled;\r\n    bool reached2 = abs(lumaEnd2) >= gradientScaled;\r\n    bool reachedBoth = reached1 && reached2;\r\n\r\n    // If the side is not reached, we continue to explore in this direction.\r\n    if (!reached1)\r\n\t{\r\n\t    uv1 -= offset * QUALITY(1);\r\n\t}\r\n    if (!reached2)\r\n\t{\r\n\t    uv2 += offset * QUALITY(1);\r\n\t}\r\n\r\n    // If both sides have not been reached, continue to explore.\r\n    if (!reachedBoth)\r\n\t{\r\n\r\n\t    for (int i = 2; i < ITERATIONS; i++)\r\n\t\t{\r\n\t\t    // If needed, read luma in 1st direction, compute delta.\r\n\t\t    if (!reached1)\r\n\t\t\t{\r\n\t\t\t    lumaEnd1 = rgb2luma(textureOffsetbyScreenSize(mainTex, uv1, vec2(0.0, 0.0), inverseScreenSize));\r\n\t\t\t    lumaEnd1 = lumaEnd1 - lumaLocalAverage;\r\n\t\t\t}\r\n\t\t    // If needed, read luma in opposite direction, compute delta.\r\n\t\t    if (!reached2)\r\n\t\t\t{\r\n\t\t\t    lumaEnd2 = rgb2luma(textureOffsetbyScreenSize(mainTex, uv2, vec2(0.0, 0.0), inverseScreenSize));\r\n\t\t\t    lumaEnd2 = lumaEnd2 - lumaLocalAverage;\r\n\t\t\t}\r\n\t\t    // If the luma deltas at the current extremities is larger than the local gradient, we have reached the side of the edge.\r\n\t\t    reached1 = abs(lumaEnd1) >= gradientScaled;\r\n\t\t    reached2 = abs(lumaEnd2) >= gradientScaled;\r\n\t\t    reachedBoth = reached1 && reached2;\r\n\r\n\t\t    // If the side is not reached, we continue to explore in this direction, with a variable quality.\r\n\t\t    if (!reached1)\r\n\t\t\t{\r\n\t\t\t    uv1 -= offset * QUALITY(i);\r\n\t\t\t}\r\n\t\t    if (!reached2)\r\n\t\t\t{\r\n\t\t\t    uv2 += offset * QUALITY(i);\r\n\t\t\t}\r\n\r\n\t\t    // If both sides have been reached, stop the exploration.\r\n\t\t    if (reachedBoth)\r\n\t\t\t{\r\n\t\t\t    break;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n    // Compute the distances to each side edge of the edge (!).\r\n    float distance1 = isHorizontal ? (texuv.x - uv1.x) : (texuv.y - uv1.y);\r\n    float distance2 = isHorizontal ? (uv2.x - texuv.x) : (uv2.y - texuv.y);\r\n\r\n    // In which direction is the side of the edge closer ?\r\n    bool isDirection1 = distance1 < distance2;\r\n    float distanceFinal = min(distance1, distance2);\r\n\r\n    // Thickness of the edge.\r\n    float edgeThickness = (distance1 + distance2);\r\n\r\n    // Is the luma at center smaller than the local average ?\r\n    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;\r\n\r\n    // If the luma at center is smaller than at its neighbour, the delta luma at each end should be positive (same variation).\r\n    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;\r\n    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;\r\n\r\n    // Only keep the result in the direction of the closer side of the edge.\r\n    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;\r\n\r\n    // UV offset: read in the direction of the closest side of the edge.\r\n    float pixelOffset = -distanceFinal / edgeThickness + 0.5;\r\n\r\n    // If the luma variation is incorrect, do not offset.\r\n    float finalOffset = correctVariation ? pixelOffset : 0.0;\r\n\r\n    // Sub-pixel shifting\r\n    // Full weighted average of the luma over the 3x3 neighborhood.\r\n    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);\r\n    // Ratio of the delta between the global average and the center luma, over the luma range in the 3x3 neighborhood.\r\n    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);\r\n    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;\r\n    // Compute a sub-pixel offset based on this delta.\r\n    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * SUBPIXEL_QUALITY;\r\n\r\n    // Pick the biggest of the two offsets.\r\n    finalOffset = max(finalOffset, subPixelOffsetFinal);\r\n\r\n    // Compute the final UV coordinates.\r\n    vec2 finalUv = texuv;\r\n    if (isHorizontal)\r\n\t{\r\n\t    finalUv.y += finalOffset * stepLength;\r\n\t}\r\n    else\r\n\t{\r\n\t    finalUv.x += finalOffset * stepLength;\r\n\t}\r\n\r\n    // Read the color at the new UV coordinates, and use it.\r\n    return texture2D(mainTex, finalUv);\r\n}\r\n#endif//FXAA\r\n#endif // Color_lib\r\n","#if !defined(ColorGrading_lib)\r\n    #define ColorGrading_lib\r\n\r\nconst float ACEScc_MAX = 1.4679964;\r\nconst float ACEScc_MIDGRAY = 0.4135884;\r\n\r\nconst float LogC_cut = 0.011361;\r\nconst float LogC_a = 5.555556;\r\nconst float LogC_b = 0.047996;\r\nconst float LogC_c = 0.244161;\r\nconst float LogC_d = 0.386036;\r\nconst float LogC_e = 5.301883;\r\nconst float LogC_f = 0.092819;\r\n\r\nfloat linearToLogC(float x)\r\n{\r\n    float o;\r\n    if (x > LogC_cut)\r\n\t{\r\n\t    o = LogC_c * log10(max(LogC_a * x + LogC_b, 0.0)) + LogC_d;\r\n\t}\r\n    else\r\n\t{\r\n\t    o = LogC_e * x + LogC_f;\r\n\t}\r\n    return o;\r\n}\r\n\r\nvec3 linearToLogC(vec3 x)\r\n{\r\n    vec3 logc;\r\n    logc.x = linearToLogC(x.x);\r\n    logc.y = linearToLogC(x.y);\r\n    logc.z = linearToLogC(x.z);\r\n    return logc;\r\n}\r\n\r\nfloat logCToLinear(float x)\r\n{\r\n    float o;\r\n    if (x > LogC_e * LogC_cut + LogC_f)\r\n\to = (pow(10.0, (x - LogC_d) / LogC_c) - LogC_b) / LogC_a;\r\n    else\r\n\to = (x - LogC_f) / LogC_e;\r\n    return o;\r\n}\r\n\r\nvec3 logCToLinear(vec3 x)\r\n{\r\n    vec3 linear;\r\n    linear.x = logCToLinear(x.x);\r\n    linear.y = logCToLinear(x.y);\r\n    linear.z = logCToLinear(x.z);\r\n    return linear;\r\n}\r\n\r\n// Hue, Saturation, Value\r\n// Ranges:\r\n//  Hue [0.0, 1.0]\r\n//  Sat [0.0, 1.0]\r\n//  Lum [0.0, HALF_MAX]\r\nvec3 RgbToHsv(vec3 c)\r\n{\r\n    const vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\r\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\r\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\r\n    float d = q.x - min(q.w, q.y);\r\n    const float e = 1.0e-4;\r\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\r\n}\r\n\r\nvec3 HsvToRgb(vec3 c)\r\n{\r\n    const vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n    vec3 p = abs(fract(vec3(c.x) + K.xyz) * 6.0 - K.www);\r\n    return c.z * mix(vec3(K.x) , saturate(p - vec3(K.x)), c.y);\r\n}\r\n\r\nfloat RotateHue(float value, float low, float hi)\r\n{\r\n    return (value < low)\r\n            ? value + hi\r\n            : (value > hi)\r\n                ? value - hi\r\n                : value;\r\n}\r\n\r\n\r\nconst mat3 Linear_to_LMS_MAT = mat3(\r\n    vec3(3.90405e-1, 7.08416e-2, 2.31082e-2),\r\n    vec3(5.49941e-1, 9.63172e-1, 1.28021e-1),\r\n    vec3(8.92632e-3, 1.35775e-3, 9.36245e-1));\r\n\r\nconst mat3 LMS_to_Linear_MAT = mat3(\r\n    vec3(2.85847e+0, -2.10182e-1, -4.18120e-2),\r\n    vec3(-1.62879e+0, 1.15820e+0, -1.18169e-1),\r\n    vec3(-2.48910e-2, 3.24281e-4, 1.06867e+0));\r\n\r\n// white balance\r\nuniform vec3 u_ColorBalance;\r\n\r\n// split toning\r\nuniform vec4 u_SplitShadows;\r\nuniform vec3 u_Splithighlights;\r\n\r\n// shadows, midtones, highlights\r\nuniform vec3 u_Shadows;\r\nuniform vec3 u_Midtones;\r\nuniform vec3 u_Highlights;\r\nuniform vec4 u_Limits;\r\n\r\n// lift, gamma, gain\r\nuniform vec3 u_Lift;\r\nuniform vec3 u_Gamma;\r\nuniform vec3 u_Gain;\r\n\r\n//color adjusted\r\nuniform vec4 u_ColorFilter;\r\nuniform vec4 u_HueSatCon;\r\n\r\nfloat luminance(in vec3 color)\r\n{\r\n    #ifdef ACES\r\n    float luma = dot(color, AP1_RGB2Y);\r\n    #else\r\n    float luma = dot(color, vec3(0.2126729, 0.7151522, 0.0721750));\r\n    #endif // ACES\r\n    return luma;\r\n}\r\n\r\nvec3 softlight(vec3 base, vec3 blend)\r\n{\r\n    vec3 r1 = 2.0 * base * blend + base * base * (1.0 - 2.0 * blend);\r\n    vec3 r2 = sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend);\r\n    vec3 t = step(0.5, blend);\r\n    return r2 * t + (1.0 - t) * r1;\r\n}\r\n\r\n// input linear sRGB\r\n// if ACES tonemap, calculate in ACEScg, return ACEScg\r\n// else calculate in logC, return linear sRGB\r\nvec3 colorGrade(in vec3 color)\r\n{\r\n    // White balance in LMS space\r\n    vec3 colorLMS = Linear_to_LMS_MAT * color;\r\n    colorLMS *= u_ColorBalance.xyz;\r\n    color = LMS_to_Linear_MAT * colorLMS;\r\n\r\n    // Do contrast in log after white balance\r\n    #ifdef ACES\r\n        vec3 colorLog = ACES_to_ACEScc(sRGB_to_AP0_MAT * color);\r\n    #else\r\n        vec3 colorLog = linearToLogC(color);\r\n    #endif\r\n    \r\n    colorLog = (colorLog - vec3(ACEScc_MIDGRAY)) * u_HueSatCon.z + vec3(ACEScc_MIDGRAY);\r\n\r\n\r\n    #ifdef ACES\r\n        //colorLinear = ACES_to_ACEScg(ACEScc_to_ACES(colorLog));\r\n        color = AP0_to_AP1_MAT * ACEScc_to_ACES(colorLog);\r\n    #else\r\n        color = logCToLinear(colorLog);\r\n    #endif // ACES\r\n\r\n    // Color filter is just an unclipped multiplier\r\n    color = color * u_ColorFilter.rgb;\r\n\r\n    color = max(vec3(0.0), color);\r\n\r\n    // split toning\r\n    float balance = u_SplitShadows.w;\r\n    vec3 gamma = linearToGamma(color);\r\n    float splitLuma = saturate(luminance(color)) + balance;\r\n    vec3 splitShadows = mix(vec3(0.5, 0.5, 0.5), u_SplitShadows.xyz, 1.0 - splitLuma);\r\n    vec3 splitHeighlights = mix(vec3(0.5, 0.5, 0.5), u_Splithighlights.xyz, splitLuma);\r\n    gamma = softlight(gamma, splitShadows);\r\n    gamma = softlight(gamma, splitHeighlights);\r\n    color = gammaToLinear(gamma);\r\n\r\n    // shadows, midtones, highlights\r\n    float luma = luminance(color);\r\n    float shadowFactor = 1.0 - smoothstep(u_Limits.x, u_Limits.y, luma);\r\n    float highlightsFactor = smoothstep(u_Limits.z, u_Limits.w, luma);\r\n    float midtonesFactor = 1.0 - shadowFactor - highlightsFactor;\r\n    color = color * u_Shadows.xyz * shadowFactor + color * u_Midtones.xyz * midtonesFactor + color * u_Highlights.xyz * highlightsFactor;\r\n\r\n    // Lift, gamma, gain\r\n    color = color * u_Gain.xyz + u_Lift.xyz;\r\n    color = sign(color) * pow(abs(color), u_Gamma.xyz);\r\n    \r\n    // HSV operations\r\n    vec3 hsv = RgbToHsv(color);\r\n    // Hue Shift & Hue Vs Hue\r\n    float hue = hsv.x + u_HueSatCon.x;\r\n    hsv.x = RotateHue(hsv.x, 0.0, 1.0);\r\n    color = HsvToRgb(hsv);\r\n\r\n    // Global saturation\r\n    luma = luminance(color);\r\n    color = vec3(luma) + (vec3(u_HueSatCon.y)) * (color - vec3(luma));\r\n    \r\n    return color;\r\n}\r\n\r\n#endif // ColorGrading_lib","#if !defined(Tonemapping_lib)\r\n    #define Tonemapping_lib\r\n\r\n// ACES Tonemapping color grading in ACEScg space\r\nvec3 tonemap(in vec3 ap1)\r\n{\r\n    vec3 color = ap1;\r\n\r\n    #ifdef ACES\r\n    vec3 aces = AP1_to_AP0_MAT * color;\r\n    vec3 oces = RRT(aces);\r\n    color = ODT_sRGB_100nits(oces);\r\n    #endif // ACES\r\n\r\n    // todo other tonemap\r\n\r\n    return color;\r\n}\r\n\r\n#endif // Tonemapping_lib","#if !defined(LUT_lib)\r\n    #define LUT_lib\r\n\r\n// scaleOffset = (1 / lut_width, 1 / lut_height, lut_height - 1)\r\nvec3 applyLut(sampler2D lut, vec3 uvw, vec3 scaleOffset)\r\n{\r\n    uvw.z *= scaleOffset.z;\r\n\r\n    float shift = floor(uvw.z);\r\n    uvw.xy = uvw.xy * scaleOffset.z * scaleOffset.xy + scaleOffset.xy * 0.5;\r\n    uvw.x += shift * scaleOffset.y;\r\n\r\n    uvw.xyz = mix(\r\n\ttexture2DLodEXT(lut, uvw.xy, 0.0).rgb,\r\n\ttexture2DLodEXT(lut, uvw.xy + vec2(scaleOffset.y, 0.0), 0.0).rgb,\r\n\tuvw.z - shift);\r\n    return uvw;\r\n}\r\n\r\n#endif // LUT_lib","#define SHADER_NAME LutBuilder\r\n\r\n#include \"Color.glsl\";\r\n\r\n#ifdef ACES\r\n    #include \"ACES.glsl\";\r\n#endif // ACES\r\n\r\n#include \"ColorGrading.glsl\";\r\n\r\n#include \"Tonemapping.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\n// lut params: (lutHeight, 0.5 / lutWidth, 0.5 / lutHeight, lutHeidht / (lutHeight - 1))\r\nvec3 lutValue(vec2 uv, vec4 params)\r\n{\r\n    vec3 color;\r\n    uv -= params.yz;\r\n    color.r = fract(uv.x * params.x);\r\n    color.b = uv.x - color.r / params.x;\r\n    color.g = uv.y;\r\n    return color * params.w;\r\n}\r\n\r\n// internal lut logC space\r\nvoid main()\r\n{\r\n    vec2 uv = v_Texcoord0;\r\n    vec3 color = lutValue(uv, u_LutParams);\r\n    color = logCToLinear(color);\r\n    vec3 grade = colorGrade(color);\r\n    vec3 tone = tonemap(grade);\r\n\r\n    gl_FragColor = vec4(tone, 1.0);\r\n}","\r\n#define SHADER_NAME UnlitVS\r\n\r\n#include \"Math.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n#include \"SceneFogInput.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DVertex.glsl\";\r\n\r\n#include \"VertexCommon.glsl\";\r\n\r\n#ifdef UV\r\nvarying vec2 v_Texcoord0;\r\n#endif // UV\r\n\r\n#ifdef COLOR\r\nvarying vec4 v_VertexColor;\r\n#endif // COLOR\r\n\r\nvoid main()\r\n{\r\n    Vertex vertex;\r\n    getVertexParams(vertex);\r\n\r\n#ifdef UV\r\n    v_Texcoord0 = transformUV(vertex.texCoord0, u_TilingOffset);\r\n#endif // UV\r\n\r\n#ifdef COLOR\r\n    v_VertexColor = vertex.vertexColor;\r\n#endif // COLOR\r\n\r\n    mat4 worldMat = getWorldMatrix();\r\n    vec4 pos = (worldMat * vec4(vertex.positionOS, 1.0));\r\n    vec3 positionWS = pos.xyz / pos.w;\r\n\r\n    gl_Position = getPositionCS(positionWS);\r\n\r\n    gl_Position = remapPositionZ(gl_Position);\r\n\r\n#ifdef FOG\r\n    FogHandle(gl_Position.z);\r\n#endif\r\n}\r\n","#define SHADER_NAME DepthVS\r\n\r\n#include \"DepthVertex.glsl\";\r\n\r\nvoid main()\r\n{\r\n    Vertex vertex;\r\n    getVertexParams(vertex);\r\n\r\n    mat4 worldMat = getWorldMatrix();\r\n    vec4 pos = (worldMat * vec4(vertex.positionOS, 1.0));\r\n    vec3 positionWS = pos.xyz / pos.w;\r\n\r\n    mat4 normalMat = transpose(inverse(worldMat));\r\n    vec3 normalWS = normalize((normalMat * vec4(vertex.normalOS, 0.0)).xyz);\r\n\r\n    vec4 positionCS = DepthPositionCS(positionWS, normalWS);\r\n    gl_Position = remapPositionZ(positionCS);\r\n}","#define SHADER_NAME DepthFS\r\n\r\n#include \"DepthFrag.glsl\";\r\n\r\nvoid main()\r\n{\r\n    gl_FragColor = getDepthColor();\r\n}","import UnlitVS from \"./Unlit.vs\";\r\nimport UnlitFS from \"./Unlit.fs\";\r\nimport DepthVS from \"../depth/Depth.vs\";\r\nimport DepthFS from \"../depth/Depth.fs\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\n\r\n\r\nexport class UnlitShaderInit {\r\n\r\n    static init() {\r\n\r\n        let uniformMap = {\r\n            \"UnlitBlock\": {\r\n                \"u_AlbedoColor\": ShaderDataType.Color,\r\n                \"u_TilingOffset\": ShaderDataType.Vector4,\r\n            },\r\n            \"u_AlbedoTexture\": ShaderDataType.Texture2D,\r\n            \"u_AlphaTestValue\": ShaderDataType.Float,\r\n        };\r\n\r\n        let defaultValue = {\r\n            \"u_AlbedoColor\": Color.WHITE,\r\n            \"u_TilingOffset\": new Vector4(1, 1, 0, 0),\r\n            \"u_AlphaTestValue\": 0.5\r\n        }\r\n\r\n        let shader = Shader3D.add(\"Unlit\", true, false);\r\n        let subShader = new SubShader(SubShader.DefaultAttributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        let forwardPass = subShader.addShaderPass(UnlitVS, UnlitFS);\r\n        let shadowPass = subShader.addShaderPass(DepthVS, DepthFS, \"ShadowCaster\");\r\n    }\r\n}","\r\n#define SHADER_NAME UNLITFS\r\n\r\n#include \"Color.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n#include \"SceneFog.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DFrag.glsl\";\r\n\r\n#ifdef UV\r\nvarying vec2 v_Texcoord0;\r\n#endif // UV\r\n\r\n#ifdef COLOR\r\nvarying vec4 v_VertexColor;\r\n#endif // COLOR\r\n\r\nvoid main()\r\n{\r\n    vec3 color = u_AlbedoColor.rgb;\r\n    float alpha = u_AlbedoColor.a;\r\n\r\n#ifdef COLOR\r\n    #ifdef ENABLEVERTEXCOLOR\r\n    vec4 vertexColor = v_VertexColor;\r\n    color *= vertexColor.rgb;\r\n    alpha *= vertexColor.a;\r\n    #endif // ENABLEVERTEXCOLOR\r\n#endif // COLOR\r\n\r\n#ifdef UV\r\n    vec2 uv = v_Texcoord0;\r\n\r\n    #ifdef ALBEDOTEXTURE\r\n    vec4 albedoSampler = texture2D(u_AlbedoTexture, uv);\r\n\r\n\t#ifdef Gamma_u_AlbedoTexture\r\n    albedoSampler = gammaToLinear(albedoSampler);\r\n\t#endif // Gamma_u_AlbedoTexture\r\n\r\n    color *= albedoSampler.rgb;\r\n    alpha *= albedoSampler.a;\r\n    #endif // ALBEDOTEXTURE\r\n#endif // UV\r\n\r\n#ifdef ALPHATEST\r\n    if (alpha < u_AlphaTestValue)\r\n\tdiscard;\r\n#endif // ALPHATEST\r\n\r\n#ifdef FOG\r\n    color = scenUnlitFog(color);\r\n#endif // FOG\r\n\r\n    gl_FragColor = vec4(color, alpha);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","import { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport BlinnPhongCommonGLSL from \"./BlinnPhongCommon.glsl\";\r\nimport BlinnPhongVertexGLSL from \"./BlinnPhongVertex.glsl\";\r\nimport BlinnPhongFragGLSL from \"./BlinnPhongFrag.glsl\";\r\nimport BlinnPhongVS from \"./BlinnPhong.vs\";\r\nimport BlinnPhongFS from \"./BlinnPhong.fs\";\r\nimport DepthVS from \"../depth/Depth.vs\";\r\nimport DepthFS from \"../depth/Depth.fs\";\r\nimport DepthNormalVS from \"./BlinnPhongDepthNormal.vs\";\r\nimport DepthNormalFS from \"./BlinnPhongDepthNormal.fs\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\n\r\nexport class BlinnPhongShaderInit {\r\n\r\n    static init() {\r\n\r\n        Shader3D.addInclude(\"BlinnPhongCommon.glsl\", BlinnPhongCommonGLSL);\r\n        Shader3D.addInclude(\"BlinnPhongVertex.glsl\", BlinnPhongVertexGLSL);\r\n        Shader3D.addInclude(\"BlinnPhongFrag.glsl\", BlinnPhongFragGLSL);\r\n\r\n        let uniformMap = {\r\n            \"u_AlphaTestValue\": ShaderDataType.Float,\r\n            \"u_TilingOffset\": ShaderDataType.Vector4,\r\n\r\n            \"u_DiffuseColor\": ShaderDataType.Color,\r\n            \"u_DiffuseTexture\": ShaderDataType.Texture2D,\r\n            \"u_AlbedoIntensity\": ShaderDataType.Float,\r\n\r\n            \"u_MaterialSpecular\": ShaderDataType.Color,\r\n            \"u_SpecularTexture\": ShaderDataType.Texture2D,\r\n\r\n            \"u_Shininess\": ShaderDataType.Float,\r\n\r\n            \"u_NormalTexture\": ShaderDataType.Texture2D,\r\n        };\r\n\r\n        let defaultValue = {\r\n            \"u_AlbedoIntensity\": 1.0,\r\n            \"u_DiffuseColor\": Color.WHITE,\r\n            \"u_MaterialSpecular\": Color.WHITE,\r\n            \"u_Shininess\": 0.078125,\r\n            \"u_AlphaTestValue\": 0.5,\r\n            \"u_TilingOffset\": new Vector4(1, 1, 0, 0),\r\n        };\r\n\r\n        let shader = Shader3D.add(\"BLINNPHONG\", true, true);\r\n        let subShader = new SubShader(SubShader.DefaultAttributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        let shadingPass = subShader.addShaderPass(BlinnPhongVS, BlinnPhongFS);\r\n        let shadowPass = subShader.addShaderPass(DepthVS, DepthFS, \"ShadowCaster\");\r\n        let depthNormal = subShader.addShaderPass(DepthNormalVS, DepthNormalFS, \"DepthNormal\");\r\n    }\r\n\r\n}","#if !defined(BlinnPhongCommon_lib)\r\n    #define BlinnPhongCommon_lib\r\n\r\n// varying\r\nvarying vec3 v_PositionWS;\r\n// todo\r\nvarying vec3 v_NormalWS;\r\nvarying vec3 v_TangentWS;\r\nvarying vec3 v_BiNormalWS;\r\n\r\n    #ifdef UV\r\nvarying vec2 v_Texcoord0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\nvarying vec2 v_Texcoord1;\r\n\t#endif // LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\nvarying vec4 v_VertexColor;\r\n    #endif // COLOR\r\n\r\n// , vsfs\r\nstruct PixelParams {\r\n    vec3 positionWS;\r\n\r\n    vec3 normalWS;\r\n    vec3 tangentWS;\r\n    vec3 biNormalWS;\r\n    mat3 TBN;\r\n\r\n    #ifdef UV\r\n    vec2 uv0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\n    vec2 uv1;\r\n\t#endif // LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    vec4 vertexColor;\r\n    #endif // COLOR\r\n};\r\n\r\n#endif // BlinnPhongCommon_lib","#if !defined(BlinnPhongVertex_lib)\r\n    #define BlinnPhongVertex_lib\r\n\r\n    #include \"ShadingVertex.glsl\";\r\n\r\nvoid initPixelParams(inout PixelParams params, in Vertex vertex)\r\n{\r\n    shadingPixelParams(params, vertex);\r\n    sharePixelParams(params);\r\n}\r\n\r\n#endif // BlinnPhongVertex_lib","#if !defined(BlinnPhongFrag_lib)\r\n    #define BlinnPhongFrag_lib\r\n\r\n    #include \"BlinnPhongLighting.glsl\";\r\n\r\n    #include \"ShadingFrag.glsl\";\r\n\r\nvoid getPixelInfo(inout PixelInfo info, const in PixelParams pixel, const in Surface surface)\r\n{\r\n    info.positionWS = pixel.positionWS;\r\n\r\n    info.vertexNormalWS = pixel.normalWS;\r\n\r\n    #ifdef TANGENT\r\n    info.normalWS = normalize(pixel.TBN * surface.normalTS);\r\n    #else // TANGENT\r\n    info.normalWS = pixel.normalWS;\r\n    #endif // TANGENT\r\n\r\n    info.viewDir = normalize(u_CameraPos - info.positionWS);\r\n\r\n    #ifdef LIGHTMAP\r\n\t#ifdef UV1\r\n    info.lightmapUV = pixel.uv1;\r\n\t#endif // UV1\r\n    #endif // LIGHTMAP\r\n}\r\n\r\nvec3 BlinnPhongLighting(const in Surface surface, const in PixelParams pixel)\r\n{\r\n    PixelInfo info;\r\n    getPixelInfo(info, pixel, surface);\r\n\r\n    vec3 positionWS = info.positionWS;\r\n    vec3 normalWS = info.normalWS;\r\n    vec3 v = info.viewDir;\r\n\r\n    vec3 lightColor = vec3(0.0, 0.0, 0.0);\r\n\r\n    #ifdef DIRECTIONLIGHT\r\n    for (int i = 0; i < CalculateLightCount; i++)\r\n\t{\r\n\t    if (i >= DirectionCount)\r\n\t\tbreak;\r\n\t    DirectionLight directionLight = getDirectionLight(i, positionWS);\r\n\t    if (directionLight.lightMode == LightMode_Mix)\r\n\t\t{\r\n\t\t    continue;\r\n\t\t}\r\n\t    Light light = getLight(directionLight);\r\n\t    lightColor += BlinnPhongLighting(surface, light, info) * light.attenuation;\r\n\t}\r\n    #endif // DIRECTIONLIGHT\r\n\r\n    #if defined(POINTLIGHT) || defined(SPOTLIGHT)\r\n    ivec4 clusterInfo = getClusterInfo(u_View, u_Viewport, positionWS, gl_FragCoord, u_ProjectionParams);\r\n    #endif // POINTLIGHT || SPOTLIGHT\r\n\r\n    #ifdef POINTLIGHT\r\n    for (int i = 0; i < CalculateLightCount; i++)\r\n\t{\r\n\t    if (i >= clusterInfo.x)\r\n\t\tbreak;\r\n\t    PointLight pointLight = getPointLight(i, clusterInfo, positionWS);\r\n\t    if (pointLight.lightMode == LightMode_Mix)\r\n\t\t{\r\n\t\t    continue;\r\n\t\t}\r\n\t    Light light = getLight(pointLight, normalWS, positionWS);\r\n\t    lightColor += BlinnPhongLighting(surface, light, info) * light.attenuation;\r\n\t}\r\n    #endif // POINTLIGHT\r\n\r\n    #ifdef SPOTLIGHT\r\n    for (int i = 0; i < CalculateLightCount; i++)\r\n\t{\r\n\t    if (i >= clusterInfo.y)\r\n\t\tbreak;\r\n\t    SpotLight spotLight = getSpotLight(i, clusterInfo, positionWS);\r\n\t    if (spotLight.lightMode == LightMode_Mix)\r\n\t\t{\r\n\t\t    continue;\r\n\t\t}\r\n\t    Light light = getLight(spotLight, normalWS, positionWS);\r\n\t    lightColor += BlinnPhongLighting(surface, light, info) * light.attenuation;\r\n\t}\r\n    #endif // SPOTLIGHT\r\n\r\n    vec3 giColor = BlinnPhongGI(surface, info);\r\n\r\n    return lightColor + giColor;\r\n}\r\n\r\n#endif // BlinnPhongFrag_lib","#define SHADER_NAME BlinnPhongVS\r\n\r\n#include \"Math.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n#include \"SceneFogInput.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DVertex.glsl\";\r\n\r\n#include \"VertexCommon.glsl\";\r\n\r\n#include \"BlinnPhongVertex.glsl\";\r\n\r\nvoid main()\r\n{\r\n    Vertex vertex;\r\n    getVertexParams(vertex);\r\n\r\n    PixelParams pixel;\r\n    initPixelParams(pixel, vertex);\r\n\r\n    gl_Position = getPositionCS(pixel.positionWS);\r\n\r\n    gl_Position = remapPositionZ(gl_Position);\r\n\r\n#ifdef FOG\r\n    FogHandle(gl_Position.z);\r\n#endif\r\n}\r\n","#define SHADER_NAME BlinnPhongFS\r\n\r\n#include \"Color.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n#include \"SceneFog.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DFrag.glsl\";\r\n\r\n#include \"BlinnPhongFrag.glsl\";\r\n\r\nvoid getBinnPhongSurfaceParams(inout Surface surface, in PixelParams pixel)\r\n{\r\n#ifdef UV\r\n    vec2 uv = transformUV(pixel.uv0, u_TilingOffset);\r\n#else // UV\r\n    vec2 uv = vec2(0.0);\r\n#endif // UV\r\n\r\n    surface.diffuseColor = u_DiffuseColor.rgb;\r\n    surface.alpha = u_DiffuseColor.a;\r\n\r\n#ifdef COLOR\r\n    #ifdef ENABLEVERTEXCOLOR\r\n    surface.diffuseColor *= pixel.vertexColor.xyz;\r\n    surface.alpha *= pixel.vertexColor.a;\r\n    #endif // ENABLEVERTEXCOLOR\r\n#endif // COLOR\r\n\r\n#ifdef DIFFUSEMAP\r\n    vec4 diffuseSampler = texture2D(u_DiffuseTexture, uv);\r\n    #ifdef Gamma_u_DiffuseTexture\r\n    diffuseSampler = gammaToLinear(diffuseSampler);\r\n    #endif // Gamma_u_DiffuseTexture\r\n    surface.diffuseColor *= u_DiffuseColor.rgb * diffuseSampler.rgb * u_AlbedoIntensity;\r\n    surface.alpha *= diffuseSampler.a;\r\n#endif // DIFFUSEMAP\r\n\r\n    surface.diffuseColor *= u_AlbedoIntensity;\r\n\r\n    surface.normalTS = vec3(0.0, 0.0, 1.0);\r\n#ifdef NORMALMAP\r\n    vec3 normalSampler = texture2D(u_NormalTexture, uv).rgb;\r\n    normalSampler = normalize(normalSampler * 2.0 - 1.0);\r\n    normalSampler.y *= -1.0;\r\n    surface.normalTS = normalSampler;\r\n#endif // NORMALMAP\r\n\r\n#ifdef SPECULARMAP\r\n    vec4 specularSampler = texture2D(u_SpecularTexture, uv);\r\n    #ifdef Gamma_u_SpecularTexture\r\n    specularSampler = gammaToLinear(specularSampler);\r\n    #endif // Gamma_u_SpecularTexture\r\n    surface.gloss = specularSampler.rgb;\r\n#else // SPECULARMAP\r\n    #ifdef DIFFUSEMAP\r\n    surface.gloss = vec3(diffuseSampler.a);\r\n    #else // DIFFUSEMAP\r\n    surface.gloss = vec3(1.0, 1.0, 1.0);\r\n    #endif // DIFFUSEMAP\r\n#endif // SPECULARMAP\r\n    surface.specularColor = u_MaterialSpecular.rgb;\r\n    surface.shininess = u_Shininess;\r\n}\r\n\r\nvoid main()\r\n{\r\n    PixelParams pixel;\r\n    getPixelParams(pixel);\r\n\r\n    Surface surface;\r\n    getBinnPhongSurfaceParams(surface, pixel);\r\n\r\n#ifdef ALPHATEST\r\n    if (surface.alpha < u_AlphaTestValue)\r\n\t{\r\n\t    discard;\r\n\t}\r\n#endif // ALPHATEST\r\n\r\n    vec3 surfaceColor = vec3(0.0);\r\n\r\n    surfaceColor = BlinnPhongLighting(surface, pixel);\r\n\r\n#ifdef FOG\r\n    surfaceColor = sceneLitFog(surfaceColor);\r\n#endif // FOG\r\n\r\n    gl_FragColor = vec4(surfaceColor, surface.alpha);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}\r\n","#define SHADER_NAME BlinnPhongDephtNormalVS\r\n\r\n#include \"Math.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n\r\n#include \"Sprite3DVertex.glsl\";\r\n\r\n#include \"VertexCommon.glsl\";\r\n\r\n#include \"BlinnPhongVertex.glsl\";\r\n\r\nvarying vec4 v_PositionCS;\r\n\r\nvoid main()\r\n{\r\n    Vertex vertex;\r\n    getVertexParams(vertex);\r\n\r\n    PixelParams pixel;\r\n    initPixelParams(pixel, vertex);\r\n\r\n    vec4 positionCS = getPositionCS(pixel.positionWS);\r\n    v_PositionCS = positionCS;\r\n    gl_Position = positionCS;\r\n    gl_Position = remapPositionZ(gl_Position);\r\n}","#define SHADER_NAME BlinnPhongDephtNormalFS\r\n\r\n#include \"Color.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DFrag.glsl\";\r\n\r\n#include \"ShadingFrag.glsl\";\r\n\r\n#include \"DepthNormalFrag.glsl\";\r\n\r\nvarying vec4 v_PositionCS;\r\n\r\nvoid main()\r\n{\r\n    PixelParams pixel;\r\n    getPixelParams(pixel);\r\n\r\n    vec3 normalWS = pixel.normalWS;\r\n\r\n#ifdef NORMALMAP\r\n    #ifdef UV\r\n\r\n    vec2 uv = transformUV(pixel.uv0, u_TilingOffset);\r\n    vec3 normalSampler = texture2D(u_NormalTexture, uv).rgb;\r\n    normalSampler = normalize(normalSampler * 2.0 - 1.0);\r\n    normalSampler.y *= -1.0;\r\n    vec3 normalTS = normalSampler;\r\n    normalWS = normalize(pixel.TBN * normalTS);\r\n\r\n    #endif // UV\r\n#endif // NORMALMAP\r\n\r\n    vec4 positionCS = v_PositionCS;\r\n\r\n    vec4 dephtNormal = encodeDepthNormal(positionCS, normalWS);\r\n\r\n    gl_FragColor = dephtNormal;\r\n}","import { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\"\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\"\r\nimport { VertexTrail } from \"../../core/trail/VertexTrail\";\r\nimport TrailVS from \"./Trail.vs\";\r\nimport TrailFS from \"./Trail.fs\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\nexport class TrailShaderInit {\r\n    static init() {\r\n        let attributeMap: { [name: string]: [number, ShaderDataType] } = {\r\n            'a_Position': [VertexTrail.TRAIL_POSITION0, ShaderDataType.Vector4],\r\n            'a_OffsetVector': [VertexTrail.TRAIL_OFFSETVECTOR, ShaderDataType.Vector3],\r\n            'a_Texcoord0X': [VertexTrail.TRAIL_TEXTURECOORDINATE0X, ShaderDataType.Float],\r\n            'a_Texcoord0Y': [VertexTrail.TRAIL_TEXTURECOORDINATE0Y, ShaderDataType.Float],\r\n            'a_BirthTime': [VertexTrail.TRAIL_TIME0, ShaderDataType.Float],\r\n            'a_Color': [VertexTrail.TRAIL_COLOR, ShaderDataType.Vector4],\r\n        };\r\n\r\n        let uniformMap = {\r\n            \"u_TilingOffset\": ShaderDataType.Vector4,\r\n            \"u_MainTexture\": ShaderDataType.Texture2D,\r\n            \"u_MainColor\": ShaderDataType.Color,\r\n        };\r\n\r\n        let defaultValue = {\r\n            \"u_MainColor\": Color.WHITE,\r\n            \"u_TilingOffset\": new Vector4(1, 1, 0, 0),\r\n        };\r\n\r\n        let shader = Shader3D.add(\"Trail\", false, false);\r\n        let subShader = new SubShader(attributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        let forwardPass = subShader.addShaderPass(TrailVS, TrailFS);\r\n    }\r\n}","#define SHADER_NAME TrailVS\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Scene.glsl\"\r\n#include \"SceneFogInput.glsl\"\r\n\r\n// Sprite uniform\r\nuniform float u_CurTime;\r\nuniform float u_LifeTime;\r\nuniform vec4 u_WidthCurve[10];\r\nuniform int u_WidthCurveKeyLength;\r\n\r\nvarying vec2 v_Texcoord0;\r\nvarying vec4 v_Color;\r\n\r\nfloat hermiteInterpolate(float t, float outTangent, float inTangent, float duration, float value1, float value2)\r\n{\r\n    float t2 = t * t;\r\n    float t3 = t2 * t;\r\n    float a = 2.0 * t3 - 3.0 * t2 + 1.0;\r\n    float b = t3 - 2.0 * t2 + t;\r\n    float c = t3 - t2;\r\n    float d = -2.0 * t3 + 3.0 * t2;\r\n    return a * value1 + b * outTangent * duration + c * inTangent * duration + d * value2;\r\n}\r\n\r\nfloat getCurWidth(in float normalizeTime)\r\n{\r\n    float width;\r\n    if (normalizeTime == 0.0)\r\n\t{\r\n\t    width = u_WidthCurve[0].w;\r\n\t}\r\n    else if (normalizeTime >= 1.0)\r\n\t{\r\n\t    width = u_WidthCurve[u_WidthCurveKeyLength - 1].w;\r\n\t}\r\n    else\r\n\t{\r\n\t    for (int i = 0; i < 10; i++)\r\n\t\t{\r\n\t\t    if (normalizeTime == u_WidthCurve[i].x)\r\n\t\t\t{\r\n\t\t\t    width = u_WidthCurve[i].w;\r\n\t\t\t    break;\r\n\t\t\t}\r\n\r\n\t\t    vec4 lastFrame = u_WidthCurve[i];\r\n\t\t    vec4 nextFrame = u_WidthCurve[i + 1];\r\n\t\t    if (normalizeTime > lastFrame.x && normalizeTime < nextFrame.x)\r\n\t\t\t{\r\n\t\t\t    float duration = nextFrame.x - lastFrame.x;\r\n\t\t\t    float t = (normalizeTime - lastFrame.x) / duration;\r\n\t\t\t    float outTangent = lastFrame.z;\r\n\t\t\t    float inTangent = nextFrame.y;\r\n\t\t\t    float value1 = lastFrame.w;\r\n\t\t\t    float value2 = nextFrame.w;\r\n\t\t\t    width = hermiteInterpolate(t, outTangent, inTangent, duration, value1, value2);\r\n\t\t\t    break;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n    return width;\r\n}\r\n\r\nvoid main()\r\n{\r\n    float normalizeTime = (u_CurTime - a_BirthTime) / u_LifeTime;\r\n\r\n    v_Texcoord0 = vec2(a_Texcoord0X, 1.0 - a_Texcoord0Y) * u_TilingOffset.xy + u_TilingOffset.zw;\r\n\r\n    v_Color = a_Color;\r\n\r\n    vec3 cameraPos = (u_View * a_Position).rgb;\r\n    gl_Position = u_Projection * vec4(cameraPos + a_OffsetVector * getCurWidth(normalizeTime), 1.0);\r\n\r\n    gl_Position = remapPositionZ(gl_Position);\r\n\t#ifdef FOG\r\n        FogHandle(gl_Position.z);\r\n    #endif\r\n}","#define SHADER_NAME TrailFS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Scene.glsl\";\r\n#include \"SceneFog.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\nvarying vec4 v_Color;\r\n\r\nvoid main()\r\n{\r\n    vec4 color = 2.0 * u_MainColor * v_Color;\r\n#ifdef MAINTEXTURE\r\n    vec4 mainTextureColor = texture2D(u_MainTexture, v_Texcoord0);\r\n    #ifdef Gamma_u_MainTexture\r\n    mainTextureColor = gammaToLinear(mainTextureColor);\r\n    #endif // Gamma_u_MainTexture\r\n\r\n    color *= mainTextureColor;\r\n#endif\r\n\r\n#ifdef FOG\r\n    color.xyz = scenUnlitFog(color.xyz);\r\n#endif // FOG\r\n    gl_FragColor = color;\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}\r\n","import { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\n\r\nimport PBRStandardVS from \"./pbrStandard.vs\";\r\nimport PBRStandardFS from \"./pbrStandard.fs\";\r\n\r\nimport PBRDepthVS from \"../depth/Depth.vs\";\r\nimport PBRDepthFS from \"../depth/Depth.fs\";\r\n\r\nimport DepthNormalVS from \"./PBRStandardDepthNormal.vs\";\r\nimport DepthNormalFS from \"./PBRStandardDepthNormal.fs\";\r\n\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\n\r\n\r\nexport class PBRStandardShaderInit {\r\n\r\n    static init() {\r\n\r\n        let uniformMap = {\r\n            \"u_AlbedoColor\": ShaderDataType.Color,\r\n            \"u_TilingOffset\": ShaderDataType.Vector4,\r\n            \"u_NormalScale\": ShaderDataType.Float,\r\n            \"u_Metallic\": ShaderDataType.Float,\r\n            \"u_Smoothness\": ShaderDataType.Float,\r\n            \"u_OcclusionStrength\": ShaderDataType.Float,\r\n            \"u_AlphaTestValue\": ShaderDataType.Float,\r\n            \"u_EmissionColor\": ShaderDataType.Color,\r\n            \"u_EmissionIntensity\": ShaderDataType.Float,\r\n            \"u_AlbedoTexture\": ShaderDataType.Texture2D,\r\n            \"u_NormalTexture\": ShaderDataType.Texture2D,\r\n            \"u_OcclusionTexture\": ShaderDataType.Texture2D,\r\n            \"u_EmissionTexture\": ShaderDataType.Texture2D,\r\n            \"u_MetallicGlossTexture\": ShaderDataType.Texture2D,\r\n            // anisotrioy\r\n            \"u_AnisotropyStrength\": ShaderDataType.Float,\r\n            \"u_AnisotropyTexture\": ShaderDataType.Texture2D,\r\n            \"u_AnisotropyRotation\": ShaderDataType.Float,\r\n            // clear coat\r\n            \"u_ClearCoatFactor\": ShaderDataType.Float,\r\n            \"u_ClearCoatTexture\": ShaderDataType.Texture2D,\r\n            \"u_ClearCoatRoughness\": ShaderDataType.Float,\r\n            \"u_ClearCoatRoughnessTexture\": ShaderDataType.Texture2D,\r\n            \"u_ClearCoatNormalTexture\": ShaderDataType.Texture2D,\r\n            //detail \r\n            \"u_DetailAlbedoTexture\": ShaderDataType.Texture2D,\r\n            \"u_DetailNormalTexture\": ShaderDataType.Texture2D,\r\n            \"u_DetailNormalScale\": ShaderDataType.Float,\r\n            \"u_DetailTillingOffset\": ShaderDataType.Vector4\r\n        };\r\n\r\n        let defaultValue = {\r\n            \"u_AlbedoColor\": Color.WHITE,\r\n            \"u_TilingOffset\": new Vector4(1, 1, 0, 0),\r\n            \"u_DetailTillingOffset\": new Vector4(1, 1, 0, 0),\r\n            \"u_NormalScale\": 1,\r\n            \"u_DetailNormalScale\": 1,\r\n            \"u_Metallic\": 0,\r\n            \"u_Smoothness\": 0.5,\r\n            \"u_OcclusionStrength\": 1,\r\n            \"u_EmissionColor\": Color.WHITE,\r\n            \"u_EmissionIntensity\": 1,\r\n            \"u_AlphaTestValue\": 0.5,\r\n            // anisotrioy\r\n            \"u_AnisotropyStrength\": 0,\r\n            \"u_AnisotropyRotation\": 0,\r\n            // clear coat\r\n            \"u_ClearCoatFactor\": 0,\r\n            \"u_ClearCoatRoughness\": 0,\r\n        };\r\n\r\n        let shader = Shader3D.add(\"PBR\", true, true);\r\n        let subShader = new SubShader(SubShader.DefaultAttributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        let shadingPass = subShader.addShaderPass(PBRStandardVS, PBRStandardFS);\r\n        let shadowPass = subShader.addShaderPass(PBRDepthVS, PBRDepthFS, \"ShadowCaster\");\r\n        let depthNormal = subShader.addShaderPass(DepthNormalVS, DepthNormalFS, \"DepthNormal\");\r\n    }\r\n\r\n}","#define SHADER_NAME PBRStandardVS\r\n\r\n#include \"Math.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n#include \"SceneFogInput.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DVertex.glsl\";\r\n\r\n#include \"VertexCommon.glsl\";\r\n\r\n#include \"PBRVertex.glsl\";\r\n\r\n#if defined(DETAILTEXTURE) || defined(DETAILNORMAL)\r\nvarying vec2 v_DetailUV;\r\n#endif\r\n\r\nvoid main()\r\n{\r\n    Vertex vertex;\r\n    getVertexParams(vertex);\r\n\r\n    PixelParams pixel;\r\n    initPixelParams(pixel, vertex);\r\n\r\n#if defined(DETAILTEXTURE) || defined(DETAILNORMAL)\r\n    #ifdef UV\r\n    v_DetailUV = transformUV(vertex.texCoord0, u_DetailTillingOffset);\r\n    #else // UV\r\n    v_DetailUV = vec2(0.0);\r\n    #endif\r\n#endif\r\n\r\n    gl_Position = getPositionCS(pixel.positionWS);\r\n\r\n    gl_Position = remapPositionZ(gl_Position);\r\n\r\n#ifdef FOG\r\n    FogHandle(gl_Position.z);\r\n#endif\r\n}","#define SHADER_NAME PBRStandardFS\r\n\r\n#include \"Color.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n#include \"SceneFog.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DFrag.glsl\";\r\n\r\n#include \"PBRMetallicFrag.glsl\";\r\n\r\n#if defined(DETAILTEXTURE) || defined(DETAILNORMAL)\r\nvarying vec2 v_DetailUV;\r\n    #define ColorSpaceDouble vec3(4.59479380, 4.59479380, 4.59479380);\r\nvec3 BlendNormals(vec3 n1, vec3 n2)\r\n{\r\n    return normalize(vec3(n1.xy + n2.xy, n1.z * n2.z));\r\n}\r\n#endif // DETAILTEXTURE || DETAILNORMAL\r\n\r\nvoid initSurfaceInputs(inout SurfaceInputs inputs, const in PixelParams pixel)\r\n{\r\n#ifdef UV\r\n    vec2 uv = transformUV(pixel.uv0, u_TilingOffset);\r\n#else // UV\r\n    vec2 uv = vec2(0.0);\r\n#endif // UV\r\n\r\n    inputs.diffuseColor = u_AlbedoColor.rgb;\r\n    inputs.alpha = u_AlbedoColor.a;\r\n\r\n#ifdef COLOR\r\n    #ifdef ENABLEVERTEXCOLOR\r\n    inputs.diffuseColor *= pixel.vertexColor.xyz;\r\n    inputs.alpha *= pixel.vertexColor.a;\r\n    #endif // ENABLEVERTEXCOLOR\r\n#endif // COLOR\r\n\r\n    inputs.alphaTest = u_AlphaTestValue;\r\n\r\n#ifdef ALBEDOTEXTURE\r\n    vec4 albedoSampler = texture2D(u_AlbedoTexture, uv);\r\n    #ifdef Gamma_u_AlbedoTexture\r\n    albedoSampler = gammaToLinear(albedoSampler);\r\n    #endif // Gamma_u_AlbedoTexture\r\n    inputs.diffuseColor *= albedoSampler.rgb;\r\n    inputs.alpha *= albedoSampler.a;\r\n#endif // ALBEDOTEXTURE\r\n\r\n// Detail Albedo\r\n#ifdef DETAILTEXTURE\r\n    vec3 detailSampler = texture2D(u_DetailAlbedoTexture, v_DetailUV).rgb;\r\n    #ifdef Gamma_u_DetailAlbedoTexture\r\n    detailSampler = gammaToLinear(detailSampler);\r\n    #endif // Gamma_u_DetailAlbedoTexture\r\n    detailSampler *= ColorSpaceDouble;\r\n    inputs.diffuseColor *= detailSampler;\r\n#endif\r\n\r\n    inputs.normalTS = vec3(0.0, 0.0, 1.0);\r\n#ifdef NORMALTEXTURE\r\n    vec3 normalSampler = texture2D(u_NormalTexture, uv).rgb;\r\n    normalSampler = normalize(normalSampler * 2.0 - 1.0);\r\n    normalSampler.y *= -1.0;\r\n    inputs.normalTS = normalScale(normalSampler, u_NormalScale);\r\n#endif\r\n\r\n#ifdef DETAILNORMAL\r\n    vec3 detailnormalSampler = texture2D(u_DetailNormalTexture, v_DetailUV).rgb;\r\n    detailnormalSampler = normalize(detailnormalSampler * 2.0 - 1.0);\r\n    detailnormalSampler.y *= -1.0;\r\n    detailnormalSampler = normalScale(detailnormalSampler, u_DetailNormalScale);\r\n    inputs.normalTS = BlendNormals(inputs.normalTS, detailnormalSampler);\r\n#endif\r\n\r\n    inputs.metallic = u_Metallic;\r\n    inputs.smoothness = u_Smoothness;\r\n\r\n#ifdef METALLICGLOSSTEXTURE\r\n\r\n    vec4 metallicSampler = texture2D(u_MetallicGlossTexture, uv);\r\n    #ifdef Gamma_u_MetallicGlossTexture\r\n    metallicSampler = gammaToLinear(metallicSampler);\r\n    #endif // Gamma_u_MetallicGlossTexture\r\n\r\n    inputs.metallic = metallicSampler.x;\r\n\r\n    #ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\r\n\t#ifdef ALBEDOTEXTURE\r\n    inputs.smoothness = (albedoSampler.a * u_Smoothness);\r\n\t#endif // ALBEDOTEXTURE\r\n    #else // SMOOTHNESSSOURCE_METALLICTEXTURE_ALPHA\r\n    inputs.smoothness = (metallicSampler.a * u_Smoothness);\r\n    #endif // SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\r\n\r\n#endif // METALLICGLOSSTEXTURE\r\n\r\n    inputs.occlusion = 1.0;\r\n#ifdef OCCLUSIONTEXTURE\r\n    vec4 occlusionSampler = texture2D(u_OcclusionTexture, uv);\r\n    #ifdef Gamma_u_OcclusionTexture\r\n    occlusionSampler = gammaToLinear(occlusionSampler);\r\n    #endif // Gamma_u_OcclusionTexture\r\n\r\n    float occlusion = occlusionSampler.g;\r\n    inputs.occlusion = (1.0 - u_OcclusionStrength) + occlusion * u_OcclusionStrength;\r\n#endif // OCCLUSIONTEXTURE\r\n\r\n    inputs.emissionColor = vec3(0.0);\r\n#ifdef EMISSION\r\n    inputs.emissionColor = u_EmissionColor.rgb * u_EmissionIntensity;\r\n    #ifdef EMISSIONTEXTURE\r\n    vec4 emissionSampler = texture2D(u_EmissionTexture, uv);\r\n\t#ifdef Gamma_u_EmissionTexture\r\n    emissionSampler = gammaToLinear(emissionSampler);\r\n\t#endif // Gamma_u_EmissionTexture\r\n    inputs.emissionColor *= emissionSampler.rgb;\r\n    #endif // EMISSIONTEXTURE\r\n#endif // EMISSION\r\n\r\n#ifdef CLEARCOAT\r\n    inputs.clearCoat = u_ClearCoatFactor;\r\n    inputs.clearCoatRoughness = u_ClearCoatRoughness;\r\n\r\n    #ifdef CLEARCOATMAP\r\n    // todo\r\n    // linear tex no need gamma\r\n    vec4 clearCoatSampler = texture2D(u_ClearCoatTexture, uv);\r\n    inputs.clearCoat *= clearCoatSampler.r;\r\n    #endif // CLEARCOATMAP\r\n\r\n    #ifdef CLEARCOAT_ROUGHNESSMAP\r\n    // todo\r\n    // linear tex no need gamma\r\n    vec4 clearcoatSampleRoughness = texture2D(u_ClearCoatRoughnessTexture, uv);\r\n    inputs.clearCoatRoughness *= clearcoatSampleRoughness.g;\r\n    #endif // CLEARCOAT_ROUGHNESSMAP\r\n\r\n    #ifdef CLEARCOAT_NORMAL\r\n    vec3 clearCoatNormalSampler = texture2D(u_ClearCoatNormalTexture, uv).rgb;\r\n    clearCoatNormalSampler = normalize(clearCoatNormalSampler * 2.0 - 1.0);\r\n    clearCoatNormalSampler.y *= -1.0;\r\n    inputs.clearCoatNormalTS = clearCoatNormalSampler;\r\n    #endif // CLEARCOAT_NORMAL\r\n#endif // CLEARCOAT\r\n\r\n#ifdef ANISOTROPIC\r\n    inputs.anisotropy = u_AnisotropyStrength;\r\n    vec2 direction = vec2(1.0, 0.0);\r\n\r\n    #ifdef ANISOTROPYMAP\r\n    vec3 anisotropySampler = texture2D(u_AnisotropyTexture, uv).rgb;\r\n\r\n    inputs.anisotropy *= anisotropySampler.b;\r\n    direction = anisotropySampler.xy * 2.0 - 1.0;\r\n    #endif // ANISOTROPYMAP\r\n\r\n    vec2 anisotropyRotation = vec2(cos(u_AnisotropyRotation), sin(u_AnisotropyRotation));\r\n    mat2 rotationMatrix = mat2(anisotropyRotation.x, anisotropyRotation.y, -anisotropyRotation.y, anisotropyRotation.x);\r\n    inputs.anisotropyDirection = rotationMatrix * direction;\r\n\r\n#endif // ANISOTROPIC\r\n}\r\n\r\nvoid main()\r\n{\r\n    PixelParams pixel;\r\n    getPixelParams(pixel);\r\n\r\n    SurfaceInputs inputs;\r\n    initSurfaceInputs(inputs, pixel);\r\n\r\n    vec4 surfaceColor = PBR_Metallic_Flow(inputs, pixel);\r\n\r\n#ifdef FOG\r\n    surfaceColor.rgb = sceneLitFog(surfaceColor.rgb);\r\n#endif // FOG\r\n\r\n    gl_FragColor = surfaceColor;\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME PBRStandardDepthNormalVS\r\n\r\n#include \"Math.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n\r\n#include \"Sprite3DVertex.glsl\";\r\n\r\n#include \"VertexCommon.glsl\";\r\n\r\n#include \"PBRVertex.glsl\";\r\n\r\nvarying vec4 v_PositionCS;\r\n\r\nvoid main()\r\n{\r\n    Vertex vertex;\r\n    getVertexParams(vertex);\r\n\r\n    PixelParams pixel;\r\n    initPixelParams(pixel, vertex);\r\n\r\n    sharePixelParams(pixel);\r\n\r\n    vec4 positionCS = getPositionCS(pixel.positionWS);\r\n    v_PositionCS = positionCS;\r\n    gl_Position = positionCS;\r\n    gl_Position = remapPositionZ(gl_Position);\r\n}","#define SHADER_NAME PBRStandardDepthNormalFS\r\n\r\n#include \"Color.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DFrag.glsl\";\r\n\r\n#include \"ShadingFrag.glsl\";\r\n\r\n#include \"DepthNormalFrag.glsl\";\r\n\r\nvarying vec4 v_PositionCS;\r\n\r\nvoid main()\r\n{\r\n    PixelParams pixel;\r\n    getPixelParams(pixel);\r\n\r\n    vec3 normalWS = pixel.normalWS;\r\n\r\n#ifdef NORMALTEXTURE\r\n    #ifdef UV\r\n\r\n    vec2 uv = transformUV(pixel.uv0, u_TilingOffset);\r\n    vec3 normalSampler = texture2D(u_NormalTexture, uv).rgb;\r\n    normalSampler = normalize(normalSampler * 2.0 - 1.0);\r\n    normalSampler.y *= -1.0;\r\n    vec3 normalTS = normalScale(normalSampler, u_NormalScale);\r\n    normalWS = normalize(pixel.TBN * normalTS);\r\n\r\n    #endif // UV\r\n#endif // NORMALTEXTURE\r\n\r\n    vec4 positionCS = v_PositionCS;\r\n\r\n    vec4 dephtNormal = encodeDepthNormal(positionCS, normalWS);\r\n\r\n    gl_FragColor = dephtNormal;\r\n}","import { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport SkyboxVS from \"./SkyBox.vs\";\r\nimport SkyboxFS from \"./SkyBox.fs\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { AttributeMapType, SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { CullMode } from \"../../../RenderEngine/RenderEnum/CullMode\";\r\n\r\nexport class SkyBoxShaderInit {\r\n\r\n    static init() {\r\n\r\n        let attributeMap: AttributeMapType = {\r\n            \"a_Position\": [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n        };\r\n\r\n        let uniformMap = {\r\n            \"u_TintColor\": ShaderDataType.Color,\r\n            \"u_Exposure\": ShaderDataType.Float,\r\n            \"u_Rotation\": ShaderDataType.Float,\r\n            \"u_CubeTexture\": ShaderDataType.TextureCube\r\n        };\r\n\r\n        let defaultValue = {\r\n            \"u_TintColor\": new Color(0.5, 0.5, 0.5, 0.5),\r\n            \"u_Exposure\": 1,\r\n            \"u_Rotation\": 0\r\n        };\r\n\r\n        let shader = Shader3D.add(\"SkyBox\");\r\n        let subShader = new SubShader(attributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        let pass = subShader.addShaderPass(SkyboxVS, SkyboxFS);\r\n        pass.renderState.depthTest = RenderState.DEPTHTEST_LEQUAL;\r\n        pass.renderState.cull = CullMode.Back;\r\n        pass.renderState.depthWrite = false;\r\n        pass.renderState.stencilWrite = false;\r\n        pass.statefirst = true;\r\n\r\n\r\n    }\r\n\r\n}","#define SHADER_NAME SkyBoxVS\r\n\r\n#include \"Camera.glsl\";\r\n\r\nconst float c_deg2ang = 3.141593 / 180.0;\r\n\r\nvec4 rotateAroundYInDegrees(vec4 vertex, float deg)\r\n{\r\n    float angle = deg * c_deg2ang;\r\n    float sina = sin(angle);\r\n    float cosa = cos(angle);\r\n    mat2 m = mat2(cosa, -sina, sina, cosa);\r\n    return vec4(m * vertex.xz, vertex.yw).xzyw;\r\n}\r\n\r\nvec4 remapSkyPositionZ(in vec4 position)\r\n{\r\n    position.z = position.w;\r\n    return position;\r\n}\r\n\r\nvarying vec3 v_Texcoord;\r\n\r\nvoid main()\r\n{\r\n    // todo  \r\n    v_Texcoord = vec3(-a_Position.x, a_Position.yz); //\r\n\r\n    vec4 position = rotateAroundYInDegrees(a_Position, u_Rotation);\r\n    // gl_Position = getPositionCS(position.xyz);\r\n\r\n    gl_Position = u_ViewProjection * position;\r\n\r\n    gl_Position = remapSkyPositionZ(gl_Position);\r\n}","#define SHADER_NAME SkyBoxFS\r\n\r\n#include \"Color.glsl\";\r\n\r\nvarying vec3 v_Texcoord;\r\n\r\nconst vec4 c_ColorSpace = vec4(4.59479380, 4.59479380, 4.59479380, 2.0);\r\n\r\nvoid main()\r\n{\r\n    vec3 uv = v_Texcoord;\r\n    vec4 cubeSampler = textureCube(u_CubeTexture, uv);\r\n#ifdef Gamma_u_CubeTexture\r\n    cubeSampler = gammaToLinear(cubeSampler);\r\n#endif // Gamma_u_CubeTexture\r\n\r\n    vec3 color = cubeSampler.rgb * u_TintColor.rgb * u_Exposure * c_ColorSpace.rgb;\r\n\r\n    gl_FragColor = vec4(color, 1.0);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","import { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { VertexShuriKenParticle } from \"../../graphics/Vertex/VertexShuriKenParticle\";\r\nimport ShurikenVS from \"./particleShuriKen.vs\";\r\nimport ShurikenFS from \"./particleShuriKen.fs\";\r\nimport MathGradient from \"./MathGradient.glsl\";\r\nimport ParticleSpriteVS from \"./particleShuriKenSpriteVS.glsl\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\n/**\r\n * ParticleShuriKen Shader init\r\n */\r\nexport class ParticleShuriKenShaderInit{\r\n    static init(){\r\n        \r\n        Shader3D.addInclude(\"MathGradient.glsl\", MathGradient);\r\n        Shader3D.addInclude(\"particleShuriKenSpriteVS.glsl\", ParticleSpriteVS);\r\n\r\n        let attributeMap: { [name: string]: [number, ShaderDataType] } = {\r\n            'a_CornerTextureCoordinate': [VertexShuriKenParticle.PARTICLE_CORNERTEXTURECOORDINATE0, ShaderDataType.Vector4],\r\n\t\t \t'a_MeshPosition': [VertexShuriKenParticle.PARTICLE_POSITION0,ShaderDataType.Vector3],\r\n            'a_MeshColor':[VertexShuriKenParticle.PARTICLE_COLOR0,ShaderDataType.Vector4],\r\n\t\t \t'a_MeshTextureCoordinate': [VertexShuriKenParticle.PARTICLE_TEXTURECOORDINATE0,ShaderDataType.Vector2],\r\n\t\t \t'a_ShapePositionStartLifeTime': [VertexShuriKenParticle.PARTICLE_SHAPEPOSITIONSTARTLIFETIME,ShaderDataType.Vector4],\r\n\t\t    'a_DirectionTime': [VertexShuriKenParticle.PARTICLE_DIRECTIONTIME,ShaderDataType.Vector4],\r\n\t\t \t'a_StartColor': [VertexShuriKenParticle.PARTICLE_STARTCOLOR0,ShaderDataType.Vector4],\r\n\t\t \t'a_StartSize': [VertexShuriKenParticle.PARTICLE_STARTSIZE,ShaderDataType.Vector3],\r\n\t\t \t'a_StartRotation0': [VertexShuriKenParticle.PARTICLE_STARTROTATION,ShaderDataType.Vector3],\r\n\t\t \t'a_StartSpeed': [VertexShuriKenParticle.PARTICLE_STARTSPEED,ShaderDataType.Float],\r\n\t\t \t'a_Random0': [VertexShuriKenParticle.PARTICLE_RANDOM0,ShaderDataType.Vector4],\r\n\t\t \t'a_Random1': [VertexShuriKenParticle.PARTICLE_RANDOM1,ShaderDataType.Vector4],\r\n\t\t \t'a_SimulationWorldPostion': [VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDPOSTION,ShaderDataType.Vector3],\r\n\t\t \t'a_SimulationWorldRotation': [VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDROTATION,ShaderDataType.Vector4],\r\n\t\t \t'a_SimulationUV': [VertexShuriKenParticle.PARTICLE_SIMULATIONUV,ShaderDataType.Vector4]\r\n        };\r\n\r\n        let uniformMap = {\r\n            \"u_Tintcolor\": ShaderDataType.Color,\r\n            \"u_texture\": ShaderDataType.Texture2D,\r\n            \"u_TilingOffset\": ShaderDataType.Vector4,\r\n            \"u_AlphaTestValue\": ShaderDataType.Float,\r\n        };\r\n\r\n        let defaultValue = {\r\n            \"u_Tintcolor\": new Color(0.5, 0.5, 0.5, 0.5),\r\n            \"u_TilingOffset\": new Vector4(1, 1, 0, 0),\r\n            \"u_AlphaTestValue\": 0.5\r\n        };\r\n\r\n        let shader = Shader3D.add(\"PARTICLESHURIKEN\", false, false);\r\n        let subShader = new SubShader(attributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        let forwardPass = subShader.addShaderPass(ShurikenVS, ShurikenFS);\r\n\r\n    }\r\n}","float getCurValueFromGradientFloat(in vec2 gradientNumbers[4], in float normalizedAge)\r\n{\r\n    float curValue;\r\n    for (int i = 1; i < 4; i++)\r\n\t{\r\n\t    vec2 gradientNumber = gradientNumbers[i];\r\n\t    float key = gradientNumber.x;\r\n\t    if (key >= normalizedAge)\r\n\t\t{\r\n\t\t    vec2 lastGradientNumber = gradientNumbers[i - 1];\r\n\t\t    float lastKey = lastGradientNumber.x;\r\n\t\t    float age = (normalizedAge - lastKey) / (key - lastKey);\r\n\t\t    curValue = mix(lastGradientNumber.y, gradientNumber.y, age);\r\n\t\t    break;\r\n\t\t}\r\n\t}\r\n    return curValue;\r\n}\r\n\r\nfloat getTotalValueFromGradientFloat(in vec2 gradientNumbers[4],\r\n    in float normalizedAge)\r\n{\r\n    float totalValue = 0.0;\r\n    for (int i = 1; i < 4; i++)\r\n\t{\r\n\t    vec2 gradientNumber = gradientNumbers[i];\r\n\t    float key = gradientNumber.x;\r\n\t    vec2 lastGradientNumber = gradientNumbers[i - 1];\r\n\t    float lastValue = lastGradientNumber.y;\r\n\r\n\t    if (key >= normalizedAge)\r\n\t\t{\r\n\t\t    float lastKey = lastGradientNumber.x;\r\n\t\t    float age = (normalizedAge - lastKey) / (key - lastKey);\r\n\t\t    totalValue += (lastValue + mix(lastValue, gradientNumber.y, age)) / 2.0 * a_ShapePositionStartLifeTime.w * (normalizedAge - lastKey);\r\n\t\t    break;\r\n\t\t}\r\n\t    else\r\n\t\t{\r\n\t\t    totalValue += (lastValue + gradientNumber.y) / 2.0 * a_ShapePositionStartLifeTime.w * (key - lastGradientNumber.x);\r\n\t\t}\r\n\t}\r\n    return totalValue;\r\n}\r\n\r\nvec4 getColorFromGradient(in vec2 gradientAlphas[COLORCOUNT],\r\n    in vec4 gradientColors[COLORCOUNT],\r\n    in float normalizedAge, in vec4 keyRanges)\r\n{\r\n    float alphaAge = clamp(normalizedAge, keyRanges.z, keyRanges.w);\r\n    vec4 overTimeColor;\r\n    for (int i = 1; i < COLORCOUNT; i++)\r\n\t{\r\n\t    vec2 gradientAlpha = gradientAlphas[i];\r\n\t    float alphaKey = gradientAlpha.x;\r\n\t    if (alphaKey >= alphaAge)\r\n\t\t{\r\n\t\t    vec2 lastGradientAlpha = gradientAlphas[i - 1];\r\n\t\t    float lastAlphaKey = lastGradientAlpha.x;\r\n\t\t    float age = clamp((alphaAge - lastAlphaKey) / (alphaKey - lastAlphaKey), 0.0, 1.0);\r\n\t\t    overTimeColor.a = mix(lastGradientAlpha.y, gradientAlpha.y, age);\r\n\t\t    break;\r\n\t\t}\r\n\t}\r\n\r\n    float colorAge = clamp(normalizedAge, keyRanges.x, keyRanges.y);\r\n    for (int i = 1; i < COLORCOUNT; i++)\r\n\t{\r\n\t    vec4 gradientColor = gradientColors[i];\r\n\t    float colorKey = gradientColor.x;\r\n\t    if (colorKey >= colorAge)\r\n\t\t{\r\n\t\t    vec4 lastGradientColor = gradientColors[i - 1];\r\n\t\t    float lastColorKey = lastGradientColor.x;\r\n\t\t    float age = (colorAge - lastColorKey) / (colorKey - lastColorKey);\r\n\t\t    overTimeColor.rgb = mix(gradientColors[i - 1].yzw, gradientColor.yzw, age);\r\n\t\t    break;\r\n\t\t}\r\n\t}\r\n    return overTimeColor;\r\n}\r\n\r\nfloat getFrameFromGradient(in vec2 gradientFrames[4], in float normalizedAge)\r\n{\r\n    float overTimeFrame;\r\n    for (int i = 1; i < 4; i++)\r\n\t{\r\n\t    vec2 gradientFrame = gradientFrames[i];\r\n\t    float key = gradientFrame.x;\r\n\t    if (key >= normalizedAge)\r\n\t\t{\r\n\t\t    vec2 lastGradientFrame = gradientFrames[i - 1];\r\n\t\t    float lastKey = lastGradientFrame.x;\r\n\t\t    float age = (normalizedAge - lastKey) / (key - lastKey);\r\n\t\t    overTimeFrame = mix(lastGradientFrame.y, gradientFrame.y, age);\r\n\t\t    break;\r\n\t\t}\r\n\t}\r\n    return floor(overTimeFrame);\r\n}\r\n","// sprite Uniform\r\nuniform float u_CurrentTime;\r\nuniform vec3 u_Gravity;\r\nuniform vec2 u_DragConstanct;\r\nuniform vec3 u_WorldPosition;\r\nuniform vec4 u_WorldRotation;\r\nuniform bool u_ThreeDStartRotation;\r\nuniform int u_ScalingMode;\r\nuniform vec3 u_PositionScale;\r\nuniform vec3 u_SizeScale;\r\n\r\nuniform float u_StretchedBillboardLengthScale;\r\nuniform float u_StretchedBillboardSpeedScale;\r\nuniform int u_SimulationSpace;\r\n\r\n#if defined(VELOCITYOVERLIFETIMECONSTANT) || defined(VELOCITYOVERLIFETIMECURVE) || defined(VELOCITYOVERLIFETIMERANDOMCONSTANT) || defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\nuniform int u_VOLSpaceType;\r\n#endif\r\n#if defined(VELOCITYOVERLIFETIMECONSTANT) || defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)\r\nuniform vec3 u_VOLVelocityConst;\r\n#endif\r\n#if defined(VELOCITYOVERLIFETIMECURVE) || defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\nuniform vec2 u_VOLVelocityGradientX[4]; // xkey,y\r\nuniform vec2 u_VOLVelocityGradientY[4]; // xkey,y\r\nuniform vec2 u_VOLVelocityGradientZ[4]; // xkey,y\r\n#endif\r\n#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\r\nuniform vec3 u_VOLVelocityConstMax;\r\n#endif\r\n#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\r\nuniform vec2 u_VOLVelocityGradientMaxX[4]; // xkey,y\r\nuniform vec2 u_VOLVelocityGradientMaxY[4]; // xkey,y\r\nuniform vec2 u_VOLVelocityGradientMaxZ[4]; // xkey,y\r\n#endif\r\n\r\n#ifdef COLORKEYCOUNT_8\r\n    #define COLORCOUNT 8\r\n#else\r\n    #define COLORCOUNT 4\r\n#endif\r\n\r\n#ifdef COLOROVERLIFETIME\r\nuniform vec4 u_ColorOverLifeGradientColors[COLORCOUNT]; // xkey,yzwColor\r\nuniform vec2 u_ColorOverLifeGradientAlphas[COLORCOUNT]; // xkey,yAlpha\r\nuniform vec4 u_ColorOverLifeGradientRanges;\r\n#endif\r\n#ifdef RANDOMCOLOROVERLIFETIME\r\nuniform vec4 u_ColorOverLifeGradientColors[COLORCOUNT]; // xkey,yzwColor\r\nuniform vec2 u_ColorOverLifeGradientAlphas[COLORCOUNT]; // xkey,yAlpha\r\nuniform vec4 u_ColorOverLifeGradientRanges;\r\nuniform vec4 u_MaxColorOverLifeGradientColors[COLORCOUNT]; // xkey,yzwColor\r\nuniform vec2 u_MaxColorOverLifeGradientAlphas[COLORCOUNT]; // xkey,yAlpha\r\nuniform vec4 u_MaxColorOverLifeGradientRanges;\r\n#endif\r\n\r\n#if defined(SIZEOVERLIFETIMECURVE) || defined(SIZEOVERLIFETIMERANDOMCURVES)\r\nuniform vec2 u_SOLSizeGradient[4]; // xkey,y\r\n#endif\r\n#ifdef SIZEOVERLIFETIMERANDOMCURVES\r\nuniform vec2 u_SOLSizeGradientMax[4]; // xkey,y\r\n#endif\r\n#if defined(SIZEOVERLIFETIMECURVESEPERATE) || defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\r\nuniform vec2 u_SOLSizeGradientX[4]; // xkey,y\r\nuniform vec2 u_SOLSizeGradientY[4]; // xkey,y\r\nuniform vec2 u_SOLSizeGradientZ[4]; // xkey,y\r\n#endif\r\n#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\r\nuniform vec2 u_SOLSizeGradientMaxX[4]; // xkey,y\r\nuniform vec2 u_SOLSizeGradientMaxY[4]; // xkey,y\r\nuniform vec2 u_SOLSizeGradientMaxZ[4]; // xkey,y\r\n#endif\r\n\r\n#ifdef ROTATIONOVERLIFETIME\r\n    #if defined(ROTATIONOVERLIFETIMECONSTANT) || defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\r\nuniform float u_ROLAngularVelocityConst;\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\nuniform float u_ROLAngularVelocityConstMax;\r\n    #endif\r\n    #if defined(ROTATIONOVERLIFETIMECURVE) || defined(ROTATIONOVERLIFETIMERANDOMCURVES)\r\nuniform vec2 u_ROLAngularVelocityGradient[4]; // xkey,y\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\nuniform vec2 u_ROLAngularVelocityGradientMax[4]; // xkey,y\r\n    #endif\r\n#endif\r\n#ifdef ROTATIONOVERLIFETIMESEPERATE\r\n    #if defined(ROTATIONOVERLIFETIMECONSTANT) || defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\r\nuniform vec3 u_ROLAngularVelocityConstSeprarate;\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\nuniform vec3 u_ROLAngularVelocityConstMaxSeprarate;\r\n    #endif\r\n    #if defined(ROTATIONOVERLIFETIMECURVE) || defined(ROTATIONOVERLIFETIMERANDOMCURVES)\r\nuniform vec2 u_ROLAngularVelocityGradientX[4];\r\nuniform vec2 u_ROLAngularVelocityGradientY[4];\r\nuniform vec2 u_ROLAngularVelocityGradientZ[4];\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\nuniform vec2 u_ROLAngularVelocityGradientMaxX[4];\r\nuniform vec2 u_ROLAngularVelocityGradientMaxY[4];\r\nuniform vec2 u_ROLAngularVelocityGradientMaxZ[4];\r\nuniform vec2 u_ROLAngularVelocityGradientMaxW[4];\r\n    #endif\r\n#endif\r\n\r\n#if defined(TEXTURESHEETANIMATIONCURVE) || defined(TEXTURESHEETANIMATIONRANDOMCURVE)\r\nuniform float u_TSACycles;\r\nuniform vec2 u_TSASubUVLength;\r\nuniform vec2 u_TSAGradientUVs[4]; // xkey,yframe\r\n#endif\r\n#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\r\nuniform vec2 u_TSAMaxGradientUVs[4]; // xkey,yframe\r\n#endif","#define SHADER_NAME ParticleVS\r\n\r\n#include \"Camera.glsl\";\r\n#include \"particleShuriKenSpriteVS.glsl\";\r\n#include \"Math.glsl\";\r\n#include \"MathGradient.glsl\";\r\n#include \"Color.glsl\";\r\n#include \"Scene.glsl\"\r\n#include \"SceneFogInput.glsl\"\r\n\r\n\r\n#ifdef RENDERMODE_MESH\r\nvarying vec4 v_MeshColor;\r\n#endif\r\n\r\nvarying vec4 v_Color;\r\nvarying vec2 v_TextureCoordinate;\r\n\r\n//\r\nvec2 TransformUV(vec2 texcoord, vec4 tilingOffset)\r\n{\r\n    vec2 transTexcoord = vec2(texcoord.x, texcoord.y - 1.0) * tilingOffset.xy + vec2(tilingOffset.z, -tilingOffset.w);\r\n    transTexcoord.y += 1.0;\r\n    return transTexcoord;\r\n}\r\n\r\n#if defined(VELOCITYOVERLIFETIMECONSTANT) || defined(VELOCITYOVERLIFETIMECURVE) || defined(VELOCITYOVERLIFETIMERANDOMCONSTANT) || defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\nvec3 computeParticleLifeVelocity(in float normalizedAge)\r\n{\r\n    vec3 outLifeVelocity;\r\n    #ifdef VELOCITYOVERLIFETIMECONSTANT\r\n    outLifeVelocity = u_VOLVelocityConst;\r\n    #endif\r\n    #ifdef VELOCITYOVERLIFETIMECURVE\r\n    outLifeVelocity = vec3(getCurValueFromGradientFloat(u_VOLVelocityGradientX, normalizedAge),\r\n\tgetCurValueFromGradientFloat(u_VOLVelocityGradientY, normalizedAge),\r\n\tgetCurValueFromGradientFloat(u_VOLVelocityGradientZ, normalizedAge));\r\n    #endif\r\n    #ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\r\n    outLifeVelocity = mix(u_VOLVelocityConst,\r\n\tu_VOLVelocityConstMax,\r\n\tvec3(a_Random1.y, a_Random1.z, a_Random1.w));\r\n    #endif\r\n    #ifdef VELOCITYOVERLIFETIMERANDOMCURVE\r\n    outLifeVelocity = vec3(\r\n\tmix(getCurValueFromGradientFloat(u_VOLVelocityGradientX, normalizedAge),\r\n\t    getCurValueFromGradientFloat(u_VOLVelocityGradientMaxX, normalizedAge),\r\n\t    a_Random1.y),\r\n\tmix(getCurValueFromGradientFloat(u_VOLVelocityGradientY, normalizedAge),\r\n\t    getCurValueFromGradientFloat(u_VOLVelocityGradientMaxY, normalizedAge),\r\n\t    a_Random1.z),\r\n\tmix(getCurValueFromGradientFloat(u_VOLVelocityGradientZ, normalizedAge),\r\n\t    getCurValueFromGradientFloat(u_VOLVelocityGradientMaxZ, normalizedAge),\r\n\t    a_Random1.w));\r\n    #endif\r\n\r\n    return outLifeVelocity;\r\n}\r\n#endif\r\n\r\n// drag\r\nvec3 getStartPosition(vec3 startVelocity, float age, vec3 dragData)\r\n{\r\n    vec3 startPosition;\r\n    float lasttime = min(startVelocity.x / dragData.x, age);\r\n    startPosition = lasttime * (startVelocity - 0.5 * dragData * lasttime);\r\n    return startPosition;\r\n}\r\n\r\nvec3 computeParticlePosition(in vec3 startVelocity, in vec3 lifeVelocity, in float age, in float normalizedAge, vec3 gravityVelocity, vec4 worldRotation, vec3 dragData)\r\n{\r\n    vec3 startPosition = getStartPosition(startVelocity, age, dragData);\r\n    vec3 lifePosition;\r\n#if defined(VELOCITYOVERLIFETIMECONSTANT) || defined(VELOCITYOVERLIFETIMECURVE) || defined(VELOCITYOVERLIFETIMERANDOMCONSTANT) || defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\n    #ifdef VELOCITYOVERLIFETIMECONSTANT\r\n    // startPosition = startVelocity * age;\r\n    lifePosition = lifeVelocity * age;\r\n    #endif\r\n    #ifdef VELOCITYOVERLIFETIMECURVE\r\n    // startPosition = startVelocity * age;\r\n    lifePosition = vec3(getTotalValueFromGradientFloat(u_VOLVelocityGradientX, normalizedAge),\r\n\tgetTotalValueFromGradientFloat(u_VOLVelocityGradientY, normalizedAge),\r\n\tgetTotalValueFromGradientFloat(u_VOLVelocityGradientZ, normalizedAge));\r\n    #endif\r\n    #ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\r\n    // startPosition = startVelocity * age;\r\n    lifePosition = lifeVelocity * age;\r\n    #endif\r\n    #ifdef VELOCITYOVERLIFETIMERANDOMCURVE\r\n    // startPosition = startVelocity * age;\r\n    lifePosition = vec3(\r\n\tmix(\r\n\t    getTotalValueFromGradientFloat(u_VOLVelocityGradientX, normalizedAge),\r\n\t    getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxX, normalizedAge),\r\n\t    a_Random1.y),\r\n\tmix(\r\n\t    getTotalValueFromGradientFloat(u_VOLVelocityGradientY, normalizedAge),\r\n\t    getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxY, normalizedAge),\r\n\t    a_Random1.z),\r\n\tmix(\r\n\t    getTotalValueFromGradientFloat(u_VOLVelocityGradientZ, normalizedAge),\r\n\t    getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxZ, normalizedAge),\r\n\t    a_Random1.w));\r\n    #endif\r\n\r\n    vec3 finalPosition;\r\n    if (u_VOLSpaceType == 0)\r\n\t{\r\n\t    if (u_ScalingMode != 2)\r\n\t\tfinalPosition = rotationByQuaternions(\r\n\t\t    u_PositionScale * (a_ShapePositionStartLifeTime.xyz + startPosition + lifePosition),\r\n\t\t    worldRotation);\r\n\t    else\r\n\t\tfinalPosition = rotationByQuaternions(\r\n\t\t    u_PositionScale * a_ShapePositionStartLifeTime.xyz + startPosition + lifePosition,\r\n\t\t    worldRotation);\r\n\t}\r\n    else\r\n\t{\r\n\t    if (u_ScalingMode != 2)\r\n\t\tfinalPosition = rotationByQuaternions(\r\n\t\t\t\t    u_PositionScale * (a_ShapePositionStartLifeTime.xyz + startPosition),\r\n\t\t\t\t    worldRotation)\r\n\t\t    + lifePosition;\r\n\t    else\r\n\t\tfinalPosition = rotationByQuaternions(\r\n\t\t\t\t    u_PositionScale * a_ShapePositionStartLifeTime.xyz + startPosition,\r\n\t\t\t\t    worldRotation)\r\n\t\t    + lifePosition;\r\n\t}\r\n#else\r\n    // startPosition = startVelocity * age;\r\n    vec3 finalPosition;\r\n    if (u_ScalingMode != 2)\r\n\tfinalPosition = rotationByQuaternions(\r\n\t    u_PositionScale * (a_ShapePositionStartLifeTime.xyz + startPosition),\r\n\t    worldRotation);\r\n    else\r\n\tfinalPosition = rotationByQuaternions(\r\n\t    u_PositionScale * a_ShapePositionStartLifeTime.xyz + startPosition,\r\n\t    worldRotation);\r\n#endif\r\n\r\n    if (u_SimulationSpace == 0)\r\n\tfinalPosition = finalPosition + a_SimulationWorldPostion;\r\n    else if (u_SimulationSpace == 1)\r\n\tfinalPosition = finalPosition + u_WorldPosition;\r\n\r\n    finalPosition += 0.5 * gravityVelocity * age;\r\n\r\n    return finalPosition;\r\n}\r\n\r\nvec4 computeParticleColor(in vec4 color, in float normalizedAge)\r\n{\r\n#ifdef COLOROVERLIFETIME\r\n    color *= getColorFromGradient(u_ColorOverLifeGradientAlphas,\r\n\tu_ColorOverLifeGradientColors,\r\n\tnormalizedAge, u_ColorOverLifeGradientRanges);\r\n#endif\r\n\r\n#ifdef RANDOMCOLOROVERLIFETIME\r\n    color *= mix(getColorFromGradient(u_ColorOverLifeGradientAlphas,\r\n\t\t     u_ColorOverLifeGradientColors,\r\n\t\t     normalizedAge, u_ColorOverLifeGradientRanges),\r\n\tgetColorFromGradient(u_MaxColorOverLifeGradientAlphas,\r\n\t    u_MaxColorOverLifeGradientColors,\r\n\t    normalizedAge, u_MaxColorOverLifeGradientRanges),\r\n\ta_Random0.y);\r\n#endif\r\n\r\n    return color;\r\n}\r\n\r\nvec2 computeParticleSizeBillbard(in vec2 size, in float normalizedAge)\r\n{\r\n#ifdef SIZEOVERLIFETIMECURVE\r\n    size *= getCurValueFromGradientFloat(u_SOLSizeGradient, normalizedAge);\r\n#endif\r\n#ifdef SIZEOVERLIFETIMERANDOMCURVES\r\n    size *= mix(getCurValueFromGradientFloat(u_SOLSizeGradient, normalizedAge),\r\n\tgetCurValueFromGradientFloat(u_SOLSizeGradientMax, normalizedAge),\r\n\ta_Random0.z);\r\n#endif\r\n#ifdef SIZEOVERLIFETIMECURVESEPERATE\r\n    size *= vec2(getCurValueFromGradientFloat(u_SOLSizeGradientX, normalizedAge),\r\n\tgetCurValueFromGradientFloat(u_SOLSizeGradientY, normalizedAge));\r\n#endif\r\n#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\r\n    size *= vec2(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX, normalizedAge),\r\n\t\t     getCurValueFromGradientFloat(u_SOLSizeGradientMaxX, normalizedAge),\r\n\t\t     a_Random0.z),\r\n\tmix(getCurValueFromGradientFloat(u_SOLSizeGradientY, normalizedAge),\r\n\t    getCurValueFromGradientFloat(u_SOLSizeGradientMaxY, normalizedAge),\r\n\t    a_Random0.z));\r\n#endif\r\n    return size;\r\n}\r\n\r\n#ifdef RENDERMODE_MESH\r\nvec3 computeParticleSizeMesh(in vec3 size, in float normalizedAge)\r\n{\r\n    #ifdef SIZEOVERLIFETIMECURVE\r\n    size *= getCurValueFromGradientFloat(u_SOLSizeGradient, normalizedAge);\r\n    #endif\r\n    #ifdef SIZEOVERLIFETIMERANDOMCURVES\r\n    size *= mix(getCurValueFromGradientFloat(u_SOLSizeGradient, normalizedAge),\r\n\tgetCurValueFromGradientFloat(u_SOLSizeGradientMax, normalizedAge),\r\n\ta_Random0.z);\r\n    #endif\r\n    #ifdef SIZEOVERLIFETIMECURVESEPERATE\r\n    size *= vec3(getCurValueFromGradientFloat(u_SOLSizeGradientX, normalizedAge),\r\n\tgetCurValueFromGradientFloat(u_SOLSizeGradientY, normalizedAge),\r\n\tgetCurValueFromGradientFloat(u_SOLSizeGradientZ, normalizedAge));\r\n    #endif\r\n    #ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\r\n    size *= vec3(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX, normalizedAge),\r\n\t\t     getCurValueFromGradientFloat(u_SOLSizeGradientMaxX, normalizedAge),\r\n\t\t     a_Random0.z),\r\n\tmix(getCurValueFromGradientFloat(u_SOLSizeGradientY, normalizedAge),\r\n\t    getCurValueFromGradientFloat(u_SOLSizeGradientMaxY, normalizedAge),\r\n\t    a_Random0.z),\r\n\tmix(getCurValueFromGradientFloat(u_SOLSizeGradientZ, normalizedAge),\r\n\t    getCurValueFromGradientFloat(u_SOLSizeGradientMaxZ, normalizedAge),\r\n\t    a_Random0.z));\r\n    #endif\r\n    return size;\r\n}\r\n#endif\r\n\r\nfloat computeParticleRotationFloat(in float rotation,\r\n    in float age,\r\n    in float normalizedAge)\r\n{\r\n#ifdef ROTATIONOVERLIFETIME\r\n    #ifdef ROTATIONOVERLIFETIMECONSTANT\r\n    float ageRot = u_ROLAngularVelocityConst * age;\r\n    rotation += ageRot;\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMECURVE\r\n    rotation += getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient, normalizedAge);\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\n    float ageRot = mix(u_ROLAngularVelocityConst, u_ROLAngularVelocityConstMax, a_Random0.w) * age;\r\n    rotation += ageRot;\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\n    rotation += mix(\r\n\tgetTotalValueFromGradientFloat(u_ROLAngularVelocityGradient, normalizedAge),\r\n\tgetTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,\r\n\t    normalizedAge),\r\n\ta_Random0.w);\r\n    #endif\r\n#endif\r\n#ifdef ROTATIONOVERLIFETIMESEPERATE\r\n    #ifdef ROTATIONOVERLIFETIMECONSTANT\r\n    float ageRot = u_ROLAngularVelocityConstSeprarate.z * age;\r\n    rotation += ageRot;\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMECURVE\r\n    rotation += getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,\r\n\tnormalizedAge);\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\n    float ageRot = mix(u_ROLAngularVelocityConstSeprarate.z,\r\n\t\t       u_ROLAngularVelocityConstMaxSeprarate.z,\r\n\t\t       a_Random0.w)\r\n\t* age;\r\n    rotation += ageRot;\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\n    rotation += mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,\r\n\t\t\tnormalizedAge),\r\n\tgetTotalValueFromGradientFloat(\r\n\t    u_ROLAngularVelocityGradientMaxZ, normalizedAge),\r\n\ta_Random0.w);\r\n    #endif\r\n#endif\r\n    return rotation;\r\n}\r\n\r\n#if defined(RENDERMODE_MESH) && (defined(ROTATIONOVERLIFETIME) || defined(ROTATIONOVERLIFETIMESEPERATE))\r\nvec3 computeParticleRotationVec3(in vec3 rotation,\r\n    in float age,\r\n    in float normalizedAge)\r\n{\r\n    #ifdef ROTATIONOVERLIFETIME\r\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\r\n    float ageRot = u_ROLAngularVelocityConst * age;\r\n    rotation += ageRot;\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMECURVE\r\n    rotation += getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient, normalizedAge);\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\n    float ageRot = mix(u_ROLAngularVelocityConst, u_ROLAngularVelocityConstMax, a_Random0.w) * age;\r\n    rotation += ageRot;\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\n    rotation += mix(\r\n\tgetTotalValueFromGradientFloat(u_ROLAngularVelocityGradient, normalizedAge),\r\n\tgetTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,\r\n\t    normalizedAge),\r\n\ta_Random0.w);\r\n\t#endif\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMESEPERATE\r\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\r\n    vec3 ageRot = u_ROLAngularVelocityConstSeprarate * age;\r\n    rotation += ageRot;\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMECURVE\r\n    rotation += vec3(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,\r\n\t\t\t normalizedAge),\r\n\tgetTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,\r\n\t    normalizedAge),\r\n\tgetTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,\r\n\t    normalizedAge));\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\n    vec3 ageRot = mix(u_ROLAngularVelocityConstSeprarate,\r\n\t\t      u_ROLAngularVelocityConstMaxSeprarate,\r\n\t\t      a_Random0.w)\r\n\t* age;\r\n    rotation += ageRot;\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\n    rotation += vec3(mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,\r\n\t\t\t     normalizedAge),\r\n\t\t\t getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxX,\r\n\t\t\t     normalizedAge),\r\n\t\t\t a_Random0.w),\r\n\tmix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,\r\n\t\tnormalizedAge),\r\n\t    getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxY,\r\n\t\tnormalizedAge),\r\n\t    a_Random0.w),\r\n\tmix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,\r\n\t\tnormalizedAge),\r\n\t    getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,\r\n\t\tnormalizedAge),\r\n\t    a_Random0.w));\r\n\t#endif\r\n    #endif\r\n    return rotation;\r\n}\r\n#endif\r\n\r\nvec2 computeParticleUV(in vec2 uv, in float normalizedAge)\r\n{\r\n#ifdef TEXTURESHEETANIMATIONCURVE\r\n    float cycleNormalizedAge = normalizedAge * u_TSACycles;\r\n    float frame = getFrameFromGradient(\r\n\tu_TSAGradientUVs, cycleNormalizedAge - floor(cycleNormalizedAge));\r\n    float totalULength = frame * u_TSASubUVLength.x;\r\n    float floorTotalULength = floor(totalULength);\r\n    uv.x += totalULength - floorTotalULength;\r\n    uv.y += floorTotalULength * u_TSASubUVLength.y;\r\n#endif\r\n#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\r\n    float cycleNormalizedAge = normalizedAge * u_TSACycles;\r\n    float uvNormalizedAge = cycleNormalizedAge - floor(cycleNormalizedAge);\r\n    float frame = floor(mix(getFrameFromGradient(u_TSAGradientUVs, uvNormalizedAge),\r\n\tgetFrameFromGradient(u_TSAMaxGradientUVs, uvNormalizedAge),\r\n\ta_Random1.x));\r\n    float totalULength = frame * u_TSASubUVLength.x;\r\n    float floorTotalULength = floor(totalULength);\r\n    uv.x += totalULength - floorTotalULength;\r\n    uv.y += floorTotalULength * u_TSASubUVLength.y;\r\n#endif\r\n    return uv;\r\n}\r\n\r\nvoid main()\r\n{\r\n    float age = u_CurrentTime - a_DirectionTime.w;\r\n    float normalizedAge = age / a_ShapePositionStartLifeTime.w;\r\n    vec3 lifeVelocity;\r\n    if (normalizedAge < 1.0)\r\n\t{\r\n\t    vec3 startVelocity = a_DirectionTime.xyz * a_StartSpeed;\r\n#if defined(VELOCITYOVERLIFETIMECONSTANT) || defined(VELOCITYOVERLIFETIMECURVE) || defined(VELOCITYOVERLIFETIMERANDOMCONSTANT) || defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\n\t    lifeVelocity = computeParticleLifeVelocity(normalizedAge); //\r\n#endif\r\n\t    vec3 gravityVelocity = u_Gravity * age;\r\n\r\n\t    vec4 worldRotation;\r\n\t    if (u_SimulationSpace == 0)\r\n\t\tworldRotation = a_SimulationWorldRotation;\r\n\t    else\r\n\t\tworldRotation = u_WorldRotation;\r\n\r\n\t    // drag\r\n\t    vec3 dragData = a_DirectionTime.xyz * mix(u_DragConstanct.x, u_DragConstanct.y, a_Random0.x);\r\n\t    vec3 center = computeParticlePosition(startVelocity, lifeVelocity, age, normalizedAge, gravityVelocity, worldRotation, dragData); //\r\n\r\n#ifdef SPHERHBILLBOARD\r\n\t    vec2 corner = a_CornerTextureCoordinate.xy; // Billboardz\r\n\t    vec3 cameraUpVector = normalize(u_CameraUp); // TODO:\r\n\t    vec3 sideVector = normalize(cross(u_CameraDirection, cameraUpVector));\r\n\t    vec3 upVector = normalize(cross(sideVector, u_CameraDirection));\r\n\t    corner *= computeParticleSizeBillbard(a_StartSize.xy, normalizedAge);\r\n    #if defined(ROTATIONOVERLIFETIME) || defined(ROTATIONOVERLIFETIMESEPERATE)\r\n\t    if (u_ThreeDStartRotation)\r\n\t\t{\r\n\t\t    vec3 rotation = vec3(\r\n\t\t\ta_StartRotation0.xy,\r\n\t\t\tcomputeParticleRotationFloat(a_StartRotation0.z, age, normalizedAge));\r\n\t\t    center += u_SizeScale.xzy * rotationByEuler(corner.x * sideVector + corner.y * upVector, rotation);\r\n\t\t}\r\n\t    else\r\n\t\t{\r\n\t\t    float rot = computeParticleRotationFloat(a_StartRotation0.x, age, normalizedAge);\r\n\t\t    float c = cos(rot);\r\n\t\t    float s = sin(rot);\r\n\t\t    mat2 rotation = mat2(c, -s, s, c);\r\n\t\t    corner = rotation * corner;\r\n\t\t    center += u_SizeScale.xzy * (corner.x * sideVector + corner.y * upVector);\r\n\t\t}\r\n    #else\r\n\t    if (u_ThreeDStartRotation)\r\n\t\t{\r\n\t\t    center += u_SizeScale.xzy * rotationByEuler(corner.x * sideVector + corner.y * upVector, a_StartRotation0);\r\n\t\t}\r\n\t    else\r\n\t\t{\r\n\t\t    float c = cos(a_StartRotation0.x);\r\n\t\t    float s = sin(a_StartRotation0.x);\r\n\t\t    mat2 rotation = mat2(c, -s, s, c);\r\n\t\t    corner = rotation * corner;\r\n\t\t    center += u_SizeScale.xzy * (corner.x * sideVector + corner.y * upVector);\r\n\t\t}\r\n    #endif\r\n#endif\r\n\r\n#ifdef STRETCHEDBILLBOARD\r\n\t    vec2 corner = a_CornerTextureCoordinate.xy; // Billboardz\r\n\t    vec3 velocity;\r\n    #if defined(VELOCITYOVERLIFETIMECONSTANT) || defined(VELOCITYOVERLIFETIMECURVE) || defined(VELOCITYOVERLIFETIMERANDOMCONSTANT) || defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\n\t    if (u_VOLSpaceType == 0)\r\n\t\tvelocity = rotationByQuaternions(u_SizeScale * (startVelocity + lifeVelocity),\r\n\t\t\t       worldRotation)\r\n\t\t    + gravityVelocity;\r\n\t    else\r\n\t\tvelocity = rotationByQuaternions(u_SizeScale * startVelocity, worldRotation) + lifeVelocity + gravityVelocity;\r\n    #else\r\n\t    velocity = rotationByQuaternions(u_SizeScale * startVelocity, worldRotation) + gravityVelocity;\r\n    #endif\r\n\t    vec3 cameraUpVector = normalize(velocity);\r\n\t    vec3 direction = normalize(center - u_CameraPos);\r\n\t    vec3 sideVector = normalize(cross(direction, normalize(velocity)));\r\n\r\n\t    sideVector = u_SizeScale.xzy * sideVector;\r\n\t    cameraUpVector = length(vec3(u_SizeScale.x, 0.0, 0.0)) * cameraUpVector;\r\n\r\n\t    vec2 size = computeParticleSizeBillbard(a_StartSize.xy, normalizedAge);\r\n\r\n\t    const mat2 rotaionZHalfPI = mat2(0.0, -1.0, 1.0, 0.0);\r\n\t    corner = rotaionZHalfPI * corner;\r\n\t    corner.y = corner.y - abs(corner.y);\r\n\r\n\t    float speed = length(velocity); // TODO:\r\n\t    center += sign(u_SizeScale.x) * (sign(u_StretchedBillboardLengthScale) * size.x * corner.x * sideVector + (speed * u_StretchedBillboardSpeedScale + size.y * u_StretchedBillboardLengthScale) * corner.y * cameraUpVector);\r\n#endif\r\n\r\n#ifdef HORIZONTALBILLBOARD\r\n\t    vec2 corner = a_CornerTextureCoordinate.xy; // Billboardz\r\n\t    const vec3 cameraUpVector = vec3(0.0, 0.0, 1.0);\r\n\t    const vec3 sideVector = vec3(-1.0, 0.0, 0.0);\r\n\r\n\t    float rot = computeParticleRotationFloat(a_StartRotation0.x, age, normalizedAge);\r\n\t    float c = cos(rot);\r\n\t    float s = sin(rot);\r\n\t    mat2 rotation = mat2(c, -s, s, c);\r\n\t    corner = rotation * corner * cos(0.78539816339744830961566084581988); // TODO:cos45,U3D\r\n\t    corner *= computeParticleSizeBillbard(a_StartSize.xy, normalizedAge);\r\n\t    center += u_SizeScale.xzy * (corner.x * sideVector + corner.y * cameraUpVector);\r\n#endif\r\n\r\n#ifdef VERTICALBILLBOARD\r\n\t    vec2 corner = a_CornerTextureCoordinate.xy; // Billboardz\r\n\t    const vec3 cameraUpVector = vec3(0.0, 1.0, 0.0);\r\n\t    vec3 sideVector = normalize(cross(u_CameraDirection, cameraUpVector));\r\n\r\n\t    float rot = computeParticleRotationFloat(a_StartRotation0.x, age, normalizedAge);\r\n\t    float c = cos(rot);\r\n\t    float s = sin(rot);\r\n\t    mat2 rotation = mat2(c, -s, s, c);\r\n\t    corner = rotation * corner * cos(0.78539816339744830961566084581988); // TODO:cos45,U3D\r\n\t    corner *= computeParticleSizeBillbard(a_StartSize.xy, normalizedAge);\r\n\t    center += u_SizeScale.xzy * (corner.x * sideVector + corner.y * cameraUpVector);\r\n#endif\r\n\r\n#ifdef RENDERMODE_MESH\r\n\t    vec3 size = computeParticleSizeMesh(a_StartSize, normalizedAge);\r\n    #if defined(ROTATIONOVERLIFETIME) || defined(ROTATIONOVERLIFETIMESEPERATE)\r\n\t    if (u_ThreeDStartRotation)\r\n\t\t{\r\n\t\t    vec3 rotation = vec3(\r\n\t\t\ta_StartRotation0.xy,\r\n\t\t\tcomputeParticleRotationFloat(a_StartRotation0.z, age, normalizedAge));\r\n\t\t    center += rotationByQuaternions(\r\n\t\t\tu_SizeScale * rotationByEuler(a_MeshPosition * size, rotation),\r\n\t\t\tworldRotation);\r\n\t\t}\r\n\t    else\r\n\t\t{\r\n\t#ifdef ROTATIONOVERLIFETIME\r\n\t\t    float angle = computeParticleRotationFloat(a_StartRotation0.x, age, normalizedAge);\r\n\t\t    if (a_ShapePositionStartLifeTime.x != 0.0 || a_ShapePositionStartLifeTime.y != 0.0)\r\n\t\t\t{\r\n\t\t\t    center += (rotationByQuaternions(\r\n\t\t\t\trotationByAxis(\r\n\t\t\t\t    u_SizeScale * a_MeshPosition * size,\r\n\t\t\t\t    normalize(cross(vec3(0.0, 0.0, 1.0),\r\n\t\t\t\t\tvec3(a_ShapePositionStartLifeTime.xy, 0.0))),\r\n\t\t\t\t    angle),\r\n\t\t\t\tworldRotation)); //\r\n\t\t\t}\r\n\t\t    else\r\n\t\t\t{\r\n\t    #ifdef SHAPE\r\n\t\t\t    center += u_SizeScale.xzy * (rotationByQuaternions(rotationByAxis(a_MeshPosition * size, vec3(0.0, -1.0, 0.0), angle), worldRotation));\r\n\t    #else\r\n\t\t\t    if (u_SimulationSpace == 0)\r\n\t\t\t\tcenter += rotationByAxis(u_SizeScale * a_MeshPosition * size,\r\n\t\t\t\t    vec3(0.0, 0.0, -1.0),\r\n\t\t\t\t    angle); //\r\n\t\t\t    else if (u_SimulationSpace == 1)\r\n\t\t\t\tcenter += rotationByQuaternions(\r\n\t\t\t\t    u_SizeScale * rotationByAxis(a_MeshPosition * size, vec3(0.0, 0.0, -1.0), angle),\r\n\t\t\t\t    worldRotation); //\r\n\t    #endif\r\n\t\t\t}\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\r\n\t\t    // TODO:if(u_ThreeDStartRotation),\r\n\t\t    vec3 angle = computeParticleRotationVec3(\r\n\t\t\tvec3(0.0, 0.0, -a_StartRotation0.x), age, normalizedAge);\r\n\t\t    center += (rotationByQuaternions(\r\n\t\t\trotationByEuler(u_SizeScale * a_MeshPosition * size,\r\n\t\t\t    vec3(angle.x, angle.y, angle.z)),\r\n\t\t\tworldRotation)); //\r\n\t#endif\r\n\t\t}\r\n    #else\r\n\t    if (u_ThreeDStartRotation)\r\n\t\t{\r\n\t\t    center += rotationByQuaternions(\r\n\t\t\tu_SizeScale * rotationByEuler(a_MeshPosition * size, a_StartRotation0),\r\n\t\t\tworldRotation); //\r\n\t\t}\r\n\t    else\r\n\t\t{\r\n\t\t    if (a_ShapePositionStartLifeTime.x != 0.0 || a_ShapePositionStartLifeTime.y != 0.0)\r\n\t\t\t{\r\n\t\t\t    if (u_SimulationSpace == 0)\r\n\t\t\t\tcenter += rotationByAxis(\r\n\t\t\t\t    u_SizeScale * a_MeshPosition * size,\r\n\t\t\t\t    normalize(cross(vec3(0.0, 0.0, 1.0),\r\n\t\t\t\t\tvec3(a_ShapePositionStartLifeTime.xy, 0.0))),\r\n\t\t\t\t    a_StartRotation0.x);\r\n\t\t\t    else if (u_SimulationSpace == 1)\r\n\t\t\t\tcenter += (rotationByQuaternions(\r\n\t\t\t\t    u_SizeScale * rotationByAxis(a_MeshPosition * size, normalize(cross(vec3(0.0, 0.0, 1.0), vec3(a_ShapePositionStartLifeTime.xy, 0.0))), a_StartRotation0.x),\r\n\t\t\t\t    worldRotation)); //\r\n\t\t\t}\r\n\t\t    else\r\n\t\t\t{\r\n\t#ifdef SHAPE\r\n\t\t\t    if (u_SimulationSpace == 0)\r\n\t\t\t\tcenter += u_SizeScale * rotationByAxis(a_MeshPosition * size, vec3(0.0, -1.0, 0.0), a_StartRotation0.x);\r\n\t\t\t    else if (u_SimulationSpace == 1)\r\n\t\t\t\tcenter += rotationByQuaternions(\r\n\t\t\t\t    u_SizeScale * rotationByAxis(a_MeshPosition * size, vec3(0.0, -1.0, 0.0), a_StartRotation0.x),\r\n\t\t\t\t    worldRotation);\r\n\t#else\r\n\t\t\t    if (u_SimulationSpace == 0)\r\n\t\t\t\tcenter += rotationByAxis(u_SizeScale * a_MeshPosition * size,\r\n\t\t\t\t    vec3(0.0, 0.0, -1.0),\r\n\t\t\t\t    a_StartRotation0.x);\r\n\t\t\t    else if (u_SimulationSpace == 1)\r\n\t\t\t\tcenter += rotationByQuaternions(\r\n\t\t\t\t    u_SizeScale * rotationByAxis(a_MeshPosition * size, vec3(0.0, 0.0, -1.0), a_StartRotation0.x),\r\n\t\t\t\t    worldRotation); //\r\n\t#endif\r\n\t\t\t}\r\n\t\t}\r\n    #endif\r\n\t    v_MeshColor = a_MeshColor;\r\n#endif\r\n\t    gl_Position = u_Projection * u_View * vec4(center, 1.0);\r\n\t\tvec4 startcolor = gammaToLinear(a_StartColor);\r\n\t    v_Color = computeParticleColor(startcolor, normalizedAge);\r\n#ifdef DIFFUSEMAP\r\n\t    vec2 simulateUV;\r\n    #if defined(SPHERHBILLBOARD) || defined(STRETCHEDBILLBOARD) || defined(HORIZONTALBILLBOARD) || defined(VERTICALBILLBOARD)\r\n\t    simulateUV = a_SimulationUV.xy + a_CornerTextureCoordinate.zw * a_SimulationUV.zw;\r\n\t    v_TextureCoordinate = computeParticleUV(simulateUV, normalizedAge);\r\n    #endif\r\n    #ifdef RENDERMODE_MESH\r\n\t    simulateUV = a_SimulationUV.xy + a_MeshTextureCoordinate * a_SimulationUV.zw;\r\n\t    v_TextureCoordinate = computeParticleUV(simulateUV, normalizedAge);\r\n    #endif\r\n\t    v_TextureCoordinate = TransformUV(v_TextureCoordinate, u_TilingOffset);\r\n#endif\r\n\t}\r\n    else\r\n\t{\r\n\t    gl_Position = vec4(2.0, 2.0, 2.0, 1.0); // Discard use out of X(-1,1),Y(-1,1),Z(0,1)\r\n\t}\r\n    gl_Position = remapPositionZ(gl_Position);\r\n\t#ifdef FOG\r\n        FogHandle(gl_Position.z);\r\n    #endif\r\n}\r\n","#define SHADER_NAME ParticleFS\r\n\r\n#include \"Scene.glsl\";\r\n#include \"SceneFog.glsl\";\r\n#include \"Color.glsl\";\r\n\r\nconst vec4 c_ColorSpace = vec4(4.59479380, 4.59479380, 4.59479380, 2.0);\r\n\r\nvarying vec4 v_Color;\r\nvarying vec2 v_TextureCoordinate;\r\n// uniform sampler2D u_texture;\r\n// uniform vec4 u_Tintcolor;\r\n\r\n#ifdef RENDERMODE_MESH\r\nvarying vec4 v_MeshColor;\r\n#endif\r\n\r\nvoid main()\r\n{\r\n    vec4 color;\r\n#ifdef RENDERMODE_MESH\r\n    color = v_MeshColor;\r\n#else\r\n    color = vec4(1.0);\r\n#endif\r\n\r\n#ifdef DIFFUSEMAP\r\n    vec4 colorT = texture2D(u_texture, v_TextureCoordinate);\r\n    #ifdef Gamma_u_texture\r\n    colorT = gammaToLinear(colorT);\r\n    #endif // Gamma_u_SpecularTexture\r\n    #ifdef TINTCOLOR\r\n    color *= colorT * u_Tintcolor * c_ColorSpace * v_Color;\r\n    #else\r\n    color *= colorT * v_Color;\r\n    #endif // TINTCOLORd\r\n#else\r\n    #ifdef TINTCOLOR\r\n    color *= u_Tintcolor * c_ColorSpace * v_Color;\r\n    #else\r\n    color *= v_Color;\r\n    #endif // TINTCOLOR\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n    if (color.a < u_AlphaTestValue)\r\n\t{\r\n\t    discard;\r\n\t}\r\n#endif // ALPHATEST\r\n\r\n\r\n#ifdef FOG\r\n    color.rgb = scenUnlitFog(color.rgb);\r\n#endif // FOG\r\n    gl_FragColor = color;\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","import { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport SkyProceduralVS from \"./SkyProceduralShader.vs\";\r\nimport SkyProceduralFS from \"./SkyProceduralShader.fs\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { AttributeMapType, SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { CullMode } from \"../../../RenderEngine/RenderEnum/CullMode\";\r\n\r\nexport class SkyProceduralShaderInit {\r\n    static init() {\r\n        let attributeMap: AttributeMapType = {\r\n            \"a_Position\": [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n        };\r\n\r\n        let uniformMap = {\r\n            \"u_SunSize\": ShaderDataType.Float,\r\n            \"u_SunSizeConvergence\": ShaderDataType.Float,\r\n            \"u_AtmosphereThickness\": ShaderDataType.Float,\r\n            \"u_SkyTint\": ShaderDataType.Color,\r\n            \"u_GroundTint\": ShaderDataType.Color,\r\n            \"u_Exposure\": ShaderDataType.Float,\r\n        };\r\n\r\n        let defaultValue = {\r\n            \"u_SunSize\": 0.04,\r\n            \"u_SunSizeConvergence\": 5,\r\n            \"u_AtmosphereThickness\": 1.0,\r\n            \"u_SkyTint\": new Color(0.5, 0.5, 0.5, 1.0),\r\n            \"u_GroundTint\": new Color(0.369, 0.349, 0.341, 1.0),\r\n            \"u_Exposure\": 1.3,\r\n        };\r\n        let shader = Shader3D.add(\"SkyProcedural\");\r\n        \r\n        let subShader = new SubShader(attributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        let pass = subShader.addShaderPass(SkyProceduralVS, SkyProceduralFS);\r\n        pass.renderState.depthTest = RenderState.DEPTHTEST_LEQUAL;\r\n        pass.renderState.cull = CullMode.Back;\r\n        pass.renderState.depthWrite = false;\r\n        pass.renderState.stencilWrite = false;\r\n        pass.statefirst = true;\r\n    }\r\n}","#define SHADER_NAME SkyProceduralVS\r\n\r\n#include \"Camera.glsl\";\r\n\r\nconst float c_deg2ang = 3.141593 / 180.0;\r\n\r\n#define OUTER_RADIUS 1.025\r\n#define RAYLEIGH (mix(0.0, 0.0025, pow(u_AtmosphereThickness,2.5)))// Rayleigh constant Rayleigh\r\n#define MIE 0.0010             // Mie constant \r\n#define SUN_BRIGHTNESS 20.0    // Sun brightness\r\n#define MAX_SCATTER 50.0 // Maximum scattering value, to prevent math overflows on Adrenos\r\n\r\nconst float SKY_GROUND_THRESHOLD = 0.02;\r\nconst float outerRadius = OUTER_RADIUS;\r\nconst float outerRadius2 = OUTER_RADIUS*OUTER_RADIUS;\r\nconst float innerRadius = 1.0;\r\nconst float innerRadius2 = 1.0;\r\nconst float cameraHeight = 0.0001;\r\n\r\nconst float HDSundiskIntensityFactor = 15.0;\r\nconst float simpleSundiskIntensityFactor = 27.0;\r\n\r\nconst float sunScale = 400.0 * SUN_BRIGHTNESS;\r\nconst float kmESun = MIE * SUN_BRIGHTNESS;\r\nconst float km4PI = MIE * 4.0 * 3.14159265;\r\nconst float scale = 1.0 / (OUTER_RADIUS - 1.0);\r\nconst float scaleDepth = 0.25;\r\nconst float scaleOverScaleDepth = (1.0 / (OUTER_RADIUS - 1.0)) / 0.25;\r\nconst float samples = 2.0; // THIS IS UNROLLED MANUALLY, DON'T TOUCH\r\n\r\n// RGB wavelengths        .35 (.62=158), .43 (.68=174), .525 (.75=190)\r\nconst vec3 c_DefaultScatteringWavelength = vec3(0.65, 0.57, 0.475);//\r\nconst vec3 c_VariableRangeForScatteringWavelength = vec3(0.15, 0.15, 0.15);//\r\n\r\n// uniform vec4 u_SkyTint;\r\n// uniform vec4 u_GroundTint;\r\n// uniform float u_Exposure;\r\n// uniform float u_AtmosphereThickness;\r\nvec4 skyRemapGLPositionZ(vec4 position){\r\n\tposition.z = position.w;\r\n\treturn position;\r\n}\r\n//sprite\r\nuniform vec3 u_SunLight_direction;\r\nuniform vec4 u_SunLight_color;\r\n\r\nvarying vec3 v_GroundColor;\r\nvarying vec3 v_SkyColor;\r\n\r\n#ifdef SUN_HIGH_QUALITY\r\n\tvarying vec3 v_Vertex;\r\n#elif defined(SUN_SIMPLE)\r\n\tvarying vec3 v_RayDir;\r\n#else\r\n\tvarying float v_SkyGroundFactor;\r\n#endif\r\n\r\n#if defined(SUN_HIGH_QUALITY)||defined(SUN_SIMPLE)\r\n\tvarying vec3 v_SunColor;\r\n#endif\r\n\r\n// Calculates the Rayleigh phase function\r\nfloat getRayleighPhase(vec3 light, vec3 ray) \r\n{\r\n\tfloat eyeCos = dot(light, ray);\r\n\treturn 0.75 + 0.75*eyeCos*eyeCos;\r\n}\r\n\r\nfloat scaleAngle(float inCos)\r\n{\r\n\tfloat x = 1.0 - inCos;\r\n\treturn 0.25 * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\r\n}\r\n\r\n\r\nvoid main(){\r\n    gl_Position = u_ViewProjection*a_Position;\r\n\r\n    vec3 skyTintInGammaSpace = pow(u_SkyTint.xyz,vec3(0.45));//u_SkyTint.xyz;//GAMMA\r\n\tvec3 scatteringWavelength = mix(c_DefaultScatteringWavelength-c_VariableRangeForScatteringWavelength,c_DefaultScatteringWavelength+c_VariableRangeForScatteringWavelength,vec3(1.0) - skyTintInGammaSpace); // using Tint in sRGB+ gamma allows for more visually linear interpolation and to keep (0.5) at (128, gray in sRGB) point\r\n\tvec3 invWavelength = 1.0 / pow(scatteringWavelength, vec3(4.0));\r\n\r\n\tfloat krESun = RAYLEIGH * SUN_BRIGHTNESS;\r\n\tfloat kr4PI = RAYLEIGH * 4.0 * 3.14159265;\r\n\r\n\tvec3 cameraPos = vec3(0.0,innerRadius + cameraHeight,0.0); // The camera's current position\r\n\r\n\t// Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\r\n\tvec3 eyeRay = normalize(a_Position.xyz);\r\n\r\n\tfloat far = 0.0;\r\n\tvec3 cIn, cOut;\r\n\tif (eyeRay.y >= 0.0) {// Sky\r\n\t\t// Calculate the length of the \"atmosphere\"\r\n\t\tfar = sqrt(outerRadius2 + innerRadius2 * eyeRay.y * eyeRay.y - innerRadius2) - innerRadius * eyeRay.y;\r\n\r\n\t\t// Calculate the ray's starting position, then calculate its scattering offset\r\n\t\tfloat height = innerRadius + cameraHeight;\r\n\t\tfloat depth = exp(scaleOverScaleDepth * -cameraHeight);\r\n\t\tfloat startAngle = dot(eyeRay, cameraPos) / height;\r\n\t\tfloat startOffset = depth*scaleAngle(startAngle);\r\n\r\n\t\t// Initialize the scattering loop variables\r\n\t\tfloat sampleLength = far / samples;\r\n\t\tfloat scaledLength = sampleLength * scale;\r\n\t\tvec3 sampleRay = eyeRay * sampleLength;\r\n\t\tvec3 samplePoint = cameraPos + sampleRay * 0.5;\r\n\r\n\t\tvec3 frontColor = vec3(0.0);\r\n\t\t//unrolling this manually to avoid some platform for loop slow\r\n\t\t{\r\n\t\t\tfloat height = length(samplePoint);\r\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\r\n\t\t\tfloat lightAngle = dot(-u_SunLight_direction, samplePoint) / height;\r\n\t\t\tfloat cameraAngle = dot(eyeRay, samplePoint) / height;\r\n\t\t\tfloat scatter = (startOffset + depth*(scaleAngle(lightAngle) - scaleAngle(cameraAngle)));\r\n\t\t\tvec3 attenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\r\n\r\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\r\n\t\t\tsamplePoint += sampleRay;\r\n\t\t}\r\n\t\t{\r\n\t\t\tfloat height = length(samplePoint);\r\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\r\n\t\t\tfloat lightAngle = dot(-u_SunLight_direction, samplePoint) / height;\r\n\t\t\tfloat cameraAngle = dot(eyeRay, samplePoint) / height;\r\n\t\t\tfloat scatter = (startOffset + depth*(scaleAngle(lightAngle) - scaleAngle(cameraAngle)));\r\n\t\t\tvec3 attenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\r\n\r\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\r\n\t\t\tsamplePoint += sampleRay;\r\n\t\t}\r\n\r\n\t\t// Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\r\n\t\tcIn = frontColor * (invWavelength * krESun);\r\n\t\tcOut = frontColor * kmESun;\r\n\t} else {// Ground\r\n\t\tfar = (-cameraHeight) / (min(-0.001, eyeRay.y));\r\n\t\tvec3 pos = cameraPos + far * eyeRay;\r\n\r\n\t\t// Calculate the ray's starting position, then calculate its scattering offset\r\n\t\tfloat depth = exp((-cameraHeight) * (1.0/scaleDepth));\r\n\t\tfloat cameraAngle = dot(-eyeRay, pos);\r\n\t\tfloat lightAngle = dot(-u_SunLight_direction, pos);\r\n\t\tfloat cameraScale = scaleAngle(cameraAngle);\r\n\t\tfloat lightScale = scaleAngle(lightAngle);\r\n\t\tfloat cameraOffset = depth*cameraScale;\r\n\t\tfloat temp = lightScale + cameraScale;\r\n\r\n\t\t// Initialize the scattering loop variables\r\n\t\tfloat sampleLength = far / samples;\r\n\t\tfloat scaledLength = sampleLength * scale;\r\n\t\tvec3 sampleRay = eyeRay * sampleLength;\r\n\t\tvec3 samplePoint = cameraPos + sampleRay * 0.5;\r\n\r\n\t\t// Now loop through the sample rays\r\n\t\tvec3 frontColor = vec3(0.0, 0.0, 0.0);\r\n\t\tvec3 attenuate;\r\n\r\n\t\t// Loop removed because we kept hitting SM2.0 temp variable limits. Doesn't affect the image too much.\r\n\t\t{\r\n\t\t\tfloat height = length(samplePoint);\r\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\r\n\t\t\tfloat scatter = depth*temp - cameraOffset;\r\n\t\t\tattenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\r\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\r\n\t\t\tsamplePoint += sampleRay;\r\n\t\t}\r\n\r\n\t\tcIn = frontColor * (invWavelength * krESun + kmESun);\r\n\t\tcOut = clamp(attenuate, 0.0, 1.0);\r\n\t}\r\n\r\n\t#ifdef SUN_HIGH_QUALITY\r\n\t\tv_Vertex = -a_Position.xyz;\r\n\t#elif defined(SUN_SIMPLE) \r\n\t\tv_RayDir = -eyeRay;\r\n\t#else\r\n\t\tv_SkyGroundFactor = -eyeRay.y / SKY_GROUND_THRESHOLD;\r\n\t#endif\r\n\r\n\t// if we want to calculate color in vprog:\r\n\t// in case of linear: multiply by _Exposure in here (even in case of lerp it will be common multiplier, so we can skip mul in fshader)\r\n\tv_GroundColor = u_Exposure * (cIn + u_GroundTint.xyz * cOut);//u_GroundColor*u_GroundColor is gamma space convert to linear space\r\n\tv_SkyColor    = u_Exposure * (cIn * getRayleighPhase(-u_SunLight_direction, -eyeRay));\r\n\r\n\t\r\n\t// The sun should have a stable intensity in its course in the sky. Moreover it should match the highlight of a purely specular material.\r\n\t// This matching was done using the Unity3D standard shader BRDF1 on the 5/31/2017\r\n\t// Finally we want the sun to be always bright even in LDR thus the normalization of the lightColor for low intensity.\r\n\tfloat lightColorIntensity = clamp(length(u_SunLight_color.xyz), 0.25, 1.0);\r\n\r\n\t#ifdef SUN_HIGH_QUALITY \r\n\t\tv_SunColor = HDSundiskIntensityFactor * clamp(cOut,0.0,1.0) * u_SunLight_color.xyz / lightColorIntensity;\r\n\t#elif defined(SUN_SIMPLE) \r\n\t\tv_SunColor = simpleSundiskIntensityFactor * clamp(cOut * sunScale,0.0,1.0) * u_SunLight_color.xyz / lightColorIntensity;\r\n\t#endif\r\n\tgl_Position=skyRemapGLPositionZ(gl_Position);\r\n}","#define SHADER_NAME SkyProceduralFS\r\n\r\n#include \"Color.glsl\";\r\n\r\nconst float MIE_G = -0.990;\r\nconst float MIE_G2 = 0.9801;\r\nconst float SKY_GROUND_THRESHOLD = 0.02;\r\n\r\n// uniform float u_SunSize;\r\n// uniform float u_SunSizeConvergence;\r\n\r\nuniform vec3 u_SunLight_direction;\r\n\r\nvarying vec3 v_GroundColor;\r\nvarying vec3 v_SkyColor;\r\n\r\n#ifdef SUN_HIGH_QUALITY\r\nvarying vec3 v_Vertex;\r\n#elif defined(SUN_SIMPLE)\r\nvarying vec3 v_RayDir;\r\n#else\r\nvarying float v_SkyGroundFactor;\r\n#endif\r\n\r\n#if defined(SUN_HIGH_QUALITY) || defined(SUN_SIMPLE)\r\nvarying vec3 v_SunColor;\r\n#endif\r\n\r\n// Calculates the Mie phase function\r\nfloat getMiePhase(float eyeCos, float eyeCos2)\r\n{\r\n    float temp = 1.0 + MIE_G2 - 2.0 * MIE_G * eyeCos;\r\n    temp = pow(temp, pow(u_SunSize, 0.65) * 10.0);\r\n    temp = max(temp, 1.0e-4); // prevent division by zero, esp. in half precision\r\n    temp = 1.5 * ((1.0 - MIE_G2) / (2.0 + MIE_G2)) * (1.0 + eyeCos2) / temp;\r\n    return temp;\r\n}\r\n\r\n// Calculates the sun shape\r\nfloat calcSunAttenuation(vec3 lightPos, vec3 ray)\r\n{\r\n#ifdef SUN_HIGH_QUALITY\r\n    float focusedEyeCos = pow(clamp(dot(lightPos, ray), 0.0, 1.0), u_SunSizeConvergence);\r\n    return getMiePhase(-focusedEyeCos, focusedEyeCos * focusedEyeCos);\r\n#else // SUN_SIMPLE\r\n    vec3 delta = lightPos - ray;\r\n    float dist = length(delta);\r\n    float spot = 1.0 - smoothstep(0.0, u_SunSize, dist);\r\n    return spot * spot;\r\n#endif\r\n}\r\n\r\nvoid main()\r\n{\r\n    // if y > 1 [eyeRay.y < -SKY_GROUND_THRESHOLD] - ground\r\n    // if y >= 0 and < 1 [eyeRay.y <= 0 and > -SKY_GROUND_THRESHOLD] - horizon\r\n    // if y < 0 [eyeRay.y > 0] - sky\r\n    vec3 col = vec3(0.0, 0.0, 0.0);\r\n\r\n#ifdef SUN_HIGH_QUALITY\r\n    vec3 ray = normalize(v_Vertex);\r\n    float y = ray.y / SKY_GROUND_THRESHOLD;\r\n#elif defined(SUN_SIMPLE)\r\n    vec3 ray = v_RayDir;\r\n    float y = ray.y / SKY_GROUND_THRESHOLD;\r\n#else\r\n    float y = v_SkyGroundFactor;\r\n#endif\r\n\r\n    // if we did precalculate color in vprog: just do lerp between them\r\n    col = mix(v_SkyColor, v_GroundColor, clamp(y, 0.0, 1.0));\r\n\r\n#if defined(SUN_HIGH_QUALITY) || defined(SUN_SIMPLE)\r\n    if (y < 0.0)\r\n\tcol += v_SunColor * calcSunAttenuation(-u_SunLight_direction, -ray);\r\n#endif\r\n\r\n    // col = sqrt(col);//linear space convert to gamma space\r\n    gl_FragColor = vec4(col, 1.0);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}\r\n","import { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport SkyPanoramicVS from \"./SkyPanoramic.vs\";\r\nimport SkyPanoramicFS from \"./SkyPanoramic.fs\";\r\nimport { Texture2D } from \"../../../resource/Texture2D\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { AttributeMapType, SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { CullMode } from \"../../../RenderEngine/RenderEnum/CullMode\";\r\n\r\nexport class SkyPanoramicShaderInit {\r\n    static init() {\r\n        let attributeMap: AttributeMapType = {\r\n            \"a_Position\": [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n        };\r\n\r\n        let uniformMap = {\r\n            'u_TintColor': ShaderDataType.Color,\r\n            'u_Rotation': ShaderDataType.Float,\r\n            'u_Texture': ShaderDataType.Texture2D,\r\n            'u_Exposure':ShaderDataType.Float,\r\n        };\r\n\r\n        let defaultValue = {\r\n            'u_TintColor': new Color(0.5,0.5,0.5,1.0),\r\n            'u_Exposure': 1.3,\r\n            'u_Rotation': 0,\r\n            'u_Texture': Texture2D.grayTexture,\r\n        };\r\n        let shader = Shader3D.add(\"SkyPanoramic\");\r\n        let subShader = new SubShader(attributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        let pass = subShader.addShaderPass(SkyPanoramicVS, SkyPanoramicFS);\r\n        pass.renderState.depthTest = RenderState.DEPTHTEST_LEQUAL;\r\n        pass.renderState.cull = CullMode.Back;\r\n        pass.renderState.depthWrite = false;\r\n        pass.renderState.stencilWrite = false;\r\n        pass.statefirst = true;\r\n    }\r\n}","#define SHADER_NAME SkyPanoramicVS\r\n\r\n#include \"Camera.glsl\";\r\n#define PI 3.14159265359\r\n\r\n//attribute vec4 a_Position;\r\n\r\n//uniform float u_Rotation;\r\n\r\nvarying vec3 v_Texcoord;\r\nvarying vec2 v_Image180ScaleAndCutoff;\r\nvarying vec4 v_Layout3DScaleAndOffset;\r\n\r\nvec4 skyRemapGLPositionZ(vec4 position){\r\n\tposition.z = position.w;\r\n\treturn position;\r\n}\r\n\r\nvec4 rotateAroundYInDegrees (vec4 vertex, float degrees)\r\n{\r\n\tfloat angle = degrees * PI / 180.0;\r\n\tfloat sina=sin(angle);\r\n\tfloat cosa=cos(angle);\r\n\tmat2 m = mat2(cosa, -sina, sina, cosa);\r\n\treturn vec4(m*vertex.xz, vertex.yw).xzyw;\r\n}\r\n\t\r\nvoid main()\r\n{\r\n\tvec4 position = rotateAroundYInDegrees(a_Position, u_Rotation);\r\n\t\r\n\r\n\tv_Texcoord=vec3(-a_Position.x,-a_Position.y,a_Position.z);// NOTE: -a_Position.x convert coords system\r\n\r\n\t// Calculate constant horizontal scale and cutoff for 180 (vs 360) image type\r\n\tv_Image180ScaleAndCutoff = vec2(1.0, 1.0);// 360 degree mode\r\n\r\n\t// Calculate constant scale and offset for 3D layouts\r\n\tv_Layout3DScaleAndOffset = vec4(0,0,1,1);\r\n\tgl_Position = u_ViewProjection*position;\r\n\tgl_Position=skyRemapGLPositionZ(gl_Position);\r\n\r\n}\r\n","#define SHADER_NAME SkyPanoramicVS\r\n\r\n#include \"Color.glsl\";\r\n\r\nvarying vec3 v_Texcoord;\r\nvarying vec2 v_Image180ScaleAndCutoff;\r\nvarying vec4 v_Layout3DScaleAndOffset;\r\nconst vec4 c_ColorSpace = vec4(4.59479380, 4.59479380, 4.59479380, 2.0);\r\n\r\nvec2 ToRadialCoords(vec3 coords)\r\n{\r\n    vec3 normalizedCoords = normalize(coords);\r\n    float latitude = acos(normalizedCoords.y);\r\n    float longitude = atan(normalizedCoords.z, normalizedCoords.x);\r\n    vec2 sphereCoords = vec2(longitude, latitude) * vec2(0.5 / PI, 1.0 / PI);\r\n    return vec2(0.5, 1.0) - sphereCoords;\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec2 tc = ToRadialCoords(v_Texcoord);\r\n    if (tc.x > v_Image180ScaleAndCutoff.y)\r\n\tgl_FragColor = vec4(0, 0, 0, 1);\r\n    tc.x = mod(tc.x * v_Image180ScaleAndCutoff.x, 1.0);\r\n    tc = (tc + v_Layout3DScaleAndOffset.xy) * v_Layout3DScaleAndOffset.zw;\r\n\r\n    mediump vec4 tex = texture2D(u_Texture, tc);\r\n#ifdef Gamma_u_Texture\r\n    tex = gammaToLinear(tex);\r\n#endif // Gamma_u_Texture\r\n    mediump vec3 c = tex.xyz;\r\n    c = c * u_TintColor.rgb * c_ColorSpace.rgb;\r\n    c *= u_Exposure;\r\n    gl_FragColor = vec4(c, 1.0);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}\r\n","import { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\n\r\nimport UtillitiesColorGLSL from \"./lib/UtillitiesColor.glsl\";\r\nimport TransformCommonGLSL from \"./lib/TransformCommon.glsl\";\r\nimport RRTCommonGLSL from \"./lib/RRTCommon.glsl\";\r\nimport ODTCommonGLSL from \"./lib/ODTCommon.glsl\";\r\nimport TonescalesGLSL from \"./lib/Tonescales.glsl\";\r\n\r\nimport RRTGLSL from \"./rrt/RRT.glsl\";\r\nimport ODT_sRGB_100nits_GLSL from \"./odt/ODT_sRGB_100nits.glsl\";\r\n\r\nimport ACESGLSL from \"./ACES.glsl\";\r\n\r\nexport class ACESShaderLib {\r\n\r\n    static init() {\r\n        Shader3D.addInclude(\"ACES_UtillitiesColor.glsl\", UtillitiesColorGLSL);\r\n        Shader3D.addInclude(\"ACES_TransformCommon.glsl\", TransformCommonGLSL);\r\n        Shader3D.addInclude(\"ACES_Tonescales.glsl\", TonescalesGLSL);\r\n        Shader3D.addInclude(\"ACES_RRTCommon.glsl\", RRTCommonGLSL);\r\n        Shader3D.addInclude(\"ACES_ODTCommon.glsl\", ODTCommonGLSL);\r\n\r\n        Shader3D.addInclude(\"ACES_RRT.glsl\", RRTGLSL);\r\n        Shader3D.addInclude(\"ACES_ODT_sRGB_100nits.glsl\", ODT_sRGB_100nits_GLSL);\r\n\r\n        Shader3D.addInclude(\"ACES.glsl\", ACESGLSL);\r\n    }\r\n\r\n}","#if !defined(UtillitiesColor_lib)\r\n#define UtillitiesColor_lib\r\n\r\n// Transformations between CIE XYZ tristimulus values and CIE x,y\r\n// chromaticity coordinates\r\nvec3 XYZ_2_xyY(vec3 XYZ)\r\n{\r\n    vec3 xyY;\r\n    float divisor = max(XYZ.x + XYZ.y + XYZ.z, 1e-10);\r\n    xyY.x = XYZ.x / divisor;\r\n    xyY.y = XYZ.y / divisor;\r\n    xyY.z = XYZ.y;\r\n    return xyY;\r\n}\r\n\r\nvec3 xyY_2_XYZ(vec3 xyY)\r\n{\r\n    vec3 XYZ;\r\n    XYZ.x = xyY.x * xyY.z / max(xyY.y, 1e-10);\r\n    XYZ.y = xyY.z;\r\n    XYZ.z = (1.0 - xyY.x - xyY.y) * xyY.z / max(xyY.y, 1e-10);\r\n    return XYZ;\r\n}\r\n\r\nfloat rgb_2_yc(vec3 rgb, float ycRadiusWeight)\r\n{\r\n    float r = rgb.r;\r\n    float g = rgb.g;\r\n    float b = rgb.b;\r\n    float k = b * (b - g) + g * (g - r) + r * (r - b);\r\n    k = max(MEDIUMP_FLT_MIN, k);\r\n    float chroma = sqrt(k);\r\n    return (b + g + r + ycRadiusWeight * chroma) / 3.0;\r\n}\r\n\r\nfloat rgb_2_yc(vec3 rgb)\r\n{\r\n    return rgb_2_yc(rgb, 1.75);\r\n}\r\n\r\n// Transformations from RGB to other color representations\r\n\r\n// Returns a geometric hue angle in degrees (0-360) based on RGB values.\r\nfloat rgb_2_hue(vec3 rgb)\r\n{\r\n    float hue;\r\n    // For neutral colors, hue is undefined and the function will return a quiet NaN value.\r\n    // if (rgb.r == rgb.g && rgb.g == rgb.b) {\r\n    //     // hue = FLT_NAN;\r\n    //     // todo FLT_NAN\r\n    //     hue = 0.0;\r\n    // } else {\r\n    //     hue = (180.0 * INVERT_PI) * atan2(sqrt(3.0) * (rgb.g - rgb.b), 2.0 * rgb.r - rgb.g - rgb.b);\r\n    // }\r\n    if (rgb.x == rgb.y && rgb.y == rgb.z)\r\n        hue = 0.0; // RGB triplets where RGB are equal have an undefined hue\r\n    else\r\n        hue = (180.0 * INVERT_PI) * atan(sqrt(3.0) * (rgb.y - rgb.z), 2.0 * rgb.x - rgb.y - rgb.z);\r\n\r\n    if (hue < 0.0) {\r\n        hue = hue + 360.0;\r\n    }\r\n\r\n    return hue;\r\n}\r\n\r\n#endif // UtillitiesColor_lib","#if !defined(TransformCommon_lib)\r\n    #define TransformCommon_lib\r\n\r\nconst float TINY = 1e-10;\r\n\r\n// sRGB D65 to AP0 D60\r\n// https://www.colour-science.org:8010/apps/rgb_colourspace_transformation_matrix CAT 02\r\nconst mat3 sRGB_to_AP0_MAT = mat3(\r\n    vec3(0.4395856442, 0.0895395735, 0.0173871832),\r\n    vec3(0.3839294030, 0.8147498351, 0.1087391143),\r\n    vec3(0.1765327364, 0.0956836061, 0.8738205876));\r\n\r\n// sRGB D65 to AP1 D60\r\n// https://www.colour-science.org:8010/apps/rgb_colourspace_transformation_matrix CAT 02\r\nconst mat3 sRGB_to_AP1_MAT = mat3(\r\n    vec3(0.6131178129, 0.0699340823, 0.0204629926),\r\n    vec3(0.3411819959, 0.9181030375, 0.1067686634),\r\n    vec3(0.0457873443, 0.0119327755, 0.8727159106));\r\n\r\nconst mat3 AP1_to_XYZ_MAT = mat3(\r\n    vec3(0.6624541811, 0.2722287168, -0.0055746495),\r\n    vec3(0.1340042065, 0.6740817658, 0.0040607335),\r\n    vec3(0.1561876870, 0.0536895174, 1.0103391003));\r\n\r\nconst mat3 AP0_to_AP1_MAT = mat3(\r\n    vec3(1.4514393161, -0.0765537734, 0.0083161484),\r\n    vec3(-0.2365107469, 1.1762296998, -0.0060324498),\r\n    vec3(-0.2149285693, -0.0996759264, 0.9977163014));\r\n\r\nconst mat3 AP1_to_AP0_MAT = mat3(\r\n    vec3(0.6954522414, 0.0447945634, -0.0055258826),\r\n    vec3(0.1406786965, 0.8596711185, 0.0040252103),\r\n    vec3(0.1638690622, 0.0955343182, 1.0015006723));\r\n\r\nconst mat3 XYZ_to_AP1_MAT = mat3(\r\n    vec3(1.6410233797, -0.6636628587, 0.0117218943),\r\n    vec3(-0.3248032942, 1.6153315917, -0.0082844420),\r\n    vec3(-0.2364246952, 0.0167563477, 0.9883948585));\r\n\r\nconst vec3 AP1_RGB2Y = vec3(0.2722287168, 0.6740817658, 0.0536895174);\r\n\r\nfloat ACES_to_ACEScc(float x)\r\n{\r\n    // if (x <= 0.0)\r\n    // return -0.35828683;\r\n    // else if (x < pow(2.0, -15.0))\r\n    // return (log2(pow(2.0, -16.0) + x * 0.5) + 9.72) / 17.52;\r\n    // else\r\n    // return (log2(x) + 9.72) / 17.52;\r\n\r\n    return (x < 0.00003051757) ? (log2(0.00001525878 + x * 0.5) + 9.72) / 17.52 : (log2(x) + 9.72) / 17.52;\r\n}\r\n\r\nvec3 ACES_to_ACEScc(vec3 x)\r\n{\r\n    x = clamp(x, vec3(0.0), vec3(MEDIUMP_FLT_MAX));\r\n    x.x = ACES_to_ACEScc(x.x);\r\n    x.y = ACES_to_ACEScc(x.y);\r\n    x.z = ACES_to_ACEScc(x.z);\r\n\r\n    return x;\r\n}\r\n\r\nfloat ACEScc_to_ACES(float x)\r\n{\r\n    if (x < -0.3013698630)\r\n\treturn (pow(2.0, x * 17.52 - 9.72) - pow(2.0, -16.0)) * 2.0;\r\n    else if (x < (log2(MEDIUMP_FLT_MAX) + 9.72) / 17.52)\r\n\treturn pow(2.0, x * 17.52 - 9.72);\r\n    else\r\n\treturn MEDIUMP_FLT_MAX;\r\n}\r\n\r\nvec3 ACEScc_to_ACES(vec3 x)\r\n{\r\n    x.x = ACEScc_to_ACES(x.x);\r\n    x.y = ACEScc_to_ACES(x.y);\r\n    x.z = ACEScc_to_ACES(x.z);\r\n    return x;\r\n}\r\n\r\nfloat rgb_2_saturation(vec3 rgb)\r\n{\r\n    float rgbmax = vecmax(rgb);\r\n    float rgbmin = vecmin(rgb);\r\n    return (max(rgbmax, TINY) - max(rgbmin, TINY)) / max(rgbmax, 1e-2);\r\n}\r\n\r\n#endif // TransformCommon_lib","#if !defined(Tonescales_lib)\r\n#define Tonescales_lib\r\n\r\nconst mat3 M = mat3(\r\n    vec3(0.5, -1.0, 0.5),\r\n    vec3(-1.0, 1.0, 0.5),\r\n    vec3(0.5, 0.0, 0.0));\r\n\r\nfloat segmented_spline_c5_fwd(float x)\r\n{\r\n#ifdef GRAPHICS_API_GLES3\r\n    const float coefsLow[6] = float[6](-4.0000000000, -4.0000000000, -3.1573765773, -0.4852499958, 1.8477324706, 1.8477324706);\r\n    const float coefsHigh[6] = float[6](-0.7185482425, 2.0810307172, 3.6681241237, 4.0000000000, 4.0000000000, 4.0000000000);\r\n#else\r\n    const float coefsLow_0 = -4.0000000000;\r\n    const float coefsLow_1 = -4.0000000000;\r\n    const float coefsLow_2 = -3.1573765773;\r\n    const float coefsLow_3 = -0.4852499958;\r\n    const float coefsLow_4 = 1.8477324706;\r\n    const float coefsLow_5 = 1.8477324706;\r\n\r\n    const float coefsHigh_0 = -0.7185482425;\r\n    const float coefsHigh_1 = 2.0810307172;\r\n    const float coefsHigh_2 = 3.6681241237;\r\n    const float coefsHigh_3 = 4.0000000000;\r\n    const float coefsHigh_4 = 4.0000000000;\r\n    const float coefsHigh_5 = 4.0000000000;\r\n#endif // GRAPHICS_API_GLES3\r\n\r\n    const vec2 minPoint = vec2(0.0000054931640625, 0.0001);\r\n    const vec2 midPoint = vec2(0.18, 4.8);\r\n    const vec2 maxPoint = vec2(47185.92, 10000.);\r\n    const float slopeLow = 0.0;\r\n    const float slopeHigh = 0.0;\r\n\r\n    const int N_KNOTS_LOW = 4;\r\n    const int N_KNOTS_HIGH = 4;\r\n\r\n    float logx = log10(max(x, MEDIUMP_FLT_MIN));\r\n    float logy;\r\n\r\n    if (logx <= log10(minPoint.x)) {\r\n        logy = logx * slopeLow + (log10(minPoint.y) - slopeLow * log10(minPoint.x));\r\n    } else if ((logx > log10(minPoint.x)) && (logx < log10(midPoint.x))) {\r\n        float knot_coord = float(N_KNOTS_LOW - 1) * (logx - log10(minPoint.x)) / (log10(midPoint.x) - log10(minPoint.x));\r\n        int j = int(knot_coord);\r\n        float t = knot_coord - float(j);\r\n        vec3 cf;\r\n#ifdef GRAPHICS_API_GLES3\r\n        cf = vec3(coefsLow[j], coefsLow[j + 1], coefsLow[j + 2]);\r\n#else\r\n        if (j <= 0) {\r\n            cf = vec3(coefsLow_0, coefsLow_1, coefsLow_2);\r\n        } else if (j == 1) {\r\n            cf = vec3(coefsLow_1, coefsLow_2, coefsLow_3);\r\n        } else if (j == 2) {\r\n            cf = vec3(coefsLow_2, coefsLow_3, coefsLow_4);\r\n        } else { // if (j == 3)\r\n            cf = vec3(coefsLow_3, coefsLow_4, coefsLow_5);\r\n        }\r\n#endif // GRAPHICS_API_GLES3\r\n\r\n        vec3 monomials = vec3(t * t, t, 1.);\r\n        logy = dot(monomials, M * cf);\r\n    } else if ((logx >= log10(midPoint.x)) && (logx < log10(maxPoint.x))) {\r\n        float knot_coord = float(N_KNOTS_HIGH - 1) * (logx - log10(midPoint.x)) / (log10(maxPoint.x) - log10(midPoint.x));\r\n        int j = int(knot_coord);\r\n        float t = knot_coord - float(j);\r\n        vec3 cf;\r\n#ifdef GRAPHICS_API_GLES3\r\n        cf = vec3(coefsHigh[j], coefsHigh[j + 1], coefsHigh[j + 2]);\r\n#else\r\n        if (j <= 0) {\r\n            cf = vec3(coefsHigh_0, coefsHigh_1, coefsHigh_2);\r\n        } else if (j == 1) {\r\n            cf = vec3(coefsHigh_1, coefsHigh_2, coefsHigh_3);\r\n        } else if (j == 2) {\r\n            cf = vec3(coefsHigh_2, coefsHigh_3, coefsHigh_4);\r\n        } else { // if (j == 3)\r\n            cf = vec3(coefsHigh_3, coefsHigh_4, coefsHigh_5);\r\n        }\r\n#endif // #ifdef GRAPHICS_API_GLES3\r\n        vec3 monomials = vec3(t * t, t, 1.);\r\n        logy = dot(monomials, M * cf);\r\n    } else {\r\n        logy = logx * slopeHigh + (log10(maxPoint.y) - slopeHigh * log10(maxPoint.x));\r\n    }\r\n    return pow(10.0, logy);\r\n}\r\n\r\nfloat segmented_spline_c9_fwd(float x)\r\n{\r\n// ODT_48nits\r\n#ifdef GRAPHICS_API_GLES3\r\n    const float coefsLow[10] = float[10](-1.6989700043, -1.6989700043, -1.4779000000, -1.2291000000, -0.8648000000, -0.4480000000, 0.0051800000, 0.4511080334, 0.9113744414, 0.9113744414);\r\n    const float coefsHigh[10] = float[10](0.5154386965, 0.8470437783, 1.1358000000, 1.3802000000, 1.5197000000, 1.5985000000, 1.6467000000, 1.6746091357, 1.6878733390, 1.6878733390);\r\n#else\r\n    const float coefsLow_0 = -1.6989700043;\r\n    const float coefsLow_1 = -1.6989700043;\r\n    const float coefsLow_2 = -1.4779000000;\r\n    const float coefsLow_3 = -1.2291000000;\r\n    const float coefsLow_4 = -0.8648000000;\r\n    const float coefsLow_5 = -0.4480000000;\r\n    const float coefsLow_6 = 0.0051800000;\r\n    const float coefsLow_7 = 0.4511080334;\r\n    const float coefsLow_8 = 0.9113744414;\r\n    const float coefsLow_9 = 0.9113744414;\r\n\r\n    const float coefsHigh_0 = 0.5154386965;\r\n    const float coefsHigh_1 = 0.8470437783;\r\n    const float coefsHigh_2 = 1.1358000000;\r\n    const float coefsHigh_3 = 1.3802000000;\r\n    const float coefsHigh_4 = 1.5197000000;\r\n    const float coefsHigh_5 = 1.5985000000;\r\n    const float coefsHigh_6 = 1.6467000000;\r\n    const float coefsHigh_7 = 1.6746091357;\r\n    const float coefsHigh_8 = 1.6878733390;\r\n    const float coefsHigh_9 = 1.6878733390;\r\n#endif // GRAPHICS_API_GLES3\r\n\r\n    // todo const\r\n    vec2 minPoint = vec2(segmented_spline_c5_fwd(0.18 * pow(2.0, -6.5)), 0.02);\r\n    vec2 midPoint = vec2(segmented_spline_c5_fwd(0.18), 4.8);\r\n    vec2 maxPoint = vec2(segmented_spline_c5_fwd(0.18 * pow(2., 6.5)), 48.0);\r\n\r\n    const float slopeLow = 0.0;\r\n    const float slopeHigh = 0.04;\r\n\r\n    const int N_KNOTS_LOW = 8;\r\n    const int N_KNOTS_HIGH = 8;\r\n\r\n    float logx = log10(max(x, MEDIUMP_FLT_MIN));\r\n    float logy;\r\n\r\n    if (logx <= log10(minPoint.x)) {\r\n        logy = logx * slopeLow + (log10(minPoint.y) - slopeLow * log10(minPoint.x));\r\n    } else if ((logx > log10(minPoint.x)) && (logx < log10(midPoint.x))) {\r\n        float knot_coord = float(N_KNOTS_LOW - 1) * (logx - log10(minPoint.x)) / (log10(midPoint.x) - log10(minPoint.x));\r\n        int j = int(knot_coord);\r\n        float t = knot_coord - float(j);\r\n        vec3 cf;\r\n#ifdef GRAPHICS_API_GLES3\r\n        cf = vec3(coefsLow[j], coefsLow[j + 1], coefsLow[j + 2]);\r\n#else\r\n        if (j <= 0) {\r\n            cf = vec3(coefsLow_0, coefsLow_1, coefsLow_2);\r\n        } else if (j == 1) {\r\n            cf = vec3(coefsLow_1, coefsLow_2, coefsLow_3);\r\n        } else if (j == 2) {\r\n            cf = vec3(coefsLow_2, coefsLow_3, coefsLow_4);\r\n        } else if (j == 3) {\r\n            cf = vec3(coefsLow_3, coefsLow_4, coefsLow_5);\r\n        } else if (j == 4) {\r\n            cf = vec3(coefsLow_4, coefsLow_5, coefsLow_6);\r\n        } else if (j == 5) {\r\n            cf = vec3(coefsLow_5, coefsLow_6, coefsLow_7);\r\n        } else if (j == 6) {\r\n            cf = vec3(coefsLow_6, coefsLow_7, coefsLow_8);\r\n        } else { // if (j == 7)\r\n            cf = vec3(coefsLow_7, coefsLow_8, coefsLow_9);\r\n        }\r\n#endif // GRAPHICS_API_GLES3\r\n        vec3 monomials = vec3(t * t, t, 1.0);\r\n        logy = dot(monomials, M * cf);\r\n    } else if ((logx >= log10(midPoint.x)) && (logx < log10(maxPoint.x))) {\r\n        float knot_coord = float(N_KNOTS_HIGH - 1) * (logx - log10(midPoint.x)) / (log10(maxPoint.x) - log10(midPoint.x));\r\n        int j = int(knot_coord);\r\n        float t = knot_coord - float(j);\r\n        vec3 cf;\r\n#ifdef GRAPHICS_API_GLES3\r\n        cf = vec3(coefsHigh[j], coefsHigh[j + 1], coefsHigh[j + 2]);\r\n#else\r\n        if (j <= 0) {\r\n            cf = vec3(coefsHigh_0, coefsHigh_1, coefsHigh_2);\r\n        } else if (j == 1) {\r\n            cf = vec3(coefsHigh_1, coefsHigh_2, coefsHigh_3);\r\n        } else if (j == 2) {\r\n            cf = vec3(coefsHigh_2, coefsHigh_3, coefsHigh_4);\r\n        } else if (j == 3) {\r\n            cf = vec3(coefsHigh_3, coefsHigh_4, coefsHigh_5);\r\n        } else if (j == 4) {\r\n            cf = vec3(coefsHigh_4, coefsHigh_5, coefsHigh_6);\r\n        } else if (j == 5) {\r\n            cf = vec3(coefsHigh_5, coefsHigh_6, coefsHigh_7);\r\n        } else if (j == 6) {\r\n            cf = vec3(coefsHigh_6, coefsHigh_7, coefsHigh_8);\r\n        } else { // if (j == 7)\r\n            cf = vec3(coefsHigh_7, coefsHigh_8, coefsHigh_9);\r\n        }\r\n#endif // GRAPHICS_API_GLES3\r\n        vec3 monomials = vec3(t * t, t, 1.0);\r\n        logy = dot(monomials, M * cf);\r\n    } else {\r\n        logy = logx * slopeHigh + (log10(maxPoint.y) - slopeHigh * log10(maxPoint.x));\r\n    }\r\n\r\n    return pow(10.0, logy);\r\n}\r\n\r\n#endif // Tonescales_lib","#if !defined(RRTCommon_lib)\r\n#define RRTCommon_lib\r\n\r\n// \"Glow\" module constants\r\nconst float RRT_GLOW_GAIN = 0.05;\r\nconst float RRT_GLOW_MID = 0.08;\r\n\r\n// Red modifier constants\r\nconst float RRT_RED_SCALE = 0.82;\r\nconst float RRT_RED_PIVOT = 0.03;\r\nconst float RRT_RED_HUE = 0.;\r\nconst float RRT_RED_WIDTH = 135.;\r\n\r\n// Desaturation contants\r\nconst float RRT_SAT_FACTOR = 0.96;\r\n\r\n// ------- Glow module functions\r\n\r\nfloat glow_fwd(float ycIn, float glowGainIn, float glowMid)\r\n{\r\n    float glowGainOut;\r\n    if (ycIn <= 2.0 / 3.0 * glowMid) {\r\n        glowGainOut = glowGainIn;\r\n    } else if (ycIn >= 2.0 * glowMid) {\r\n        glowGainOut = 0.0;\r\n    } else {\r\n        glowGainOut = glowGainIn * (glowMid / ycIn - 0.5);\r\n    }\r\n    return glowGainOut;\r\n}\r\n\r\n// Sigmoid function in the range 0 to 1 spanning -2 to +2.\r\nfloat sigmoid_shaper(float x)\r\n{\r\n    float t = max(1.0 - abs(x * 0.5), 0.0);\r\n    float y = 1.0 + sign(x) * (1.0 - t * t);\r\n\r\n    return y * 0.5;\r\n}\r\n\r\n// ------- Red modifier functions\r\nfloat center_hue(float hue, float centerH)\r\n{\r\n    float hueCentered = hue - centerH;\r\n    if (hueCentered < -180.0) {\r\n        hueCentered = hueCentered + 360.0;\r\n    } else if (hueCentered > 180.0) {\r\n        hueCentered -= 360.0;\r\n    }\r\n    return hueCentered;\r\n}\r\n\r\n#endif // RRTCommon_lib","#if !defined(ODTCommon_lib)\r\n#define ODTCommon_lib\r\n\r\nconst float CINEMA_WHITE = 48.0;\r\nconst float CINEMA_BLACK = 0.02; // CINEMA_WHITE / 2400.\r\n\r\n// Gamma compensation factor\r\nconst float DIM_SURROUND_GAMMA = 0.9811;\r\n\r\n// Saturation compensation factor\r\nconst float ODT_SAT_FACTOR = 0.93;\r\n\r\n// white point D60 to D65\r\n// ACES white point D60\r\nconst mat3 D60_to_D65_MAT = mat3(\r\n    vec3(0.987224, -0.00759836, 0.00307257),\r\n    vec3(-0.00611327, 1.00186, -0.00509595),\r\n    vec3(0.0159533, 0.00533002, 1.08168));\r\n\r\nfloat Y_2_linCV(float Y, float Ymax, float Ymin)\r\n{\r\n    return (Y - Ymin) / (Ymax - Ymin);\r\n}\r\n\r\nvec3 darkSurround_to_dimSurround(vec3 linearCV)\r\n{\r\n    vec3 XYZ = linearCV * AP1_to_XYZ_MAT;\r\n    vec3 xyY = XYZ_2_xyY(XYZ);\r\n    xyY.z = clamp(xyY.z, 0.0, MEDIUMP_FLT_MAX);\r\n    xyY.z = pow(xyY.z, DIM_SURROUND_GAMMA);\r\n    XYZ = xyY_2_XYZ(xyY);\r\n\r\n    return XYZ * XYZ_to_AP1_MAT;\r\n}\r\n\r\n#endif // ODTCommon_lib","#if !defined(RRT_lib)\r\n#define RRT_lib\r\n\r\n#include \"ACES_RRTCommon.glsl\";\r\n\r\n/**\r\n * @param ACES AP0\r\n * @returns OCES\r\n */\r\nvec3 RRT(vec3 aces)\r\n{\r\n    // --- Glow module --- //\r\n    float saturation = rgb_2_saturation(aces);\r\n    float ycIn = rgb_2_yc(aces);\r\n    float s = sigmoid_shaper((saturation - 0.4) / 0.2);\r\n    float addedGlow = 1.0 + glow_fwd(ycIn, RRT_GLOW_GAIN * s, RRT_GLOW_MID);\r\n\r\n    aces *= addedGlow;\r\n\r\n    // --- Red modifier --- //\r\n    float hue = rgb_2_hue(aces);\r\n    float centeredHue = center_hue(hue, RRT_RED_HUE);\r\n\r\n    float hueWeight = smoothstep(0.0, 1.0, 1.0 - abs(2.0 * centeredHue / RRT_RED_WIDTH));\r\n    hueWeight *= hueWeight;\r\n\r\n    aces.r += hueWeight * saturation * (RRT_RED_PIVOT - aces.r) * (1. - RRT_RED_SCALE);\r\n\r\n    // --- ACES to RGB rendering space --- //\r\n    vec3 rgbPre = AP0_to_AP1_MAT * aces;\r\n    rgbPre = clamp(rgbPre, 0.0, MEDIUMP_FLT_MAX);\r\n\r\n    // --- Global desaturation --- //\r\n    rgbPre = mix(vec3(dot(rgbPre, AP1_RGB2Y)), rgbPre, RRT_SAT_FACTOR);\r\n\r\n    // --- Apply the tonescale independently in rendering-space RGB --- //\r\n    vec3 rgbPost;\r\n    rgbPost.x = segmented_spline_c5_fwd(rgbPre.x);\r\n    rgbPost.y = segmented_spline_c5_fwd(rgbPre.y);\r\n    rgbPost.z = segmented_spline_c5_fwd(rgbPre.z);\r\n\r\n    // --- RGB rendering space to OCES --- //\r\n    vec3 rgbOces = AP1_to_AP0_MAT * rgbPost;\r\n\r\n    return rgbOces;\r\n}\r\n\r\n#endif // RRT_lib","#if !defined(ODT_sRGB_100nits_lib)\r\n#define ODT_sRGB_100nits_lib\r\n\r\n#include \"ACES_ODTCommon.glsl\";\r\n\r\n// CIE XYZ to REC.709\r\nconst mat3 XYZ_to_REC709_MAT = mat3(\r\n    vec3(3.2409699419, -0.9692436363, 0.0556300797),\r\n    vec3(-1.5373831776, 1.8759675015, -0.2039769589),\r\n    vec3(-0.498610760, 0.0415550574, 1.0569715142));\r\n\r\nconst float DISPGAMMA = 2.4;\r\nconst float OFFSET = 0.055;\r\n\r\nvec3 ODT_sRGB_100nits(vec3 oces)\r\n{\r\n    // OCES to RGB rendering space\r\n    vec3 rgbPre = AP0_to_AP1_MAT * oces;\r\n\r\n    // Apply the tonescale independently in rendering-space RGB\r\n    vec3 rgbPost;\r\n    rgbPost.r = segmented_spline_c9_fwd(rgbPre.r);\r\n    rgbPost.g = segmented_spline_c9_fwd(rgbPre.g);\r\n    rgbPost.b = segmented_spline_c9_fwd(rgbPre.b);\r\n\r\n    // Scale luminance to linear code value\r\n    vec3 linearCV;\r\n    linearCV.r = Y_2_linCV(rgbPost.r, CINEMA_WHITE, CINEMA_BLACK);\r\n    linearCV.g = Y_2_linCV(rgbPost.g, CINEMA_WHITE, CINEMA_BLACK);\r\n    linearCV.b = Y_2_linCV(rgbPost.b, CINEMA_WHITE, CINEMA_BLACK);\r\n\r\n    // Apply gamma adjustment to compensate for dim surround\r\n    linearCV = darkSurround_to_dimSurround(linearCV);\r\n\r\n    // Convert to display primary encoding\r\n    // Rendering space RGB to XYZ\r\n    vec3 XYZ = AP1_to_XYZ_MAT * linearCV;\r\n\r\n    // Apply CAT from ACES white point to assumed observer adapted white point\r\n    XYZ = D60_to_D65_MAT * XYZ;\r\n\r\n    // CIE XYZ to display primaries\r\n    linearCV = XYZ_to_REC709_MAT * XYZ;\r\n\r\n    linearCV = clamp(linearCV, vec3(0.0), vec3(1.0));\r\n    return linearCV;\r\n}\r\n\r\n#endif // ODT_sRGB_100nits_lib","// Academy Color Encoding System (ACES) software and tools are provided by the\r\n// Academy under the following terms and conditions: A worldwide, royalty-free,\r\n// non-exclusive right to copy, modify, create derivatives, and use, in source\r\n// and binary forms, is hereby granted, subject to acceptance of this license.\r\n\r\n// Copyright 2019 Academy of Motion Picture Arts and Sciences (A.M.P.A.S.).\r\n// Portions contributed by others as indicated. All rights reserved.\r\n\r\n// Performance of any of the aforementioned acts indicates acceptance to be\r\n// bound by the following terms and conditions:\r\n\r\n// Copies of source code, in whole or in part, must retain the above copyright\r\n// notice, this list of conditions and the Disclaimer of Warranty.\r\n\r\n// Use in binary form must retain the above copyright notice, this list of\r\n// conditions and the Disclaimer of Warranty in the documentation and/or other\r\n// materials provided with the distribution.\r\n\r\n// Nothing in this license shall be deemed to grant any rights to trademarks,\r\n// copyrights, patents, trade secrets or any other intellectual property of\r\n// A.M.P.A.S. or any contributors, except as expressly stated herein.\r\n\r\n// Neither the name \"A.M.P.A.S.\" nor the name of any other contributors to this\r\n// software may be used to endorse or promote products derivative of or based on\r\n// this software without express prior written permission of A.M.P.A.S. or the\r\n// contributors, as appropriate.\r\n\r\n// This license shall be construed pursuant to the laws of the State of\r\n// California, and any disputes related thereto shall be subject to the\r\n// jurisdiction of the courts therein.\r\n\r\n// Disclaimer of Warranty: THIS SOFTWARE IS PROVIDED BY A.M.P.A.S. AND\r\n// CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT\r\n// NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\r\n// PARTICULAR PURPOSE, AND NON-INFRINGEMENT ARE DISCLAIMED. IN NO EVENT SHALL\r\n// A.M.P.A.S., OR ANY CONTRIBUTORS OR DISTRIBUTORS, BE LIABLE FOR ANY DIRECT,\r\n// INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, RESITUTIONARY, OR CONSEQUENTIAL\r\n// DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\r\n// SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\r\n// CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\r\n// OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\r\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n\r\n// WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, THE ACADEMY SPECIFICALLY\r\n// DISCLAIMS ANY REPRESENTATIONS OR WARRANTIES WHATSOEVER RELATED TO PATENT OR\r\n// OTHER INTELLECTUAL PROPERTY RIGHTS IN THE ACADEMY COLOR ENCODING SYSTEM, OR\r\n// APPLICATIONS THEREOF, HELD BY PARTIES OTHER THAN A.M.P.A.S.,WHETHER DISCLOSED\r\n// OR UNDISCLOSED.\r\n\r\n#if !defined(ACES_lib)\r\n#define ACES_lib\r\n\r\n#include \"ACES_TransformCommon.glsl\";\r\n#include \"ACES_UtillitiesColor.glsl\";\r\n#include \"ACES_Tonescales.glsl\";\r\n\r\n#include \"ACES_RRT.glsl\";\r\n#include \"ACES_ODT_sRGB_100nits.glsl\";\r\n\r\n// idt\r\n\r\n// linear D65 sRGB to D60 ACES AP0\r\nvec3 sRGB_to_AP0(vec3 sRGB)\r\n{\r\n    return sRGB_to_AP0_MAT * sRGB;\r\n}\r\n\r\n// linear D65 sRGB to D60 ACES AP1\r\nvec3 sRGB_to_AP1(vec3 sRGB)\r\n{\r\n    return sRGB_to_AP1_MAT * sRGB;\r\n}\r\n\r\n// lmt\r\n// todo\r\n\r\n#endif // ACES_lib","\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport UtilsGLSL from \"./utils/Utils.glsl\";\r\nimport ColorGLSL from \"./utils/Color.glsl\";\r\nimport MathGLSL from \"./utils/Math.glsl\";\r\nimport OutputTransformGLSL from \"./common/OutputTransform.glsl\";\r\nimport BakedBoneMatrixSamplerGLSL from \"./utils/BakedBoneMatrixSampler.glsl\";\r\n\r\nimport MorphTargetGLSL from \"./common/MorphTarget.glsl\";\r\nimport VertexGLSL from \"./common/VertexCommon.glsl\";\r\n\r\nimport ShadingCommonGLSL from \"./common/ShadingCommon.glsl\";\r\nimport ShadingVertexGLSL from \"./common/ShadingVertex.glsl\";\r\nimport ShadingFragGLSL from \"./common/ShadingFrag.glsl\";\r\n\r\nimport SceneGLSL from \"./common/SceneCommon.glsl\";\r\nimport CameraGLSL from \"./common/CameraCommon.glsl\";\r\nimport Sprite3DCommonGLSL from \"./common/Sprite3DCommon.glsl\";\r\nimport Sprite3DVertexGLSL from \"./common/Sprite3DVertex.glsl\";\r\nimport Sprite3DFragGLSL from \"./common/Sprite3DFrag.glsl\";\r\nimport DepthVertexGLSL from \"./depth/DepthVertex.glsl\";\r\nimport DepthFragGLSL from \"./depth/DepthFrag.glsl\";\r\nimport DepthNormalUtilGLSL from \"./depth/DepthNormalUtil.glsl\";\r\nimport DepthNormalFragGLSL from \"./depth/DepthNormalFrag.glsl\";\r\n\r\nimport ShadowSampleTentGLSL from \"./lighting/ShadowSampleTent.glsl\";\r\nimport ShadowSamplerGLSL from \"./lighting/ShadowSampler.glsl\";\r\nimport SceneFogGLSL from \"./utils/SceneFog.glsl\";\r\nimport SceneFogInputGLSL from \"./utils/SceneFogInput.glsl\";\r\nimport LightingGLSL from \"./lighting/Lighting.glsl\";\r\nimport GlobalIlluminationGLSL from \"./lighting/globalIllumination.glsl\";\r\nimport OctGLSL from \"./lighting/volumetricGI/Oct.glsl\";\r\nimport GridHelpersGLSL from \"./lighting/volumetricGI/GridHelpers.glsl\";\r\nimport VolumetricGIGLSL from \"./lighting/volumetricGI/VolumetricGI.glsl\";\r\n\r\nimport BlinnPhongLightingGLSL from \"./lightingmode/BlinnPhongLighting.glsl\";\r\nimport PBRLightingGLSL from \"./lightingmode/PBRLighting.glsl\";\r\nimport { BlitScreenShaderInit } from \"./postprocess/BlitScreenShaderInit\";\r\nimport { UnlitShaderInit } from \"./unlit/UnlitShaderInit\";\r\nimport { BlinnPhongShaderInit } from \"./blinnphong/BlinnPhongShaderInit\";\r\nimport { TrailShaderInit } from \"./Trail/TrailShaderInit\";\r\nimport { PBRShaderLib } from \"./pbr/PBRShaderLib\";\r\nimport { PBRStandardShaderInit } from \"./pbr/PBRStandardShaderInit\";\r\nimport { SkyBoxShaderInit } from \"./sky/SkyBoxShaderInit\";\r\nimport { ParticleShuriKenShaderInit } from \"./ShurikenParticle/ParticleShuriKenShaderInit\";\r\nimport { SkyProceduralShaderInit } from \"./sky/SkyProceduralShaderInit\";\r\nimport { SkyPanoramicShaderInit } from \"./sky/SkyPanoramicShaderInit\";\r\nimport { ACESShaderLib } from \"./postprocess/ACES/ACESShaderLib\";\r\n\r\n/**\r\n * @internal\r\n * <code>ShaderInit</code> Shader\r\n */\r\nexport class ShaderInit3D {\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\r\n\t\t// utils\r\n\t\tShader3D.addInclude(\"Utils.glsl\", UtilsGLSL);\r\n\t\tShader3D.addInclude(\"Color.glsl\", ColorGLSL);\r\n\t\tShader3D.addInclude(\"Math.glsl\", MathGLSL);\r\n\t\tShader3D.addInclude(\"BakedBoneMatrixSampler.glsl\", BakedBoneMatrixSamplerGLSL);\r\n\t\tShader3D.addInclude(\"MorphTarget.glsl\", MorphTargetGLSL);\r\n\t\tShader3D.addInclude(\"VertexCommon.glsl\", VertexGLSL);\r\n\t\tShader3D.addInclude(\"ShadingCommon.glsl\", ShadingCommonGLSL);\r\n\t\tShader3D.addInclude(\"ShadingVertex.glsl\", ShadingVertexGLSL);\r\n\t\tShader3D.addInclude(\"ShadingFrag.glsl\", ShadingFragGLSL);\r\n\r\n\t\tShader3D.addInclude(\"OutputTransform.glsl\", OutputTransformGLSL);\r\n\r\n\t\t// scene\r\n\t\tShader3D.addInclude(\"Scene.glsl\", SceneGLSL);\r\n\r\n\t\t// camera\r\n\t\tShader3D.addInclude(\"Camera.glsl\", CameraGLSL);\r\n\r\n\t\t// sprite3D\r\n\t\tShader3D.addInclude(\"Sprite3DCommon.glsl\", Sprite3DCommonGLSL);\r\n\t\tShader3D.addInclude(\"Sprite3DVertex.glsl\", Sprite3DVertexGLSL);\r\n\t\tShader3D.addInclude(\"Sprite3DFrag.glsl\", Sprite3DFragGLSL);\r\n\r\n\t\t// depth\r\n\t\tShader3D.addInclude(\"DepthVertex.glsl\", DepthVertexGLSL);\r\n\t\tShader3D.addInclude(\"DepthFrag.glsl\", DepthFragGLSL);\r\n\t\tShader3D.addInclude(\"DepthNormalUtil.glsl\", DepthNormalUtilGLSL);\r\n\t\tShader3D.addInclude(\"DepthNormalFrag.glsl\", DepthNormalFragGLSL);\r\n\r\n\t\t// scene fog\r\n\t\tShader3D.addInclude(\"SceneFog.glsl\", SceneFogGLSL);\r\n\t\tShader3D.addInclude(\"SceneFogInput.glsl\", SceneFogInputGLSL);\r\n\t\t// shadow sampler\r\n\t\tShader3D.addInclude(\"ShadowSampleTent.glsl\", ShadowSampleTentGLSL);\r\n\t\tShader3D.addInclude(\"ShadowSampler.glsl\", ShadowSamplerGLSL);\r\n\r\n\t\t// lighting\r\n\t\tShader3D.addInclude(\"Lighting.glsl\", LightingGLSL);\r\n\t\tShader3D.addInclude(\"globalIllumination.glsl\", GlobalIlluminationGLSL);\r\n\t\t// volumetric GI\r\n\t\tShader3D.addInclude(\"Oct.glsl\", OctGLSL);\r\n\t\tShader3D.addInclude(\"GridHelpers.glsl\", GridHelpersGLSL);\r\n\t\tShader3D.addInclude(\"VolumetricGI.glsl\", VolumetricGIGLSL);\r\n\r\n\t\t// lighting mode\r\n\t\tShader3D.addInclude(\"BlinnPhongLighting.glsl\", BlinnPhongLightingGLSL);\r\n\t\tShader3D.addInclude(\"PBRLighting.glsl\", PBRLightingGLSL);\r\n\r\n\t\t// lib\r\n\t\tPBRShaderLib.init();\r\n\t\tACESShaderLib.init();\r\n\r\n\t\t// shader init\r\n\t\tBlitScreenShaderInit.init();\r\n\t\tUnlitShaderInit.init();\r\n\t\tPBRStandardShaderInit.init();\r\n\t\t//PBRShaderInit.init();\r\n\t\tBlinnPhongShaderInit.init();\r\n\t\tTrailShaderInit.init();\r\n\t\tParticleShuriKenShaderInit.init();\r\n\t\tSkyBoxShaderInit.init();\r\n\t\tSkyProceduralShaderInit.init();\r\n\t\tSkyPanoramicShaderInit.init();\r\n\r\n\t\t///////////////////////////////////////////////////////////////////////\r\n\t\tShader3D.SHADERDEFINE_LEGACYSINGALLIGHTING = Shader3D.getDefineByName(\"LEGACYSINGLELIGHTING\");\r\n\t\tShader3D.SHADERDEFINE_ENUNIFORMBLOCK = Shader3D.getDefineByName(\"ENUNIFORMBLOCK\");\r\n\t\tShader3D.SHADERDEFINE_FLOATTEXTURE = Shader3D.getDefineByName(\"FLOATTEXTURE\");\r\n\t\tShader3D.SHADERDEFINE_FLOATTEXTURE_FIL_LINEAR = Shader3D.getDefineByName(\"FLOATTEXTURE_FIL_LINEAR\");\r\n\t}\r\n}\r\n\r\n","#if !defined(Color_lib)\r\n    #define Color_lib\r\n\r\n    #include \"Math.glsl\";\r\n\r\nvec3 linearToGamma(in vec3 value)\r\n{\r\n    // return vec3(mix(pow(value.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), value.rgb * 12.92, vec3(lessThanEqual(value.rgb, vec3(0.0031308)))));\r\n    return pow(value, vec3(1.0 / 2.2));\r\n}\r\n\r\nvec4 linearToGamma(in vec4 value)\r\n{\r\n    return vec4(linearToGamma(value.rgb), value.a);\r\n}\r\n\r\nvec3 gammaToLinear(in vec3 value)\r\n{\r\n    // return pow((value + 0.055) / 1.055, vec3(2.4));\r\n    return pow(value, vec3(2.2));\r\n}\r\n\r\nvec4 gammaToLinear(in vec4 value)\r\n{\r\n    return vec4(gammaToLinear(value.rgb), value.a);\r\n}\r\n\r\nconst float c_RGBDMaxRange = 255.0;\r\n\r\n// float color to rgbd\r\nvec4 encodeRGBD(in vec3 color)\r\n{\r\n    float maxRGB = max(vecmax(color), FLT_EPS);\r\n    float d = max(1.0, c_RGBDMaxRange / maxRGB);\r\n    d = saturate(d / 255.0);\r\n\r\n    vec3 rgb = color.rgb * d;\r\n    rgb = saturate(rgb);\r\n    return vec4(rgb, d);\r\n}\r\n\r\n// rgbd to float color\r\nvec3 decodeRGBD(in vec4 rgbd)\r\n{\r\n    vec3 color = rgbd.rgb * (1.0 / rgbd.a);\r\n    return color;\r\n}\r\n\r\n// float color to rgbm\r\nvec4 encodeRGBM(in vec3 color, float range)\r\n{\r\n    color *= 1.0 / range;\r\n    float maxRGB = max(vecmax(color), FLT_EPS);\r\n    float m = ceil(maxRGB * 255.0) / 255.0;\r\n    vec3 rgb = color.rgb * 1.0 / m;\r\n\r\n    vec4 rgbm = vec4(rgb, m);\r\n    return rgbm;\r\n}\r\n\r\n// rgbm to float color\r\nvec3 decodeRGBM(in vec4 rgbm, float range)\r\n{\r\n    return range * rgbm.rgb * rgbm.a;\r\n}\r\n\r\n    #include \"OutputTransform.glsl\";\r\n\r\n#endif // Color_lib","#if !defined(Math_lib)\r\n    #define Math_lib\r\n\r\n    #ifndef GRAPHICS_API_GLES3\r\nmat2 inverse(mat2 m)\r\n{\r\n    return mat2(m[1][1], -m[0][1], -m[1][0], m[0][0]) / (m[0][0] * m[1][1] - m[0][1] * m[1][0]);\r\n}\r\nmat3 inverse(mat3 m)\r\n{\r\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\r\n    float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\r\n    float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\r\n\r\n    float b01 = a22 * a11 - a12 * a21;\r\n    float b11 = -a22 * a10 + a12 * a20;\r\n    float b21 = a21 * a10 - a11 * a20;\r\n\r\n    float det = a00 * b01 + a01 * b11 + a02 * b21;\r\n\r\n    return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11), b11, (a22 * a00 - a02 * a20),\r\n\t       (-a12 * a00 + a02 * a10), b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10))\r\n\t/ det;\r\n}\r\n\r\nmat4 inverse(mat4 m)\r\n{\r\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], a10 = m[1][0], a11 = m[1][1], a12 = m[1][2],\r\n\t  a13 = m[1][3], a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], a30 = m[3][0], a31 = m[3][1],\r\n\t  a32 = m[3][2], a33 = m[3][3],\r\n\r\n\t  b00 = a00 * a11 - a01 * a10, b01 = a00 * a12 - a02 * a10, b02 = a00 * a13 - a03 * a10,\r\n\t  b03 = a01 * a12 - a02 * a11, b04 = a01 * a13 - a03 * a11, b05 = a02 * a13 - a03 * a12,\r\n\t  b06 = a20 * a31 - a21 * a30, b07 = a20 * a32 - a22 * a30, b08 = a20 * a33 - a23 * a30,\r\n\t  b09 = a21 * a32 - a22 * a31, b10 = a21 * a33 - a23 * a31, b11 = a22 * a33 - a23 * a32,\r\n\r\n\t  det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n    return mat4(a11 * b11 - a12 * b10 + a13 * b09, a02 * b10 - a01 * b11 - a03 * b09, a31 * b05 - a32 * b04 + a33 * b03,\r\n\t       a22 * b04 - a21 * b05 - a23 * b03, a12 * b08 - a10 * b11 - a13 * b07, a00 * b11 - a02 * b08 + a03 * b07,\r\n\t       a32 * b02 - a30 * b05 - a33 * b01, a20 * b05 - a22 * b02 + a23 * b01, a10 * b10 - a11 * b08 + a13 * b06,\r\n\t       a01 * b08 - a00 * b10 - a03 * b06, a30 * b04 - a31 * b02 + a33 * b00, a21 * b02 - a20 * b04 - a23 * b00,\r\n\t       a11 * b07 - a10 * b09 - a12 * b06, a00 * b09 - a01 * b07 + a02 * b06, a31 * b01 - a30 * b03 - a32 * b00,\r\n\t       a20 * b03 - a21 * b01 + a22 * b00)\r\n\t/ det;\r\n}\r\n\r\nmat4 transpose(mat4 m)\r\n{\r\n    return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\r\n\tm[0][1], m[1][1], m[2][1], m[3][1],\r\n\tm[0][2], m[1][2], m[2][2], m[3][2],\r\n\tm[0][3], m[1][3], m[2][3], m[3][3]);\r\n}\r\nmat3 transpose(mat3 m)\r\n{\r\n    return mat3(m[0][0], m[1][0], m[2][0],\r\n\tm[0][1], m[1][1], m[2][1],\r\n\tm[0][2], m[1][2], m[2][2]);\r\n}\r\n    #endif // GRAPHICS_API_GLES3\r\n\r\n    #define PI 3.14159265359\r\n\r\n    #define INVERT_PI 0.31830988618\r\n\r\n    #define HALF_PI 1.570796327\r\n\r\n    #define MEDIUMP_FLT_MAX 65504.0\r\n    #define MEDIUMP_FLT_MIN 0.00006103515625\r\n\r\n    #if defined(GL_FRAGMENT_PRECISION_HIGH)\r\n\t#define FLT_EPS\t\t   1e-5\r\n\t#define saturateMediump(x) x\r\n    #else\r\n\t#define FLT_EPS\t\t   MEDIUMP_FLT_MIN\r\n\t#define saturateMediump(x) min(x, MEDIUMP_FLT_MAX)\r\n    #endif // GL_FRAGMENT_PRECISION_HIGH\r\n\r\n    #define saturate(x) clamp(x, 0.0, 1.0)\r\n\r\nfloat pow2(float x)\r\n{\r\n    return x * x;\r\n}\r\n\r\nvec3 pow2(vec3 x)\r\n{\r\n    return x * x;\r\n}\r\n\r\nfloat pow5(float x)\r\n{\r\n    float x2 = x * x;\r\n    return x2 * x2 * x;\r\n}\r\n\r\nconst float INVERT_LOG10 = 0.43429448190325176;\r\n\r\nfloat log10(float x)\r\n{\r\n    return log(x) * INVERT_LOG10;\r\n}\r\n\r\nfloat vecmax(const vec2 v)\r\n{\r\n    return max(v.x, v.y);\r\n}\r\n\r\nfloat vecmax(const vec3 v)\r\n{\r\n    return max(v.x, max(v.y, v.z));\r\n}\r\n\r\nfloat vecmax(const vec4 v)\r\n{\r\n    return max(max(v.x, v.y), max(v.z, v.w));\r\n}\r\n\r\nfloat vecmin(const vec2 v)\r\n{\r\n    return min(v.x, v.y);\r\n}\r\n\r\nfloat vecmin(const vec3 v)\r\n{\r\n    return min(v.x, min(v.y, v.z));\r\n}\r\n\r\nfloat vecmin(const vec4 v)\r\n{\r\n    return min(min(v.x, v.y), min(v.z, v.w));\r\n}\r\n\r\nvec3 SafeNormalize(in vec3 inVec)\r\n{\r\n    float dp3 = max(0.001, dot(inVec, inVec));\r\n    return inVec * inversesqrt(dp3);\r\n}\r\n\r\nvec3 normalScale(in vec3 normal, in float scale)\r\n{\r\n    normal *= vec3(scale, scale, 1.0);\r\n    return normalize(normal);\r\n}\r\n\r\n/**\r\n * Approximates acos(x) with a max absolute error of 9.0x10^-3.\r\n * Valid in the range -1..1.\r\n */\r\nfloat acosFast(float x)\r\n{\r\n    // Lagarde 2014, \"Inverse trigonometric functions GPU optimization for AMD GCN architecture\"\r\n    // This is the approximation of degree 1, with a max absolute error of 9.0x10^-3\r\n    float y = abs(x);\r\n    float p = -0.1565827 * y + 1.570796;\r\n    p *= sqrt(1.0 - y);\r\n    return x >= 0.0 ? p : PI - p;\r\n}\r\n\r\n/**\r\n * Approximates acos(x) with a max absolute error of 9.0x10^-3.\r\n * Valid only in the range 0..1.\r\n */\r\nfloat acosFastPositive(float x)\r\n{\r\n    float p = -0.1565827 * x + 1.570796;\r\n    return p * sqrt(1.0 - x);\r\n}\r\n\r\n/*\r\n * Random number between 0 and 1, using interleaved gradient noise.\r\n * w must not be normalized (e.g. window coordinates)\r\n */\r\nfloat interleavedGradientNoise(const highp vec2 w)\r\n{\r\n    const vec3 m = vec3(0.06711056, 0.00583715, 52.9829189);\r\n    return fract(m.z * fract(dot(w, m.xy)));\r\n}\r\n\r\n/*\r\n * vertex rotate by Euler\r\n */\r\nvec3 rotationByEuler(in vec3 vector, in vec3 rot)\r\n{\r\n    float halfRoll = rot.z * 0.5;\r\n    float halfPitch = rot.x * 0.5;\r\n    float halfYaw = rot.y * 0.5;\r\n\r\n    float sinRoll = sin(halfRoll);\r\n    float cosRoll = cos(halfRoll);\r\n    float sinPitch = sin(halfPitch);\r\n    float cosPitch = cos(halfPitch);\r\n    float sinYaw = sin(halfYaw);\r\n    float cosYaw = cos(halfYaw);\r\n\r\n    float quaX = (cosYaw * sinPitch * cosRoll) + (sinYaw * cosPitch * sinRoll);\r\n    float quaY = (sinYaw * cosPitch * cosRoll) - (cosYaw * sinPitch * sinRoll);\r\n    float quaZ = (cosYaw * cosPitch * sinRoll) - (sinYaw * sinPitch * cosRoll);\r\n    float quaW = (cosYaw * cosPitch * cosRoll) + (sinYaw * sinPitch * sinRoll);\r\n\r\n    // vec4 q=vec4(quaX,quaY,quaZ,quaW);\r\n    // vec3 temp = cross(q.xyz, vector) + q.w * vector;\r\n    // return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\r\n\r\n    float x = quaX + quaX;\r\n    float y = quaY + quaY;\r\n    float z = quaZ + quaZ;\r\n    float wx = quaW * x;\r\n    float wy = quaW * y;\r\n    float wz = quaW * z;\r\n    float xx = quaX * x;\r\n    float xy = quaX * y;\r\n    float xz = quaX * z;\r\n    float yy = quaY * y;\r\n    float yz = quaY * z;\r\n    float zz = quaZ * z;\r\n\r\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\r\n\t((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\r\n\t((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\r\n}\r\n\r\n/*\r\n * Assume that axis has been normalized\r\n * point rotate by one axis\r\n */\r\nvec3 rotationByAxis(in vec3 vector, in vec3 axis, in float angle)\r\n{\r\n    float halfAngle = angle * 0.5;\r\n    float sin = sin(halfAngle);\r\n\r\n    float quaX = axis.x * sin;\r\n    float quaY = axis.y * sin;\r\n    float quaZ = axis.z * sin;\r\n    float quaW = cos(halfAngle);\r\n\r\n    // vec4 q=vec4(quaX,quaY,quaZ,quaW);\r\n    // vec3 temp = cross(q.xyz, vector) + q.w * vector;\r\n    // return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\r\n\r\n    float x = quaX + quaX;\r\n    float y = quaY + quaY;\r\n    float z = quaZ + quaZ;\r\n    float wx = quaW * x;\r\n    float wy = quaW * y;\r\n    float wz = quaW * z;\r\n    float xx = quaX * x;\r\n    float xy = quaX * y;\r\n    float xz = quaX * z;\r\n    float yy = quaY * y;\r\n    float yz = quaY * z;\r\n    float zz = quaZ * z;\r\n\r\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\r\n\t((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\r\n\t((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\r\n}\r\n\r\n/*\r\n *rotate by quaternions\r\n */\r\nvec3 rotationByQuaternions(in vec3 v, in vec4 q)\r\n{\r\n    return v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\r\n}\r\n\r\n#endif // Math_lib","#if !defined(BakeBoneAnimSampler_lib)\r\n    #define BakeBoneAnimSampler_lib\r\n\r\nmat4 loadBakedMatMatrix(float FramePos, float boneIndices, float offset)\r\n{\r\n    vec2 uv;\r\n    float PixelPos = FramePos + boneIndices * 4.0;\r\n    float halfOffset = offset * 0.5;\r\n    float uvoffset = PixelPos / u_SimpleAnimatorTextureSize;\r\n    uv.y = floor(uvoffset) * offset + halfOffset;\r\n    uv.x = mod(float(PixelPos), u_SimpleAnimatorTextureSize) * offset + halfOffset;\r\n    vec4 mat0row = texture2D(u_SimpleAnimatorTexture, uv);\r\n    uv.x += offset;\r\n    vec4 mat1row = texture2D(u_SimpleAnimatorTexture, uv);\r\n    uv.x += offset;\r\n    vec4 mat2row = texture2D(u_SimpleAnimatorTexture, uv);\r\n    uv.x += offset;\r\n    vec4 mat3row = texture2D(u_SimpleAnimatorTexture, uv);\r\n    mat4 m = mat4(mat0row.x, mat0row.y, mat0row.z, mat0row.w,\r\n\tmat1row.x, mat1row.y, mat1row.z, mat1row.w,\r\n\tmat2row.x, mat2row.y, mat2row.z, mat2row.w,\r\n\tmat3row.x, mat3row.y, mat3row.z, mat3row.w);\r\n    return m;\r\n}\r\n\r\n#endif // BakeBoneAnimSampler_lib","#if !defined(MorphTarget_lib)\r\n    #define MorphTarget_lib\r\n\r\n    #ifdef GRAPHICS_API_GLES3\r\n\r\n/// static mesh property\r\nuniform sampler2DArray u_MorphTargetsTex;\r\n// xy: tex size, z: attribute count\r\nuniform vec4 u_MorphParams;\r\nuniform vec4 u_MorphAttrOffset;\r\n\r\n\t#define Morph_TexWidth\t   u_MorphParams.x\r\n\t#define Morph_TexHeight\t   u_MorphParams.y\r\n\t#define Morph_AttributeNum u_MorphParams.z\r\n\t#define Morph_TargetNum\t   u_MorphParams.w\r\n\r\n\t#define Morph_PositionOffset u_MorphAttrOffset.x\r\n\t#define Morph_NormalOffset   u_MorphAttrOffset.y\r\n\t#define Morph_TangentOffset  u_MorphAttrOffset.z\r\n\r\n// #define MORPH_MAX_COUNT 8\r\n\r\n/// dynamic params\r\nuniform float u_MorphActiveTargets[MORPH_MAX_COUNT];\r\nuniform float u_MorphTargetWeights[MORPH_MAX_COUNT];\r\nuniform int u_MorphTargetActiveCount;\r\n\r\n\t#define MORPH_ACTIVE_COUNT u_MorphTargetActiveCount\r\n\r\nvec4 sampleMorphTargets(in int vertexID, in float targetID)\r\n{\r\n    int v = vertexID / int(Morph_TexWidth);\r\n    int u = vertexID - v * int(Morph_TexWidth);\r\n\r\n    vec3 uvw = vec3((float(u) + 0.5) / Morph_TexWidth, (float(v) + 0.5) / Morph_TexHeight, targetID);\r\n\r\n    return texture(u_MorphTargetsTex, uvw);\r\n}\r\n\r\nvec3 positionMorph(in vec3 position)\r\n{\r\n    int vertexID = gl_VertexID * int(Morph_AttributeNum) + int(Morph_PositionOffset);\r\n\r\n    for (int i = 0; i < MORPH_ACTIVE_COUNT; i++)\r\n\t{\r\n\t    float index = u_MorphActiveTargets[i];\r\n\r\n\t    position += sampleMorphTargets(vertexID, index).xyz * u_MorphTargetWeights[i];\r\n\t}\r\n\r\n    return position;\r\n}\r\n\r\nvec3 normalMorph(in vec3 normal)\r\n{\r\n    int vertexID = gl_VertexID * int(Morph_AttributeNum) + int(Morph_NormalOffset);\r\n    for (int i = 0; i < MORPH_ACTIVE_COUNT; i++)\r\n\t{\r\n\t    float index = u_MorphActiveTargets[i];\r\n\r\n\t    normal += sampleMorphTargets(vertexID, index).xyz * u_MorphTargetWeights[i];\r\n\t}\r\n\r\n    return normal;\r\n}\r\n\r\nvec4 tangentMorph(in vec4 tangent)\r\n{\r\n    int vertexID = gl_VertexID * int(Morph_AttributeNum) + int(Morph_TangentOffset);\r\n    for (int i = 0; i < MORPH_ACTIVE_COUNT; i++)\r\n\t{\r\n\t    float index = u_MorphActiveTargets[i];\r\n\r\n\t    vec4 sampleTangent = sampleMorphTargets(vertexID, index);\r\n\r\n\t    tangent.xyz += sampleTangent.xyz * u_MorphTargetWeights[i] * tangent.w * sampleTangent.w;\r\n\t}\r\n\r\n    return tangent;\r\n}\r\n\r\n    #endif // GRAPHICS_API_GLES3\r\n\r\n#endif // MorphTarget_lib","#if !defined(VertexCommon_lib)\r\n    #define VertexCommon_lib\r\n\r\n    #ifdef MORPHTARGETS\r\n\t#include \"MorphTarget.glsl\";\r\n    #endif // MORPHTARGETS\r\n\r\nstruct Vertex {\r\n\r\n    vec3 positionOS;\r\n\r\n    vec3 normalOS;\r\n\r\n    #ifdef TANGENT\r\n    vec4 tangentOS;\r\n    #endif // TANGENT\r\n\r\n    // todo  uv define ?\r\n    #ifdef UV\r\n    vec2 texCoord0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n    vec2 texCoord1;\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    vec4 vertexColor;\r\n    #endif // COLOR\r\n\r\n    #ifdef LIGHTMAP\r\n    vec4 lightmapScaleOffset;\r\n\t#endif LIGHTMAP\r\n};\r\n\r\n/**\r\n * vertex position\r\n */\r\nvec4 getVertexPosition()\r\n{\r\n    vec4 position = a_Position;\r\n\r\n    #ifdef MORPHTARGETS\r\n\t#ifdef MORPHTARGETS_POSITION\r\n    position.xyz = positionMorph(position.xyz);\r\n\t#endif // MORPHTARGETS_POSITION\r\n    #endif // MORPHTARGETS\r\n\r\n    return position;\r\n}\r\n\r\nvec3 getVertexNormal()\r\n{\r\n    vec3 normal = a_Normal.xyz;\r\n    #ifdef MORPHTARGETS\r\n\t#ifdef MORPHTARGETS_NORMAL\r\n    normal.xyz = normalMorph(normal);\r\n\t#endif // MORPHTARGETS_NORMAL\r\n    #endif // MORPHTARGETS\r\n\r\n    return normal;\r\n}\r\n\r\n    #ifdef TANGENT\r\nvec4 getVertexTangent()\r\n{\r\n    vec4 tangent = a_Tangent0;\r\n\r\n\t#ifdef MORPHTARGETS\r\n\t    #ifdef MORPHTARGETS_TANGENT\r\n    tangent = tangentMorph(tangent);\r\n\t    #endif // MORPHTARGETS_TANGENT\r\n\t#endif // MORPHTARGETS\r\n\r\n    return tangent;\r\n}\r\n    #endif // TANGENT\r\n\r\n    #ifdef LIGHTMAP\r\n#ifndef GPU_INSTANCE\r\n    uniform vec4 u_LightmapScaleOffset;\r\n#endif // GPU_INSTANCE\r\n\r\nvec4 getLightmapScaleOffset(){\r\n    \r\n    #ifdef GPU_INSTANCE\r\n        return a_LightmapScaleOffset;\r\n    #else\r\n        return u_LightmapScaleOffset;\r\n    #endif // GPU_INSTANCE\r\n}\r\n    #endif // LIGHTMAP\r\n\r\nvoid getVertexParams(inout Vertex vertex)\r\n{\r\n    vertex.positionOS = getVertexPosition().xyz;\r\n\r\n    vertex.normalOS = getVertexNormal();\r\n\r\n    #ifdef TANGENT\r\n    vertex.tangentOS = getVertexTangent();\r\n    #endif // TANGENT\r\n\r\n    #ifdef UV\r\n    vertex.texCoord0 = a_Texcoord0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n    vertex.texCoord1 = a_Texcoord1;\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    // consider vertexColor is gamma\r\n    vertex.vertexColor = vec4(pow(a_Color.rgb, vec3(2.2)), a_Color.a);\r\n    #endif // COLOR\r\n\r\n    #ifdef LIGHTMAP\r\n    vertex.lightmapScaleOffset = getLightmapScaleOffset();\r\n\t#endif LIGHTMAP\r\n}\r\n\r\n#endif // VertexCommon_lib","#if !defined(ShadingCommon_lib)\r\n    #define ShadingCommon_lib\r\n\r\n// varying\r\nvarying vec3 v_PositionWS;\r\n// todo\r\nvarying vec3 v_NormalWS;\r\nvarying vec3 v_TangentWS;\r\nvarying vec3 v_BiNormalWS;\r\n\r\n    #ifdef UV\r\nvarying vec2 v_Texcoord0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\nvarying vec2 v_Texcoord1;\r\n\t#endif // LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\nvarying vec4 v_VertexColor;\r\n    #endif // COLOR\r\n\r\n// , vsfs\r\nstruct PixelParams {\r\n    vec3 positionWS;\r\n\r\n    // todo\r\n    vec3 normalWS;\r\n    vec3 tangentWS;\r\n    vec3 biNormalWS;\r\n    mat3 TBN;\r\n\r\n    #ifdef UV\r\n    vec2 uv0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\n    vec2 uv1;\r\n\t#endif // LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    vec4 vertexColor;\r\n    #endif // COLOR\r\n};\r\n\r\n#endif // ShadingCommon_lib","#if !defined(ShadingVertex_lib)\r\n    #define ShadingVertex_lib\r\n\r\n    #include \"ShadingCommon.glsl\";\r\n\r\nvoid sharePixelParams(const in PixelParams params)\r\n{\r\n    v_PositionWS = params.positionWS;\r\n\r\n    v_NormalWS = params.normalWS;\r\n    v_TangentWS = params.tangentWS;\r\n    v_BiNormalWS = params.biNormalWS;\r\n\r\n    #ifdef UV\r\n    v_Texcoord0 = params.uv0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\n    v_Texcoord1 = params.uv1;\r\n\t#endif LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    v_VertexColor = params.vertexColor;\r\n    #endif // COLOR\r\n}\r\n\r\nvoid shadingPixelParams(inout PixelParams params, in Vertex vertex)\r\n{\r\n    mat4 worldMat = getWorldMatrix();\r\n    vec4 pos = (worldMat * vec4(vertex.positionOS, 1.0));\r\n    params.positionWS = pos.xyz / pos.w;\r\n\r\n    mat3 normalMat = transpose(inverse(mat3(worldMat)));\r\n    params.normalWS = normalize((normalMat * vertex.normalOS).xyz);\r\n\r\n    #ifdef TANGENT\r\n    params.tangentWS = normalize((normalMat * vertex.tangentOS.xyz).xyz);\r\n    params.tangentWS *= u_WroldInvertFront.x;\r\n    params.biNormalWS = normalize(cross(params.normalWS, params.tangentWS) * sign(vertex.tangentOS.w));\r\n    #else // TANGENT\r\n    params.tangentWS = vec3(1.0, 0.0, 0.0);\r\n    params.tangentWS *= u_WroldInvertFront.x;\r\n    params.biNormalWS = normalize(cross(params.normalWS, params.tangentWS));\r\n    #endif // TANGENT\r\n\r\n    #ifdef UV\r\n    params.uv0 = vertex.texCoord0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\n    params.uv1 = tranformLightMapUV(vertex.texCoord1, vertex.lightmapScaleOffset);\r\n\t#endif LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    params.vertexColor = vertex.vertexColor;\r\n    #endif // COLOR\r\n}\r\n\r\n#endif // ShadingVertex_lib","#if !defined(ShadingFrag_lib)\r\n    #define ShadingFrag_lib\r\n\r\n    #include \"ShadingCommon.glsl\";\r\n\r\n    #define _InvertNormal (float(gl_FrontFacing) * 2.0 - 1.0);\r\n\r\nvoid getPixelParams(inout PixelParams params)\r\n{\r\n    params.positionWS = v_PositionWS;\r\n\r\n    float invertN = _InvertNormal;\r\n\r\n    params.normalWS = normalize(v_NormalWS * invertN);\r\n    params.tangentWS = normalize(v_TangentWS * invertN);\r\n    params.biNormalWS = normalize(v_BiNormalWS * invertN);\r\n\r\n    params.TBN = mat3(params.tangentWS, params.biNormalWS, params.normalWS);\r\n\r\n    #ifdef UV\r\n    params.uv0 = v_Texcoord0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\n    params.uv1 = v_Texcoord1;\r\n\t#endif // LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    params.vertexColor = v_VertexColor;\r\n    #endif // COLOR\r\n}\r\n\r\n#endif // ShadingFrag_lib","#if !defined(OutputTransform_lib)\r\n    #define OutputTransform_lib\r\n\r\nvec3 gammaCorrect(in vec3 color, float gammaValue)\r\n{\r\n    return pow(color, vec3(gammaValue));\r\n}\r\n\r\nvec4 gammaCorrect(in vec4 color)\r\n{\r\n    // todo color gamut gamma value\r\n    // default sRGB\r\n    float gammaValue = 1.0 / 2.2;\r\n    return vec4(gammaCorrect(color.rgb, gammaValue), color.a);\r\n}\r\n\r\nvec4 outputTransform(in vec4 color)\r\n{\r\n    #ifdef GAMMACORRECT\r\n    // render in linear, output gamma\r\n    return gammaCorrect(color);\r\n    #else // GAMMACORRECT\r\n    return color;\r\n    #endif // GAMMACORRECT\r\n}\r\n\r\n#endif // OutputTransform_lib\r\n","#if !defined(SceneCommon_lib)\r\n    #define SceneCommon_lib\r\n\r\n    #ifdef ENUNIFORMBLOCK\r\nuniform SceneUniformBlock\r\n{\r\n    // time\r\n    float u_Time;\r\n    vec4 u_FogParams;// x start,y range,z Density\r\n    vec4 u_FogColor;\r\n};\r\n    #else // ENUNIFORMBLOCK\r\n// time\r\nuniform float u_Time;\r\nuniform vec4 u_FogParams;//x start,y range,z Density\r\nuniform vec4 u_FogColor;\r\n    #endif // ENUNIFORMBLOCK\r\n    //rotate SH IBL\r\nuniform float u_GIRotate;\r\n\r\n#endif // SceneCommon_lib","#if !defined(CameraCommon_lib)\r\n    #define CameraCommon_lib\r\n\r\n    #ifdef ENUNIFORMBLOCK\r\n\r\nuniform CameraUniformBlock\r\n{\r\n    mat4 u_View;\r\n    mat4 u_Projection;\r\n    mat4 u_ViewProjection;\r\n    vec4 u_ProjectionParams; // x: near, y: far, z: invert, w: 1/far\r\n    vec4 u_Viewport; // x,y,width,height\r\n    vec3 u_CameraDirection;\r\n    vec3 u_CameraUp;\r\n    vec3 u_CameraPos;\r\n};\r\n    #else\r\nuniform mat4 u_View;\r\nuniform mat4 u_Projection;\r\nuniform mat4 u_ViewProjection;\r\nuniform vec4 u_ProjectionParams; // x: near, y: far, z: invert, w: 1/far\r\nuniform vec4 u_Viewport; // x, y, width, height\r\nuniform vec3 u_CameraDirection;\r\nuniform vec3 u_CameraUp;\r\nuniform vec3 u_CameraPos;\r\n    #endif // ENUNIFORMBLOCK\r\n\r\n/*Depth or DepthNormal Uniform*/\r\nuniform highp sampler2D u_CameraDepthTexture;\r\nuniform vec4 u_ZBufferParams; //(1.0 - far / near, far / near, (near - far) / (near * far), 1 / near)\r\nuniform mediump sampler2D u_CameraDepthNormalsTexture;\r\nuniform mediump sampler2D u_CameraOpaqueTexture;\r\nuniform vec4 u_OpaqueTextureParams;\r\n\r\nvec4 getPositionCS(in vec3 positionWS)\r\n{\r\n    return u_ViewProjection * vec4(positionWS, 1.0);\r\n}\r\n\r\nvec3 getViewDirection(in vec3 positionWS)\r\n{\r\n    return normalize(u_CameraPos - positionWS);\r\n}\r\n\r\n// \r\nvec4 remapPositionZ(vec4 position)\r\n{\r\n    position.z = position.z * 2.0 - position.w;\r\n    return position;\r\n}\r\n\r\n#endif // CameraCommon_lib","#if !defined(Sprite3DCommon_lib)\r\n    #define Sprite3DCommon_lib\r\n\r\nuniform mat4 u_WorldMat;\r\n\r\nuniform vec4 u_WroldInvertFront; // x: invert front face\r\n\r\n    \r\n\r\n\r\nvec2 tranformLightMapUV(in vec2 texcoord, in vec4 tilingOffset)\r\n{\r\n    vec2 lightMapUV = vec2(texcoord.x, 1.0 - texcoord.y) * tilingOffset.xy + tilingOffset.zw;\r\n    lightMapUV.y = 1.0 - lightMapUV.y;\r\n    return lightMapUV;\r\n}\r\n\r\nvec2 transformUV(in vec2 texcoord, in vec4 tilingOffset)\r\n{\r\n    vec2 uv = texcoord * tilingOffset.xy + tilingOffset.zw * vec2(1.0, -1.0) + vec2(0.0, 1.0 - tilingOffset.y);\r\n    return uv;\r\n}\r\n\r\n#endif // Sprite3DCommon_lib","#if !defined(Sprite3DVertex_lib)\r\n    #define Sprite3DVertex_lib\r\n\r\n    #include \"Sprite3DCommon.glsl\";\r\n\r\n    #ifdef BONE\r\n// todo const int c_MaxBoneCount = 24\r\nuniform mat4 u_Bones[24];\r\n\r\n\t#ifdef SIMPLEBONE\r\nuniform vec4 u_SimpleAnimatorParams;\r\nuniform sampler2D u_SimpleAnimatorTexture;\r\nuniform float u_SimpleAnimatorTextureSize;\r\n\t    #include \"BakedBoneMatrixSampler.glsl\";\r\n\r\n\t#endif // SIMPLEBONE\r\n\r\n    #endif // BONE\r\n\r\n/**\r\n * world matrix\r\n */\r\nmat4 getWorldMatrix()\r\n{\r\n    #ifdef GPU_INSTANCE\r\n    mat4 worldMat = a_WorldMat;\r\n    #else\r\n    mat4 worldMat = u_WorldMat;\r\n    #endif // GPU_INSTANCE\r\n\r\n    #ifdef BONE\r\n\r\n\t#ifdef SIMPLEBONE\r\n\r\n\t    #ifdef GPU_INSTANCE\r\n    float currentPixelPos = a_SimpleTextureParams.x + a_SimpleTextureParams.y;\r\n\t    #else // GPU_INSTANCE\r\n    float currentPixelPos = u_SimpleAnimatorParams.x + u_SimpleAnimatorParams.y;\r\n\t    #endif // GPU_INSTANCE\r\n\r\n    float offset = 1.0 / u_SimpleAnimatorTextureSize;\r\n    mat4 skinTrans = loadBakedMatMatrix(currentPixelPos, a_BoneIndices.x, offset) * a_BoneWeights.x;\r\n    skinTrans += loadBakedMatMatrix(currentPixelPos, a_BoneIndices.y, offset) * a_BoneWeights.y;\r\n    skinTrans += loadBakedMatMatrix(currentPixelPos, a_BoneIndices.z, offset) * a_BoneWeights.z;\r\n    skinTrans += loadBakedMatMatrix(currentPixelPos, a_BoneIndices.w, offset) * a_BoneWeights.w;\r\n    worldMat = worldMat * skinTrans;\r\n\r\n\t#else // SIMPLEBONE\r\n\r\n    ivec4 boneIndex = ivec4(a_BoneIndices);\r\n    mat4 skinTrans = u_Bones[boneIndex.x] * a_BoneWeights.x;\r\n    skinTrans += u_Bones[boneIndex.y] * a_BoneWeights.y;\r\n    skinTrans += u_Bones[boneIndex.z] * a_BoneWeights.z;\r\n    skinTrans += u_Bones[boneIndex.w] * a_BoneWeights.w;\r\n    worldMat = worldMat * skinTrans;\r\n\r\n\t#endif // SIMPLEBONE\r\n\r\n    #endif // BONE\r\n\r\n    return worldMat;\r\n}\r\n\r\n#endif // Sprite3DVertex_lib","#if !defined(Sprite3DFrag_lib)\r\n    #define Sprite3DFrag_lib\r\n\r\n    #include \"Sprite3DCommon.glsl\";\r\n\r\n#endif // Sprite3DFrag_lib","#if !defined(DepthVertex_lib)\r\n    #define DepthVertex_lib\r\n    #include \"Math.glsl\";\r\n    #include \"Scene.glsl\";\r\n    #include \"Camera.glsl\";\r\n    #include \"Sprite3DVertex.glsl\";\r\n\r\n    #include \"VertexCommon.glsl\";\r\n\r\n    #if defined(SHADOW) || defined(SHADOW_SPOT)\r\n\r\n\t#ifndef DEPTHPASS\r\n\t    #ifdef ENUNIFORMBLOCK\r\nuniform ShadowUniformBlock\r\n{\r\n    vec4 u_ShadowBias; // x: depth bias, y: normal bias\r\n    vec3 u_ShadowLightDirection;\r\n};\r\n\t    #else // ENUNIFORMBLOCK\r\nuniform vec4 u_ShadowBias; // x: depth bias, y: normal bias\r\n\t\t#ifdef SHADOW\r\nuniform vec3 u_ShadowLightDirection;\r\n\t\t#endif // SHADOW\r\n\t    #endif // ENUNIFORMBLOCK\r\n\r\nvec3 applyShadowBias(vec3 positionWS, vec3 normalWS, vec3 lightDirection)\r\n{\r\n    float invNdotL = 1.0 - clamp(dot(-lightDirection, normalWS), 0.0, 1.0);\r\n    float scale = invNdotL * u_ShadowBias.y;\r\n\r\n    // normal bias is negative since we want to apply an inset normal offset\r\n    positionWS += -lightDirection * u_ShadowBias.xxx;\r\n    positionWS += normalWS * vec3(scale);\r\n    return positionWS;\r\n}\r\n\t#endif // DEPTHPASS\r\n    #endif // SHADOW || SHADOW_SPOT\r\n\r\n    #ifdef DEPTHPASS\r\n\t#include \"Camera.glsl\";\r\n    #endif // DEPTHPASS\r\n\r\nvec4 DepthPositionCS(in vec3 positionWS, in vec3 normalWS)\r\n{\r\n    #ifdef DEPTHPASS\r\n    vec4 positionCS = u_ViewProjection * vec4(positionWS, 1.0);\r\n    #endif // DEPTHPASS\r\n\r\n    #ifdef SHADOW\r\n\t#ifndef DEPTHPASS\r\n    positionWS = applyShadowBias(positionWS, normalWS, u_ShadowLightDirection);\r\n    vec4 positionCS = u_ViewProjection * vec4(positionWS, 1.0);\r\n    positionCS.z = max(positionCS.z, 0.0); // min ndc z is 0.0\r\n\t#endif // DEPTHPASS\r\n    #endif // SHADOW\r\n\r\n    #ifdef SHADOW_SPOT\r\n\t#ifndef DEPTHPASS\r\n    vec4 positionCS = u_ViewProjection * vec4(positionWS, 1.0);\r\n    positionCS.z = positionCS.z - u_ShadowBias.x / positionCS.w;\r\n    positionCS.z = max(positionCS.z, 0.0); // min ndc z is 0.0\r\n\t#endif // DEPTHPASS\r\n    #endif // SHADOW_SPOT\r\n\r\n    return positionCS;\r\n}\r\n\r\n#endif // DepthVertex_lib","#if !defined(DepthFrag_lib)\r\n    #define DepthFrag_lib\r\n\r\nvec4 getDepthColor()\r\n{\r\n    return vec4(0.0);\r\n}\r\n\r\n#endif // DepthFrag_lib","#define SAMPLE_DEPTH_TEXTURE(textureName, coord2) (texture2D(textureName, coord2).r)\r\n//\r\n\r\n// Encoding/decoding view space normals into 2D 0..1 vector\r\nvec2 EncodeViewNormalStereo(vec3 n)\r\n{\r\n    n.z = abs(n.z);\r\n    float kScale = 1.7777;\r\n    vec2 enc;\r\n    enc = n.xy / (n.z + 1.0);\r\n    enc /= kScale;\r\n    enc = enc * 0.5 + 0.5;\r\n    return enc;\r\n}\r\n\r\nvec3 DecodeViewNormalStereo(vec4 enc4)\r\n{\r\n    float kScale = 1.7777;\r\n    vec3 nn = enc4.xyz * vec3(2.0 * kScale, 2.0 * kScale, 0.0) + vec3(-kScale, -kScale, 1.0);\r\n    float g = 2.0 / dot(nn.xyz, nn.xyz);\r\n    vec3 n;\r\n    n.xy = g * nn.xy;\r\n    n.z = g - 1.0;\r\n    return n;\r\n}\r\n\r\n// Encoding/decoding [0..1) floats into 8 bit/channel RG. Note that 1.0 will not be encoded properly.\r\nvec2 EncodeFloatRG(float v)\r\n{\r\n    vec2 kEncodeMul = vec2(1.0, 255.0);\r\n    float kEncodeBit = 1.0 / 255.0;\r\n    vec2 enc = kEncodeMul * v;\r\n    enc = fract(enc);\r\n    enc.x -= enc.y * kEncodeBit;\r\n    return enc;\r\n}\r\n\r\nfloat DecodeFloatRG(vec2 enc)\r\n{\r\n    vec2 kDecodeDot = vec2(1.0, 1.0 / 255.0);\r\n    return dot(enc, kDecodeDot);\r\n}\r\n\r\nvec4 EncodeDepthNormal(float depth, vec3 normals)\r\n{\r\n    vec4 encode;\r\n    encode.xy = EncodeViewNormalStereo(normals);\r\n    encode.zw = EncodeFloatRG(depth);\r\n    return encode;\r\n}\r\n\r\nvoid DecodeDepthNormal(vec4 enc, out float depth, out vec3 normal)\r\n{\r\n    depth = DecodeFloatRG(enc.zw);\r\n    normal = DecodeViewNormalStereo(enc);\r\n}\r\n\r\nvec4 depthNormalsFragment(vec4 depthNormal)\r\n{\r\n    return EncodeDepthNormal(depthNormal.w, depthNormal.xyz);\r\n}\r\n\r\n// Z buffer to linear 0..1 depth\r\nfloat Linear01Depth(float z, vec4 zbufferParams)\r\n{\r\n    return 1.0 / (zbufferParams.x * z + zbufferParams.y);\r\n}\r\n// Z buffer to linear depth\r\nfloat LinearEyeDepth(float z, vec4 zbufferParams)\r\n{\r\n    return 1.0 / (zbufferParams.z * z + zbufferParams.w);\r\n}\r\n","#if !defined(DepthNormalFrag_lib)\r\n    #define DepthNormalFrag_lib\r\n\r\n    #include \"DepthNormalUtil.glsl\";\r\n\r\nvec4 encodeDepthNormal(const in vec4 positionCS, const in vec3 normalWS)\r\n{\r\n    float depth = (positionCS.z * 2.0 - positionCS.w) * u_ProjectionParams.w;\r\n\r\n    vec3 normalVS = mat3(u_View) * normalWS;\r\n\r\n    return EncodeDepthNormal(depth, normalVS);\r\n}\r\n\r\n#endif // DepthNormalFrag_lib","#if !defined(SceneFog_lib)\r\n    #define SceneFog_lib\r\n\r\n    #ifdef FOG\r\nvarying float v_fogFactor;\r\nfloat getFogFactor()\r\n{\r\n    return v_fogFactor;\r\n}\r\n\r\nvec3 scenUnlitFog(in vec3 color)\r\n{\r\n    float lerpFact = getFogFactor();\r\n\t#ifdef ADDTIVEFOG\r\n    lerpFact = clamp(lerpFact, 0.0, 1.0);\r\n    return mix(vec3(0.0), color, lerpFact);\r\n\t#else\r\n    lerpFact = clamp(lerpFact, 0.0, 1.0);\r\n    return mix(u_FogColor.rgb, color, lerpFact);\r\n\t#endif // ADDTIVEFOG\r\n}\r\n\r\nvec3 sceneLitFog(in vec3 color)\r\n{\r\n    float lerpFact = getFogFactor();\r\n    lerpFact = clamp(lerpFact, 0.0, 1.0);\r\n    return mix(u_FogColor.rgb, color, lerpFact);\r\n}\r\n\r\n    #endif\r\n#endif // SceneFog_lib","#if !defined(SceneFog_lib)\r\n    #define SceneFog_lib\r\n\r\n    #ifdef FOG\r\nvarying float v_fogFactor;\r\nvoid FogHandle(in float fact)\r\n{\r\n    float lerpFact = 0.0;\r\n\t#ifdef FOG_EXP\r\n    lerpFact = fact * (u_FogParams.z / log(2.0));\r\n    lerpFact = exp2(-lerpFact);\r\n\t#elif defined(FOG_EXP2)\r\n    lerpFact = fact * (u_FogParams.z / sqrt(log(2.0)));\r\n    lerpFact = exp2(-lerpFact);\r\n\t#else // default FOG_LINEAR\r\n    lerpFact = (-1.0 * fact / (u_FogParams.y - u_FogParams.x) + u_FogParams.y / (u_FogParams.y - u_FogParams.x));\r\n\t#endif\r\n    v_fogFactor = lerpFact;\r\n}\r\n    #endif\r\n#endif // SceneFog_lib","// ------------------------------------------------------------------\r\n//  PCF Filtering Tent Functions\r\n// ------------------------------------------------------------------\r\n\r\n// Assuming a isoceles right angled triangle of height \"triangleHeight\" (as drawn below).\r\n// This function return the area of the triangle above the first texel(in Y the first texel).\r\n//\r\n// |\\      <-- 45 degree slop isosceles right angled triangle\r\n// | \\\r\n// ----    <-- length of this side is \"triangleHeight\"\r\n// _ _ _ _ <-- texels\r\nfloat sampleShadowGetIRTriangleTexelArea(float triangleHeight)\r\n{\r\n    return triangleHeight - 0.5;\r\n}\r\n\r\n// Assuming a isoceles triangle of 1.5 texels height and 3 texels wide lying on 4 texels.\r\n// This function return the area of the triangle above each of those texels.\r\n//    |    <-- offset from -0.5 to 0.5, 0 meaning triangle is exactly in the center\r\n//   / \\   <-- 45 degree slop isosceles triangle (ie tent projected in 2D)\r\n//  /   \\\r\n// _ _ _ _ <-- texels\r\n// X Y Z W <-- result indices (in computedArea.xyzw and computedAreaUncut.xyzw)\r\n// Top point at (right,top) in a texel,left bottom point at (middle,middle) in a texel,right bottom point at (middle,middle) in a texel.\r\nvoid sampleShadowGetTexelAreasTent3x3(float offset, out vec4 computedArea, out vec4 computedAreaUncut)\r\n{\r\n    // Compute the exterior areas,a and h is same.\r\n    float a = offset + 0.5;\r\n    float offsetSquaredHalved = a * a * 0.5;\r\n    computedAreaUncut.x = computedArea.x = offsetSquaredHalved - offset;\r\n    computedAreaUncut.w = computedArea.w = offsetSquaredHalved;\r\n\r\n    // Compute the middle areas\r\n    // For Y : We find the area in Y of as if the left section of the isoceles triangle would\r\n    // intersect the axis between Y and Z (ie where offset = 0).\r\n    computedAreaUncut.y = sampleShadowGetIRTriangleTexelArea(1.5 - offset);\r\n    // This area is superior to the one we are looking for if (offset < 0) thus we need to\r\n    // subtract the area of the triangle defined by (0,1.5-offset), (0,1.5+offset), (-offset,1.5).\r\n    float clampedOffsetLeft = min(offset,0.0);\r\n    float areaOfSmallLeftTriangle = clampedOffsetLeft * clampedOffsetLeft;\r\n    computedArea.y = computedAreaUncut.y - areaOfSmallLeftTriangle;\r\n\r\n    // We do the same for the Z but with the right part of the isoceles triangle\r\n    computedAreaUncut.z = sampleShadowGetIRTriangleTexelArea(1.5 + offset);\r\n    float clampedOffsetRight = max(offset,0.0);\r\n    float areaOfSmallRightTriangle = clampedOffsetRight * clampedOffsetRight;\r\n    computedArea.z = computedAreaUncut.z - areaOfSmallRightTriangle;\r\n}\r\n\r\n// Assuming a isoceles triangle of 2.5 texel height and 5 texels wide lying on 6 texels.\r\n// This function return the weight of each texels area relative to the full triangle area.\r\n//  /       \\\r\n// _ _ _ _ _ _ <-- texels\r\n// 0 1 2 3 4 5 <-- computed area indices (in texelsWeights[])\r\n// Top point at (right,top) in a texel,left bottom point at (middle,middle) in a texel,right bottom point at (middle,middle) in a texel.\r\nvoid sampleShadowGetTexelWeightsTent5x5(float offset, out vec3 texelsWeightsA, out vec3 texelsWeightsB)\r\n{\r\n    vec4 areaFrom3texelTriangle;\r\n    vec4 areaUncutFrom3texelTriangle;\r\n    sampleShadowGetTexelAreasTent3x3(offset, areaFrom3texelTriangle, areaUncutFrom3texelTriangle);\r\n\r\n    // Triangle slope is 45 degree thus we can almost reuse the result of the 3 texel wide computation.\r\n    // the 5 texel wide triangle can be seen as the 3 texel wide one but shifted up by one unit/texel.\r\n    // 0.16 is 1/(the triangle area)\r\n    texelsWeightsA.x = 0.16 * (areaFrom3texelTriangle.x);\r\n    texelsWeightsA.y = 0.16 * (areaUncutFrom3texelTriangle.y);\r\n    texelsWeightsA.z = 0.16 * (areaFrom3texelTriangle.y + 1.0);\r\n    texelsWeightsB.x = 0.16 * (areaFrom3texelTriangle.z + 1.0);\r\n    texelsWeightsB.y = 0.16 * (areaUncutFrom3texelTriangle.z);\r\n    texelsWeightsB.z = 0.16 * (areaFrom3texelTriangle.w);\r\n}\r\n\r\n// 5x5 Tent filter (45 degree sloped triangles in U and V)\r\nvoid sampleShadowComputeSamplesTent5x5(vec4 shadowMapTextureTexelSize, vec2 coord, out float fetchesWeights[9], out vec2 fetchesUV[9])\r\n{\r\n    // tent base is 5x5 base thus covering from 25 to 36 texels, thus we need 9 bilinear PCF fetches\r\n    vec2 tentCenterInTexelSpace = coord.xy * shadowMapTextureTexelSize.zw;\r\n    vec2 centerOfFetchesInTexelSpace = floor(tentCenterInTexelSpace + 0.5);\r\n    vec2 offsetFromTentCenterToCenterOfFetches = tentCenterInTexelSpace - centerOfFetchesInTexelSpace;\r\n\r\n    // find the weight of each texel based on the area of a 45 degree slop tent above each of them.\r\n    vec3 texelsWeightsUA, texelsWeightsUB;\r\n    vec3 texelsWeightsVA, texelsWeightsVB;\r\n    sampleShadowGetTexelWeightsTent5x5(offsetFromTentCenterToCenterOfFetches.x, texelsWeightsUA, texelsWeightsUB);\r\n    sampleShadowGetTexelWeightsTent5x5(offsetFromTentCenterToCenterOfFetches.y, texelsWeightsVA, texelsWeightsVB);\r\n\r\n    // each fetch will cover a group of 2x2 texels, the weight of each group is the sum of the weights of the texels\r\n    vec3 fetchesWeightsU = vec3(texelsWeightsUA.xz, texelsWeightsUB.y) + vec3(texelsWeightsUA.y, texelsWeightsUB.xz);\r\n    vec3 fetchesWeightsV = vec3(texelsWeightsVA.xz, texelsWeightsVB.y) + vec3(texelsWeightsVA.y, texelsWeightsVB.xz);\r\n\r\n    // move the PCF bilinear fetches to respect texels weights\r\n    vec3 fetchesOffsetsU = vec3(texelsWeightsUA.y, texelsWeightsUB.xz) / fetchesWeightsU.xyz + vec3(-2.5,-0.5,1.5);\r\n    vec3 fetchesOffsetsV = vec3(texelsWeightsVA.y, texelsWeightsVB.xz) / fetchesWeightsV.xyz + vec3(-2.5,-0.5,1.5);\r\n    fetchesOffsetsU *= shadowMapTextureTexelSize.xxx;\r\n    fetchesOffsetsV *= shadowMapTextureTexelSize.yyy;\r\n\r\n    vec2 bilinearFetchOrigin = centerOfFetchesInTexelSpace * shadowMapTextureTexelSize.xy;\r\n    fetchesUV[0] = bilinearFetchOrigin + vec2(fetchesOffsetsU.x, fetchesOffsetsV.x);\r\n    fetchesUV[1] = bilinearFetchOrigin + vec2(fetchesOffsetsU.y, fetchesOffsetsV.x);\r\n    fetchesUV[2] = bilinearFetchOrigin + vec2(fetchesOffsetsU.z, fetchesOffsetsV.x);\r\n    fetchesUV[3] = bilinearFetchOrigin + vec2(fetchesOffsetsU.x, fetchesOffsetsV.y);\r\n    fetchesUV[4] = bilinearFetchOrigin + vec2(fetchesOffsetsU.y, fetchesOffsetsV.y);\r\n    fetchesUV[5] = bilinearFetchOrigin + vec2(fetchesOffsetsU.z, fetchesOffsetsV.y);\r\n    fetchesUV[6] = bilinearFetchOrigin + vec2(fetchesOffsetsU.x, fetchesOffsetsV.z);\r\n    fetchesUV[7] = bilinearFetchOrigin + vec2(fetchesOffsetsU.y, fetchesOffsetsV.z);\r\n    fetchesUV[8] = bilinearFetchOrigin + vec2(fetchesOffsetsU.z, fetchesOffsetsV.z);\r\n\r\n    fetchesWeights[0] = fetchesWeightsU.x * fetchesWeightsV.x;\r\n    fetchesWeights[1] = fetchesWeightsU.y * fetchesWeightsV.x;\r\n    fetchesWeights[2] = fetchesWeightsU.z * fetchesWeightsV.x;\r\n    fetchesWeights[3] = fetchesWeightsU.x * fetchesWeightsV.y;\r\n    fetchesWeights[4] = fetchesWeightsU.y * fetchesWeightsV.y;\r\n    fetchesWeights[5] = fetchesWeightsU.z * fetchesWeightsV.y;\r\n    fetchesWeights[6] = fetchesWeightsU.x * fetchesWeightsV.z;\r\n    fetchesWeights[7] = fetchesWeightsU.y * fetchesWeightsV.z;\r\n    fetchesWeights[8] = fetchesWeightsU.z * fetchesWeightsV.z;\r\n}","#if !defined(ShadowSampler_lib)\r\n    #define ShadowSampler_lib\r\n\r\n    #ifndef GRAPHICS_API_GLES3\r\n\t#define NO_NATIVE_SHADOWMAP\r\n    #endif // GRAPHICS_API_GLES3\r\n\r\n    #if defined(NO_NATIVE_SHADOWMAP)\r\n\t#define TEXTURE2D_SHADOW(textureName)\t\t     uniform mediump sampler2D textureName\r\n\t#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) (texture2D(textureName, coord3.xy).r < coord3.z ? 0.0 : 1.0)\r\n\t#define TEXTURE2D_SHADOW_PARAM(shadowMap)\t     mediump sampler2D shadowMap\r\n    #else // NO_NATIVE_SHADOWMAP\r\n\t#define TEXTURE2D_SHADOW(textureName)\t\t     uniform mediump sampler2DShadow textureName\r\n\t#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) textureLod(textureName, coord3, 0.0)\r\n\t#define TEXTURE2D_SHADOW_PARAM(shadowMap)\t     mediump sampler2DShadow shadowMap\r\n    #endif // NO_NATIVE_SHADOWMAP\r\n\r\n    // \r\n    #ifdef RECEIVESHADOW\r\n\r\n\t#include \"ShadowSampleTent.glsl\";\r\n\r\nuniform vec4 u_ShadowParams;\r\n\r\n\t#define ShadowStrength\t   u_ShadowParams.x\r\n\t#define SpotShadowStrength u_ShadowParams.y\r\n\r\n    // \r\n\t#ifdef SHADOW\r\n\t    #define CALCULATE_SHADOWS\r\nvarying vec4 v_ShadowCoord;\r\nTEXTURE2D_SHADOW(u_ShadowMap);\r\nuniform vec4 u_ShadowMapSize;\r\n\r\n#ifdef SHADOW_CASCADE\r\nconst int c_MaxCascadeCount = 4;\r\n#else //SHADOW_CASCADE\r\nconst int c_MaxCascadeCount = 1;\r\n#endif//SHADOW_CASCADE\r\n\r\nuniform mat4 u_ShadowMatrices[c_MaxCascadeCount];\r\nuniform vec4 u_ShadowSplitSpheres[c_MaxCascadeCount];\r\n\t#endif // SHADOW\r\n\r\n\t// \r\n\t#ifdef SHADOW_SPOT\r\n\t    #define CALCULATE_SPOTSHADOWS\r\nvarying vec4 v_SpotShadowCoord;\r\nTEXTURE2D_SHADOW(u_SpotShadowMap);\r\nuniform vec4 u_SpotShadowMapSize;\r\nuniform mat4 u_SpotViewProjectMatrix;\r\n\t#endif // SHADOW_SPOT\r\n\r\nfloat sampleShdowMapFiltered4(TEXTURE2D_SHADOW_PARAM(shadowMap), vec3 shadowCoord, vec4 shadowMapSize)\r\n{\r\n    float attenuation;\r\n    vec4 attenuation4;\r\n    vec2 offset = shadowMapSize.xy / 2.0;\r\n    vec3 shadowCoord0 = shadowCoord + vec3(-offset, 0.0);\r\n    vec3 shadowCoord1 = shadowCoord + vec3(offset.x, -offset.y, 0.0);\r\n    vec3 shadowCoord2 = shadowCoord + vec3(-offset.x, offset.y, 0.0);\r\n    vec3 shadowCoord3 = shadowCoord + vec3(offset, 0.0);\r\n    attenuation4.x = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord0);\r\n    attenuation4.y = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord1);\r\n    attenuation4.z = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord2);\r\n    attenuation4.w = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord3);\r\n    attenuation = dot(attenuation4, vec4(0.25));\r\n    return attenuation;\r\n}\r\n\r\nfloat sampleShdowMapFiltered9(TEXTURE2D_SHADOW_PARAM(shadowMap), vec3 shadowCoord, vec4 shadowmapSize)\r\n{\r\n    float attenuation;\r\n    float fetchesWeights[9];\r\n    vec2 fetchesUV[9];\r\n    sampleShadowComputeSamplesTent5x5(shadowmapSize, shadowCoord.xy, fetchesWeights, fetchesUV);\r\n    attenuation = fetchesWeights[0] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[0].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[1] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[1].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[2] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[2].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[3] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[3].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[4] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[4].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[5] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[5].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[6] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[6].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[7] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[7].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[8] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[8].xy, shadowCoord.z));\r\n    return attenuation;\r\n}\r\n    #endif // RECEIVESHADOW\r\n\r\n    // \r\n    #if defined(CALCULATE_SHADOWS)\r\n\r\n#ifdef SHADOW_CASCADE\r\n// \r\nmediump int computeCascadeIndex(in vec3 positionWS)\r\n{\r\n    vec3 fromCenter0 = positionWS - u_ShadowSplitSpheres[0].xyz;\r\n    vec3 fromCenter1 = positionWS - u_ShadowSplitSpheres[1].xyz;\r\n    vec3 fromCenter2 = positionWS - u_ShadowSplitSpheres[2].xyz;\r\n    vec3 fromCenter3 = positionWS - u_ShadowSplitSpheres[3].xyz;\r\n\r\n    mediump vec4 comparison = vec4(dot(fromCenter0, fromCenter0) < u_ShadowSplitSpheres[0].w,\r\n\tdot(fromCenter1, fromCenter1) < u_ShadowSplitSpheres[1].w,\r\n\tdot(fromCenter2, fromCenter2) < u_ShadowSplitSpheres[2].w,\r\n\tdot(fromCenter3, fromCenter3) < u_ShadowSplitSpheres[3].w);\r\n\r\n    comparison.yzw = clamp(comparison.yzw - comparison.xyz, 0.0, 1.0); // keep the nearest\r\n    mediump vec4 indexCoefficient = vec4(4.0, 3.0, 2.0, 1.0);\r\n    mediump int index = 4 - int(dot(comparison, indexCoefficient));\r\n    return index;\r\n}\r\n#endif\r\n\r\n// \r\nvec4 getShadowCoord(in vec3 positionWS)\r\n{\r\n\t#ifdef SHADOW_CASCADE\r\n    mediump int cascadeIndex = computeCascadeIndex(positionWS);\r\n\t    #ifdef GRAPHICS_API_GLES3\r\n    mat4 shadowMat = u_ShadowMatrices[cascadeIndex];\r\n\t    #else // GRAPHICS_API_GLES3\r\n    mat4 shadowMat;\r\n    if (cascadeIndex == 0)\r\n\t{\r\n\t    shadowMat = u_ShadowMatrices[0];\r\n\t}\r\n    else if (cascadeIndex == 1)\r\n\t{\r\n\t    shadowMat = u_ShadowMatrices[1];\r\n\t}\r\n    else if (cascadeIndex == 2)\r\n\t{\r\n\t    shadowMat = u_ShadowMatrices[2];\r\n\t}\r\n    else\r\n\t{\r\n\t    shadowMat = u_ShadowMatrices[3];\r\n\t}\r\n\t    #endif // GRAPHICS_API_GLES3\r\n\r\n    return shadowMat * vec4(positionWS, 1.0);\r\n\r\n\t#else // SHADOW_CASCADE\r\n\r\n    return u_ShadowMatrices[0] * vec4(positionWS, 1.0);\r\n\r\n\t#endif // SHADOW_CASCADE\r\n}\r\n\r\n// \r\nfloat sampleShadowmap(in vec4 shadowCoord)\r\n{\r\n    float attenuation = 1.0;\r\n\r\n    vec3 coord = shadowCoord.xyz / shadowCoord.w;\r\n\r\n    vec4 shadowmapSize = u_ShadowMapSize;\r\n\r\n    if (coord.z > 0.0 && coord.z < 1.0)\r\n\t{\r\n\t#if defined(SHADOW_SOFT_SHADOW_HIGH)\r\n\t    attenuation = sampleShdowMapFiltered9(u_ShadowMap, coord, shadowmapSize);\r\n\t#elif defined(SHADOW_SOFT_SHADOW_LOW)\r\n\t    attenuation = sampleShdowMapFiltered4(u_ShadowMap, coord, shadowmapSize);\r\n\t#else // hard\r\n\t    attenuation = SAMPLE_TEXTURE2D_SHADOW(u_ShadowMap, coord);\r\n\t#endif // SHADOW_SOFT_SHADOW_HIGH\r\n\t    attenuation = mix(1.0, attenuation, ShadowStrength);\r\n\t}\r\n\r\n    return attenuation;\r\n}\r\n\r\n    #endif // CALCULATE_SHADOWS\r\n\r\n    //   \r\n    #if defined(CALCULATE_SPOTSHADOWS)\r\n\r\n// \r\nvec4 getSpotShadowCoord(in vec3 positionWS)\r\n{\r\n    vec4 coordinate = u_SpotViewProjectMatrix * vec4(positionWS, 1.0);\r\n\r\n    return coordinate;\r\n}\r\n\r\n// \r\nfloat sampleSpotShadowmap(vec4 shadowCoord)\r\n{\r\n    float attenuation = 1.0;\r\n\r\n    vec3 coord = shadowCoord.xyz / shadowCoord.w;\r\n    coord.xy = coord.xy * 0.5 + 0.5;\r\n\r\n    vec4 shadowmapSize = u_SpotShadowMapSize;\r\n    // todo\r\n    if (coord.z > 0.0 && coord.z < 1.0)\r\n\t{\r\n\t#if defined(SHADOW_SPOT_SOFT_SHADOW_HIGH)\r\n\t    attenuation = sampleShdowMapFiltered9(u_SpotShadowMap, coord, shadowmapSize);\r\n\t#elif defined(SHADOW_SPOT_SOFT_SHADOW_LOW)\r\n\t    attenuation = sampleShdowMapFiltered4(u_SpotShadowMap, coord, shadowmapSize);\r\n\t#else // hard\r\n\t    attenuation = SAMPLE_TEXTURE2D_SHADOW(u_SpotShadowMap, coord);\r\n\t#endif\r\n\t    attenuation = mix(1.0, attenuation, SpotShadowStrength);\r\n\t}\r\n\r\n    return attenuation;\r\n}\r\n\r\n    #endif // CALCULATE_SPOTSHADOWS\r\n\r\n#endif // ShadowSampler_lib","#if !defined(Lighting_lib)\r\n    #define Lighting_lib\r\n\r\n    #include \"ShadowSampler.glsl\";\r\n\r\nstruct Light {\r\n    vec3 color;\r\n    vec3 dir;\r\n    float attenuation;\r\n};\r\n\r\nstruct DirectionLight {\r\n    vec3 color;\r\n    vec3 direction;\r\n    float attenuation;\r\n    int lightMode;\r\n};\r\n\r\nstruct PointLight {\r\n    vec3 color;\r\n    vec3 position;\r\n    float range;\r\n    float attenuation;\r\n    int lightMode;\r\n};\r\n\r\nstruct SpotLight {\r\n    vec3 color;\r\n    vec3 position;\r\n    float range;\r\n    vec3 direction;\r\n    float spot;\r\n    float attenuation;\r\n    int lightMode;\r\n};\r\n\r\n    #define LightMode_Mix      0\r\n    #define LightMode_RealTime 1\r\n\r\nint getAttenuationByMode(float lightMapMode)\r\n{\r\n    #ifdef LIGHTMAP // mix 0 realtime 1\r\n    return int(lightMapMode);\r\n    #else // LIGHTMAP\r\n\r\n\t#ifdef VOLUMETRICGI\r\n    return int(lightMapMode);\r\n\t#endif // VOLUMETRICGI\r\n\r\n    #endif // LIGHTMAP\r\n    return LightMode_RealTime;\r\n}\r\n\r\n    #if defined(DIRECTIONLIGHT) || defined(POINTLIGHT) || defined(SPOTLIGHT)\r\n\r\n\t#define LIGHTING\r\n\r\n// \r\nfloat attenuation(in vec3 L, in float invLightRadius)\r\n{\r\n    float fRatio = clamp(length(L) * invLightRadius, 0.0, 1.0);\r\n    fRatio *= fRatio;\r\n    return 1.0 / (1.0 + 25.0 * fRatio) * clamp(4.0 * (1.0 - fRatio), 0.0, 1.0);\r\n}\r\n\r\n// \r\nLight getLight(in DirectionLight directionLight)\r\n{\r\n    Light light;\r\n    light.color = directionLight.color;\r\n    light.dir = directionLight.direction;\r\n    light.attenuation = directionLight.attenuation;\r\n    return light;\r\n}\r\n\r\n// \r\nLight getLight(in PointLight pointLight, in vec3 normalWS, in vec3 positionWS)\r\n{\r\n    vec3 lightDirection = positionWS - pointLight.position;\r\n    float rangeAttenuate = attenuation(lightDirection, 1.0 / pointLight.range);\r\n\r\n    Light light;\r\n    light.color = pointLight.color * rangeAttenuate;\r\n    light.dir = normalize(lightDirection);\r\n    light.attenuation = pointLight.attenuation;\r\n    return light;\r\n}\r\n\r\n// \r\nLight getLight(in SpotLight spotLight, in vec3 normalWS, in vec3 positionWS)\r\n{\r\n    vec3 lightDirection = positionWS - spotLight.position;\r\n    vec3 normalizeLightDir = normalize(lightDirection);\r\n\r\n    vec2 cosAngles = cos(vec2(spotLight.spot, spotLight.spot * 0.5) * 0.5);\r\n    float dirAttenuate = dot(spotLight.direction, normalizeLightDir);\r\n    dirAttenuate *= smoothstep(cosAngles.x, cosAngles.y, dirAttenuate);\r\n\r\n    float rangeAttenuate = attenuation(lightDirection, 1.0 / spotLight.range);\r\n\r\n    Light light;\r\n    light.color = spotLight.color * rangeAttenuate * dirAttenuate;\r\n    light.dir = normalizeLightDir;\r\n    light.attenuation = spotLight.attenuation;\r\n    return light;\r\n}\r\n\r\n\t#ifdef LEGACYSINGLELIGHTING\r\n\t    #define CalculateLightCount 1\r\n\t    #define DirectionCount\t1\r\n\r\n\t    #ifdef DIRECTIONLIGHT\r\nuniform DirectionLight u_DirectionLight;\r\n\t    #endif // DIRECTIONLIGHT\r\n\r\n\t    #ifdef POINTLIGHT\r\nuniform PointLight u_PointLight;\r\n\t    #endif // POINTLIGHT\r\n\r\n\t    #ifdef SPOTLIGHT\r\nuniform SpotLight u_SpotLight;\r\n\t    #endif // SPOTLIGHT\r\n\r\n\t#else // LEGACYSINGLELIGHTING\r\n\t    #define CalculateLightCount MAX_LIGHT_COUNT\r\n\t    #define DirectionCount\tu_DirationLightCount\r\n\r\nuniform sampler2D u_LightBuffer;\r\n\r\n\t    #ifdef DIRECTIONLIGHT\r\nuniform mediump int u_DirationLightCount;\r\n\t    #endif\r\n\r\n\t    #if defined(POINTLIGHT) || defined(SPOTLIGHT)\r\nconst int c_ClusterBufferWidth = CLUSTER_X_COUNT * CLUSTER_Y_COUNT;\r\nconst int c_ClusterBufferHeight = CLUSTER_Z_COUNT * (1 + int(ceil(float(MAX_LIGHT_COUNT_PER_CLUSTER) / 4.0)));\r\nconst int c_ClusterBufferFloatWidth = c_ClusterBufferWidth * 4;\r\nuniform sampler2D u_LightClusterBuffer;\r\n\r\nint getLightIndex(in int offset, in int index)\r\n{\r\n    int totalOffset = offset + index;\r\n    int row = totalOffset / c_ClusterBufferFloatWidth;\r\n    int lastRowFloat = totalOffset - row * c_ClusterBufferFloatWidth;\r\n    int col = lastRowFloat / 4;\r\n    vec2 uv = vec2((float(col) + 0.5) / float(c_ClusterBufferWidth), (float(row) + 0.5) / float(c_ClusterBufferHeight));\r\n    vec4 texPixel = texture2D(u_LightClusterBuffer, uv);\r\n    int pixelComponent = lastRowFloat - col * 4;\r\n\r\n\t\t#ifdef GRAPHICS_API_GLES3\r\n    return int(texPixel[pixelComponent]);\r\n\t\t#else\r\n    if (pixelComponent == 0)\r\n\treturn int(texPixel.x);\r\n    else if (pixelComponent == 1)\r\n\treturn int(texPixel.y);\r\n    else if (pixelComponent == 2)\r\n\treturn int(texPixel.z);\r\n    else\r\n\treturn int(texPixel.w);\r\n\t\t#endif\r\n}\r\n\t    #endif // POINTLIGHT || SPOTLIGHT\r\n\r\n\t#endif // LEGACYSINGLELIGHTING\r\n\r\n\t#ifdef DIRECTIONLIGHT\r\nDirectionLight getDirectionLight(in int index, in vec3 positionWS)\r\n{\r\n    DirectionLight light;\r\n\t    #ifdef LEGACYSINGLELIGHTING\r\n    light.color = u_DirectionLight.color;\r\n    light.direction = u_DirectionLight.direction;\r\n    light.attenuation = 1.0;\r\n    light.lightMode = getAttenuationByMode(float(u_DirectionLight.lightMode));\r\n\t    #else // LEGACYSINGLELIGHTING\r\n    float v = (float(index) + 0.5) / float(CalculateLightCount);\r\n    vec4 p1 = texture2D(u_LightBuffer, vec2(0.125, v));\r\n    vec4 p2 = texture2D(u_LightBuffer, vec2(0.375, v));\r\n    light.color = p1.rgb;\r\n    light.direction = p2.rgb;\r\n    light.attenuation = 1.0;\r\n    light.lightMode = getAttenuationByMode(p1.a);\r\n\t    #endif // LEGACYSINGLELIGHTING\r\n\r\n\t    #if defined(CALCULATE_SHADOWS)\r\n    if (index == 0)\r\n\t{\r\n\t    vec4 shadowCoord = getShadowCoord(positionWS);\r\n\t    float shadowAttenuation = sampleShadowmap(shadowCoord);\r\n\t    light.attenuation = shadowAttenuation;\r\n\t}\r\n\t    #endif // CALCULATE_SHADOWS\r\n\r\n    return light;\r\n}\r\n\t#endif // DIRECTIONLIGHT\r\n\r\n\t#if defined(POINTLIGHT) || defined(SPOTLIGHT)\r\nivec4 getClusterInfo(mat4 viewMatrix, vec4 viewport, vec3 positionWS, vec4 fragCoord, vec4 projectParams)\r\n{\r\n\t    #ifdef LEGACYSINGLELIGHTING\r\n    return ivec4(1, 1, 0, 0);\r\n\t    #else // LEGACYSINGLELIGHTING\r\n    // todo    positionVS ?\r\n    vec3 viewPos = vec3(viewMatrix * vec4(positionWS, 1.0));\r\n    int clusterXIndex = int(floor(fragCoord.x / (float(viewport.z) / float(CLUSTER_X_COUNT))));\r\n    int clusterYIndex = int(floor((viewport.w * (projectParams.z < 0.0 ? 0.0 : 1.0) - fragCoord.y * projectParams.z) / (float(viewport.w) / float(CLUSTER_Y_COUNT))));\r\n    float zSliceParam = float(CLUSTER_Z_COUNT) / log2(projectParams.y / projectParams.x);\r\n    int clusterZIndex = int(floor(log2(-viewPos.z) * zSliceParam - log2(projectParams.x) * zSliceParam));\r\n    // todo \r\n    vec2 uv = vec2((float(clusterXIndex + clusterYIndex * CLUSTER_X_COUNT) + 0.5) / float(c_ClusterBufferWidth), (float(clusterZIndex) + 0.5) / float(c_ClusterBufferHeight));\r\n    vec4 clusterPixel = texture2D(u_LightClusterBuffer, uv);\r\n    return ivec4(clusterPixel); // X:Point Count Y:Spot Count ZW:Light Offset\r\n\t    #endif // LEGACYSINGLELIGHTING\r\n}\r\n\t#endif // POINTLIGHT || SPOTLIGHT\r\n\r\n\t#ifdef POINTLIGHT\r\nPointLight getPointLight(in int index, in ivec4 clusterInfo, in vec3 positionWS)\r\n{\r\n\r\n    PointLight light;\r\n\t    #ifdef LEGACYSINGLELIGHTING\r\n    light.color = u_PointLight.color;\r\n    light.position = u_PointLight.position;\r\n    light.range = u_PointLight.range;\r\n    light.attenuation = 1.0;\r\n    light.lightMode = getAttenuationByMode(float(u_PointLight.lightMode));\r\n\t    #else // LEGACYSINGLELIGHTING\r\n    // todo  \r\n    int indexOffset = clusterInfo.z * c_ClusterBufferFloatWidth + clusterInfo.w;\r\n    int pointIndex = getLightIndex(indexOffset, index);\r\n    float v = (float(pointIndex) + 0.5) / float(CalculateLightCount);\r\n    vec4 p1 = texture2D(u_LightBuffer, vec2(0.125, v));\r\n    vec4 p2 = texture2D(u_LightBuffer, vec2(0.375, v));\r\n    light.color = p1.rgb;\r\n    light.range = p1.a;\r\n    light.position = p2.rgb;\r\n    light.attenuation = 1.0;\r\n    light.lightMode = getAttenuationByMode(p2.a);\r\n\t    #endif // LEGACYSINGLELIGHTING\r\n    return light;\r\n}\r\n\t#endif // POINTLIGHT\r\n\r\n\t#ifdef SPOTLIGHT\r\nSpotLight getSpotLight(in int index, in ivec4 clusterInfo, in vec3 positionWS)\r\n{\r\n    SpotLight light;\r\n\r\n\t    #ifdef LEGACYSINGLELIGHTING\r\n    light.color = u_SpotLight.color;\r\n    light.position = u_SpotLight.position;\r\n    light.range = u_SpotLight.range;\r\n    light.direction = u_SpotLight.direction;\r\n    light.spot = u_SpotLight.spot;\r\n    light.attenuation = 1.0;\r\n    light.lightMode = getAttenuationByMode(float(u_SpotLight.lightMode));\r\n\t    #else // LEGACYSINGLELIGHTING\r\n    // todo  \r\n    int indexOffset = clusterInfo.z * c_ClusterBufferFloatWidth + clusterInfo.w;\r\n    int spotIndex = getLightIndex(indexOffset, index + clusterInfo.x);\r\n    float v = (float(spotIndex) + 0.5) / float(CalculateLightCount);\r\n    vec4 p1 = texture2D(u_LightBuffer, vec2(0.125, v));\r\n    vec4 p2 = texture2D(u_LightBuffer, vec2(0.375, v));\r\n    vec4 p3 = texture2D(u_LightBuffer, vec2(0.625, v));\r\n    light.color = p1.rgb;\r\n    light.range = p1.a;\r\n    light.position = p2.rgb;\r\n    light.spot = p2.a;\r\n    light.direction = p3.rgb;\r\n    light.attenuation = 1.0;\r\n    light.lightMode = getAttenuationByMode(p3.a);\r\n\t    #endif // LEGACYSINGLELIGHTING\r\n\r\n\t    #if defined(CALCULATE_SPOTSHADOWS)\r\n    if (index == 0)\r\n\t{\r\n\t    vec4 shadowCoord = getSpotShadowCoord(positionWS);\r\n\t    float shadowAttenuation = sampleSpotShadowmap(shadowCoord);\r\n\t    light.attenuation = shadowAttenuation;\r\n\t}\r\n\t    #endif // CALCULATE_SPOTSHADOWS\r\n\r\n    return light;\r\n}\r\n\t#endif // SPOTLIGHT\r\n\r\n    #endif // DIRECTIONLIGHT || POINTLIGHT || SPOTLIGHT\r\n\r\n#endif // Lighting_lib","#if !defined(globalIllumination_lib)\r\n    #define globalIllumination_lib\r\n\r\n    #ifdef VOLUMETRICGI\r\n\t#include \"VolumetricGI.glsl\";\r\n    #endif // VOLUMETRICGI\r\n\r\nvec3 rotateByYAixs(in vec3 normal)\r\n{\r\n    float co = cos(u_GIRotate);\r\n    float si = sin(u_GIRotate);\r\n    float x = normal.x * co - normal.z * si;\r\n    float z = normal.x * si + normal.z * co;\r\n    return vec3(x, normal.y, z);\r\n}\r\n\r\nvec4 rotateByYAixs(in vec4 normal)\r\n{\r\n    float co = cos(u_GIRotate);\r\n    float si = sin(u_GIRotate);\r\n    float x = normal.x * co - normal.z * si;\r\n    float z = normal.x * si + normal.z * co;\r\n    return vec4(x, normal.y, z, normal.w);\r\n}\r\nuniform float u_AmbientIntensity;\r\nuniform float u_ReflectionIntensity;\r\n\r\n    #ifdef GI_IBL\r\n\r\nuniform vec3 u_IblSH[9];\r\n\r\nuniform samplerCube u_IBLTex;\r\nuniform float u_IBLRoughnessLevel;\r\n\r\n\t#define IBL_ROUGHNESS_LEVEL u_IBLRoughnessLevel\r\n\r\n// todo \r\nvec3 diffuseIrradiance(in vec3 normalWS)\r\n{\r\n    // todo cmeng  \r\n    vec3 n = normalWS * vec3(-1.0, 1.0, 1.0);\r\n    n = rotateByYAixs(n);\r\n    return max(\r\n\t       u_IblSH[0]\r\n\t\t   + u_IblSH[1] * n.y\r\n\t\t   + u_IblSH[2] * n.z\r\n\t\t   + u_IblSH[3] * n.x\r\n\t\t   + u_IblSH[4] * (n.y * n.x)\r\n\t\t   + u_IblSH[5] * (n.y * n.z)\r\n\t\t   + u_IblSH[6] * (3.0 * n.z * n.z - 1.0)\r\n\t\t   + u_IblSH[7] * (n.z * n.x)\r\n\t\t   + u_IblSH[8] * (n.x * n.x - n.y * n.y),\r\n\t       0.0)\r\n\t* u_AmbientIntensity;\r\n}\r\n\r\nvec3 diffuseIrradiance(in vec3 normalWS, in vec3 positionWS, in vec3 viewDir)\r\n{\r\n\t#ifdef VOLUMETRICGI\r\n    vec3 surfaceBias = VolumetricGISurfaceBias(normalWS, viewDir);\r\n    return VolumetricGIVolumeIrradiance(positionWS, surfaceBias, normalWS) * u_AmbientIntensity;\r\n\t#else // VOLUMETRICGI\r\n    return diffuseIrradiance(normalWS);\r\n\t#endif // VOLUMETRICGI\r\n}\r\n\r\nvec3 specularRadiance(in vec3 r, in float perceptualRoughness)\r\n{\r\n    float lod = IBL_ROUGHNESS_LEVEL * perceptualRoughness * (2.0 - perceptualRoughness);\r\n\r\n    // todo \r\n    vec3 reflectDir = r * vec3(-1.0, 1.0, 1.0);\r\n\r\n    // todo rotateY SceneConfig\r\n    reflectDir = rotateByYAixs(reflectDir);\r\n\r\n    // todo float  ?\r\n    vec4 reflectSampler = textureCubeLodEXT(u_IBLTex, reflectDir, lod);\r\n\r\n\t#ifdef IBL_RGBD\r\n    return decodeRGBD(reflectSampler) * u_ReflectionIntensity;\r\n\t#else // IBL_RGBD\r\n    return reflectSampler.rgb * u_ReflectionIntensity;\r\n\t#endif // IBL_RGBD\r\n}\r\n\r\n    #endif // GI_IBL\r\n\r\n    #ifdef GI_LEGACYIBL\r\n\r\nuniform vec4 u_AmbientSHAr;\r\nuniform vec4 u_AmbientSHAg;\r\nuniform vec4 u_AmbientSHAb;\r\nuniform vec4 u_AmbientSHBr;\r\nuniform vec4 u_AmbientSHBg;\r\nuniform vec4 u_AmbientSHBb;\r\nuniform vec4 u_AmbientSHC;\r\n\r\n\t#define LAYA_SPECCUBE_LOD_STEPS 6.0\r\nuniform samplerCube u_ReflectTexture;\r\nuniform vec4 u_ReflectCubeHDRParams;\r\n\r\nvec3 shEvalLinearL0L1(in vec4 normal)\r\n{\r\n    vec3 x;\r\n    x.r = dot(u_AmbientSHAr, normal);\r\n    x.g = dot(u_AmbientSHAg, normal);\r\n    x.b = dot(u_AmbientSHAb, normal);\r\n    return x;\r\n}\r\n\r\nvec3 shEvalLinearL2(in vec4 normal)\r\n{\r\n    vec3 x1, x2;\r\n    // 4 of the quadratic (L2) polynomials\r\n    vec4 vB = normal.xyzz * normal.yzzx;\r\n    x1.r = dot(u_AmbientSHBr, vB);\r\n    x1.g = dot(u_AmbientSHBg, vB);\r\n    x1.b = dot(u_AmbientSHBb, vB);\r\n\r\n    // Final (5th) quadratic (L2) polynomial\r\n    float vC = normal.x * normal.x - normal.y * normal.y;\r\n    x2 = u_AmbientSHC.rgb * vC;\r\n\r\n    return x1 + x2;\r\n}\r\n\r\nvec3 diffuseIrradiance(in vec3 normalWS)\r\n{\r\n    // todo -x \r\n    vec4 normal = vec4(-normalWS.x, normalWS.yz, 1.0);\r\n\r\n    // TODO rotate y SceneConfig\r\n\r\n    normal = rotateByYAixs(normal);\r\n\r\n    vec3 ambientContrib = shEvalLinearL0L1(normal);\r\n    ambientContrib += shEvalLinearL2(normal);\r\n    vec3 ambient = max(vec3(0.0), ambientContrib);\r\n\r\n    return ambient * u_AmbientIntensity;\r\n}\r\n\r\nvec3 diffuseIrradiance(in vec3 normalWS, in vec3 positionWS, in vec3 viewDir)\r\n{\r\n\t#ifdef VOLUMETRICGI\r\n    vec3 surfaceBias = VolumetricGISurfaceBias(normalWS, viewDir);\r\n    return VolumetricGIVolumeIrradiance(positionWS, surfaceBias, normalWS) * u_AmbientIntensity;\r\n\t#else // VOLUMETRICGI\r\n    return diffuseIrradiance(normalWS);\r\n\t#endif // VOLUMETRICGI\r\n}\r\n\r\nvec3 specularRadiance(in vec3 r, in float perceptualRoughness)\r\n{\r\n    float roughness = perceptualRoughness * (1.7 - 0.7 * perceptualRoughness);\r\n    // todo \r\n    r *= vec3(-1.0, 1.0, 1.0);\r\n    r = rotateByYAixs(r);\r\n\r\n    float lod = roughness * LAYA_SPECCUBE_LOD_STEPS;\r\n    vec4 rgbm = textureCubeLodEXT(u_ReflectTexture, r, lod);\r\n    float range = u_ReflectCubeHDRParams.x;\r\n    vec3 color = decodeRGBM(rgbm, range);\r\n    color = gammaToLinear(color);\r\n    return color * u_ReflectionIntensity;\r\n}\r\n\r\n    #endif // GI_LEGACYIBL\r\n\r\n    #ifndef GI_IBL\r\n\t#ifndef GI_LEGACYIBL\r\n\r\nuniform vec4 u_AmbientColor;\r\n\r\nvec3 diffuseIrradiance(in vec3 normalWS)\r\n{\r\n    return u_AmbientColor.rgb * u_AmbientIntensity;\r\n}\r\n\r\nvec3 diffuseIrradiance(in vec3 normalWS, in vec3 positionWS, in vec3 viewDir)\r\n{\r\n    return diffuseIrradiance(normalWS);\r\n}\r\n\r\nvec3 specularRadiance(in vec3 r, in float perceptualRoughness)\r\n{\r\n    // todo\r\n    return u_AmbientColor.rgb * u_ReflectionIntensity;\r\n}\r\n\r\n\t#endif // GI_LEGACYIBL\r\n    #endif // GI_IBL\r\n\r\n    #ifdef LIGHTMAP\r\n\r\n\t#ifdef UV1\r\n\t    #define USELIGHTMAP\r\n\t#endif // UV1\r\n\r\nuniform sampler2D u_LightMap;\r\n\r\n\t#ifdef LIGHTMAP_DIRECTIONAL\r\n\r\nuniform sampler2D u_LightMapDirection;\r\n\r\nvec3 DecodeDirectionalLightmap(in vec2 lightmapUV, in vec3 bakeColor, in vec3 normalWS)\r\n{\r\n    vec4 dirLightmap = texture2D(u_LightMapDirection, lightmapUV);\r\n    vec3 lightdir = normalize(dirLightmap.xyz - vec3(0.5)); // 0-1  => -0.5-0.5\r\n    //\r\n    float halfLambert = clamp(dot(normalWS, lightdir), 0.0, 1.0) * 0.5 + 0.5;\r\n    return bakeColor * halfLambert / max(dirLightmap.w, 0.001);\r\n}\r\n\r\n\t#endif // LIGHTMAP_DIRECTIONAL\r\n\r\nvec3 getBakedLightmapColor(in vec2 lightmapUV, in vec3 normalWS)\r\n{\r\n    vec4 lightmapSampler = texture2D(u_LightMap, lightmapUV);\r\n\t// todo lightmap rgbm encode color space\r\n    lightmapSampler.rgb =  decodeRGBM(lightmapSampler,5.0);\r\n\r\n\t//#ifdef Gamma_u_LightMap\r\n    lightmapSampler = gammaToLinear(lightmapSampler);\r\n\t//#endif // Gamma_u_LightMap\r\n\r\n\t#ifdef LIGHTMAP_DIRECTIONAL\r\n    lightmapSampler.rgb = DecodeDirectionalLightmap(lightmapUV, lightmapSampler.rgb, normalWS);\r\n\t#endif // LIGHTMAP_DIRECTIONAL\r\n\r\n    return lightmapSampler.rgb;\r\n}\r\n\r\n    #endif // LIGHTMAP\r\n\r\n    #ifdef SPECCUBE_BOX_PROJECTION\r\n\r\nuniform vec3 u_SpecCubeProbePosition;\r\nuniform vec3 u_SpecCubeBoxMax;\r\nuniform vec3 u_SpecCubeBoxMin;\r\n\r\nvec3 getBoxProjectionReflectedVector(vec3 r, vec3 positionWS)\r\n{\r\n    vec3 boxCenter = u_SpecCubeProbePosition;\r\n    vec3 boxMin = u_SpecCubeBoxMin;\r\n    vec3 boxMax = u_SpecCubeBoxMax;\r\n\r\n    vec3 nr = normalize(r);\r\n    vec3 rbmax = boxMax - positionWS;\r\n    vec3 rbmin = boxMin - positionWS;\r\n    vec3 select = step(vec3(0.0), r);\r\n    vec3 rbminmax = mix(rbmin, rbmax, select) / nr;\r\n    float scalar = vecmin(rbminmax);\r\n    vec3 boxr = nr * scalar + positionWS - boxCenter;\r\n    return boxr;\r\n}\r\n\r\n    #endif // SPECCUBE_BOX_PROJECTION\r\n\r\n#endif // globalIllumination_lib","#if !defined(Oct_lib)\r\n    #define Oct_lib\r\n\r\nfloat signNotZero(in float k) { return k >= 0.0 ? 1.0 : -1.0; }\r\n\r\nvec2 signNotZero(in vec2 v) { return vec2(signNotZero(v.x), signNotZero(v.y)); }\r\n\r\n/**\r\n * v: normalized sample dir\r\n * @return: oct encode uv [-1, 1]\r\n */\r\nvec2 octEncode(in vec3 v)\r\n{\r\n    float l1norm = abs(v.x) + abs(v.y) + abs(v.z);\r\n    vec2 result = v.xy * (1.0 / l1norm);\r\n    if (v.z < 0.0)\r\n\t{\r\n\t    result = (1.0 - abs(result.yx)) * signNotZero(result.xy);\r\n\t}\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * x: u [-1, 1]\r\n * y: v [-1, 1]\r\n * @return: normalized sample dir\r\n */\r\nvec3 finalDecode(float x, float y)\r\n{\r\n    vec3 v = vec3(x, y, 1.0 - abs(x) - abs(y));\r\n    if (v.z < 0.0)\r\n\t{\r\n\t    v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\r\n\t}\r\n    return normalize(v);\r\n}\r\n\r\n/**\r\n * dir: cubemap sample dir\r\n * outsize: probe size with border (x: probe x, y: probe y, z: 1 / probe x, w: 1\r\n * / probe y) gridsize: probe grid size (x: probe x index, y: probe y index, z:\r\n * grid x size, w: grid y size)\r\n * @return texture coord [0, 1]\r\n */\r\nvec2 textureCoordFromDirection(in vec3 dir, vec4 outSize, vec4 gridSize)\r\n{\r\n    vec2 uv = (octEncode(normalize(dir))) * 0.5 + 0.5;\r\n    uv = uv * (outSize.xy - vec2(2.0, 2.0)) * outSize.zw + outSize.zw;\r\n    uv = gridSize.xy * (1.0 / gridSize.zw) + uv * (1.0 / gridSize.zw);\r\n    return uv;\r\n}\r\n\r\n#endif // Oct_lib","#if !defined(GridHelpers_lib)\r\n    #define GridHelpers_lib\r\n\r\nint gridCoordToProbeIndex(in ivec3 probeCoords, const in ivec3 probeCounts)\r\n{\r\n    return probeCoords.x + probeCoords.y * probeCounts.x + probeCoords.z * probeCounts.x * probeCounts.y;\r\n}\r\n\r\nivec3 probeIndexToGridcoord(in int probeIndex, const in ivec3 probeCounts)\r\n{\r\n    ivec3 iPos;\r\n    iPos.x = probeIndex % probeCounts.x;\r\n    iPos.y = (probeIndex % (probeCounts.x * probeCounts.y)) / probeCounts.x;\r\n    iPos.z = probeIndex / (probeCounts.x * probeCounts.y);\r\n    return iPos;\r\n\r\n    //   ivec3 iPos;\r\n    //   iPos.x = probeIndex & (probeCounts.x - 1);\r\n    //   iPos.y = (probeIndex & ((probeCounts.x * probeCounts.y) - 1)) >>\r\n    //            findMSB(probeCounts.x);\r\n    //   iPos.z = probeIndex >> findMSB(probeCounts.x * probeCounts.y);\r\n    //   return iPos;\r\n}\r\n\r\nvec3 gridCoordToPosition(in ivec3 coord, const in vec3 probeStep,\r\n    const in vec3 probeStartPosition)\r\n{\r\n    return (vec3(coord) + 0.5) * probeStep + probeStartPosition;\r\n}\r\n\r\nivec3 baseGridCoord(in vec3 position, in vec3 probeStep,\r\n    in vec3 probeStartPosition, in ivec3 probeCounts)\r\n{\r\n    probeStartPosition += 0.5 * probeStep;\r\n    return clamp(ivec3((position - probeStartPosition) / probeStep),\r\n\tivec3(0, 0, 0), probeCounts - ivec3(1, 1, 1));\r\n}\r\n\r\n#endif // GridHelpers_lib","// https://jcgt.org/published/0008/02/01/\r\n\r\n#if !defined(VolumetricGI_lib)\r\n    #define VolumetricGI_lib\r\n\r\n    #include \"Oct.glsl\";\r\n    #include \"GridHelpers.glsl\";\r\n\r\nstruct VolumetricGI {\r\n    vec3 probeCounts;\r\n    vec3 probeStep;\r\n    vec3 probeStartPosition;\r\n    // float irradianceTexels;\r\n    // float distanceTexels;\r\n    // float normalBias;\r\n    // float viewBias;\r\n    vec4 probeParams; // x: irradianceTexels, y: distanceTexels, z: normalBias, w: viewBias\r\n};\r\n\r\nuniform VolumetricGI u_VolumetricGI;\r\n\r\nuniform sampler2D u_ProbeIrradiance;\r\nuniform sampler2D u_ProbeDistance;\r\n\r\nvec2 porbeGridCoordToTextureGridCoord(in ivec3 porbeGridCoord,\r\n    in ivec3 probeCounts,\r\n    in vec2 textureGridSize)\r\n{\r\n    int probeIndex = gridCoordToProbeIndex(porbeGridCoord, probeCounts);\r\n    ivec2 index;\r\n    index.x = probeIndex % (probeCounts.x * probeCounts.y);\r\n    index.y = probeIndex / (probeCounts.x * probeCounts.y);\r\n\r\n    vec2 textureGridCoord = vec2(index);\r\n    textureGridCoord.y = textureGridCoord.y;\r\n    return textureGridCoord;\r\n}\r\n\r\nvec3 VolumetricGISurfaceBias(in vec3 surfaceNormal, in vec3 cameraDirection)\r\n{\r\n    return surfaceNormal * u_VolumetricGI.probeParams.z + cameraDirection * u_VolumetricGI.probeParams.w;\r\n}\r\n\r\nvec3 VolumetricGIVolumeIrradiance(in vec3 worldPosition, in vec3 surfaceBias,\r\n    in vec3 direction)\r\n{\r\n    // direction *= vec3(-1.0, 1.0, 1.0);\r\n    ivec3 porbeCounts = ivec3(u_VolumetricGI.probeCounts);\r\n    vec3 probeStep = u_VolumetricGI.probeStep;\r\n    vec3 probeStartPosition = u_VolumetricGI.probeStartPosition;\r\n    vec2 volumeCounts = vec2(porbeCounts.x * porbeCounts.y, porbeCounts.z);\r\n    vec4 irradianceTexels = vec4(u_VolumetricGI.probeParams.x, u_VolumetricGI.probeParams.x, 1.0 / u_VolumetricGI.probeParams.x, 1.0 / u_VolumetricGI.probeParams.x);\r\n    vec4 distanceTexels = vec4(u_VolumetricGI.probeParams.y, u_VolumetricGI.probeParams.y, 1.0 / u_VolumetricGI.probeParams.y, 1.0 / u_VolumetricGI.probeParams.y);\r\n\r\n    ivec3 maxGridCoord = porbeCounts - ivec3(1);\r\n\r\n    vec3 irradiance = vec3(0.0);\r\n    float accumulatedWeights = 0.0;\r\n\r\n    // Bias the world space position\r\n    vec3 biasedWorldPosition = worldPosition + surfaceBias;\r\n\r\n    // Get the 3D grid coordinates of the probe nearest the biased world position\r\n    // (i.e. the \"base\" probe)\r\n    ivec3 baseProbeCoords = baseGridCoord(biasedWorldPosition, probeStep,\r\n\tprobeStartPosition, porbeCounts);\r\n\r\n    // Get the world-space position of the base probe (ignore relocation)\r\n    vec3 baseProbeWorldPosition = gridCoordToPosition(baseProbeCoords, probeStep, probeStartPosition);\r\n\r\n    // Clamp the distance (in grid space) between the given point and the base\r\n    // probe's world position (on each axis) to [0, 1]\r\n    vec3 gridSpaceDistance = biasedWorldPosition - baseProbeWorldPosition;\r\n\r\n    vec3 alpha = clamp(gridSpaceDistance / probeStep, vec3(0.0), vec3(1.0));\r\n\r\n    // Iterate over the 8 closest probes and accumulate their contributions\r\n    for (int probeIndex = 0; probeIndex < 8; probeIndex++)\r\n\t{\r\n\t    // Compute the offset to the adjacent probe in grid coordinates by sourcing\r\n\t    // the offsets from the bits of the loop index: x = bit 0, y = bit 1, z =\r\n\t    // bit 2\r\n\t    ivec3 adjacentProbeOffset = ivec3(probeIndex, probeIndex >> 1, probeIndex >> 2) & ivec3(1, 1, 1);\r\n\r\n\t    // Get the 3D grid coordinates of the adjacent probe by adding the offset to\r\n\t    // the base probe and clamping to the grid boundaries\r\n\t    ivec3 adjacentProbeCoords = clamp(baseProbeCoords + adjacentProbeOffset, ivec3(0), maxGridCoord);\r\n\r\n\t    // Get the adjacent probe's world position\r\n\t    vec3 adjacentProbeWorldPosition = gridCoordToPosition(adjacentProbeCoords, probeStep, probeStartPosition);\r\n\r\n\t    // Compute the distance and direction from the (biased and non-biased)\r\n\t    // shading point and the adjacent probe\r\n\t    vec3 worldPosToAdjProbe = normalize(adjacentProbeWorldPosition - worldPosition);\r\n\t    vec3 biasedPosToAdjProbe = normalize(adjacentProbeWorldPosition - biasedWorldPosition);\r\n\t    float biasedPosToAdjProbeDist = distance(adjacentProbeWorldPosition, biasedWorldPosition);\r\n\r\n\t    // Compute trilinear weights based on the distance to each adjacent probe to\r\n\t    // smoothly transition between probes. adjacentProbeOffset is binary, so\r\n\t    // we're using a 1-alpha when adjacentProbeOffset = 0 and alpha when\r\n\t    // adjacentProbeOffset = 1.\r\n\t    vec3 trilinear = max(vec3(0.001), mix(1.0 - alpha, alpha, vec3(adjacentProbeOffset)));\r\n\t    float trilinearWeight = trilinear.x * trilinear.y * trilinear.z;\r\n\t    float weight = 1.0;\r\n\r\n\t    // A naive soft backface weight would ignore a probe when\r\n\t    // it is behind the surface. That's good for walls, but for\r\n\t    // small details inside of a room, the normals on the details\r\n\t    // might rule out all of the probes that have mutual visibility\r\n\t    // to the point. We instead use a \"wrap shading\" test. The small\r\n\t    // offset at the end reduces the \"going to zero\" impact.\r\n\t    float warpShading = (dot(worldPosToAdjProbe, direction) + 1.0) * 0.5;\r\n\t    weight *= (warpShading * warpShading) * 0.2;\r\n\r\n\t    vec2 textureGridCoord = porbeGridCoordToTextureGridCoord(\r\n\t\tadjacentProbeCoords, porbeCounts, volumeCounts);\r\n\t    // compute the octahedral coordinates of the adjacent probe\r\n\t    vec2 probeTextureUV = textureCoordFromDirection(-biasedPosToAdjProbe, distanceTexels,\r\n\t\tvec4(textureGridCoord, volumeCounts));\r\n\t    // Sample the probe's distance texture to get the mean distance to nearby\r\n\t    // surfaces\r\n\t    vec3 filteredDistance = texture2D(u_ProbeDistance, probeTextureUV).xyz;\r\n\t    // Find the variance of the mean distance\r\n\t    float variance = abs(filteredDistance.x * filteredDistance.x - filteredDistance.y);\r\n\r\n\t    // Occlusion test\r\n\t    float chebyshevWeight = 1.0;\r\n\t    if (biasedPosToAdjProbeDist > filteredDistance.x)\r\n\t\t{\r\n\t\t    float v = biasedPosToAdjProbeDist - filteredDistance.x;\r\n\t\t    // v must be greater than 0, which is guaranteed by the if condition\r\n\t\t    // above.\r\n\t\t    chebyshevWeight = variance / (variance + (v * v));\r\n\r\n\t\t    // Increase the contrast in the weight\r\n\t\t    chebyshevWeight = max(chebyshevWeight * chebyshevWeight * chebyshevWeight, 0.0);\r\n\t\t}\r\n\r\n\t    if (filteredDistance.z < 1.0)\r\n\t\t{\r\n\t\t    chebyshevWeight = 1.0;\r\n\t\t}\r\n\r\n\t    // Avoid visibility weights ever going all the way to zero because\r\n\t    // when *no* probe has visibility we need a fallback value\r\n\t    weight *= max(0.05, chebyshevWeight);\r\n\r\n\t    // Avoid a weight of zero\r\n\t    weight = max(0.000001, weight);\r\n\r\n\t    // A small amount of light is visible due to logarithmic perception, so\r\n\t    // crush tiny weights but keep the curve continuous\r\n\t    const float crushThreshold = 0.2;\r\n\t    if (weight < crushThreshold)\r\n\t\t{\r\n\t\t    weight *= (weight * weight) * (1.0 / (crushThreshold * crushThreshold));\r\n\t\t}\r\n\r\n\t    // Apply the trilinear weights\r\n\t    weight *= trilinearWeight;\r\n\r\n\t    probeTextureUV = textureCoordFromDirection(\r\n\t\tdirection, irradianceTexels, vec4(textureGridCoord, volumeCounts));\r\n\r\n\t    // Sample the probe's irradiance\r\n\t    vec3 probeIrradiance = linearToGamma(texture2D(u_ProbeIrradiance, probeTextureUV).rgb);\r\n\r\n\t    irradiance += (probeIrradiance * weight);\r\n\t    accumulatedWeights += weight;\r\n\t}\r\n\r\n    if (accumulatedWeights == 0.0)\r\n\t{\r\n\t    return vec3(0.0);\r\n\t}\r\n\r\n    irradiance *= (1.f / accumulatedWeights); // Normalize by the accumulated weights\r\n\r\n    irradiance = gammaToLinear(irradiance);\r\n\r\n    return irradiance;\r\n}\r\n\r\n#endif // VolumetricGI_lib","#if !defined(BlinnPhongLighting_lib)\r\n    #define BlinnPhongLighting_lib\r\n\r\n    #include \"Lighting.glsl\";\r\n    #include \"globalIllumination.glsl\";\r\n\r\nstruct PixelInfo {\r\n    vec3 positionWS;\r\n\r\n    vec3 vertexNormalWS;\r\n    vec3 normalWS;\r\n\r\n    vec3 viewDir;\r\n\r\n    #ifdef LIGHTMAP\r\n\t#ifdef UV1\r\n    vec2 lightmapUV;\r\n\t#endif // UV1\r\n    #endif // LIGHTMAP\r\n};\r\n\r\nstruct Surface {\r\n    vec3 diffuseColor;\r\n    vec3 specularColor;\r\n    float shininess;\r\n    vec3 gloss;\r\n\r\n    vec3 normalTS;\r\n\r\n    float alpha;\r\n    float alphaClip;\r\n};\r\n\r\nvec3 BlinnPhongLighting(in Surface surface, in Light light, in PixelInfo pixel)\r\n{\r\n    vec3 l = normalize(-light.dir);\r\n    vec3 v = pixel.viewDir;\r\n\r\n    vec3 normalWS = pixel.normalWS;\r\n\r\n    vec3 diffuseColor = surface.diffuseColor;\r\n    float shininess = surface.shininess;\r\n    vec3 specularColor = surface.specularColor;\r\n    vec3 gloss = surface.gloss;\r\n\r\n    // difffuse\r\n    float ndl = max(0.0, dot(normalWS, l));\r\n    vec3 lightDiffuse = light.color * diffuseColor * ndl;\r\n\r\n    // specular\r\n    mediump vec3 h = normalize(v + l);\r\n    lowp float ndh = max(0.0, dot(h, normalWS));\r\n    float specularIntensity = pow(ndh, shininess * 128.0);\r\n    vec3 lightSpecular = light.color * specularColor * specularIntensity * gloss;\r\n\r\n    return lightDiffuse + lightSpecular;\r\n}\r\n\r\nvec3 BlinnPhongGI(const in Surface surface, const in PixelInfo info)\r\n{\r\n    vec3 indirect = vec3(0.0);\r\n\r\n    #ifdef LIGHTMAP\r\n\t#ifdef UV1\r\n\r\n    vec2 lightmapUV = info.lightmapUV;\r\n    vec3 bakedColor = getBakedLightmapColor(lightmapUV, info.normalWS);\r\n\r\n    // todo  surface.diffuseColor \r\n    indirect = bakedColor * surface.diffuseColor;\r\n\r\n\t#endif // UV1\r\n\r\n    #else // LIGHTMAP\r\n\r\n    vec3 n = info.normalWS;\r\n    indirect = diffuseIrradiance(n) * surface.diffuseColor;\r\n\r\n    #endif // LIGHTMAP\r\n\r\n    return indirect;\r\n}\r\n\r\n#endif // BlinnPhongLighting_lib","#if !defined(PBRLighting_lib)\r\n    #define PBRLighting_lib\r\n\r\n    #include \"Lighting.glsl\";\r\n\r\n    // \r\n    #if !defined(GL_FRAGMENT_PRECISION_HIGH)\r\n\t#define MIN_PERCEPTUAL_ROUGHNESS 0.089\r\n\t#define MIN_ROUGHNESS\t\t 0.007921\r\n    #else\r\n\t#define MIN_PERCEPTUAL_ROUGHNESS 0.045\r\n\t#define MIN_ROUGHNESS\t\t 0.002025\r\n    #endif\r\n\r\n    #define MIN_N_DOT_V 1e-4\r\n\r\n    #include \"BRDF.glsl\";\r\n\r\nstruct PixelInfo {\r\n    vec3 positionWS;\r\n\r\n    vec3 vertexNormalWS;\r\n    vec3 normalWS;\r\n    vec3 tangentWS;\r\n    vec3 biNormalWS;\r\n\r\n    vec3 viewDir;\r\n    float NoV;\r\n\r\n    vec3 dfg;\r\n    vec3 energyCompensation;\r\n\r\n    #ifdef IRIDESCENCE\r\n    vec3 iridescenceFresnel;\r\n    #endif // IRIDESCENCE\r\n\r\n    #ifdef CLEARCOAT\r\n    vec3 clearCoatNormal;\r\n    float clearCoatNoV;\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef SHEEN\r\n    float sheenScaling;\r\n    float sheenDfg;\r\n    #endif // SHEEN\r\n\r\n    #ifdef ANISOTROPIC\r\n    vec3 anisotropicT;\r\n    vec3 anisotropicB;\r\n    float ToV;\r\n    float BoV;\r\n    float at;\r\n    float ab;\r\n    #endif // ANISOTROPIC\r\n\r\n    #ifdef THICKNESS\r\n    vec4 worldScale;\r\n    #endif // THICKNESS\r\n\r\n    #ifdef LIGHTMAP\r\n\t#ifdef UV1\r\n    vec2 lightmapUV;\r\n\t#endif // UV1\r\n    #endif // LIGHTMAP\r\n};\r\n\r\nstruct Surface {\r\n    vec3 diffuseColor;\r\n    float alpha;\r\n    vec3 f0;\r\n    vec3 f90;\r\n    float roughness;\r\n    float perceptualRoughness;\r\n    float occlusion;\r\n\r\n    #ifdef EMISSION\r\n    vec3 emissionColor;\r\n    #endif // EMISSION\r\n\r\n    vec3 normalTS;\r\n\r\n    float ior;\r\n\r\n    #ifdef CLEARCOAT\r\n    float clearCoat;\r\n    float clearCoatRoughness;\r\n    float clearCoatPerceptualRoughness;\r\n\t#ifdef CLEARCOAT_NORMAL\r\n    vec3 clearCoatNormalTS;\r\n\t#endif // CLEARCOAT_NORMAL\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef ANISOTROPIC\r\n    float anisotropy;\r\n    vec2 anisotropyDirection;\r\n    #endif // ANISOTROPIC\r\n\r\n    #ifdef IRIDESCENCE\r\n    float iridescence;\r\n    float iridescenceIor;\r\n    float iridescenceThickness;\r\n    #endif // IRIDESCENCE\r\n\r\n    #ifdef SHEEN\r\n    vec3 sheenColor;\r\n    float sheenRoughness;\r\n    float sheenPerceptualRoughness;\r\n    #endif // SHEEN\r\n\r\n    #ifdef TRANSMISSION\r\n    float transmission;\r\n    #endif // TRANSMISSION\r\n\r\n    #ifdef THICKNESS\r\n    float thickness;\r\n    vec3 attenuationColor;\r\n    float attenuationDistance;\r\n    #endif // THICKNESS\r\n};\r\n\r\nstruct LightParams {\r\n    vec3 l;\r\n    vec3 h;\r\n    float NoL;\r\n    float NoH;\r\n    float LoH;\r\n    float VoH;\r\n\r\n    #ifdef CLEARCOAT\r\n    float clearCoatNoH;\r\n    float clearCoatNoL;\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef ANISOTROPIC\r\n    float ToL;\r\n    float BoL;\r\n    #endif // ANISOTROPIC\r\n};\r\n\r\nvoid initLightParams(inout LightParams params, const in PixelInfo pixel, const in Light light)\r\n{\r\n    vec3 v = pixel.viewDir;\r\n    vec3 n = pixel.normalWS;\r\n\r\n    vec3 l = normalize(-light.dir);\r\n    params.l = l;\r\n\r\n    vec3 h = SafeNormalize(v + l);\r\n    params.h = h;\r\n    params.NoL = saturate(dot(n, l));\r\n    params.NoH = saturate(dot(n, h));\r\n    params.LoH = saturate(dot(l, h));\r\n    params.VoH = saturate(dot(v, h));\r\n\r\n    #ifdef CLEARCOAT\r\n    params.clearCoatNoL = saturate(dot(pixel.clearCoatNormal, l));\r\n    params.clearCoatNoH = saturate(dot(pixel.clearCoatNormal, h));\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef ANISOTROPIC\r\n    vec3 t = pixel.anisotropicT;\r\n    vec3 b = pixel.anisotropicB;\r\n    params.ToL = dot(t, l);\r\n    params.BoL = dot(b, l);\r\n    #endif // ANISOTROPIC\r\n}\r\n\r\nvec3 prefilteredDFG_LUT(float roughness, float NoV)\r\n{\r\n    vec2 samplePoint = clamp(vec2(NoV, roughness), vec2(0.0, 0.0), vec2(1.0, 1.0));\r\n    samplePoint.y = 1.0 - samplePoint.y;\r\n    #if defined(FLOATTEXTURE) && defined(FLOATTEXTURE_FIL_LINEAR)\r\n    return (texture2D(u_IBLDFG, samplePoint)).rgb;\r\n    #else\r\n    return decodeRGBD(texture2D(u_IBLDFG, samplePoint));\r\n    #endif\r\n}\r\n\r\n// todo remove\r\nvec2 EnvBRDFApproxLazarov(float roughness, float NoV)\r\n{\r\n    vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);\r\n    vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);\r\n    vec4 r = roughness * c0 + c1;\r\n    float a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\r\n    vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\r\n    return AB;\r\n}\r\n\r\nfloat dielectricSpecularToF0(float specular)\r\n{\r\n    return 0.08 * specular;\r\n}\r\n\r\nfloat dielectricF0ToIor(float f0)\r\n{\r\n    return 2.0 / (1.0 - sqrt(min(f0, 0.99))) - 1.0;\r\n}\r\n\r\nfloat dielectricIorToF0(float ior)\r\n{\r\n    return pow2((ior - 1.0) / (ior + 1.0));\r\n}\r\n\r\n// input dielectric f0, output surface f0\r\nvec3 computeF0(vec3 f0, vec3 baseColor, float metallic)\r\n{\r\n    return mix(f0, baseColor, metallic);\r\n}\r\n\r\n// input surface f0, output surface f90\r\nvec3 computeF90(vec3 f0)\r\n{\r\n    return vec3(saturate(dot(f0, vec3(50.0 * 0.33))));\r\n}\r\n\r\nvec3 computeDiffuse(vec3 baseColor, float metallic)\r\n{\r\n    return (1.0 - metallic) * baseColor;\r\n}\r\n\r\nfloat specularAA(float roughness, in vec3 normalWS)\r\n{\r\n\r\n    #if !defined(GRAPHICS_API_GLES3) && !defined(GL_OES_standard_derivatives)\r\n\r\n    return roughness;\r\n\r\n    #else // !GRAPHICS_API_GLES3 && !GL_OES_standard_derivatives\r\n\r\n    vec3 du = dFdx(normalWS);\r\n    vec3 dv = dFdy(normalWS);\r\n\r\n    float specularAAVariance = 0.15;\r\n    float specularAAThreshold = 0.04;\r\n\r\n    float variance = specularAAVariance * (dot(du, du) + dot(dv, dv));\r\n    float kernelRoughness = min(2.0 * variance, specularAAThreshold);\r\n\r\n    float squareRoughness = saturate(roughness * roughness + kernelRoughness);\r\n\r\n    return sqrt(squareRoughness);\r\n\r\n    #endif // !GRAPHICS_API_GLES3 && !GL_OES_standard_derivatives\r\n}\r\n\r\nvec3 diffuseLobe(in Surface surface, const in PixelInfo pixel, const in LightParams lightParams)\r\n{\r\n    return surface.diffuseColor * Fd_Lambert();\r\n    // return surface.diffuseColor * Fd_Burley(surface.roughness, pixel.NoV, lightParams.NoL, lightParams.LoH);\r\n}\r\n\r\nvec3 specularLobe(const in Surface surface, const in PixelInfo pixel, const in LightParams lightParams)\r\n{\r\n    float roughness = surface.roughness;\r\n\r\n    float D = distribution(roughness, lightParams.NoH, lightParams.h, pixel.normalWS);\r\n    float V = visibility(roughness, pixel.NoV, lightParams.NoL);\r\n    vec3 F = fresnel(surface.f0, surface.f90, lightParams.LoH);\r\n\r\n    return (D * V) * F;\r\n}\r\n\r\n    #ifdef IRIDESCENCE\r\nvec3 iridescenceDiffuseLobe(in Surface surface, const in PixelInfo pixel, const in LightParams lightParams)\r\n{\r\n    vec3 f0 = surface.f0;\r\n    vec3 f90 = vec3(1.0);\r\n    vec3 iridescenceFresnel = pixel.iridescenceFresnel;\r\n    float iridescence = surface.iridescence;\r\n    float VoH = lightParams.VoH;\r\n    return surface.diffuseColor * Fd_IridescenceLambert(f0, f90, iridescenceFresnel, iridescence, VoH);\r\n}\r\n\r\nvec3 iridescenceSpecularLobe(const in Surface surface, const in PixelInfo pixel, const in LightParams lightParams)\r\n{\r\n    float roughness = surface.roughness;\r\n    float D = distribution(roughness, lightParams.NoH, lightParams.h, pixel.normalWS);\r\n    float V = visibility(roughness, pixel.NoV, lightParams.NoL);\r\n\r\n    float iridescenceFactor = surface.iridescence;\r\n    vec3 iridescenceFresnel = pixel.iridescenceFresnel;\r\n    vec3 F = mix(fresnel(surface.f0, lightParams.LoH), iridescenceFresnel, vec3(iridescenceFactor));\r\n\r\n    return (D * V) * F;\r\n}\r\n    #endif // IRIDESCENCE\r\n\r\n    #ifdef CLEARCOAT\r\nfloat clearCoatLobe(const in Surface surface, const in PixelInfo pixel, const in LightParams lightParams)\r\n{\r\n    float roughness = surface.clearCoatRoughness;\r\n    float clearCoat = surface.clearCoat;\r\n    vec3 n = pixel.clearCoatNormal;\r\n    vec3 h = lightParams.h;\r\n    float LoH = lightParams.LoH;\r\n\r\n    float clearCoatNoH = lightParams.clearCoatNoH;\r\n\r\n    float D = distribution(roughness, clearCoatNoH, h, n);\r\n    float V = V_kelemen(LoH);\r\n\r\n    return D * V;\r\n}\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef SHEEN\r\nvec3 sheenLobe(const in Surface surface, const in PixelInfo pixel, const in LightParams lightParams)\r\n{\r\n    float roughness = surface.sheenRoughness;\r\n    float NoV = pixel.NoV;\r\n    float NoH = lightParams.NoH;\r\n    float NoL = lightParams.NoL;\r\n\r\n    float D = D_Charlie(roughness, NoH);\r\n    float V = V_Neubelt(NoV, NoL);\r\n    // F = 1.0\r\n    return D * V * surface.sheenColor;\r\n}\r\n    #endif // SHEEN\r\n\r\n    #ifdef ANISOTROPIC\r\nvec3 anisotropyLobe(const in Surface surface, const in PixelInfo pixel, const in LightParams lightParams)\r\n{\r\n    float anisotropy = surface.anisotropy;\r\n    float at = pixel.at;\r\n    float ab = pixel.ab;\r\n    vec3 anisotropicT = pixel.anisotropicT;\r\n    vec3 anisotropicB = pixel.anisotropicB;\r\n\r\n    float NoV = pixel.NoV;\r\n    float ToV = pixel.ToV;\r\n    float BoV = pixel.BoV;\r\n\r\n    vec3 h = lightParams.h;\r\n    float NoL = lightParams.NoL;\r\n    float NoH = lightParams.NoH;\r\n    float VoH = lightParams.VoH;\r\n    float ToL = lightParams.ToL;\r\n    float BoL = lightParams.BoL;\r\n\r\n    float V = V_SmithGGXCorrelated_Anisotropic(at, ab, ToV, BoV, ToL, BoL, NoV, NoL);\r\n    float D = D_GGX_Anisotropic(NoH, h, anisotropicT, anisotropicB, at, ab);\r\n    vec3 F = fresnel(surface.f0, surface.f90, lightParams.LoH);\r\n    return V * D * F;\r\n}\r\n    #endif // ANISOTROPIC\r\n\r\nvec3 PBRLighting(const in Surface surface, const in PixelInfo pixel, const in Light light)\r\n{\r\n    LightParams lightParams;\r\n    initLightParams(lightParams, pixel, light);\r\n\r\n    float NoL = lightParams.NoL;\r\n\r\n    #ifdef IRIDESCENCE\r\n    vec3 Fd = iridescenceDiffuseLobe(surface, pixel, lightParams);\r\n    vec3 Fr = iridescenceSpecularLobe(surface, pixel, lightParams);\r\n    #elif defined(ANISOTROPIC)\r\n    vec3 Fd = diffuseLobe(surface, pixel, lightParams);\r\n    vec3 Fr = anisotropyLobe(surface, pixel, lightParams);\r\n    #else\r\n    vec3 Fd = diffuseLobe(surface, pixel, lightParams);\r\n    vec3 Fr = specularLobe(surface, pixel, lightParams);\r\n    #endif\r\n\r\n    #ifdef TRANSMISSION\r\n    Fd *= 1.0 - surface.transmission;\r\n    #endif // TRANSMISSION\r\n\r\n    vec3 shading = (Fd + Fr * pixel.energyCompensation);\r\n\r\n    #ifdef SHEEN\r\n    vec3 fSheen = sheenLobe(surface, pixel, lightParams);\r\n    shading *= pixel.sheenScaling;\r\n    shading += fSheen;\r\n    #endif // SHEEN\r\n\r\n    #ifdef CLEARCOAT\r\n    float clearCoatNoL = lightParams.clearCoatNoL;\r\n    float LoH = lightParams.LoH;\r\n    // default IOR 1.5\r\n    float FccClearCoat = F_Schlick(0.04, 1.0, LoH) * surface.clearCoat;\r\n    float attenuation = 1.0 - FccClearCoat;\r\n    shading *= attenuation * NoL;\r\n\r\n    float clearcoat = clearCoatLobe(surface, pixel, lightParams) * FccClearCoat;\r\n    shading += clearcoat * clearCoatNoL;\r\n    // NoL has alread multiply\r\n    NoL = 1.0;\r\n    #endif // CLEARCOAT\r\n\r\n    return shading * light.color * NoL;\r\n}\r\n\r\n    // gi\r\n    #include \"PBRGI.glsl\";\r\n\r\n#endif // PBRLighting_lib","import { Event } from \"../../events/Event\";\r\nimport { SkinnedMeshRenderer } from \"./SkinnedMeshRenderer\";\r\nimport { RenderContext3D } from \"./render/RenderContext3D\";\r\nimport { Transform3D } from \"./Transform3D\";\r\nimport { SubMeshRenderElement } from \"./render/SubMeshRenderElement\";\r\nimport { Sprite3D } from \"./Sprite3D\";\r\nimport { RenderElement } from \"./render/RenderElement\";\r\nimport { SkinnedMeshSprite3DShaderDeclaration } from \"./SkinnedMeshSprite3DShaderDeclaration\";\r\nimport { Mesh } from \"../resource/models/Mesh\";\r\nimport { Texture2D } from \"../../resource/Texture2D\";\r\nimport { Component } from \"../../components/Component\";\r\nimport { ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../maths/Vector2\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\n\r\nexport class SimpleSkinnedMeshRenderer extends SkinnedMeshRenderer {\r\n    /**@internal  */\r\n    static SIMPLE_SIMPLEANIMATORTEXTURE: number;\r\n    /**@internal */\r\n    static SIMPLE_SIMPLEANIMATORPARAMS: number;\r\n    /**@internal */\r\n    static SIMPLE_SIMPLEANIMATORTEXTURESIZE: number;\r\n\r\n    /**@internal */\r\n    private _simpleAnimatorTexture: Texture2D;\r\n    /**@internal */\r\n    _simpleAnimatorParams: Vector4;\r\n    /**@internal */\r\n    private _simpleAnimatorTextureSize: number;\r\n    /**@internal  x simpleAnimation offset,y simpleFrameOffset*/\r\n    private _simpleAnimatorOffset: Vector2;\r\n    /**@internal */\r\n    _bonesNums: number;\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    get simpleAnimatorTexture(): Texture2D {\r\n        return this._simpleAnimatorTexture;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    set simpleAnimatorTexture(value: Texture2D) {\r\n        this._simpleAnimatorTexture = value;\r\n        this._simpleAnimatorTextureSize = value.width;\r\n        this._shaderValues.setTexture(SimpleSkinnedMeshRenderer.SIMPLE_SIMPLEANIMATORTEXTURE, value);\r\n        value._addReference();\r\n        this._shaderValues.setNumber(SimpleSkinnedMeshRenderer.SIMPLE_SIMPLEANIMATORTEXTURESIZE, this._simpleAnimatorTextureSize);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    get simpleAnimatorOffset(): Vector2 {\r\n        return this._simpleAnimatorOffset;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    set simpleAnimatorOffset(value: Vector2) {\r\n        value.cloneTo(this._simpleAnimatorOffset);\r\n    }\r\n\r\n\r\n    /**\r\n     *  <code>SkinnedMeshRender</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._simpleAnimatorParams = new Vector4();\r\n        this._simpleAnimatorOffset = new Vector2();\r\n        this._shaderValues.addDefine(SkinnedMeshSprite3DShaderDeclaration.SHADERDEFINE_SIMPLEBONE);\r\n        this._shaderValues.addDefine(SkinnedMeshSprite3DShaderDeclaration.SHADERDEFINE_BONE);\r\n    }\r\n\r\n    protected _getcommonUniformMap(): string[] {\r\n        return [\"Sprite3D\", \"SimpleSkinnedMesh\"];\r\n    }\r\n\r\n    /**\r\n     *@inheritDoc\r\n     *@override\r\n     *@internal\r\n     */\r\n    _createRenderElement() {\r\n        let renderelement = new SubMeshRenderElement();\r\n        return renderelement as any;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _computeAnimatorParamsData(): void {\r\n        if (this._cacheMesh) {\r\n            this._simpleAnimatorParams.x = this._simpleAnimatorOffset.x;\r\n            this._simpleAnimatorParams.y = Math.round(this._simpleAnimatorOffset.y) * this._bonesNums * 4;\r\n        }\r\n    }\r\n\r\n    /**\r\n    *@inheritDoc\r\n    *@override\r\n    *@internal\r\n    */\r\n    _onMeshChange(value: Mesh): void {\r\n        this._onSkinMeshChange(value);\r\n        if (!value)\r\n            return;\r\n        this._cacheMesh = (<Mesh>value);\r\n\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _renderUpdate(context: RenderContext3D, transform: Transform3D): void {\r\n        var element: SubMeshRenderElement = <SubMeshRenderElement>context.renderElement;\r\n\r\n        if (this.rootBone) {\r\n            var worldMat: Matrix4x4 = (this.rootBone as Sprite3D).transform.worldMatrix;\r\n            if (this._subUniformBufferData) {\r\n                let oriMat = this._shaderValues.getMatrix4x4(Sprite3D.WORLDMATRIX);\r\n                this._subUniformBufferData._needUpdate = oriMat ? !oriMat.equalsOtherMatrix(worldMat) : true;\r\n            }\r\n            this._setShaderValue(Sprite3D.WORLDMATRIX, ShaderDataType.Matrix4x4, worldMat);\r\n            this._worldParams.x = (this.rootBone as Sprite3D).transform.getFrontFaceValue();\r\n            this._setShaderValue(Sprite3D.WORLDINVERTFRONT, ShaderDataType.Vector4, this._worldParams);\r\n        } else {\r\n            this._setShaderValue(Sprite3D.WORLDMATRIX, ShaderDataType.Matrix4x4, transform.worldMatrix);\r\n            this._worldParams.x = transform.getFrontFaceValue();\r\n            this._setShaderValue(Sprite3D.WORLDINVERTFRONT, ShaderDataType.Vector4, this._worldParams);\r\n        }\r\n        this._computeAnimatorParamsData();\r\n        this._shaderValues.setVector(SimpleSkinnedMeshRenderer.SIMPLE_SIMPLEANIMATORPARAMS, this._simpleAnimatorParams);\r\n\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _renderUpdateWithCamera(context: RenderContext3D, transform: Transform3D): void {\r\n    }\r\n\r\n    _cloneTo(dest: Component): void {\r\n        let render = dest as SimpleSkinnedMeshRenderer;\r\n        render.simpleAnimatorOffset = this.simpleAnimatorOffset;\r\n        render.simpleAnimatorTexture = this.simpleAnimatorTexture;\r\n        render._bonesNums = this._bonesNums;\r\n        super._cloneTo(dest);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    protected _onDestroy() {\r\n        if (this._cacheRootBone)\r\n            (!this._cacheRootBone._destroyed) && (this._cacheRootBone.transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange));\r\n        (this._simpleAnimatorTexture) && this._simpleAnimatorTexture._removeReference();\r\n        this._simpleAnimatorTexture = null;\r\n        super._onDestroy();\r\n    }\r\n}","import { Node } from \"../../display/Node\";\r\nimport { Loader } from \"../../net/Loader\";\r\nimport { Mesh } from \"../resource/models/Mesh\";\r\nimport { MeshFilter } from \"./MeshFilter\";\r\nimport { RenderableSprite3D } from \"./RenderableSprite3D\";\r\nimport { Sprite3D } from \"./Sprite3D\";\r\nimport { Material } from \"../../resource/Material\";\r\nimport { SimpleSkinnedMeshRenderer } from \"./SimpleSkinnedMeshRenderer\";\r\nimport { Texture2D } from \"../../resource/Texture2D\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\n\r\n\r\n\r\n/**\r\n * <code>SkinnedMeshSprite3D</code> \r\n */\r\nexport class SimpleSkinnedMeshSprite3D extends RenderableSprite3D {\r\n    /**@internal */\r\n    static _tempArray0: any[] = [];\r\n\r\n    /** */\r\n    static SIMPLE_SIMPLEANIMATORTEXTURE: number;\r\n    static SIMPLE_SIMPLEANIMATORPARAMS: number;\r\n    static SIMPLE_SIMPLEANIMATORTEXTURESIZE: number;\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n        SimpleSkinnedMeshRenderer.SIMPLE_SIMPLEANIMATORPARAMS = SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORPARAMS;\r\n        SimpleSkinnedMeshRenderer.SIMPLE_SIMPLEANIMATORTEXTURE = SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORTEXTURE;\r\n        SimpleSkinnedMeshRenderer.SIMPLE_SIMPLEANIMATORTEXTURESIZE = SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORTEXTURESIZE;\r\n\r\n        SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORTEXTURE = Shader3D.propertyNameToID(\"u_SimpleAnimatorTexture\");\r\n        SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORPARAMS = Shader3D.propertyNameToID(\"u_SimpleAnimatorParams\");\r\n        SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORTEXTURESIZE = Shader3D.propertyNameToID(\"u_SimpleAnimatorTextureSize\");\r\n\r\n        const commandUniform = LayaGL.renderOBJCreate.createGlobalUniformMap(\"SimpleSkinnedMesh\");\r\n        commandUniform.addShaderUniform(SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORTEXTURE, \"u_SimpleAnimatorTexture\", ShaderDataType.Texture2D);\r\n        commandUniform.addShaderUniform(SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORPARAMS, \"u_SimpleAnimatorParams\", ShaderDataType.Vector4);\r\n        commandUniform.addShaderUniform(SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORTEXTURESIZE, \"u_SimpleAnimatorTextureSize\", ShaderDataType.Float);\r\n    }\r\n\r\n    /** @internal */\r\n    private _meshFilter: MeshFilter;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get meshFilter(): MeshFilter {\r\n        return this._meshFilter;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get simpleSkinnedMeshRenderer(): SimpleSkinnedMeshRenderer {\r\n        return (<SimpleSkinnedMeshRenderer>this._render);\r\n    }\r\n\r\n    /**\r\n     *  <code>MeshSprite3D</code> \r\n     * @param mesh ,\r\n     * @param name \r\n     */\r\n    constructor(mesh: Mesh = null, name: string = null) {\r\n        super(name);\r\n        this._meshFilter = this.addComponent(MeshFilter);\r\n        this._render = this.addComponent(SimpleSkinnedMeshRenderer);\r\n        (mesh) && (this._meshFilter.sharedMesh = mesh);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n        var render: SimpleSkinnedMeshRenderer = this.simpleSkinnedMeshRenderer;\r\n        var lightmapIndex: any = data.lightmapIndex;\r\n        (lightmapIndex != null) && (render.lightmapIndex = lightmapIndex);\r\n        var lightmapScaleOffsetArray: any[] = data.lightmapScaleOffset;\r\n        (lightmapScaleOffsetArray) && (render.lightmapScaleOffset = new Vector4(lightmapScaleOffsetArray[0], lightmapScaleOffsetArray[1], lightmapScaleOffsetArray[2], lightmapScaleOffsetArray[3]));\r\n        (data.enableRender != undefined) && (render.enabled = data.enableRender);\r\n        (data.receiveShadows != undefined) && (render.receiveShadow = data.receiveShadows);\r\n        (data.castShadow != undefined) && (render.castShadow = data.castShadow);\r\n        let meshPath: string = data.meshPath;\r\n        if (meshPath) {\r\n            let mesh: Mesh = Loader.getRes(meshPath);//mesh\r\n            (mesh) && (this.meshFilter.sharedMesh = mesh);\r\n        }\r\n\r\n        var materials: any[] = data.materials;\r\n        if (materials) {\r\n            let sharedMaterials: Material[] = render.sharedMaterials;\r\n            let materialCount: number = materials.length;\r\n            sharedMaterials.length = materialCount;\r\n            for (let i = 0; i < materialCount; i++) {\r\n                sharedMaterials[i] = Loader.getRes(materials[i].path);\r\n            }\r\n            render.sharedMaterials = sharedMaterials;\r\n        }\r\n\r\n        var boundBox: any = data.boundBox;\r\n        var min: any[] = boundBox.min;\r\n        var max: any[] = boundBox.max;\r\n        render.localBounds.setMin(new Vector3(min[0], min[1], min[2]));\r\n        render.localBounds.setMax(new Vector3(max[0], max[1], max[2]));\r\n        render.localBounds = render.localBounds;\r\n        if (spriteMap) {\r\n            let rootBoneData: number = data.rootBone;\r\n            render.rootBone = spriteMap[rootBoneData];\r\n            let bonesData: any[] = data.bones;\r\n            for (let i = 0, n = bonesData.length; i < n; i++)\r\n                render.bones.push(spriteMap[bonesData[i]]);\r\n\r\n            render._bonesNums = data.bonesNums ? data.bonesNums : render.bones.length;\r\n        }\r\n        // else {//[]\r\n        // \t(data.rootBone) && (render._setRootBone(data.rootBone));//[]\r\n        // }\r\n        var animatorTexture: string = data.animatorTexture;\r\n        if (animatorTexture) {\r\n            let animatortexture: Texture2D = Loader.getRes(animatorTexture, Loader.TEXTURE2D);\r\n            render.simpleAnimatorTexture = animatortexture;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _cloneTo(destObject: any, srcRoot: Node, dstRoot: Node): void {\r\n        super._cloneTo(destObject, srcRoot, dstRoot);//,\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    destroy(destroyChild: boolean = true): void {\r\n        if (this._destroyed)\r\n            return;\r\n        super.destroy(destroyChild);\r\n        this._meshFilter.destroy();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Node {\r\n        return new Sprite3D();\r\n    }\r\n\r\n}\r\n\r\n","import { Texture2D } from \"../../../resource/Texture2D\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\n\r\n/**\r\n * <code>SkyPanoramicMaterial</code> SkyPanoramicMaterial\r\n */\r\nexport class SkyPanoramicMaterial extends Material {\r\n    static TINTCOLOR: number;\r\n    static EXPOSURE: number;\r\n    static ROTATION: number;\r\n    static TEXTURE: number;\r\n    static TEXTURE_HDR_PARAMS: number;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n\r\n        SkyPanoramicMaterial.TINTCOLOR = Shader3D.propertyNameToID(\"u_TintColor\");\r\n        SkyPanoramicMaterial.EXPOSURE = Shader3D.propertyNameToID(\"u_Exposure\");\r\n        SkyPanoramicMaterial.ROTATION = Shader3D.propertyNameToID(\"u_Rotation\");\r\n        SkyPanoramicMaterial.TEXTURE = Shader3D.propertyNameToID(\"u_Texture\");\r\n        SkyPanoramicMaterial.TEXTURE_HDR_PARAMS = Shader3D.propertyNameToID(\"u_Texture_HDR_params\");\r\n    }\r\n    /** @internal */\r\n    private _textureHDRParams: Vector4 = new Vector4(1.0, 0.0, 0.0, 1.0);\r\n\r\n    /**\r\n     * \r\n     */\r\n    get tintColor(): Color {\r\n        return this.getColorByIndex(SkyPanoramicMaterial.TINTCOLOR);\r\n    }\r\n\r\n    set tintColor(value: Color) {\r\n        this.setColorByIndex(SkyPanoramicMaterial.TINTCOLOR, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get exposure(): number {\r\n        return this.getFloatByIndex(SkyPanoramicMaterial.EXPOSURE);\r\n    }\r\n\r\n    set exposure(value: number) {\r\n        this.setFloatByIndex(SkyPanoramicMaterial.EXPOSURE, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get rotation(): number {\r\n        return this.getFloatByIndex(SkyPanoramicMaterial.ROTATION);\r\n    }\r\n\r\n    set rotation(value: number) {\r\n        this.setFloatByIndex(SkyPanoramicMaterial.ROTATION, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get panoramicTexture(): Texture2D {\r\n        return <Texture2D>this.getTextureByIndex(SkyPanoramicMaterial.TEXTURE);\r\n    }\r\n\r\n    set panoramicTexture(value: Texture2D) {\r\n        this.setTextureByIndex(SkyPanoramicMaterial.TEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     *  <code>SkyPanoramicMaterial</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this.setShaderName(\"SkyPanoramic\");\r\n        this.setColorByIndex(SkyPanoramicMaterial.TINTCOLOR, new Color(0.5, 0.5, 0.5, 0.5));\r\n        this.setFloatByIndex(SkyPanoramicMaterial.ROTATION, 0.0);\r\n        this.setVector4ByIndex(SkyPanoramicMaterial.TEXTURE_HDR_PARAMS, this._textureHDRParams);\r\n        this.exposure = 1.3;\r\n    }\r\n}","#define SHADER_NAME BloomVS\r\n\r\nvarying vec2 v_Texcoord0;\r\nvec4 remapPositionZ(vec4 position)\r\n{\r\n    position.z = position.z * 2.0 - position.w;\r\n    return position;\r\n}\r\nvoid main()\r\n{\r\n    gl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\r\n    v_Texcoord0 = a_PositionTexcoord.zw;\r\n    gl_Position = remapPositionZ(gl_Position);\r\n}","\r\nimport BloomVS from \"../../../shader/files/postProcess/Bloom/Bloom.vs\";\r\nimport BloomDownsample13PS from \"../../../shader/files/postProcess/Bloom/BloomDownsample13.fs\";\r\nimport BloomDownsample4PS from \"../../../shader/files/postProcess/Bloom/BloomDownsample4.fs\";\r\nimport BloomPrefilter13PS from \"../../../shader/files/postProcess/Bloom/BloomPrefilter13.fs\";\r\nimport BloomPrefilter4PS from \"../../../shader/files/postProcess/Bloom/BloomPrefilter4.fs\";\r\nimport BloomUpsampleBoxPS from \"../../../shader/files/postProcess/Bloom/BloomUpsampleBox.fs\";\r\nimport BloomUpsampleTentPS from \"../../../shader/files/postProcess/Bloom/BloomUpsampleTent.fs\";\r\nimport CompositePS from \"../../../shader/files/postProcess/Bloom/Composite.fs\";\r\nimport CompositeVS from \"../../../shader/files/postProcess/Bloom/Composite.vs\";\r\nimport SamplingGLSL from \"../../../shader/files/postProcess/Sampling.glsl\";\r\nimport StdLibGLSL from \"../../../shader/files/postProcess/StdLib.glsl\";\r\nimport ColorsGLSL from \"../../../shader/files/postProcess/Colors.glsl\";\r\nimport { FilterMode } from \"../../../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { RenderTargetFormat } from \"../../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType, ShaderData } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Texture2D } from \"../../../../resource/Texture2D\";\r\nimport { PostProcess } from \"../../../component/PostProcess\";\r\nimport { Viewport } from \"../../../math/Viewport\";\r\nimport { CommandBuffer } from \"../command/CommandBuffer\";\r\nimport { PostProcessEffect } from \"../PostProcessEffect\";\r\nimport { PostProcessRenderContext } from \"../PostProcessRenderContext\";\r\nimport { BaseTexture } from \"../../../../resource/BaseTexture\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\nimport { RenderState } from \"../../../../RenderEngine/RenderShader/RenderState\";\r\nimport { SubShader } from \"../../../../RenderEngine/RenderShader/SubShader\";\r\nimport { VertexMesh } from \"../../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\n\r\n/**\r\n * <code>BloomEffect</code> \r\n */\r\nexport class BloomEffect extends PostProcessEffect {\r\n\t/** @internal */\r\n\tstatic SHADERVALUE_MAINTEX: number;\r\n\t/**@internal */\r\n\tstatic SHADERVALUE_AUTOEXPOSURETEX: number;\r\n\t/**@internal */\r\n\tstatic SHADERVALUE_SAMPLESCALE: number;\r\n\t/**@internal */\r\n\tstatic SHADERVALUE_THRESHOLD: number;\r\n\t/**@internal */\r\n\tstatic SHADERVALUE_PARAMS: number;\r\n\t/**@internal */\r\n\tstatic SHADERVALUE_BLOOMTEX: number;\r\n\r\n\t/**@internal */\r\n\tstatic SUBSHADER_PREFILTER13: number = 0;\r\n\t/**@internal */\r\n\tstatic SUBSHADER_PREFILTER4: number = 1;\r\n\t/**@internal */\r\n\tstatic SUBSHADER_DOWNSAMPLE13: number = 2;\r\n\t/**@internal */\r\n\tstatic SUBSHADER_DOWNSAMPLE4: number = 3;\r\n\t/**@internal */\r\n\tstatic SUBSHADER_UPSAMPLETENT: number = 4;\r\n\t/**@internal */\r\n\tstatic SUBSHADER_UPSAMPLEBOX: number = 5;\r\n\r\n\t/**@internal */\r\n\tprivate static MAXPYRAMIDSIZE: number = 16; // Just to make sure we handle 64k screens... Future-proof!\r\n\r\n\t/**\r\n\t * bloom resource init\r\n\t */\r\n\tstatic init() {\r\n\t\tShader3D.addInclude(\"StdLib.glsl\", StdLibGLSL);\r\n\t\tShader3D.addInclude(\"Colors.glsl\", ColorsGLSL);\r\n\t\tShader3D.addInclude(\"Sampling.glsl\", SamplingGLSL);\r\n\t\tvar attributeMap: any = {\r\n\t\t\t'a_PositionTexcoord': [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n\t\t};\r\n\r\n\t\tvar uniformMap: any = {\r\n\t\t\t\"u_MainTex\": ShaderDataType.Texture2D,\r\n\t\t\t\"u_MainTex_TexelSize\": ShaderDataType.Vector4,\r\n\t\t\t\"u_AutoExposureTex\": ShaderDataType.Texture2D,\r\n\t\t\t\"u_Threshold\": ShaderDataType.Vector4,\r\n\t\t\t\"u_Params\": ShaderDataType.Vector4,\r\n\t\t\t\"u_BloomTex\": ShaderDataType.Texture2D,\r\n\t\t\t\"u_SampleScale\": ShaderDataType.Float,\r\n\t\t};\r\n\t\tvar shader = Shader3D.add(\"PostProcessBloom\");\r\n\t\t//subShader0\r\n\t\tvar subShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tvar shaderPass = subShader.addShaderPass(BloomVS, BloomPrefilter13PS);\r\n\t\tvar renderState: RenderState = shaderPass.renderState;\r\n\t\trenderState = shaderPass.renderState;\r\n\t\trenderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\trenderState.depthWrite = false;\r\n\t\trenderState.cull = RenderState.CULL_NONE;\r\n\t\trenderState.blend = RenderState.BLEND_DISABLE;\r\n\t\t//subShader1\r\n\t\tsubShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tshaderPass = subShader.addShaderPass(BloomVS, BloomPrefilter4PS);\r\n\t\trenderState = shaderPass.renderState;\r\n\t\trenderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\trenderState.depthWrite = false;\r\n\t\trenderState.cull = RenderState.CULL_NONE;\r\n\t\trenderState.blend = RenderState.BLEND_DISABLE;\r\n\t\t//subShader2\r\n\t\tsubShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tshaderPass = subShader.addShaderPass(BloomVS, BloomDownsample13PS);\r\n\t\trenderState = shaderPass.renderState;\r\n\t\trenderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\trenderState.depthWrite = false;\r\n\t\trenderState.cull = RenderState.CULL_NONE;\r\n\t\trenderState.blend = RenderState.BLEND_DISABLE;\r\n\t\t//subShader3\r\n\t\tsubShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tshaderPass = subShader.addShaderPass(BloomVS, BloomDownsample4PS);\r\n\t\trenderState = shaderPass.renderState;\r\n\t\trenderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\trenderState.depthWrite = false;\r\n\t\trenderState.cull = RenderState.CULL_NONE;\r\n\t\trenderState.blend = RenderState.BLEND_DISABLE;\r\n\t\t//subShader4\r\n\t\tsubShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tshaderPass = subShader.addShaderPass(BloomVS, BloomUpsampleTentPS);\r\n\t\trenderState = shaderPass.renderState;\r\n\t\trenderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\trenderState.depthWrite = false;\r\n\t\trenderState.cull = RenderState.CULL_NONE;\r\n\t\trenderState.blend = RenderState.BLEND_DISABLE;\r\n\t\t//subShader5\r\n\t\tsubShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tshaderPass = subShader.addShaderPass(BloomVS, BloomUpsampleBoxPS);\r\n\t\trenderState = shaderPass.renderState;\r\n\t\trenderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\trenderState.depthWrite = false;\r\n\t\trenderState.cull = RenderState.CULL_NONE;\r\n\t\trenderState.blend = RenderState.BLEND_DISABLE;\r\n\t\tBloomEffect.CompositeInit();\r\n\t\tBloomEffect.__initDefine__();\r\n\t}\r\n\r\n\tstatic CompositeInit() {\r\n\t\t//PostProcessComposite\r\n\t\tlet attributeMap: any = {\r\n\t\t\t'a_PositionTexcoord': [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4],\r\n\t\t};\r\n\t\tlet uniformMap = {\r\n\t\t\t'u_MainTex': ShaderDataType.Texture2D,\r\n\t\t\t'u_BloomTex': ShaderDataType.Texture2D,\r\n\t\t\t'u_AutoExposureTex': ShaderDataType.Texture2D,\r\n\t\t\t'u_Bloom_DirtTex': ShaderDataType.Texture2D,\r\n\t\t\t'u_BloomTex_TexelSize': ShaderDataType.Vector4,\r\n\t\t\t'u_Bloom_DirtTileOffset': ShaderDataType.Vector4,\r\n\t\t\t'u_Bloom_Settings': ShaderDataType.Vector3,\r\n\t\t\t'u_Bloom_Color': ShaderDataType.Vector3,\r\n\t\t};\r\n\t\tlet shader = Shader3D.add(\"PostProcessComposite\");\r\n\r\n\t\tlet subShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tlet shaderPass = subShader.addShaderPass(CompositeVS, CompositePS);\r\n\t\tlet renderState = shaderPass.renderState;\r\n\t\trenderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\trenderState.depthWrite = false;\r\n\t\trenderState.cull = RenderState.CULL_NONE;\r\n\t\trenderState.blend = RenderState.BLEND_DISABLE;\r\n\t}\r\n\r\n\tstatic __initDefine__() {\r\n\t\tBloomEffect.SHADERVALUE_MAINTEX = Shader3D.propertyNameToID(\"u_MainTex\");\r\n\t\tBloomEffect.SHADERVALUE_AUTOEXPOSURETEX = Shader3D.propertyNameToID(\"u_AutoExposureTex\");\r\n\t\tBloomEffect.SHADERVALUE_SAMPLESCALE = Shader3D.propertyNameToID(\"u_SampleScale\");\r\n\t\tBloomEffect.SHADERVALUE_THRESHOLD = Shader3D.propertyNameToID(\"u_Threshold\");\r\n\t\tBloomEffect.SHADERVALUE_PARAMS = Shader3D.propertyNameToID(\"u_Params\");\r\n\t\tBloomEffect.SHADERVALUE_BLOOMTEX = Shader3D.propertyNameToID(\"u_BloomTex\");\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _shader: Shader3D = null;\r\n\t/**@internal */\r\n\tprivate _shaderData: ShaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n\t/**@internal */\r\n\tprivate _linearColor: Color = new Color();\r\n\t/**@internal */\r\n\tprivate _bloomTextureTexelSize: Vector4 = new Vector4();\r\n\r\n\t/**@internal */\r\n\tprivate _shaderThreshold: Vector4 = new Vector4();\r\n\t/**@internal */\r\n\tprivate _shaderParams: Vector4 = new Vector4();\r\n\t/**@internal */\r\n\tprivate _pyramid: any[] = null;\r\n\t/**@internal */\r\n\tprivate _intensity: number = 0.0;\r\n\t/**@internal */\r\n\tprivate _threshold: number = 1.0;\r\n\t/**@internal */\r\n\tprivate _softKnee: number = 0.5;\r\n\t/**@internal */\r\n\tprivate _diffusion: number = 7.0;\r\n\t/**@internal */\r\n\tprivate _anamorphicRatio: number = 0.0;\r\n\t/**@internal */\r\n\tprivate _dirtIntensity: number = 0.0;\r\n\t/**@internal */\r\n\tprivate _shaderSetting: Vector4 = new Vector4();\r\n\t/**@internal */\r\n\tprivate _dirtTileOffset: Vector4 = new Vector4();\r\n\r\n\t/**@internal*/\r\n\tprivate _clamp: number;\r\n\r\n\t/***/\r\n\tprivate _color: Color;\r\n\r\n\t/***/\r\n\tprivate _fastMode: boolean = false;\r\n\r\n\t/**,*/\r\n\tprivate _dirtTexture: BaseTexture = null;\r\n\r\n\t/**\r\n\t * ,\r\n\t */\r\n\tget clamp(): number {\r\n\t\treturn this._clamp;\r\n\t}\r\n\r\n\tset clamp(value: number) {\r\n\t\tthis._clamp = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget color(): Color {\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\tset color(value: Color) {\r\n\t\tthis._color = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget fastMode(): boolean {\r\n\t\treturn this._fastMode;\r\n\t}\r\n\r\n\tset fastMode(value: boolean) {\r\n\t\tthis._fastMode = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget dirtTexture() {\r\n\t\treturn this._dirtTexture;\r\n\t}\r\n\r\n\tset dirtTexture(value: BaseTexture) {\r\n\t\tthis._dirtTexture && this._dirtTexture._removeReference(1);\r\n\t\tthis._dirtTexture = value;\r\n\t\tthis._dirtTexture && this._dirtTexture._addReference(1);\r\n\t}\r\n\r\n\t/**\r\n\t * ,0\r\n\t * @return \r\n\t */\r\n\tget intensity(): number {\r\n\t\treturn this._intensity;\r\n\t}\r\n\r\n\t/**\r\n\t * ,0\r\n\t * @param value \r\n\t */\r\n\tset intensity(value: number) {\r\n\t\tthis._intensity = Math.max(value, 0.0);\r\n\t}\r\n\r\n\t/**\r\n\t * ,,\r\n\t * @return \r\n\t */\r\n\tget threshold(): number {\r\n\t\treturn this._threshold;\r\n\t}\r\n\r\n\t/**\r\n\t * ,,\r\n\t * @param value \r\n\t */\r\n\tset threshold(value: number) {\r\n\t\tthis._threshold = Math.max(value, 0.0);\r\n\t}\r\n\r\n\t/**\r\n\t * ,(0,1)\r\n\t * @return \r\n\t */\r\n\tget softKnee(): number {\r\n\t\treturn this._softKnee;\r\n\t}\r\n\r\n\t/**\r\n\t * ,(0,1)\r\n\t * @param value \r\n\t */\r\n\tset softKnee(value: number) {\r\n\t\tthis._softKnee = Math.min(Math.max(value, 0.0), 1.0);\r\n\t}\r\n\r\n\t/**\r\n\t * ,,,,110\r\n\t * @return \r\n\t */\r\n\tget diffusion(): number {\r\n\t\treturn this._diffusion;\r\n\t}\r\n\r\n\t/**\r\n\t * ,,,,110\r\n\t * @param value \r\n\t */\r\n\tset diffusion(value: number) {\r\n\t\tthis._diffusion = Math.min(Math.max(value, 1), 10);\r\n\t}\r\n\r\n\t/**\r\n\t * ,,,-1 - 1\r\n\t * @return \r\n\t */\r\n\tget anamorphicRatio(): number {\r\n\t\treturn this._anamorphicRatio;\r\n\t}\r\n\r\n\t/**\r\n\t * ,,,-1 - 1\r\n\t * @param value \r\n\t */\r\n\tset anamorphicRatio(value: number) {\r\n\t\tthis._anamorphicRatio = Math.min(Math.max(value, -1.0), 1.0);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget dirtIntensity(): number {\r\n\t\treturn this._dirtIntensity;\r\n\t}\r\n\r\n\t/**\r\n\t * 0-1\r\n\t * @param value \r\n\t */\r\n\tset dirtIntensity(value: number) {\r\n\t\tthis._dirtIntensity = Math.max(value, 0.0);\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>BloomEffect</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.singleton = true;\r\n\t\tthis.active = true;\r\n\t\tthis.intensity = 1.0;\r\n\t\tthis.threshold = 1.0;\r\n\t\tthis.softKnee = 0.5;\r\n\t\tthis.clamp = 65472;\r\n\t\tthis.diffusion = 7;\r\n\t\tthis.anamorphicRatio = 0;\r\n\t\tthis.color = new Color(1.0, 1.0, 1.0, 1.0);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * ,\r\n\t */\r\n\teffectInit(postprocess: PostProcess) {\r\n\t\tsuper.effectInit(postprocess);\r\n\t\tthis._shader = Shader3D.find(\"PostProcessBloom\");\r\n\t\tthis._pyramid = new Array(BloomEffect.MAXPYRAMIDSIZE * 2);\r\n\t}\r\n\r\n\t/**\r\n\t * cameraDepthTextureMode\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @returns \r\n\t */\r\n\tgetCameraDepthTextureModeFlag() {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Effect\r\n\t */\r\n\trelease(postprocess: PostProcess) {\r\n\t\tsuper.release(postprocess);\r\n\t\tthis._shader = null;\r\n\t\tthis._pyramid = [];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\trender(context: PostProcessRenderContext): void {\r\n\t\tvar cmd: CommandBuffer = context.command;\r\n\t\tvar viewport: Viewport = context.camera.viewport;\r\n\r\n\t\t//\r\n\t\tthis._shaderData.setTexture(BloomEffect.SHADERVALUE_AUTOEXPOSURETEX, Texture2D.whiteTexture);\r\n\r\n\t\t//\r\n\t\tvar ratio: number = this._anamorphicRatio;\r\n\t\tvar rw: number = ratio < 0 ? -ratio : 0;\r\n\t\tvar rh: number = ratio > 0 ? ratio : 0;\r\n\r\n\t\t//,\r\n\t\tvar tw: number = Math.floor(viewport.width / (2 - rw));\r\n\t\tvar th: number = Math.floor(viewport.height / (2 - rh));\r\n\r\n\t\t//\r\n\t\tvar s: number = Math.max(tw, th);\r\n\t\tvar logs: number;\r\n\t\tlogs = Math.log2(s) + this._diffusion - 10;\r\n\t\tvar logsInt: number = Math.floor(logs);\r\n\t\tvar iterations: number = Math.min(Math.max(logsInt, 1), BloomEffect.MAXPYRAMIDSIZE);\r\n\t\tvar sampleScale: number = 0.5 + logs - logsInt;\r\n\t\tthis._shaderData.setNumber(BloomEffect.SHADERVALUE_SAMPLESCALE, sampleScale);\r\n\r\n\t\t//\r\n\t\tvar lthresh: number = Color.gammaToLinearSpace(this.threshold);\r\n\t\tvar knee: number = lthresh * this._softKnee + 1e-5;\r\n\t\tthis._shaderThreshold.setValue(lthresh, lthresh - knee, knee * 2, 0.25 / knee);\r\n\t\tthis._shaderData.setVector(BloomEffect.SHADERVALUE_THRESHOLD, this._shaderThreshold);\r\n\t\tvar lclamp: number = Color.gammaToLinearSpace(this.clamp);\r\n\r\n\t\tthis._shaderParams.setValue(lclamp, 0, 0, 0);\r\n\t\tthis._shaderData.setVector(BloomEffect.SHADERVALUE_PARAMS, this._shaderParams);\r\n\r\n\t\tvar qualityOffset: number = this.fastMode ? 1 : 0;\r\n\r\n\t\t// Downsample\r\n\t\tvar lastDownTexture: RenderTexture = context.indirectTarget;\r\n\t\tfor (var i: number = 0; i < iterations; i++) {\r\n\t\t\tvar downIndex: number = i * 2;\r\n\t\t\tvar upIndex: number = downIndex + 1;\r\n\t\t\tvar subShader: number = i == 0 ? BloomEffect.SUBSHADER_PREFILTER13 + qualityOffset : BloomEffect.SUBSHADER_DOWNSAMPLE13 + qualityOffset;\r\n\r\n\t\t\tvar mipDownTexture: RenderTexture = RenderTexture.createFromPool(tw, th, RenderTargetFormat.R8G8B8A8, RenderTargetFormat.None, false, 1, false, true);\r\n\t\t\tmipDownTexture.filterMode = FilterMode.Bilinear;\r\n\t\t\tthis._pyramid[downIndex] = mipDownTexture;\r\n\r\n\t\t\tif (i !== iterations - 1) {\r\n\t\t\t\tvar mipUpTexture: RenderTexture = RenderTexture.createFromPool(tw, th, RenderTargetFormat.R8G8B8A8, RenderTargetFormat.None, false, 1, false, true);\r\n\t\t\t\tmipUpTexture.filterMode = FilterMode.Bilinear;\r\n\t\t\t\tthis._pyramid[upIndex] = mipUpTexture;\r\n\t\t\t}\r\n\r\n\t\t\tcmd.blitScreenTriangle(lastDownTexture, mipDownTexture, null, this._shader, this._shaderData, subShader);\r\n\r\n\t\t\tlastDownTexture = mipDownTexture;\r\n\t\t\ttw = Math.max(Math.floor(tw / 2), 1);\r\n\t\t\tth = Math.max(Math.floor(th / 2), 1);\r\n\t\t}\r\n\t\t// Upsample\r\n\t\tvar lastUpTexture: RenderTexture = this._pyramid[(iterations - 1) * 2];//down\r\n\t\tfor (i = iterations - 2; i >= 0; i--) {\r\n\t\t\tdownIndex = i * 2;\r\n\t\t\tupIndex = downIndex + 1;\r\n\t\t\tmipDownTexture = this._pyramid[downIndex];\r\n\t\t\tmipUpTexture = this._pyramid[upIndex];\r\n\t\t\tcmd.setShaderDataTexture(this._shaderData, BloomEffect.SHADERVALUE_BLOOMTEX, mipDownTexture);//\r\n\t\t\tcmd.blitScreenTriangle(lastUpTexture, mipUpTexture, null, this._shader, this._shaderData, BloomEffect.SUBSHADER_UPSAMPLETENT + qualityOffset);\r\n\t\t\tlastUpTexture = mipUpTexture;\r\n\t\t}\r\n\r\n\t\tvar linearColor: Color = this._linearColor;\r\n\t\tthis.color.toLinear(linearColor);\r\n\t\tvar intensity: number = Math.pow(2, this._intensity / 10.0) - 1.0;\r\n\t\tvar shaderSettings: Vector4 = this._shaderSetting;\r\n\t\tthis._shaderSetting.setValue(sampleScale, intensity, this._dirtIntensity, iterations);\r\n\r\n\t\t//\r\n\t\t//\r\n\t\tvar usedirtTexture = this._dirtTexture ? this._dirtTexture : Texture2D.blackTexture;\r\n\r\n\t\tvar dirtRatio: number = usedirtTexture.width / usedirtTexture.height;\r\n\t\tvar screenRatio: number = viewport.width / viewport.height;\r\n\t\tvar dirtTileOffset: Vector4 = this._dirtTileOffset;\r\n\t\tif (dirtRatio > screenRatio)\r\n\t\t\tdirtTileOffset.setValue(screenRatio / dirtRatio, 1.0, (1.0 - dirtTileOffset.x) * 0.5, 0.0);\r\n\t\telse if (dirtRatio < screenRatio)\r\n\t\t\tdirtTileOffset.setValue(1.0, dirtRatio / screenRatio, 0.0, (1.0 - dirtTileOffset.y) * 0.5);\r\n\r\n\t\t//Shader\r\n\t\tvar compositeShaderData: ShaderData = context.compositeShaderData;\r\n\t\tif (this.fastMode)\r\n\t\t\tcompositeShaderData.addDefine(PostProcess.SHADERDEFINE_BLOOM_LOW);\r\n\t\telse\r\n\t\t\tcompositeShaderData.addDefine(PostProcess.SHADERDEFINE_BLOOM);\r\n\r\n\t\tthis._bloomTextureTexelSize.setValue(1.0 / lastUpTexture.width, 1.0 / lastUpTexture.height, lastUpTexture.width, lastUpTexture.height);\r\n\r\n\t\tcompositeShaderData.setVector(PostProcess.SHADERVALUE_BLOOM_DIRTTILEOFFSET, dirtTileOffset);\r\n\t\tcompositeShaderData.setVector(PostProcess.SHADERVALUE_BLOOM_SETTINGS, shaderSettings);\r\n\t\tcompositeShaderData.setVector(PostProcess.SHADERVALUE_BLOOM_COLOR, new Vector4(linearColor.r, linearColor.g, linearColor.b, linearColor.a));//TODO:Color\r\n\t\tcompositeShaderData.setTexture(PostProcess.SHADERVALUE_BLOOM_DIRTTEX, usedirtTexture);\r\n\t\tcompositeShaderData.setTexture(PostProcess.SHADERVALUE_BLOOMTEX, lastUpTexture);\r\n\t\tcompositeShaderData.setVector(PostProcess.SHADERVALUE_BLOOMTEX_TEXELSIZE, this._bloomTextureTexelSize);\r\n\r\n\t\tlet _compositeShader: Shader3D = Shader3D.find(\"PostProcessComposite\");\r\n\r\n\t\tcmd.blitScreenTriangle(context.indirectTarget, context.destination, context.camera._screenOffsetScale, _compositeShader, compositeShaderData, 0);\r\n\r\n\r\n\t\t//\r\n\t\tfor (i = 0; i < iterations; i++) {\r\n\t\t\tdownIndex = i * 2;\r\n\t\t\tupIndex = downIndex + 1;\r\n\t\t\tRenderTexture.recoverToPool(this._pyramid[downIndex]);\r\n\t\t\t(i !== 0 && i !== iterations - 1) && (RenderTexture.recoverToPool(this._pyramid[upIndex]));//i==0lastUpTexture,,i==iterations - 1,\r\n\t\t}\r\n\r\n\t\tcontext.deferredReleaseTextures.push(lastUpTexture);//TODO:\r\n\t}\r\n\r\n}\r\n\r\n\r\n","#define HALF_MAX       65504.0 // (2 - 2^-10) * 2^15\r\n\r\n#define FLT_EPSILON    1.192092896e-07 // Smallest positive number, such that 1.0 + FLT_EPSILON != 1.0\r\n\r\nmediump vec4 safeHDR(mediump vec4 c)\r\n{\r\n    return min(c, HALF_MAX);\r\n}\r\n\r\nfloat max3(float a, float b, float c)\r\n{\r\n    return max(max(a, b), c);\r\n}\r\n\r\nvec3 positivePow(vec3 base, vec3 power)\r\n{\r\n    return pow(max(abs(base), vec3(FLT_EPSILON, FLT_EPSILON, FLT_EPSILON)), power);\r\n}","#include \"StdLib.glsl\";\r\n\r\n#define EPSILON 1.0e-4\r\n\r\n// Quadratic color thresholding\r\n// curve = (threshold - knee, knee * 2, 0.25 / knee)\r\nmediump vec4 quadraticThreshold(mediump vec4 color, mediump float threshold, mediump vec3 curve) {\r\n\t// Pixel brightness\r\n\tmediump float br = max3(color.r, color.g, color.b);\r\n\r\n\t// Under-threshold part: quadratic curve\r\n\tmediump float rq = clamp(br - curve.x, 0.0, curve.y);\r\n\trq = curve.z * rq * rq;\r\n\r\n\t// Combine and apply the brightness response curve.\r\n\tcolor *= max(rq, br - threshold) / max(br, EPSILON);\r\n\r\n\treturn color;\r\n}\r\n\r\n\r\n\r\n//\r\n// sRGB transfer functions\r\n// Fast path ref: http://chilliant.blogspot.com.au/2012/08/srgb-approximations-for-hlsl.html?m=1\r\n//\r\n// mediump vec3 sRGBToLinear(mediump vec3 c) {\r\n// \t#ifdef USE_VERY_FAST_SRGB\r\n// \t\treturn c * c;\r\n// \t#elif defined(USE_FAST_SRGB)\r\n// \t\treturn c * (c * (c * 0.305306011 + 0.682171111) + 0.012522878);\r\n// \t#else\r\n// \t\tmediump vec3 linearRGBLo = c / 12.92;\r\n// \t\tmediump vec3 power=vec3(2.4, 2.4, 2.4);\r\n// \t\tmediump vec3 linearRGBHi = positivePow((c + 0.055) / 1.055, power);\r\n// \t\tmediump vec3 linearRGB =vec3((c.r<=0.04045) ? linearRGBLo.r : linearRGBHi.r,(c.g<=0.04045) ? linearRGBLo.g : linearRGBHi.g,(c.b<=0.04045) ? linearRGBLo.b : linearRGBHi.b);\r\n// \t\treturn linearRGB;\r\n// \t#endif\r\n// }\r\n\r\n// mediump vec4 sRGBToLinear(mediump vec4 c){\r\n//     return vec4(sRGBToLinear(c.rgb), c.a);\r\n// }\r\n\r\n\r\n\r\n// mediump vec3 linearToSRGB(mediump vec3 c) {\r\n// \t#ifdef USE_VERY_FAST_SRGB\r\n// \t\treturn sqrt(c);\r\n// \t#elif defined(USE_FAST_SRGB)\r\n// \t\treturn max(1.055 * PositivePow(c, 0.416666667) - 0.055, 0.0);\r\n// \t#else\r\n// \t\tmediump vec3 sRGBLo = c * 12.92;\r\n// \t\tmediump vec3 power=vec3(1.0 / 2.4, 1.0 / 2.4, 1.0 / 2.4);\r\n// \t\tmediump vec3 sRGBHi = (positivePow(c, power) * 1.055) - 0.055;\r\n// \t\tmediump vec3 sRGB =vec3((c.r<=0.0031308) ? sRGBLo.r : sRGBHi.r,(c.g<=0.0031308) ? sRGBLo.g : sRGBHi.g,(c.b<=0.0031308) ? sRGBLo.b : sRGBHi.b);\r\n// \t\treturn sRGB;\r\n// \t#endif\r\n// }\r\n\r\n// mediump vec4 linearToSRGB(mediump vec4 c){\r\n//     return vec4(linearToSRGB(c.rgb), c.a);\r\n// }","\r\n// todo only sampler u_MainTex\r\nvec4 samplerTex(sampler2D tex, vec2 uv)\r\n{\r\n    vec4 mainSampler = texture2D(tex, uv);\r\n#ifdef Gamma_u_MainTex\r\n    mainSampler = gammaToLinear(mainSampler);\r\n#endif // Gamma_u_MainTex\r\n\r\n    return mainSampler;\r\n}\r\n\r\n// Better, temporally stable box filtering\r\n// [Jimenez14] http://goo.gl/eomGso\r\n// . . . . . . .\r\n// . A . B . C .\r\n// . . D . E . .\r\n// . F . G . H .\r\n// . . I . J . .\r\n// . K . L . M .\r\n// . . . . . . .\r\nmediump vec4 downsampleBox13Tap(sampler2D tex, vec2 uv, vec2 texelSize)\r\n{\r\n    mediump vec4 A = samplerTex(tex, uv + texelSize * vec2(-1.0, -1.0));\r\n    mediump vec4 B = samplerTex(tex, uv + texelSize * vec2(0.0, -1.0));\r\n    mediump vec4 C = samplerTex(tex, uv + texelSize * vec2(1.0, -1.0));\r\n    mediump vec4 D = samplerTex(tex, uv + texelSize * vec2(-0.5, -0.5));\r\n    mediump vec4 E = samplerTex(tex, uv + texelSize * vec2(0.5, -0.5));\r\n    mediump vec4 F = samplerTex(tex, uv + texelSize * vec2(-1.0, 0.0));\r\n    mediump vec4 G = samplerTex(tex, uv);\r\n    mediump vec4 H = samplerTex(tex, uv + texelSize * vec2(1.0, 0.0));\r\n    mediump vec4 I = samplerTex(tex, uv + texelSize * vec2(-0.5, 0.5));\r\n    mediump vec4 J = samplerTex(tex, uv + texelSize * vec2(0.5, 0.5));\r\n    mediump vec4 K = samplerTex(tex, uv + texelSize * vec2(-1.0, 1.0));\r\n    mediump vec4 L = samplerTex(tex, uv + texelSize * vec2(0.0, 1.0));\r\n    mediump vec4 M = samplerTex(tex, uv + texelSize * vec2(1.0, 1.0));\r\n\r\n    mediump vec2 scale = vec2(0.5, 0.125);\r\n    mediump vec2 div = (1.0 / 4.0) * scale;\r\n\r\n    mediump vec4 o = (D + E + I + J) * div.x;\r\n    o += (A + B + G + F) * div.y;\r\n    o += (B + C + H + G) * div.y;\r\n    o += (F + G + L + K) * div.y;\r\n    o += (G + H + M + L) * div.y;\r\n\r\n    return o;\r\n}\r\n\r\n// Standard box filtering\r\nmediump vec4 downsampleBox4Tap(sampler2D tex, vec2 uv, vec2 texelSize)\r\n{\r\n    vec4 d = texelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0);\r\n\r\n    mediump vec4 s = samplerTex(tex, uv + d.xy);\r\n    s += samplerTex(tex, uv + d.zy);\r\n    s += samplerTex(tex, uv + d.xw);\r\n    s += samplerTex(tex, uv + d.zw);\r\n\r\n    return s * (1.0 / 4.0);\r\n}\r\n\r\n// 9-tap bilinear upsampler (tent filter)\r\n// . . . . . . .\r\n// . 1 . 2 . 1 .\r\n// . . . . . . .\r\n// . 2 . 4 . 2 .\r\n// . . . . . . .\r\n// . 1 . 2 . 1 .\r\n// . . . . . . .\r\nmediump vec4 upsampleTent(sampler2D tex, vec2 uv, vec2 texelSize, vec4 sampleScale)\r\n{\r\n    vec4 d = texelSize.xyxy * vec4(1.0, 1.0, -1.0, 0.0) * sampleScale;\r\n\r\n    mediump vec4 s = samplerTex(tex, uv - d.xy);\r\n    s += samplerTex(tex, uv - d.wy) * 2.0;\r\n    s += samplerTex(tex, uv - d.zy);\r\n\r\n    s += samplerTex(tex, uv + d.zw) * 2.0;\r\n    s += samplerTex(tex, uv) * 4.0;\r\n    s += samplerTex(tex, uv + d.xw) * 2.0;\r\n\r\n    s += samplerTex(tex, uv + d.zy);\r\n    s += samplerTex(tex, uv + d.wy) * 2.0;\r\n    s += samplerTex(tex, uv + d.xy);\r\n\r\n    return s * (1.0 / 16.0);\r\n}\r\n\r\n// Standard box filtering\r\nmediump vec4 upsampleBox(sampler2D tex, vec2 uv, vec2 texelSize, vec4 sampleScale)\r\n{\r\n    vec4 d = texelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0) * 0.5 * sampleScale;\r\n\r\n    mediump vec4 s = samplerTex(tex, uv + d.xy);\r\n    s += samplerTex(tex, uv + d.zy);\r\n    s += samplerTex(tex, uv + d.xw);\r\n    s += samplerTex(tex, uv + d.zw);\r\n\r\n    return s * (1.0 / 4.0);\r\n}","#define SHADER_NAME BloomPreFilter13FS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Colors.glsl\";\r\n#include \"Sampling.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nmediump vec4 prefilter(mediump vec4 color, vec2 uv)\r\n{\r\n    vec4 autoExposureSampler = texture2D(u_AutoExposureTex, uv);\r\n#ifdef Gamma_u_AutoExposureTex\r\n    autoExposureSampler = gammaToLinear(autoExposureSampler);\r\n#endif // Gamma_u_AutoExposureTex\r\n\r\n    mediump float autoExposure = autoExposureSampler.r;\r\n    color *= autoExposure;\r\n    color = min(vec4(u_Params.x), color); // clamp to max\r\n    color = quadraticThreshold(color, u_Threshold.x, u_Threshold.yzw);\r\n    return color;\r\n}\r\n\r\nvoid fragPrefilter13()\r\n{\r\n    mediump vec4 color = downsampleBox13Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\r\n    gl_FragColor = prefilter(safeHDR(color), v_Texcoord0);\r\n}\r\n\r\nvoid main()\r\n{\r\n    fragPrefilter13();\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME BloomPreFilter4FS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Colors.glsl\";\r\n#include \"Sampling.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nmediump vec4 prefilter(mediump vec4 color, vec2 uv)\r\n{\r\n    vec4 autoExposureSampler = texture2D(u_AutoExposureTex, uv);\r\n#ifdef Gamma_u_AutoExposureTex\r\n    autoExposureSampler = gammaToLinear(autoExposureSampler);\r\n#endif // Gamma_u_AutoExposureTex\r\n\r\n    mediump float autoExposure = autoExposureSampler.r;\r\n    color *= autoExposure;\r\n    color = min(vec4(u_Params.x), color); // clamp to max\r\n    color = quadraticThreshold(color, u_Threshold.x, u_Threshold.yzw);\r\n    return color;\r\n}\r\n\r\nvoid fragPrefilter4()\r\n{\r\n    mediump vec4 color = downsampleBox4Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\r\n    gl_FragColor = prefilter(safeHDR(color), v_Texcoord0);\r\n}\r\n\r\nvoid main()\r\n{\r\n    fragPrefilter4();\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME BloomDownSample13FS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Colors.glsl\";\r\n#include \"Sampling.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid fragDownsample13()\r\n{\r\n    mediump vec4 color = downsampleBox13Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\r\n    gl_FragColor = color;\r\n}\r\n\r\nvoid main()\r\n{\r\n    fragDownsample13();\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME BloomDownSample4FS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Colors.glsl\";\r\n#include \"Sampling.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid fragDownsample4()\r\n{\r\n    mediump vec4 color = downsampleBox4Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\r\n    gl_FragColor = color;\r\n}\r\n\r\nvoid main()\r\n{\r\n    fragDownsample4();\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME BloomUpSampleTentFS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Colors.glsl\";\r\n#include \"Sampling.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nmediump vec4 combine(mediump vec4 bloom, vec2 uv)\r\n{\r\n    mediump vec4 color = texture2D(u_BloomTex, uv);\r\n#ifdef Gamma_u_BloomTex\r\n    color = gammaToLinear(color);\r\n#endif // Gamma_u_BloomTex\r\n    return bloom + color;\r\n}\r\n\r\nvoid fragUpsampleTent()\r\n{\r\n    mediump vec4 bloom = upsampleTent(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy, vec4(u_SampleScale));\r\n    gl_FragColor = combine(bloom, v_Texcoord0);\r\n}\r\n\r\nvoid main()\r\n{\r\n    fragUpsampleTent();\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME BloomUpSampleBoxFS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Colors.glsl\";\r\n#include \"Sampling.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nmediump vec4 combine(mediump vec4 bloom, vec2 uv)\r\n{\r\n    mediump vec4 color = texture2D(u_BloomTex, uv);\r\n#ifdef Gamma_u_BloomTex\r\n    color = gammaToLinear(color);\r\n#endif // Gamma_u_BloomTex\r\n    return bloom + color;\r\n}\r\n\r\nvoid fragUpsampleBox()\r\n{\r\n    mediump vec4 bloom = upsampleBox(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy, vec4(u_SampleScale));\r\n    gl_FragColor = combine(bloom, v_Texcoord0);\r\n}\r\n\r\nvoid main()\r\n{\r\n    fragUpsampleBox();\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME CompositeVS\r\nvarying vec2 v_Texcoord0;\r\nvec4 remapPositionZ(vec4 position)\r\n{\r\n    position.z = position.z * 2.0 - position.w;\r\n    return position;\r\n}\r\nvoid main() {\r\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\r\n\tv_Texcoord0 = a_PositionTexcoord.zw;\r\n\tgl_Position = remapPositionZ(gl_Position);\r\n}","#define SHADER_NAME CompositeFS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Colors.glsl\";\r\n#include \"Sampling.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main()\r\n{\r\n    vec4 autoExposureSampler = texture2D(u_AutoExposureTex, v_Texcoord0);\r\n#ifdef Gamma_u_AutoExposureTex\r\n    autoExposureSampler = gammaToLinear(autoExposureSampler);\r\n#endif // Gamma_u_AutoExposureTex\r\n    mediump float autoExposure = autoExposureSampler.r;\r\n\r\n    mediump vec4 color = vec4(0.0);\r\n    color = texture2D(u_MainTex, v_Texcoord0);\r\n#ifdef Gamma_u_MainTex\r\n    color = gammaToLinear(color);\r\n#endif // Gamma_u_MainTex\r\n\r\n    color.rgb *= autoExposure;\r\n\r\n#if defined(BLOOM) || defined(BLOOM_LOW)\r\n    #ifdef BLOOM\r\n    mediump vec4 bloom = upsampleTent(u_BloomTex, v_Texcoord0, u_BloomTex_TexelSize.xy, vec4(u_Bloom_Settings.x));\r\n    #else\r\n    mediump vec4 bloom = upsampleBox(u_BloomTex, v_Texcoord0, u_BloomTex_TexelSize.xy, vec4(u_Bloom_Settings.x));\r\n    #endif\r\n\r\n    // UVs should be Distort(uv * u_Bloom_DirtTileOffset.xy + u_Bloom_DirtTileOffset.zw)\r\n    // but considering we use a cover-style scale on the dirt texture the difference\r\n    // isn't massive so we chose to save a few ALUs here instead in case lens distortion\r\n    // is active\r\n    mediump vec4 dirt = vec4(texture2D(u_Bloom_DirtTex, v_Texcoord0 * u_Bloom_DirtTileOffset.xy + u_Bloom_DirtTileOffset.zw).rgb, 0.0);\r\n    #ifdef Gamma_u_Bloom_DirtTex\r\n    dirt = gammaToLinear(dirt);\r\n    #endif // Gamma_u_Bloom_DirtTex\r\n\r\n    // Additive bloom (artist friendly)\r\n    bloom *= u_Bloom_Settings.y;\r\n    dirt *= u_Bloom_Settings.z;\r\n    mediump vec4 bloomColor = vec4(u_Bloom_Color, 1.0);\r\n    color += bloom * bloomColor;\r\n    color += dirt * bloom;\r\n#endif\r\n\r\n    mediump vec4 finalColor = color;\r\n    // finalColor = linearToSRGB(finalColor);\r\n    // finalColor.rgb = Dither(finalColor.rgb, v_Texcoord0);//TODO:\r\n    gl_FragColor = finalColor;\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME OcclusionEstimationFS\r\n\r\n#include \"DepthNormalUtil.glsl\";\r\n\r\n#include \"AmbientOcclusion.glsl\";\r\n\r\n#define FIX_SAMPLING_PATTERN\r\n\r\n// Check if the camera is perspective.\r\n// (returns 1.0 when orthographic)\r\nfloat CheckPerspective(float x)\r\n{\r\n    // todo ortho\r\n    return mix(x, 1.0, 0.0);\r\n}\r\n\r\nvec3 ReconstructViewPos(vec2 uv, float depth, vec2 p11_22, vec2 p13_31)\r\n{\r\n    return vec3((uv * 2.0 - 1.0 - p13_31) / p11_22 * CheckPerspective(depth), depth);\r\n}\r\n\r\n// Pseudo random number generator with 2D coordinates\r\n// https://stackoverflow.com/questions/12964279/whats-the-origin-of-this-glsl-rand-one-liner\r\nfloat UVRandom(float u, float v)\r\n{\r\n    float f = dot(vec2(12.9898, 78.233), vec2(u, v));\r\n    return fract(43758.5453 * sin(f));\r\n}\r\n\r\nvec2 CosSin(float theta)\r\n{\r\n    // float sn, cs;\r\n    // sincos(theta, sn, cs);\r\n    float sn = sin(theta);\r\n    float cs = cos(theta);\r\n    return vec2(cs, sn);\r\n}\r\n\r\nfloat GradientNoise(vec2 uv)\r\n{\r\n    uv = floor(uv * u_MainTex_TexelSize.zw);\r\n    float f = dot(vec2(0.06711056, 0.00583715), uv);\r\n    return fract(52.9829189 * fract(f));\r\n}\r\n\r\n// Sample point picker\r\nvec3 PickSamplePoint(vec2 uv, float index)\r\n{\r\n#if defined(FIX_SAMPLING_PATTERN)\r\n    float gn = GradientNoise(uv * DOWNSAMPLE);\r\n    float u = fract(UVRandom(0.0, index + uv.x * 1e-10) + gn) * 2.0 - 1.0;\r\n    float theta = (UVRandom(1.0, index + uv.x * 1e-10) + gn) * TWO_PI;\r\n#else\r\n    float u = UVRandom(uv.x + u_PlugTime.x, uv.y + index) * 2.0 - 1.0;\r\n    float theta = UVRandom(-uv.x - u_PlugTime.x, uv.y + index) * TWO_PI;\r\n#endif\r\n\r\n    vec3 v = vec3(CosSin(theta) * sqrt(1.0 - u * u), u);\r\n    float l = sqrt((index + 1.0) / float(SAMPLE_COUNT)) * RADIUS;\r\n    return v * l;\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec2 uv = v_Texcoord0;\r\n\r\n    mat3 proj = mat3(u_Projection);\r\n    vec2 p11_22 = vec2(u_Projection[0][0], u_Projection[1][1]);\r\n    vec2 p13_31 = vec2(u_Projection[2][0], u_Projection[2][1]);\r\n\r\n    vec3 norm_o;\r\n    float depth_o = SampleDepthNormal(uv, norm_o);\r\n\r\n    // Reconstruct the view-space position.\r\n    vec3 vpos_o = ReconstructViewPos(uv, depth_o, p11_22, p13_31);\r\n\r\n    float ao = 0.0;\r\n\r\n    for (int s = 0; s < int(SAMPLE_COUNT); s++)\r\n\t{\r\n\t    float s_float = float(s);\r\n\t    vec3 v_s1 = PickSamplePoint(uv, s_float);\r\n\r\n\t    v_s1 = faceforward(v_s1, -norm_o, v_s1);\r\n\t    vec3 vpos_s1 = vpos_o + v_s1;\r\n\r\n\t    // Reproject the sample point\r\n\t    vec3 spos_s1 = proj * vpos_s1;\r\n\t    vec2 uv_s1_01 = (spos_s1.xy / CheckPerspective(vpos_s1.z) + 1.0) * 0.5;\r\n\r\n\t    float depth_s1 = SampleDepth(uv_s1_01);\r\n\r\n\t    vec3 vpos_s2 = ReconstructViewPos(uv_s1_01, depth_s1, p11_22, p13_31);\r\n\t    vec3 v_s2 = vpos_s2 - vpos_o;\r\n\r\n\t    float a1 = max(dot(v_s2, norm_o) - kBeta * depth_o, 0.0);\r\n\t    float a2 = dot(v_s2, v_s2) + EPSILON;\r\n\r\n\t    ao += a1 / a2;\r\n\t}\r\n\r\n    ao *= RADIUS;\r\n\r\n    ao = PositivePow(ao * INTENSITY / float(SAMPLE_COUNT), kContrast);\r\n\r\n    gl_FragColor = PackAONormal(ao, norm_o);\r\n}\r\n\r\n/**\r\n    0.8741,     0,          0,          0,\r\n    0,          1.7320,     0,          0,\r\n    0,          0,          -1.0152,    -1,\r\n    0,          0,          -0.3046,    0\r\n**/","\r\n\r\nimport BlitScreenVS from \"../../../shader/postprocess/BlitScreen.vs\";\r\nimport FragAO from \"../../../shader/files/postProcess/ScalableAO/FragAO.fs\";\r\nimport AoBlurHorizontal from \"../../../shader/files/postProcess/ScalableAO/AoBlurHorizontal.fs\";\r\nimport AOComposition from \"../../../shader/files/postProcess/ScalableAO/AOComposition.fs\";\r\nimport AmbientOcclusion from \"../../../shader/files/postProcess/ScalableAO/AmbientOcclusion.glsl\";\r\nimport { RenderTargetFormat } from \"../../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { WrapMode } from \"../../../../RenderEngine/RenderEnum/WrapMode\";\r\nimport { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType, ShaderData } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { DepthTextureMode } from \"../../../depthMap/DepthPass\";\r\nimport { Viewport } from \"../../../math/Viewport\";\r\nimport { Camera } from \"../../Camera\";\r\nimport { CommandBuffer } from \"../command/CommandBuffer\";\r\nimport { PostProcessEffect } from \"../PostProcessEffect\";\r\nimport { PostProcessRenderContext } from \"../PostProcessRenderContext\";\r\nimport { BaseCamera } from \"../../BaseCamera\";\r\nimport { ShaderDefine } from \"../../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { Vector2 } from \"../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\nimport { SubShader } from \"../../../../RenderEngine/RenderShader/SubShader\";\r\nimport { VertexMesh } from \"../../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\n\r\n/**\r\n * AO\r\n */\r\nexport enum AOQUALITY{\r\n    /** */\r\n    High,\r\n    /** */\r\n    MEDIUM,\r\n    /** */\r\n    LOWEST\r\n}\r\n\r\n/**\r\n * <code>BloomEffect</code> \r\n */\r\nexport class ScalableAO extends PostProcessEffect {\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_AOHigh: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_AOMEDIUM: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_LOWEST: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static BlurDelty: number;\r\n\r\n    /**@internal */\r\n    static AOColor: number;\r\n\r\n    /**@internal */\r\n    static aoTexture: number;\r\n\r\n    /**@internal */\r\n    static AOParams: number;\r\n\r\n    /**@internal */\r\n    static SourceTex: number;\r\n\r\n    /**@internal */\r\n    static deltyHorizontal: Vector2 = new Vector2(1.0, 0.0);\r\n\r\n    /**@internal */\r\n    static deltyVector: Vector2 = new Vector2(0.0, 1.0);\r\n\r\n    /**\r\n     * scaleAO resource init\r\n     */\r\n    static init() {\r\n        ScalableAO.BlurDelty = Shader3D.propertyNameToID(\"u_Delty\");\r\n        ScalableAO.AOColor = Shader3D.propertyNameToID(\"u_AOColor\");\r\n        ScalableAO.aoTexture = Shader3D.propertyNameToID(\"u_compositionAoTexture\");\r\n\r\n        ScalableAO.AOParams = Shader3D.propertyNameToID('u_AOParams');\r\n        ScalableAO.SourceTex = Shader3D.propertyNameToID('u_SourceTex');\r\n        ScalableAO.SHADERDEFINE_AOHigh =Shader3D.getDefineByName(\"AO_High\");\r\n        ScalableAO.SHADERDEFINE_AOMEDIUM =Shader3D.getDefineByName(\"AO_MEDIUM\");\r\n        ScalableAO.SHADERDEFINE_LOWEST =Shader3D.getDefineByName(\"AO_LOWEST\");\r\n        Shader3D.addInclude(\"AmbientOcclusion.glsl\", AmbientOcclusion);\r\n        //scalableAoShader\r\n        let attributeMap: any = {\r\n            'a_PositionTexcoord': [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n        };\r\n        let uniformMap: any = {\r\n            'u_OffsetScale': ShaderDataType.Vector4,\r\n            'u_MainTex': ShaderDataType.Texture2D,\r\n            'u_MainTex_TexelSize': ShaderDataType.Vector4,\r\n            'u_Delty': ShaderDataType.Vector2,\r\n            'u_PlugTime': ShaderDataType.Vector4,\r\n            'u_AOParams': ShaderDataType.Vector4,\r\n            'u_BlurVector': ShaderDataType.Vector2,\r\n            'u_AOColor': ShaderDataType.Color,\r\n            'u_compositionAoTexture': ShaderDataType.Texture2D\r\n\r\n        }\r\n        let shader: Shader3D = Shader3D.add(\"ScalableAO\");\r\n        let subShader: SubShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(subShader);\r\n        subShader.addShaderPass(BlitScreenVS, FragAO);\r\n        //BlurShader\r\n        shader = Shader3D.add(\"AOBlurHorizontal\");\r\n        subShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(subShader);\r\n        subShader.addShaderPass(BlitScreenVS, AoBlurHorizontal);\r\n\r\n        //Composition\r\n        shader = Shader3D.add(\"AOComposition\");\r\n        subShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(subShader);\r\n        subShader.addShaderPass(BlitScreenVS, AOComposition);\r\n    }\r\n\r\n    /*@internal scalable AO shader*/\r\n    private _shader: Shader3D;\r\n\r\n    /**@internal shader data */\r\n    private _shaderData: ShaderData;\r\n\r\n    /*@internal blurHorizontal Ao Shader */\r\n    private _aoBlurHorizontalShader: Shader3D;\r\n\r\n    /**@internal */\r\n    private _aoComposition: Shader3D;\r\n\r\n    /**@internal */\r\n    private _aoParams: Vector3 = new Vector3();\r\n\r\n    private _aoQuality:AOQUALITY = AOQUALITY.MEDIUM;\r\n\r\n    /**\r\n     * AO\r\n     */\r\n    constructor() {\r\n        super();\r\n        this._shader = Shader3D.find(\"ScalableAO\");\r\n        this._shaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n        this._aoParams = new Vector3(0.12, 0.15, 1);\r\n        this._shaderData.setVector3(ScalableAO.AOParams, this._aoParams);\r\n        this._shaderData.setVector(BaseCamera.DEPTHZBUFFERPARAMS, new Vector4());\r\n        this._aoBlurHorizontalShader = Shader3D.find(\"AOBlurHorizontal\");\r\n        this._aoComposition = Shader3D.find(\"AOComposition\");\r\n        this.aoQuality = AOQUALITY.MEDIUM;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * ao Color\r\n     */\r\n    set aoColor(value: Color) {\r\n        this._shaderData.setColor(ScalableAO.AOColor, value);\r\n    }\r\n\r\n    get aoColor() {\r\n        return this._shaderData.getColor(ScalableAO.AOColor);\r\n    }\r\n\r\n    /**\r\n     * ao intensity\r\n     */\r\n    set intensity(value: number) {\r\n        this._aoParams.x = value;\r\n        this._shaderData.setVector3(ScalableAO.AOParams, this._aoParams);\r\n    }\r\n\r\n    get intensity() {\r\n        return this._aoParams.x;\r\n    }\r\n\r\n    /**\r\n     * ao\r\n     */\r\n    set radius(value: number) {\r\n        this._aoParams.y = value;\r\n        this._shaderData.setVector3(ScalableAO.AOParams, this._aoParams);\r\n    }\r\n\r\n    get radius() {\r\n        return this._aoParams.y;\r\n    }\r\n\r\n    /**\r\n     * ao\r\n     */\r\n    get aoQuality(){\r\n        return this._aoQuality;\r\n    }\r\n\r\n    set aoQuality(value:AOQUALITY){\r\n        this._aoQuality = value;\r\n        switch(value){\r\n            case AOQUALITY.High:\r\n                this._shaderData.addDefine(ScalableAO.SHADERDEFINE_AOHigh);\r\n                this._shaderData.removeDefine(ScalableAO.SHADERDEFINE_AOMEDIUM);\r\n                this._shaderData.removeDefine(ScalableAO.SHADERDEFINE_LOWEST);\r\n                break;\r\n            case AOQUALITY.MEDIUM:\r\n                this._shaderData.addDefine(ScalableAO.SHADERDEFINE_AOMEDIUM);\r\n                this._shaderData.removeDefine(ScalableAO.SHADERDEFINE_AOHigh);\r\n                this._shaderData.removeDefine(ScalableAO.SHADERDEFINE_LOWEST);\r\n                break;\r\n            case AOQUALITY.LOWEST:\r\n                this._shaderData.addDefine(ScalableAO.SHADERDEFINE_LOWEST);\r\n                this._shaderData.removeDefine(ScalableAO.SHADERDEFINE_AOHigh);\r\n                this._shaderData.removeDefine(ScalableAO.SHADERDEFINE_AOMEDIUM);\r\n                break;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * @override\r\n     */\r\n    getCameraDepthTextureModeFlag() {\r\n        return DepthTextureMode.DepthAndDepthNormals;\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @param context \r\n     */\r\n    render(context: PostProcessRenderContext): void {\r\n        let cmd: CommandBuffer = context.command;\r\n        let viewport: Viewport = context.camera.viewport;\r\n        let camera: Camera = context.camera;\r\n\r\n        // camera rendermode\r\n        camera.depthTextureMode |= DepthTextureMode.DepthNormals;\r\n        camera.depthTextureMode |= DepthTextureMode.Depth;\r\n\r\n        let depthNormalTexture: RenderTexture = camera.depthNormalTexture;\r\n        let depthTexture = camera.depthTexture;\r\n\r\n        if (!depthNormalTexture || !depthTexture) {\r\n            return;\r\n        }\r\n\r\n        depthNormalTexture.wrapModeU = WrapMode.Clamp;\r\n        depthNormalTexture.wrapModeV = WrapMode.Clamp;\r\n\r\n        let source: RenderTexture = context.source;\r\n        let width = source.width;\r\n        let height = source.height;\r\n        let textureFormat: RenderTargetFormat = source.colorFormat;\r\n        let depthFormat: RenderTargetFormat = RenderTargetFormat.None;\r\n\r\n        let finalTex: RenderTexture = RenderTexture.createFromPool(width, height, textureFormat, depthFormat, false, 1);\r\n\r\n        let shader: Shader3D = this._shader;\r\n        let shaderData: ShaderData = this._shaderData;\r\n        //depthTexture;\r\n        //depthNormalTexture;\r\n        cmd.blitScreenTriangle(null, finalTex, null, shader, shaderData, 0);\r\n        //context.source = finalTex;\r\n        let blurTex: RenderTexture = RenderTexture.createFromPool(width, height, textureFormat, depthFormat, false, 1);\r\n        //blur horizontal\r\n        cmd.blitScreenTriangle(finalTex, blurTex, null, this._aoBlurHorizontalShader, shaderData, 0);\r\n        //blur Vec\r\n        cmd.setShaderDataVector2(shaderData, ScalableAO.BlurDelty, ScalableAO.deltyVector);\r\n        cmd.blitScreenTriangle(blurTex, finalTex, null, this._aoBlurHorizontalShader, this._shaderData, 0);\r\n        //blur Composition\r\n        cmd.setShaderDataTexture(shaderData, ScalableAO.aoTexture, finalTex);\r\n        cmd.blitScreenTriangle(context.source, context.destination, null, this._aoComposition, this._shaderData, 0);\r\n        //context.source = blurTex;\r\n        context.deferredReleaseTextures.push(finalTex);\r\n        context.deferredReleaseTextures.push(blurTex);\r\n    }\r\n\r\n}","#include \"Camera.glsl\";\r\n// const \r\n#define TWO_PI 6.2831852\r\n\r\n#define EPSILON         1.0e-4\r\n#define FLT_EPSILON     1.192092896e-07 // Smallest positive number, such that 1.0 + FLT_EPSILON != 1.0\r\n\r\nconst float kContrast = 0.6;\r\nconst float kGeometryCoeff = 0.8;\r\nconst float kBeta = 0.002;\r\n\r\n\r\n// varying\r\nvarying vec2 v_Texcoord0;\r\n\r\n#if defined(AO_High)\r\n\t#define SAMPLE_COUNT 12\r\n#elif defined(AO_MEDIUM)\r\n\t#define SAMPLE_COUNT 8\r\n#else\r\n\t#define SAMPLE_COUNT 4\r\n#endif\r\n\r\n#ifdef AOLOWEST\r\n#define SAMPLE_COUNT 8\r\n#endif\r\n\r\n#ifdef AOLOWEST\r\n#define SAMPLE_COUNT 8\r\n#endif\r\n\r\n\r\n#define INTENSITY u_AOParams.x\r\n#define RADIUS u_AOParams.y\r\n#define DOWNSAMPLE u_AOParams.z\r\n\r\nfloat PositivePow(float base, float power)\r\n{\r\n    return pow(max(abs(base), float(FLT_EPSILON)), power);\r\n}\r\n\r\n\r\n// Boundary check for depth sampler\r\n// (returns a very large value if it lies out of bounds)\r\nfloat CheckBounds(vec2 uv, float d) \r\n{\r\n    float ob = 0.0;\r\n    // todo\r\n    if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) \r\n    {\r\n        ob = 1.0;\r\n    }\r\n    if (d <= 0.00001) {\r\n        ob += 1.0;\r\n    }\r\n\r\n    return ob * 1e8;\r\n}\r\n\r\nfloat SampleDepth(vec2 uv) \r\n{\r\n    float depthTex_Depth = SAMPLE_DEPTH_TEXTURE(u_CameraDepthTexture, uv);\r\n    float depthTex_Linear01Depth = Linear01Depth(depthTex_Depth, u_ZBufferParams);\r\n    return  depthTex_Linear01Depth * u_ProjectionParams.y + CheckBounds(uv, depthTex_Linear01Depth);\r\n}\r\n\r\nvec3 SampleNormal(vec2 uv) \r\n{\r\n    vec4 col = texture2D(u_CameraDepthNormalsTexture, uv);\r\n    vec3 depthNormal_Normal = DecodeViewNormalStereo(col);\r\n    return depthNormal_Normal * vec3(1.0, 1.0, -1.0);\r\n}\r\n\r\nfloat SampleDepthNormal(vec2 uv, out vec3 normal) \r\n{\r\n    normal = SampleNormal(uv);\r\n    return SampleDepth(uv);\r\n}\r\n\r\n// Normal vector comparer (for geometry-aware weighting)\r\nfloat CompareNormal(vec3 d1, vec3 d2)\r\n{\r\n    return smoothstep(kGeometryCoeff, 1.0, dot(d1, d2));\r\n}\r\n\r\n// Accessors for packed AO/normal buffer\r\nvec4 PackAONormal(float ao, vec3 n) \r\n{\r\n    return vec4(ao, n * 0.5 + 0.5);\r\n}\r\n\r\nvec3 GetPackedNormal(vec4 p)\r\n{\r\n    return p.gba * 2.0 - 1.0;\r\n}\r\n\r\nfloat GetPackAO(vec4 p)\r\n{\r\n    return p.r;\r\n}\r\n\r\n\r\n","#define SHADER_NAME AOBlurHorizontal\r\n//\r\n#define BLUR_HIGH_QUALITY 0\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\n// uniform vec2 u_Delty;\r\n\r\nvec3 GetPackedNormal(vec4 p)\r\n{\r\n    return p.gba * 2.0 - 1.0;\r\n}\r\n\r\nfloat CompareNormal(vec3 d1, vec3 d2)\r\n{\r\n    return smoothstep(0.8, 1.0, dot(d1, d2));\r\n}\r\n\r\nfloat GetPackedAO(vec4 p)\r\n{\r\n    return p.r;\r\n}\r\n\r\nvec4 PackAONormal(float ao, vec3 normal)\r\n{\r\n    return vec4(ao, normal * 0.5 + 0.5);\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec2 delta = vec2(u_MainTex_TexelSize.x * 2.0 * u_Delty.x, u_Delty.y * u_MainTex_TexelSize.y * 2.0);\r\n    vec2 uv = v_Texcoord0;\r\n\r\n#if defined(BLUR_HIGH_QUALITY)\r\n\r\n    // High quality 7-tap Gaussian with adaptive sampling\r\n    vec2 uvtran = uv;\r\n    vec4 p0 = texture2D(u_MainTex, uv);\r\n    uvtran = uv - delta;\r\n    vec4 p1a = texture2D(u_MainTex, uvtran);\r\n    uvtran = uv + delta;\r\n    vec4 p1b = texture2D(u_MainTex, uvtran);\r\n    uvtran = uv - delta * 2.0;\r\n    vec4 p2a = texture2D(u_MainTex, uvtran);\r\n    uvtran = uv + delta * 2.0;\r\n    vec4 p2b = texture2D(u_MainTex, uvtran);\r\n    uvtran = uv - delta * 3.2307692308;\r\n    vec4 p3a = texture2D(u_MainTex, uvtran);\r\n    ;\r\n    uvtran = uv + delta * 3.2307692308;\r\n    vec4 p3b = texture2D(u_MainTex, uvtran);\r\n    ;\r\n\r\n    vec3 n0 = GetPackedNormal(p0);\r\n\r\n    float w0 = 0.37004405286;\r\n    float w1a = CompareNormal(n0, GetPackedNormal(p1a)) * 0.31718061674;\r\n    float w1b = CompareNormal(n0, GetPackedNormal(p1b)) * 0.31718061674;\r\n    float w2a = CompareNormal(n0, GetPackedNormal(p2a)) * 0.19823788546;\r\n    float w2b = CompareNormal(n0, GetPackedNormal(p2b)) * 0.19823788546;\r\n    float w3a = CompareNormal(n0, GetPackedNormal(p3a)) * 0.11453744493;\r\n    float w3b = CompareNormal(n0, GetPackedNormal(p3b)) * 0.11453744493;\r\n\r\n    float s;\r\n    s = GetPackedAO(p0) * w0;\r\n    s += GetPackedAO(p1a) * w1a;\r\n    s += GetPackedAO(p1b) * w1b;\r\n    s += GetPackedAO(p2a) * w2a;\r\n    s += GetPackedAO(p2b) * w2b;\r\n    s += GetPackedAO(p3a) * w3a;\r\n    s += GetPackedAO(p3b) * w3b;\r\n\r\n    s /= w0 + w1a + w1b + w2a + w2b + w3a + w3b;\r\n\r\n#else\r\n\r\n    // Fater 5-tap Gaussian with linear sampling\r\n    vec4 p0 = texture2D(u_MainTex, sampler_MainTex, i.texcoordStereo);\r\n    vec4 p1a = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, UnityStereoTransformScreenSpaceTex(i.texcoord - delta * 1.3846153846));\r\n    vec4 p1b = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, UnityStereoTransformScreenSpaceTex(i.texcoord + delta * 1.3846153846));\r\n    vec4 p2a = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, UnityStereoTransformScreenSpaceTex(i.texcoord - delta * 3.2307692308));\r\n    vec4 p2b = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, UnityStereoTransformScreenSpaceTex(i.texcoord + delta * 3.2307692308));\r\n\r\n    vec2 uvtran = uv;\r\n    vec4 p0 = texture2D(u_MainTex, uv);\r\n    uvtran = uv - delta * 1.3846153846;\r\n    vec4 p1a = texture2D(u_MainTex, uvtran);\r\n    uvtran = uv + delta * 1.3846153846;\r\n    vec4 p1b = texture2D(u_MainTex, uvtran);\r\n    uvtran = uv - delta * 3.2307692308;\r\n    vec4 p2a = texture2D(u_MainTex, uvtran);\r\n    uvtran = uv + delta * 3.2307692308;\r\n    vec4 p2b = texture2D(u_MainTex, uvtran);\r\n\r\n    vec3 n0 = GetPackedNormal(p0);\r\n\r\n    float w0 = 0.2270270270;\r\n    float w1a = CompareNormal(n0, GetPackedNormal(p1a)) * 0.3162162162;\r\n    float w1b = CompareNormal(n0, GetPackedNormal(p1b)) * 0.3162162162;\r\n    float w2a = CompareNormal(n0, GetPackedNormal(p2a)) * 0.0702702703;\r\n    float w2b = CompareNormal(n0, GetPackedNormal(p2b)) * 0.0702702703;\r\n\r\n    float s;\r\n    s = GetPackedAO(p0) * w0;\r\n    s += GetPackedAO(p1a) * w1a;\r\n    s += GetPackedAO(p1b) * w1b;\r\n    s += GetPackedAO(p2a) * w2a;\r\n    s += GetPackedAO(p2b) * w2b;\r\n\r\n    s /= w0 + w1a + w1b + w2a + w2b;\r\n\r\n#endif\r\n\r\n    gl_FragColor = PackAONormal(s, n0);\r\n}","#define SHADER_NAME AOComposition\r\n\r\n#include \"Color.glsl\";\r\n\r\n#define BLUR_HIGH_QUALITY 0\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvec3 GetPackedNormal(vec4 p)\r\n{\r\n    return p.gba * 2.0 - 1.0;\r\n}\r\nfloat CompareNormal(vec3 d1, vec3 d2)\r\n{\r\n    return smoothstep(0.8, 1.0, dot(d1, d2));\r\n}\r\nfloat GetPackedAO(vec4 p)\r\n{\r\n    return p.r;\r\n}\r\n\r\n// Geometry-aware bilateral filter (single pass/small kernel)\r\nfloat BlurSmall(sampler2D tex, vec2 uv, vec2 delta)\r\n{\r\n    vec4 p0 = texture2D(tex, uv);\r\n    vec2 uvtran = uv + vec2(-delta.x, -delta.y);\r\n    vec4 p1 = texture2D(tex, uvtran);\r\n    uvtran = uv + vec2(delta.x, -delta.y);\r\n    vec4 p2 = texture2D(tex, uvtran);\r\n    uvtran = uv + vec2(-delta.x, delta.y);\r\n    vec4 p3 = texture2D(tex, uvtran);\r\n    uvtran = uv + delta;\r\n    vec4 p4 = texture2D(tex, uvtran);\r\n\r\n    vec3 n0 = GetPackedNormal(p0);\r\n\r\n    float w0 = 1.0;\r\n    float w1 = CompareNormal(n0, GetPackedNormal(p1));\r\n    float w2 = CompareNormal(n0, GetPackedNormal(p2));\r\n    float w3 = CompareNormal(n0, GetPackedNormal(p3));\r\n    float w4 = CompareNormal(n0, GetPackedNormal(p4));\r\n\r\n    float s;\r\n    s = GetPackedAO(p0) * w0;\r\n    s += GetPackedAO(p1) * w1;\r\n    s += GetPackedAO(p2) * w2;\r\n    s += GetPackedAO(p3) * w3;\r\n    s += GetPackedAO(p4) * w4;\r\n\r\n    return s / (w0 + w1 + w2 + w3 + w4);\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec2 uv = v_Texcoord0;\r\n    vec2 delty = u_MainTex_TexelSize.xy;\r\n    float ao = BlurSmall(u_compositionAoTexture, uv, delty);\r\n    vec4 albedo = texture2D(u_MainTex, uv);\r\n#ifdef Gamma_u_MainTex\r\n    albedo = gammaToLinear(albedo);\r\n#endif // Gamma_u_MainTex\r\n    vec4 aocolor = vec4(ao * u_AOColor.rgb, ao);\r\n    albedo.rgb = albedo.rgb * (1.0 - ao) + ao * u_AOColor.rgb * ao;\r\n    gl_FragColor = albedo;\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME SCREENVS\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvec4 remapPositionZ(vec4 position)\r\n{\r\n    position.z = position.z * 2.0 - position.w;\r\n    return position;\r\n}\r\n\r\nvoid main() {\t\r\n\tgl_Position = vec4(u_OffsetScale.x*2.0-1.0+(a_PositionTexcoord.x+1.0)*u_OffsetScale.z,(1.0-((u_OffsetScale.y*2.0-1.0+(-a_PositionTexcoord.y+1.0)*u_OffsetScale.w)+1.0)/2.0)*2.0-1.0, 0.0, 1.0);\t\r\n\tv_Texcoord0 = a_PositionTexcoord.zw;\r\n\tgl_Position = remapPositionZ(gl_Position);\r\n}\r\n","import FullScreenVert from \"../../../shader/files/postProcess/GaussianDoF/FullScreenVert.vs\";\r\nimport CoCFS from \"../../../shader/files/postProcess/GaussianDoF/CoC.fs\";\r\nimport PrefilterFS from \"../../../shader/files/postProcess/GaussianDoF/Prefilter.fs\";\r\nimport BlurVFS from \"../../../shader/files/postProcess/GaussianDoF/BlurV.fs\";\r\nimport BlurHFS from \"../../../shader/files/postProcess/GaussianDoF/BlurH.fs\";\r\nimport CompositeFS from \"../../../shader/files/postProcess/GaussianDoF/Composite.fs\";\r\nimport { Camera } from \"../../../core/Camera\";\r\nimport { CommandBuffer } from \"../../../core/render/command/CommandBuffer\";\r\nimport { PostProcessEffect } from \"../../../core/render/PostProcessEffect\";\r\nimport { PostProcessRenderContext } from \"../../../core/render/PostProcessRenderContext\";\r\nimport { FilterMode } from \"../../../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { RenderTargetFormat } from \"../../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData, ShaderDataType } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderDefine } from \"../../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { DepthTextureMode } from \"../../../depthMap/DepthPass\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\nimport { SubShader } from \"../../../../RenderEngine/RenderShader/SubShader\";\r\nimport { VertexMesh } from \"../../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\n\r\n/**\r\n *  <code>BloomEffect</code> \r\n *  Gaussian DoF\r\n *  *  \r\n *  - start: \r\n *  - end: \r\n *  - maxRadius: \r\n */\r\nexport class GaussianDoF extends PostProcessEffect {\r\n    /**@internal */\r\n    static SOURCESIZE: number;\r\n\r\n    /**@internal */\r\n    static ZBUFFERPARAMS: number;\r\n\r\n    /**@internal */\r\n    static COCPARAMS: number;\r\n\r\n    /**@internal */\r\n    static DEPTHTEXTURE: number;\r\n\r\n    /**@internal */\r\n    static NORMALDEPTHTEXTURE: number;\r\n\r\n    /**@internal */\r\n    static FULLCOCTEXTURE: number;\r\n\r\n    /**@internal */\r\n    static DOWNSAMPLESCALE: number;\r\n\r\n    /**@internal */\r\n    static BLURCOCTEXTURE: number;\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_DEPTHNORMALTEXTURE: ShaderDefine;\r\n\r\n    /**\r\n     * GaussianDOF resource init\r\n     */\r\n    static init() {\r\n        GaussianDoF.SOURCESIZE = Shader3D.propertyNameToID(\"u_SourceSize\");\r\n        GaussianDoF.ZBUFFERPARAMS = Shader3D.propertyNameToID(\"u_ZBufferParams\");\r\n        GaussianDoF.COCPARAMS = Shader3D.propertyNameToID(\"u_CoCParams\");\r\n        GaussianDoF.DEPTHTEXTURE = Shader3D.propertyNameToID(\"u_CameraDepthTexture\");\r\n        GaussianDoF.NORMALDEPTHTEXTURE = Shader3D.propertyNameToID(\"u_CameraDepthNormalTexture\");\r\n        GaussianDoF.FULLCOCTEXTURE = Shader3D.propertyNameToID(\"u_FullCoCTex\");\r\n        GaussianDoF.DOWNSAMPLESCALE = Shader3D.propertyNameToID(\"u_DownSampleScale\");\r\n        GaussianDoF.BLURCOCTEXTURE = Shader3D.propertyNameToID(\"u_BlurCoCTex\");\r\n        GaussianDoF.SHADERDEFINE_DEPTHNORMALTEXTURE = Shader3D.getDefineByName(\"CAMERA_NORMALDEPTH\");\r\n\r\n        let attributeMap: any = {\r\n            'a_PositionTexcoord': [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4],\r\n        };\r\n\r\n        let uniformMap: any = {\r\n            \"u_MainTex\": ShaderDataType.Texture2D,\r\n            \"u_MainTex_TexelSize\": ShaderDataType.Vector4,\r\n            \"u_OffsetScale\": ShaderDataType.Vector4,\r\n            \"u_ZBufferParams\": ShaderDataType.Vector4,\r\n            \"u_CoCParams\": ShaderDataType.Vector3,\r\n            \"u_FullCoCTex\": ShaderDataType.Texture2D,\r\n            \"u_SourceSize\": ShaderDataType.Vector4,\r\n            \"u_DownSampleScale\": ShaderDataType.Vector4,\r\n            \"u_BlurCoCTex\": ShaderDataType.Texture2D,\r\n        };\r\n        let shader: Shader3D = Shader3D.add(\"GaussianDoF\");\r\n\r\n        /**\r\n         * CoC pass\r\n         *  FarStart  FarEnd  0 - 1\r\n         * \r\n         * Camera nearPlane---------FarStart---------FarEnd---------Camera farplane\r\n         *       0         ---------   0    ---------   1  ---------      1\r\n         */\r\n        let cocSubShader: SubShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(cocSubShader);\r\n        cocSubShader.addShaderPass(FullScreenVert, CoCFS);\r\n\r\n        /**\r\n         * Prefilter pass\r\n         * \r\n         */\r\n        let prefilterSubShader: SubShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(prefilterSubShader);\r\n        prefilterSubShader.addShaderPass(FullScreenVert, PrefilterFS);\r\n\r\n        // blur\r\n        /**\r\n         * blurH pass\r\n         */\r\n        let blurHSubShader: SubShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(blurHSubShader);\r\n        blurHSubShader.addShaderPass(FullScreenVert, BlurHFS);\r\n\r\n        /**\r\n         * blurV pass\r\n         */\r\n        let blurVSubShader: SubShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(blurVSubShader);\r\n        blurVSubShader.addShaderPass(FullScreenVert, BlurVFS);\r\n\r\n        /**\r\n         * Composite pass\r\n         */\r\n        let compositeSubShader: SubShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(compositeSubShader);\r\n        compositeSubShader.addShaderPass(FullScreenVert, CompositeFS);\r\n\r\n    }\r\n\r\n    /**@internal */\r\n    private _shader: Shader3D;\r\n\r\n    /**@internal */\r\n    private _shaderData: ShaderData;\r\n\r\n    /**@internal */\r\n    private _zBufferParams: Vector4;\r\n\r\n    /**@internal */\r\n    private _sourceSize: Vector4;\r\n\r\n    /**@internal */\r\n    private _dowmSampleScale: Vector4;\r\n\r\n    /**\r\n     * DOF\r\n     */\r\n    constructor() {\r\n        super();\r\n        this._shader = Shader3D.find(\"GaussianDoF\");\r\n        this._shaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n        this._shaderData.setVector3(GaussianDoF.COCPARAMS, new Vector3(10, 30, 1));\r\n        this._zBufferParams = new Vector4();\r\n        this._sourceSize = new Vector4();\r\n        this._dowmSampleScale = new Vector4();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set farStart(value: number) {\r\n        let cocParams: Vector3 = this._shaderData.getVector3(GaussianDoF.COCPARAMS);\r\n        cocParams.x = value;\r\n        this._shaderData.setVector3(GaussianDoF.COCPARAMS, cocParams);\r\n    }\r\n\r\n    get farStart(): number {\r\n        return this._shaderData.getVector3(GaussianDoF.COCPARAMS).x;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set farEnd(value: number) {\r\n        let cocParams: Vector3 = this._shaderData.getVector3(GaussianDoF.COCPARAMS);\r\n        cocParams.y = Math.max(cocParams.x, value);\r\n        this._shaderData.setVector3(GaussianDoF.COCPARAMS, cocParams);\r\n    }\r\n\r\n    get farEnd(): number {\r\n        return this._shaderData.getVector3(GaussianDoF.COCPARAMS).y;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set maxRadius(value: number) {\r\n        let cocParams: Vector3 = this._shaderData.getVector3(GaussianDoF.COCPARAMS);\r\n        cocParams.z = Math.min(value, 2);\r\n        this._shaderData.setVector3(GaussianDoF.COCPARAMS, cocParams);\r\n    }\r\n\r\n    get maxRadius(): number {\r\n        return this._shaderData.getVector3(GaussianDoF.COCPARAMS).z;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param context \r\n     */\r\n    private _setupShaderValue(context: PostProcessRenderContext): void {\r\n        let camera: Camera = context.camera;\r\n        this._dowmSampleScale.setValue(0.5, 0.5, 2.0, 2.0);\r\n        this._shaderData.setVector(GaussianDoF.DOWNSAMPLESCALE, this._dowmSampleScale);\r\n        let far = camera.farPlane;\r\n        let near = camera.nearPlane;\r\n        this._zBufferParams.setValue(1.0 - far / near, far / near, (near - far) / (near * far), 1 / near);\r\n        this._shaderData.setVector(GaussianDoF.ZBUFFERPARAMS, this._zBufferParams);\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    getCameraDepthTextureModeFlag() {\r\n        return DepthTextureMode.Depth;\r\n    }\r\n\r\n    /**\r\n    * @override\r\n    * @param context \r\n    */\r\n    render(context: PostProcessRenderContext): void {\r\n        let cmd: CommandBuffer = context.command;\r\n        this._setupShaderValue(context);\r\n\r\n        let source: RenderTexture = context.source;\r\n\r\n        let shader: Shader3D = this._shader;\r\n        let shaderData: ShaderData = this._shaderData;\r\n\r\n        let dataTexFormat: RenderTargetFormat = RenderTargetFormat.R16G16B16A16;\r\n        // todo fullCoC format: R16\r\n        let fullCoC: RenderTexture = RenderTexture.createFromPool(source.width, source.height, dataTexFormat, RenderTargetFormat.None, false, 1);\r\n        // coc pass\r\n        cmd.blitScreenTriangle(source, fullCoC, null, shader, shaderData, 0);\r\n        // Prefilter pass\r\n        fullCoC.filterMode = FilterMode.Bilinear;\r\n        this._shaderData.setTexture(GaussianDoF.FULLCOCTEXTURE, fullCoC);\r\n        let prefilterTex: RenderTexture = RenderTexture.createFromPool(source.width / 2, source.height / 2, dataTexFormat, RenderTargetFormat.None, false, 1);\r\n        cmd.blitScreenTriangle(source, prefilterTex, null, shader, shaderData, 1);\r\n        // blur\r\n        prefilterTex.filterMode = FilterMode.Bilinear;\r\n        this._sourceSize.setValue(prefilterTex.width, prefilterTex.height, 1.0 / prefilterTex.width, 1.0 / prefilterTex.height);\r\n        this._shaderData.setShaderData(GaussianDoF.SOURCESIZE, ShaderDataType.Vector4, this._sourceSize);\r\n        // blur H\r\n        let blurHTex: RenderTexture = RenderTexture.createFromPool(prefilterTex.width, prefilterTex.height, dataTexFormat, RenderTargetFormat.None, false, 1);\r\n        cmd.blitScreenTriangle(prefilterTex, blurHTex, null, this._shader, this._shaderData, 2);\r\n        // blur V\r\n        let blurVTex: RenderTexture = RenderTexture.createFromPool(prefilterTex.width, prefilterTex.height, dataTexFormat, RenderTargetFormat.None, false, 1);\r\n        cmd.blitScreenTriangle(blurHTex, blurVTex, null, this._shader, this._shaderData, 3);\r\n        // composite\r\n        blurVTex.filterMode = FilterMode.Bilinear;\r\n        blurVTex.anisoLevel = 1;\r\n        fullCoC.filterMode = FilterMode.Point;\r\n        this._shaderData.setTexture(GaussianDoF.BLURCOCTEXTURE, blurVTex);\r\n        let finalTex: RenderTexture = RenderTexture.createFromPool(source.width, source.height, source.colorFormat, source.depthStencilFormat, false, 1);\r\n        cmd.blitScreenTriangle(source, context.destination, null, this._shader, this._shaderData, 4);\r\n        //context.source = finalTex;\r\n        // recover render texture\r\n        RenderTexture.recoverToPool(fullCoC);\r\n        RenderTexture.recoverToPool(prefilterTex);\r\n        RenderTexture.recoverToPool(blurHTex);\r\n        RenderTexture.recoverToPool(blurVTex);\r\n        context.deferredReleaseTextures.push(finalTex);\r\n    }\r\n}\r\n","#define SHADER_NAME COCFS\r\n\r\n#ifdef CAMERA_NORMALDEPTH\r\nuniform sampler2D u_CameraDepthNormalTexture;\r\n#else\r\nuniform sampler2D u_CameraDepthTexture;\r\n#endif\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\n// Z buffer to linear 0..1 depth\r\nfloat Linear01Depth(float z, vec4 zbufferParams)\r\n{\r\n    return 1.0 / (zbufferParams.x * z + zbufferParams.y);\r\n}\r\n\r\n// Z buffer to linear depth\r\nfloat LinearEyeDepth(float z, vec4 zbufferParams)\r\n{\r\n    return 1.0 / (zbufferParams.z * z + zbufferParams.w);\r\n}\r\n\r\nfloat DecodeFloatRG(vec2 enc)\r\n{\r\n    vec2 kDecodeDot = vec2(1.0, 1.0 / 255.0);\r\n    return dot(enc, kDecodeDot);\r\n}\r\n\r\nvoid DecodeDepthNormal(vec4 enc, out float depth)\r\n{\r\n    depth = DecodeFloatRG(enc.zw);\r\n}\r\n\r\nvoid main()\r\n{\r\n\r\n#ifdef CAMERA_NORMALDEPTH\r\n    vec4 depthNormal = texture2D(u_CameraDepthNormalTexture, v_Texcoord0);\r\n    float depth = 0.0;\r\n    DecodeDepthNormal(depthNormal, depth);\r\n    depth = ((1.0 / depth) - u_ZBufferParams.y) * (1.0 / u_ZBufferParams.x);\r\n#else\r\n    float depth = texture2D(u_CameraDepthTexture, v_Texcoord0).x;\r\n#endif\r\n\r\n    depth = LinearEyeDepth(depth, u_ZBufferParams);\r\n    float farStart = u_CoCParams.x;\r\n    float farEnd = u_CoCParams.y;\r\n\r\n    float coc = (depth - farStart) / (farEnd - farStart);\r\n    coc = clamp(coc, 0.0, 1.0);\r\n    gl_FragColor = vec4(coc, coc, coc, 1.0);\r\n}\r\n","#define SHADER_NAME PrefilterFS\r\n\r\n#include \"Color.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nconst int kCount = 5;\r\nvec2 kTaps[5];\r\n\r\nvoid main()\r\n{\r\n\r\n    kTaps[0] = vec2(0.0, 0.0);\r\n    kTaps[1] = vec2(0.9, -0.4);\r\n    kTaps[2] = vec2(-0.9, 0.4);\r\n    kTaps[3] = vec2(0.4, 0.9);\r\n    kTaps[4] = vec2(-0.4, -0.9);\r\n\r\n    vec3 colorAcc = vec3(0.0);\r\n    float farCoCAcc = 0.0;\r\n    for (int i = 0; i < kCount; i++)\r\n\t{\r\n\t    vec2 uv = u_MainTex_TexelSize.xy * kTaps[i] + v_Texcoord0;\r\n\t    vec3 tapColor = texture2D(u_MainTex, uv).rgb;\r\n#ifdef Gamma_u_MainTex\r\n\t    tapColor = gammaToLinear(tapColor);\r\n#endif // Gamma_u_MainTex\r\n\r\n\t    float coc = texture2D(u_FullCoCTex, uv).r;\r\n\r\n\t    colorAcc += tapColor * coc;\r\n\t    farCoCAcc += coc;\r\n\t}\r\n    vec3 color = colorAcc * (1.0 / float(kCount));\r\n    float farCoC = farCoCAcc * (1.0 / float(kCount));\r\n\r\n    // float farCoC = texture2D(u_FullCoCTex, v_Texcoord0).x;\r\n    // vec3 color = texture2D(u_MainTex, v_Texcoord0).rgb;\r\n    // color *= farCoC;\r\n\r\n    gl_FragColor = vec4(color, farCoC);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME BlurHFS\r\n\r\n#include \"Color.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nconst int kTapCount = 3;\r\nfloat kOffsets[3];\r\nfloat kCoeffs[3];\r\n\r\nvec4 Blur(vec2 dir, float premultiply)\r\n{\r\n\r\n    kOffsets[0] = -1.33333333;\r\n    kOffsets[1] = 0.00000000;\r\n    kOffsets[2] = 1.33333333;\r\n\r\n    kCoeffs[0] = 0.35294118;\r\n    kCoeffs[1] = 0.29411765;\r\n    kCoeffs[2] = 0.3529411;\r\n\r\n    vec2 uv = v_Texcoord0;\r\n    // ivec2 positionSS = ivec2(u_SourceSize.xy * uv);\r\n\r\n    vec4 halfColor = texture2D(u_MainTex, uv);\r\n#ifdef Gamma_u_MainTex\r\n    halfColor = gammaToLinear(halfColor);\r\n#endif // Gamma_u_MainTex\r\n    float samp0CoC = halfColor.a;\r\n\r\n    float maxRadius = u_CoCParams.z;\r\n    vec2 offset = u_SourceSize.zw * dir * samp0CoC * maxRadius;\r\n\r\n    vec4 acc = vec4(0.0);\r\n\r\n    for (int i = 0; i < kTapCount; i++)\r\n\t{\r\n\t    vec2 sampCoord = uv + kOffsets[i] * offset;\r\n\t    vec4 samp = texture2D(u_MainTex, sampCoord);\r\n#ifdef Gamma_u_MainTex\r\n\t    samp = gammaToLinear(samp);\r\n#endif // Gamma_u_MainTex\r\n\t    float sampCoC = samp.a;\r\n\t    vec3 sampColor = samp.rgb;\r\n\r\n\t    float weight = clamp(1.0 - (samp0CoC - sampCoC), 0.0, 1.0);\r\n\t    acc += vec4(sampColor, sampCoC) * kCoeffs[i] * weight;\r\n\t}\r\n\r\n    acc.xyz /= acc.w + 1e-4;\r\n    return vec4(acc.xyz, samp0CoC);\r\n}\r\n\r\nvoid main()\r\n{\r\n    gl_FragColor = Blur(vec2(1.0, 0.0), 1.0);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME BlurVFS\r\n\r\n#include \"Color.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\n// todo 3 & 5\r\nconst int kTapCount = 3;\r\nfloat kOffsets[3];\r\nfloat kCoeffs[3];\r\n\r\nvec4 Blur(vec2 dir, float premultiply)\r\n{\r\n\r\n    kOffsets[0] = -1.33333333;\r\n    kOffsets[1] = 0.00000000;\r\n    kOffsets[2] = 1.33333333;\r\n\r\n    kCoeffs[0] = 0.35294118;\r\n    kCoeffs[1] = 0.29411765;\r\n    kCoeffs[2] = 0.3529411;\r\n\r\n    vec2 uv = v_Texcoord0;\r\n    // ivec2 positionSS = ivec2(u_SourceSize.xy * uv);\r\n\r\n    vec4 halfColor = texture2D(u_MainTex, uv);\r\n#ifdef Gamma_u_MainTex\r\n    halfColor = gammaToLinear(halfColor);\r\n#endif // Gamma_u_MainTex\r\n    float samp0CoC = halfColor.a;\r\n\r\n    float maxRadius = u_CoCParams.z;\r\n    vec2 offset = u_SourceSize.zw * dir * samp0CoC * maxRadius;\r\n\r\n    vec4 acc = vec4(0.0);\r\n\r\n    for (int i = 0; i < kTapCount; i++)\r\n\t{\r\n\t    vec2 sampCoord = uv + kOffsets[i] * offset;\r\n\t    vec4 samp = texture2D(u_MainTex, sampCoord);\r\n#ifdef Gamma_u_MainTex\r\n\t    samp = gammaToLinear(samp);\r\n#endif // Gamma_u_MainTex\r\n\t    float sampCoC = samp.w;\r\n\t    vec3 sampColor = samp.xyz;\r\n\r\n\t    float weight = clamp(1.0 - (samp0CoC - sampCoC), 0.0, 1.0);\r\n\t    acc += vec4(sampColor, 1.0) * kCoeffs[i] * weight;\r\n\t}\r\n\r\n    acc.xyz /= acc.w + 1e-4;\r\n    return vec4(acc.xyz, 1.0);\r\n}\r\n\r\nvoid main()\r\n{\r\n    gl_FragColor = Blur(vec2(0.0, 1.0), 0.0);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}\r\n","#define SHADER_NAME CompositeFS\r\n\r\n#include \"Color.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main()\r\n{\r\n\r\n    vec3 baseColor = texture2D(u_MainTex, v_Texcoord0).rgb;\r\n#ifdef Gamma_u_MainTex\r\n    baseColor = gammaToLinear(baseColor);\r\n#endif // Gamma_u_MainTex\r\n\r\n    vec4 samplevalue = texture2D(u_BlurCoCTex, v_Texcoord0);\r\n    vec3 farColor = samplevalue.rgb;\r\n    float coc = texture2D(u_FullCoCTex, v_Texcoord0).r;\r\n\r\n    vec3 dstColor = vec3(0.0);\r\n    float dstAlpha = 1.0;\r\n\r\n    float blend = sqrt(coc * 3.14 * 2.0);\r\n    dstColor = farColor * clamp(blend, 0.0, 1.0);\r\n    dstAlpha = clamp(1.0 - blend, 0.0, 1.0);\r\n\r\n    gl_FragColor = vec4(baseColor * dstAlpha + dstColor, 1.0);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","import { BufferUsage } from \"../../../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { VertexDeclaration } from \"../../../../../RenderEngine/VertexDeclaration\";\r\nimport { VertexElement } from \"../../../../../renders/VertexElement\";\r\nimport { VertexElementFormat } from \"../../../../../renders/VertexElementFormat\";\r\nimport { BufferState } from \"../../../../../webgl/utils/BufferState\";\r\nimport { Laya3DRender } from \"../../../../RenderObjs/Laya3DRender\";\r\nimport { IndexBuffer3D } from \"../../../../graphics/IndexBuffer3D\";\r\nimport { VertexBuffer3D } from \"../../../../graphics/VertexBuffer3D\";\r\nimport { GeometryElement } from \"../../../GeometryElement\";\r\nimport { RenderContext3D } from \"../../RenderContext3D\";\r\n\r\nexport class LensFlareElementGeomtry extends GeometryElement {\r\n    static PositionUV: number = 0;\r\n    static PositionRotationScale: number = 1;\r\n    /**@internal */\r\n    static lensQuadVertices: Float32Array;\r\n    /**@internal */\r\n    static lensQuadIndex: Uint16Array;\r\n    /**@internal */\r\n    static vertexDeclaration: VertexDeclaration;\r\n    /**@internal */\r\n    static instanceVertexDeclaration: VertexDeclaration;\r\n    /**@internal instanceData*/\r\n    static lensFlareElementMax: number = 20;\r\n    /**@internal */\r\n    private _vertexBuffer: VertexBuffer3D;\r\n    /**@internal */\r\n    private _instanceVertexBuffer: VertexBuffer3D;\r\n    /**@internal */\r\n    private _indexBuffer: IndexBuffer3D;\r\n    /**@internal */\r\n    private static _type: number = GeometryElement._typeCounter++;\r\n\r\n    /**\r\n     * initData\r\n     */\r\n    static init() {\r\n        let quadSize = 0.1;\r\n        LensFlareElementGeomtry.lensQuadVertices = new Float32Array([\r\n            quadSize, quadSize, 1, 1,\r\n            -quadSize, quadSize, 0, 1,\r\n            -quadSize, -quadSize, 0, 0,\r\n            quadSize, -quadSize, 1, 0]);\r\n        LensFlareElementGeomtry.lensQuadIndex = new Uint16Array([0, 2, 1, 0, 3, 2]);\r\n        //xy:position zw:uv\r\n        LensFlareElementGeomtry.vertexDeclaration = new VertexDeclaration(16, [new VertexElement(0, VertexElementFormat.Vector4, 0)]);\r\n        //x:startPosition  y:angular zw:scale\r\n        LensFlareElementGeomtry.instanceVertexDeclaration = new VertexDeclaration(16, [new VertexElement(0, VertexElementFormat.Vector4, 1)])\r\n    }\r\n\r\n    /**\r\n     * instance LensFlaresGeometry\r\n     */\r\n    constructor() {\r\n        super(MeshTopology.Triangles, DrawType.DrawElementInstance);\r\n        this.indexFormat = IndexFormat.UInt16;\r\n        this._createBuffer();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _createBuffer() {\r\n        //VB\r\n        this._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(LensFlareElementGeomtry.lensQuadVertices.length * 4, BufferUsage.Dynamic, false);\r\n        this._vertexBuffer.vertexDeclaration = LensFlareElementGeomtry.vertexDeclaration;\r\n        this._vertexBuffer.setData(LensFlareElementGeomtry.lensQuadVertices.buffer);\r\n        //instanceVB\r\n        this._instanceVertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(LensFlareElementGeomtry.lensFlareElementMax * 4 * 4, BufferUsage.Dynamic, false);\r\n        this._instanceVertexBuffer.instanceBuffer = true;\r\n        this._instanceVertexBuffer.vertexDeclaration = LensFlareElementGeomtry.instanceVertexDeclaration;\r\n        //IB\r\n        this._indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, LensFlareElementGeomtry.lensQuadIndex.length, BufferUsage.Static, false);\r\n        this._indexBuffer.setData(LensFlareElementGeomtry.lensQuadIndex);\r\n        //VAO\r\n        this.bufferState = new BufferState();\r\n        this.bufferState.applyState([this._vertexBuffer, this._instanceVertexBuffer], this._indexBuffer);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    get instanceBuffer() {\r\n        return this._instanceVertexBuffer;\r\n    }\r\n\r\n    /**\r\n     *\t{@inheritDoc PixelLineFilter._getType}\r\n     *\t@override\r\n     *  @internal\r\n     */\r\n    _getType(): number {\r\n        return LensFlareElementGeomtry._type;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @return  \r\n     */\r\n    _prepareRender(state: RenderContext3D): boolean {\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    destroy(): void {\r\n        super.destroy();\r\n        this._vertexBuffer.destroy();\r\n        this._instanceVertexBuffer.destroy();\r\n        this.bufferState.destroy();\r\n        this._indexBuffer.destroy();\r\n    }\r\n\r\n    /**\r\n    * @internal\r\n    * UpdateGeometry Data\r\n    */\r\n    _updateRenderParams(state: RenderContext3D): void {\r\n        this.clearRenderParams();\r\n        this.setDrawElemenParams(LensFlareElementGeomtry.lensQuadIndex.length, 0);\r\n    }\r\n}\r\n","import { RenderState } from \"../../../../../RenderEngine/RenderShader/RenderState\";\r\nimport { Vector2 } from \"../../../../../maths/Vector2\";\r\nimport { Stat } from \"../../../../../utils/Stat\";\r\nimport { Utils } from \"../../../../../utils/Utils\";\r\nimport { Laya3DRender } from \"../../../../RenderObjs/Laya3DRender\";\r\nimport { Camera } from \"../../../Camera\";\r\nimport { Transform3D } from \"../../../Transform3D\";\r\nimport { Material, MaterialRenderMode } from \"../../../../../resource/Material\";\r\nimport { RenderContext3D } from \"../../RenderContext3D\";\r\nimport { RenderElement } from \"../../RenderElement\";\r\nimport { Command } from \"../../command/Command\";\r\nimport { LensFlareElement, LensFlareEffect } from \"./LensFlareEffect\";\r\nimport { LensFlareElementGeomtry } from \"./LensFlareGeometry\";\r\n\r\nexport class LensFlareCMD extends Command {\r\n\r\n    /**@internal geoemtry */\r\n    private _lensFlareGeometry: LensFlareElementGeomtry;\r\n\r\n    /**@internal renderElement*/\r\n    private _renderElement: RenderElement;\r\n\r\n    /**@internal */\r\n    private _materials: Material;\r\n\r\n    /**@internal */\r\n    private _transform3D: Transform3D;\r\n\r\n    /**@internal */\r\n    private _lensFlareElementData: LensFlareElement;\r\n\r\n    /**instance */\r\n    private _instanceCount: number = 1;\r\n\r\n    public get instanceCount(): number {\r\n        return this._instanceCount;\r\n    }\r\n    public set instanceCount(value: number) {\r\n        this._instanceCount = value;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * instance CMD\r\n     */\r\n    constructor() {\r\n        super();\r\n        this._transform3D = Laya3DRender.renderOBJCreate.createTransform(null);\r\n        this._renderElement = new RenderElement();\r\n        this._lensFlareGeometry = new LensFlareElementGeomtry();\r\n        this._renderElement.setTransform(this._transform3D);\r\n        this._renderElement.setGeometry(this._lensFlareGeometry);\r\n        this._initMaterial();\r\n    }\r\n\r\n    /**\r\n     * init material\r\n     */\r\n    private _initMaterial() {\r\n        this._materials = new Material();\r\n        this._materials.setShaderName(\"LensFlare\");\r\n        this._materials.materialRenderMode = MaterialRenderMode.RENDERMODE_ADDTIVE;\r\n        this._materials.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n        this._materials.cull = RenderState.CULL_NONE;\r\n        this._renderElement.material = this._materials;\r\n        this._renderElement.renderSubShader = this._materials.shader.getSubShaderAt(0);\r\n        this._renderElement.subShaderIndex = 0;\r\n\r\n    }\r\n\r\n    /**@internal */\r\n    set center(value: Vector2) {\r\n        this._materials.setVector2(\"u_FlareCenter\", value);\r\n    }\r\n\r\n    /**@internal */\r\n    set rotate(value: number) {\r\n        this._materials.setFloat(\"u_rotate\", value);\r\n    }\r\n\r\n    /**@internal */\r\n    set lensFlareElement(value: LensFlareElement) {\r\n        this._lensFlareElementData = value;\r\n        this.applyElementData();\r\n    }\r\n\r\n    get lensFlareElement(): LensFlareElement {\r\n        return this._lensFlareElementData;\r\n    }\r\n\r\n    /**\r\n     * apply element Data\r\n     */\r\n    applyElementData() {\r\n        //LensFlareElement\r\n        this._materials.setTexture(\"u_FlareTexture\", this._lensFlareElementData.texture);\r\n        this._materials.setColor(\"u_Tint\", this._lensFlareElementData.tint);\r\n        this._materials.setFloat(\"u_TintIntensity\", this._lensFlareElementData.intensity);\r\n        this._materials.setVector2(\"u_Postionoffset\", this._lensFlareElementData.positionOffset);\r\n        this._materials.setFloat(\"u_Angularoffset\", this._lensFlareElementData.angularOffset);\r\n        if (this._lensFlareElementData.autoRotate) {\r\n            this._materials.addDefine(LensFlareEffect.SHADERDEFINE_AUTOROTATE);\r\n        } else {\r\n            this._materials.removeDefine(LensFlareEffect.SHADERDEFINE_AUTOROTATE);\r\n        }\r\n        //TODO\r\n\r\n        //InstanceBuffer\r\n        this._lensFlareGeometry.instanceCount = 1;//TODO\r\n        // startPosangularscaleXscaleY\r\n        let testFloat = new Float32Array([this._lensFlareElementData.startPosition, Utils.toAngle(this._lensFlareElementData.rotation), this._lensFlareElementData.scale.x, this._lensFlareElementData.scale.y]);//TODO        \r\n        // instanceBuffer set\r\n        this._lensFlareGeometry.instanceBuffer.setData(testFloat.buffer, 0, 0, testFloat.length * 4);//TODO\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    run(): void {\r\n        var context = RenderContext3D._instance;\r\n        this._materials.setFloat(\"u_aspectRatio\", context.camera.viewport.height / context.camera.viewport.width);\r\n        context.applyContext(Camera._updateMark);\r\n        context.drawRenderElement(this._renderElement);\r\n        Stat.blitDrawCall++;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    recover(): void {\r\n        //TODO\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    destroy(): void {\r\n        //TODO\r\n    }\r\n}","#define SHADER_NAME LENSFLARESVS\r\n//attribute vec4 a_PositionTexcoord;\r\n// x: startPosition y: rotation zw: scale\r\n// attribute vec4 a_DistanceRotationScale;\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvec2 rotateVector(vec2 pos, vec2 center, float angle) {\r\n    float cosAngle = cos(angle);\r\n    float sinAngle = sin(angle);\r\n    vec2 offset = pos - center;\r\n    vec2 rotatedOffset = vec2(\r\n        offset.x * cosAngle - offset.y * sinAngle,\r\n        offset.x * sinAngle + offset.y * cosAngle\r\n    );\r\n    return center + rotatedOffset;\r\n}\r\n\r\nvec2 rotateVec2(float rad,vec2 pos){\r\n    float s = sin(rad);\r\n    float c = cos(rad);\r\n    float x = pos.x*c-pos.y*s;\r\n    float y = pos.x*s+c*pos.y;\r\n    return vec2(x,y);\r\n}\r\n\r\nvec2 scaleVec2(vec2 scale,vec2 pos){\r\n    float x = scale.x * pos.x;\r\n    float y = scale.y * pos.y;\r\n    return vec2(x,y);\r\n}\r\n\r\nvec2 transVec2(vec2 trans,vec2 pos){\r\n    float x = pos.x + trans.x;\r\n    float y = pos.y + trans.y;\r\n    return vec2(x,y);\r\n}\r\n\r\n\r\nvoid main(){\r\n    vec2 center = u_FlareCenter;\r\n    vec2 deltaPos = -2.0 * center;\r\n    vec2 lenFlarePosition = vec2(a_PositionTexcoord.x, a_PositionTexcoord.y);\r\n    // aspectRadio scale\r\n    vec2 aspectRadio = vec2(u_aspectRatio, 1.0);\r\n    //\r\n    vec2 scale = vec2(a_DistanceRotationScale.z, a_DistanceRotationScale.w);\r\n    lenFlarePosition = scaleVec2(scale,lenFlarePosition);\r\n    //\r\n    // float rad = acos(dot(normalize(center),vec2(0.0,1.0)));\r\n    // angular offset\r\n    #ifdef LENSFLAREAUTOROTATE\r\n        lenFlarePosition = rotateVec2(u_rotate, lenFlarePosition);\r\n        float texRotate = a_DistanceRotationScale.y;\r\n        lenFlarePosition = rotateVec2(texRotate, lenFlarePosition);\r\n    #endif\r\n    float angularoffset = u_Angularoffset;\r\n    lenFlarePosition = rotateVector(lenFlarePosition, center, angularoffset);\r\n    lenFlarePosition = scaleVec2(aspectRadio,lenFlarePosition);\r\n    //\r\n    lenFlarePosition = center + deltaPos * a_DistanceRotationScale.x + lenFlarePosition + u_Postionoffset;\r\n    gl_Position = vec4(lenFlarePosition.x, lenFlarePosition.y, 0.0, 1.0);\r\n    v_Texcoord0 = a_PositionTexcoord.zw;\r\n}\r\n","import { Config3D } from \"../../../../Config3D\";\r\nimport { ILaya } from \"../../../../ILaya\";\r\nimport { Sprite } from \"../../../display/Sprite\";\r\nimport { Loader } from \"../../../net/Loader\";\r\nimport { Context } from \"../../../resource/Context\";\r\nimport { Texture2D } from \"../../../resource/Texture2D\";\r\nimport { Handler } from \"../../../utils/Handler\";\r\nimport { Timer } from \"../../../utils/Timer\";\r\nimport { ISubmit } from \"../../../webgl/submit/ISubmit\";\r\nimport { SubmitKey } from \"../../../webgl/submit/SubmitKey\";\r\nimport { Cluster } from \"../../graphics/renderPath/Cluster\";\r\nimport { SphericalHarmonicsL2 } from \"../../graphics/SphericalHarmonicsL2\";\r\nimport { Viewport } from \"../../math/Viewport\";\r\nimport { PhysicsSettings } from \"../../physics/PhysicsSettings\";\r\nimport { SkyBox } from \"../../resource/models/SkyBox\";\r\nimport { SkyDome } from \"../../resource/models/SkyDome\";\r\nimport { SkyRenderer } from \"../../resource/models/SkyRenderer\";\r\nimport { TextureCube } from \"../../../resource/TextureCube\";\r\nimport { Utils3D } from \"../../utils/Utils3D\";\r\nimport { BaseCamera } from \"../BaseCamera\";\r\nimport { Camera, CameraClearFlags } from \"../Camera\";\r\nimport { AlternateLightQueue, LightQueue } from \"../light/LightQueue\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { RenderElement } from \"../render/RenderElement\";\r\nimport { Lightmap } from \"./Lightmap\";\r\nimport { Scene3DShaderDeclaration } from \"./Scene3DShaderDeclaration\";\r\nimport { ShadowCasterPass } from \"../../shadowMap/ShadowCasterPass\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { BlitFrameBufferCMD } from \"../render/command/BlitFrameBufferCMD\";\r\nimport { DirectionLightCom } from \"../light/DirectionLightCom\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { PointLightCom } from \"../light/PointLightCom\";\r\nimport { SpotLightCom } from \"../light/SpotLightCom\";\r\nimport { FilterMode } from \"../../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { RenderCapable } from \"../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { DefineDatas } from \"../../../RenderEngine/RenderShader/DefineDatas\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData, ShaderDataItem, ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { UnifromBufferData, UniformBufferParamsType } from \"../../../RenderEngine/UniformBufferData\";\r\nimport { UniformBufferObject } from \"../../../RenderEngine/UniformBufferObject\";\r\nimport { RenderTargetFormat } from \"../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { RenderClearFlag } from \"../../../RenderEngine/RenderEnum/RenderClearFlag\";\r\nimport { ICullPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICullPass\";\r\nimport { FrustumCulling } from \"../../graphics/FrustumCulling\";\r\nimport { IShadowCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { ICameraCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { Prefab } from \"../../../resource/HierarchyResource\";\r\nimport { Stat } from \"../../../utils/Stat\";\r\nimport { CommandUniformMap } from \"../../../RenderEngine/CommandUniformMap\";\r\nimport { ComponentDriver } from \"../../../components/ComponentDriver\";\r\nimport { IRenderQueue } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderQueue\";\r\nimport { LayaEnv } from \"../../../../LayaEnv\";\r\nimport { SceneRenderManager } from \"./SceneRenderManager\";\r\nimport { VolumeManager } from \"../../component/Volume/VolumeManager\";\r\nimport { UI3DManager } from \"../UI3D/UI3DManager\";\r\nimport { Scene } from \"../../../display/Scene\";\r\nimport { ReflectionProbe } from \"../../component/Volume/reflectionProbe/ReflectionProbe\";\r\nimport { AmbientMode } from \"./AmbientMode\";\r\nimport { BVHSpatialConfig } from \"./bvh/SpatialManager\";\r\nimport { BVHSceneRenderManager } from \"./BVHSceneRenderManager/BVHSceneRenderManager\";\r\nimport { BVHCullPass } from \"./BVHSceneRenderManager/BVHCullPass\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { RenderTexture } from \"../../../resource/RenderTexture\";\r\nimport { Laya3D } from \"../../../../Laya3D\";\r\nimport { IPhysicsManager } from \"../../../Physics3D/interface/IPhysicsManager\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\n\r\nexport enum FogMode {\r\n    Linear = 0, //Linear\r\n    EXP = 1,    // \r\n    EXP2 = 2,   // \r\n}\r\n\r\n/**\r\n * 3D\r\n */\r\nexport class Scene3D extends Sprite implements ISubmit {\r\n    /** @internal */\r\n    private static _lightTexture: Texture2D;\r\n    /** @internal */\r\n    private static _lightPixles: Float32Array;\r\n    /** @internal */\r\n    static _shadowCasterPass: ShadowCasterPass;\r\n    /**@internal */\r\n    static physicsSettings: PhysicsSettings;\r\n    /** reflection mode */\r\n    static REFLECTIONMODE_SKYBOX: number = 0;\r\n    static REFLECTIONMODE_CUSTOM: number = 1;\r\n    /** RenderQueue mode */\r\n    static SCENERENDERFLAG_RENDERQPAQUE = 0;\r\n    static SCENERENDERFLAG_SKYBOX = 1;\r\n    static SCENERENDERFLAG_RENDERTRANSPARENT = 2;\r\n    /**Scene3D UniformMap */\r\n    static sceneUniformMap: CommandUniformMap;\r\n    /** Scene UniformPropertyID */\r\n    /** @internal */\r\n    static FOGCOLOR: number;\r\n    /** @internal */\r\n    static FOGPARAMS: number;\r\n    /** @internal */\r\n    static DIRECTIONLIGHTCOUNT: number;\r\n    /** @internal */\r\n    static LIGHTBUFFER: number;\r\n    /** @internal */\r\n    static CLUSTERBUFFER: number;\r\n    /** @internal */\r\n    static SUNLIGHTDIRECTION: number;\r\n    /** @internal */\r\n    static SUNLIGHTDIRCOLOR: number;\r\n\r\n    /** @internal */\r\n    static AMBIENTCOLOR: number;\r\n\r\n    /** @internal */\r\n    static TIME: number;\r\n    /**@internal */\r\n    static GIRotate: number;\r\n    /** @internal */\r\n    static sceneID: number;\r\n\r\n    static SceneUBOData: UnifromBufferData;\r\n    /**@internal scene uniform block */\r\n    static SCENEUNIFORMBLOCK: number;\r\n    //------------------legacy lighting-------------------------------\r\n    /** @internal */\r\n    static LIGHTDIRECTION: number;\r\n    /** @internal */\r\n    static LIGHTDIRCOLOR: number;\r\n    /** @internal */\r\n    static LIGHTMODE: number;\r\n    /** @internal */\r\n    static POINTLIGHTPOS: number;\r\n    /** @internal */\r\n    static POINTLIGHTRANGE: number;\r\n    /** @internal */\r\n    static POINTLIGHTATTENUATION: number;\r\n    /** @internal */\r\n    static POINTLIGHTCOLOR: number;\r\n    /** @internal */\r\n    static POINTLIGHTMODE: number;\r\n    /** @internal */\r\n    static SPOTLIGHTPOS: number;\r\n    /** @internal */\r\n    static SPOTLIGHTDIRECTION: number;\r\n    /** @internal */\r\n    static SPOTLIGHTSPOTANGLE: number;\r\n    /** @internal */\r\n    static SPOTLIGHTRANGE: number;\r\n    /** @internal */\r\n    static SPOTLIGHTCOLOR: number;\r\n    /** @internal */\r\n    static SPOTLIGHTMODE: number;\r\n    //------------------legacy lighting-------------------------------\r\n    /** @internal */\r\n    static __updateMark: number = 0;\r\n    /** @internal*/\r\n    static _blitTransRT: RenderTexture;\r\n    /**@internal */\r\n    static _blitOffset: Vector4 = new Vector4();\r\n    /**@internal */\r\n    static mainCavansViewPort: Viewport = new Viewport(0, 0, 1, 1);\r\n\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    static set _updateMark(value: number) {\r\n        Scene3D.__updateMark = value;\r\n    }\r\n\r\n    static get _updateMark(): number {\r\n        return Scene3D.__updateMark;\r\n    }\r\n\r\n    /**\r\n     * init shaderData\r\n     */\r\n    static shaderValueInit() {\r\n        Scene3DShaderDeclaration.SHADERDEFINE_FOG = Shader3D.getDefineByName(\"FOG\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_FOG_LINEAR = Shader3D.getDefineByName(\"FOG_LINEAR\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP = Shader3D.getDefineByName(\"FOG_EXP\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP2 = Shader3D.getDefineByName(\"FOG_EXP2\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_DIRECTIONLIGHT = Shader3D.getDefineByName(\"DIRECTIONLIGHT\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_POINTLIGHT = Shader3D.getDefineByName(\"POINTLIGHT\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SPOTLIGHT = Shader3D.getDefineByName(\"SPOTLIGHT\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SHADOW = Shader3D.getDefineByName(\"SHADOW\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_CASCADE = Shader3D.getDefineByName(\"SHADOW_CASCADE\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW = Shader3D.getDefineByName(\"SHADOW_SOFT_SHADOW_LOW\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH = Shader3D.getDefineByName(\"SHADOW_SOFT_SHADOW_HIGH\");\r\n\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT = Shader3D.getDefineByName(\"SHADOW_SPOT\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW = Shader3D.getDefineByName(\"SHADOW_SPOT_SOFT_SHADOW_LOW\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH = Shader3D.getDefineByName(\"SHADOW_SPOT_SOFT_SHADOW_HIGH\");\r\n\r\n        Scene3D.FOGCOLOR = Shader3D.propertyNameToID(\"u_FogColor\");\r\n        Scene3D.FOGPARAMS = Shader3D.propertyNameToID(\"u_FogParams\");//x start,y end,z Density\r\n        Scene3D.DIRECTIONLIGHTCOUNT = Shader3D.propertyNameToID(\"u_DirationLightCount\");\r\n        Scene3D.LIGHTBUFFER = Shader3D.propertyNameToID(\"u_LightBuffer\");\r\n        Scene3D.CLUSTERBUFFER = Shader3D.propertyNameToID(\"u_LightClusterBuffer\");\r\n        Scene3D.TIME = Shader3D.propertyNameToID(\"u_Time\");\r\n        Scene3D.GIRotate = Shader3D.propertyNameToID(\"u_GIRotate\");\r\n        Scene3D.SCENEUNIFORMBLOCK = Shader3D.propertyNameToID(UniformBufferObject.UBONAME_SCENE);\r\n        let sceneUniformMap: CommandUniformMap = Scene3D.sceneUniformMap = LayaGL.renderOBJCreate.createGlobalUniformMap(\"Scene3D\");\r\n        if (Config3D._uniformBlock) {\r\n\r\n            sceneUniformMap.addShaderBlockUniform(Scene3D.SCENEUNIFORMBLOCK, UniformBufferObject.UBONAME_SCENE, [\r\n                {\r\n                    id: Scene3D.TIME,\r\n                    propertyName: \"u_Time\",\r\n                    uniformtype: ShaderDataType.Float\r\n                },\r\n                {\r\n                    id: Scene3D.FOGPARAMS,\r\n                    propertyName: \"u_FogParams\",\r\n                    uniformtype: ShaderDataType.Vector4\r\n                },\r\n                {\r\n                    id: Scene3D.FOGCOLOR,\r\n                    propertyName: \"u_FogColor\",\r\n                    uniformtype: ShaderDataType.Vector4\r\n                }\r\n            ])\r\n        } else {\r\n            sceneUniformMap.addShaderUniform(Scene3D.FOGCOLOR, \"u_FogColor\", ShaderDataType.Color);\r\n            sceneUniformMap.addShaderUniform(Scene3D.FOGPARAMS, \"u_FogParams\", ShaderDataType.Vector4);\r\n            sceneUniformMap.addShaderUniform(Scene3D.TIME, \"u_Time\", ShaderDataType.Float);\r\n        }\r\n\r\n        sceneUniformMap.addShaderUniform(Scene3D.DIRECTIONLIGHTCOUNT, \"u_DirationLightCount\", ShaderDataType.Int);\r\n        sceneUniformMap.addShaderUniform(Scene3D.LIGHTBUFFER, \"u_LightBuffer\", ShaderDataType.Texture2D);\r\n        sceneUniformMap.addShaderUniform(Scene3D.CLUSTERBUFFER, \"u_LightClusterBuffer\", ShaderDataType.Texture2D);\r\n\r\n        sceneUniformMap.addShaderUniform(Scene3D.GIRotate, \"u_GIRotate\", ShaderDataType.Float);\r\n    }\r\n\r\n    /**\r\n     * legency ShaderData\r\n     */\r\n    static legacyLightingValueInit() {\r\n        Scene3D.LIGHTDIRECTION = Shader3D.propertyNameToID(\"u_DirectionLight.direction\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.LIGHTDIRECTION, \"u_DirectionLight.direction\", ShaderDataType.Vector3);\r\n        Scene3D.LIGHTDIRCOLOR = Shader3D.propertyNameToID(\"u_DirectionLight.color\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.LIGHTDIRCOLOR, \"u_DirectionLight.color\", ShaderDataType.Vector3);\r\n        Scene3D.LIGHTMODE = Shader3D.propertyNameToID(\"u_DirectionLight.lightMode\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.LIGHTMODE, \"u_DirectionLight.lightMode\", ShaderDataType.Int);\r\n\r\n        Scene3D.POINTLIGHTPOS = Shader3D.propertyNameToID(\"u_PointLight.position\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.POINTLIGHTPOS, \"u_PointLight.position\", ShaderDataType.Vector3);\r\n        Scene3D.POINTLIGHTRANGE = Shader3D.propertyNameToID(\"u_PointLight.range\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.POINTLIGHTRANGE, \"u_PointLight.range\", ShaderDataType.Float);\r\n        Scene3D.POINTLIGHTATTENUATION = Shader3D.propertyNameToID(\"u_PointLight.attenuation\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.POINTLIGHTATTENUATION, \"u_PointLight.attenuation\", ShaderDataType.Float);\r\n        Scene3D.POINTLIGHTCOLOR = Shader3D.propertyNameToID(\"u_PointLight.color\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.POINTLIGHTCOLOR, \"u_PointLight.color\", ShaderDataType.Vector3);\r\n        Scene3D.POINTLIGHTMODE = Shader3D.propertyNameToID(\"u_PointLight.lightMode\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.POINTLIGHTMODE, \"u_PointLight.lightMode\", ShaderDataType.Int);\r\n\r\n        Scene3D.SPOTLIGHTPOS = Shader3D.propertyNameToID(\"u_SpotLight.position\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.SPOTLIGHTPOS, \"u_SpotLight.position\", ShaderDataType.Vector3);\r\n        Scene3D.SPOTLIGHTDIRECTION = Shader3D.propertyNameToID(\"u_SpotLight.direction\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.SPOTLIGHTDIRECTION, \"u_SpotLight.direction\", ShaderDataType.Vector3);\r\n        Scene3D.SPOTLIGHTSPOTANGLE = Shader3D.propertyNameToID(\"u_SpotLight.spot\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.SPOTLIGHTSPOTANGLE, \"u_SpotLight.spot\", ShaderDataType.Float);\r\n        Scene3D.SPOTLIGHTRANGE = Shader3D.propertyNameToID(\"u_SpotLight.range\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.SPOTLIGHTRANGE, \"u_SpotLight.range\", ShaderDataType.Float);\r\n        Scene3D.SPOTLIGHTCOLOR = Shader3D.propertyNameToID(\"u_SpotLight.color\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.SPOTLIGHTCOLOR, \"u_SpotLight.color\", ShaderDataType.Vector3);\r\n        Scene3D.SPOTLIGHTMODE = Shader3D.propertyNameToID(\"u_SpotLight.lightMode\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.SPOTLIGHTMODE, \"u_SpotLight.lightMode\", ShaderDataType.Int);\r\n    }\r\n\r\n    /**\r\n     * create Scene UniformBuffer\r\n     * @internal\r\n     * @returns \r\n     */\r\n    static createSceneUniformBlock(): UnifromBufferData {\r\n        if (!Scene3D.SceneUBOData) {\r\n            let uniformpara: Map<string, UniformBufferParamsType> = new Map<string, UniformBufferParamsType>();\r\n            uniformpara.set(\"u_Time\", UniformBufferParamsType.Number);\r\n            uniformpara.set(\"u_FogParams\", UniformBufferParamsType.Vector4);\r\n            uniformpara.set(\"u_FogColor\", UniformBufferParamsType.Vector4);\r\n            let uniformMap = new Map<number, UniformBufferParamsType>();\r\n            uniformpara.forEach((value, key) => {\r\n                uniformMap.set(Shader3D.propertyNameToID(key), value);\r\n            });\r\n            Scene3D.SceneUBOData = new UnifromBufferData(uniformMap);\r\n        }\r\n        return Scene3D.SceneUBOData;\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n        var multiLighting: boolean = Config3D._multiLighting;\r\n        if (multiLighting) {\r\n            const width = 4;\r\n            var maxLightCount: number = Config3D.maxLightCount;\r\n            var clusterSlices: Vector3 = Config3D.lightClusterCount;\r\n            Cluster.instance = new Cluster(clusterSlices.x, clusterSlices.y, clusterSlices.z, Math.min(Config3D.maxLightCount, Config3D._maxAreaLightCountPerClusterAverage));\r\n            Scene3D._lightTexture = Utils3D._createFloatTextureBuffer(width, maxLightCount);\r\n            Scene3D._lightTexture.lock = true;\r\n            Scene3D._lightPixles = new Float32Array(maxLightCount * width * 4);\r\n        }\r\n        Scene3D.shaderValueInit();\r\n        var configShaderValue: DefineDatas = Shader3D._configDefineValues;\r\n        if (!Config3D._multiLighting) {\r\n            (configShaderValue.add(Shader3D.SHADERDEFINE_LEGACYSINGALLIGHTING));\r\n            Scene3D.legacyLightingValueInit()\r\n        }\r\n        Scene3D._shadowCasterPass = new ShadowCasterPass();\r\n        //UniformBuffer\r\n        if (Config3D._uniformBlock)\r\n            configShaderValue.add(Shader3D.SHADERDEFINE_ENUNIFORMBLOCK);\r\n\r\n        Scene3D.physicsSettings = new PhysicsSettings();\r\n\r\n        let supportFloatTex = LayaGL.renderEngine.getCapable(RenderCapable.TextureFormat_R32G32B32A32);\r\n        if (supportFloatTex) {\r\n            configShaderValue.add(Shader3D.SHADERDEFINE_FLOATTEXTURE);\r\n        }\r\n        let supportFloatLinearFiltering = LayaGL.renderEngine.getCapable(RenderCapable.Texture_FloatLinearFiltering);\r\n        if (supportFloatLinearFiltering) {\r\n            configShaderValue.add(Shader3D.SHADERDEFINE_FLOATTEXTURE_FIL_LINEAR);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ,:\r\n     * @param url \r\n     * @param complete \r\n     */\r\n    static load(url: string, complete: Handler): void {\r\n        ILaya.loader.load(url).then((res: Prefab) => {\r\n            if (complete) {\r\n                let ret: Scene3D;\r\n                if (res) {\r\n                    let scene = res.create();\r\n                    if (scene instanceof Scene)\r\n                        ret = scene._scene3D;\r\n                    else\r\n                        ret = <Scene3D>scene;\r\n                }\r\n                complete.runWith([ret]);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**ide */\r\n    _reflectionsSource: number = 0;\r\n    /**ide */\r\n    _reflectionsResolution: string = \"256\";\r\n    /**ide */\r\n    _reflectionsIblSamples = 128;\r\n\r\n\r\n\r\n    /** @internal */\r\n    private _group: string;\r\n    /** @internal */\r\n    public _lightCount: number = 0;\r\n    /** @internal */\r\n    public _pointLights: LightQueue<PointLightCom> = new LightQueue();\r\n    /** @internal */\r\n    public _spotLights: LightQueue<SpotLightCom> = new LightQueue();\r\n    /** @internal */\r\n    public _directionLights: LightQueue<DirectionLightCom> = new LightQueue();\r\n    /** @internal */\r\n    public _alternateLights: AlternateLightQueue = new AlternateLightQueue();\r\n    /** @internal */\r\n    private _lightmaps: Lightmap[] = [];\r\n    /** @internal */\r\n    private _skyRenderer: SkyRenderer = new SkyRenderer();\r\n    /** @internal */\r\n    private _enableFog: boolean;\r\n    /** @internal */\r\n    private _timer: Timer;\r\n    /** @internal */\r\n    private _time: number = 0;\r\n    /** @internal */\r\n    private _fogParams: Vector4;\r\n    /** @internal */\r\n    private _fogMode: FogMode;\r\n    /**@internal */\r\n    private _sceneReflectionProb: ReflectionProbe;\r\n    /**@internal */\r\n    private _physicsStepTime: number = 0;\r\n    /**@internal */\r\n    _sunColor: Color = new Color(1.0, 1.0, 1.0);\r\n    /**@interanl */\r\n    _sundir: Vector3 = new Vector3();\r\n    /**@internal*/\r\n    _id = Scene3D.sceneID++;\r\n    /** @internal */\r\n    _mainDirectionLight: DirectionLightCom;\r\n    /** @internal */\r\n    _mainSpotLight: SpotLightCom;\r\n    /** @internal */\r\n    _mainPointLight: PointLightCom;//TODO\r\n    /** @internal */\r\n    _physicsManager: IPhysicsManager;\r\n    /** @internal ,*/\r\n    _collsionTestList: number[] = [];\r\n    /** @internal */\r\n    _shaderValues: ShaderData;\r\n    /** @interanl */\r\n    _sceneUniformData: UnifromBufferData;\r\n    /** @internal */\r\n    _sceneUniformObj: UniformBufferObject;\r\n    /** @internal */\r\n    _key: SubmitKey = new SubmitKey();\r\n\r\n    /** @internal */\r\n    _opaqueQueue: IRenderQueue = Laya3DRender.renderOBJCreate.createBaseRenderQueue(false);\r\n    /** @internal */\r\n    _transparentQueue: IRenderQueue = Laya3DRender.renderOBJCreate.createBaseRenderQueue(true);\r\n    /** @internal */\r\n    _cameraPool: BaseCamera[] = [];\r\n\r\n    /** @internal */\r\n    _volumeManager: VolumeManager;\r\n    /**@internal */\r\n    _UI3DManager: UI3DManager = new UI3DManager();\r\n    /**@internal */\r\n    _sceneRenderManager: SceneRenderManager;\r\n    /**@internal */\r\n    _cullPass: ICullPass;\r\n    /** */\r\n    currentCreationLayer: number = Math.pow(2, 0);\r\n    /** */\r\n    enableLight: boolean = true;\r\n    /**lightShadowMap  @internal */\r\n    _ShadowMapupdateFrequency: number = 1;\r\n    /** @internal */\r\n    _nativeObj: any;\r\n\r\n    /** @internal IDE */\r\n    _renderByEditor: boolean;\r\n    /** @internal */\r\n    _scene2D: Scene;\r\n\r\n    /**\r\n     * Scene3D2DIDE\r\n     */\r\n    get scene2D(): Scene {\r\n        return this._scene2D;\r\n    }\r\n\r\n    /**\r\n     * set SceneRenderableManager\r\n     */\r\n    set sceneRenderableManager(manager: SceneRenderManager) {\r\n        manager.list = this._sceneRenderManager.list;\r\n        this._sceneRenderManager = manager;\r\n    }\r\n\r\n    get sceneRenderableManager(): SceneRenderManager {\r\n        return this._sceneRenderManager;\r\n    }\r\n\r\n    /**\r\n     * set ICullPass\r\n     */\r\n    set cullPass(cullPass: ICullPass) {\r\n        this._cullPass = cullPass;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get enableFog(): boolean {\r\n        return this._enableFog;\r\n    }\r\n\r\n    set enableFog(value: boolean) {\r\n        if (this._enableFog !== value) {\r\n            this._enableFog = value;\r\n            if (value) {\r\n                this._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG);\r\n            } else\r\n                this._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get fogMode(): FogMode {\r\n        return this._fogMode;\r\n    }\r\n\r\n    set fogMode(value: FogMode) {\r\n        this._fogMode = value;\r\n        switch (value) {\r\n            case FogMode.Linear:\r\n                this._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_LINEAR);\r\n                this._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP);\r\n                this._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP2);\r\n                break;\r\n            case FogMode.EXP:\r\n                this._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP);\r\n                this._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_LINEAR);\r\n                this._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP2);\r\n                break;\r\n            case FogMode.EXP2:\r\n                this._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP2);\r\n                this._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_LINEAR);\r\n                this._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP);\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get fogColor(): Color {\r\n        return this._shaderValues.getColor(Scene3D.FOGCOLOR);\r\n    }\r\n\r\n    set fogColor(value: Color) {\r\n        this._shaderValues.setColor(Scene3D.FOGCOLOR, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get fogStart(): number {\r\n        return this._fogParams.x;\r\n\r\n    }\r\n\r\n    set fogStart(value: number) {\r\n        this._fogParams.x = value;\r\n        this.fogParams = this._fogParams;\r\n    }\r\n\r\n    /**\r\n     * end\r\n     */\r\n    get fogEnd(): number {\r\n        return this._fogParams.y;\r\n    }\r\n\r\n    set fogEnd(value: number) {\r\n        this._fogParams.y = value;\r\n        this.fogParams = this._fogParams;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get fogDensity(): number {\r\n        return this._fogParams.z\r\n    }\r\n\r\n    set fogDensity(value: number) {\r\n        this._fogParams.z = value;\r\n        this.fogParams = this._fogParams;\r\n    }\r\n\r\n    /**@internal */\r\n    get fogParams(): Vector4 {\r\n        return this._shaderValues.getVector(Scene3D.FOGPARAMS);\r\n    }\r\n\r\n    set fogParams(value: Vector4) {\r\n        this._shaderValues.setVector(Scene3D.FOGPARAMS, value);\r\n    }\r\n\r\n    //0-2PI\r\n    set GIRotate(value: number) {\r\n        this._shaderValues.setNumber(Scene3D.GIRotate, value);\r\n    }\r\n\r\n    get GIRotate() {\r\n        return this._shaderValues.getNumber(Scene3D.GIRotate);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * AmbientMode.SolidColorambientColorAmbientMode.SphericalHarmonicsambientSphericalHarmonics\r\n     */\r\n    get ambientMode(): AmbientMode {\r\n        return this._sceneReflectionProb.ambientMode;\r\n    }\r\n\r\n    set ambientMode(value: AmbientMode) {\r\n        this._sceneReflectionProb.ambientMode = value;\r\n    }\r\n\r\n    get sceneReflectionProb(): ReflectionProbe {\r\n        return this._sceneReflectionProb;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    set sceneReflectionProb(value: ReflectionProbe) {\r\n        this._sceneReflectionProb = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get ambientColor(): Color {\r\n        return this._sceneReflectionProb.ambientColor;\r\n    }\r\n\r\n    set ambientColor(value: Color) {\r\n        this._sceneReflectionProb.ambientColor = value;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get ambientIntensity(): number {\r\n        return this._sceneReflectionProb.ambientIntensity;\r\n    }\r\n\r\n    set ambientIntensity(value: number) {\r\n        this._sceneReflectionProb.ambientIntensity = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get reflectionIntensity(): number {\r\n        return this._sceneReflectionProb.reflectionIntensity;\r\n    }\r\n\r\n    set reflectionIntensity(value: number) {\r\n        this._sceneReflectionProb.reflectionIntensity = value;\r\n    }\r\n\r\n    /**\r\n     * ambient sh\r\n     */\r\n    public get ambientSH(): Float32Array {\r\n        return this._sceneReflectionProb.ambientSH;\r\n    }\r\n    public set ambientSH(value: Float32Array) {\r\n        this._sceneReflectionProb.ambientSH = value;\r\n    }\r\n    /**\r\n     * ambient iblTexture\r\n     */\r\n    public get iblTex(): TextureCube {\r\n        return this._sceneReflectionProb.iblTex;\r\n\r\n    }\r\n    public set iblTex(value: TextureCube) {\r\n        this._sceneReflectionProb.iblTex = value\r\n    }\r\n\r\n    /**\r\n     * ambient rgbd compress\r\n     */\r\n    public get iblTexRGBD(): boolean {\r\n        return this._sceneReflectionProb.iblTexRGBD;\r\n    }\r\n    public set iblTexRGBD(value: boolean) {\r\n        this._sceneReflectionProb.iblTexRGBD = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get skyRenderer(): SkyRenderer {\r\n        return this._skyRenderer;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get physicsSimulation(): IPhysicsManager {\r\n        return this._physicsManager;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @override\r\n     */\r\n    get timer(): Timer {\r\n        return this._timer;\r\n    }\r\n\r\n    set timer(value: Timer) {\r\n        this._timer = value;\r\n    }\r\n\r\n    /**\r\n     * ,\r\n     */\r\n    get lightmaps(): Lightmap[] {\r\n        return this._lightmaps.slice();\r\n    }\r\n\r\n    set lightmaps(value: Lightmap[]) {\r\n        var maps: Lightmap[] = this._lightmaps;\r\n        if (maps) {\r\n            for (var i: number = 0, n: number = maps.length; i < n; i++) {\r\n                var map: Lightmap = maps[i];\r\n                map.lightmapColor && map.lightmapColor._removeReference();\r\n                map.lightmapDirection && map.lightmapDirection._removeReference();\r\n            }\r\n        }\r\n        if (value) {\r\n            var count: number = value.length;\r\n            maps.length = count;\r\n            for (i = 0; i < count; i++) {\r\n                var map: Lightmap = value[i];\r\n                map.lightmapColor && map.lightmapColor._addReference();\r\n                map.lightmapDirection && map.lightmapDirection._addReference();\r\n                maps[i] = map;\r\n            }\r\n        } else {\r\n            maps.length = 0;\r\n        }\r\n        this.event(Lightmap.ApplyLightmapEvent);\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowMapFrequency() {\r\n        return this._ShadowMapupdateFrequency;\r\n    }\r\n\r\n    set shadowMapFrequency(value: number) {\r\n        this._ShadowMapupdateFrequency = value;\r\n    }\r\n\r\n\r\n    /**\r\n     *  <code>Scene3D</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n\r\n        this._is3D = true;\r\n        this._componentDriver = new ComponentDriver();\r\n        this._timer = ILaya.timer;\r\n\r\n        if (LayaEnv.isConch && !(window as any).conchConfig.conchWebGL) {\r\n            this._nativeObj = new (window as any).conchSubmitScene3D(this.renderSubmit.bind(this));\r\n        }\r\n        if (Laya3D.enablePhysics)\r\n            this._physicsManager = Laya3D.PhysicsCreateUtil.createPhysicsManger(Scene3D.physicsSettings);\r\n\r\n        this._shaderValues = LayaGL.renderOBJCreate.createShaderData(null);\r\n        this._shaderValues._defineDatas.addDefineDatas(Shader3D._configDefineValues);\r\n        if (Config3D._uniformBlock) {\r\n            //SceneUniformBlock\r\n            this._sceneUniformObj = UniformBufferObject.getBuffer(UniformBufferObject.UBONAME_SCENE, 0);\r\n            this._sceneUniformData = Scene3D.createSceneUniformBlock();\r\n            if (!this._sceneUniformObj) {\r\n                this._sceneUniformObj = UniformBufferObject.create(UniformBufferObject.UBONAME_SCENE, BufferUsage.Dynamic, this._sceneUniformData.getbyteLength(), true);\r\n            }\r\n            this._shaderValues._addCheckUBO(UniformBufferObject.UBONAME_SCENE, this._sceneUniformObj, this._sceneUniformData);\r\n            this._shaderValues.setUniformBuffer(Scene3D.SCENEUNIFORMBLOCK, this._sceneUniformObj);\r\n\r\n            //ShadowUniformBlock\r\n            //Scene3D._shadowCasterPass\r\n            this._shaderValues._addCheckUBO(UniformBufferObject.UBONAME_SHADOW, Scene3D._shadowCasterPass._castDepthBufferOBJ, Scene3D._shadowCasterPass._castDepthBufferData);\r\n            this._shaderValues.setUniformBuffer(Shader3D.propertyNameToID(UniformBufferObject.UBONAME_SHADOW), Scene3D._shadowCasterPass._castDepthBufferOBJ);\r\n        }\r\n        this._fogParams = new Vector4(300, 1000, 0.01, 0);\r\n        this.enableFog = false;\r\n        this.fogStart = 300;\r\n        this.fogEnd = 1000;\r\n        this.fogDensity = 0.01;\r\n        this.fogColor = new Color(0.7, 0.7, 0.7);\r\n        this.fogMode = FogMode.Linear;\r\n        this.GIRotate = 0;\r\n\r\n        this._scene = this;\r\n        if (Config3D.useBVHCull) {\r\n            let bvhConfig = new BVHSpatialConfig();\r\n            bvhConfig.Min_BVH_Build_Nums = Config3D.BVH_Min_Build_nums;\r\n            bvhConfig.limit_size = Config3D.BVH_limit_size;\r\n            bvhConfig.max_SpatialCount = Config3D.BVH_max_SpatialCount;\r\n            this._sceneRenderManager = new BVHSceneRenderManager(bvhConfig);\r\n            this._cullPass = new BVHCullPass();\r\n        } else {\r\n            this._sceneRenderManager = new SceneRenderManager();\r\n            this._cullPass = Laya3DRender.renderOBJCreate.createCullPass();\r\n        }\r\n\r\n        if (Config3D.debugFrustumCulling) {\r\n        }\r\n\r\n        this._volumeManager = new VolumeManager();\r\n        this._UI3DManager = new UI3DManager();\r\n        this.sceneReflectionProb = this._volumeManager.reflectionProbeManager.sceneReflectionProbe;\r\n\r\n        this._sceneReflectionProb.reflectionIntensity = 1.0;\r\n        this.ambientColor = new Color(0.212, 0.227, 0.259);\r\n    }\r\n\r\n\r\n    /**\r\n     *@internal\r\n     */\r\n    protected _update(): void {\r\n        var delta: number = this.timer._delta / 1000;\r\n        this._time += delta;\r\n        this._shaderValues.setNumber(Scene3D.TIME, this._time);\r\n        //Physics\r\n        if (LayaEnv.isPlaying) {\r\n            this._physicsStepTime += delta;\r\n            if (this._physicsStepTime > Scene3D.physicsSettings.fixedTimeStep) {\r\n\r\n                let physicsManager = this._physicsManager;\r\n                if (Laya3D.enablePhysics && Stat.enablePhysicsUpdate) {\r\n                    physicsManager.update(this._physicsStepTime);\r\n                }\r\n                this._physicsStepTime = 0;\r\n            }\r\n        }\r\n        if (this._volumeManager.needreCaculateAllRenderObjects())\r\n            this._volumeManager.reCaculateAllRenderObjects(this._sceneRenderManager.list);\r\n        else\r\n            this._volumeManager.handleMotionlist();\r\n\r\n        this._componentDriver.callStart();\r\n        this._componentDriver.callUpdate();\r\n\r\n        this._componentDriver.callLateUpdate();\r\n        this._componentDriver.callDestroy();\r\n\r\n        this._sceneRenderManager.updateMotionObjects();\r\n\r\n        if (!this._renderByEditor)\r\n            this._UI3DManager.update();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _binarySearchIndexInCameraPool(camera: BaseCamera): number {\r\n        var start: number = 0;\r\n        var end: number = this._cameraPool.length - 1;\r\n        var mid: number;\r\n        while (start <= end) {\r\n            mid = Math.floor((start + end) / 2);\r\n            var midValue: number = this._cameraPool[mid]._renderingOrder;\r\n            if (midValue == camera._renderingOrder)\r\n                return mid;\r\n            else if (midValue > camera._renderingOrder)\r\n                end = mid - 1;\r\n            else\r\n                start = mid + 1;\r\n        }\r\n        return start;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getGroup(): string {\r\n        return this._group;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setGroup(value: string): void {\r\n        this._group = value;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onActive(): void {\r\n        super._onActive();\r\n        ILaya.stage._scene3Ds.push(this);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onInActive(): void {\r\n        super._onInActive();\r\n        var scenes: any[] = ILaya.stage._scene3Ds;\r\n        scenes.splice(scenes.indexOf(this), 1);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _prepareSceneToRender(): void {\r\n        var shaderValues: ShaderData = this._shaderValues;\r\n        var multiLighting: boolean = Config3D._multiLighting && Stat.enableMulLight;\r\n        if (multiLighting) {\r\n            var ligTex: Texture2D = Scene3D._lightTexture;\r\n            var ligPix: Float32Array = Scene3D._lightPixles;\r\n            const pixelWidth: number = ligTex.width;\r\n            const floatWidth: number = pixelWidth * 4;\r\n            var curCount: number = 0;\r\n            var dirCount: number = Stat.enableLight ? this._directionLights._length : 0;\r\n            var dirElements: DirectionLightCom[] = this._directionLights._elements;\r\n            if (dirCount > 0) {\r\n                var sunLightIndex: number = this._directionLights.getBrightestLight();//get the brightest light as sun\r\n                this._mainDirectionLight = dirElements[sunLightIndex];\r\n                this._directionLights.normalLightOrdering(sunLightIndex);\r\n                for (var i: number = 0; i < dirCount; i++, curCount++) {\r\n                    var dirLight: DirectionLightCom = dirElements[i];\r\n                    var dir: Vector3 = dirLight._direction;\r\n                    var intCor: Vector3 = dirLight._intensityColor;\r\n                    var off: number = floatWidth * curCount;\r\n                    intCor.x = Color.gammaToLinearSpace(dirLight.color.r);\r\n                    intCor.y = Color.gammaToLinearSpace(dirLight.color.g);\r\n                    intCor.z = Color.gammaToLinearSpace(dirLight.color.b);\r\n                    Vector3.scale(intCor, dirLight._intensity, intCor);\r\n                    (dirLight.owner as Sprite3D).transform.worldMatrix.getForward(dir);\r\n                    Vector3.normalize(dir, dir);//\r\n                    ligPix[off] = intCor.x;\r\n                    ligPix[off + 1] = intCor.y;\r\n                    ligPix[off + 2] = intCor.z;\r\n                    ligPix[off + 3] = dirLight._lightmapBakedType;//0: MIX  1:REALTIME\r\n                    ligPix[off + 4] = dir.x;\r\n                    ligPix[off + 5] = dir.y;\r\n                    ligPix[off + 6] = dir.z;\r\n                    // if (i == 0) {\r\n                    // \tthis._setShaderValue(Scene3D.SUNLIGHTDIRCOLOR, intCor);\r\n                    // \tthis._setShaderValue(Scene3D.SUNLIGHTDIRECTION, dir);\r\n                    // }\r\n                    if (i == 0) {\r\n                        this._sunColor = dirLight.color;\r\n                        this._sundir = dir;\r\n                    }\r\n                }\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_DIRECTIONLIGHT);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_DIRECTIONLIGHT);\r\n            }\r\n\r\n            var poiCount: number = Stat.enableLight ? this._pointLights._length : 0;\r\n            if (poiCount > 0) {\r\n                var poiElements: PointLightCom[] = this._pointLights._elements;\r\n                var mainPointLightIndex: number = this._pointLights.getBrightestLight();\r\n                this._mainPointLight = poiElements[mainPointLightIndex];\r\n                this._pointLights.normalLightOrdering(mainPointLightIndex);\r\n                for (var i: number = 0; i < poiCount; i++, curCount++) {\r\n                    var poiLight: PointLightCom = poiElements[i];\r\n                    var pos: Vector3 = (poiLight.owner as Sprite3D).transform.position;\r\n                    var intCor: Vector3 = poiLight._intensityColor;\r\n                    var off: number = floatWidth * curCount;\r\n                    intCor.x = Color.gammaToLinearSpace(poiLight.color.r);\r\n                    intCor.y = Color.gammaToLinearSpace(poiLight.color.g);\r\n                    intCor.z = Color.gammaToLinearSpace(poiLight.color.b);\r\n                    Vector3.scale(intCor, poiLight._intensity, intCor);\r\n                    ligPix[off] = intCor.x;\r\n                    ligPix[off + 1] = intCor.y;\r\n                    ligPix[off + 2] = intCor.z;\r\n                    ligPix[off + 3] = poiLight.range;\r\n                    ligPix[off + 4] = pos.x;\r\n                    ligPix[off + 5] = pos.y;\r\n                    ligPix[off + 6] = pos.z;\r\n                    ligPix[off + 7] = poiLight._lightmapBakedType;//0: MIX  1:REALTIME\r\n                }\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_POINTLIGHT);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_POINTLIGHT);\r\n            }\r\n\r\n            var spoCount: number = Stat.enableLight ? this._spotLights._length : 0;\r\n            if (spoCount > 0) {\r\n                var spoElements: SpotLightCom[] = this._spotLights._elements;\r\n                var mainSpotLightIndex: number = this._spotLights.getBrightestLight();\r\n                this._mainSpotLight = spoElements[mainSpotLightIndex];\r\n                this._spotLights.normalLightOrdering(mainSpotLightIndex)\r\n                for (var i: number = 0; i < spoCount; i++, curCount++) {\r\n                    var spoLight: SpotLightCom = spoElements[i];\r\n                    var dir: Vector3 = spoLight._direction;\r\n                    var pos: Vector3 = (spoLight.owner as Sprite3D).transform.position;\r\n                    var intCor: Vector3 = spoLight._intensityColor;\r\n                    var off: number = floatWidth * curCount;\r\n                    intCor.x = Color.gammaToLinearSpace(spoLight.color.r);\r\n                    intCor.y = Color.gammaToLinearSpace(spoLight.color.g);\r\n                    intCor.z = Color.gammaToLinearSpace(spoLight.color.b);\r\n                    Vector3.scale(intCor, spoLight._intensity, intCor);\r\n                    (spoLight.owner as Sprite3D).transform.worldMatrix.getForward(dir);\r\n                    Vector3.normalize(dir, dir);\r\n                    ligPix[off] = intCor.x;\r\n                    ligPix[off + 1] = intCor.y;\r\n                    ligPix[off + 2] = intCor.z;\r\n                    ligPix[off + 3] = spoLight.range;\r\n                    ligPix[off + 4] = pos.x;\r\n                    ligPix[off + 5] = pos.y;\r\n                    ligPix[off + 6] = pos.z;\r\n                    ligPix[off + 7] = spoLight.spotAngle * Math.PI / 180;\r\n                    ligPix[off + 8] = dir.x;\r\n                    ligPix[off + 9] = dir.y;\r\n                    ligPix[off + 10] = dir.z;\r\n                    ligPix[off + 11] = spoLight._lightmapBakedType;//0: MIX  1:REALTIME\r\n                }\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SPOTLIGHT);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SPOTLIGHT);\r\n            }\r\n\r\n            (curCount > 0) && (ligTex.setSubPixelsData(0, 0, pixelWidth, curCount, ligPix, 0, false, false, false));\r\n            shaderValues.setTexture(Scene3D.LIGHTBUFFER, ligTex);\r\n            shaderValues.setInt(Scene3D.DIRECTIONLIGHTCOUNT, this._directionLights._length);\r\n            shaderValues.setTexture(Scene3D.CLUSTERBUFFER, Cluster.instance._clusterTexture);\r\n        }\r\n        else {\r\n            if (this._directionLights._length > 0 && Stat.enableLight) {\r\n                var dirLight: DirectionLightCom = this._directionLights._elements[0];\r\n                this._mainDirectionLight = dirLight;\r\n                dirLight._intensityColor.x = Color.gammaToLinearSpace(dirLight.color.r);\r\n                dirLight._intensityColor.y = Color.gammaToLinearSpace(dirLight.color.g);\r\n                dirLight._intensityColor.z = Color.gammaToLinearSpace(dirLight.color.b);\r\n                Vector3.scale(dirLight._intensityColor, dirLight._intensity, dirLight._intensityColor);\r\n\r\n                (dirLight.owner as Sprite3D).transform.worldMatrix.getForward(dirLight._direction);\r\n                Vector3.normalize(dirLight._direction, dirLight._direction);\r\n                shaderValues.setVector3(Scene3D.LIGHTDIRCOLOR, dirLight._intensityColor);\r\n                shaderValues.setVector3(Scene3D.LIGHTDIRECTION, dirLight._direction);\r\n                shaderValues.setInt(Scene3D.LIGHTMODE, dirLight._lightmapBakedType);\r\n                if (i == 0) {\r\n                    this._sunColor = dirLight.color;\r\n                    this._sundir = dirLight._direction;\r\n                }\r\n                // this._setShaderValue(Scene3D.SUNLIGHTDIRCOLOR, dirLight._intensityColor);\r\n                // this._setShaderValue(Scene3D.SUNLIGHTDIRECTION, dirLight._direction);\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_DIRECTIONLIGHT);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_DIRECTIONLIGHT);\r\n            }\r\n            if (this._pointLights._length > 0 && Stat.enableLight) {\r\n                var poiLight: PointLightCom = this._pointLights._elements[0];\r\n                this._mainPointLight = poiLight;\r\n                poiLight._intensityColor.x = Color.gammaToLinearSpace(poiLight.color.r);\r\n                poiLight._intensityColor.y = Color.gammaToLinearSpace(poiLight.color.g);\r\n                poiLight._intensityColor.z = Color.gammaToLinearSpace(poiLight.color.b);\r\n                Vector3.scale(poiLight._intensityColor, poiLight._intensity, poiLight._intensityColor);\r\n                shaderValues.setVector3(Scene3D.POINTLIGHTCOLOR, poiLight._intensityColor);\r\n                shaderValues.setVector3(Scene3D.POINTLIGHTPOS, (poiLight.owner as Sprite3D).transform.position);\r\n                shaderValues.setNumber(Scene3D.POINTLIGHTRANGE, poiLight.range);\r\n                shaderValues.setInt(Scene3D.POINTLIGHTMODE, poiLight._lightmapBakedType);\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_POINTLIGHT);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_POINTLIGHT);\r\n            }\r\n            if (this._spotLights._length > 0 && Stat.enableLight) {\r\n                var spotLight: SpotLightCom = this._spotLights._elements[0];\r\n                this._mainSpotLight = spotLight;\r\n                spotLight._intensityColor.x = Color.gammaToLinearSpace(spotLight.color.r);\r\n                spotLight._intensityColor.y = Color.gammaToLinearSpace(spotLight.color.g);\r\n                spotLight._intensityColor.z = Color.gammaToLinearSpace(spotLight.color.b);\r\n                Vector3.scale(spotLight._intensityColor, spotLight._intensity, spotLight._intensityColor);\r\n                shaderValues.setVector3(Scene3D.SPOTLIGHTCOLOR, spotLight._intensityColor);\r\n                shaderValues.setVector3(Scene3D.SPOTLIGHTPOS, (spotLight.owner as Sprite3D).transform.position);\r\n                (spotLight.owner as Sprite3D).transform.worldMatrix.getForward(spotLight._direction);\r\n                Vector3.normalize(spotLight._direction, spotLight._direction);\r\n                shaderValues.setVector3(Scene3D.SPOTLIGHTDIRECTION, spotLight._direction);\r\n                shaderValues.setNumber(Scene3D.SPOTLIGHTRANGE, spotLight.range);\r\n                shaderValues.setNumber(Scene3D.SPOTLIGHTSPOTANGLE, spotLight.spotAngle * Math.PI / 180);\r\n                shaderValues.setInt(Scene3D.SPOTLIGHTMODE, spotLight._lightmapBakedType);\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SPOTLIGHT);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SPOTLIGHT);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _cullInfoCamera: Camera\r\n    get cullInfoCamera(): Camera {\r\n        return this._cullInfoCamera;\r\n    }\r\n    /**\r\n     * scenceCamera,\r\n     * @param camera \r\n     */\r\n    _setCullCamera(camera: Camera) {\r\n        this._cullInfoCamera = camera;\r\n    }\r\n\r\n    /**\r\n     * CullCamera\r\n     */\r\n    recaculateCullCamera() {\r\n        this._cullInfoCamera = this._cameraPool[0] as Camera;\r\n        this._cameraPool.forEach(element => {\r\n            if (this.cullInfoCamera.maxlocalYDistance < (element as Camera).maxlocalYDistance) {\r\n                this._cullInfoCamera = element as Camera;\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _addCamera(camera: BaseCamera): void {\r\n        var index: number = this._binarySearchIndexInCameraPool(camera);\r\n        var order: number = camera._renderingOrder;\r\n        var count: number = this._cameraPool.length;\r\n        while (index < count && this._cameraPool[index]._renderingOrder <= order)\r\n            index++;\r\n        this._cameraPool.splice(index, 0, camera);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _removeCamera(camera: BaseCamera): void {\r\n        this._cameraPool.splice(this._cameraPool.indexOf(camera), 1);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _preCulling(context: RenderContext3D, camera: Camera): void {\r\n        this._clearRenderQueue();\r\n        var cameraCullInfo: ICameraCullInfo = FrustumCulling._cameraCullInfo;\r\n        var cameraPos = cameraCullInfo.position = camera._transform.position;\r\n        cameraCullInfo.cullingMask = camera.cullingMask;\r\n        cameraCullInfo.staticMask = camera.staticMask;\r\n        cameraCullInfo.boundFrustum = camera.boundFrustum;\r\n        cameraCullInfo.useOcclusionCulling = camera.useOcclusionCulling;\r\n        this._cullPass.cullByCameraCullInfo(cameraCullInfo, this.sceneRenderableManager);\r\n        //addQueue\r\n        let list = this._cullPass.cullList;\r\n        let element = list.elements;\r\n        for (let i: number = 0; i < list.length; i++) {\r\n            let render = element[i];\r\n            render.distanceForSort = Vector3.distance(render.bounds.getCenter(), cameraPos);//TODO:,\r\n            var elements: RenderElement[] = render._renderElements;\r\n            for (var j: number = 0, m: number = elements.length; j < m; j++)\r\n                elements[j]._update(this, context, context.customShader, context.replaceTag);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param cullInfo \r\n     * @param context \r\n     */\r\n    _directLightShadowCull(cullInfo: IShadowCullInfo, context: RenderContext3D) {\r\n        this._clearRenderQueue();\r\n        const position: Vector3 = cullInfo.position;\r\n        this._cullPass.cullByShadowCullInfo(cullInfo, this.sceneRenderableManager);\r\n        let list = this._cullPass.cullList;\r\n        let element = list.elements;\r\n        for (let i: number = 0; i < list.length; i++) {\r\n            let render = element[i];\r\n            render.distanceForSort = Vector3.distance(render.bounds.getCenter(), position);//TODO:,\r\n            var elements: RenderElement[] = render._renderElements;\r\n            for (var j: number = 0, m: number = elements.length; j < m; j++)\r\n                elements[j]._update(this, context, null, null);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param cameraCullInfo \r\n     * @param context \r\n     */\r\n    _sportLightShadowCull(cameraCullInfo: ICameraCullInfo, context: RenderContext3D) {\r\n        this._clearRenderQueue();\r\n        this._cullPass.cullingSpotShadow(cameraCullInfo, this.sceneRenderableManager);\r\n        let list = this._cullPass.cullList;\r\n        let element = list.elements;\r\n        for (var i: number = 0, n: number = list.length; i < n; i++) {\r\n            var render = element[i];\r\n            render.distanceForSort = Vector3.distance(render.bounds.getCenter(), cameraCullInfo.position);\r\n            var elements: RenderElement[] = render._renderElements;\r\n            for (var j: number = 0, m: number = elements.length; j < m; j++)\r\n                elements[j]._update(this, context, null, null);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _clear(state: RenderContext3D): void {\r\n        var viewport: Viewport = state.viewport;\r\n        var camera: Camera = <Camera>state.camera;\r\n        var renderTex: RenderTexture = camera._getRenderTexture();\r\n        var vpX: number, vpY: number;\r\n        var vpW: number = viewport.width;\r\n        var vpH: number = viewport.height;\r\n        let needInternalRT = camera._needInternalRenderTexture();\r\n\r\n        if (needInternalRT) {\r\n            vpX = 0;\r\n            vpY = 0;\r\n        }\r\n        else {\r\n            if (camera.renderTarget) {\r\n                vpX = viewport.x;\r\n                vpY = viewport.y;\r\n            }\r\n            else {\r\n                vpX = viewport.x;\r\n                vpY = camera._getCanvasHeight() - viewport.y - vpH;\r\n            }\r\n        }\r\n\r\n        LayaGL.renderEngine.viewport(vpX, vpY, vpW, vpH);\r\n        LayaGL.renderEngine.scissor(vpX, vpY, vpW, vpH);\r\n        state.changeViewport(vpX, vpY, vpW, vpH);\r\n        state.changeScissor(vpX, vpY, vpW, vpH);\r\n        Camera._context3DViewPortCatch.set(vpX, vpY, vpW, vpH);\r\n        Camera._contextScissorPortCatch.setValue(vpX, vpY, vpW, vpH);\r\n\r\n        var clearFlag: number = camera.clearFlag;\r\n        if (clearFlag === CameraClearFlags.Sky && !(camera.skyRenderer._isAvailable() || this._skyRenderer._isAvailable()))\r\n            clearFlag = CameraClearFlags.SolidColor;\r\n        let clearConst: number = 0;\r\n        let stencilFlag = renderTex.depthStencilFormat == RenderTargetFormat.DEPTHSTENCIL_24_8 ? RenderClearFlag.Stencil : 0;\r\n        switch (clearFlag) {\r\n            case CameraClearFlags.SolidColor:\r\n                clearConst = RenderClearFlag.Color | RenderClearFlag.Depth | stencilFlag;\r\n                break;\r\n            case CameraClearFlags.DepthOnly:\r\n            case CameraClearFlags.Sky:\r\n                clearConst = RenderClearFlag.Depth | stencilFlag;\r\n                break;\r\n            case CameraClearFlags.Nothing:\r\n                clearConst = 0;\r\n                break;\r\n            case CameraClearFlags.ColorOnly:\r\n                clearConst = RenderClearFlag.Color;\r\n                break;\r\n        }\r\n\r\n        // todo other color gamut\r\n        let clearColor = camera._linearClearColor;\r\n        if (renderTex.gammaCorrection != 1) {\r\n            clearColor = camera.clearColor;\r\n        }\r\n\r\n        LayaGL.renderEngine.clearRenderTexture(clearConst, clearColor, 1);\r\n    }\r\n\r\n    /**\r\n     * @internal Scene\r\n     */\r\n    _renderScene(context: RenderContext3D, renderFlag: number): void {\r\n        var camera: Camera = <Camera>context.camera;\r\n        switch (renderFlag) {\r\n            case Scene3D.SCENERENDERFLAG_RENDERQPAQUE:\r\n                Stat.opaqueDrawCall += this._opaqueQueue.renderQueue(context);\r\n                break;\r\n            case Scene3D.SCENERENDERFLAG_SKYBOX:\r\n                if (camera.clearFlag === CameraClearFlags.Sky) {\r\n                    if (camera.skyRenderer._isAvailable())\r\n                        camera.skyRenderer._render(context);\r\n                    else if (this._skyRenderer._isAvailable())\r\n                        this._skyRenderer._render(context);\r\n                }\r\n                break;\r\n            case Scene3D.SCENERENDERFLAG_RENDERTRANSPARENT:\r\n                Stat.transDrawCall += this._transparentQueue.renderQueue(context);\r\n                if (Config3D.debugFrustumCulling) {\r\n                    // var renderElements: RenderElement[] = this._debugTool._render._renderElements;\r\n                    // for (var i: number = 0, n: number = renderElements.length; i < n; i++) {\r\n                    //     context.drawRenderElement(renderElements[i]);\r\n                    // }\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        var lightMapsData: any[] = data.lightmaps;\r\n        if (lightMapsData) {\r\n            var lightMapCount: number = lightMapsData.length;\r\n            var lightmaps: Lightmap[] = new Array(lightMapCount);\r\n            for (var i: number = 0; i < lightMapCount; i++) {\r\n                var lightMap: Lightmap = new Lightmap();\r\n                var lightMapData: any = lightMapsData[i];\r\n                if (lightMapData.path) {//\r\n                    lightMap.lightmapColor = Loader.getTexture2D(lightMapData.path);\r\n                }\r\n                else {\r\n                    lightMap.lightmapColor = Loader.getTexture2D(lightMapData.color.path);\r\n                    if (lightMapData.direction)\r\n                        lightMap.lightmapDirection = Loader.getTexture2D(lightMapData.direction.path);\r\n                }\r\n                lightmaps[i] = lightMap;\r\n            }\r\n            this.lightmaps = lightmaps;\r\n        }\r\n        var skyData: any = data.sky;\r\n        if (skyData) {\r\n            this._skyRenderer.material = Loader.getRes(skyData.material.path);\r\n            switch (skyData.mesh) {\r\n                case \"SkyBox\":\r\n                    this._skyRenderer.mesh = SkyBox.instance;\r\n                    break;\r\n                case \"SkyDome\":\r\n                    this._skyRenderer.mesh = SkyDome.instance;\r\n                    break;\r\n                default:\r\n                    this.skyRenderer.mesh = SkyBox.instance;\r\n            }\r\n        }\r\n        this.enableFog = data.enableFog;\r\n        this.fogStart = data.fogStart;\r\n        this.fogRange = data.fogRange;\r\n        var fogColorData: any[] = data.fogColor;\r\n        if (fogColorData) {\r\n            var fogCol: Color = this.fogColor;\r\n            fogCol.fromArray(fogColorData);\r\n            this.fogColor = fogCol;\r\n        }\r\n        //  \r\n        var ambientModeData: AmbientMode = data.ambientMode;\r\n        // \r\n        var ambientColorData: any[] = data.ambientColor;\r\n        if (ambientColorData) {\r\n            var ambCol: Color = this.ambientColor;\r\n            ambCol.fromArray(ambientColorData);\r\n            this.ambientColor = ambCol;\r\n        }\r\n        if (ambientModeData == AmbientMode.TripleColor) {\r\n            // \r\n            let ambientSkyColor: number[] = data.ambientSkyColor;\r\n            let tempV3sky = new Vector3();\r\n            tempV3sky.fromArray(ambientSkyColor);\r\n\r\n            let ambientEquatorColor: number[] = data.ambientEquatorColor;\r\n            let tempV3Equaltor = new Vector3();\r\n            tempV3Equaltor.fromArray(ambientEquatorColor);\r\n\r\n            let ambientGroundColor: number[] = data.ambientGroundColor;\r\n            let tempV3Ground = new Vector3();\r\n            tempV3Ground.fromArray(ambientGroundColor);\r\n\r\n            this._sceneReflectionProb.setGradientAmbient(tempV3sky, tempV3Equaltor, tempV3Ground);\r\n        }\r\n        // skybox\r\n        var ambientSphericalHarmonicsData: Array<number> = data.ambientSphericalHarmonics;\r\n        if (ambientSphericalHarmonicsData) {\r\n            var ambientSH: SphericalHarmonicsL2 = new SphericalHarmonicsL2();\r\n            for (var i: number = 0; i < 3; i++) {\r\n                var off: number = i * 9;\r\n                ambientSH.setCoefficients(i, ambientSphericalHarmonicsData[off], ambientSphericalHarmonicsData[off + 1], ambientSphericalHarmonicsData[off + 2], ambientSphericalHarmonicsData[off + 3], ambientSphericalHarmonicsData[off + 4], ambientSphericalHarmonicsData[off + 5], ambientSphericalHarmonicsData[off + 6], ambientSphericalHarmonicsData[off + 7], ambientSphericalHarmonicsData[off + 8]);\r\n            }\r\n            this._sceneReflectionProb.ambientSphericalHarmonics = ambientSH;\r\n        }\r\n        (ambientModeData != undefined) && (this.ambientMode = ambientModeData);\r\n        var reflectionData: string = data.reflection;\r\n        (reflectionData != undefined) && (this._sceneReflectionProb.reflectionTexture = Loader.getRes(reflectionData));\r\n        var reflectionDecodingFormatData: number = data.reflectionDecodingFormat;\r\n        (reflectionDecodingFormatData != undefined) && (this._sceneReflectionProb.reflectionDecodingFormat = reflectionDecodingFormatData);\r\n        var ambientSphericalHarmonicsIntensityData: number = data.ambientSphericalHarmonicsIntensity;\r\n        (ambientSphericalHarmonicsIntensityData != undefined) && (this._sceneReflectionProb.ambientIntensity = ambientSphericalHarmonicsIntensityData);\r\n        var reflectionIntensityData: number = data.reflectionIntensity;\r\n        (reflectionIntensityData != undefined) && (this._sceneReflectionProb.reflectionIntensity = reflectionIntensityData);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _addRenderObject(render: any): void {\r\n        // if (this._octree && render._supportOctree) {\r\n        // \tthis._octree.addRender(render);\r\n        // } else {\r\n        //this._renders.add(render);\r\n        this._sceneRenderManager.addRenderObject(render);\r\n        // }\r\n        render._addReflectionProbeUpdate();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _removeRenderObject(render: any): void {\r\n        // if (this._octree && render._supportOctree) {\r\n        // \tthis._octree.removeRender(render);\r\n        // } else {\r\n        this._sceneRenderManager.removeRenderObject(render);\r\n        //this._renders.remove(render);\r\n        // }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getRenderQueue(index: number): IRenderQueue {\r\n        if (index <= 2500)//2500\r\n            return this._opaqueQueue;\r\n        else\r\n            return this._transparentQueue;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _clearRenderQueue(): void {\r\n        this._opaqueQueue.clear();\r\n        this._transparentQueue.clear();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * \r\n     */\r\n    destroy(destroyChild: boolean = true): void {\r\n        if (this._destroyed)\r\n            return;\r\n        super.destroy(destroyChild);\r\n        this._nativeObj = null;\r\n        this._skyRenderer.destroy();\r\n        this._skyRenderer = null;\r\n        this._directionLights = null;\r\n        this._pointLights = null;\r\n        this._spotLights = null;\r\n        this._alternateLights = null;\r\n        this._shaderValues.destroy();\r\n        this._opaqueQueue.destroy();\r\n        this._transparentQueue.destroy();\r\n        (RenderContext3D._instance.scene == this) && (RenderContext3D._instance.scene = null);\r\n        this._shaderValues = null;\r\n        this.sceneRenderableManager.destroy();\r\n        this._sceneRenderManager = null\r\n        this._cameraPool = null;\r\n        // this._octree = null;\r\n        this._physicsManager && this._physicsManager.destroy();\r\n        // this._reflection._removeReference();\r\n        // this._reflection = null;\r\n        var maps: Lightmap[] = this._lightmaps;\r\n        if (maps) {\r\n            for (var i: number = 0, n: number = maps.length; i < n; i++) {\r\n                var map: Lightmap = maps[i];\r\n                map.lightmapColor && map.lightmapColor._removeReference();\r\n                map.lightmapDirection && map.lightmapDirection._removeReference();\r\n            }\r\n        }\r\n        //this._sceneUniformData.destroy();\r\n        this._lightmaps = null;\r\n        this._volumeManager.destroy();\r\n        this._componentDriver.callDestroy();\r\n\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    render(ctx: Context): void {\r\n        if (this._children.length > 0) {\r\n            ctx.addRenderObject3D(this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    renderSubmit(): number {\r\n        if (this._renderByEditor) return 1;\r\n        BufferState._curBindedBufferState && BufferState._curBindedBufferState.unBind();\r\n        this._prepareSceneToRender();\r\n        var i: number, n: number, n1: number;\r\n        Scene3D._updateMark++;\r\n        // if (this._sceneUniformData) {\r\n        // \tthis._sceneUniformObj && this._sceneUniformObj.setDataByUniformBufferData(this._sceneUniformData);\r\n        // }\r\n        for (i = 0, n = this._cameraPool.length, n1 = n - 1; i < n; i++) {\r\n            // if (Render.supportWebGLPlusRendering)\r\n            // \tShaderData.setRuntimeValueMode((i == n1) ? true : false);\r\n\r\n            var camera: Camera = (<Camera>this._cameraPool[i]);\r\n            if (camera.renderTarget)\r\n                (camera.enableBuiltInRenderTexture = false);//TODO:\r\n            else\r\n                camera.enableBuiltInRenderTexture = true;\r\n\r\n            camera.enableRender && camera.render();\r\n            Scene3D._blitTransRT = null;\r\n\r\n            if (camera.enableRender && !camera.renderTarget) {\r\n                (Scene3D._blitTransRT = camera._internalRenderTexture);\r\n                var canvasWidth: number = camera._getCanvasWidth(), canvasHeight: number = camera._getCanvasHeight();\r\n                Scene3D._blitOffset.setValue(camera.viewport.x / canvasWidth, camera.viewport.y / canvasHeight, camera.viewport.width / canvasWidth, camera.viewport.height / canvasHeight);\r\n                this.blitMainCanvans(Scene3D._blitTransRT, camera.normalizedViewport, camera);\r\n            }\r\n            if (!camera._cacheDepth) {\r\n                camera.enableRender && camera._needInternalRenderTexture() && (!camera._internalRenderTexture._inPool) && RenderTexture.recoverToPool(camera._internalRenderTexture);\r\n            }\r\n\r\n        }\r\n        Context.set2DRenderConfig();//2D\r\n        RenderTexture.clearPool();\r\n        return 1;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param source \r\n     * @param normalizeViewPort \r\n     * @param camera \r\n     * @returns \r\n     */\r\n    blitMainCanvans(source: BaseTexture, normalizeViewPort: Viewport, camera: Camera) {\r\n        if (!source)\r\n            return;\r\n        Scene3D.mainCavansViewPort.x = RenderContext3D.clientWidth * normalizeViewPort.x | 0;\r\n        Scene3D.mainCavansViewPort.y = RenderContext3D.clientHeight * normalizeViewPort.y | 0;\r\n        Scene3D.mainCavansViewPort.width = RenderContext3D.clientWidth * normalizeViewPort.width | 0;\r\n        Scene3D.mainCavansViewPort.height = RenderContext3D.clientHeight * normalizeViewPort.height | 0;\r\n        source.filterMode = FilterMode.Bilinear;\r\n        if (camera.fxaa)\r\n            BlitFrameBufferCMD.shaderdata.addDefine(BaseCamera.SHADERDEFINE_FXAA);\r\n        var cmd = BlitFrameBufferCMD.create(source, null, Scene3D.mainCavansViewPort, null, null, BlitFrameBufferCMD.shaderdata);\r\n        cmd.run();\r\n        cmd.recover();\r\n        BlitFrameBufferCMD.shaderdata.removeDefine(BaseCamera.SHADERDEFINE_FXAA);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    getRenderType(): number {\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    releaseRender(): void {\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    reUse(context: Context, pos: number): number {\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param name \r\n     * @param shaderDataType \r\n     * @param value \r\n     */\r\n    setGlobalShaderValue(name: string, type: ShaderDataType, value: ShaderDataItem) {\r\n        var shaderOffset = Shader3D.propertyNameToID(name);\r\n        this._shaderValues.setShaderData(shaderOffset, type, value);\r\n    }\r\n    //--------------------------------------------------------deprecated------------------------------------------------------------------------\r\n\r\n    /**\r\n     * @deprecated\r\n     */\r\n    get fogRange(): number {\r\n        return this._fogParams.y - this.fogParams.x;\r\n    }\r\n\r\n    set fogRange(value: number) {\r\n        this._fogParams.y = value + this.fogParams.x;\r\n        this.fogParams = this._fogParams;\r\n    }\r\n\r\n    /**\r\n     * @deprecated\r\n     * \r\n     * @param value \r\n     */\r\n    setlightmaps(value: Texture2D[]): void {\r\n        var maps: Lightmap[] = this._lightmaps;\r\n        for (var i: number = 0, n: number = maps.length; i < n; i++)\r\n            maps[i].lightmapColor._removeReference();\r\n        if (value) {\r\n            var count: number = value.length;\r\n            maps.length = count;\r\n            for (i = 0; i < count; i++) {\r\n                var lightMap: Texture2D = value[i];\r\n                lightMap._addReference();\r\n                (maps[i]) || (maps[i] = new Lightmap());\r\n                maps[i].lightmapColor = lightMap;\r\n            }\r\n        } else {\r\n            throw new Error(\"Scene3D: value value can't be null.\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @deprecated\r\n     * \r\n     * @return \r\n     */\r\n    getlightmaps(): Texture2D[] {\r\n        var lightmapColors: Texture2D[] = new Array(this._lightmaps.length);\r\n        for (var i: number = 0; i < this._lightmaps.length; i++) {\r\n            lightmapColors[i] = this._lightmaps[i].lightmapColor;\r\n        }\r\n        return lightmapColors;//slice()\r\n    }\r\n}","\r\nimport { Config3D } from \"../../../Config3D\";\r\nimport { ILaya3D } from \"../../../ILaya3D\";\r\nimport { Node } from \"../../display/Node\";\r\nimport { Event } from \"../../events/Event\";\r\nimport { BaseTexture } from \"../../resource/BaseTexture\";\r\nimport { PostProcess } from \"../component/PostProcess\";\r\nimport { DepthPass, DepthTextureMode } from \"../depthMap/DepthPass\";\r\nimport { Cluster } from \"../graphics/renderPath/Cluster\";\r\nimport { BoundFrustum } from \"../math/BoundFrustum\";\r\nimport { Ray } from \"../math/Ray\";\r\nimport { Viewport } from \"../math/Viewport\";\r\nimport { Picker } from \"../utils/Picker\";\r\nimport { BaseCamera } from \"./BaseCamera\";\r\nimport { DirectionLightCom } from \"./light/DirectionLightCom\";\r\nimport { ShadowMode } from \"./light/ShadowMode\";\r\nimport { ShadowUtils } from \"./light/ShadowUtils\";\r\nimport { BlitScreenQuadCMD } from \"./render/command/BlitScreenQuadCMD\";\r\nimport { CommandBuffer } from \"./render/command/CommandBuffer\";\r\nimport { RenderContext3D } from \"./render/RenderContext3D\";\r\nimport { Scene3D } from \"./scene/Scene3D\";\r\nimport { Scene3DShaderDeclaration } from \"./scene/Scene3DShaderDeclaration\";\r\nimport { Transform3D } from \"./Transform3D\";\r\nimport { FilterMode } from \"../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { RenderTargetFormat } from \"../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { RenderCapable } from \"../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ILaya } from \"../../../ILaya\";\r\nimport { ShadowLightType } from \"../shadowMap/ShadowLightType\";\r\nimport { TextureCube } from \"../../resource/TextureCube\";\r\nimport { TextureFormat } from \"../../RenderEngine/RenderEnum/TextureFormat\";\r\nimport { Texture2D } from \"../../resource/Texture2D\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector2 } from \"../../maths/Vector2\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../resource/RenderTexture\";\r\nimport { Stat } from \"../../utils/Stat\";\r\nimport { WrapMode } from \"../../RenderEngine/RenderEnum/WrapMode\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\n\r\n/**\r\n * \r\n */\r\nexport enum CameraClearFlags {\r\n    /***/\r\n    SolidColor,\r\n    /***/\r\n    Sky,\r\n    /***/\r\n    DepthOnly,\r\n    /***/\r\n    Nothing,\r\n    /** */\r\n    ColorOnly,\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport enum CameraEventFlags {\r\n    //BeforeDepthTexture,\r\n    //AfterDepthTexture,\r\n    //BeforeDepthNormalsTexture,\r\n    //AfterDepthNormalTexture,\r\n    /***/\r\n    BeforeForwardOpaque = 0,\r\n    /***/\r\n    BeforeSkyBox = 2,\r\n    /***/\r\n    BeforeTransparent = 4,\r\n    /***/\r\n    BeforeImageEffect = 6,\r\n    /***/\r\n    AfterEveryThing = 8,\r\n}\r\n\r\n/**\r\n * <code>Camera</code> \r\n */\r\nexport class Camera extends BaseCamera {\r\n    /** @internal */\r\n    static _tempVector20: Vector2 = new Vector2();\r\n    /** @internal*/\r\n    static _context3DViewPortCatch: Viewport = new Viewport(0, 0, 0, 0);\r\n    static _contextScissorPortCatch: Vector4 = new Vector4(0, 0, 0, 0);\r\n\r\n    /** @internal */\r\n    static __updateMark: number = 0;\r\n    static set _updateMark(value: number) {\r\n        Camera.__updateMark = value;\r\n    }\r\n\r\n    static get _updateMark(): number {\r\n        return Camera.__updateMark;\r\n    }\r\n\r\n    /** @internal */\r\n    static depthPass: DepthPass;\r\n\r\n    /**\r\n     * scenescene\r\n     * @param camera \r\n     * @param scene \r\n     * @param shader \r\n     * @param replacementTag \r\n     */\r\n    static drawRenderTextureByScene(camera: Camera, scene: Scene3D, renderTexture: RenderTexture, shader: Shader3D = null, replaceFlag: string = null): RenderTexture {\r\n        if (!renderTexture) return null;\r\n        Scene3D._updateMark++;\r\n        //@ts-ignore\r\n        scene._prepareSceneToRender();\r\n        scene._setCullCamera(camera);\r\n        let recoverTexture = camera.renderTarget;\r\n        camera.renderTarget = renderTexture;\r\n\r\n        var viewport: Viewport = camera.viewport;\r\n        var needInternalRT: boolean = camera._needInternalRenderTexture();\r\n        var context: RenderContext3D = RenderContext3D._instance;\r\n        var scene: Scene3D = context.scene = scene\r\n        context.pipelineMode = context.configPipeLineMode;\r\n        context.replaceTag = replaceFlag;\r\n        context.customShader = shader;\r\n\r\n        if (needInternalRT) {\r\n            camera._internalRenderTexture = RenderTexture.createFromPool(viewport.width, viewport.height, camera._getRenderTextureFormat(), camera.depthTextureFormat, false, camera.msaa ? 4 : 1, false, camera._needRenderGamma(camera._getRenderTextureFormat()));\r\n            camera._internalRenderTexture.filterMode = FilterMode.Bilinear;\r\n        }\r\n        else {\r\n            camera._internalRenderTexture = null;\r\n        }\r\n        scene._componentDriver.callPreRender();\r\n        var needShadowCasterPass: boolean = camera._renderShadowMap(scene, context);\r\n        camera._preRenderMainPass(context, scene, needInternalRT, viewport);\r\n        camera._renderMainPass(context, viewport, scene, shader, replaceFlag, needInternalRT);\r\n        camera._aftRenderMainPass(needShadowCasterPass);\r\n        camera.renderTarget = recoverTexture;\r\n        scene.recaculateCullCamera();\r\n        scene._componentDriver.callPostRender();\r\n        if (camera._internalRenderTexture)\r\n            (!camera._internalRenderTexture._inPool) && RenderTexture.recoverToPool(camera._internalRenderTexture);\r\n        return renderTexture;\r\n    }\r\n\r\n    /**\r\n     * get PixelTexture\r\n     * @param texture \r\n     * @returns \r\n     */\r\n    static getTexturePixel(texture: Texture2D): ArrayBufferView {\r\n        let coverFilter = texture.filterMode;\r\n        texture.filterMode = FilterMode.Point;\r\n        let rtFormat = RenderTargetFormat.R8G8B8;\r\n        let pixelData;\r\n        let size = texture.width * texture.height;\r\n        switch (texture.format) {\r\n            case TextureFormat.R32G32B32A32:\r\n            case TextureFormat.R16G16B16A16:\r\n                rtFormat = RenderTargetFormat.R32G32B32A32;\r\n                pixelData = new Float32Array(size * 4);\r\n                break;\r\n            case TextureFormat.R32G32B32:\r\n            case TextureFormat.R16G16B16:\r\n                rtFormat = RenderTargetFormat.R32G32B32;\r\n                pixelData = new Float32Array(size * 3);\r\n                break;\r\n            case TextureFormat.R5G6B5:\r\n            case TextureFormat.R8G8B8:\r\n                rtFormat = RenderTargetFormat.R8G8B8;\r\n                pixelData = new Uint8Array(size * 3);\r\n                break;\r\n            default:\r\n                rtFormat = RenderTargetFormat.R8G8B8A8;\r\n                pixelData = new Uint8Array(size * 4);\r\n                break;\r\n        }\r\n        let rt = new RenderTexture(texture.width, texture.height, rtFormat, RenderTargetFormat.None, false, 0, false);\r\n        var blit: BlitScreenQuadCMD = BlitScreenQuadCMD.create(texture, rt);\r\n        blit.setContext(RenderContext3D._instance);\r\n        blit.run();\r\n        blit.recover();\r\n        texture.filterMode = coverFilter;\r\n        rt.getData(0, 0, texture.width, texture.height, pixelData);\r\n        rt.destroy();//\r\n        return pixelData;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param position \r\n     * @param scene \r\n     * @param renderCubeSize \r\n     * @param format \r\n     * @returns bake front left right up down\r\n     */\r\n    static drawTextureCubePixelByScene(camera: Camera, scene: Scene3D, renderCubeSize: number, format: TextureFormat, cullingMask: number): ArrayBufferView[] {\r\n        let rtFormat = RenderTargetFormat.R8G8B8;\r\n        let pixelData;\r\n        let size = renderCubeSize * renderCubeSize;\r\n        let bytelength;\r\n        switch (format) {\r\n            case TextureFormat.R32G32B32A32:\r\n            case TextureFormat.R16G16B16A16:\r\n                rtFormat = RenderTargetFormat.R32G32B32A32;\r\n                size *= 4;\r\n                bytelength = 4;\r\n                break;\r\n            case TextureFormat.R32G32B32:\r\n            case TextureFormat.R16G16B16:\r\n                rtFormat = RenderTargetFormat.R32G32B32;\r\n                size *= 3;\r\n                bytelength = 4;\r\n                break;\r\n            case TextureFormat.R5G6B5:\r\n            case TextureFormat.R8G8B8:\r\n                rtFormat = RenderTargetFormat.R8G8B8;\r\n                size *= 3;\r\n                bytelength = 1;\r\n                break;\r\n            case TextureFormat.R8G8B8A8:\r\n                rtFormat = RenderTargetFormat.R8G8B8A8;\r\n                pixelData = new Uint8Array(size * 4);\r\n                size *= 4;\r\n                bytelength = 1;\r\n                break;\r\n            default:\r\n                throw \"Type is not supported\";\r\n                break;\r\n        }\r\n        let rt = new RenderTexture(renderCubeSize, renderCubeSize, rtFormat, RenderTargetFormat.DEPTH_16, false, 0, false, false);\r\n        camera.fieldOfView = 90;\r\n        camera.cullingMask = cullingMask;\r\n        // bake 0,1,0,0\r\n        //front 0,0,0,1\r\n        //left 0,0.7071068,0,0.7071068\r\n        //right 0,0.7071068,0,-0.7071068\r\n        //up 0,0.7071068,-0.7071068,0\r\n        //down 0,-0.7071068,-0.7071068,0\r\n        let pixels: ArrayBufferView[] = [];\r\n        let quaterionArray = [\r\n            new Quaternion(0, 1, 0, 0),\r\n            new Quaternion(0, 0, 0, 1),\r\n            new Quaternion(0, 0.7071068, 0, 0.7071068),\r\n            new Quaternion(0, 0.7071068, 0, -0.7071068),\r\n            new Quaternion(0, 0.7071068, -0.7071068, 0),\r\n            new Quaternion(0, -0.7071068, -0.7071068, 0),\r\n        ];\r\n        for (var i = 0; i < 6; i++) {\r\n            camera.transform.rotation = quaterionArray[i];\r\n            this.drawRenderTextureByScene(camera, scene, rt);\r\n            if (bytelength == 4)\r\n                pixelData = new Float32Array(size);\r\n            else\r\n                pixelData = new Uint8Array(size);\r\n            pixels[i] = rt.getData(0, 0, renderCubeSize, renderCubeSize, pixelData);\r\n        }\r\n        rt.destroy();\r\n        return pixels;\r\n    }\r\n\r\n    static drawTextureCubeByScene(camera: Camera, position: Vector3, scene: Scene3D, renderCubeSize: number, format: TextureFormat, cullingMask: number = 0): TextureCube {\r\n        camera.transform.position = position;\r\n        let pixels = this.drawTextureCubePixelByScene(camera, scene, renderCubeSize, format, cullingMask);\r\n        let finalformat: TextureFormat;\r\n        switch (format) {\r\n            case TextureFormat.R32G32B32A32:\r\n            case TextureFormat.R16G16B16A16:\r\n                finalformat = TextureFormat.R32G32B32A32;\r\n                break;\r\n            case TextureFormat.R32G32B32:\r\n            case TextureFormat.R16G16B16:\r\n                finalformat = TextureFormat.R32G32B32;\r\n                break;\r\n            case TextureFormat.R5G6B5:\r\n            case TextureFormat.R8G8B8:\r\n                finalformat = TextureFormat.R8G8B8;\r\n                break;\r\n            case TextureFormat.R8G8B8A8:\r\n                finalformat = TextureFormat.R8G8B8A8;\r\n                break;\r\n            default:\r\n                throw \"Type is not supported\";\r\n        }\r\n        let textureCube = new TextureCube(renderCubeSize, format, true, false);\r\n        textureCube.setPixelsData(pixels, false, false);\r\n        return textureCube;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n        Camera.depthPass = new DepthPass();\r\n    }\r\n\r\n\r\n    /** @internal */\r\n    protected _aspectRatio: number;\r\n    /** @internal */\r\n    protected _viewport: Viewport;\r\n    /** @internal */\r\n    protected _rayViewport: Viewport;\r\n    /** @internal */\r\n    protected _normalizedViewport: Viewport;\r\n    /** @internal */\r\n    protected _viewMatrix: Matrix4x4;\r\n    /** @internal */\r\n    protected _projectionMatrix: Matrix4x4;\r\n    /** @internal */\r\n    protected _projectionViewMatrix: Matrix4x4;\r\n    /** @internal */\r\n    protected _boundFrustum: BoundFrustum;\r\n    /** @internal */\r\n    private _updateViewMatrix: boolean = true;\r\n    /** @internal */\r\n    protected _postProcess: PostProcess = null;\r\n    /** @internal */\r\n    protected _enableHDR: boolean = false;\r\n    /** @internal */\r\n    private _viewportParams: Vector4 = new Vector4();\r\n    /** @internal */\r\n    private _projectionParams: Vector4 = new Vector4();\r\n    /** @internal*/\r\n    protected _needBuiltInRenderTexture: boolean = false;\r\n    /**@internal */\r\n    protected _msaa: boolean = false;\r\n    /**@internal */\r\n    private _fxaa: boolean = false;\r\n    /** @internal*/\r\n    private _depthTextureMode: DepthTextureMode;\r\n    /** @internal */\r\n    _offScreenRenderTexture: RenderTexture = null;\r\n    /** @internal */\r\n    _internalRenderTexture: RenderTexture = null;\r\n    /** @internal*/\r\n    _canBlitDepth: boolean = false;\r\n    /**@internal */\r\n    _internalCommandBuffer: CommandBuffer = new CommandBuffer();\r\n    /** */\r\n    protected _depthTextureFormat: RenderTargetFormat = RenderTargetFormat.DEPTH_16;\r\n    /** */\r\n    private _depthTexture: BaseTexture;\r\n    /** */\r\n    private _depthNormalsTexture: RenderTexture;\r\n\r\n    /**  */\r\n    private _opaqueTexture: RenderTexture;\r\n    /**  */\r\n    private _opaquePass: boolean;\r\n\r\n\r\n    private _cameraEventCommandBuffer: { [key: string]: CommandBuffer[] } = {};\r\n    /**@internal CommanBuffer */\r\n    private _shadowCasterCommanBuffer: CommandBuffer[] = [];\r\n\r\n    /** @internal */\r\n    _clusterXPlanes: Vector3[];\r\n    /** @internal */\r\n    _clusterYPlanes: Vector3[];\r\n    /** @internal */\r\n    _clusterPlaneCacheFlag: Vector2 = new Vector2(-1, -1);\r\n    /** @internal */\r\n    _screenOffsetScale: Vector4 = new Vector4();\r\n\r\n    /***/\r\n    enableRender: boolean = true;\r\n    /***/\r\n    clearFlag: CameraClearFlags = CameraClearFlags.SolidColor;\r\n    /**Depth */\r\n    _cacheDepth: boolean\r\n    /**cache  */\r\n    _cacheDepthTexture: RenderTexture;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get aspectRatio(): number {\r\n        if (this._aspectRatio === 0) {\r\n            var vp: Viewport = this.viewport;\r\n            return vp.width / vp.height;\r\n        }\r\n        return this._aspectRatio;\r\n    }\r\n\r\n    set aspectRatio(value: number) {\r\n        if (value < 0)\r\n            throw new Error(\"Camera: the aspect ratio has to be a positive real number.\");\r\n        this._aspectRatio = value;\r\n        this._calculateProjectionMatrix();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get viewport(): Viewport {//TODO:\r\n        if (this._offScreenRenderTexture)\r\n            this._calculationViewport(this._normalizedViewport, this._offScreenRenderTexture.width, this._offScreenRenderTexture.height);\r\n        else\r\n            this._calculationViewport(this._normalizedViewport, this.clientWidth, this.clientHeight);//,\r\n        return this._viewport;\r\n    }\r\n\r\n    set viewport(value: Viewport) {\r\n        var width: number;\r\n        var height: number;\r\n        if (this._offScreenRenderTexture) {\r\n            width = this._offScreenRenderTexture.width;\r\n            height = this._offScreenRenderTexture.height;\r\n        } else {\r\n            width = this.clientWidth;\r\n            height = this.clientHeight;\r\n        }\r\n        this._normalizedViewport.x = value.x / width;\r\n        this._normalizedViewport.y = value.y / height;\r\n        this._normalizedViewport.width = value.width / width;\r\n        this._normalizedViewport.height = value.height / height;\r\n        this._calculationViewport(this._normalizedViewport, width, height);\r\n        this._calculateProjectionMatrix();\r\n    }\r\n\r\n    get clientWidth(): number {\r\n        ILaya.stage.needUpdateCanvasSize();\r\n        if (Config3D.customResolution)\r\n            return Config3D.pixelRatio * Config3D._resoluWidth | 0;\r\n        else\r\n            return RenderContext3D.clientWidth * Config3D.pixelRatio | 0;\r\n    }\r\n\r\n    get clientHeight(): number {\r\n        ILaya.stage.needUpdateCanvasSize();\r\n        if (Config3D.customResolution)\r\n            return Config3D.pixelRatio * Config3D._resoluHeight | 0;\r\n        else\r\n            return RenderContext3D.clientHeight * Config3D.pixelRatio | 0;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    set msaa(value: boolean) {\r\n        LayaGL.renderEngine.getCapable(RenderCapable.MSAA) ? this._msaa = value : this._msaa = false;\r\n    }\r\n\r\n\r\n    get msaa(): boolean {\r\n        return this._msaa && Stat.enablemsaa;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set fxaa(value: boolean) {\r\n        this._fxaa = value;\r\n    }\r\n\r\n    get fxaa(): boolean {\r\n        return this._fxaa;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get normalizedViewport(): Viewport {\r\n        return this._normalizedViewport;\r\n    }\r\n\r\n    set normalizedViewport(value: Viewport) {\r\n        var width: number;\r\n        var height: number;\r\n        if (this._offScreenRenderTexture) {\r\n            width = this._offScreenRenderTexture.width;\r\n            height = this._offScreenRenderTexture.height;\r\n        } else {\r\n            width = this.clientWidth;\r\n            height = this.clientHeight;\r\n        }\r\n        if (this._normalizedViewport !== value)\r\n            value.cloneTo(this._normalizedViewport);\r\n        this._calculationViewport(value, width, height);\r\n        this._calculateProjectionMatrix();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get viewMatrix(): Matrix4x4 {\r\n        if (this._updateViewMatrix) {\r\n            var scale: Vector3 = this.transform.getWorldLossyScale();\r\n            var scaleX: number = scale.x;\r\n            var scaleY: number = scale.y;\r\n            var scaleZ: number = scale.z;\r\n            var viewMatE: Float32Array = this._viewMatrix.elements;\r\n\r\n            this.transform.worldMatrix.cloneTo(this._viewMatrix)\r\n            viewMatE[0] /= scaleX;//\r\n            viewMatE[1] /= scaleX;\r\n            viewMatE[2] /= scaleX;\r\n            viewMatE[4] /= scaleY;\r\n            viewMatE[5] /= scaleY;\r\n            viewMatE[6] /= scaleY;\r\n            viewMatE[8] /= scaleZ;\r\n            viewMatE[9] /= scaleZ;\r\n            viewMatE[10] /= scaleZ;\r\n            this._viewMatrix.invert(this._viewMatrix);\r\n            this._updateViewMatrix = false;\r\n        }\r\n        return this._viewMatrix;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get projectionMatrix(): Matrix4x4 {\r\n        return this._projectionMatrix;\r\n    }\r\n\r\n    set projectionMatrix(value: Matrix4x4) {\r\n        this._projectionMatrix = value;\r\n        this._useUserProjectionMatrix = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get projectionViewMatrix(): Matrix4x4 {\r\n        Matrix4x4.multiply(this.projectionMatrix, this.viewMatrix, this._projectionViewMatrix);\r\n        return this._projectionViewMatrix;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get boundFrustum(): BoundFrustum {\r\n        this._boundFrustum.matrix = this.projectionViewMatrix;\r\n        return this._boundFrustum;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get renderTarget(): RenderTexture {\r\n        return this._offScreenRenderTexture;\r\n    }\r\n\r\n    set renderTarget(value: RenderTexture) {\r\n        var lastValue: RenderTexture = this._offScreenRenderTexture;\r\n        if (lastValue !== value) {\r\n            (lastValue) && (lastValue._isCameraTarget = false);\r\n            (value) && (value._isCameraTarget = true);\r\n            this._offScreenRenderTexture = value;\r\n            this._calculateProjectionMatrix();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get postProcess(): PostProcess {\r\n        return this._postProcess;\r\n    }\r\n\r\n    set postProcess(value: PostProcess) {\r\n        this._postProcess = value;\r\n        //if (!value) return;\r\n        //value && value._init(this);\r\n    }\r\n\r\n    /**\r\n     * HDR\r\n     * \r\n     */\r\n    get enableHDR(): boolean {\r\n        return this._enableHDR;\r\n    }\r\n\r\n    set enableHDR(value: boolean) {\r\n        if (value && !LayaGL.renderEngine.getCapable(RenderCapable.RenderTextureFormat_R16G16B16A16)) {\r\n            console.warn(\"Camera:can't enable HDR in this device.\");\r\n            return;\r\n        }\r\n        this._enableHDR = value;\r\n    }\r\n\r\n    /**\r\n     * RenderTextureCommandBuffertrue\r\n     * CommandBuffer\r\n     */\r\n    get enableBuiltInRenderTexture(): boolean {\r\n        return this._needBuiltInRenderTexture;\r\n    }\r\n\r\n    set enableBuiltInRenderTexture(value: boolean) {\r\n        this._needBuiltInRenderTexture = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get depthTextureMode(): DepthTextureMode {\r\n        return this._depthTextureMode;\r\n    }\r\n\r\n    set depthTextureMode(value: DepthTextureMode) {\r\n        this._depthTextureMode = value;\r\n    }\r\n\r\n    /**\r\n     * OpaquePass\r\n     */\r\n    set opaquePass(value: boolean) {\r\n        if (value == this._opaquePass)\r\n            return;\r\n        if (!value) {\r\n            this._shaderValues.setTexture(BaseCamera.OPAQUETEXTURE, Texture2D.blackTexture);\r\n            this._shaderValues.setVector(BaseCamera.OPAQUETEXTUREPARAMS, Vector4.ONE);\r\n            this._opaqueTexture && RenderTexture.recoverToPool(this._opaqueTexture);\r\n            this._opaqueTexture = null;\r\n        }\r\n        this._opaquePass = value;\r\n    }\r\n\r\n    get opaquePass() {\r\n        return this._opaquePass;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get depthTextureFormat(): RenderTargetFormat {\r\n        return this._depthTextureFormat;\r\n    }\r\n    set depthTextureFormat(value: RenderTargetFormat) {\r\n        this._depthTextureFormat = value;\r\n    }\r\n\r\n\r\n    /**\r\n     * (TODO:,)\r\n     */\r\n    set enableBlitDepth(value: boolean) {\r\n        if (value == this._canBlitDepth)\r\n            return;\r\n        this._canBlitDepth = value;\r\n        this._cacheDepth = value;\r\n        if (value)\r\n            this._internalRenderTexture && (this._internalRenderTexture.generateDepthTexture = true);\r\n        else {\r\n            this._internalRenderTexture && (this._internalRenderTexture.generateDepthTexture = false);\r\n            if (this._cacheDepthTexture)\r\n                this._cacheDepthTexture._inPool ? 0 : RenderTexture.recoverToPool(this._cacheDepthTexture);\r\n        }\r\n\r\n    }\r\n    get enableBlitDepth() {\r\n        return this._canBlitDepth;\r\n    }\r\n    get canblitDepth() {\r\n        return this._canBlitDepth && this._internalRenderTexture && this._internalRenderTexture.depthStencilFormat != null;\r\n    }\r\n\r\n    /**\r\n     *  <code>Camera</code> \r\n     * @param\taspectRatio \r\n     * @param\tnearPlane \r\n     * @param\tfarPlane \r\n     */\r\n    constructor(aspectRatio: number = 0, nearPlane: number = 0.3, farPlane: number = 1000) {\r\n        super(nearPlane, farPlane);\r\n        this._viewMatrix = new Matrix4x4();\r\n        this._projectionMatrix = new Matrix4x4();\r\n        this._projectionViewMatrix = new Matrix4x4();\r\n        this._viewport = new Viewport(0, 0, 0, 0);\r\n        this._normalizedViewport = new Viewport(0, 0, 1, 1);\r\n        this._rayViewport = new Viewport(0, 0, 0, 0);\r\n        this._aspectRatio = aspectRatio;\r\n        this._boundFrustum = new BoundFrustum(new Matrix4x4());\r\n        this._depthTextureMode = 0;\r\n        this.opaquePass = false;\r\n        this._calculateProjectionMatrix();\r\n        ILaya.stage.on(Event.RESIZE, this, this._onScreenSizeChanged);\r\n        this.transform.on(Event.TRANSFORM_CHANGED, this, this._onTransformChanged);\r\n        this.opaquePass = false;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _calculationViewport(normalizedViewport: Viewport, width: number, height: number): void {\r\n        var lx: number = normalizedViewport.x * width;//x\r\n        var ly: number = normalizedViewport.y * height;//y\r\n        var rx: number = lx + Math.max(normalizedViewport.width * width, 0);\r\n        var ry: number = ly + Math.max(normalizedViewport.height * height, 0);\r\n\r\n        var ceilLeftX: number = Math.ceil(lx);\r\n        var ceilLeftY: number = Math.ceil(ly);\r\n        var floorRightX: number = Math.floor(rx);\r\n        var floorRightY: number = Math.floor(ry);\r\n\r\n        var pixelLeftX: number = ceilLeftX - lx >= 0.5 ? Math.floor(lx) : ceilLeftX;\r\n        var pixelLeftY: number = ceilLeftY - ly >= 0.5 ? Math.floor(ly) : ceilLeftY;\r\n        var pixelRightX: number = rx - floorRightX >= 0.5 ? Math.ceil(rx) : floorRightX;\r\n        var pixelRightY: number = ry - floorRightY >= 0.5 ? Math.ceil(ry) : floorRightY;\r\n\r\n        this._viewport.x = pixelLeftX;\r\n        this._viewport.y = pixelLeftY;\r\n        this._viewport.width = pixelRightX - pixelLeftX;\r\n        this._viewport.height = pixelRightY - pixelLeftY;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    protected _calculateProjectionMatrix(): void {\r\n        if (!this._useUserProjectionMatrix) {\r\n            if (this._orthographic) {\r\n                var halfHeight: number = this.orthographicVerticalSize * 0.5;\r\n                var halfWidth: number = halfHeight * this.aspectRatio;\r\n                Matrix4x4.createOrthoOffCenter(-halfWidth, halfWidth, -halfHeight, halfHeight, this.nearPlane, this.farPlane, this._projectionMatrix);\r\n            } else {\r\n                Matrix4x4.createPerspective(3.1416 * this.fieldOfView / 180.0, this.aspectRatio, this.nearPlane, this.farPlane, this._projectionMatrix);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\t\r\n     * \t@param  layer \r\n     * \t@return \r\n     */\r\n    _isLayerVisible(layer: number): boolean {\r\n        return (Math.pow(2, layer) & this.cullingMask) != 0;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _onTransformChanged(flag: number): void {\r\n        flag &= Transform3D.TRANSFORM_WORLDMATRIX;//TRANSFORM\r\n        (flag) && (this._updateViewMatrix = true);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n        var clearFlagData: any = data.clearFlag;\r\n        (clearFlagData !== undefined) && (this.clearFlag = clearFlagData);\r\n        var viewport: any[] = data.viewport;\r\n        this.normalizedViewport = new Viewport(viewport[0], viewport[1], viewport[2], viewport[3]);\r\n        var enableHDR: boolean = data.enableHDR;\r\n        (enableHDR !== undefined) && (this.enableHDR = enableHDR);\r\n    }\r\n\r\n    clone(): Camera {\r\n        let camera = <Camera>super.clone();\r\n        camera.clearFlag = this.clearFlag;\r\n        this.clearColor.cloneTo(camera.clearColor);\r\n        camera.clearColor = camera.clearColor;\r\n        camera.viewport = this.viewport;\r\n        this.normalizedViewport.cloneTo(camera.normalizedViewport);\r\n        camera.enableHDR = this.enableHDR;\r\n        camera.farPlane = this.farPlane;\r\n        camera.nearPlane = this.nearPlane;\r\n        camera.fieldOfView = this.fieldOfView;\r\n        camera.orthographic = this.orthographic;\r\n        camera.orthographicVerticalSize = this.orthographicVerticalSize;\r\n        camera.opaquePass = this.opaquePass;\r\n        camera._cameraEventCommandBuffer = this._cameraEventCommandBuffer;\r\n        camera.opaquePass = this.opaquePass;\r\n        //Object.assign(camera._cameraEventCommandBuffer, this._cameraEventCommandBuffer);\r\n        return camera;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getCanvasWidth(): number {\r\n        if (this._offScreenRenderTexture)\r\n            return this._offScreenRenderTexture.width;\r\n        else\r\n            return this.clientWidth;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getCanvasHeight(): number {\r\n        if (this._offScreenRenderTexture)\r\n            return this._offScreenRenderTexture.height;\r\n        else\r\n            return this.clientHeight;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getRenderTexture(): RenderTexture {\r\n        return this._internalRenderTexture || this._offScreenRenderTexture;\r\n    }\r\n\r\n    /**\r\n     * Gamma\r\n     * @param rt \r\n     */\r\n    _needRenderGamma(rt: RenderTargetFormat) {\r\n        switch (rt) {\r\n            case RenderTargetFormat.R8G8B8:\r\n            case RenderTargetFormat.R8G8B8A8:\r\n                return true;\r\n            default:\r\n                return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _needInternalRenderTexture(): boolean {\r\n        return (this._postProcess && this._postProcess.enable) || this._enableHDR || this._needBuiltInRenderTexture ? true : false;//condition of internal RT\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getRenderTextureFormat(): RenderTargetFormat {\r\n        if (this._enableHDR)\r\n            return RenderTargetFormat.R16G16B16A16;\r\n        else\r\n            return RenderTargetFormat.R8G8B8A8;\r\n    }\r\n\r\n    /**\r\n     * update Camera Render\r\n     * @param context \r\n     */\r\n    _updateCameraRenderData(context: RenderContext3D) {\r\n        this._prepareCameraToRender();\r\n        this._applyViewProject(context, this.viewMatrix, this._projectionMatrix);\r\n    }\r\n\r\n\r\n    /**\r\n     * @override\r\n     * @internal\r\n     */\r\n    _prepareCameraToRender(): void {\r\n        super._prepareCameraToRender();\r\n        var vp: Viewport = this.viewport;\r\n        this._viewportParams.setValue(vp.x, vp.y, vp.width, vp.height);\r\n        this._projectionParams.setValue(this._nearPlane, this._farPlane, RenderContext3D._instance.invertY ? -1 : 1, 1 / this.farPlane);\r\n        this._shaderValues.setVector(BaseCamera.VIEWPORT, this._viewportParams);\r\n        this._shaderValues.setVector(BaseCamera.PROJECTION_PARAMS, this._projectionParams);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _applyViewProject(context: RenderContext3D, viewMat: Matrix4x4, proMat: Matrix4x4): void {\r\n        var projectView: Matrix4x4;\r\n        if (context.invertY) {\r\n            Matrix4x4.multiply(BaseCamera._invertYScaleMatrix, proMat, BaseCamera._invertYProjectionMatrix);\r\n            Matrix4x4.multiply(BaseCamera._invertYProjectionMatrix, viewMat, BaseCamera._invertYProjectionViewMatrix);\r\n            proMat = BaseCamera._invertYProjectionMatrix;\r\n            projectView = BaseCamera._invertYProjectionViewMatrix;\r\n        }\r\n        else {\r\n            Matrix4x4.multiply(proMat, viewMat, this._projectionViewMatrix);\r\n            projectView = this._projectionViewMatrix;\r\n        }\r\n\r\n        context.viewMatrix = viewMat;\r\n        context.projectionMatrix = proMat;\r\n        context.projectionViewMatrix = projectView;\r\n        this._shaderValues.setMatrix4x4(BaseCamera.VIEWMATRIX, viewMat);\r\n        this._shaderValues.setMatrix4x4(BaseCamera.PROJECTMATRIX, proMat);\r\n        this._shaderValues.setMatrix4x4(BaseCamera.VIEWPROJECTMATRIX, projectView);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _updateClusterPlaneXY(): void {\r\n        var fieldOfView: number = this.fieldOfView;\r\n        var aspectRatio: number = this.aspectRatio;\r\n        if (this._clusterPlaneCacheFlag.x !== fieldOfView || this._clusterPlaneCacheFlag.y !== aspectRatio) {\r\n            var clusterCount: Vector3 = Config3D.lightClusterCount;\r\n            var xSlixe: number = clusterCount.x, ySlice: number = clusterCount.y;\r\n            var xCount: number = xSlixe + 1, yCount: number = ySlice + 1;\r\n            var xPlanes: Vector3[] = this._clusterXPlanes, yPlanes: Vector3[] = this._clusterYPlanes;\r\n\r\n            if (!xPlanes) {\r\n                xPlanes = this._clusterXPlanes = new Array(xCount);\r\n                yPlanes = this._clusterYPlanes = new Array(yCount);\r\n                for (var i: number = 0; i < xCount; i++)\r\n                    xPlanes[i] = new Vector3();\r\n                for (var i: number = 0; i < yCount; i++)\r\n                    yPlanes[i] = new Vector3();\r\n            }\r\n            var halfY = Math.tan((this.fieldOfView / 2) * Math.PI / 180);\r\n            var halfX = this.aspectRatio * halfY;\r\n            var yLengthPerCluster = 2 * halfY / ySlice;\r\n            var xLengthPerCluster = 2 * halfX / xSlixe;\r\n            for (var i: number = 0; i < xCount; i++) {\r\n                var angle: number = -halfX + xLengthPerCluster * i;\r\n                var bigHypot: number = Math.sqrt(1 + angle * angle);\r\n                var normX: number = 1 / bigHypot;\r\n                var xPlane: Vector3 = xPlanes[i];\r\n                xPlane.setValue(normX, 0, -angle * normX);\r\n            }\r\n            //start from top is more similar to light pixel data\r\n            for (var i: number = 0; i < yCount; i++) {\r\n                var angle: number = halfY - yLengthPerCluster * i;\r\n                var bigHypot: number = Math.sqrt(1 + angle * angle);\r\n                var normY: number = -1 / bigHypot;\r\n                var yPlane: Vector3 = yPlanes[i];\r\n                yPlane.setValue(0, normY, -angle * normY);\r\n            }\r\n\r\n            this._clusterPlaneCacheFlag.x = fieldOfView;\r\n            this._clusterPlaneCacheFlag.y = aspectRatio;\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param event \r\n     * @param renderTarget \r\n     * @param context \r\n     */\r\n    _applyCommandBuffer(event: number, context: RenderContext3D) {\r\n        if (!Stat.enableCameraCMD)\r\n            return;\r\n        var commandBufferArray: CommandBuffer[] = this._cameraEventCommandBuffer[event];\r\n        if (!commandBufferArray || commandBufferArray.length == 0)\r\n            return;\r\n        commandBufferArray.forEach(function (value) {\r\n            value._context = context;\r\n            value._apply();\r\n        });\r\n        (RenderTexture.currentActive) && (RenderTexture.currentActive._end());\r\n        if (this._internalRenderTexture || this._offScreenRenderTexture)\r\n            this._getRenderTexture()._start();\r\n        else {\r\n            LayaGL.textureContext.bindoutScreenTarget();\r\n        }\r\n        LayaGL.renderEngine.viewport(0, 0, context.viewport.width, context.viewport.height);\r\n    }\r\n\r\n    /**\r\n     * apply \r\n     * @internal\r\n     */\r\n    _applyCasterPassCommandBuffer(context: RenderContext3D) {\r\n        if (!this._shadowCasterCommanBuffer || this._shadowCasterCommanBuffer.length == 0)\r\n            return;\r\n        this._shadowCasterCommanBuffer.forEach(function (value) {\r\n            value._context = context;\r\n            value._apply();\r\n        });\r\n    }\r\n\r\n    /**\r\n    * @internal\r\n    */\r\n    _addCasterShadowCommandBuffer(commandBuffer: CommandBuffer) {\r\n        if (this._shadowCasterCommanBuffer.indexOf(commandBuffer) < 0)\r\n            this._shadowCasterCommanBuffer.push(commandBuffer);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param commandBuffer \r\n     */\r\n    _removeCasterShadowCommandBuffer(commandBuffer: CommandBuffer) {\r\n        var index: number = this._shadowCasterCommanBuffer.indexOf(commandBuffer);\r\n        if (index != -1) this._shadowCasterCommanBuffer.splice(index, 1);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param scene \r\n     * @param context \r\n     */\r\n    _renderShadowMap(scene: Scene3D, context: RenderContext3D) {\r\n        if (Scene3D._updateMark % scene._ShadowMapupdateFrequency != 0) {\r\n            return false;\r\n        }\r\n\r\n        //render shadowMap\r\n        var shadowCasterPass;\r\n        var mainDirectLight: DirectionLightCom = scene._mainDirectionLight;\r\n        var needShadowCasterPass: boolean = mainDirectLight && mainDirectLight.shadowMode !== ShadowMode.None && ShadowUtils.supportShadow() && Stat.enableShadow;\r\n        if (needShadowCasterPass) {\r\n            scene._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT)\r\n            scene._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW);\r\n            shadowCasterPass = ILaya3D.Scene3D._shadowCasterPass;\r\n            shadowCasterPass.update(this, mainDirectLight, ShadowLightType.DirectionLight);\r\n            shadowCasterPass.render(context, scene, ShadowLightType.DirectionLight, this);\r\n        }\r\n        else {\r\n            scene._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW);\r\n        }\r\n        var spotMainLight = scene._mainSpotLight;\r\n        var spotneedShadowCasterPass: boolean = spotMainLight && spotMainLight.shadowMode !== ShadowMode.None && ShadowUtils.supportShadow() && Stat.enableShadow;\r\n        if (spotneedShadowCasterPass) {\r\n            scene._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW);\r\n            scene._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT);\r\n            shadowCasterPass = ILaya3D.Scene3D._shadowCasterPass;\r\n            shadowCasterPass.update(this, spotMainLight, ShadowLightType.SpotLight);\r\n            shadowCasterPass.render(context, scene, ShadowLightType.SpotLight, this);\r\n        }\r\n        else {\r\n            scene._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT);\r\n        }\r\n        if (needShadowCasterPass)\r\n            scene._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW);\r\n        if (spotneedShadowCasterPass)\r\n            scene._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT);\r\n\r\n        return needShadowCasterPass || spotneedShadowCasterPass;\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param context \r\n     * @param scene \r\n     * @param needInternalRT Rendertarget\r\n     * @param viewport \r\n     */\r\n    _preRenderMainPass(context: RenderContext3D, scene: Scene3D, needInternalRT: boolean, viewport: Viewport) {\r\n        context.camera = this;\r\n        context.cameraShaderValue = this._shaderValues;\r\n        Camera._updateMark++;\r\n\r\n        //TODO:webgl2 should use blitFramebuffer\r\n        //TODO:if adjacent camera param can use same internal RT can merge\r\n        //if need internal RT and no off screen RT and clearFlag is DepthOnly or Nothing, should grab the backBuffer\r\n        if (needInternalRT && !this._offScreenRenderTexture && (this.clearFlag == CameraClearFlags.DepthOnly || this.clearFlag == CameraClearFlags.Nothing)) {\r\n            if (RenderTexture.bindCanvasRender) {//iOSCopyTexSubImage2Dbug\r\n                if (RenderTexture.bindCanvasRender != this._internalRenderTexture) {\r\n                    var blit: BlitScreenQuadCMD = BlitScreenQuadCMD.create(RenderTexture.bindCanvasRender, this._internalRenderTexture);\r\n                    blit.setContext(context);\r\n                    blit.run();\r\n                    blit.recover();\r\n                }\r\n            } else {\r\n                if (this._enableHDR) {//internal RT is HDR can't directly copy\r\n                    var grabTexture: RenderTexture = RenderTexture.createFromPool(viewport.width, viewport.height, RenderTargetFormat.R8G8B8, RenderTargetFormat.DEPTH_16, false, 1);\r\n                    grabTexture.filterMode = FilterMode.Bilinear;\r\n                    this._renderEngine.copySubFrameBuffertoTex(grabTexture, 0, 0, 0, viewport.x, RenderContext3D.clientHeight - (viewport.y + viewport.height), viewport.width, viewport.height);\r\n                    // this._renderEngine.bindTexture(gl.TEXTURE_2D, grabTexture._getSource());\r\n                    // gl.copyTexSubImage2D(gl.TEXTURE_2D, 0, 0, 0, viewport.x, RenderContext3D.clientHeight - (viewport.y + viewport.height), viewport.width, viewport.height);\r\n                    var blit: BlitScreenQuadCMD = BlitScreenQuadCMD.create(grabTexture, this._internalRenderTexture);\r\n                    blit.setContext(context);\r\n                    blit.run();\r\n                    blit.recover();\r\n                    RenderTexture.recoverToPool(grabTexture);\r\n                }\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param context \r\n     * @param viewport \r\n     * @param scene \r\n     * @param shader shader\r\n     * @param replacementTag \r\n     * @param needInternalRT RT\r\n     */\r\n    _renderMainPass(context: RenderContext3D, viewport: Viewport, scene: Scene3D, shader: Shader3D, replacementTag: string, needInternalRT: boolean) {\r\n        var renderTex: RenderTexture = this._getRenderTexture();//renderTexturerenderTexture,,renderTexture\r\n        if (renderTex && renderTex._isCameraTarget)//Y\r\n            context.invertY = true;\r\n        else\r\n            context.invertY = false;\r\n        context.viewport = viewport;\r\n        //context\r\n        context.destTarget = renderTex;\r\n        this._prepareCameraToRender();\r\n        var multiLighting: boolean = Config3D._multiLighting;\r\n        (multiLighting) && (Cluster.instance.update(this, <Scene3D>(scene)));\r\n\r\n        context.customShader = shader;\r\n        context.replaceTag = replacementTag;\r\n        scene._preCulling(context, this);\r\n\r\n        this._applyViewProject(context, this.viewMatrix, this._projectionMatrix);\r\n        if (this._cameraUniformData) {//Depth\r\n            this._cameraUniformUBO && this._cameraUniformUBO.setDataByUniformBufferData(this._cameraUniformData);\r\n        }\r\n        // if (this.depthTextureMode != 0) {\r\n        //     //TODO:\r\n        this._renderDepthMode(context);\r\n        // }\r\n\r\n        // todo layame temp\r\n        (renderTex) && (renderTex._start());\r\n\r\n\r\n        scene._clear(context);\r\n\r\n        this._applyCommandBuffer(CameraEventFlags.BeforeForwardOpaque, context);\r\n\r\n        this.recoverRenderContext3D(context, renderTex);\r\n        Stat.enableOpaque && scene._renderScene(context, ILaya3D.Scene3D.SCENERENDERFLAG_RENDERQPAQUE);\r\n        this._applyCommandBuffer(CameraEventFlags.BeforeSkyBox, context);\r\n\r\n        scene._renderScene(context, ILaya3D.Scene3D.SCENERENDERFLAG_SKYBOX);\r\n        this._applyCommandBuffer(CameraEventFlags.BeforeTransparent, context);\r\n\r\n        this._opaquePass && this._createOpaqueTexture(renderTex, context);\r\n        this.recoverRenderContext3D(context, renderTex);\r\n\r\n        this.recoverRenderContext3D(context, renderTex);\r\n        Stat.enableTransparent && scene._renderScene(context, ILaya3D.Scene3D.SCENERENDERFLAG_RENDERTRANSPARENT);\r\n        //scene._componentDriver.callPostRender();//TODO:duo\r\n        this._applyCommandBuffer(CameraEventFlags.BeforeImageEffect, context);\r\n        (renderTex) && (renderTex._end());\r\n\r\n        if (needInternalRT && Stat.enablePostprocess) {\r\n            if (this._postProcess && this._postProcess.enable) {\r\n                this._postProcess.commandContext = context;\r\n                this._postProcess._render(this);\r\n                this._postProcess._applyPostProcessCommandBuffers();\r\n            } else if (this._enableHDR || this._needBuiltInRenderTexture) {\r\n                var canvasWidth: number = this._getCanvasWidth(), canvasHeight: number = this._getCanvasHeight();\r\n                if (this._offScreenRenderTexture) {\r\n                    this._screenOffsetScale.setValue(viewport.x / canvasWidth, (canvasHeight - viewport.y - viewport.height) / canvasHeight, viewport.width / canvasWidth, viewport.height / canvasHeight);\r\n                    this._internalCommandBuffer._camera = this;\r\n                    this._internalCommandBuffer._context = context;\r\n                    this._internalCommandBuffer.blitScreenQuad(this._internalRenderTexture, this._offScreenRenderTexture, this._screenOffsetScale, null, null, 0);\r\n                    this._internalCommandBuffer._apply();\r\n                    this._internalCommandBuffer.clear();\r\n                }\r\n            }\r\n        }\r\n        if (this._offScreenRenderTexture) {\r\n            RenderTexture.bindCanvasRender = null;\r\n        } else\r\n            RenderTexture.bindCanvasRender = this._internalRenderTexture;\r\n        this._applyCommandBuffer(CameraEventFlags.AfterEveryThing, context);\r\n\r\n        // if (renderTex && renderTex._isCameraTarget)//Y\r\n        //     context.invertY = false;\r\n    }\r\n\r\n    recoverRenderContext3D(context: RenderContext3D, renderTexture: RenderTexture) {\r\n        const cacheViewPor = Camera._context3DViewPortCatch;\r\n        const cacheScissor = Camera._contextScissorPortCatch;\r\n        context.changeViewport(cacheViewPor.x, cacheViewPor.y, cacheViewPor.width, cacheViewPor.height);\r\n        context.changeScissor(cacheScissor.x, cacheScissor.y, cacheScissor.z, cacheScissor.w);\r\n        context.destTarget = renderTexture;\r\n    }\r\n\r\n    /**\r\n     * camera\r\n     * @internal\r\n     */\r\n    _renderDepthMode(context: RenderContext3D) {\r\n        var cameraDepthMode = this._depthTextureMode;\r\n        if (this._postProcess && this._postProcess.enable) {\r\n            cameraDepthMode |= this._postProcess.cameraDepthTextureMode;\r\n        }\r\n        if ((cameraDepthMode & DepthTextureMode.Depth) != 0) {\r\n            // todo\r\n            if (!this.canblitDepth || !this._internalRenderTexture.depthStencilTexture) {\r\n                Camera.depthPass.update(this, DepthTextureMode.Depth, this._depthTextureFormat);\r\n                Camera.depthPass.render(context, DepthTextureMode.Depth);\r\n            }\r\n            else {\r\n                this.depthTexture = this._cacheDepthTexture.depthStencilTexture;\r\n                //@ts-ignore;\r\n                Camera.depthPass._depthTexture = this.depthTexture;\r\n                Camera.depthPass._setupDepthModeShaderValue(DepthTextureMode.Depth, this);\r\n            }\r\n        }\r\n        if ((cameraDepthMode & DepthTextureMode.DepthNormals) != 0) {\r\n            Camera.depthPass.update(this, DepthTextureMode.DepthNormals, this._depthTextureFormat);\r\n            Camera.depthPass.render(context, DepthTextureMode.DepthNormals);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    get depthTexture(): BaseTexture {\r\n        return this._depthTexture;\r\n    }\r\n\r\n    set depthTexture(value: BaseTexture) {\r\n        this._depthTexture = value;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    get depthNormalTexture(): RenderTexture {\r\n        return this._depthNormalsTexture;\r\n    }\r\n\r\n    set depthNormalTexture(value: RenderTexture) {\r\n        this._depthNormalsTexture = value;\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * @param needShadowPass \r\n     */\r\n    _aftRenderMainPass(needShadowPass: Boolean) {\r\n        // if (needShadowPass)\r\n        //     ILaya3D.Scene3D._shadowCasterPass.cleanUp();\r\n        if (this._cacheDepth && this._internalRenderTexture) {\r\n            if (this._cacheDepthTexture)\r\n                this._cacheDepthTexture._inPool ? 0 : RenderTexture.recoverToPool(this._cacheDepthTexture);\r\n            this._cacheDepthTexture = this._internalRenderTexture;\r\n        }\r\n        Camera.depthPass.cleanUp();\r\n    }\r\n\r\n\r\n    _createOpaqueTexture(currentTarget: RenderTexture, renderContext: RenderContext3D) {\r\n        if (!this._opaqueTexture) {\r\n            let tex = this._getRenderTexture();\r\n            // this._opaqueTexture = RenderTexture.createFromPool(tex.width, tex.height, tex.colorFormat, RenderTargetFormat.None, false, 1, false, true);\r\n            this._opaqueTexture = RenderTexture.createFromPool(1024, 1024, tex.colorFormat, RenderTargetFormat.None, true, 1, false, true);\r\n            this._opaqueTexture.filterMode = FilterMode.Bilinear;\r\n            this._opaqueTexture.wrapModeU = WrapMode.Clamp;\r\n            this._opaqueTexture.wrapModeV = WrapMode.Clamp;\r\n            this._shaderValues.setTexture(BaseCamera.OPAQUETEXTURE, this._opaqueTexture);\r\n\r\n            let opaqueTexParams = new Vector4();\r\n            opaqueTexParams.x = this._opaqueTexture.width;\r\n            opaqueTexParams.y = this._opaqueTexture.height;\r\n            opaqueTexParams.z = this._opaqueTexture.maxMipmapLevel;\r\n\r\n            this._shaderValues.setVector(BaseCamera.OPAQUETEXTUREPARAMS, opaqueTexParams);\r\n        }\r\n\r\n\r\n\r\n        var blit: BlitScreenQuadCMD = BlitScreenQuadCMD.create(currentTarget, this._opaqueTexture);\r\n        blit.setContext(renderContext);\r\n        blit.run();\r\n        blit.recover();\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @param shader \r\n     * @param replacementTag \r\n     */\r\n    render(shader: Shader3D = null, replacementTag: string = null): void {\r\n        if (!this.activeInHierarchy) //custom render should protected with activeInHierarchy=true\r\n            return;\r\n\r\n        var viewport: Viewport = this.viewport;\r\n        var needInternalRT: boolean = this._needInternalRenderTexture();\r\n        var context: RenderContext3D = RenderContext3D._instance;\r\n        var scene: Scene3D = context.scene = <Scene3D>this._scene;\r\n        scene._setCullCamera(this);\r\n        context.pipelineMode = context.configPipeLineMode;\r\n        context.replaceTag = replacementTag;\r\n        context.customShader = shader;\r\n        let texFormat = this._getRenderTextureFormat();\r\n\r\n        if (needInternalRT) {\r\n            if (this.msaa) {\r\n                this._internalRenderTexture = RenderTexture.createFromPool(viewport.width, viewport.height, texFormat, this._depthTextureFormat, false, 4, this.canblitDepth, this._needRenderGamma(texFormat));\r\n                this._internalRenderTexture.filterMode = FilterMode.Bilinear;\r\n            } else {\r\n                this._internalRenderTexture = RenderTexture.createFromPool(viewport.width, viewport.height, texFormat, this._depthTextureFormat, false, 1, this.canblitDepth, this._needRenderGamma(texFormat));\r\n                this._internalRenderTexture.filterMode = FilterMode.Bilinear;\r\n            }\r\n        }\r\n        else {\r\n            this._internalRenderTexture = null;\r\n        }\r\n        scene._componentDriver.callPreRender();\r\n        var needShadowCasterPass: boolean = this._renderShadowMap(scene, context);\r\n        this._preRenderMainPass(context, scene, needInternalRT, viewport);\r\n        this._renderMainPass(context, viewport, scene, shader, replacementTag, needInternalRT);\r\n        this._aftRenderMainPass(needShadowCasterPass);\r\n        scene._componentDriver.callPostRender();\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param point \r\n     * @param out  \r\n     */\r\n    viewportPointToRay(point: Vector2, out: Ray): void {\r\n        this._rayViewport.x = this.viewport.x;\r\n        this._rayViewport.y = this.viewport.y;\r\n        this._rayViewport.width = ILaya.stage._width;\r\n        this._rayViewport.height = ILaya.stage._height;\r\n        Picker.calculateCursorRay(point, this._rayViewport, this._projectionMatrix, this.viewMatrix, null, out);\r\n    }\r\n\r\n    /** \r\n     * \r\n     * @param point \r\n     * @param out  \r\n     */\r\n    normalizedViewportPointToRay(point: Vector2, out: Ray): void {\r\n        var finalPoint: Vector2 = Camera._tempVector20;\r\n        var vp: Viewport = this.normalizedViewport;\r\n        point.x = point.x * Config3D.pixelRatio;\r\n        point.y = point.y * Config3D.pixelRatio;\r\n        finalPoint.x = point.x * vp.width;\r\n        finalPoint.y = point.y * vp.height;\r\n\r\n        Picker.calculateCursorRay(finalPoint, this.viewport, this._projectionMatrix, this.viewMatrix, null, out);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param position \r\n     * @param out  xyz,wz\r\n     */\r\n    worldToViewportPoint(position: Vector3, out: Vector4): void {\r\n        Matrix4x4.multiply(this._projectionMatrix, this._viewMatrix, this._projectionViewMatrix);\r\n        this.viewport.project(position, this._projectionViewMatrix, out);\r\n        var r = Config3D.pixelRatio;\r\n        let _wr = (out.x - this.viewport.x) / r;\r\n        let _hr = (out.y - this.viewport.y) / r;\r\n        out.x = _wr + this.viewport.x;\r\n        out.y = _hr + this.viewport.y;\r\n\r\n        out.x = (out.x / ILaya.stage.clientScaleX) | 0;\r\n        out.y = (out.y / ILaya.stage.clientScaleY) | 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param position \r\n     * @param out  xyz,wz\r\n     */\r\n    worldToNormalizedViewportPoint(position: Vector3, out: Vector4): void {\r\n        this.worldToViewportPoint(position, out);\r\n        out.x = out.x / ILaya.stage.width;\r\n        out.y = out.y / ILaya.stage.height;\r\n    }\r\n\r\n    /**\r\n     * 2D3D:\r\n     * @param   source \r\n     * @param   out \r\n     * @return \r\n     */\r\n    convertScreenCoordToOrthographicCoord(source: Vector3, out: Vector3): boolean {//TODO:viewport\r\n        if (this._orthographic) {\r\n            var clientWidth: number = this.clientWidth;\r\n            var clientHeight: number = this.clientHeight;\r\n            var ratioX: number = this.orthographicVerticalSize * this.aspectRatio / clientWidth;\r\n            var ratioY: number = this.orthographicVerticalSize / clientHeight;\r\n            out.x = (-clientWidth / 2 + source.x * ILaya.stage.clientScaleX) * ratioX;\r\n            out.y = (clientHeight / 2 - source.y * ILaya.stage.clientScaleY) * ratioY;\r\n            out.z = (this.nearPlane - this.farPlane) * (source.z + 1) / 2 - this.nearPlane;\r\n            Vector3.transformCoordinate(out, this.transform.worldMatrix, out);\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    destroy(destroyChild: boolean = true): void {\r\n        this._needInternalRenderTexture() && this._internalRenderTexture && (!this._internalRenderTexture._inPool) && RenderTexture.recoverToPool(this._internalRenderTexture);\r\n        this._offScreenRenderTexture = null;\r\n        this.transform.off(Event.TRANSFORM_CHANGED, this, this._onTransformChanged);\r\n        ILaya.stage.off(Event.RESIZE, this, this._onScreenSizeChanged);\r\n        this._cameraEventCommandBuffer = {};\r\n        this._shaderValues.destroy();\r\n        if (RenderContext3D._instance.camera == this) {\r\n            RenderContext3D._instance.cameraShaderValue = null;\r\n            RenderContext3D._instance.camera = null;\r\n        }\r\n        super.destroy(destroyChild);\r\n    }\r\n\r\n    /**\r\n     * camera\r\n     * @param event \r\n     * @param commandBuffer \r\n     */\r\n    addCommandBuffer(event: CameraEventFlags, commandBuffer: CommandBuffer): void {\r\n        var commandBufferArray: CommandBuffer[] = this._cameraEventCommandBuffer[event];\r\n        if (!commandBufferArray) commandBufferArray = this._cameraEventCommandBuffer[event] = [];\r\n        if (commandBufferArray.indexOf(commandBuffer) < 0)\r\n            commandBufferArray.push(commandBuffer);\r\n        commandBuffer._camera = this;\r\n        if (commandBuffer.casterShadow) {\r\n            this._addCasterShadowCommandBuffer(commandBuffer);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * camera\r\n     * @param event \r\n     * @param commandBuffer \r\n     */\r\n    removeCommandBuffer(event: CameraEventFlags, commandBuffer: CommandBuffer): void {\r\n        var commandBufferArray: CommandBuffer[] = this._cameraEventCommandBuffer[event];\r\n        if (commandBufferArray) {\r\n            var index: number = commandBufferArray.indexOf(commandBuffer);\r\n            if (index != -1) commandBufferArray.splice(index, 1);\r\n\r\n            commandBuffer.casterShadow && this._removeCasterShadowCommandBuffer(commandBuffer);\r\n        }\r\n        else\r\n            throw \"Camera:unknown event.\";\r\n    }\r\n\r\n    /**\r\n     * camera\r\n     * @param event \r\n     */\r\n    removeCommandBuffers(event: CameraEventFlags): void {\r\n        if (this._cameraEventCommandBuffer[event])\r\n            this._cameraEventCommandBuffer[event].length = 0;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Node {\r\n        return new Camera();\r\n    }\r\n\r\n    /** @internal [NATIVE]*/\r\n    _boundFrustumBuffer: Float32Array;\r\n}\r\n\r\n","import { Component } from \"../../../components/Component\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Light, LightMode, LightType } from \"./Light\";\r\nexport enum AreaShape {\r\n    rectangle,\r\n    ellipse,\r\n}\r\n/**\r\n * <code>LightSprite</code> \r\n */\r\nexport class AreaLightCom extends Light {\r\n    /**@internal */\r\n    private _areaShape: AreaShape;\r\n\r\n    /**@internal */\r\n    private _power: number;\r\n\r\n    /**@internal */\r\n    private _size: Vector2;\r\n\r\n    /**@internal */\r\n    private _spread: number;\r\n\r\n    /**@internal */\r\n    private _maxBounces: number;\r\n    /**\r\n     *  <code>AreaLightCoponent</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._lightType = LightType.Area;\r\n        this._lightmapBakedType = LightMode.bakeOnly;\r\n        this._spread = 90;\r\n        this._maxBounces = 1024;\r\n        this._size = new Vector2(1, 1);\r\n        this._areaShape = AreaShape.rectangle;\r\n        this._power = 100;\r\n    }\r\n\r\n    /**\r\n      * \r\n      */\r\n    get lightmapBakedType(): LightMode {\r\n        return LightMode.bakeOnly;\r\n    }\r\n\r\n    set lightmapBakedType(value: LightMode) {\r\n        this._lightmapBakedType = LightMode.bakeOnly;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shape(): AreaShape {\r\n        return this._areaShape;\r\n    }\r\n\r\n    set shape(value: AreaShape) {\r\n        this._areaShape = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set power(value: number) {\r\n        this._power = value;\r\n    }\r\n\r\n    get power() {\r\n        return this._power;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set size(value: Vector2) {\r\n        value && value.cloneTo(this._size);\r\n    }\r\n\r\n    get size() {\r\n        return this._size;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set spread(value: number) {\r\n        this._spread = Math.min((Math.max(0, value)), 180);\r\n    }\r\n\r\n    get spread(): number {\r\n        return this._spread;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set maxBounces(value: number) {\r\n        this._maxBounces = value;\r\n    }\r\n\r\n    get maxBounces() {\r\n        return this._maxBounces;\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    protected _addToLightQueue(): void {\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    protected _removeFromLightQueue(): void {\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n        //this.range = data.range;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _cloneTo(dest: AreaLightCom): void {\r\n        super._cloneTo(dest);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Component {\r\n        return new AreaLightCom();\r\n    }\r\n}\r\n\r\n","\r\nimport LensFlareVS from \"../../../../shader/files/postProcess/LensFlare/LensFlare.vs\";\r\nimport LensFlareFS from \"../../../../shader/files/postProcess/LensFlare/LensFlare.fs\";\r\nimport { Shader3D } from \"../../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { SubShader } from \"../../../../../RenderEngine/RenderShader/SubShader\";\r\nimport { Color } from \"../../../../../maths/Color\";\r\nimport { LensFlareElementGeomtry } from \"./LensFlareGeometry\";\r\n\r\nexport class LensFlareShaderInit {\r\n\r\n    static init() {\r\n        let attribute: { [name: string]: [number, ShaderDataType] } = {\r\n            'a_PositionTexcoord': [LensFlareElementGeomtry.PositionUV, ShaderDataType.Vector4],\r\n            'a_DistanceRotationScale': [LensFlareElementGeomtry.PositionRotationScale, ShaderDataType.Vector4],\r\n        }\r\n        let uniformMap = {\r\n            \"u_Tint\": ShaderDataType.Color,\r\n            \"u_TintIntensity\": ShaderDataType.Float,\r\n            \"u_FlareTexture\": ShaderDataType.Texture2D,\r\n            \"u_FlareCenter\": ShaderDataType.Vector2,\r\n            \"u_aspectRatio\": ShaderDataType.Float,\r\n            \"u_rotate\": ShaderDataType.Float,\r\n            \"u_Postionoffset\": ShaderDataType.Vector2,\r\n            \"u_Angularoffset\": ShaderDataType.Float,\r\n        }\r\n        let defaultValue = {\r\n            \"u_Tint\": Color.WHITE,\r\n            \"u_aspectRatio\": 1\r\n        }\r\n        let shader = Shader3D.add(\"LensFlare\", true, false);\r\n        let subshader = new SubShader(attribute, uniformMap, defaultValue)\r\n        shader.addSubShader(subshader);\r\n        subshader.addShaderPass(LensFlareVS, LensFlareFS);\r\n    }\r\n}","#define SHADER_NAME LENSFLARESFS\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main(){\r\n      gl_FragColor = texture2D(u_FlareTexture, v_Texcoord0)* u_Tint * u_TintIntensity;\r\n}","import { Shader3D } from \"../../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Color } from \"../../../../../maths/Color\";\r\nimport { Vector2 } from \"../../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../../maths/Vector4\";\r\nimport { BaseTexture } from \"../../../../../resource/BaseTexture\";\r\nimport { RenderTexture } from \"../../../../../resource/RenderTexture\";\r\nimport { Resource } from \"../../../../../resource/Resource\";\r\nimport { Texture2D } from \"../../../../../resource/Texture2D\";\r\nimport { Utils } from \"../../../../../utils/Utils\";\r\nimport { PostProcess } from \"../../../../component/PostProcess\";\r\nimport { Camera } from \"../../../Camera\";\r\nimport { DirectionLightCom } from \"../../../light/DirectionLightCom\";\r\nimport { Light, LightType } from \"../../../light/Light\";\r\nimport { PostProcessEffect } from \"../../PostProcessEffect\";\r\nimport { PostProcessRenderContext } from \"../../PostProcessRenderContext\";\r\nimport { CommandBuffer } from \"../../command/CommandBuffer\";\r\nimport { LensFlareCMD } from \"./LensFlareCMD\";\r\nimport { LensFlareElementGeomtry } from \"./LensFlareGeometry\";\r\nimport { LensFlareShaderInit } from \"./LensFlareShaderInit\";\r\n\r\n\r\n/**\r\n * lens Flare Element\r\n * \r\n */\r\nexport class LensFlareElement {\r\n    /**@internal active*/\r\n    private _active: boolean = true;\r\n\r\n    /**@internal type*/\r\n    private _type: string = \"Image\";\r\n\r\n    /**@internal tintColor */\r\n    private _tint: Color = new Color(1, 1, 1, 1);\r\n\r\n    /**@internal intensity*/\r\n    private _intensity: number = 1;\r\n\r\n    /**@internal texture*/\r\n    private _texture: BaseTexture = Texture2D.whiteTexture;\r\n\r\n    /**@internal positionOffet In screen space */\r\n    private _positionOffset: Vector2 = new Vector2(0, 0);\r\n\r\n    /**@internal scale in each dimension */\r\n    private _scale: Vector2 = new Vector2(1, 1);\r\n\r\n    /**@internal */\r\n    private _autoRotate: boolean = false;\r\n\r\n    /**@internal rotation with angle */\r\n    private _rotation: number = 0;\r\n\r\n    //AxisTransform\r\n    private _startPosition: number = 0.0;\r\n\r\n    private _angularOffset: number = 0;//0-360\r\n\r\n    // TODO\r\n    /**@internal */\r\n    private _aspectRatio: boolean = false;\r\n    /**@internal */\r\n    private _modulateByLightColor: boolean = false;\r\n    /**@internal */\r\n    private _blendMode: any;\r\n    /**@internal */\r\n    private _translationScale: Vector2 = new Vector2(1, 1);\r\n    //elemet TODO\r\n    //TODO\r\n\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get active(): boolean {\r\n        return this._active;\r\n    }\r\n    public set active(value: boolean) {\r\n        this._active = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get tint(): Color {\r\n        return this._tint;\r\n    }\r\n    public set tint(value: Color) {\r\n        this._tint = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get intensity(): number {\r\n        return this._intensity;\r\n    }\r\n    public set intensity(value: number) {\r\n        this._intensity = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get texture(): BaseTexture {\r\n        return this._texture;\r\n    }\r\n    public set texture(value: BaseTexture) {\r\n        this._texture = value;\r\n    }\r\n\r\n    /**\r\n     * ()\r\n     */\r\n    public get positionOffset(): Vector2 {\r\n        return this._positionOffset;\r\n    }\r\n    public set positionOffset(value: Vector2) {\r\n        this._positionOffset = value;\r\n    }\r\n\r\n    /**\r\n     * ()\r\n     */\r\n    public get scale(): Vector2 {\r\n        return this._scale;\r\n    }\r\n    public set scale(value: Vector2) {\r\n        this._scale = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get autoRotate(): boolean {\r\n        return this._autoRotate;\r\n    }\r\n    public set autoRotate(value: boolean) {\r\n        this._autoRotate = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get rotation(): number {\r\n        return this._rotation;\r\n    }\r\n    public set rotation(value: number) {\r\n        this._rotation = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get startPosition(): number {\r\n        return this._startPosition;\r\n    }\r\n    public set startPosition(value: number) {\r\n        this._startPosition = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get angularOffset(): number {\r\n        return this._angularOffset;\r\n    }\r\n    public set angularOffset(value: number) {\r\n        this._angularOffset = value;\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * lens Flare Data \r\n * \r\n */\r\nexport class LensFlareData extends Resource {\r\n    constructor() {\r\n        super(false);\r\n    }\r\n\r\n    elements: LensFlareElement[] = [];\r\n}\r\n\r\n/**\r\n * lens Flare Element\r\n */\r\nexport class LensFlareEffect extends PostProcessEffect {\r\n    /**@interal */\r\n    static SHADERDEFINE_AUTOROTATE: ShaderDefine;\r\n\r\n    /**\r\n     * @internal\r\n     * initdefine\r\n     */\r\n    static __initDefine__() {\r\n        LensFlareEffect.SHADERDEFINE_AUTOROTATE = Shader3D.getDefineByName(\"LENSFLAREAUTOROTATE\");\r\n    }\r\n\r\n    /**\r\n     * init Shader\\Geometry\r\n     */\r\n    static init() {\r\n        LensFlareElementGeomtry.init();\r\n        LensFlareShaderInit.init();\r\n        LensFlareEffect.__initDefine__();\r\n    }\r\n\r\n    /**@internal */\r\n    private _tempV3: Vector3;\r\n\r\n    /**@internal */\r\n    private _tempV4: Vector4;\r\n\r\n    /**@internal */\r\n    private _flareCMDS: LensFlareCMD[];\r\n\r\n    /**@internal */\r\n    private _center: Vector2;\r\n\r\n    /**@internal */\r\n    private _rotate: number\r\n\r\n    /**@internal */\r\n    private _light: Light;\r\n\r\n    /**@internal */\r\n    private _effectIntensity: number = 1;\r\n\r\n    /**@internal */\r\n    private _effectScale: number = 1;\r\n\r\n    /**@internal */\r\n    private _needUpdate: boolean = false;\r\n\r\n    /**@internal */\r\n    _lensFlareData: LensFlareData;\r\n\r\n    /**\r\n     * LensFlareData\r\n     */\r\n    set lensFlareData(value: LensFlareData) {\r\n        if (!value) return;\r\n        this._flareCMDS.length = 0;\r\n        for (let i = 0; i < value.elements.length; i++) {\r\n            let ele = value.elements[i];\r\n            if (!ele.active) continue;\r\n            var cmd = new LensFlareCMD();\r\n            cmd.lensFlareElement = ele;\r\n            this._flareCMDS.push(cmd);\r\n        }\r\n        this._lensFlareData = value;\r\n        this._needUpdate = true;\r\n    }\r\n\r\n    get lensFlareData(): LensFlareData {\r\n        return this._lensFlareData;\r\n    }\r\n\r\n    /**\r\n     * bind light\r\n     */\r\n    set bindLight(light: Light) {\r\n        if (!light)\r\n            return;\r\n        this._light = light;//TODO\r\n        this._needUpdate = true;\r\n    }\r\n\r\n    get bindLight(): Light {\r\n        return this._light;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get effectIntensity(): number {\r\n        return this._effectIntensity;\r\n    }\r\n    public set effectIntensity(value: number) {\r\n        this._effectIntensity = value;\r\n        this._needUpdate = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get effectScale(): number {\r\n        return this._effectScale;\r\n    }\r\n    public set effectScale(value: number) {\r\n        this._effectScale = value;\r\n        this._needUpdate = true;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n        this.singleton = false;\r\n        this._flareCMDS = [];\r\n        this._flareCMDS.push(new LensFlareCMD());\r\n        this._center = new Vector2();\r\n        this._tempV3 = new Vector3();\r\n        this._tempV4 = new Vector4();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    _updateEffectData(cmd: CommandBuffer) {\r\n        if (this._flareCMDS.length == 0) return;\r\n        for (let i = 0; i < this._flareCMDS.length; i++) {\r\n            this._flareCMDS[i].center = this._center;//set center\r\n            this._flareCMDS[i].rotate = this._rotate;//set rotate\r\n            if (this._needUpdate) {\r\n                let cmdEle = this._flareCMDS[i].lensFlareElement;\r\n                if (!cmdEle) continue;\r\n                cmdEle.intensity *= this.effectIntensity;\r\n                let scale = cmdEle.scale;\r\n                scale.setValue(scale.x * this.effectScale, scale.y * this.effectScale);\r\n                cmdEle.scale = scale;\r\n                this._flareCMDS[i].applyElementData();\r\n            }\r\n            cmd.addCustomCMD(this._flareCMDS[i]);\r\n        }\r\n        this._needUpdate = false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param camera \r\n     */\r\n    caculateDirCenter(camera: Camera) {\r\n        //center caculate start\r\n        // lightDirection\r\n        (this._light as DirectionLightCom)._direction.cloneTo(this._tempV3);\r\n        // lightDir revert\r\n        Vector3.scale(this._tempV3, -10, this._tempV3);\r\n        // offset of light to camera\r\n        Vector3.add(camera.transform.position, this._tempV3, this._tempV3);\r\n        // to screen space\r\n        Vector3.transformV3ToV4(this._tempV3, camera.projectionViewMatrix, this._tempV4);\r\n        // normalize x\\y coordinate\r\n        this._center.setValue(this._tempV4.x / this._tempV4.w, this._tempV4.y / this._tempV4.w);\r\n        // angle caculatge\r\n        var angle: number = Utils.toAngle(Math.atan2(this._center.x, this._center.y));\r\n        // angle round\r\n        angle = (angle < 0) ? angle + 360 : angle;\r\n        angle = Math.round(angle);\r\n        this._rotate = Math.PI * 2.0 - Math.PI / 180 * angle;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param camera \r\n     */\r\n    caculatePointCenter(camera: Camera) {\r\n        //TODO\r\n        this._needUpdate = true;\r\n    }\r\n\r\n    /**\r\n     * spot\r\n     * @param value \r\n     */\r\n    caculateSpotCenter(value: Vector2) {\r\n        //TODO\r\n        this._needUpdate = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param context \r\n     * @returns \r\n     */\r\n    render(context: PostProcessRenderContext) {\r\n        var cmd: CommandBuffer = context.command;\r\n        let source: RenderTexture = context.indirectTarget;\r\n        cmd.setRenderTarget(source);\r\n        if (!this._light)\r\n            return;\r\n        switch (this._light.lightType) {\r\n            case LightType.Directional:\r\n                this.caculateDirCenter(context.camera);\r\n                break;\r\n            case LightType.Point:\r\n                //TODO\r\n                break;\r\n            case LightType.Spot:\r\n                //TODO\r\n                break;\r\n        }\r\n        if (Math.abs(this._center.x) > 1.0 || Math.abs(this._center.y) > 1.0) return;\r\n        this._updateEffectData(cmd);\r\n        cmd.blitScreenQuad(source, context.destination);\r\n    }\r\n\r\n    /**\r\n   * Effect\r\n   * @inheritDoc\r\n   * @override\r\n   */\r\n    release(postprocess: PostProcess) {\r\n        //TODO\r\n        this._needUpdate = false;\r\n    }\r\n}","import { Config3D } from \"./Config3D\";\r\nimport { ILaya3D } from \"./ILaya3D\";\r\nimport { PostProcess } from \"./laya/d3/component/PostProcess\";\r\nimport { BlinnPhongMaterial } from \"./laya/d3/core/material/BlinnPhongMaterial\";\r\nimport { PBRMaterial } from \"./laya/d3/core/material/PBRMaterial\";\r\nimport { PBRStandardMaterial } from \"./laya/d3/core/material/PBRStandardMaterial\";\r\nimport { SkyBoxMaterial } from \"./laya/d3/core/material/SkyBoxMaterial\";\r\nimport { SkyProceduralMaterial } from \"./laya/d3/core/material/SkyProceduralMaterial\";\r\nimport { UnlitMaterial } from \"./laya/d3/core/material/UnlitMaterial\";\r\nimport { MeshRenderer } from \"./laya/d3/core/MeshRenderer\";\r\nimport { MeshSprite3D } from \"./laya/d3/core/MeshSprite3D\";\r\nimport { ShuriKenParticle3D } from \"./laya/d3/core/particleShuriKen/ShuriKenParticle3D\";\r\nimport { ShurikenParticleMaterial } from \"./laya/d3/core/particleShuriKen/ShurikenParticleMaterial\";\r\nimport { PixelLineVertex } from \"./laya/d3/core/pixelLine/PixelLineVertex\";\r\nimport { Command } from \"./laya/d3/core/render/command/Command\";\r\nimport { RenderContext3D } from \"./laya/d3/core/render/RenderContext3D\";\r\nimport { ScreenQuad } from \"./laya/d3/core/render/ScreenQuad\";\r\nimport { RenderableSprite3D } from \"./laya/d3/core/RenderableSprite3D\";\r\nimport { Scene3D } from \"./laya/d3/core/scene/Scene3D\";\r\nimport { SkinnedMeshSprite3D } from \"./laya/d3/core/SkinnedMeshSprite3D\";\r\nimport { Sprite3D } from \"./laya/d3/core/Sprite3D\";\r\nimport { TrailMaterial } from \"./laya/d3/core/trail/TrailMaterial\";\r\nimport { TrailSprite3D } from \"./laya/d3/core/trail/TrailSprite3D\";\r\nimport { VertexTrail } from \"./laya/d3/core/trail/VertexTrail\";\r\nimport { FrustumCulling } from \"./laya/d3/graphics/FrustumCulling\";\r\nimport { SubMeshInstanceBatch } from \"./laya/d3/graphics/SubMeshInstanceBatch\";\r\nimport { VertexPositionTerrain } from \"./laya/d3/graphics/Vertex/VertexPositionTerrain\";\r\nimport { VertexPositionTexture0 } from \"./laya/d3/graphics/Vertex/VertexPositionTexture0\";\r\nimport { VertexShurikenParticleBillboard } from \"./laya/d3/graphics/Vertex/VertexShurikenParticleBillboard\";\r\nimport { VertexShurikenParticleMesh } from \"./laya/d3/graphics/Vertex/VertexShurikenParticleMesh\";\r\nimport { Mesh } from \"./laya/d3/resource/models/Mesh\";\r\nimport { PrimitiveMesh } from \"./laya/d3/resource/models/PrimitiveMesh\";\r\nimport { SkyBox } from \"./laya/d3/resource/models/SkyBox\";\r\nimport { SkyDome } from \"./laya/d3/resource/models/SkyDome\";\r\nimport { TextureCube } from \"./laya/resource/TextureCube\";\r\nimport { ShaderInit3D } from \"./laya/d3/shader/ShaderInit3D\";\r\nimport { Texture2D } from \"./laya/resource/Texture2D\";\r\nimport { WebGL } from \"./laya/webgl/WebGL\";\r\nimport { ShadowUtils } from \"./laya/d3/core/light/ShadowUtils\";\r\nimport { ShadowCasterPass } from \"./laya/d3/shadowMap/ShadowCasterPass\";\r\nimport { SimpleSkinnedMeshSprite3D } from \"./laya/d3/core/SimpleSkinnedMeshSprite3D\";\r\nimport { HalfFloatUtils } from \"./laya/utils/HalfFloatUtils\";\r\nimport { Camera } from \"./laya/d3/core/Camera\";\r\nimport { BaseCamera } from \"./laya/d3/core/BaseCamera\";\r\nimport { ShuriKenParticle3DShaderDeclaration } from \"./laya/d3/core/particleShuriKen/ShuriKenParticle3DShaderDeclaration\";\r\nimport { BaseRender } from \"./laya/d3/core/render/BaseRender\";\r\nimport { TrailFilter } from \"./laya/d3/core/trail/TrailFilter\";\r\nimport { DepthPass } from \"./laya/d3/depthMap/DepthPass\";\r\nimport { RenderCapable } from \"./laya/RenderEngine/RenderEnum/RenderCapable\";\r\nimport { BlitFrameBufferCMD } from \"./laya/d3/core/render/command/BlitFrameBufferCMD\";\r\nimport { SkyRenderer } from \"./laya/d3/resource/models/SkyRenderer\";\r\nimport { SkyPanoramicMaterial } from \"./laya/d3/core/material/SkyPanoramicMaterial\";\r\nimport { BloomEffect } from \"./laya/d3/core/render/PostEffect/BloomEffect\";\r\nimport { ScalableAO } from \"./laya/d3/core/render/PostEffect/ScalableAO\";\r\nimport { GaussianDoF } from \"./laya/d3/core/render/PostEffect/GaussianDoF\";\r\nimport { VertexMesh } from \"./laya/RenderEngine/RenderShader/VertexMesh\";\r\nimport { RenderTexture } from \"./laya/resource/RenderTexture\";\r\nimport { ColorGradEffect } from \"./laya/d3/core/render/PostEffect/ColorGradEffect\";\r\nimport { LensFlareEffect } from \"./laya/d3/core/render/PostEffect/LensFlares/LensFlareEffect\";\r\nimport { IPhysicsCreateUtil } from \"./laya/Physics3D/interface/IPhysicsCreateUtil\";\r\nimport { LayaGL } from \"./laya/layagl/LayaGL\";\r\n\r\n/**\r\n * <code>Laya3D</code> 3D\r\n */\r\nexport class Laya3D {\r\n    /** */\r\n    static _PhysicsCreateUtil: IPhysicsCreateUtil;\r\n\r\n    /**@internal */\r\n    static _enablePhysics: boolean = false;\r\n\r\n    /**\r\n     * \r\n     */\r\n    static set PhysicsCreateUtil(value: IPhysicsCreateUtil) {\r\n        if (value && !Laya3D._PhysicsCreateUtil) {\r\n            Laya3D._PhysicsCreateUtil = value;\r\n            Laya3D._enablePhysics = true;\r\n        }\r\n    }\r\n\r\n    static get PhysicsCreateUtil() {\r\n        return this._PhysicsCreateUtil;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param \r\n     */\r\n    static get enablePhysics(): any {\r\n        return Laya3D._enablePhysics;\r\n    }\r\n\r\n    /**\r\n     *@internal\r\n     */\r\n    static _changeWebGLSize(width: number, height: number): void {\r\n        WebGL.onStageResize(width, height);\r\n        RenderContext3D.clientWidth = width;\r\n        RenderContext3D.clientHeight = height;\r\n    }\r\n\r\n    /**\r\n     *@internal\r\n     */\r\n    static __init__(checkPhysics?: boolean): Promise<void> {\r\n        if (checkPhysics !== false) {\r\n            if (!Laya3D._PhysicsCreateUtil)\r\n                Laya3D._enablePhysics = false;\r\n            else {\r\n                Laya3D._enablePhysics = true;\r\n                return new Promise<void>(resolve => {\r\n                    Laya3D._PhysicsCreateUtil.initialize().then(() => {\r\n                        Laya3D.__init__(false).then(resolve);\r\n                    });\r\n                });\r\n            }\r\n        }\r\n        // if (LayaEnv.isConch && !(window as any).conchConfig.conchWebGL) {\r\n        //     var skinnedMeshRender: any = SkinnedMeshRenderer;\r\n        //     skinnedMeshRender.prototype._computeSkinnedData = skinnedMeshRender.prototype._computeSkinnedDataForNative;\r\n        // }\r\n        Config3D._multiLighting = Config3D.enableMultiLight && LayaGL.renderEngine.getCapable(RenderCapable.TextureFormat_R32G32B32A32);\r\n        Config3D._uniformBlock = Config3D.enableUniformBufferObject && LayaGL.renderEngine.getCapable(RenderCapable.UnifromBufferObject);\r\n\r\n        if (Config3D.maxLightCount > 2048) {\r\n            Config3D.maxLightCount = 2048;\r\n            console.warn(\"Config3D: maxLightCount must less equal 2048.\");\r\n        }\r\n\r\n        let lcc = Config3D.lightClusterCount;\r\n        if (lcc.x > 128 || lcc.y > 128 || lcc.z > 128) {\r\n            lcc.setValue(Math.min(lcc.x, 128), Math.min(lcc.y, 128), Math.min(lcc.z, 128));\r\n            console.warn(\"Config3D: lightClusterCount X and YZ must less equal 128.\");\r\n        }\r\n\r\n        let maxAreaLightCountWithZ = Math.floor(2048 / Config3D.lightClusterCount.z - 1) * 4;\r\n        if (maxAreaLightCountWithZ < Config3D.maxLightCount)\r\n            console.warn(\"Config3D: if the area light(PointLightSpotLight) count is large than \" + maxAreaLightCountWithZ + \",maybe the far away culster will ingonre some light.\");\r\n        Config3D._maxAreaLightCountPerClusterAverage = Math.min(maxAreaLightCountWithZ, Config3D.maxLightCount);\r\n\r\n        ILaya3D.Scene3D = Scene3D;\r\n        ILaya3D.Laya3D = Laya3D;\r\n        VertexMesh.__init__();\r\n        VertexShurikenParticleBillboard.__init__();\r\n        VertexShurikenParticleMesh.__init__();\r\n        VertexPositionTexture0.__init__();\r\n        VertexTrail.__init__();\r\n        VertexPositionTerrain.__init__();\r\n        PixelLineVertex.__init__();\r\n        SubMeshInstanceBatch.__init__();\r\n        ShaderInit3D.__init__();\r\n        ShuriKenParticle3DShaderDeclaration.__init__();\r\n        SimpleSkinnedMeshSprite3D.__init__();\r\n        PBRMaterial.__init__();\r\n        PBRStandardMaterial.__init__();\r\n        SkyPanoramicMaterial.__init__();\r\n        BloomEffect.init();\r\n        ScalableAO.init();\r\n        GaussianDoF.init();\r\n        ColorGradEffect.init();\r\n        LensFlareEffect.init();\r\n\r\n        Mesh.__init__();\r\n        PrimitiveMesh.__init__();\r\n        Sprite3D.__init__();\r\n        RenderableSprite3D.__init__();\r\n        MeshSprite3D.__init__();\r\n        DepthPass.__init__();\r\n        SkinnedMeshSprite3D.__init__();\r\n        SimpleSkinnedMeshSprite3D.__init__();\r\n        TrailFilter.__init__();\r\n        ShuriKenParticle3D.__init__();\r\n        TrailSprite3D.__init__();\r\n        PostProcess.__init__();\r\n        Scene3D.__init__();\r\n        ShadowCasterPass.__init__();\r\n        BaseCamera.__init__();\r\n        BaseRender.__init__();\r\n        MeshRenderer.__init__();\r\n        SkyRenderer.__init__();\r\n        Camera.__init__();\r\n        ShadowUtils.init();\r\n        RenderContext3D.__init__();\r\n        RenderTexture.configRenderContextInstance(RenderContext3D._instance);\r\n        BlinnPhongMaterial.__initDefine__();\r\n        SkyProceduralMaterial.__initDefine__();\r\n        UnlitMaterial.__initDefine__();\r\n        TrailMaterial.__initDefine__();\r\n        ShurikenParticleMaterial.__initDefine__();\r\n        SkyBoxMaterial.__initDefine__();\r\n        Command.__init__();\r\n        BlitFrameBufferCMD.__init__();\r\n        BlinnPhongMaterial.defaultMaterial = new BlinnPhongMaterial();\r\n        BlinnPhongMaterial.defaultMaterial.lock = true;\r\n        Texture2D.__init__();\r\n        TextureCube.__init__();\r\n        SkyBox.__init__();\r\n        SkyDome.__init__();\r\n        ScreenQuad.__init__();\r\n        FrustumCulling.__init__();\r\n        HalfFloatUtils.__init__();\r\n\r\n        return Promise.resolve();\r\n    }\r\n}\r\n\r\n(window as any).Laya3D = Laya3D;\r\n\r\n","import { Scene3D } from \"../scene/Scene3D\";\r\nimport { ShadowCascadesMode } from \"./ShadowCascadesMode\";\r\nimport { Light, LightType } from \"./Light\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\n\r\n/**\r\n * <code>DirectionLight</code> \r\n */\r\nexport class DirectionLightCom extends Light {\r\n\t/** @internal */\r\n\t_direction: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\t_shadowCascadesMode: ShadowCascadesMode = ShadowCascadesMode.NoCascades;\r\n\t/** @internal */\r\n\t_shadowTwoCascadeSplits: number = 1.0 / 3.0;\r\n\t/** @internal */\r\n\t_shadowFourCascadeSplits: Vector3 = new Vector3(1.0 / 15, 3.0 / 15.0, 7.0 / 15.0);\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowCascadesMode(): ShadowCascadesMode {\r\n\t\treturn this._shadowCascadesMode;\r\n\t}\r\n\r\n\tset shadowCascadesMode(value: ShadowCascadesMode) {\r\n\t\tthis._shadowCascadesMode = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowTwoCascadeSplits(): number {\r\n\t\treturn this._shadowTwoCascadeSplits;\r\n\t}\r\n\r\n\tset shadowTwoCascadeSplits(value: number) {\r\n\t\tthis._shadowTwoCascadeSplits = value;\r\n\t}\r\n\r\n\t/**\r\n\t * ,XYZ,ZY,YX\r\n\t */\r\n\tget shadowFourCascadeSplits(): Vector3 {\r\n\t\treturn this._shadowFourCascadeSplits;\r\n\t}\r\n\r\n\tset shadowFourCascadeSplits(value: Vector3) {\r\n\t\tif (value.x > value.y || value.y > value.z || value.z > 1.0)\r\n\t\t\tthrow \"DiretionLight:Invalid value.\";\r\n\t\tvalue.cloneTo(this._shadowFourCascadeSplits);\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>DirectionLight</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._lightType = LightType.Directional;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\tprotected _addToLightQueue(): void {\r\n\t\t(<Scene3D>this.owner.scene)._directionLights.add(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\tprotected _removeFromLightQueue(): void {\r\n\t\t(<Scene3D>this.owner.scene)._directionLights.remove(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): DirectionLightCom {\r\n\t\treturn new DirectionLightCom();\r\n\t}\r\n}\r\n\r\n","import { Node } from \"../../../display/Node\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { ShadowMode } from \"./ShadowMode\";\r\nimport { Light, LightMode } from \"./Light\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\n\r\n/**\r\n * @deprecated\r\n * <code>LightSprite</code> \r\n */\r\nexport class LightSprite extends Sprite3D {\r\n\t/** @internal */\r\n\t_light: Light;\r\n\t/**\r\n\t * \r\n\t */\r\n\tget color(): Color {\r\n\t\treturn this._light.color;\r\n\t}\r\n\r\n\tset color(value: Color) {\r\n\t\tthis._light.color = value;\r\n\t}\r\n\r\n\tget mode(): LightMode {\r\n\t\treturn this._light.lightmapBakedType;\r\n\t}\r\n\r\n\tset mode(value: LightMode) {\r\n\t\tthis._light.lightmapBakedType = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget intensity(): number {\r\n\t\treturn this._light.intensity;\r\n\t}\r\n\r\n\tset intensity(value: number) {\r\n\t\tthis._light.intensity = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowMode(): ShadowMode {\r\n\t\treturn this._light.shadowMode;\r\n\t}\r\n\r\n\tset shadowMode(value: ShadowMode) {\r\n\t\tthis._light.shadowMode = value\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowDistance(): number {\r\n\t\treturn this._light.shadowDistance;\r\n\t}\r\n\r\n\tset shadowDistance(value: number) {\r\n\t\tthis._light.shadowDistance = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowResolution(): number {\r\n\t\treturn this._light.shadowResolution;\r\n\t}\r\n\r\n\tset shadowResolution(value: number) {\r\n\t\tthis._light.shadowResolution = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowDepthBias(): number {\r\n\t\treturn this._light.shadowDepthBias;\r\n\t}\r\n\r\n\tset shadowDepthBias(value: number) {\r\n\t\tthis._light.shadowDepthBias = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowNormalBias(): number {\r\n\t\treturn this._light.shadowNormalBias;\r\n\t}\r\n\r\n\tset shadowNormalBias(value: number) {\r\n\t\tthis._light.shadowNormalBias = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowStrength(): number {\r\n\t\treturn this._light.shadowStrength;\r\n\t}\r\n\r\n\tset shadowStrength(value: number) {\r\n\t\tthis._light.shadowStrength = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowNearPlane(): number {\r\n\t\treturn this._light.shadowNearPlane;\r\n\t}\r\n\r\n\tset shadowNearPlane(value: number) {\r\n\t\tthis._light.shadowNearPlane = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget lightmapBakedType(): number {\r\n\t\treturn this._light.lightmapBakedType;\r\n\t}\r\n\r\n\tset lightmapBakedType(value: number) {\r\n\t\tthis._light.lightmapBakedType = value;\r\n\t}\r\n\r\n\tget lightWorldMatrix(): Matrix4x4 {\r\n\t\treturn this._light.lightWorldMatrix;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>LightSprite</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_parse(data: any, spriteMap: any): void {\r\n\t\tsuper._parse(data, spriteMap);\r\n\t\tvar colorData: any[] = data.color;\r\n\t\tthis.color.r = colorData[0];\r\n\t\tthis.color.g = colorData[1];\r\n\t\tthis.color.b = colorData[2];\r\n\t\tthis.intensity = data.intensity;\r\n\t\tthis.lightmapBakedType = data.lightmapBakedType;\r\n\t}\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_cloneTo(destObject: any, rootSprite: Node, dstSprite: Node) {\r\n\t\tsuper._cloneTo(destObject, rootSprite, dstSprite);\r\n\t\tvar spriteLight = <LightSprite>destObject;\r\n\t\tspriteLight.color = this.color.clone();\r\n\t\tspriteLight.intensity = this.intensity;\r\n\t\tspriteLight.lightmapBakedType = this.lightmapBakedType;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _addToLightQueue(): void {\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _removeFromLightQueue(): void {\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Node {\r\n\t\treturn new Sprite3D();\r\n\t}\r\n}\r\n\r\n","import { ShadowCascadesMode } from \"./ShadowCascadesMode\";\r\nimport { Node } from \"../../../display/Node\";\r\nimport { DirectionLightCom } from \"./DirectionLightCom\";\r\nimport { LightSprite } from \"./LightSprite\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\n/**\r\n * @deprecated\r\n * <code>DirectionLight</code> \r\n */\r\nexport class DirectionLight extends LightSprite {\r\n\r\n\t/** @internal */\r\n\t_light: DirectionLightCom;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowCascadesMode(): ShadowCascadesMode {\r\n\t\treturn this._light._shadowCascadesMode;\r\n\t}\r\n\r\n\tset shadowCascadesMode(value: ShadowCascadesMode) {\r\n\t\tthis._light._shadowCascadesMode = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowTwoCascadeSplits(): number {\r\n\t\treturn this._light._shadowTwoCascadeSplits;\r\n\t}\r\n\r\n\tset shadowTwoCascadeSplits(value: number) {\r\n\t\tthis._light._shadowTwoCascadeSplits = value;\r\n\t}\r\n\r\n\t/**\r\n\t * ,XYZ,ZY,YX\r\n\t */\r\n\tget shadowFourCascadeSplits(): Vector3 {\r\n\t\treturn this._light._shadowFourCascadeSplits;\r\n\t}\r\n\r\n\tset shadowFourCascadeSplits(value: Vector3) {\r\n\t\tif (value.x > value.y || value.y > value.z || value.z > 1.0)\r\n\t\t\tthrow \"DiretionLight:Invalid value.\";\r\n\t\tvalue.cloneTo(this._light._shadowFourCascadeSplits);\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>DirectionLight</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._light = this.addComponent(DirectionLightCom);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Node {\r\n\t\treturn new Sprite3D();\r\n\t}\r\n}\r\n\r\n","import { Component } from \"../../../components/Component\";\r\nimport { Light, LightType } from \"./Light\";\r\n\r\n\r\nexport class PointLightCom extends Light {\r\n    /** @internal */\r\n    private _range: number;\r\n\r\n    /**\r\n     * \r\n     * @return \r\n     */\r\n    get range(): number {\r\n        return this._range;\r\n    }\r\n\r\n    set range(value: number) {\r\n        this._range = value;\r\n    }\r\n\r\n    /**\r\n     *  <code>PointLight</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._range = 6.0;\r\n        this._lightType = LightType.Point;\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    protected _addToLightQueue(): void {\r\n        this.owner.scene._pointLights.add(this);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    protected _removeFromLightQueue(): void {\r\n        this.owner.scene._pointLights.remove(this);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n        this.range = data.range;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _cloneTo(dest: PointLightCom): void {\r\n        super._cloneTo(dest);\r\n        var pointlight = dest as PointLightCom;\r\n        pointlight.range = this.range;\r\n        pointlight._lightType = LightType.Point;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Component {\r\n        return new PointLightCom();\r\n    }\r\n\r\n}","import { Node } from \"../../../display/Node\"\r\nimport { PointLightCom } from \"./PointLightCom\";\r\nimport { LightSprite } from \"./LightSprite\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\n/**\r\n * @deprecated\r\n * <code>PointLight</code> \r\n */\r\nexport class PointLight extends LightSprite {\r\n\r\n\t/**@internal */\r\n\t_light: PointLightCom;\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget range(): number {\r\n\t\treturn this._light.range;\r\n\t}\r\n\r\n\tset range(value: number) {\r\n\t\tthis._light.range = value;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>PointLight</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._light = this.addComponent(PointLightCom);\r\n\t\tthis._light.range = 6.0;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_parse(data: any, spriteMap: any): void {\r\n\t\tsuper._parse(data, spriteMap);\r\n\t\tthis.range = data.range;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_cloneTo(destObject: any, rootSprite: Node, dstSprite: Node) {\r\n\t\tsuper._cloneTo(destObject, rootSprite, dstSprite);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Node {\r\n\t\treturn new Sprite3D();\r\n\t}\r\n}\r\n\r\n","import { Scene3D } from \"../scene/Scene3D\";\r\nimport { Light, LightType } from \"./Light\";\r\nimport { Component } from \"../../../components/Component\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>SpotLight</code> \r\n */\r\nexport class SpotLightCom extends Light {\r\n\t/** @internal */\r\n\tprivate _spotAngle: number;\r\n\t/** @internal */\r\n\tprivate _range: number;\r\n\r\n\t/** @internal */\r\n\tpublic _direction: Vector3;\r\n\r\n\t/**\r\n\t  * \r\n\t  */\r\n\tget spotAngle(): number {\r\n\t\treturn this._spotAngle;\r\n\t}\r\n\r\n\tset spotAngle(value: number) {\r\n\t\tthis._spotAngle = Math.max(Math.min(value, 179), 0);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget range(): number {\r\n\t\treturn this._range;\r\n\t}\r\n\r\n\tset range(value: number) {\r\n\t\tthis._range = value;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SpotLight</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._spotAngle = 30.0;\r\n\t\tthis._range = 10.0;\r\n\t\tthis._direction = new Vector3();\r\n\t\tthis._lightType = LightType.Spot;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\tprotected _addToLightQueue(): void {\r\n\t\t(<Scene3D>this.owner.scene)._spotLights.add(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\tprotected _removeFromLightQueue(): void {\r\n\t\t(<Scene3D>this.owner.scene)._spotLights.remove(this);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_parse(data: any, spriteMap: any): void {\r\n\t\tsuper._parse(data, spriteMap);\r\n\t\tthis.range = data.range;\r\n\t\tthis.spotAngle = data.spotAngle;\r\n\t}\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_cloneTo(dest: Component): void {\r\n\t\tsuper._cloneTo(dest);\r\n\t\tvar spotLight = <SpotLightCom>dest;\r\n\t\tspotLight.range = this.range;\r\n\t\tspotLight.spotAngle = this.spotAngle;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Component {\r\n\t\treturn new SpotLightCom();\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Node } from \"../../../display/Node\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { LightSprite } from \"./LightSprite\";\r\nimport { SpotLightCom } from \"./SpotLightCom\";\r\n\r\n/**\r\n * @deprecated\r\n * <code>SpotLight</code> \r\n */\r\nexport class SpotLight extends LightSprite {\r\n\t/**@internal */\r\n\t_light: SpotLightCom;\r\n\r\n\t/**\r\n\t  * \r\n\t  */\r\n\tget spotAngle(): number {\r\n\t\treturn this._light.spotAngle;\r\n\t}\r\n\r\n\tset spotAngle(value: number) {\r\n\t\tthis._light.spotAngle = Math.max(Math.min(value, 179), 0);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget range(): number {\r\n\t\treturn this._light.range;\r\n\t}\r\n\r\n\tset range(value: number) {\r\n\t\tthis._light.range = value;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SpotLight</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._light = this.addComponent(SpotLightCom);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_parse(data: any, spriteMap: any): void {\r\n\t\tsuper._parse(data, spriteMap);\r\n\t\tthis.range = data.range;\r\n\t\tthis.spotAngle = data.spotAngle;\r\n\t}\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_cloneTo(destObject: any, rootSprite: Node, dstSprite: Node) {\r\n\t\tsuper._cloneTo(destObject, rootSprite, dstSprite);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Node {\r\n\t\treturn new Sprite3D();\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { UnlitMaterial } from \"./UnlitMaterial\";\r\n\r\n/**\r\n * <code>EffectMaterial</code> Mesh\r\n */\r\nexport class EffectMaterial extends Material {\r\n\t/** */\r\n\tstatic defaultMaterial: EffectMaterial;\r\n\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget color(): Color {\r\n\t\treturn (<Color>this.getColorByIndex(UnlitMaterial.ALBEDOCOLOR));\r\n\t}\r\n\r\n\tset color(value: Color) {\r\n\t\tthis.setColorByIndex(UnlitMaterial.ALBEDOCOLOR, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget texture(): BaseTexture {\r\n\t\treturn this.getTextureByIndex(UnlitMaterial.ALBEDOTEXTURE);\r\n\t}\r\n\r\n\tset texture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE);\r\n\t\telse\r\n\t\t\tthis.removeDefine(UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE);\r\n\t\tthis.setTextureByIndex(UnlitMaterial.ALBEDOTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget tilingOffset(): Vector4 {\r\n\t\treturn (<Vector4>this.getVector4ByIndex(UnlitMaterial.TILINGOFFSET));\r\n\t}\r\n\r\n\tset tilingOffset(value: Vector4) {\r\n\t\tif (value) {\r\n\t\t\tthis.setVector4ByIndex(UnlitMaterial.TILINGOFFSET, value);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.getVector4ByIndex(UnlitMaterial.TILINGOFFSET).setValue(1.0, 1.0, 0.0, 0.0);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t *  <code>EffectMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"Unlit\");\r\n\t\tthis.setVector4ByIndex(UnlitMaterial.TILINGOFFSET, new Vector4(1.0, 1.0, 0.0, 0.0));\r\n\t\tthis.setColorByIndex(UnlitMaterial.ALBEDOCOLOR, new Color(1.0, 1.0, 1.0, 1.0));\r\n\t\tthis.renderMode = EffectMaterial.RENDERMODE_ADDTIVE;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: EffectMaterial = new EffectMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n\t//----------------deprecated----------------\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * _\r\n\t */\r\n\tstatic RENDERMODE_ADDTIVE: number = 0;\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * _*/\r\n\tstatic RENDERMODE_ALPHABLENDED: number = 1;\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * \r\n\t * \r\n\t */\r\n\tset renderMode(value: number) {\r\n\t\tswitch (value) {\r\n\t\t\tcase EffectMaterial.RENDERMODE_ADDTIVE:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_NONE;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LEQUAL;\r\n\t\t\t\tthis.addDefine(Material.SHADERDEFINE_ADDTIVEFOG);\r\n\t\t\t\tbreak;\r\n\t\t\tcase EffectMaterial.RENDERMODE_ALPHABLENDED:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_NONE;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LEQUAL;\r\n\t\t\t\tthis.removeDefine(Material.SHADERDEFINE_ADDTIVEFOG);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"MeshEffectMaterial : renderMode value error.\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\n","import { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { Material } from \"../../../resource/Material\";\r\n\r\n/**\r\n * ...\r\n * @author ...\r\n */\r\nexport class ExtendTerrainMaterial extends Material {\r\n\t/**_*/\r\n\tstatic RENDERMODE_OPAQUE: number = 1;\r\n\t/**_*/\r\n\tstatic RENDERMODE_TRANSPARENT: number = 2;\r\n\r\n\t/**@internal */\r\n\tstatic SPLATALPHATEXTURE: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSETEXTURE1: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSETEXTURE2: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSETEXTURE3: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSETEXTURE4: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSETEXTURE5: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSESCALEOFFSET1: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSESCALEOFFSET2: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSESCALEOFFSET3: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSESCALEOFFSET4: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSESCALEOFFSET5: number;\r\n\r\n\t/***/\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DETAIL_NUM1: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DETAIL_NUM2: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DETAIL_NUM3: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DETAIL_NUM4: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DETAIL_NUM5: ShaderDefine;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __initDefine__(): void {\r\n\t\tExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1 = Shader3D.getDefineByName(\"ExtendTerrain_DETAIL_NUM1\");\r\n\t\tExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2 = Shader3D.getDefineByName(\"ExtendTerrain_DETAIL_NUM2\");\r\n\t\tExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3 = Shader3D.getDefineByName(\"ExtendTerrain_DETAIL_NUM3\");\r\n\t\tExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4 = Shader3D.getDefineByName(\"ExtendTerrain_DETAIL_NUM4\");\r\n\t\tExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5 = Shader3D.getDefineByName(\"ExtendTerrain_DETAIL_NUM5\");\r\n\r\n\t\tExtendTerrainMaterial.SPLATALPHATEXTURE = Shader3D.propertyNameToID(\"u_SplatAlphaTexture\");\r\n\t\tExtendTerrainMaterial.DIFFUSETEXTURE1 = Shader3D.propertyNameToID(\"u_DiffuseTexture1\");\r\n\t\tExtendTerrainMaterial.DIFFUSETEXTURE2 = Shader3D.propertyNameToID(\"u_DiffuseTexture2\");\r\n\t\tExtendTerrainMaterial.DIFFUSETEXTURE3 = Shader3D.propertyNameToID(\"u_DiffuseTexture3\");\r\n\t\tExtendTerrainMaterial.DIFFUSETEXTURE4 = Shader3D.propertyNameToID(\"u_DiffuseTexture4\");\r\n\t\tExtendTerrainMaterial.DIFFUSETEXTURE5 = Shader3D.propertyNameToID(\"u_DiffuseTexture5\");\r\n\t\tExtendTerrainMaterial.DIFFUSESCALEOFFSET1 = Shader3D.propertyNameToID(\"u_DiffuseScaleOffset1\");\r\n\t\tExtendTerrainMaterial.DIFFUSESCALEOFFSET2 = Shader3D.propertyNameToID(\"u_DiffuseScaleOffset2\");\r\n\t\tExtendTerrainMaterial.DIFFUSESCALEOFFSET3 = Shader3D.propertyNameToID(\"u_DiffuseScaleOffset3\");\r\n\t\tExtendTerrainMaterial.DIFFUSESCALEOFFSET4 = Shader3D.propertyNameToID(\"u_DiffuseScaleOffset4\");\r\n\t\tExtendTerrainMaterial.DIFFUSESCALEOFFSET5 = Shader3D.propertyNameToID(\"u_DiffuseScaleOffset5\");\r\n\t}\r\n\t/**\r\n\t * splatAlpha\r\n\t */\r\n\tget splatAlphaTexture(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(ExtendTerrainMaterial.SPLATALPHATEXTURE);\r\n\t}\r\n\r\n\tset splatAlphaTexture(value: BaseTexture) {\r\n\t\tthis._shaderValues.setTexture(ExtendTerrainMaterial.SPLATALPHATEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget diffuseTexture1(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(ExtendTerrainMaterial.DIFFUSETEXTURE1);\r\n\t}\r\n\r\n\tset diffuseTexture1(value: BaseTexture) {\r\n\t\tthis._shaderValues.setTexture(ExtendTerrainMaterial.DIFFUSETEXTURE1, value);\r\n\t\tthis._setDetailNum(1);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget diffuseTexture2(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(ExtendTerrainMaterial.DIFFUSETEXTURE2);\r\n\t}\r\n\r\n\tset diffuseTexture2(value: BaseTexture) {\r\n\t\tthis._shaderValues.setTexture(ExtendTerrainMaterial.DIFFUSETEXTURE2, value);\r\n\t\tthis._setDetailNum(2);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget diffuseTexture3(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(ExtendTerrainMaterial.DIFFUSETEXTURE3);\r\n\t}\r\n\r\n\tset diffuseTexture3(value: BaseTexture) {\r\n\t\tthis._shaderValues.setTexture(ExtendTerrainMaterial.DIFFUSETEXTURE3, value);\r\n\t\tthis._setDetailNum(3);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget diffuseTexture4(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(ExtendTerrainMaterial.DIFFUSETEXTURE4);\r\n\t}\r\n\r\n\tset diffuseTexture4(value: BaseTexture) {\r\n\t\tthis._shaderValues.setTexture(ExtendTerrainMaterial.DIFFUSETEXTURE4, value);\r\n\t\tthis._setDetailNum(4);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget diffuseTexture5(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(ExtendTerrainMaterial.DIFFUSETEXTURE5);\r\n\t}\r\n\r\n\tset diffuseTexture5(value: BaseTexture) {\r\n\t\tthis._shaderValues.setTexture(ExtendTerrainMaterial.DIFFUSETEXTURE5, value);\r\n\t\tthis._setDetailNum(5);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tset diffuseScaleOffset1(scaleOffset1: Vector4) {\r\n\t\tthis._shaderValues.setVector(ExtendTerrainMaterial.DIFFUSESCALEOFFSET1, scaleOffset1);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tset diffuseScaleOffset2(scaleOffset2: Vector4) {\r\n\t\tthis._shaderValues.setVector(ExtendTerrainMaterial.DIFFUSESCALEOFFSET2, scaleOffset2);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tset diffuseScaleOffset3(scaleOffset3: Vector4) {\r\n\t\tthis._shaderValues.setVector(ExtendTerrainMaterial.DIFFUSESCALEOFFSET3, scaleOffset3);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tset diffuseScaleOffset4(scaleOffset4: Vector4) {\r\n\t\tthis._shaderValues.setVector(ExtendTerrainMaterial.DIFFUSESCALEOFFSET4, scaleOffset4);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tset diffuseScaleOffset5(scaleOffset5: Vector4) {\r\n\t\tthis._shaderValues.setVector(ExtendTerrainMaterial.DIFFUSESCALEOFFSET5, scaleOffset5);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tset renderMode(value: number) {\r\n\t\tswitch (value) {\r\n\t\t\tcase ExtendTerrainMaterial.RENDERMODE_OPAQUE:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_OPAQUE;\r\n\t\t\t\tthis.depthWrite = true;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_DISABLE;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LESS;\r\n\t\t\t\tbreak;\r\n\t\t\tcase ExtendTerrainMaterial.RENDERMODE_TRANSPARENT:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_OPAQUE;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LEQUAL;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"ExtendTerrainMaterial:renderMode value error.\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>ExtendTerrainMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"ExtendTerrain\");\r\n\t\tthis.renderMode = ExtendTerrainMaterial.RENDERMODE_OPAQUE;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _setDetailNum(value: number): void {\r\n\t\tswitch (value) {\r\n\t\t\tcase 1:\r\n\t\t\t\tthis._shaderValues.addDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tthis._shaderValues.addDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tthis._shaderValues.addDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tthis._shaderValues.addDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tthis._shaderValues.addDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* \r\n\t* @return\t \r\n\t* @override\r\n\t*/\r\n\tclone(): any {\r\n\t\tvar dest: ExtendTerrainMaterial = new ExtendTerrainMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Vector4 } from \"../../../maths/Vector4\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { Material } from \"../../../resource/Material\";\r\n\r\n/**\r\n * <code>WaterPrimaryMaterial</code> \r\n */\r\nexport class WaterPrimaryMaterial extends Material {\r\n\r\n\tstatic HORIZONCOLOR: number;\r\n\tstatic MAINTEXTURE: number;\r\n\tstatic NORMALTEXTURE: number;\r\n\tstatic WAVESCALE: number;\r\n\tstatic WAVESPEED: number;\r\n\r\n\tstatic SHADERDEFINE_MAINTEXTURE: ShaderDefine;\r\n\tstatic SHADERDEFINE_NORMALTEXTURE: ShaderDefine;\r\n\r\n\t/** */\r\n\tstatic defaultMaterial: WaterPrimaryMaterial;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __initDefine__(): void {\r\n\t\tWaterPrimaryMaterial.SHADERDEFINE_MAINTEXTURE = Shader3D.getDefineByName(\"MAINTEXTURE\");\r\n\t\tWaterPrimaryMaterial.SHADERDEFINE_NORMALTEXTURE = Shader3D.getDefineByName(\"NORMALTEXTURE\");\r\n\t\tWaterPrimaryMaterial.HORIZONCOLOR = Shader3D.propertyNameToID(\"u_HorizonColor\");\r\n\t\tWaterPrimaryMaterial.MAINTEXTURE = Shader3D.propertyNameToID(\"u_MainTexture\");\r\n\t\tWaterPrimaryMaterial.NORMALTEXTURE = Shader3D.propertyNameToID(\"u_NormalTexture\");\r\n\t\tWaterPrimaryMaterial.WAVESCALE = Shader3D.propertyNameToID(\"u_WaveScale\");\r\n\t\tWaterPrimaryMaterial.WAVESPEED = Shader3D.propertyNameToID(\"u_WaveSpeed\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget horizonColor(): Vector4 {\r\n\t\treturn (<Vector4>this._shaderValues.getVector(WaterPrimaryMaterial.HORIZONCOLOR));\r\n\t}\r\n\r\n\tset horizonColor(value: Vector4) {\r\n\t\tthis._shaderValues.setVector(WaterPrimaryMaterial.HORIZONCOLOR, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget mainTexture(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(WaterPrimaryMaterial.MAINTEXTURE);\r\n\t}\r\n\r\n\tset mainTexture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis._shaderValues.addDefine(WaterPrimaryMaterial.SHADERDEFINE_MAINTEXTURE);\r\n\t\telse\r\n\t\t\tthis._shaderValues.removeDefine(WaterPrimaryMaterial.SHADERDEFINE_MAINTEXTURE);\r\n\t\tthis._shaderValues.setTexture(WaterPrimaryMaterial.MAINTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget normalTexture(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(WaterPrimaryMaterial.NORMALTEXTURE);\r\n\t}\r\n\r\n\tset normalTexture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis._shaderValues.addDefine(WaterPrimaryMaterial.SHADERDEFINE_NORMALTEXTURE);\r\n\t\telse\r\n\t\t\tthis._shaderValues.removeDefine(WaterPrimaryMaterial.SHADERDEFINE_NORMALTEXTURE);\r\n\t\tthis._shaderValues.setTexture(WaterPrimaryMaterial.NORMALTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget waveScale(): number {\r\n\t\treturn this._shaderValues.getNumber(WaterPrimaryMaterial.WAVESCALE);\r\n\t}\r\n\r\n\tset waveScale(value: number) {\r\n\t\tthis._shaderValues.setNumber(WaterPrimaryMaterial.WAVESCALE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget waveSpeed(): Vector4 {\r\n\t\treturn (<Vector4>this._shaderValues.getVector(WaterPrimaryMaterial.WAVESPEED));\r\n\t}\r\n\r\n\tset waveSpeed(value: Vector4) {\r\n\t\tthis._shaderValues.setVector(WaterPrimaryMaterial.WAVESPEED, value);\r\n\t}\r\n\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"WaterPrimary\");\r\n\t\tthis._shaderValues.setVector(WaterPrimaryMaterial.HORIZONCOLOR, new Vector4(0.172, 0.463, 0.435, 0));\r\n\t\tthis._shaderValues.setNumber(WaterPrimaryMaterial.WAVESCALE, 0.15);\r\n\t\tthis._shaderValues.setVector(WaterPrimaryMaterial.WAVESPEED, new Vector4(19, 9, -16, -7));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: WaterPrimaryMaterial = new WaterPrimaryMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n}\r\n\r\n\r\n","import { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { ShaderData } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Texture2D } from \"../../../../resource/Texture2D\";\r\nimport { Sprite3DRenderDeclaration } from \"../../../core/render/Sprite3DRenderDeclaration\";\r\nimport { RenderableSprite3D } from \"../../../core/RenderableSprite3D\";\r\nimport { Volume } from \"../Volume\";\r\nimport { VolumeManager } from \"../VolumeManager\";\r\n\r\nexport class VolumetricGI extends Volume {\r\n\r\n    probeCounts: Vector3;\r\n    probeStep: Vector3;\r\n\r\n    /** @internal */\r\n    probeLocations: Float32Array;\r\n\r\n    /**\r\n     * x: irradiance probe texel size\r\n     * y: distance probe texel size\r\n     * z: normalBias\r\n     * w: viewBias\r\n     */\r\n    private _params: Vector4;\r\n\r\n    private _irradiance: Texture2D;\r\n\r\n    /** @internal */\r\n    public get irradiance(): Texture2D {\r\n        return this._irradiance;\r\n    }\r\n    public set irradiance(value: Texture2D) {\r\n        if (this._irradiance == value)\r\n            return;\r\n\r\n        this._irradiance && (this.irradiance._removeReference());\r\n        value && (value._addReference());\r\n        this._irradiance = value;\r\n    }\r\n\r\n    private _distance: Texture2D;\r\n    /** @internal */\r\n    public get distance(): Texture2D {\r\n        return this._distance;\r\n    }\r\n    public set distance(value: Texture2D) {\r\n        if (this._distance == value)\r\n            return;\r\n        this._distance && (this._distance._removeReference());\r\n        value && (value._addReference());\r\n\r\n        this._distance = value;\r\n    }\r\n\r\n    intensity: number;\r\n\r\n    constructor() {\r\n        super();\r\n        this._type = VolumeManager.VolumetricGIType;\r\n        this.probeCounts = new Vector3();\r\n        this.probeStep = new Vector3();\r\n        this._params = new Vector4(8, 16, 0, 0);\r\n    }\r\n\r\n    public get normalBias(): number {\r\n        return this._params.z;\r\n    }\r\n    public set normalBias(value: number) {\r\n        this._params.z = value;\r\n    }\r\n\r\n    public get viewBias(): number {\r\n        return this._params.w;\r\n    }\r\n    public set viewBias(value: number) {\r\n        this._params.w = value;\r\n    }\r\n\r\n    public get irradianceTexel(): number {\r\n        return this._params.x;\r\n    }\r\n\r\n    public get distanceTexel(): number {\r\n        return this._params.y;\r\n    }\r\n\r\n    applyVolumetricGI(shaderData: ShaderData) {\r\n        shaderData.addDefine(Sprite3DRenderDeclaration.SHADERDEFINE_VOLUMETRICGI);\r\n\r\n        shaderData.setVector3(RenderableSprite3D.VOLUMETRICGI_PROBECOUNTS, this.probeCounts);\r\n        shaderData.setVector3(RenderableSprite3D.VOLUMETRICGI_PROBESTEPS, this.probeStep);\r\n\r\n        shaderData.setVector3(RenderableSprite3D.VOLUMETRICGI_PROBESTARTPOS, this.bounds.getMin());\r\n        shaderData.setVector(RenderableSprite3D.VOLUMETRICGI_PROBEPARAMS, this._params);\r\n\r\n        shaderData.setTexture(RenderableSprite3D.VOLUMETRICGI_IRRADIANCE, this.irradiance);\r\n        shaderData.setTexture(RenderableSprite3D.VOLUMETRICGI_DISTANCE, this.distance);\r\n\r\n    }\r\n\r\n    _onDestroy() {\r\n        // todo\r\n        this.irradiance = null;\r\n        this.distance = null;\r\n    }\r\n\r\n    _cloneTo(dest: VolumetricGI): void {\r\n        dest.irradiance = this.irradiance;\r\n        dest.distance = this.distance;\r\n        this.probeCounts.cloneTo(dest.probeCounts);\r\n        this.probeStep.cloneTo(dest.probeStep);\r\n        dest.normalBias = this.normalBias;\r\n        dest.viewBias = this.viewBias;\r\n    }\r\n\r\n}","import { Component } from \"../../components/Component\";\r\nimport { Camera } from \"../core/Camera\";\r\nimport { BaseRender, RenderBitFlag } from \"../core/render/BaseRender\";\r\nimport { Scene3D } from \"../core/scene/Scene3D\";\r\nimport { Sprite3D } from \"../core/Sprite3D\";\r\nimport { Bounds } from \"../math/Bounds\";\r\nimport { Event } from \"../../events/Event\";\r\nimport { Utils3D } from \"../utils/Utils3D\";\r\nimport { IBoundsCell } from \"../math/IBoundsCell\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\n\r\nconst tempVec = new Vector3();\r\nconst tempVec1 = new Vector3();\r\n\r\n/**\r\n * Lod\r\n */\r\nexport class LODInfo {\r\n    /**@internal */\r\n    _mincullRate: number;// 0-1\r\n\r\n    /**@internal */\r\n    _renders: BaseRender[];//LOD\r\n\r\n    /**@internal */\r\n    _cachSprite3D: Sprite3D[];\r\n\r\n    /**@internal */\r\n    _lodIndex: number;\r\n\r\n    /**@internal */\r\n    private _group: LODGroup;\r\n\r\n\r\n\r\n    /**\r\n     * LODInfo\r\n     * @param mincullRate \r\n     */\r\n    constructor(mincullRate: number) {\r\n        this._mincullRate = mincullRate;\r\n        this._renders = [];\r\n        this._cachSprite3D = [];\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set mincullRate(value: number) {\r\n        this._mincullRate = value;\r\n    }\r\n\r\n    get mincullRate() {\r\n        return this._mincullRate;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * LODGroup\r\n     */\r\n    set group(value: LODGroup) {\r\n        if (value == this._group)\r\n            return;\r\n        if (this._group) {//remove old event\r\n            // this._renders.forEach(element => {\r\n            //     (element.owner as Sprite3D).transform.off(Event.TRANSFORM_CHANGED, this._group._updateRecaculateFlag);\r\n            //     element._LOD = -1;\r\n            // })\r\n            for (let i = 0, n = this._renders.length; i < n; i++) {\r\n                let element = this._renders[i];\r\n                (element.owner as Sprite3D).transform.off(Event.TRANSFORM_CHANGED, this._group._updateRecaculateFlag);\r\n                element._LOD = -1;\r\n            }\r\n        }\r\n        this._group = value;\r\n        for (let i = 0, n = this._renders.length; i < n; i++) {\r\n            let element = this._renders[i];\r\n            (element.owner as Sprite3D).transform.on(Event.TRANSFORM_CHANGED, this._group, this._group._updateRecaculateFlag);\r\n            element._LOD = this._lodIndex;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * LODInfo\r\n     */\r\n    set renders(value: Sprite3D[]) {\r\n        this._cachSprite3D = value;\r\n        for (var i = 0, n = value.length; i < n; i++) {\r\n            this.addNode(value[i]);\r\n        }\r\n    }\r\n\r\n    get renders(): Sprite3D[] {\r\n        return this._cachSprite3D;\r\n    }\r\n\r\n    /**\r\n     * lodInfo\r\n     * @param node \r\n     */\r\n    addNode(node: Sprite3D) {\r\n        if (!node)\r\n            return;\r\n        let ren = node;\r\n        if (ren._isRenderNode > 0) {\r\n            let components = ren.components;\r\n            for (let comp of components) {\r\n                if ((comp instanceof BaseRender) && this._renders.indexOf(comp) == -1)\r\n                    this._renders.push(comp);\r\n            }\r\n            this._group && node.transform.on(Event.TRANSFORM_CHANGED, this._group, this._group._updateRecaculateFlag);\r\n        }\r\n        for (var i = 0, n = node.numChildren; i < n; i++) {\r\n            this.addNode(node.getChildAt(i) as Sprite3D);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * lod\r\n     * @param node \r\n     */\r\n    removeNode(node: Sprite3D) {\r\n        let ren = node;\r\n        if (ren._isRenderNode > 0) {\r\n            let components = ren.components;\r\n            let index: number;\r\n            for (let comp of components) {\r\n                if ((comp instanceof BaseRender) && (index = this._renders.indexOf(comp)) == -1) {\r\n                    this._renders.splice(index, 1);\r\n                    comp.setRenderbitFlag(RenderBitFlag.RenderBitFlag_CullFlag, false);\r\n                    this._group && node.transform.off(Event.TRANSFORM_CHANGED, this._group._updateRecaculateFlag);\r\n                }\r\n            }\r\n        }\r\n        for (var i = 0, n = node.numChildren; i < n; i++) {\r\n            this.removeNode(node.getChildAt(i) as Sprite3D);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * cull\r\n     */\r\n    removeAllRender() {\r\n        this._renders.forEach(element => {\r\n            element.setRenderbitFlag(RenderBitFlag.RenderBitFlag_CullFlag, false);\r\n        })\r\n    }\r\n}\r\n\r\n/**\r\n * <code>SpotLight</code> LOD\r\n */\r\nexport class LODGroup extends Component implements IBoundsCell {\r\n\r\n    /**\r\n     * _lodBoundsRadius_bounds\r\n     * LOD\r\n     */\r\n    private _needcaculateBounds: boolean = false;\r\n\r\n    /**     \r\n     * lodGroup\r\n     */\r\n    private _bounds: Bounds;\r\n\r\n    /**\r\n     * size\r\n     */\r\n    private _size: number;\r\n\r\n    /**\r\n     * \r\n     */\r\n    private _lodPosition: Vector3;\r\n\r\n    /**\r\n     * lod\r\n     */\r\n    private _lodCount: number;\r\n\r\n    /**\r\n     * lod\r\n     */\r\n    private _lods: LODInfo[] = [];\r\n\r\n    /**\r\n     * \r\n     */\r\n    private _visialIndex = -1;\r\n\r\n    /**\r\n     * lod\r\n     */\r\n    private _nowRate: number;\r\n\r\n    /**\r\n     * LODGroup\r\n     */\r\n    constructor() {\r\n        super();\r\n        this._bounds = new Bounds();\r\n        this._lodPosition = new Vector3();\r\n        this.runInEditor = true;\r\n    }\r\n    shadowCullPass(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n    * get LODInfo \r\n    * @returns \r\n    */\r\n    get lods(): LODInfo[] {\r\n        return this._lods;\r\n    }\r\n\r\n    /**\r\n     *  LODInfo \r\n     * @param data \r\n     */\r\n    set lods(data: LODInfo[]) {\r\n        this._lods = data;\r\n        for (var i = 0, n = this._lods.length; i < n; i++) {\r\n            let element = this._lods[i]\r\n            element._lodIndex = i;\r\n            element.group = this;\r\n        }\r\n        this._updateRecaculateFlag();\r\n        this._lodCount = this._lods.length;\r\n    }\r\n\r\n    get nowRate() {\r\n        return this._nowRate;\r\n    }\r\n\r\n    /**\r\n     * LOD\r\n     */\r\n    get bounds() {\r\n        this.recalculateBounds();\r\n        return this._bounds;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n        for (var i = 0, n = this._lods.length; i < n; i++) {\r\n            this._setLODinvisible(i);\r\n        }\r\n        this._visialIndex = -1;\r\n\r\n      \r\n        this._applyVisibleRate(1);\r\n    }\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onDisable(): void {\r\n        super._onDisable();\r\n        this._lods.forEach(element => {\r\n            element.removeAllRender();\r\n        })\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param rate \r\n     * @returns \r\n     */\r\n    private _applyVisibleRate(rate: number) {\r\n        for (var i = 0; i < this._lodCount; i++) {\r\n            let lod = this._lods[i];\r\n            if (rate > lod.mincullRate) {\r\n                if (i == -1) {\r\n                    this._setLODvisible(i);\r\n                    this._visialIndex = i;\r\n                    return;\r\n                }\r\n                if (i == this._visialIndex)\r\n                    return;\r\n                else {\r\n                    (this._visialIndex != -1) && this._setLODinvisible(this._visialIndex);\r\n                    this._setLODvisible(i);\r\n                    this._visialIndex = i;\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n        //cull\r\n        if (this._visialIndex != -1) {\r\n            this._setLODinvisible(this._visialIndex);\r\n            this._visialIndex = -1;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * LOD\r\n     * @param index \r\n     */\r\n    private _setLODvisible(index: number): void {\r\n        let lod = this._lods[index];\r\n        for (var i = 0, n = lod._renders.length; i < n; i++) {\r\n            lod._renders[i].setRenderbitFlag(RenderBitFlag.RenderBitFlag_CullFlag, false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * LOD\r\n     * @param index \r\n     */\r\n    private _setLODinvisible(index: number) {\r\n        let lod = this._lods[index];\r\n        for (var i = 0, n = lod._renders.length; i < n; i++) {\r\n            lod._renders[i].setRenderbitFlag(RenderBitFlag.RenderBitFlag_CullFlag, true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    onDestroy() {\r\n        this._lods.forEach(element => {\r\n            let renderarray = element._renders;\r\n            for (var i = 0; i < renderarray.length; i++) {\r\n                element.removeNode(renderarray[i].owner as Sprite3D);\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _updateRecaculateFlag() {\r\n        this._needcaculateBounds = true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param lodGroup \r\n     */\r\n    _cloneTo(lodGroup: LODGroup) {\r\n        super._cloneTo(lodGroup);\r\n        //get common parent\r\n        let getCommomParent = (rootNode: Sprite3D, rootCheckNode: Sprite3D): Sprite3D => {\r\n            let nodeArray: Sprite3D[] = [];\r\n            let node = rootNode;\r\n            while (!!node) {\r\n                if (node instanceof Sprite3D)\r\n                    nodeArray.push(node);\r\n                node = node.parent as Sprite3D;\r\n            }\r\n            let checkNode: Sprite3D = rootCheckNode;\r\n            while (!!checkNode && nodeArray.indexOf(checkNode) == -1) {\r\n                checkNode = checkNode.parent as Sprite3D;\r\n            }\r\n            return checkNode;\r\n        }\r\n        let cloneHierachFun = (rootNode: Sprite3D, rootCheckNode: Sprite3D, destNode: Sprite3D): Sprite3D => {\r\n            let rootparent: Sprite3D = getCommomParent(rootNode, rootCheckNode);\r\n            if (!rootparent)\r\n                return null;\r\n            let path: number[] = [];\r\n            Utils3D._getHierarchyPath(rootparent, rootNode, path);\r\n            let pathcheck: number[] = [];\r\n            Utils3D._getHierarchyPath(rootparent, rootCheckNode, pathcheck);\r\n            let destParent = Utils3D._getParentNodeByHierarchyPath(destNode, path);\r\n            if (!destParent)\r\n                return null;\r\n            return Utils3D._getNodeByHierarchyPath(destParent, pathcheck) as Sprite3D;\r\n        }\r\n        let lodArray: LODInfo[] = [];\r\n        for (let i = 0, n = this._lodCount; i < n; i++) {\r\n            let lod = this._lods[i];\r\n            let cloneLOD = new LODInfo(lod.mincullRate);\r\n            lodArray.push(cloneLOD);\r\n            lod._renders.forEach(element => {\r\n                let node = cloneHierachFun(this.owner as Sprite3D, element.owner as Sprite3D, lodGroup.owner as Sprite3D);\r\n                if (node)\r\n                    cloneLOD.addNode(node);\r\n            });\r\n        }\r\n        lodGroup.lods = lodArray;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    recalculateBounds() {\r\n        if (!this._needcaculateBounds) {\r\n            return;\r\n        }\r\n        let firstBounds = true;\r\n        for (let i = 0, n = this._lods.length; i < n; i++) {\r\n            let lod = this._lods[i];\r\n            lod._renders.forEach(element => {\r\n                if (firstBounds) {\r\n                    element.bounds.cloneTo(this._bounds);\r\n                    firstBounds = false;\r\n                }\r\n                else\r\n                    Bounds.merge(this._bounds, element.bounds, this._bounds);\r\n            });\r\n        }\r\n        this._lodPosition = this._bounds.getCenter();\r\n        let extend = this._bounds.getExtent();\r\n        this._size = 2 * Math.max(extend.x, extend.y, extend.z);\r\n        this._needcaculateBounds = false;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    onPreRender() {\r\n        this.recalculateBounds();\r\n        //\r\n        let checkCamera = (this.owner.scene as Scene3D).cullInfoCamera as Camera;\r\n        let maxYDistance = checkCamera.maxlocalYDistance;\r\n        let cameraFrustum = checkCamera.boundFrustum;\r\n        Vector3.subtract(this._lodPosition, checkCamera.transform.position, tempVec);\r\n        //farplane,.lod\r\n        let length = tempVec.length();\r\n        if (length > checkCamera.farPlane || cameraFrustum.containsPoint(this._lodPosition) == 0) {\r\n            return;\r\n        }\r\n        let rateYDistance = length / checkCamera.farPlane * maxYDistance;\r\n        let rate = (this._size / rateYDistance);\r\n        this._nowRate = rate;\r\n        this._applyVisibleRate(rate);\r\n    }\r\n}\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>PixelLineData</code> \r\n */\r\nexport class PixelLineData {\r\n\t/** */\r\n\tstartPosition: Vector3 = new Vector3();\r\n\t/** */\r\n\tendPosition: Vector3 = new Vector3();\r\n\t/** */\r\n\tstartColor: Color = new Color();\r\n\t/** */\r\n\tendColor: Color = new Color();\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: PixelLineData): void {\r\n\t\tthis.startPosition.cloneTo(destObject.startPosition);\r\n\t\tthis.endPosition.cloneTo(destObject.endPosition);\r\n\t\tthis.startColor.cloneTo(destObject.startColor);\r\n\t\tthis.endColor.cloneTo(destObject.endColor);\r\n\t}\r\n}\r\n\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { GeometryElement } from \"../GeometryElement\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { PixelLineData } from \"./PixelLineData\";\r\nimport { PixelLineRenderer } from \"./PixelLineRenderer\";\r\nimport { PixelLineVertex } from \"./PixelLineVertex\";\r\n\r\n/**\r\n * <code>PixelLineFilter</code> \r\n */\r\nexport class PixelLineFilter extends GeometryElement {\r\n\t/** @private */\r\n\tprivate static _tempVector0: Vector3 = new Vector3();\r\n\t/** @private */\r\n\tprivate static _tempVector1: Vector3 = new Vector3();\r\n\r\n\t/**@internal */\r\n\tprivate static _type: number = GeometryElement._typeCounter++;\r\n\r\n\t/** @internal */\r\n\tprivate _floatCountPerVertices: number = 7;\r\n\r\n\r\n\t/** @internal */\r\n\tprivate _vertexBuffer: VertexBuffer3D;\r\n\t/** @internal */\r\n\tprivate _vertices: Float32Array;\r\n\t/** @internal */\r\n\tprivate _minUpdate: number = Number.MAX_VALUE;\r\n\t/** @internal */\r\n\tprivate _maxUpdate: number = Number.MIN_VALUE;\r\n\t/** @internal */\r\n\tprivate _floatBound: Float32Array = new Float32Array(6);\r\n\t/** @internal */\r\n\tprivate _calculateBound: boolean = false;\r\n\r\n\t/** @internal */\r\n\t_ownerRender: PixelLineRenderer;\r\n\t/** @internal */\r\n\t_bounds: Bounds;\r\n\t/** @internal */\r\n\t_maxLineCount: number = 0;\r\n\t/** @internal */\r\n\t_lineCount: number = 0;\r\n\r\n\t/**\r\n\t * PixelLineFilter\r\n\t * @param owner  \r\n\t * @param maxLineCount \r\n\t */\r\n\tconstructor(owner: PixelLineRenderer, maxLineCount: number) {\r\n\t\tsuper(MeshTopology.Lines, DrawType.DrawArray);\r\n\t\tvar pointCount: number = maxLineCount * 2;\r\n\t\tthis._ownerRender = owner;\r\n\t\tthis._maxLineCount = maxLineCount;\r\n\t\tthis._vertices = new Float32Array(pointCount * this._floatCountPerVertices);\r\n\t\tthis._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(PixelLineVertex.vertexDeclaration.vertexStride * pointCount, BufferUsage.Static, false);\r\n\t\tthis._vertexBuffer.vertexDeclaration = PixelLineVertex.vertexDeclaration;\r\n\r\n\t\tvar bufferState = new BufferState();\r\n\t\tthis.bufferState = bufferState;\r\n\t\tthis.bufferState.applyState([this._vertexBuffer], null);\r\n\r\n\t\tvar min: Vector3 = PixelLineFilter._tempVector0;\r\n\t\tvar max: Vector3 = PixelLineFilter._tempVector1;\r\n\t\tmin.setValue(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);\r\n\t\tmax.setValue(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE);\r\n\t\tthis._bounds = new Bounds(min, max);\r\n\t}\r\n\r\n\t/**\r\n\t *\t{@inheritDoc PixelLineFilter._getType}\r\n\t *\t@override\r\n\t *  @internal\r\n\t */\r\n\t_getType(): number {\r\n\t\treturn PixelLineFilter._type;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_resizeLineData(maxCount: number): void {\r\n\t\tvar pointCount: number = maxCount * 2;\r\n\t\tvar lastVertices: Float32Array = this._vertices;\r\n\r\n\t\tthis._vertexBuffer.destroy();\r\n\t\tthis._maxLineCount = maxCount;\r\n\r\n\t\tvar vertexCount: number = pointCount * this._floatCountPerVertices;\r\n\t\tthis._vertices = new Float32Array(vertexCount);\r\n\t\tthis._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(PixelLineVertex.vertexDeclaration.vertexStride * pointCount, BufferUsage.Static, false);\r\n\t\tthis._vertexBuffer.vertexDeclaration = PixelLineVertex.vertexDeclaration;\r\n\r\n\t\tif (vertexCount < lastVertices.length) {//,\r\n\t\t\tthis._vertices.set(new Float32Array(lastVertices.buffer, 0, vertexCount));\r\n\t\t\tthis._vertexBuffer.setData(this._vertices.buffer, 0, 0, vertexCount * 4);\r\n\t\t} else {\r\n\t\t\tthis._vertices.set(lastVertices);\r\n\t\t\tthis._vertexBuffer.setData(this._vertices.buffer, 0, 0, lastVertices.length * 4);\r\n\t\t}\r\n\r\n\t\tthis.bufferState.applyState([this._vertexBuffer], null);\r\n\r\n\t\tthis._minUpdate = Number.MAX_VALUE;\r\n\t\tthis._maxUpdate = Number.MIN_VALUE;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _updateLineVertices(offset: number, startPosition: Vector3, endPosition: Vector3, startColor: Color, endColor: Color): void {\r\n\t\tif (startPosition) {\r\n\t\t\tthis._vertices[offset + 0] = startPosition.x;\r\n\t\t\tthis._vertices[offset + 1] = startPosition.y;\r\n\t\t\tthis._vertices[offset + 2] = startPosition.z;\r\n\t\t}\r\n\r\n\t\tif (startColor) {\r\n\t\t\tthis._vertices[offset + 3] = startColor.r;\r\n\t\t\tthis._vertices[offset + 4] = startColor.g;\r\n\t\t\tthis._vertices[offset + 5] = startColor.b;\r\n\t\t\tthis._vertices[offset + 6] = startColor.a;\r\n\t\t}\r\n\r\n\t\tif (endPosition) {\r\n\t\t\tthis._vertices[offset + 7] = endPosition.x;\r\n\t\t\tthis._vertices[offset + 8] = endPosition.y;\r\n\t\t\tthis._vertices[offset + 9] = endPosition.z;\r\n\t\t}\r\n\r\n\t\tif (endColor) {\r\n\t\t\tthis._vertices[offset + 10] = endColor.r;\r\n\t\t\tthis._vertices[offset + 11] = endColor.g;\r\n\t\t\tthis._vertices[offset + 12] = endColor.b;\r\n\t\t\tthis._vertices[offset + 13] = endColor.a;\r\n\t\t}\r\n\t\tthis._minUpdate = Math.min(this._minUpdate, offset);\r\n\t\tthis._maxUpdate = Math.max(this._maxUpdate, offset + this._floatCountPerVertices * 2);\r\n\r\n\t\t//expand bound\r\n\t\tvar bounds: Bounds = this._bounds;\r\n\t\tvar floatBound: Float32Array = this._floatBound;\r\n\t\tvar min: Vector3 = bounds.getMin(), max: Vector3 = bounds.getMax();\r\n\t\tVector3.min(min, startPosition, min);\r\n\t\tVector3.min(min, endPosition, min);\r\n\t\tVector3.max(max, startPosition, max);\r\n\t\tVector3.max(max, endPosition, max);\r\n\t\tbounds.setMin(min);\r\n\t\tbounds.setMax(max);\r\n\t\tfloatBound[0] = min.x, floatBound[1] = min.y, floatBound[2] = min.z;\r\n\t\tfloatBound[3] = max.x, floatBound[4] = max.y, floatBound[5] = max.z;\r\n\t\tthis._ownerRender.boundsChange = true;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_reCalculateBound(): void {\r\n\t\tif (this._calculateBound) {\r\n\t\t\tvar vertices: Float32Array = this._vertices;\r\n\t\t\tvar min: Vector3 = PixelLineFilter._tempVector0;\r\n\t\t\tvar max: Vector3 = PixelLineFilter._tempVector1;\r\n\t\t\tmin.setValue(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);\r\n\t\t\tmax.setValue(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE);\r\n\t\t\tfor (var i: number = 0; i < this._lineCount * 2; ++i) {\r\n\t\t\t\tvar offset: number = this._floatCountPerVertices * i;\r\n\t\t\t\tvar x: number = vertices[offset + 0], y: number = vertices[offset + 1], z: number = vertices[offset + 2];\r\n\t\t\t\tmin.x = Math.min(x, min.x);\r\n\t\t\t\tmin.y = Math.min(y, min.y);\r\n\t\t\t\tmin.z = Math.min(z, min.z);\r\n\t\t\t\tmax.x = Math.max(x, max.x);\r\n\t\t\t\tmax.y = Math.max(y, max.y);\r\n\t\t\t\tmax.z = Math.max(z, max.z);\r\n\t\t\t}\r\n\t\t\tthis._bounds.setMin(min);\r\n\t\t\tthis._bounds.setMax(max);\r\n\t\t\tvar floatBound: Float32Array = this._floatBound;\r\n\t\t\tfloatBound[0] = min.x, floatBound[1] = min.y, floatBound[2] = min.z;\r\n\t\t\tfloatBound[3] = max.x, floatBound[4] = max.y, floatBound[5] = max.z;\r\n\t\t\tthis._calculateBound = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_removeLineData(index: number): void {\r\n\t\tvar floatCount: number = this._floatCountPerVertices * 2;\r\n\t\tvar nextIndex: number = index + 1;\r\n\t\tvar offset: number = index * floatCount;\r\n\r\n\t\tvar vertices: Float32Array = this._vertices;\r\n\t\tvar rightPartVertices: Float32Array = new Float32Array(vertices.buffer, nextIndex * floatCount * 4, (this._lineCount - nextIndex) * floatCount);\r\n\t\tvertices.set(rightPartVertices, offset);\r\n\t\tthis._minUpdate = Math.min(this._minUpdate, offset);\r\n\t\tthis._maxUpdate = Math.max(this._maxUpdate, offset + rightPartVertices.length);\r\n\t\tthis._lineCount--;\r\n\r\n\t\tvar floatBound: Float32Array = this._floatBound;\r\n\t\tvar startX: number = vertices[offset], startY: number = vertices[offset + 1], startZ: number = vertices[offset + 2];\r\n\t\tvar endX: number = vertices[offset + 7], endY: number = vertices[offset + 8], endZ: number = vertices[offset + 9];\r\n\t\tvar minX: number = floatBound[0], minY: number = floatBound[1], minZ: number = floatBound[2];\r\n\t\tvar maxX: number = floatBound[3], maxY: number = floatBound[4], maxZ: number = floatBound[5];\r\n\r\n\t\tif ((startX === minX) || (startX === maxX) || (startY === minY) || (startY === maxY) || (startZ === minZ) || (startZ === maxZ) ||\r\n\t\t\t(endX === minX) || (endX === maxX) || (endY === minY) || (endY === maxY) || (endZ === minZ) || (endZ === maxZ))\r\n\t\t\tthis._calculateBound = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_updateLineData(index: number, startPosition: Vector3, endPosition: Vector3, startColor: Color, endColor: Color): void {\r\n\t\tvar floatCount: number = this._floatCountPerVertices * 2;\r\n\t\tthis._updateLineVertices(index * floatCount, startPosition, endPosition, startColor, endColor);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_updateLineDatas(index: number, data: PixelLineData[]): void {\r\n\t\tvar floatCount: number = this._floatCountPerVertices * 2;\r\n\t\tvar count: number = data.length;\r\n\t\tfor (var i: number = 0; i < count; i++) {\r\n\t\t\tvar line: PixelLineData = data[i];\r\n\t\t\tthis._updateLineVertices((index + i) * floatCount, line.startPosition, line.endPosition, line.startColor, line.endColor);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\t_getLineData(index: number, out: PixelLineData): void {\r\n\t\tvar startPosition: Vector3 = out.startPosition;\r\n\t\tvar startColor: Color = out.startColor;\r\n\t\tvar endPosition: Vector3 = out.endPosition;\r\n\t\tvar endColor: Color = out.endColor;\r\n\r\n\t\tvar vertices: Float32Array = this._vertices;\r\n\t\tvar offset: number = index * this._floatCountPerVertices * 2;\r\n\r\n\t\tstartPosition.x = vertices[offset + 0];\r\n\t\tstartPosition.y = vertices[offset + 1];\r\n\t\tstartPosition.z = vertices[offset + 2];\r\n\t\tstartColor.r = vertices[offset + 3];\r\n\t\tstartColor.g = vertices[offset + 4];\r\n\t\tstartColor.b = vertices[offset + 5];\r\n\t\tstartColor.a = vertices[offset + 6];\r\n\r\n\t\tendPosition.x = vertices[offset + 7];\r\n\t\tendPosition.y = vertices[offset + 8];\r\n\t\tendPosition.z = vertices[offset + 9];\r\n\t\tendColor.r = vertices[offset + 10];\r\n\t\tendColor.g = vertices[offset + 11];\r\n\t\tendColor.b = vertices[offset + 12];\r\n\t\tendColor.a = vertices[offset + 13];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_prepareRender(state: RenderContext3D): boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_updateRenderParams(state: RenderContext3D): void {\r\n\t\tthis.clearRenderParams();\r\n\t\tif (this._minUpdate !== Number.MAX_VALUE && this._maxUpdate !== Number.MIN_VALUE) {\r\n\t\t\tthis._vertexBuffer.setData(this._vertices.buffer, this._minUpdate * 4, this._minUpdate * 4, (this._maxUpdate - this._minUpdate) * 4);\r\n\t\t\tthis._minUpdate = Number.MAX_VALUE;\r\n\t\t\tthis._maxUpdate = Number.MIN_VALUE;\r\n\t\t}\r\n\t\tif (this._lineCount > 0) {\r\n\t\t\tthis.setDrawArrayParams(0, this._lineCount * 2);\r\n\t\t\t// LayaGL.renderDrawConatext.drawArrays(MeshTopology.Lines, 0, this._lineCount * 2);\r\n\t\t\t// Stat.renderBatches++;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * \r\n\t */\r\n\tdestroy(): void {\r\n\t\tif (this._destroyed)\r\n\t\t\treturn;\r\n\t\tsuper.destroy();\r\n\t\tthis.bufferState.destroy();\r\n\t\tthis._vertexBuffer.destroy();\r\n\t\tthis.bufferState = null;\r\n\t\tthis._vertexBuffer = null;\r\n\t\tthis._vertices = null;\r\n\t}\r\n}\r\n\r\n","import { Vector4 } from \"../../../maths/Vector4\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { Material } from \"../../../resource/Material\";\r\n\r\n/**\r\n * <code>PixelLineMaterial</code> \r\n */\r\nexport class PixelLineMaterial extends Material {\r\n\t/**@internal */\r\n\tstatic COLOR: number;\r\n\r\n\t/** */\r\n\tstatic defaultMaterial: PixelLineMaterial;\r\n\r\n\t/**\r\n\t* @internal\r\n\t*/\r\n\tstatic __initDefine__(): void {\r\n\t\tPixelLineMaterial.COLOR = Shader3D.propertyNameToID(\"u_Color\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget color(): Vector4 {\r\n\t\treturn (<Vector4>this._shaderValues.getVector(PixelLineMaterial.COLOR));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset color(value: Vector4) {\r\n\t\tthis._shaderValues.setVector(PixelLineMaterial.COLOR, value);\r\n\t}\r\n\r\n\t/**\r\n\t *   <code>PixelLineMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"LineShader\");\r\n\t\tthis._shaderValues.setVector(PixelLineMaterial.COLOR, new Vector4(1.0, 1.0, 1.0, 1.0));\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: PixelLineMaterial = new PixelLineMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n}\r\n\r\n","import { Component } from \"../../../components/Component\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { MeshSprite3DShaderDeclaration } from \"../MeshSprite3DShaderDeclaration\";\r\nimport { BaseRender } from \"../render/BaseRender\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { RenderElement } from \"../render/RenderElement\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Transform3D } from \"../Transform3D\";\r\nimport { PixelLineData } from \"./PixelLineData\";\r\nimport { PixelLineFilter } from \"./PixelLineFilter\";\r\nimport { PixelLineMaterial } from \"./PixelLineMaterial\";\r\n\r\n\r\n/**\r\n * <code>PixelLineRenderer</code> \r\n */\r\nexport class PixelLineRenderer extends BaseRender {\r\n    /** @internal */\r\n    protected _projectionViewWorldMatrix: Matrix4x4;\r\n\r\n    /**@internal */\r\n    _pixelLineFilter: PixelLineFilter;\r\n    /** @private active */\r\n    private _isRenderActive: Boolean = false;\r\n    /** @private */\r\n    private _isInRenders: Boolean = false;\r\n\r\n    private _needUpdatelines: boolean = false;\r\n    /**\r\n     * PixelLineRenderer\r\n     * @param owner \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._projectionViewWorldMatrix = new Matrix4x4();\r\n        this._pixelLineFilter = new PixelLineFilter(this, 20);\r\n        this._shaderValues.addDefine(MeshSprite3DShaderDeclaration.SHADERDEFINE_COLOR);\r\n    }\r\n\r\n    private _lines: PixelLineData[] = [];\r\n\r\n    get pixelLinesDatas() {\r\n        if (this._needUpdatelines) {\r\n            this._updateLineDatas();\r\n        }\r\n        return this._lines;\r\n    }\r\n\r\n    set pixelLinesDatas(value: PixelLineData[]) {\r\n        this.clear();\r\n        this.addLines(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get maxLineCount(): number {\r\n        return this._pixelLineFilter._maxLineCount;\r\n    }\r\n\r\n    set maxLineCount(value: number) {\r\n        this._pixelLineFilter._resizeLineData(value);\r\n        this._pixelLineFilter._lineCount = Math.min(this._pixelLineFilter._lineCount, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get lineCount(): number {\r\n        return this._pixelLineFilter._lineCount;\r\n    }\r\n\r\n    protected _onAdded(): void {\r\n        super._onAdded();\r\n        this._changeRenderObjects(0, PixelLineMaterial.defaultMaterial);\r\n    }\r\n\r\n    protected _onEnable(): void {\r\n        this._isRenderActive = true;\r\n        if (this._pixelLineFilter._lineCount != 0) {\r\n            (this.owner.scene)._addRenderObject(this);\r\n            this._isInRenders = true;\r\n        }\r\n        this._setBelongScene(this.owner.scene);\r\n    }\r\n\r\n    protected _onDisable(): void {\r\n        if (this._pixelLineFilter && this._pixelLineFilter._lineCount != 0 && this._isRenderActive) {\r\n            this.owner.scene._removeRenderObject(this);\r\n            this._isInRenders = false;\r\n        }\r\n        this._isRenderActive = false;\r\n        this._setUnBelongScene();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    protected _calculateBoundingBox(): void {\r\n        var worldMat: Matrix4x4 = (this.owner as Sprite3D).transform.worldMatrix;\r\n        var lineFilter: PixelLineFilter = this._pixelLineFilter;\r\n        lineFilter._reCalculateBound();\r\n        lineFilter._bounds._tranform(worldMat, this._bounds);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _renderUpdateWithCamera(context: RenderContext3D, transform: Transform3D): void {//TODO:_renderUpdate\r\n        var projectionView: Matrix4x4 = context.projectionViewMatrix;\r\n        var sv: ShaderData = this._shaderValues;\r\n        if (transform) {\r\n            var worldMat: Matrix4x4 = transform.worldMatrix;\r\n            sv.setMatrix4x4(Sprite3D.WORLDMATRIX, worldMat);\r\n            this._worldParams.x = transform.getFrontFaceValue();\r\n            sv.setVector(Sprite3D.WORLDINVERTFRONT, this._worldParams);\r\n        } else {\r\n            sv.setMatrix4x4(Sprite3D.WORLDMATRIX, Matrix4x4.DEFAULT);\r\n            sv.setVector(Sprite3D.WORLDINVERTFRONT, Vector4.UnitX);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    _changeRenderObjects(index: number, material: Material): void {\r\n        var renderObjects: RenderElement[] = this._renderElements;\r\n        (material) || (material = PixelLineMaterial.defaultMaterial);\r\n        var renderElement: RenderElement = renderObjects[index];\r\n        (renderElement) || (renderElement = renderObjects[index] = new RenderElement());\r\n        renderElement.setTransform((this.owner as Sprite3D)._transform);\r\n        renderElement.setGeometry(this._pixelLineFilter);\r\n        renderElement.render = this;\r\n        renderElement.material = material;\r\n    }\r\n\r\n    /**\r\n     * @internal //animator data set call\r\n     * @param key \r\n     */\r\n    _pixelLinesDataChange(key: string) {\r\n        if (key != null) {\r\n            let keyN = parseInt(key);\r\n            let line = this._lines[keyN];\r\n            if (line) {\r\n                this.setLine(keyN, line.startPosition, line.endPosition, line.startColor, line.endColor);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tstartPosition  \r\n     * @param\tendPosition\t   \r\n     * @param\tstartColor\t   \r\n     * @param\tendColor\t   \r\n     */\r\n    addLine(startPosition: Vector3, endPosition: Vector3, startColor: Color, endColor: Color): void {\r\n        if (this._pixelLineFilter._lineCount !== this._pixelLineFilter._maxLineCount)\r\n            this._pixelLineFilter._updateLineData(this._pixelLineFilter._lineCount++, startPosition, endPosition, startColor, endColor);\r\n        else\r\n            throw \"PixelLineSprite3D: lineCount has equal with maxLineCount.\";\r\n        if (this._isRenderActive && !this._isInRenders && this._pixelLineFilter._lineCount > 0) {\r\n            this.owner.scene && this.owner.scene._addRenderObject(this);\r\n            this._isInRenders = true;\r\n        }\r\n        this._needUpdatelines = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tlines  \r\n     */\r\n    addLines(lines: PixelLineData[]): void {\r\n        var lineCount: number = this._pixelLineFilter._lineCount;\r\n        var addCount: number = lines.length;\r\n        if (lineCount + addCount > this._pixelLineFilter._maxLineCount) {\r\n            throw \"PixelLineSprite3D: lineCount plus lines count must less than maxLineCount.\";\r\n        } else {\r\n            this._pixelLineFilter._updateLineDatas(lineCount, lines);\r\n            this._pixelLineFilter._lineCount += addCount;\r\n        }\r\n        if (this._isRenderActive && !this._isInRenders && this._pixelLineFilter._lineCount > 0) {\r\n            this.owner.scene && this.owner.scene._addRenderObject(this);\r\n            this._isInRenders = true;\r\n        }\r\n        this._needUpdatelines = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param index \r\n     */\r\n    removeLine(index: number): void {\r\n        if (index < this._pixelLineFilter._lineCount)\r\n            this._pixelLineFilter._removeLineData(index);\r\n        else\r\n            throw \"PixelLineSprite3D: index must less than lineCount.\";\r\n        if (this._isRenderActive && this._isInRenders && this._pixelLineFilter._lineCount == 0) {\r\n            this.owner.scene && this.owner.scene._removeRenderObject(this);\r\n            this._isInRenders = false;\r\n        }\r\n        this._needUpdatelines = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tindex  \t\t   \r\n     * @param\tstartPosition  \r\n     * @param\tendPosition\t   \r\n     * @param\tstartColor\t   \r\n     * @param\tendColor\t   \r\n     */\r\n    setLine(index: number, startPosition: Vector3, endPosition: Vector3, startColor: Color, endColor: Color): void {\r\n        if (index < this._pixelLineFilter._lineCount) {\r\n            this._pixelLineFilter._updateLineData(index, startPosition, endPosition, startColor, endColor);\r\n            let pixeldata = this._lines[index];\r\n            if (pixeldata) {\r\n                startColor.cloneTo(pixeldata.startColor);\r\n                endColor.cloneTo(pixeldata.endColor);\r\n                startPosition.cloneTo(pixeldata.startPosition);\r\n                endPosition.cloneTo(pixeldata.endPosition);\r\n            }\r\n        }\r\n\r\n        else\r\n            throw \"PixelLineSprite3D: index must less than lineCount.\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param out \r\n     */\r\n    getLine(index: number, out: PixelLineData): void {\r\n        if (index < this.lineCount)\r\n            this._pixelLineFilter._getLineData(index, out);\r\n        else\r\n            throw \"PixelLineSprite3D: index must less than lineCount.\";\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _updateLineDatas() {\r\n        let n = this.lineCount;\r\n        this._lines = [];\r\n        for (let i = 0; i < n; i++) {\r\n            let pixelLineDatas = new PixelLineData();\r\n            this.getLine(i, pixelLineDatas);\r\n            this._lines.push(pixelLineDatas);\r\n        }\r\n        this._needUpdatelines = false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    clear(): void {\r\n        this._pixelLineFilter._lineCount = 0;\r\n        if (this._isRenderActive && this._isInRenders) {\r\n            this.owner.scene && this.owner.scene._removeRenderObject(this);\r\n            this._isInRenders = false;\r\n        }\r\n    }\r\n\r\n    protected _onDestroy() {\r\n        this._pixelLineFilter.destroy();\r\n        this._pixelLineFilter = null;\r\n        super._onDestroy();\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @param dest \r\n     */\r\n    _cloneTo(dest: Component): void {\r\n        super._cloneTo(dest);\r\n        let render = dest as PixelLineRenderer;\r\n        render.maxLineCount = this.maxLineCount;\r\n        const lineCount = this.lineCount;\r\n        let linedata = new PixelLineData();\r\n        for (let i = 0, n = lineCount; i < n; i++) {\r\n            this.getLine(i, linedata);\r\n            render.addLine(linedata.startPosition, linedata.endPosition, linedata.startColor, linedata.endColor);\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n","import { AnimatorState } from \"./AnimatorState\";\r\n\r\n/**\r\n * <code>AnimatorPlayState</code> \r\n */\r\nexport class AnimatorPlayState {\r\n\t/**@internal */\r\n\t_finish: boolean;\r\n\t/**@internal */\r\n\t_startPlayTime: number;\r\n\t/**@internal */\r\n\t_lastElapsedTime: number;\r\n\t/**@internal */\r\n\t_elapsedTime: number;\r\n\t/**@internal ,*/\r\n\t_normalizedTime: number;\r\n\t/**@internal  */\r\n\t_normalizedPlayTime: number;\r\n\t/**@internal */\r\n\t_duration: number;\r\n\t/**@internal event*/\r\n\t_parentPlayTime: number;\r\n\t/**@internal */\r\n\t_playEventIndex: number;\r\n\t/**@internal */\r\n\t_lastIsFront: boolean;\r\n\t/**@internal */\r\n\tprivate _currentState: AnimatorState | null = null;\r\n\r\n\t/**\r\n\t * State\r\n\t */\r\n\tpublic get currentState(): AnimatorState | null {\r\n\t\treturn this._currentState;\r\n\t}\r\n\tpublic set currentState(value: AnimatorState | null) {\r\n\t\tthis._currentState = value;\r\n\t\tthis._currentState.curTransition = null;//\r\n\t}\r\n\r\n\t/**\r\n\t * ,\r\n\t */\r\n\tget normalizedTime(): number {\r\n\t\treturn this._normalizedTime;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget duration(): number {\r\n\t\treturn this._duration;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget animatorState(): AnimatorState {\r\n\t\treturn this._currentState!;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>AnimatorPlayState</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_resetPlayState(startTime: number, clipDuration: number): void {\r\n\t\tthis._finish = false;\r\n\t\tthis._playEventIndex = 0;\r\n\t\tthis._startPlayTime = startTime;\r\n\t\tthis._elapsedTime = startTime;\r\n\t\tthis._lastIsFront = true;\r\n\t\tthis._normalizedTime = this._elapsedTime / clipDuration;\r\n\t\tvar playTime = this._normalizedTime % 1.0;\r\n\t\tthis._normalizedPlayTime = playTime < 0 ? playTime + 1.0 : playTime;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_cloneTo(dest: AnimatorPlayState): void {\r\n\t\tdest._finish = this._finish;\r\n\t\tdest._startPlayTime = this._startPlayTime;\r\n\t\tdest._playEventIndex = this._playEventIndex;\r\n\t\tdest._elapsedTime = this._elapsedTime;\r\n\t\tdest._normalizedTime = this._normalizedTime;\r\n\t\tdest._normalizedPlayTime = this._normalizedPlayTime;\r\n\t\tdest._lastIsFront = this._lastIsFront;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { IClone } from \"../../../utils/IClone\";\r\nimport { AnimationClip } from \"../../animation/AnimationClip\";\r\nimport { Animator } from \"./Animator\";\r\nimport { AnimatorPlayState } from \"./AnimatorPlayState\";\r\nimport { AnimatorState } from \"./AnimatorState\";\r\nimport { AvatarMask } from \"./AvatarMask\";\r\nimport { KeyframeNodeOwner } from \"./KeyframeNodeOwner\";\r\n\r\n\r\n/**\r\n * <code>AnimatorControllerLayer</code> \r\n */\r\nexport class AnimatorControllerLayer implements IClone {\r\n    /**_ */\r\n    static BLENDINGMODE_OVERRIDE: number = 0;\r\n    /**_ */\r\n    static BLENDINGMODE_ADDTIVE: number = 1;\r\n\r\n    /**@internal */\r\n    private _defaultState: AnimatorState | null;\r\n    /**@internal */\r\n    private _referenceCount: number = 0;\r\n\r\n    /**@internal 0:1:2:*/\r\n    _playType: number = -1;\r\n    /**@internal */\r\n    _crossDuration: number = -1;\r\n    /**@internal */\r\n    _crossPlayState: AnimatorState;\r\n    /**@internal */\r\n    _crossMark: number = 0;\r\n    /**@internal */\r\n    _crossNodesOwnersCount: number = 0;\r\n    /**@internal */\r\n    _crossNodesOwners: KeyframeNodeOwner[] = [];\r\n    /**@internal */\r\n    _crossNodesOwnersIndicesMap: any = {};\r\n    /**@internal */\r\n    _srcCrossClipNodeIndices: number[] = [];\r\n    /**@internal */\r\n    _destCrossClipNodeIndices: number[] = [];\r\n\r\n    /**@internal */\r\n    _animator: Animator;\r\n    /**@internal */\r\n    _states: AnimatorState[] = [];\r\n    /**@internal */\r\n    _playStateInfo: AnimatorPlayState | null = new AnimatorPlayState();\r\n    /**@internal */\r\n    _crossPlayStateInfo: AnimatorPlayState | null = new AnimatorPlayState();\r\n    /**@internal */\r\n    _avatarMask: AvatarMask;\r\n    /** */\r\n    name: string;\r\n    /** */\r\n    blendingMode: number = AnimatorControllerLayer.BLENDINGMODE_OVERRIDE;\r\n    /** */\r\n    defaultWeight: number = 1.0;\r\n    /**\t*/\r\n    playOnWake: boolean = true;\r\n    /**  */\r\n    enable: boolean = true;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get defaultState(): AnimatorState {\r\n        return this._defaultState!;\r\n    }\r\n\r\n    set defaultState(value: AnimatorState) {\r\n        this._defaultState = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get avatarMask(): AvatarMask {\r\n        return this._avatarMask;\r\n    }\r\n\r\n    set avatarMask(value: AvatarMask) {\r\n        this._avatarMask = value;\r\n    }\r\n\r\n    //@internal\r\n    public get defaultStateName() {\r\n        if (!this._defaultState) {\r\n            return null;\r\n        }\r\n        return this._defaultState.name;\r\n    }\r\n\r\n    private _defaultStateNameCatch: string;\r\n    //@internal\r\n    public set defaultStateName(value: string) {\r\n        this._defaultState = this.getAnimatorState(value);\r\n        if (null == this._defaultState) {\r\n            if (0 == this._states.length) {\r\n                this._defaultStateNameCatch = value;\r\n            } else {\r\n                for (var i = this._states.length - 1; i >= 0; i--) {\r\n                    if (this._states[i].name == value) {\r\n                        this._defaultState = this._states[i];\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //@internal\r\n    public get states(): ReadonlyArray<AnimatorState> {\r\n        return this._states;\r\n    }\r\n\r\n    //@internal\r\n    public set states(states: ReadonlyArray<AnimatorState>) {\r\n        if (this._states === states)\r\n            return;\r\n\r\n        if (this._states.length > 0) {\r\n            let removed = this._states.filter(s => states.indexOf(s) == -1);\r\n            for (let state of removed)\r\n                this.removeState(state);\r\n        }\r\n\r\n        if (states.length > 0) {\r\n            let newAdded = states.filter(s => this._states.indexOf(s) == -1);\r\n            for (let state of newAdded)\r\n                this.addState(state);\r\n        }\r\n\r\n        this._states.length = 0;\r\n        this._states.push(...states);\r\n    }\r\n\r\n    /**\r\n     *  <code>AnimatorControllerLayer</code> \r\n     * @param \r\n     */\r\n    constructor(name: string) {\r\n        this.name = name;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _removeClip(clipStateInfos: AnimatorState[], index: number, state: AnimatorState): void {\r\n        var clip: AnimationClip = state._clip!;\r\n        var clipStateInfo: AnimatorState = clipStateInfos[index];\r\n\r\n        clipStateInfos.splice(index, 1);\r\n\r\n        if (this._animator) {\r\n            var frameNodes = clip._nodes;\r\n            var nodeOwners: KeyframeNodeOwner[] = clipStateInfo._nodeOwners;\r\n            clip._removeReference();\r\n            for (var i: number = 0, n: number = frameNodes!.count; i < n; i++)\r\n                this._animator._removeKeyframeNodeOwner(nodeOwners, frameNodes!.getNodeByIndex(i));\r\n        }\r\n    }\r\n\r\n    _getReferenceCount(): number {\r\n        return this._referenceCount;\r\n    }\r\n\r\n    _addReference(count: number = 1): void {\r\n        for (var i: number = 0, n: number = this._states.length; i < n; i++)\r\n            this._states[i]._addReference(count);\r\n        this._referenceCount += count;\r\n    }\r\n\r\n    _removeReference(count: number = 1): void {\r\n        for (var i: number = 0, n: number = this._states.length; i < n; i++)\r\n            this._states[i]._removeReference(count);\r\n        this._referenceCount -= count;\r\n    }\r\n\r\n    _clearReference(): void {\r\n        this._removeReference(-this._referenceCount);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return \r\n     */\r\n    getCurrentPlayState(): AnimatorPlayState {\r\n        return this._playStateInfo!;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return \r\n     */\r\n    getAnimatorState(name: string): AnimatorState | null {\r\n        var state: AnimatorState;;\r\n        for (let i = 0; i < this._states.length; i++) {\r\n            if (this._states[i].name == name) {\r\n                state = this._states[i];\r\n                break;\r\n            }\r\n        }\r\n        return state ? state : null;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tstate \r\n     * @param   layerIndex \r\n     */\r\n    addState(state: AnimatorState): void {\r\n        var stateName: string = state.name;\r\n        if (this.getAnimatorState(stateName)) {\r\n            throw \"AnimatorControllerLayer:this stat's name has exist.\";\r\n        } else {\r\n            this._states.push(state);\r\n            if (stateName == this._defaultStateNameCatch) {\r\n                this._defaultState = state;\r\n                this._defaultStateNameCatch = null;\r\n            }\r\n\r\n            if (this._animator) {\r\n                (state._clip) && (state._clip!._addReference());\r\n                this._animator._getOwnersByClip(state);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tstate \r\n     * @param   layerIndex \r\n     */\r\n    removeState(state: AnimatorState): void {\r\n        var states: AnimatorState[] = this._states;\r\n        var index: number = -1;\r\n        for (var i: number = 0, n: number = states.length; i < n; i++) {\r\n            if (states[i] === state) {\r\n                index = i;\r\n                break;\r\n            }\r\n        }\r\n        if (index !== -1)\r\n            this._removeClip(states, index, state);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    destroy(): void {\r\n        this._clearReference();\r\n        this._states = [];\r\n        this._playStateInfo = null;\r\n        this._crossPlayStateInfo = null;\r\n        this._defaultState = null;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {\r\n        var dest: AnimatorControllerLayer = (<AnimatorControllerLayer>destObject);\r\n        dest.name = this.name;\r\n        dest.blendingMode = this.blendingMode;\r\n        dest.defaultWeight = this.defaultWeight;\r\n        dest.playOnWake = this.playOnWake;\r\n        this.avatarMask && (dest.avatarMask = this._avatarMask.clone());\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): any {\r\n        var dest: AnimatorControllerLayer = new AnimatorControllerLayer(this.name);\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n\r\n}\r\n\r\n\r\n","import { Component } from \"../../../components/Component\";\r\nimport { ClassUtils } from \"../../../utils/ClassUtils\";\r\nimport { SimpleSkinnedMeshRenderer } from \"../../core/SimpleSkinnedMeshRenderer\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\n\r\n\r\nexport class AnimatorResource {\r\n    static getAnimatorResource(sprite: Sprite3D, propertyKey: string): Component {\r\n        switch (propertyKey) {\r\n            case \"simpleSkinnedMeshRenderer\":\r\n                return sprite.getComponent(SimpleSkinnedMeshRenderer);\r\n            default:\r\n                return sprite.getComponent(ClassUtils.getClass(propertyKey));\r\n                break;\r\n        }\r\n        return null;\r\n    }\r\n}","import { EventDispatcher } from \"../../../events/EventDispatcher\";\r\nimport { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { IClone } from \"../../../utils/IClone\";\r\nimport { AnimationClip } from \"../../animation/AnimationClip\";\r\nimport { AnimatorStateScript } from \"../../animation/AnimatorStateScript\";\r\nimport { KeyframeNodeList } from \"../../animation/KeyframeNodeList\";\r\nimport { Animator, AnimatorParams } from \"./Animator\";\r\nimport { AnimatorTransition } from \"./AnimatorTransition\";\r\nimport { KeyframeNodeOwner, KeyFrameValueType } from \"./KeyframeNodeOwner\";\r\n\r\n/**\r\n * <code>AnimatorState</code> \r\n */\r\nexport class AnimatorState extends EventDispatcher implements IClone {\r\n    /**\r\n     *  \r\n     */\r\n    static EVENT_OnStateEnter = \"OnStartEnter\";\r\n    /**\r\n     *  \r\n     */\r\n    static EVENT_OnStateUpdate = \"OnStateUpdate\";\r\n\r\n    /**\r\n    *  \r\n    */\r\n    static EVENT_OnStateLoop = 'OnStateLoop';\r\n    /**\r\n     *  \r\n     */\r\n    static EVENT_OnStateExit = \"OnStateExit\";\r\n\r\n    /** @internal */\r\n    private _referenceCount: number = 0;\r\n\r\n    /** @internal */\r\n    _clip: AnimationClip | null = null;\r\n\r\n    /** @internal */\r\n    _nodeOwners: KeyframeNodeOwner[] = [];//TODO:\r\n\r\n    /** @internal */\r\n    _currentFrameIndices: Int16Array | null = null;\r\n\r\n    /**,0_clip.islooping12 */\r\n    _isLooping: 0 | 1 | 2 = 0;\r\n\r\n    /**\r\n     * @internal\r\n     * to avoid data confused,must put realtime datas in animatorState,can't be in animationClip,\r\n     * for example use crossFade() with different animatorState but the sample clip source.\r\n     */\r\n    _realtimeDatas: Array<number | Vector3 | Quaternion> = [];\r\n\r\n    /** @internal */\r\n    _scripts: AnimatorStateScript[] | null = null;\r\n\r\n    /**@internal */\r\n    _transitions: AnimatorTransition[] = [];\r\n\r\n    /**@internal only play this transition */\r\n    _soloTransitions: AnimatorTransition[] = [];\r\n\r\n    curTransition: AnimatorTransition;\r\n\r\n    /***/\r\n    name: string;\r\n\r\n    /**,1.0*/\r\n    speed: number = 1.0;\r\n\r\n    /***/\r\n    clipStart: number = 0.0;\r\n\r\n    /***/\r\n    clipEnd: number = 1.0;\r\n    /**play on awake start offset*/\r\n    cycleOffset: number = 0;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get clip(): AnimationClip | null {\r\n        return this._clip;\r\n    }\r\n\r\n    set clip(value: AnimationClip | null) {\r\n        if (this._clip !== value) {\r\n            if (this._clip)\r\n                (this._referenceCount > 0) && (this._clip._removeReference(this._referenceCount));\r\n            if (value) {\r\n                var realtimeDatas: Array<number | Vector3 | Quaternion | Vector2 | Vector4> = this._realtimeDatas;\r\n                var clipNodes: KeyframeNodeList = value._nodes!;\r\n                var count: number = clipNodes.count;\r\n                this._currentFrameIndices = new Int16Array(count);\r\n                this._resetFrameIndices();\r\n                (this._referenceCount > 0) && (value._addReference(this._referenceCount));\r\n                this._realtimeDatas.length = count;\r\n                for (var i: number = 0; i < count; i++) {\r\n                    switch (clipNodes.getNodeByIndex(i).type) {\r\n                        case KeyFrameValueType.Float:\r\n                            break;\r\n                        case KeyFrameValueType.Position:\r\n                        case KeyFrameValueType.Scale:\r\n                        case KeyFrameValueType.RotationEuler:\r\n                        case KeyFrameValueType.Vector3:\r\n                            realtimeDatas[i] = new Vector3();\r\n                            break;\r\n                        case KeyFrameValueType.Rotation:\r\n                            realtimeDatas[i] = new Quaternion();\r\n                            break;\r\n                        case KeyFrameValueType.Vector2:\r\n                            realtimeDatas[i] = new Vector2();\r\n                            break;\r\n                        case KeyFrameValueType.Vector4:\r\n                        case KeyFrameValueType.Color:\r\n                            realtimeDatas[i] = new Vector4();\r\n                            break;\r\n                        default:\r\n                            throw \"AnimationClipParser04:unknown type.\";\r\n                    }\r\n                }\r\n            }\r\n            this._clip = value;\r\n        }\r\n    }\r\n    get islooping() {\r\n        if (0 != this._isLooping) {\r\n            return 1 == this._isLooping;\r\n        }\r\n        return this._clip.islooping;\r\n    }\r\n\r\n    /**\r\n     * IDE\r\n     */\r\n    get transitions() {\r\n        return this._transitions;\r\n    }\r\n\r\n    set transitions(value: AnimatorTransition[]) {\r\n        this._transitions = value;\r\n    }\r\n\r\n    /**\r\n     * IDE\r\n     */\r\n    get soloTransitions() {\r\n        return this._soloTransitions;\r\n    }\r\n\r\n    set soloTransitions(value: AnimatorTransition[]) {\r\n        this._soloTransitions = value\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     *  <code>AnimatorState</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _eventStart(animator: Animator, layerIndex: number) {\r\n        this.event(AnimatorState.EVENT_OnStateEnter);\r\n\r\n        if (this._scripts) {\r\n            for (var i: number = 0, n: number = this._scripts.length; i < n; i++) {\r\n                this._scripts[i].setPlayScriptInfo(animator, layerIndex, this);\r\n                this._scripts[i].onStateEnter();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _eventExit() {\r\n        this.event(AnimatorState.EVENT_OnStateExit);\r\n        this.curTransition = null;\r\n        if (this._scripts) {\r\n            for (let i = 0, n = this._scripts.length; i < n; i++) {\r\n                this._scripts[i].onStateExit();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _eventStateUpdate(value: number) {\r\n        this.event(AnimatorState.EVENT_OnStateUpdate, value);\r\n        if (this._scripts) {\r\n            for (var i = 0, n = this._scripts.length; i < n; i++)\r\n                this._scripts[i].onStateUpdate(value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _eventLoop() {\r\n        this.event(AnimatorState.EVENT_OnStateLoop);\r\n        if (this._scripts) {\r\n            for (let i = 0, n = this._scripts.length; i < n; i++) {\r\n                if (this._scripts[i].onStateLoop)\r\n                    this._scripts[i].onStateLoop();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param normalizeTime \r\n     * @param paramsMap \r\n     */\r\n    _eventtransition(normalizeTime: number, paramsMap: AnimatorParams): AnimatorTransition {\r\n        let soloNums = this._soloTransitions.length;\r\n        if (soloNums > 0) {\r\n            for (var i = 0; i < soloNums; i++) {\r\n                if (this._soloTransitions[i].check(normalizeTime, paramsMap))\r\n                    return this._soloTransitions[i];\r\n            }\r\n            return null;\r\n        }\r\n        let transNums = this._transitions.length;\r\n        for (var i = 0; i < transNums; i++) {\r\n            if (this._transitions[i].check(normalizeTime, paramsMap))\r\n                return this._transitions[i];\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getReferenceCount(): number {\r\n        return this._referenceCount;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param count \r\n     */\r\n    _addReference(count: number = 1): void {\r\n        (this._clip) && (this._clip._addReference(count));\r\n        this._referenceCount += count;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param count \r\n     */\r\n    _removeReference(count: number = 1): void {\r\n        (this._clip) && (this._clip._removeReference(count));\r\n        this._referenceCount -= count;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _clearReference(): void {\r\n        this._removeReference(-this._referenceCount);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _resetFrameIndices(): void {\r\n        for (var i: number = 0, n: number = this._currentFrameIndices!.length; i < n; i++)\r\n            this._currentFrameIndices![i] = -1;//-10,\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\ttype  \r\n     * @return \r\n     *\r\n     */\r\n    addScript(type: typeof AnimatorStateScript): AnimatorStateScript {\r\n        var script: AnimatorStateScript = new type();\r\n        this._scripts = this._scripts || [];\r\n        this._scripts.push(script);\r\n        return script;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\ttype  \r\n     * @return \r\n     *\r\n     */\r\n    getScript(type: typeof AnimatorStateScript): AnimatorStateScript | null {\r\n        if (this._scripts) {\r\n            for (var i: number = 0, n: number = this._scripts.length; i < n; i++) {\r\n                var script: AnimatorStateScript = this._scripts[i];\r\n                if (script instanceof type)\r\n                    return script;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\ttype  \r\n     * @return \r\n     */\r\n    getScripts(type: typeof AnimatorStateScript): AnimatorStateScript[] | null {\r\n        var coms: AnimatorStateScript[] | null = null;\r\n        if (this._scripts) {\r\n            for (var i: number = 0, n: number = this._scripts.length; i < n; i++) {\r\n                var script: AnimatorStateScript = this._scripts[i];\r\n                if (script instanceof type) {\r\n                    coms = coms || [];\r\n                    coms.push(script);\r\n                }\r\n            }\r\n        }\r\n        return coms;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {\r\n        var dest: AnimatorState = <AnimatorState>destObject;\r\n        dest.name = this.name;\r\n        dest.speed = this.speed;\r\n        dest.clipStart = this.clipStart;\r\n        dest.clipEnd = this.clipEnd;\r\n        dest.clip = this._clip;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): any {\r\n        var dest: AnimatorState = new AnimatorState();\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n\r\n}","/**\r\n * \r\n */\r\nexport class AvatarMask {\r\n    /**@internal */\r\n    private _avatarPathMap: Record<string, boolean>;\r\n\r\n    /**\r\n     * <code>AvatarMask</code>\r\n     */\r\n    constructor(data?: any) {\r\n        this._avatarPathMap = data?._avatarPathMap || {};\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param path \r\n     * @returns \r\n     */\r\n    getTransformActive(path: string): boolean {\r\n        return this._avatarPathMap[path];\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param path \r\n     * @param value \r\n     */\r\n    setTransformActive(path: string, value: boolean) {\r\n        this._avatarPathMap[path] = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @returns \r\n     */\r\n    getAllTranfromPath() {\r\n        return this._avatarPathMap;\r\n    }\r\n\r\n    /**\r\n   * \r\n   * @return\t \r\n   */\r\n    clone(): any {\r\n        var dest: AvatarMask = new AvatarMask();\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {\r\n        var dest: AvatarMask = (<AvatarMask>destObject);\r\n        for (var key in this._avatarPathMap) {\r\n            dest.setTransformActive(key, this._avatarPathMap[key]);\r\n        }\r\n\r\n    }\r\n\r\n}","\r\nimport { Component } from \"../../../components/Component\";\r\nimport { NodeFlags } from \"../../../Const\";\r\nimport { Loader } from \"../../../net/Loader\";\r\nimport { Stat } from \"../../../utils/Stat\";\r\nimport { AnimationClip } from \"../../animation/AnimationClip\";\r\nimport { AnimatorStateScript } from \"../../animation/AnimatorStateScript\";\r\nimport { KeyframeNode } from \"../../animation/KeyframeNode\";\r\nimport { KeyframeNodeList } from \"../../animation/KeyframeNodeList\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { RenderableSprite3D } from \"../../core/RenderableSprite3D\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Utils3D } from \"../../utils/Utils3D\";\r\nimport { AnimatorControllerLayer } from \"./AnimatorControllerLayer\";\r\nimport { AnimatorPlayState } from \"./AnimatorPlayState\";\r\nimport { AnimatorResource } from \"./AnimatorResource\";\r\nimport { AnimatorState } from \"./AnimatorState\";\r\nimport { AvatarMask } from \"./AvatarMask\";\r\nimport { KeyframeNodeOwner, KeyFrameValueType } from \"./KeyframeNodeOwner\";\r\nimport { AnimationEvent } from \"../../animation/AnimationEvent\";\r\nimport { AnimatorTransition } from \"./AnimatorTransition\";\r\nimport { AnimatorController } from \"./AnimatorController\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { AnimatorUpdateMode } from \"../../../components/AnimatorUpdateMode\";\r\nimport { AnimatorStateCondition } from \"../../../components/AnimatorStateCondition\";\r\n\r\nexport type AnimatorParams = { [key: number]: number | boolean };\r\n\r\n\r\n/**\r\n * <code>Animator</code> \r\n */\r\nexport class Animator extends Component {\r\n    /**@internal */\r\n    private static _tempVector31: Vector3 = new Vector3();\r\n    /**@internal */\r\n    private static _tempColor: Color = new Color();\r\n    /**@internal */\r\n    private static _tempQuaternion1: Quaternion = new Quaternion();\r\n\r\n    /** _*/\r\n    static CULLINGMODE_ALWAYSANIMATE: number = 0;\r\n    /** _*/\r\n    static CULLINGMODE_CULLCOMPLETELY: number = 2;\r\n\r\n    /**@internal */\r\n    private _speed: number;\r\n    /**@internal */\r\n    private _keyframeNodeOwnerMap: any;\r\n    /**@internal */\r\n    private _keyframeNodeOwners: KeyframeNodeOwner[] = [];\r\n    /**@internal */\r\n    private _updateMark: number;\r\n    /**@internal */\r\n    private _controllerLayers: AnimatorControllerLayer[];\r\n    /**@internal */\r\n    private _updateMode: AnimatorUpdateMode = AnimatorUpdateMode.Normal;\r\n    /**@internal */\r\n    private _lowUpdateDelty: number = 20;\r\n    /**@internal */\r\n    private _animatorParams: AnimatorParams = {};\r\n    // /**@internal */\r\n    // _linkSprites: any;\r\n    /**@internal\t*/\r\n    _avatarNodeMap: any;\r\n    /**@internal */\r\n    _linkAvatarSpritesData: any = {};\r\n    /**@internal */\r\n    _linkAvatarSprites: Sprite3D[] = [];\r\n    /**@internal */\r\n    _renderableSprites: RenderableSprite3D[] = [];\r\n\r\n    /**\t*/\r\n    cullingMode: number = Animator.CULLINGMODE_CULLCOMPLETELY;\r\n\r\n    /**@internal\t[NATIVE]*/\r\n    _animationNodeLocalPositions: Float32Array;\r\n    /**@internal\t[NATIVE]*/\r\n    _animationNodeLocalRotations: Float32Array;\r\n    /**@internal\t[NATIVE]*/\r\n    _animationNodeLocalScales: Float32Array;\r\n    /**@internal\t[NATIVE]*/\r\n    _animationNodeWorldMatrixs: Float32Array;\r\n    /**@internal\t[NATIVE]*/\r\n    _animationNodeParentIndices: Int16Array;\r\n    /**@internal */\r\n    private _finishSleep: boolean = false;\r\n\r\n    _controller: AnimatorController;\r\n\r\n\r\n    set controller(val: AnimatorController) {\r\n\r\n        this._controller = val;\r\n        if (this._controller) {\r\n            this._controller.updateTo(this);\r\n        }\r\n\r\n    }\r\n    get controller() {\r\n        return this._controller;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * ,1.0\r\n     */\r\n    get speed(): number {\r\n        return this._speed;\r\n    }\r\n\r\n\r\n    set speed(value: number) {\r\n        this._speed = value;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    set updateMode(value: AnimatorUpdateMode) {\r\n        this._updateMode = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set lowUpdateDelty(value: number) {\r\n        this._lowUpdateDelty = value;\r\n    }\r\n\r\n    get controllerLayerCount(): number {\r\n        return this._controllerLayers.length;\r\n    }\r\n\r\n    /**\r\n     * map\r\n     */\r\n    set animatorParams(values: AnimatorParams) {\r\n        this._animatorParams = values;\r\n    }\r\n\r\n    get animatorParams() {\r\n        return this._animatorParams;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set sleep(value: boolean) {\r\n        this._finishSleep = value;\r\n    }\r\n\r\n    get sleep() {\r\n        return this._finishSleep;\r\n    }\r\n\r\n    /**\r\n     *  <code>Animation</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._controllerLayers = [];\r\n        //this._linkSprites = {};\r\n        this._speed = 1.0;\r\n        this._keyframeNodeOwnerMap = {};\r\n        this._updateMark = 0;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _addKeyframeNodeOwner(clipOwners: KeyframeNodeOwner[], node: KeyframeNode, propertyOwner: any): void {\r\n        var nodeIndex = node._indexInList;\r\n        var fullPath = node.fullPath;\r\n        var keyframeNodeOwner = this._keyframeNodeOwnerMap[fullPath];\r\n        let mat = false;\r\n        if (keyframeNodeOwner) {\r\n            keyframeNodeOwner.referenceCount++;\r\n            clipOwners[nodeIndex] = keyframeNodeOwner;\r\n        } else {\r\n            var property = propertyOwner;\r\n            for (var i = 0, n = node.propertyCount; i < n; i++) {\r\n                property = property[node.getPropertyByIndex(i)];\r\n                if (property instanceof Material) {\r\n                    mat = true\r\n                }\r\n                if (!property)\r\n                    break;\r\n            }\r\n\r\n            keyframeNodeOwner = this._keyframeNodeOwnerMap[fullPath] = new KeyframeNodeOwner();\r\n            keyframeNodeOwner.isMaterial = mat;\r\n            keyframeNodeOwner.fullPath = fullPath;\r\n            keyframeNodeOwner.indexInList = this._keyframeNodeOwners.length;\r\n            keyframeNodeOwner.referenceCount = 1;\r\n            keyframeNodeOwner.propertyOwner = propertyOwner;\r\n            keyframeNodeOwner.nodePath = node.nodePath;\r\n            keyframeNodeOwner.callbackFunData = node.callbackFunData;\r\n            keyframeNodeOwner.callParams = node.callParams;\r\n            keyframeNodeOwner.getCallbackNode();\r\n            var propertyCount = node.propertyCount;\r\n            var propertys: string[] = [];\r\n            for (i = 0; i < propertyCount; i++)\r\n                propertys[i] = node.getPropertyByIndex(i);\r\n            keyframeNodeOwner.property = propertys;\r\n            keyframeNodeOwner.type = node.type;\r\n\r\n            if (property) {//\r\n                if (node.type === 0) {\r\n                    keyframeNodeOwner.defaultValue = property;\r\n                } else {\r\n                    var defaultValue = new property.constructor();\r\n                    property.cloneTo(defaultValue);\r\n                    keyframeNodeOwner.defaultValue = defaultValue;\r\n                    keyframeNodeOwner.value = new property.constructor();\r\n                    keyframeNodeOwner.crossFixedValue = new property.constructor();\r\n                }\r\n            }\r\n\r\n            this._keyframeNodeOwners.push(keyframeNodeOwner);\r\n            clipOwners[nodeIndex] = keyframeNodeOwner;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _removeKeyframeNodeOwner(nodeOwners: (KeyframeNodeOwner | null)[], node: KeyframeNode): void {\r\n        var fullPath = node.fullPath;\r\n        var keyframeNodeOwner = this._keyframeNodeOwnerMap[fullPath];\r\n        if (keyframeNodeOwner) {//TODO:Avatar,,_keyframeNodeOwnerMap,BUG,SkinnedMeshRenderAvatar\r\n            keyframeNodeOwner.referenceCount--;\r\n            if (keyframeNodeOwner.referenceCount === 0) {\r\n                delete this._keyframeNodeOwnerMap[fullPath];\r\n                this._keyframeNodeOwners.splice(this._keyframeNodeOwners.indexOf(keyframeNodeOwner), 1);\r\n            }\r\n            nodeOwners[node._indexInList] = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getOwnersByClip(clipStateInfo: AnimatorState): void {\r\n        if (!clipStateInfo._clip)\r\n            return;\r\n\r\n        var frameNodes = clipStateInfo._clip!._nodes;\r\n        var frameNodesCount = frameNodes!.count;\r\n        var nodeOwners: KeyframeNodeOwner[] = clipStateInfo._nodeOwners;\r\n        nodeOwners.length = frameNodesCount;\r\n        for (var i: number = 0; i < frameNodesCount; i++) {\r\n            var node: KeyframeNode = frameNodes!.getNodeByIndex(i);\r\n            //var property: any = this._avatar ? this._avatarNodeMap[this._avatar._rootNode.name!] : this.owner;//avatar\r\n            var property: any = this.owner;\r\n            for (var j: number = 0, m: number = node.ownerPathCount; j < m; j++) {\r\n                var ownPat: string = node.getOwnerPathByIndex(j);\r\n                if (ownPat === \"\") {//TODO:\r\n                    break;\r\n                } else {\r\n                    property = property.getChildByName(ownPat);\r\n                    if (!property)\r\n                        break;\r\n                }\r\n            }\r\n\r\n            if (property) {\r\n                var propertyOwner: string = node.propertyOwner;\r\n                const oriProperty = property;\r\n                (propertyOwner) && (property = property[propertyOwner]);\r\n                if (!property) {\r\n                    property = AnimatorResource.getAnimatorResource(oriProperty, propertyOwner);\r\n                }\r\n                property && this._addKeyframeNodeOwner(nodeOwners, node, property);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _updatePlayer(animatorState: AnimatorState, playState: AnimatorPlayState, elapsedTime: number, islooping: boolean, layerIndex: number): void {\r\n        var clipDuration: number = animatorState._clip!._duration * (animatorState.clipEnd - animatorState.clipStart);\r\n        var lastElapsedTime: number = playState._elapsedTime;\r\n        var elapsedPlaybackTime: number = lastElapsedTime + elapsedTime;\r\n        playState._lastElapsedTime = lastElapsedTime;\r\n        playState._elapsedTime = elapsedPlaybackTime;\r\n        var normalizedTime: number = elapsedPlaybackTime / clipDuration;//TODO:\r\n        playState._normalizedTime = normalizedTime;\r\n        var playTime: number = normalizedTime % 1.0;\r\n        playState._normalizedPlayTime = playTime < 0 ? playTime + 1.0 : playTime;\r\n        playState._duration = clipDuration;\r\n        if (elapsedPlaybackTime >= clipDuration) {\r\n            if (!islooping) {\r\n                playState._finish = true;\r\n                playState._elapsedTime = clipDuration;\r\n                playState._normalizedPlayTime = 1.0;\r\n            } else {\r\n                let loopNum = Math.floor(elapsedPlaybackTime / clipDuration);\r\n                let pLoopNum = Math.floor(lastElapsedTime / clipDuration);\r\n                if (pLoopNum != loopNum) {\r\n                    animatorState._eventLoop();\r\n                }\r\n            }\r\n        }\r\n\r\n        (!playState._finish) && animatorState._eventStateUpdate(playState._normalizedPlayTime);\r\n        this._applyTransition(animatorState, layerIndex, animatorState._eventtransition(playState._normalizedPlayTime, this.animatorParams));\r\n        return;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param layerindex \r\n     * @param transition \r\n     * @returns \r\n     */\r\n    private _applyTransition(state: AnimatorState, layerindex: number, transition: AnimatorTransition) {\r\n        if (!transition || transition == state.curTransition)\r\n            return;\r\n        state.curTransition = transition;\r\n        this.crossFade(transition.destState.name, transition.transduration, layerindex, transition.transstartoffset);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param animatorState \r\n     * @param playState \r\n     */\r\n    private _updateStateFinish(animatorState: AnimatorState, playState: AnimatorPlayState): void {\r\n        if (playState._finish) {\r\n            animatorState._eventExit();//\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _eventScript(events: AnimationEvent[], eventIndex: number, endTime: number, front: boolean, startTime = 0): number {\r\n        let scripts = this.owner.components;\r\n        if (front) {\r\n            endTime += startTime;\r\n            for (let n = events.length; eventIndex < n; eventIndex++) {\r\n                let event = events[eventIndex];\r\n                if (event.time <= endTime) {\r\n                    if (event.time >= startTime) {\r\n                        for (let j = 0, m = scripts.length; j < m; j++) {\r\n                            let script = scripts[j];\r\n                            if (script._isScript()) {\r\n                                let fun: Function = (script as any)[event.eventName];\r\n                                (fun) && (fun.apply(script, event.params));\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    break;\r\n                }\r\n            }\r\n        } else {\r\n            for (; eventIndex >= 0; eventIndex--) {\r\n                let event = events[eventIndex];\r\n                if (event.time >= endTime) {\r\n                    for (let j = 0, m = scripts.length; j < m; j++) {\r\n                        let script = scripts[j];\r\n                        if (script._isScript()) {\r\n                            let fun = (script as any)[event.eventName];\r\n                            (fun) && (fun.apply(script, event.params));\r\n                        }\r\n                    }\r\n                } else {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return eventIndex;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _updateEventScript(stateInfo: AnimatorState, playStateInfo: AnimatorPlayState): void {\r\n        if (!this.owner._getBit(NodeFlags.HAS_SCRIPT))\r\n            return;\r\n\r\n        let clip = stateInfo._clip;\r\n        let events = clip!._animationEvents;\r\n        let clipDuration = clip!._duration;\r\n        let elapsedTime = playStateInfo._elapsedTime;\r\n        let time = elapsedTime % clipDuration;\r\n        let loopCount = Math.abs(Math.floor(elapsedTime / clipDuration) - Math.floor(playStateInfo._lastElapsedTime / clipDuration));//backPlay\r\n\r\n        let frontPlay = playStateInfo._elapsedTime >= playStateInfo._lastElapsedTime;\r\n        if (playStateInfo._lastIsFront !== frontPlay) {\r\n            if (frontPlay)\r\n                playStateInfo._playEventIndex++;\r\n            else\r\n                playStateInfo._playEventIndex--;\r\n            playStateInfo._lastIsFront = frontPlay;\r\n        }\r\n        let preEventIndex = playStateInfo._playEventIndex;\r\n        if (frontPlay) {\r\n            let startTime = 0;\r\n            if (playStateInfo.animatorState && 0 != playStateInfo.animatorState.clipStart) {\r\n                startTime = playStateInfo.animatorState._clip!._duration * playStateInfo.animatorState.clipStart;\r\n            }\r\n            let newEventIndex = this._eventScript(events, playStateInfo._playEventIndex, loopCount > 0 ? clipDuration : time, true, startTime);\r\n            (preEventIndex === playStateInfo._playEventIndex) && (playStateInfo._playEventIndex = newEventIndex);//eventPlay eventindex\r\n            for (let i = 0, n = loopCount - 1; i < n; i++)\r\n                this._eventScript(events, 0, clipDuration, true, startTime);\r\n            (loopCount > 0 && time > 0) && (playStateInfo._playEventIndex = this._eventScript(events, 0, time, true, startTime));//if need cross loop,'time' must large than 0\r\n        } else {\r\n            let newEventIndex = this._eventScript(events, playStateInfo._playEventIndex, loopCount > 0 ? 0 : time, false);\r\n            (preEventIndex === playStateInfo._playEventIndex) && (playStateInfo._playEventIndex = newEventIndex);//eventPlay eventindex\r\n            let eventIndex = events.length - 1;\r\n            for (let i = 0, n = loopCount - 1; i < n; i++)\r\n                this._eventScript(events, eventIndex, 0, false);\r\n            (loopCount > 0 && time > 0) && (playStateInfo._playEventIndex = this._eventScript(events, eventIndex, time, false));//if need cross loop,'time' must large than 0\r\n        }\r\n    }\r\n\r\n    /**\r\n     * clip\r\n     * @internal\r\n     */\r\n    private _updateClipDatas(animatorState: AnimatorState, addtive: boolean, playStateInfo: AnimatorPlayState, animatorMask: AvatarMask = null): void {\r\n        var clip = animatorState._clip;\r\n        var clipDuration = clip!._duration;\r\n\r\n        var curPlayTime = animatorState.clipStart * clipDuration + playStateInfo._normalizedPlayTime * playStateInfo._duration;\r\n        var currentFrameIndices = animatorState._currentFrameIndices;\r\n        var frontPlay = playStateInfo._elapsedTime > playStateInfo._lastElapsedTime;\r\n        clip!._evaluateClipDatasRealTime(clip!._nodes!, curPlayTime, currentFrameIndices!, addtive, frontPlay, animatorState._realtimeDatas, animatorMask);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _applyFloat(defaultValue: number, nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, data: number): number {\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                defaultValue += weight * data;\r\n            } else {\r\n                var oriValue: number = defaultValue;\r\n                defaultValue = oriValue + weight * (data - oriValue);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive)\r\n                    defaultValue = nodeOwner.defaultValue + data;\r\n                else\r\n                    defaultValue = data;\r\n            } else {\r\n                if (additive) {\r\n                    defaultValue = nodeOwner.defaultValue + weight * (data);\r\n                } else {\r\n                    var defValue: number = nodeOwner.defaultValue;\r\n                    defaultValue = defValue + weight * (data - defValue);\r\n                }\r\n            }\r\n        }\r\n        return defaultValue;\r\n    }\r\n\r\n    private _applyVec2(defaultValue: Vector2, nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, data: Vector2): Vector2 {\r\n        if (!defaultValue) return null;\r\n\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                defaultValue.x += weight * data.x;\r\n                defaultValue.y += weight * data.y;\r\n            } else {\r\n                var oriValue = defaultValue;\r\n                defaultValue.x = oriValue.x + weight * (data.x - oriValue.x);\r\n                defaultValue.y = oriValue.y + weight * (data.y - oriValue.y);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive) {\r\n                    defaultValue.x = nodeOwner.defaultValue.x + data.x;\r\n                    defaultValue.y = nodeOwner.defaultValue.y + data.y;\r\n                }\r\n                else\r\n                    data.cloneTo(defaultValue);\r\n            } else {\r\n                if (additive) {\r\n                    defaultValue.x = nodeOwner.defaultValue.x + weight * (data.x);\r\n                    defaultValue.y = nodeOwner.defaultValue.y + weight * (data.y);\r\n                } else {\r\n                    var defValue: Vector2 = nodeOwner.defaultValue;\r\n                    defaultValue.x = defValue.x + weight * (data.x - defValue.x);\r\n                    defaultValue.y = defValue.y + weight * (data.y - defValue.y);\r\n                }\r\n            }\r\n        }\r\n        return defaultValue;\r\n    }\r\n\r\n    private _applyVec3(defaultValue: Vector3, nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, data: Vector3) {\r\n        if (!defaultValue) return null;\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                defaultValue.x += weight * data.x;\r\n                defaultValue.y += weight * data.y;\r\n                defaultValue.z += weight * data.z;\r\n            } else {\r\n                var oriValue = defaultValue;\r\n                defaultValue.x = oriValue.x + weight * (data.x - oriValue.x);\r\n                defaultValue.y = oriValue.y + weight * (data.y - oriValue.y);\r\n                defaultValue.z = oriValue.z + weight * (data.z - oriValue.z);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive) {\r\n                    defaultValue.x = nodeOwner.defaultValue.x + data.x;\r\n                    defaultValue.y = nodeOwner.defaultValue.y + data.y;\r\n                    defaultValue.z = nodeOwner.defaultValue.z + data.z;\r\n                }\r\n                else\r\n                    data.cloneTo(defaultValue);\r\n            } else {\r\n                if (additive) {\r\n                    defaultValue.x = nodeOwner.defaultValue.x + weight * (data.x);\r\n                    defaultValue.y = nodeOwner.defaultValue.y + weight * (data.y);\r\n                    defaultValue.z = nodeOwner.defaultValue.z + weight * (data.z);\r\n                } else {\r\n                    var defValue: Vector3 = nodeOwner.defaultValue;\r\n                    defaultValue.x = defValue.x + weight * (data.x - defValue.x);\r\n                    defaultValue.y = defValue.y + weight * (data.y - defValue.y);\r\n                    defaultValue.z = defValue.z + weight * (data.z - defValue.z);\r\n                }\r\n            }\r\n        }\r\n        return defaultValue;\r\n    }\r\n\r\n    private _applyVec4(defaultValue: Vector4, nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, data: Vector4) {\r\n        if (!defaultValue) return null;\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                defaultValue.x += weight * data.x;\r\n                defaultValue.y += weight * data.y;\r\n                defaultValue.z += weight * data.z;\r\n                defaultValue.w += weight * data.w;\r\n            } else {\r\n                var oriValue = defaultValue;\r\n                defaultValue.x = oriValue.x + weight * (data.x - oriValue.x);\r\n                defaultValue.y = oriValue.y + weight * (data.y - oriValue.y);\r\n                defaultValue.z = oriValue.z + weight * (data.z - oriValue.z);\r\n                defaultValue.w = oriValue.w + weight * (data.w - oriValue.w);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive) {\r\n                    defaultValue.x = nodeOwner.defaultValue.x + data.x;\r\n                    defaultValue.y = nodeOwner.defaultValue.y + data.y;\r\n                    defaultValue.z = nodeOwner.defaultValue.z + data.z;\r\n                    defaultValue.w = nodeOwner.defaultValue.w + data.w;\r\n                }\r\n                else\r\n                    data.cloneTo(defaultValue);\r\n            } else {\r\n                if (additive) {\r\n                    defaultValue.x = nodeOwner.defaultValue.x + weight * (data.x);\r\n                    defaultValue.y = nodeOwner.defaultValue.y + weight * (data.y);\r\n                    defaultValue.z = nodeOwner.defaultValue.z + weight * (data.z);\r\n                    defaultValue.w = nodeOwner.defaultValue.w + weight * (data.w);\r\n                } else {\r\n                    var defValue: Vector4 = nodeOwner.defaultValue;\r\n                    defaultValue.x = defValue.x + weight * (data.x - defValue.x);\r\n                    defaultValue.y = defValue.y + weight * (data.y - defValue.y);\r\n                    defaultValue.z = defValue.z + weight * (data.z - defValue.z);\r\n                    defaultValue.w = defValue.w + weight * (data.w - defValue.w);\r\n                }\r\n            }\r\n        }\r\n        return defaultValue;\r\n    }\r\n\r\n    private _applyColor(defaultValue: Color, nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, data: Vector4) {\r\n        if (!defaultValue) return null;\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                defaultValue.r += weight * data.x;\r\n                defaultValue.g += weight * data.y;\r\n                defaultValue.b += weight * data.z;\r\n                defaultValue.a += weight * data.w;\r\n            } else {\r\n                var oriValue = defaultValue;\r\n                defaultValue.r = oriValue.r + weight * (data.x - oriValue.r);\r\n                defaultValue.g = oriValue.g + weight * (data.y - oriValue.g);\r\n                defaultValue.b = oriValue.b + weight * (data.z - oriValue.b);\r\n                defaultValue.a = oriValue.a + weight * (data.w - oriValue.a);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive) {\r\n                    defaultValue.r = nodeOwner.defaultValue.r + data.x;\r\n                    defaultValue.g = nodeOwner.defaultValue.g + data.y;\r\n                    defaultValue.b = nodeOwner.defaultValue.b + data.z;\r\n                    defaultValue.a = nodeOwner.defaultValue.a + data.w;\r\n                }\r\n                else {\r\n                    //data.cloneTo(defaultValue);\r\n                    defaultValue.setValue(data.x, data.y, data.z, data.w);\r\n                }\r\n\r\n            } else {\r\n                if (additive) {\r\n                    defaultValue.r = nodeOwner.defaultValue.r + weight * (data.x);\r\n                    defaultValue.g = nodeOwner.defaultValue.g + weight * (data.y);\r\n                    defaultValue.b = nodeOwner.defaultValue.b + weight * (data.z);\r\n                    defaultValue.a = nodeOwner.defaultValue.a + weight * (data.w);\r\n                } else {\r\n                    var defValue: Color = nodeOwner.defaultValue;\r\n                    defaultValue.r = defValue.r + weight * (data.x - defValue.r);\r\n                    defaultValue.g = defValue.g + weight * (data.y - defValue.g);\r\n                    defaultValue.b = defValue.b + weight * (data.z - defValue.b);\r\n                    defaultValue.a = defValue.a + weight * (data.w - defValue.a);\r\n                }\r\n            }\r\n        }\r\n        return defaultValue;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _applyPositionAndRotationEuler(nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, data: Vector3, out: Vector3): void {\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                out.x += weight * data.x;\r\n                out.y += weight * data.y;\r\n                out.z += weight * data.z;\r\n            } else {\r\n                var oriX: number = out.x;\r\n                var oriY: number = out.y;\r\n                var oriZ: number = out.z;\r\n                out.x = oriX + weight * (data.x - oriX);\r\n                out.y = oriY + weight * (data.y - oriY);\r\n                out.z = oriZ + weight * (data.z - oriZ);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive) {\r\n                    var defValue: Vector3 = nodeOwner.defaultValue;\r\n                    out.x = defValue.x + data.x;\r\n                    out.y = defValue.y + data.y;\r\n                    out.z = defValue.z + data.z;\r\n                } else {\r\n                    out.x = data.x;\r\n                    out.y = data.y;\r\n                    out.z = data.z;\r\n                }\r\n            } else {\r\n                defValue = nodeOwner.defaultValue;\r\n                if (additive) {\r\n                    out.x = defValue.x + weight * data.x;\r\n                    out.y = defValue.y + weight * data.y;\r\n                    out.z = defValue.z + weight * data.z;\r\n                } else {\r\n                    var defX: number = defValue.x;\r\n                    var defY: number = defValue.y;\r\n                    var defZ: number = defValue.z;\r\n                    out.x = defX + weight * (data.x - defX);\r\n                    out.y = defY + weight * (data.y - defY);\r\n                    out.z = defZ + weight * (data.z - defZ);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _applyRotation(nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, clipRot: Quaternion, localRotation: Quaternion): void {\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                var tempQuat: Quaternion = Animator._tempQuaternion1;//_tempQuaternion1\r\n                Utils3D.quaternionWeight(clipRot, weight, tempQuat);\r\n                tempQuat.normalize(tempQuat);\r\n                Quaternion.multiply(localRotation, tempQuat, localRotation);\r\n            } else {\r\n                Quaternion.lerp(localRotation, clipRot, weight, localRotation);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive) {\r\n                    var defaultRot: Quaternion = nodeOwner.defaultValue;\r\n                    Quaternion.multiply(defaultRot, clipRot, localRotation);\r\n                } else {\r\n                    localRotation.x = clipRot.x;\r\n                    localRotation.y = clipRot.y;\r\n                    localRotation.z = clipRot.z;\r\n                    localRotation.w = clipRot.w;\r\n                }\r\n            } else {\r\n                defaultRot = nodeOwner.defaultValue;\r\n                if (additive) {\r\n                    tempQuat = Animator._tempQuaternion1;\r\n                    Utils3D.quaternionWeight(clipRot, weight, tempQuat);\r\n                    tempQuat.normalize(tempQuat);\r\n                    Quaternion.multiply(defaultRot, tempQuat, localRotation);\r\n                } else {\r\n                    Quaternion.lerp(defaultRot, clipRot, weight, localRotation);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _applyScale(nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, clipSca: Vector3, localScale: Vector3): void {\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                var scale: Vector3 = Animator._tempVector31;\r\n                Utils3D.scaleWeight(clipSca, weight, scale);\r\n                localScale.x = localScale.x * scale.x;\r\n                localScale.y = localScale.y * scale.y;\r\n                localScale.z = localScale.z * scale.z;\r\n            } else {\r\n                Utils3D.scaleBlend(localScale, clipSca, weight, localScale);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive) {\r\n                    var defaultSca: Vector3 = nodeOwner.defaultValue;\r\n                    localScale.x = defaultSca.x * clipSca.x;\r\n                    localScale.y = defaultSca.y * clipSca.y;\r\n                    localScale.z = defaultSca.z * clipSca.z;\r\n                } else {\r\n                    localScale.x = clipSca.x;\r\n                    localScale.y = clipSca.y;\r\n                    localScale.z = clipSca.z;\r\n                }\r\n            } else {\r\n                defaultSca = nodeOwner.defaultValue;\r\n                if (additive) {\r\n                    scale = Animator._tempVector31;\r\n                    Utils3D.scaleWeight(clipSca, weight, scale);\r\n                    localScale.x = defaultSca.x * scale.x;\r\n                    localScale.y = defaultSca.y * scale.y;\r\n                    localScale.z = defaultSca.z * scale.z;\r\n                } else {\r\n                    Utils3D.scaleBlend(defaultSca, clipSca, weight, localScale);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _applyCrossData(nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, srcValue: any, desValue: any, crossWeight: number): void {\r\n        var pro: any = nodeOwner.propertyOwner;\r\n        let lastpro;\r\n        if (pro) {\r\n            switch (nodeOwner.type) {\r\n                case KeyFrameValueType.Float: //Float\r\n                    var proPat: string[] = nodeOwner.property!;\r\n                    var m: number = proPat.length - 1;\r\n                    for (var j: number = 0; j < m; j++) {\r\n                        pro = pro[proPat[j]];\r\n                        if (!pro)//\r\n                            break;\r\n                    }\r\n\r\n                    var crossValue: number = srcValue + crossWeight * (desValue - srcValue);\r\n                    nodeOwner.value = crossValue;\r\n                    lastpro = proPat[m];\r\n                    if (!nodeOwner.isMaterial) {\r\n                        pro && (pro[lastpro] = this._applyFloat(pro[lastpro], nodeOwner, additive, weight, isFirstLayer, crossValue));\r\n                    } else {\r\n                        pro && (pro as Material).setFloat(lastpro, this._applyFloat((pro as Material).getFloat(lastpro), nodeOwner, additive, weight, isFirstLayer, crossValue));\r\n                    }\r\n                    if (nodeOwner.callbackFun) {\r\n                        nodeOwner.animatorDataSetCallBack();\r\n                    }\r\n                    break;\r\n                case KeyFrameValueType.Position: //Position\r\n                    var localPos: Vector3 = pro.localPosition;\r\n                    var position: Vector3 = nodeOwner.value;\r\n                    var srcX: number = srcValue.x, srcY: number = srcValue.y, srcZ: number = srcValue.z;\r\n                    position.x = srcX + crossWeight * (desValue.x - srcX);\r\n                    position.y = srcY + crossWeight * (desValue.y - srcY);\r\n                    position.z = srcZ + crossWeight * (desValue.z - srcZ);\r\n                    this._applyPositionAndRotationEuler(nodeOwner, additive, weight, isFirstLayer, position, localPos);\r\n                    pro.localPosition = localPos;\r\n                    break;\r\n                case KeyFrameValueType.Rotation: //Rotation\r\n                    var localRot: Quaternion = pro.localRotation;\r\n                    var rotation: Quaternion = nodeOwner.value;\r\n                    Quaternion.lerp(srcValue, desValue, crossWeight, rotation);\r\n                    this._applyRotation(nodeOwner, additive, weight, isFirstLayer, rotation, localRot);\r\n                    pro.localRotation = localRot;\r\n                    break;\r\n                case KeyFrameValueType.Scale: //Scale\r\n                    var localSca: Vector3 = pro.localScale;\r\n                    var scale: Vector3 = nodeOwner.value;\r\n                    Utils3D.scaleBlend(srcValue, desValue, crossWeight, scale);\r\n                    this._applyScale(nodeOwner, additive, weight, isFirstLayer, scale, localSca);\r\n                    pro.localScale = localSca;\r\n                    break;\r\n                case KeyFrameValueType.RotationEuler: //RotationEuler\r\n                    var localEuler: Vector3 = pro.localRotationEuler;\r\n                    var rotationEuler: Vector3 = nodeOwner.value;\r\n                    srcX = srcValue.x, srcY = srcValue.y, srcZ = srcValue.z;\r\n                    rotationEuler.x = srcX + crossWeight * (desValue.x - srcX);\r\n                    rotationEuler.y = srcY + crossWeight * (desValue.y - srcY);\r\n                    rotationEuler.z = srcZ + crossWeight * (desValue.z - srcZ);\r\n                    this._applyPositionAndRotationEuler(nodeOwner, additive, weight, isFirstLayer, rotationEuler, localEuler);\r\n                    pro.localRotationEuler = localEuler;\r\n                    break;\r\n                case KeyFrameValueType.Color:\r\n                    var proPat: string[] = nodeOwner.property!;\r\n                    var m: number = proPat.length - 1;\r\n                    for (var j: number = 0; j < m; j++) {\r\n                        pro = pro[proPat[j]];\r\n                        if (!pro)//\r\n                            break;\r\n                    }\r\n                    let v44 = nodeOwner.value as Vector4;\r\n                    v44.x = srcValue.r + crossWeight * (desValue.r - srcValue.r);\r\n                    v44.y = srcValue.g + crossWeight * (desValue.g - srcValue.g);\r\n                    v44.z = srcValue.b + crossWeight * (desValue.b - srcValue.b);\r\n                    v44.w = srcValue.a + crossWeight * (desValue.a - srcValue.a);\r\n\r\n                    nodeOwner.value = v44;\r\n                    lastpro = proPat[m];\r\n                    if (!nodeOwner.isMaterial) {\r\n                        pro && (pro[lastpro] = this._applyColor(pro[lastpro], nodeOwner, additive, weight, isFirstLayer, v44));\r\n                    } else {\r\n                        pro && (pro as Material).setColor(lastpro, this._applyColor((pro as Material).getColor(lastpro), nodeOwner, additive, weight, isFirstLayer, v44));\r\n                    }\r\n                    if (nodeOwner.callbackFun) {\r\n                        nodeOwner.animatorDataSetCallBack();\r\n                    }\r\n                    break;\r\n                case KeyFrameValueType.Vector2:\r\n                    var proPat: string[] = nodeOwner.property!;\r\n                    var m: number = proPat.length - 1;\r\n                    for (var j: number = 0; j < m; j++) {\r\n                        pro = pro[proPat[j]];\r\n                        if (!pro)//\r\n                            break;\r\n                    }\r\n                    let v2 = nodeOwner.value as Vector2;\r\n                    v2.x = srcValue.r + crossWeight * (desValue.r - srcValue.r);\r\n                    v2.y = srcValue.g + crossWeight * (desValue.g - srcValue.g);\r\n                    nodeOwner.value = v2;\r\n                    lastpro = proPat[m];\r\n                    if (!nodeOwner.isMaterial) {\r\n                        pro && (pro[lastpro] = this._applyVec2(pro[lastpro], nodeOwner, additive, weight, isFirstLayer, v2));\r\n                    } else {\r\n                        pro && (pro as Material).setVector2(lastpro, this._applyVec2((pro as Material).getVector2(lastpro), nodeOwner, additive, weight, isFirstLayer, v2));\r\n                    }\r\n                    if (nodeOwner.callbackFun) {\r\n                        nodeOwner.animatorDataSetCallBack();\r\n                    }\r\n                    break;\r\n                case KeyFrameValueType.Vector4:\r\n                    var proPat: string[] = nodeOwner.property!;\r\n                    var m: number = proPat.length - 1;\r\n                    for (var j: number = 0; j < m; j++) {\r\n                        pro = pro[proPat[j]];\r\n                        if (!pro)//\r\n                            break;\r\n                    }\r\n                    let v4 = nodeOwner.value as Vector4;\r\n                    v4.x = srcValue.x + crossWeight * (desValue.x - srcValue.x);\r\n                    v4.y = srcValue.y + crossWeight * (desValue.y - srcValue.y);\r\n                    v4.z = srcValue.z + crossWeight * (desValue.z - srcValue.z);\r\n                    nodeOwner.value = v4;\r\n                    lastpro = proPat[m];\r\n                    if (!nodeOwner.isMaterial) {\r\n                        pro && (pro[lastpro] = this._applyVec4(pro[lastpro], nodeOwner, additive, weight, isFirstLayer, v4));\r\n                    } else {\r\n                        pro && (pro as Material).setVector4(lastpro, this._applyVec4((pro as Material).getVector4(lastpro), nodeOwner, additive, weight, isFirstLayer, v4));\r\n                    }\r\n                    if (nodeOwner.callbackFun) {\r\n                        nodeOwner.animatorDataSetCallBack();\r\n                    }\r\n                    break;\r\n                case KeyFrameValueType.Vector3:\r\n                    var proPat: string[] = nodeOwner.property!;\r\n                    var m: number = proPat.length - 1;\r\n                    for (var j: number = 0; j < m; j++) {\r\n                        pro = pro[proPat[j]];\r\n                        if (!pro)//\r\n                            break;\r\n                    }\r\n                    let v3 = nodeOwner.value as Vector3;\r\n                    v3.x = srcValue.x + crossWeight * (desValue.x - srcValue.x);\r\n                    v3.y = srcValue.y + crossWeight * (desValue.y - srcValue.y);\r\n                    v3.z = srcValue.z + crossWeight * (desValue.z - srcValue.z);\r\n                    nodeOwner.value = v3;\r\n                    lastpro = proPat[m];\r\n                    if (!nodeOwner.isMaterial) {\r\n                        pro && (pro[lastpro] = this._applyVec3(pro[lastpro], nodeOwner, additive, weight, isFirstLayer, v3));\r\n                    } else {\r\n                        pro && (pro as Material).setVector3(lastpro, this._applyVec3((pro as Material).getVector3(lastpro), nodeOwner, additive, weight, isFirstLayer, v3));\r\n                    }\r\n                    if (nodeOwner.callbackFun) {\r\n                        nodeOwner.animatorDataSetCallBack();\r\n                    }\r\n                    break;\r\n            }\r\n            nodeOwner.updateMark = this._updateMark;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Node\r\n     * @param stateInfo \r\n     * @param additive addtive\r\n     * @param weight state\r\n     * @param isFirstLayer \r\n     */\r\n    private _setClipDatasToNode(stateInfo: AnimatorState, additive: boolean, weight: number, isFirstLayer: boolean, controllerLayer: AnimatorControllerLayer = null): void {\r\n        var realtimeDatas: Array<number | Vector3 | Quaternion | Vector2 | Vector4 | Color> = stateInfo._realtimeDatas;\r\n        var nodes: KeyframeNodeList = stateInfo._clip!._nodes!;\r\n        var nodeOwners: KeyframeNodeOwner[] = stateInfo._nodeOwners;\r\n        for (var i: number = 0, n: number = nodes.count; i < n; i++) {\r\n            var nodeOwner: KeyframeNodeOwner = nodeOwners[i];\r\n            if (nodeOwner) {//\r\n                var node = nodes.getNodeByIndex(i);\r\n                if (controllerLayer.avatarMask && (!controllerLayer.avatarMask.getTransformActive(node.nodePath))) {\r\n                    continue;\r\n                }\r\n                var pro: any = nodeOwner.propertyOwner;\r\n                let value: string;\r\n                if (pro) {\r\n                    switch (nodeOwner.type) {\r\n                        case KeyFrameValueType.Float: //Float\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            //pro && this._applyFloat(pro, proPat[m], nodeOwner, additive, weight, isFirstLayer, <number>realtimeDatas[i]);\r\n                            let lastpro = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[lastpro] = this._applyFloat(pro[lastpro], nodeOwner, additive, weight, isFirstLayer, <number>realtimeDatas[i]));\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && (pro as Material).setFloat(lastpro, this._applyFloat(0, nodeOwner, additive, weight, isFirstLayer, <number>realtimeDatas[i]));\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Position: //Position\r\n                            var localPos: Vector3 = pro.localPosition;\r\n                            this._applyPositionAndRotationEuler(nodeOwner, additive, weight, isFirstLayer, <Vector3>realtimeDatas[i], localPos);\r\n                            pro.localPosition = localPos;\r\n                            break;\r\n                        case KeyFrameValueType.Rotation: //Rotation\r\n                            var localRot: Quaternion = pro.localRotation;\r\n                            this._applyRotation(nodeOwner, additive, weight, isFirstLayer, <Quaternion>realtimeDatas[i], localRot);\r\n                            pro.localRotation = localRot;\r\n                            break;\r\n                        case KeyFrameValueType.Scale: //Scale\r\n                            var localSca: Vector3 = pro.localScale;\r\n                            this._applyScale(nodeOwner, additive, weight, isFirstLayer, <Vector3>realtimeDatas[i], localSca);\r\n                            pro.localScale = localSca;\r\n                            break;\r\n                        case KeyFrameValueType.RotationEuler: //RotationEuler\r\n                            var localEuler: Vector3 = pro.localRotationEuler;\r\n                            this._applyPositionAndRotationEuler(nodeOwner, additive, weight, isFirstLayer, <Vector3>realtimeDatas[i], localEuler);\r\n                            pro.localRotationEuler = localEuler;\r\n                            break;\r\n                        case KeyFrameValueType.Vector2://vec2\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = this._applyVec2(pro[value], nodeOwner, additive, weight, isFirstLayer, <Vector2>realtimeDatas[i]));\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getVector2(value) && (pro as Material).setVector2(value, this._applyVec2(pro.getVector2(value), nodeOwner, additive, weight, isFirstLayer, <Vector2>realtimeDatas[i]));\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Vector3://vec3\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = this._applyVec3(pro[value], nodeOwner, additive, weight, isFirstLayer, <Vector3>realtimeDatas[i]));\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getVector3(value) && (pro as Material).setVector3(value, this._applyVec3(pro.getVector3(value), nodeOwner, additive, weight, isFirstLayer, <Vector3>realtimeDatas[i]));\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Vector4://vec4\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = this._applyVec4(pro[value], nodeOwner, additive, weight, isFirstLayer, <Vector4>realtimeDatas[i]));\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getVector4(value) && (pro as Material).setVector4(value, this._applyVec4(pro.getVector4(value), nodeOwner, additive, weight, isFirstLayer, <Vector4>realtimeDatas[i]));\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Color://Color\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = this._applyColor(pro[value], nodeOwner, additive, weight, isFirstLayer, <Vector4>realtimeDatas[i]));\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getColor(value) && (pro as Material).setColor(value, this._applyColor(pro.getColor(value), nodeOwner, additive, weight, isFirstLayer, <Vector4>realtimeDatas[i]));\r\n                            }\r\n                            break;\r\n                    }\r\n                    nodeOwner.updateMark = this._updateMark;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _setCrossClipDatasToNode(controllerLayer: AnimatorControllerLayer, srcState: AnimatorState, destState: AnimatorState, crossWeight: number, isFirstLayer: boolean): void {\r\n        var nodeOwners: KeyframeNodeOwner[] = controllerLayer._crossNodesOwners;\r\n        var ownerCount: number = controllerLayer._crossNodesOwnersCount;\r\n        var additive: boolean = controllerLayer.blendingMode !== AnimatorControllerLayer.BLENDINGMODE_OVERRIDE;\r\n        var weight: number = controllerLayer.defaultWeight;\r\n\r\n        var destRealtimeDatas: Array<number | Vector3 | Quaternion> = destState._realtimeDatas;\r\n        var destDataIndices: number[] = controllerLayer._destCrossClipNodeIndices;\r\n        var destNodeOwners: KeyframeNodeOwner[] = destState._nodeOwners;\r\n        var srcRealtimeDatas: Array<number | Vector3 | Quaternion> = srcState._realtimeDatas;\r\n        var srcDataIndices: number[] = controllerLayer._srcCrossClipNodeIndices;\r\n        var srcNodeOwners: KeyframeNodeOwner[] = srcState._nodeOwners;\r\n\r\n        for (var i: number = 0; i < ownerCount; i++) {\r\n            var nodeOwner: KeyframeNodeOwner = nodeOwners[i];\r\n            if (nodeOwner) {\r\n                var srcIndex: number = srcDataIndices[i];\r\n                var destIndex: number = destDataIndices[i];\r\n                if (-1 == srcIndex && -1 == destIndex) continue;\r\n                var srcValue: any = srcIndex !== -1 ? srcRealtimeDatas[srcIndex] : destNodeOwners[destIndex].defaultValue;\r\n                if (null == srcValue) continue;\r\n                var desValue: any = destIndex !== -1 ? destRealtimeDatas[destIndex] : srcNodeOwners[srcIndex].defaultValue;\r\n                if (!desValue) {\r\n                    desValue = srcNodeOwners[srcIndex].defaultValue;\r\n                }\r\n                if (null == desValue) continue;\r\n                if (!controllerLayer.avatarMask || controllerLayer.avatarMask.getTransformActive(nodeOwner.nodePath)) {\r\n                    this._applyCrossData(nodeOwner, additive, weight, isFirstLayer, srcValue, desValue, crossWeight);\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _setFixedCrossClipDatasToNode(controllerLayer: AnimatorControllerLayer, destState: AnimatorState, crossWeight: number, isFirstLayer: boolean): void {\r\n        var nodeOwners: KeyframeNodeOwner[] = controllerLayer._crossNodesOwners;\r\n        var ownerCount: number = controllerLayer._crossNodesOwnersCount;\r\n        var additive: boolean = controllerLayer.blendingMode !== AnimatorControllerLayer.BLENDINGMODE_OVERRIDE;\r\n        var weight: number = controllerLayer.defaultWeight;\r\n        var destRealtimeDatas: Array<number | Vector3 | Quaternion> = destState._realtimeDatas;\r\n        var destDataIndices: number[] = controllerLayer._destCrossClipNodeIndices;\r\n\r\n        for (var i: number = 0; i < ownerCount; i++) {\r\n            var nodeOwner: KeyframeNodeOwner = nodeOwners[i];\r\n            if (nodeOwner) {\r\n                var destIndex: number = destDataIndices[i];\r\n                var srcValue: any = nodeOwner.crossFixedValue;\r\n                var desValue;\r\n                if (destIndex == -1 || !destRealtimeDatas[destIndex]) {\r\n                    desValue = nodeOwner.defaultValue;\r\n                } else {\r\n                    desValue = destRealtimeDatas[destIndex];\r\n                }\r\n                this._applyCrossData(nodeOwner, additive, weight, isFirstLayer, srcValue, desValue, crossWeight);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _revertDefaultKeyframeNodes(clipStateInfo: AnimatorState): void {\r\n        var nodeOwners: KeyframeNodeOwner[] = clipStateInfo._nodeOwners;\r\n        for (var i: number = 0, n: number = nodeOwners.length; i < n; i++) {\r\n            var nodeOwner: KeyframeNodeOwner = nodeOwners[i];\r\n            if (nodeOwner) {\r\n                var pro: any = nodeOwner.propertyOwner;\r\n                let value: string;\r\n                if (pro) {\r\n                    switch (nodeOwner.type) {\r\n                        case KeyFrameValueType.Float:\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            //pro && this._applyFloat(pro, proPat[m], nodeOwner, additive, weight, isFirstLayer, <number>realtimeDatas[i]);\r\n                            let lastpro = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[lastpro] = nodeOwner.defaultValue);\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && (pro as Material).setFloat(lastpro, nodeOwner.defaultValue);\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Position:\r\n                            var locPos: Vector3 = pro.localPosition;\r\n                            var def: Vector3 = nodeOwner.defaultValue;\r\n                            locPos.x = def.x;\r\n                            locPos.y = def.y;\r\n                            locPos.z = def.z;\r\n                            pro.localPosition = locPos;\r\n                            break;\r\n                        case KeyFrameValueType.Rotation:\r\n                            var locRot: Quaternion = pro.localRotation;\r\n                            var defQua: Quaternion = nodeOwner.defaultValue;\r\n                            locRot.x = defQua.x;\r\n                            locRot.y = defQua.y;\r\n                            locRot.z = defQua.z;\r\n                            locRot.w = defQua.w;\r\n                            pro.localRotation = locRot;\r\n                            break;\r\n                        case KeyFrameValueType.Scale:\r\n                            var locSca: Vector3 = pro.localScale;\r\n                            def = nodeOwner.defaultValue;\r\n                            locSca.x = def.x;\r\n                            locSca.y = def.y;\r\n                            locSca.z = def.z;\r\n                            pro.localScale = locSca;\r\n                            break;\r\n                        case KeyFrameValueType.RotationEuler:\r\n                            var locEul: Vector3 = pro.localRotationEuler;\r\n                            def = nodeOwner.defaultValue;\r\n                            locEul.x = def.x;\r\n                            locEul.y = def.y;\r\n                            locEul.z = def.z;\r\n                            pro.localRotationEuler = locEul;\r\n                            break;\r\n                        case KeyFrameValueType.Vector2:\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = nodeOwner.defaultValue);\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getVector2(value) && (pro as Material).setVector2(value, nodeOwner.defaultValue);\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Vector3:\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = nodeOwner.defaultValue);\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getVector3(value) && (pro as Material).setVector3(value, nodeOwner.defaultValue);\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Vector4:\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = nodeOwner.defaultValue);\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getVector3(value) && (pro as Material).setVector3(value, nodeOwner.defaultValue);\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Color:\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            let tempColor = Animator._tempColor;\r\n                            tempColor.r = nodeOwner.defaultValue.x;\r\n                            tempColor.g = nodeOwner.defaultValue.y;\r\n                            tempColor.b = nodeOwner.defaultValue.z;\r\n                            tempColor.a = nodeOwner.defaultValue.w;\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = tempColor);\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getColor(value) && (pro as Material).setColor(value, tempColor);\r\n                            }\r\n                            break;\r\n                        default:\r\n                            throw \"Animator:unknown type.\";\r\n                    }\r\n\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    onAfterDeserialize(): void {\r\n        let arr = (<any>this).controllerLayers;\r\n        if (!arr || null != this.controller)\r\n            return;\r\n        delete (<any>this).controllerLayers;\r\n        this._controllerLayers.length = 0;\r\n        for (let layer of arr) {\r\n            this.addControllerLayer(layer);\r\n        }\r\n    }\r\n\r\n    protected _onEnable(): void {\r\n        for (let i = 0, n = this._controllerLayers.length; i < n; i++) {\r\n            if (this._controllerLayers[i].playOnWake) {\r\n                let defaultClip: AnimatorState = this.getDefaultState(i);\r\n                (defaultClip) && (this.play(null, i, defaultClip.cycleOffset));\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _onDestroy() {\r\n        for (let i = 0, n = this._controllerLayers.length; i < n; i++)\r\n            this._controllerLayers[i]._removeReference();\r\n    }\r\n\r\n    private _applyUpdateMode(delta: number): number {\r\n        let ret;\r\n        switch (this._updateMode) {\r\n            case AnimatorUpdateMode.Normal:\r\n                ret = delta;\r\n                break;\r\n            case AnimatorUpdateMode.LowFrame:\r\n                ret = (Stat.loopCount % this._lowUpdateDelty == 0) ? delta * this._lowUpdateDelty : 0;\r\n                break;\r\n            case AnimatorUpdateMode.UnScaleTime:\r\n                ret = 0;\r\n                break;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _handleSpriteOwnersBySprite(isLink: boolean, path: string[], sprite: Sprite3D): void {\r\n        for (var i: number = 0, n: number = this._controllerLayers.length; i < n; i++) {\r\n            if (!this._controllerLayers[i].enable)\r\n                continue;\r\n            var clipStateInfos: AnimatorState[] = this._controllerLayers[i]._states;\r\n            for (var j: number = 0, m: number = clipStateInfos.length; j < m; j++) {\r\n                var clipStateInfo: AnimatorState = clipStateInfos[j];\r\n                var clip: AnimationClip = clipStateInfo._clip!;\r\n                var nodePath: string = path.join(\"/\");\r\n                var ownersNodes: KeyframeNode[] = clip._nodesMap[nodePath];\r\n                if (ownersNodes) {\r\n                    var nodeOwners: KeyframeNodeOwner[] = clipStateInfo._nodeOwners;\r\n                    for (var k: number = 0, p: number = ownersNodes.length; k < p; k++) {\r\n                        if (isLink)\r\n                            this._addKeyframeNodeOwner(nodeOwners, ownersNodes[k], sprite);\r\n                        else\r\n                            this._removeKeyframeNodeOwner(nodeOwners, ownersNodes[k]);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @internal\r\n     * @override\r\n     */\r\n    _parse(data: any): void {\r\n        var play: any = data.playOnWake;\r\n        var layersData: any[] = data.layers;\r\n        for (var i: number = 0; i < layersData.length; i++) {\r\n            var layerData: any = layersData[i];\r\n            var animatorLayer: AnimatorControllerLayer = new AnimatorControllerLayer(layerData.name);\r\n            if (i === 0)\r\n                animatorLayer.defaultWeight = 1.0;//TODO:\r\n            else\r\n                animatorLayer.defaultWeight = layerData.weight;\r\n\r\n            var blendingModeData: any = layerData.blendingMode;\r\n            (blendingModeData) && (animatorLayer.blendingMode = blendingModeData);\r\n            this.addControllerLayer(animatorLayer);\r\n            var states: any[] = layerData.states;\r\n            for (var j: number = 0, m: number = states.length; j < m; j++) {\r\n                var state: any = states[j];\r\n                var clipPath: string = state.clipPath;\r\n                if (clipPath) {\r\n                    var name: string = state.name;\r\n                    var motion: AnimationClip;\r\n                    motion = Loader.getRes(clipPath);\r\n                    if (motion) {//motion\r\n                        var animatorState: AnimatorState = new AnimatorState();\r\n                        animatorState.name = name;\r\n                        animatorState.clip = motion;\r\n                        state.speed && (animatorState.speed = state.speed);\r\n                        animatorLayer.addState(animatorState);\r\n                        (j === 0) && (this.getControllerLayer(i).defaultState = animatorState);\r\n                    }\r\n                }\r\n            }\r\n            (play !== undefined) && (animatorLayer.playOnWake = play);\r\n            //avatarMask\r\n            let layerMaskData = layerData.avatarMask;\r\n            if (layerMaskData) {\r\n                let avaMask = new AvatarMask();\r\n                animatorLayer.avatarMask = avaMask;\r\n                for (var bips in layerMaskData) {\r\n                    avaMask.setTransformActive(bips, layerMaskData[bips]);\r\n                }\r\n            }\r\n        }\r\n        var cullingModeData: any = data.cullingMode;\r\n        (cullingModeData !== undefined) && (this.cullingMode = cullingModeData);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    onUpdate(): void {\r\n        let timer = this.owner._scene.timer;\r\n        let delta = timer._delta / 1000.0;//Laya.timer.deltaLaya.timer.scale\r\n        delta = this._applyUpdateMode(delta);\r\n        if (this._speed === 0 || delta === 0)//delta0,crossWeightNaN\r\n            return;\r\n        if (!Stat.enableAnimatorUpdate)\r\n            return;\r\n        var needRender = true;//TODO:needRendertrue\r\n        var i, n;\r\n        this._updateMark++;\r\n        for (i = 0, n = this._controllerLayers.length; i < n; i++) {\r\n            var controllerLayer: AnimatorControllerLayer = this._controllerLayers[i];\r\n            if (!controllerLayer.enable)\r\n                continue;\r\n            var playStateInfo: AnimatorPlayState = controllerLayer._playStateInfo!;\r\n            if (this.sleep && playStateInfo._finish && controllerLayer._playType == 0) {\r\n                continue;\r\n            }\r\n            var crossPlayStateInfo: AnimatorPlayState = controllerLayer._crossPlayStateInfo!;\r\n            addtive = controllerLayer.blendingMode !== AnimatorControllerLayer.BLENDINGMODE_OVERRIDE;\r\n            switch (controllerLayer._playType) {\r\n                case 0:\r\n                    var animatorState: AnimatorState = playStateInfo.currentState!;\r\n                    var clip: AnimationClip = animatorState._clip!;\r\n                    var speed: number = this._speed * animatorState.speed;\r\n                    var finish: boolean = playStateInfo._finish;//finish,\r\n                    finish || this._updatePlayer(animatorState, playStateInfo, delta * speed, animatorState.islooping, i);\r\n                    if (needRender) {\r\n                        var addtive: boolean = controllerLayer.blendingMode !== AnimatorControllerLayer.BLENDINGMODE_OVERRIDE;\r\n                        this._updateClipDatas(animatorState, addtive, playStateInfo, controllerLayer.avatarMask);//clipDatas,Animator,updateClipDatas\r\n                        this._setClipDatasToNode(animatorState, addtive, controllerLayer.defaultWeight, i === 0, controllerLayer);//\r\n                        finish || this._updateEventScript(animatorState, playStateInfo);\r\n                    }\r\n                    finish || this._updateStateFinish(animatorState, playStateInfo);\r\n                    break;\r\n                case 1:\r\n                    animatorState = playStateInfo.currentState!;\r\n                    clip = animatorState._clip!;\r\n                    var crossState: AnimatorState = controllerLayer._crossPlayState;\r\n                    var crossClip: AnimationClip = crossState._clip!;\r\n                    var crossDuratuion: number = controllerLayer._crossDuration;\r\n                    var startPlayTime: number = crossPlayStateInfo._startPlayTime;\r\n                    var crossClipDuration: number = crossClip._duration - startPlayTime;\r\n                    var crossScale: number = (crossDuratuion > crossClipDuration && 0 != crossClipDuration) ? crossClipDuration / crossDuratuion : 1.0;//,\r\n                    var crossSpeed: number = this._speed * crossState.speed;\r\n                    this._updatePlayer(crossState, crossPlayStateInfo, delta * crossScale * crossSpeed, crossClip.islooping, i);\r\n                    var crossWeight: number = ((crossPlayStateInfo._elapsedTime - startPlayTime) / crossScale) / crossDuratuion;\r\n                    var needUpdateFinishcurrentState = false;\r\n                    if (crossWeight >= 1.0) {\r\n                        if (needRender) {\r\n                            this._updateClipDatas(crossState, addtive, crossPlayStateInfo, controllerLayer.avatarMask);\r\n                            this._setClipDatasToNode(crossState, addtive, controllerLayer.defaultWeight, i === 0, controllerLayer);\r\n\r\n                            controllerLayer._playType = 0;//,\r\n                            playStateInfo.currentState = crossState;\r\n                            crossPlayStateInfo._cloneTo(playStateInfo);\r\n                        }\r\n                    } else {\r\n                        if (!playStateInfo._finish) {\r\n                            speed = this._speed * animatorState.speed;\r\n                            needUpdateFinishcurrentState = true;\r\n                            this._updatePlayer(animatorState, playStateInfo, delta * speed, animatorState.islooping, i);\r\n                            if (needRender)\r\n                                this._updateClipDatas(animatorState, addtive, playStateInfo, controllerLayer.avatarMask);\r\n                        }\r\n                        if (needRender) {\r\n                            this._updateClipDatas(crossState, addtive, crossPlayStateInfo, controllerLayer.avatarMask);\r\n                            this._setCrossClipDatasToNode(controllerLayer, animatorState, crossState, crossWeight, i === 0);\r\n                        }\r\n                    }\r\n                    if (needRender) {\r\n                        this._updateEventScript(animatorState, playStateInfo);\r\n                        this._updateEventScript(crossState, crossPlayStateInfo);\r\n                    }\r\n                    this._updateStateFinish(crossState, crossPlayStateInfo);\r\n                    needUpdateFinishcurrentState && this._updateStateFinish(playStateInfo.currentState, playStateInfo);\r\n                    break;\r\n                case 2:\r\n                    crossState = controllerLayer._crossPlayState;\r\n                    crossClip = crossState._clip!;\r\n                    crossDuratuion = controllerLayer._crossDuration;\r\n                    startPlayTime = crossPlayStateInfo._startPlayTime;\r\n                    crossClipDuration = crossClip._duration - startPlayTime;\r\n                    crossScale = crossDuratuion > crossClipDuration ? crossClipDuration / crossDuratuion : 1.0;//,\r\n                    crossSpeed = this._speed * crossState.speed;\r\n                    this._updatePlayer(crossState, crossPlayStateInfo, delta * crossScale * crossSpeed, crossState.islooping, i);\r\n                    if (needRender) {\r\n                        crossWeight = ((crossPlayStateInfo._elapsedTime - startPlayTime) / crossScale) / crossDuratuion;\r\n                        if (crossWeight >= 1.0) {\r\n                            this._updateClipDatas(crossState, addtive, crossPlayStateInfo, controllerLayer.avatarMask);\r\n                            this._setClipDatasToNode(crossState, addtive, 1.0, i === 0, controllerLayer);\r\n                            controllerLayer._playType = 0;//,\r\n                            playStateInfo.currentState = crossState;\r\n                            crossPlayStateInfo._cloneTo(playStateInfo);\r\n                        } else {\r\n                            this._updateClipDatas(crossState, addtive, crossPlayStateInfo, controllerLayer.avatarMask);\r\n                            this._setFixedCrossClipDatasToNode(controllerLayer, crossState, crossWeight, i === 0);\r\n                        }\r\n                        this._updateEventScript(crossState, crossPlayStateInfo);\r\n                    }\r\n                    this._updateStateFinish(crossState, crossPlayStateInfo);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    _cloneTo(dest: Component): void {\r\n        var animator: Animator = (<Animator>dest);\r\n        animator.cullingMode = this.cullingMode;\r\n\r\n        for (var i: number = 0, n: number = this._controllerLayers.length; i < n; i++) {\r\n            var controllLayer: AnimatorControllerLayer = this._controllerLayers[i];\r\n            animator.addControllerLayer(controllLayer.clone());\r\n            var animatorStates: AnimatorState[] = controllLayer._states;\r\n            for (var j: number = 0, m: number = animatorStates.length; j < m; j++) {\r\n                var state: AnimatorState = animatorStates[j].clone();\r\n                var cloneLayer: AnimatorControllerLayer = animator.getControllerLayer(i);\r\n                cloneLayer.addState(state);\r\n                (j == 0) && (cloneLayer.defaultState = state);\r\n            }\r\n        }\r\n        animator.controller = this._controller\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tlayerIndex \r\n     * @return \r\n     */\r\n    getDefaultState(layerIndex: number = 0): AnimatorState {\r\n        var controllerLayer: AnimatorControllerLayer = this._controllerLayers[layerIndex];\r\n        return controllerLayer.defaultState;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tstate \r\n     * @param   layerIndex \r\n     */\r\n    addState(state: AnimatorState, layerIndex: number = 0): void {\r\n        var controllerLayer: AnimatorControllerLayer = this._controllerLayers[layerIndex];\r\n        controllerLayer.addState(state);\r\n        console.warn(\"Animator:this function is discard,please use animatorControllerLayer.addState() instead.\");\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tstate \r\n     * @param   layerIndex \r\n     */\r\n    removeState(state: AnimatorState, layerIndex: number = 0): void {\r\n        var controllerLayer: AnimatorControllerLayer = this._controllerLayers[layerIndex];\r\n        controllerLayer.removeState(state);\r\n        console.warn(\"Animator:this function is discard,please use animatorControllerLayer.removeState() instead.\");\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    addControllerLayer(controllderLayer: AnimatorControllerLayer): void {\r\n        this._controllerLayers.push(controllderLayer);\r\n        controllderLayer._animator = this;//TODO:,\r\n        controllderLayer._addReference();\r\n        var states: AnimatorState[] = controllderLayer._states;\r\n        for (var i: number = 0, n: number = states.length; i < n; i++)\r\n            this._getOwnersByClip(states[i]);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    getControllerLayer(layerInex: number = 0): AnimatorControllerLayer {\r\n        return this._controllerLayers[layerInex];\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tname null\r\n     * @param\tlayerIndex \r\n     * @param\tnormalizedTime \r\n     */\r\n    play(name: string | null = null, layerIndex: number = 0, normalizedTime: number = Number.NEGATIVE_INFINITY): void {\r\n        var controllerLayer: AnimatorControllerLayer = this._controllerLayers[layerIndex];\r\n        if (controllerLayer) {\r\n            var defaultState: AnimatorState = controllerLayer.defaultState;\r\n            if (!name && !defaultState)\r\n                throw new Error(\"Animator:must have default clip value,please set clip property.\");\r\n            var playStateInfo: AnimatorPlayState = controllerLayer._playStateInfo!;\r\n            var curPlayState: AnimatorState = playStateInfo.currentState!;\r\n\r\n\r\n            var animatorState: AnimatorState = name ? controllerLayer.getAnimatorState(name) : defaultState;\r\n            if (!animatorState._clip)\r\n                return;\r\n\r\n            var clipDuration: number = animatorState._clip!._duration;\r\n            var calclipduration = animatorState._clip!._duration * (animatorState.clipEnd - animatorState.clipStart);\r\n            if (curPlayState !== animatorState) {\r\n                if (normalizedTime !== Number.NEGATIVE_INFINITY)\r\n                    playStateInfo._resetPlayState(clipDuration * normalizedTime, calclipduration);\r\n                else\r\n                    playStateInfo._resetPlayState(0.0, calclipduration);\r\n                (curPlayState !== null && curPlayState !== animatorState) && (this._revertDefaultKeyframeNodes(curPlayState));\r\n                controllerLayer._playType = 0;\r\n                playStateInfo.currentState = animatorState;\r\n            } else {\r\n                if (normalizedTime !== Number.NEGATIVE_INFINITY) {\r\n                    playStateInfo._resetPlayState(clipDuration * normalizedTime, calclipduration);\r\n                    controllerLayer._playType = 0;\r\n                }\r\n            }\r\n            var scripts: AnimatorStateScript[] = animatorState._scripts!;\r\n            animatorState._eventStart(this, layerIndex);\r\n\r\n        }\r\n        else {\r\n            console.warn(\"Invalid layerIndex \" + layerIndex + \".\");\r\n        }\r\n        if (this.owner._scene) {\r\n            this.onUpdate();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tname \r\n     * @param\ttransitionDuration ,0.0~1.0\r\n     * @param\tlayerIndex \r\n     * @param\tnormalizedTime \r\n     */\r\n    crossFade(name: string, transitionDuration: number, layerIndex: number = 0, normalizedTime: number = Number.NEGATIVE_INFINITY): void {\r\n        var controllerLayer = this._controllerLayers[layerIndex];\r\n        if (controllerLayer) {\r\n            var destAnimatorState = controllerLayer.getAnimatorState(name);\r\n            if (destAnimatorState) {\r\n                var playType = controllerLayer._playType;\r\n                if (playType === -1) {//playplay\r\n                    this.play(name, layerIndex, normalizedTime);\r\n                    return;\r\n                }\r\n\r\n                var crossPlayStateInfo = controllerLayer._crossPlayStateInfo;\r\n                var crossNodeOwners = controllerLayer._crossNodesOwners;\r\n                var crossNodeOwnerIndicesMap = controllerLayer._crossNodesOwnersIndicesMap;\r\n\r\n                var srcAnimatorState = controllerLayer._playStateInfo!.currentState;\r\n                var destNodeOwners = destAnimatorState._nodeOwners;\r\n                var destCrossClipNodeIndices = controllerLayer._destCrossClipNodeIndices;\r\n                var destClip = destAnimatorState._clip;\r\n                var destNodes = destClip._nodes!;\r\n                var destNodesMap = destClip._nodesDic;\r\n                var crossCount = 0;\r\n                switch (playType) {\r\n                    case 0:\r\n                        var srcNodeOwners = srcAnimatorState!._nodeOwners;\r\n                        var scrCrossClipNodeIndices = controllerLayer._srcCrossClipNodeIndices;\r\n                        var srcClip = srcAnimatorState!._clip;\r\n                        var srcNodes = srcClip!._nodes!;\r\n                        var srcNodesMap = srcClip!._nodesDic;\r\n                        controllerLayer._playType = 1;\r\n\r\n                        var crossMark = ++controllerLayer._crossMark;\r\n                        crossCount = controllerLayer._crossNodesOwnersCount = 0;\r\n\r\n                        for (var i = 0, n = srcNodes.count; i < n; i++) {\r\n                            var srcNode = srcNodes.getNodeByIndex(i);\r\n                            var srcIndex = srcNode._indexInList;\r\n                            var srcNodeOwner = srcNodeOwners[srcIndex];\r\n                            if (srcNodeOwner) {\r\n                                var srcFullPath = srcNode.fullPath;\r\n                                scrCrossClipNodeIndices[crossCount] = srcIndex;\r\n                                var destNode = destNodesMap[srcFullPath];\r\n                                if (destNode)\r\n                                    destCrossClipNodeIndices[crossCount] = destNode._indexInList;\r\n                                else\r\n                                    destCrossClipNodeIndices[crossCount] = -1;\r\n\r\n                                crossNodeOwnerIndicesMap[srcFullPath] = crossMark;\r\n                                crossNodeOwners[crossCount] = srcNodeOwner;\r\n                                crossCount++;\r\n                            }\r\n                        }\r\n\r\n                        for (i = 0, n = destNodes.count; i < n; i++) {\r\n                            destNode = destNodes.getNodeByIndex(i);\r\n                            var destIndex = destNode._indexInList;\r\n                            var destNodeOwner = destNodeOwners[destIndex];\r\n                            if (destNodeOwner) {\r\n                                var destFullPath = destNode.fullPath;\r\n                                if (!srcNodesMap[destFullPath]) {\r\n                                    scrCrossClipNodeIndices[crossCount] = -1;\r\n                                    destCrossClipNodeIndices[crossCount] = destIndex;\r\n\r\n                                    crossNodeOwnerIndicesMap[destFullPath] = crossMark;\r\n                                    crossNodeOwners[crossCount] = destNodeOwner;\r\n                                    crossCount++;\r\n                                }\r\n                            }\r\n                        }\r\n                        break;\r\n                    case 1:\r\n                    case 2:\r\n                        controllerLayer._playType = 2;\r\n                        for (i = 0, n = crossNodeOwners.length; i < n; i++) {\r\n                            var nodeOwner = crossNodeOwners[i];\r\n                            nodeOwner.saveCrossFixedValue();\r\n                            destNode = destNodesMap[nodeOwner.fullPath!];\r\n                            if (destNode)\r\n                                destCrossClipNodeIndices[i] = destNode._indexInList;\r\n                            else\r\n                                destCrossClipNodeIndices[i] = -1;\r\n                        }\r\n\r\n                        crossCount = controllerLayer._crossNodesOwnersCount;\r\n                        crossMark = controllerLayer._crossMark;\r\n                        for (i = 0, n = destNodes.count; i < n; i++) {\r\n                            destNode = destNodes.getNodeByIndex(i);\r\n                            destIndex = destNode._indexInList;\r\n                            destNodeOwner = destNodeOwners[destIndex];\r\n                            if (destNodeOwner) {\r\n                                destFullPath = destNode.fullPath;\r\n                                if (crossNodeOwnerIndicesMap[destFullPath] !== crossMark) {\r\n                                    destCrossClipNodeIndices[crossCount] = destIndex;\r\n\r\n                                    crossNodeOwnerIndicesMap[destFullPath] = crossMark;\r\n                                    nodeOwner = destNodeOwners[destIndex];\r\n                                    crossNodeOwners[crossCount] = nodeOwner;\r\n                                    nodeOwner.saveCrossFixedValue();\r\n                                    crossCount++;\r\n                                }\r\n                            }\r\n                        }\r\n                        break;\r\n                    default:\r\n                }\r\n                controllerLayer._crossNodesOwnersCount = crossCount;\r\n                controllerLayer._crossPlayState = destAnimatorState;\r\n                controllerLayer._crossDuration = srcAnimatorState!._clip!._duration * transitionDuration;\r\n                if (normalizedTime !== Number.NEGATIVE_INFINITY)\r\n                    crossPlayStateInfo!._resetPlayState(destClip._duration * normalizedTime, controllerLayer._crossDuration);\r\n                else\r\n                    crossPlayStateInfo!._resetPlayState(0.0, controllerLayer._crossDuration);\r\n                destAnimatorState._eventStart(this, layerIndex);\r\n            }\r\n            else {\r\n                console.warn(\"Invalid name \" + layerIndex + \".\");\r\n            }\r\n        }\r\n        else {\r\n            console.warn(\"Invalid layerIndex \" + layerIndex + \".\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * set params value\r\n     * @param name \r\n     */\r\n    setParamsTrigger(name: number): void;\r\n    setParamsTrigger(name: string): void;\r\n    setParamsTrigger(name: string | number) {\r\n        let id;\r\n        if (typeof name == \"number\")\r\n            id = name;\r\n        else\r\n            id = AnimatorStateCondition.conditionNameToID(name);\r\n        this._animatorParams[id] = true;\r\n    }\r\n\r\n    /**\r\n     * set params value\r\n     * @param name \r\n     */\r\n    setParamsNumber(name: number, value: number): void;\r\n    setParamsNumber(name: string, value: number): void;\r\n    setParamsNumber(name: string | number, value: number) {\r\n        let id;\r\n        if (typeof name == \"number\")\r\n            id = name;\r\n        else\r\n            id = AnimatorStateCondition.conditionNameToID(name);\r\n        this._animatorParams[id] = value;\r\n    }\r\n\r\n    /**\r\n     * set params value\r\n     * @param name \r\n     */\r\n    setParamsBool(name: number, value: boolean): void;\r\n    setParamsBool(name: string, value: boolean): void;\r\n    setParamsBool(name: string | number, value: boolean) {\r\n        let id;\r\n        if (typeof name == \"number\")\r\n            id = name;\r\n        else\r\n            id = AnimatorStateCondition.conditionNameToID(name);\r\n        this._animatorParams[id] = value;\r\n    }\r\n\r\n    /**\r\n     * get params value\r\n     * @param name \r\n     */\r\n    getParamsvalue(name: number): number | boolean;\r\n    getParamsvalue(name: string): number | boolean;\r\n    getParamsvalue(name: string | number): number | boolean {\r\n        let id;\r\n        if (typeof name == \"number\")\r\n            id = name;\r\n        else\r\n            id = AnimatorStateCondition.conditionNameToID(name);\r\n        return this._animatorParams[id];\r\n    }\r\n\r\n\r\n    /**\r\n     * @deprecated animator.getControllerLayer(layerIndex).getCurrentPlayState()use animator.getControllerLayer(layerIndex).getCurrentPlayState() instead\r\n     * \r\n     * @param   layerIndex \r\n     * @return  \r\n     */\r\n    getCurrentAnimatorPlayState(layerInex: number = 0): AnimatorPlayState {\r\n        return this._controllerLayers[layerInex]._playStateInfo!;\r\n    }\r\n}\r\n\r\n\r\n","import { AniStateConditionType } from \"../../../components/AnimatorControllerParse\";\r\nimport { AnimatorStateCondition } from \"../../../components/AnimatorStateCondition\";\r\nimport { AnimatorState } from \"./AnimatorState\";\r\n\r\nexport class AnimatorTransition {\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _name: string;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _mute: boolean;//can,t play on this transition\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _exitTime: number;//\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _exitByTime: boolean;//\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _transstartoffset: number;//state\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _transduration: number;// 0-1\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _conditions: AnimatorStateCondition[];//\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _destState: AnimatorState;\r\n\r\n    /**\r\n     * Animatortransition\r\n     */\r\n    constructor() {\r\n        this._conditions = [];\r\n        this._exitByTime = true;\r\n        this._exitTime = 0.85;\r\n        this._transduration = 0.15;\r\n        this._transstartoffset = 0;\r\n        this._mute = false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get name() {\r\n        return this._name;\r\n    }\r\n\r\n    set name(value: string) {\r\n        this._name = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get mute() {\r\n        return this._mute;\r\n    }\r\n\r\n    set mute(value: boolean) {\r\n        this._mute = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get destState() {\r\n        return this._destState;\r\n    }\r\n\r\n    set destState(value: AnimatorState) {\r\n        this._destState = value;\r\n    }\r\n\r\n    /**\r\n     * condition\r\n     * IDE\r\n     */\r\n    get conditions() {\r\n        return this._conditions;\r\n    }\r\n\r\n    set conditions(value: AnimatorStateCondition[]) {\r\n        for (var i = this._conditions.length - 1; i >= 0; i--) {\r\n            this.removeCondition(this._conditions[i]);\r\n        }\r\n\r\n        for (var i = 0; i < value.length; i++) {\r\n            this.addCondition(value[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get exitByTime() {\r\n        return this._exitByTime;\r\n    }\r\n\r\n    set exitByTime(value: boolean) {\r\n        this._exitByTime = value;\r\n    }\r\n\r\n    /**\r\n     * State\r\n     */\r\n    set transduration(value: number) {\r\n        this._transduration = Math.max(0, Math.min(value, 1.0));\r\n    }\r\n\r\n    get transduration() {\r\n        return this._transduration;\r\n    }\r\n\r\n\r\n    /**\r\n    * State\r\n    */\r\n    set transstartoffset(value: number) {\r\n        this._transstartoffset = Math.max(0, Math.min(value, 1.0));\r\n    }\r\n\r\n    get transstartoffset() {\r\n        return this._transstartoffset;\r\n    }\r\n\r\n    /**\r\n    * \r\n    */\r\n    set exitTime(value: number) {\r\n        this._exitTime = Math.max(0, Math.min(value, 1.0));\r\n    }\r\n\r\n    get exitTime() {\r\n        return this._exitTime;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param condition \r\n     */\r\n    addCondition(condition: AnimatorStateCondition): void {\r\n        if (this._conditions.indexOf(condition) == -1) {\r\n            this._conditions.push(condition);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param condition \r\n     */\r\n    removeCondition(condition: AnimatorStateCondition): void {\r\n        let index = this._conditions.indexOf(condition);\r\n        if (index != -1) {\r\n            this._conditions.splice(index, 0);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param normalizeTime \r\n     * @param paramsMap \r\n     */\r\n    check(normalizeTime: number, paramsMap: { [key: number]: number | boolean }): boolean {\r\n        if (this._mute) {\r\n            return false;\r\n        }\r\n        if (this._conditions.length == 0) {\r\n            if (normalizeTime >= this._exitTime)\r\n                return true;\r\n        } else {\r\n            if (this._exitByTime && normalizeTime < this._exitTime) {\r\n                return false;\r\n            }\r\n            for (var i = 0; i < this._conditions.length; i++) {\r\n                let con = this._conditions[i];\r\n                let out = con.checkState(paramsMap[con.id]);\r\n                if (out) {\r\n                    if (con.type == AniStateConditionType.Trigger)\r\n                        paramsMap[con.id] = false;\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n}","import { AnimatorControllerParse, AniParmType, TypeAnimatorConditions, TypeAnimatorControllerData, TypeAnimatorParams, TypeAnimatorState, TypeAnimatorTransition } from \"../../../components/AnimatorControllerParse\";\r\nimport { AnimatorStateCondition, AnimatorStateBoolCondition, AnimatorStateNumberCondition, AnimatorStateTriggerCondition } from \"../../../components/AnimatorStateCondition\";\r\nimport { Resource } from \"../../../resource/Resource\";\r\nimport { ClassUtils } from \"../../../utils/ClassUtils\";\r\nimport { Animator } from \"./Animator\";\r\nimport { AnimatorControllerLayer } from \"./AnimatorControllerLayer\";\r\nimport { AnimatorState } from \"./AnimatorState\";\r\nimport { AnimatorTransition } from \"./AnimatorTransition\";\r\nimport { AvatarMask } from \"./AvatarMask\";\r\n\r\nexport class AnimatorController extends Resource {\r\n    data: TypeAnimatorControllerData;\r\n    clipsID: string[];\r\n    constructor(data: any) {\r\n        super();\r\n        let obj = AnimatorControllerParse.parse(data);\r\n        this.data = obj.ret;\r\n        this.clipsID = obj.clipsID;\r\n    }\r\n\r\n    private getLayers() {\r\n        let layers = this.data.controllerLayers;\r\n        let lArr: AnimatorControllerLayer[] = [];\r\n        for (let i = layers.length - 1; i >= 0; i--) {\r\n            let l = layers[i];\r\n            let acl = new AnimatorControllerLayer(l.name);\r\n            if (l.avatarMask) {\r\n                acl.avatarMask = l.avatarMask;\r\n            }\r\n            lArr.unshift(acl);\r\n            for (let k in l) {\r\n                if (\"avatarMask\" == k || \"name\" == k || \"states\" == k || null == (l as any)[k]) {\r\n                    continue;\r\n                }\r\n                try {\r\n                    (acl as any)[k] = (l as any)[k];\r\n                } catch (err: any) { }\r\n            }\r\n            this.getState(l.states, acl, this.data);\r\n        }\r\n        return lArr;\r\n    }\r\n\r\n    updateTo(a: Animator) {\r\n        let currLayer = (a as any)._controllerLayers;\r\n\r\n        for (let i = 0, len = currLayer.length; i < len; i++) {\r\n            currLayer[i]._removeReference();\r\n        }\r\n        currLayer.length = 0;\r\n\r\n        let layers = this.getLayers();\r\n\r\n        for (let i = 0, len = layers.length; i < len; i++) {\r\n            a.addControllerLayer(layers[i]);\r\n        }\r\n        let parms = this.data.animatorParams;\r\n        if (parms) {\r\n            for (let i = parms.length - 1; i >= 0; i--) {\r\n                let p = parms[i];\r\n                if (AniParmType.Bool == p.type) {\r\n                    a.setParamsBool(p.name, Boolean(p.val));\r\n                } else if (AniParmType.Float == p.type) {\r\n                    let val = Number(p.val);\r\n                    if (isNaN(val)) {\r\n                        val = 0;\r\n                    }\r\n                    a.setParamsNumber(p.name, val);\r\n                } else if (AniParmType.Trigger == p.type) {\r\n                    if (p.val) {\r\n                        a.setParamsTrigger(p.name);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private createState(states: TypeAnimatorState[], idCatch: Record<string, AnimatorState>, acl: AnimatorControllerLayer) {\r\n        if (!states) return null;\r\n        let ret: Record<string, AnimatorState> = {};\r\n        let defID: string = null;\r\n        for (let i = states.length - 1; i >= 0; i--) {\r\n            let obj = states[i];\r\n\r\n            let childStates = obj.states;\r\n\r\n            if (childStates) {\r\n                let groupRet = this.createState(childStates, idCatch, acl);\r\n\r\n                if (groupRet) {\r\n                    idCatch[obj.id] = groupRet.states[groupRet.id];\r\n                }\r\n                continue;\r\n            }\r\n            if (0 > Number(obj.id)) {\r\n                if (\"-1\" == obj.id) {\r\n                    let transitions = obj.soloTransitions;\r\n                    if (transitions && 0 < transitions.length) {\r\n                        defID = transitions[0].id;\r\n                    }\r\n                }\r\n                continue;\r\n            }\r\n            let state = new AnimatorState();\r\n            idCatch[obj.id] = state;\r\n            ret[obj.id] = state;\r\n            for (let k in obj) {\r\n                try {\r\n                    if (\"scripts\" == k) {\r\n                        let scripts: string[] = obj[k];\r\n                        if (scripts && Array.isArray(scripts)) {\r\n                            for (let k = scripts.length - 1; k >= 0; k--) {\r\n                                let uuid = scripts[k];\r\n                                if (uuid && 0 == uuid.indexOf(\"res://\")) {\r\n                                    uuid = uuid.substring(6);\r\n                                }\r\n                                let c = ClassUtils.getClass(uuid);\r\n                                if (c) {\r\n                                    state.addScript(c);\r\n                                }\r\n                            }\r\n                        }\r\n                        continue;\r\n                    } else if (\"soloTransitions\" == k) {\r\n                        continue;\r\n                    } else if (null != (obj as any)[k]) {\r\n                        (state as any)[k] = (obj as any)[k];\r\n                    }\r\n                } catch (err: any) { }\r\n            }\r\n            acl.addState(state);\r\n        }\r\n        return { id: defID, states: ret };\r\n    }\r\n\r\n\r\n    private setExitTransition(exitRet: Record<string, TypeAnimatorTransition[]>, transitions: TypeAnimatorTransition[], idCatch: Record<string, AnimatorState>, data: TypeAnimatorControllerData, pExitRet: Record<string, TypeAnimatorTransition[]>) {\r\n        for (let id in exitRet) {\r\n            let state = idCatch[id];\r\n            if (state) {\r\n                let ats: AnimatorTransition[] = state.transitions;\r\n                let sts: AnimatorTransition[] = state.soloTransitions;\r\n                let linArr = exitRet[id];\r\n                for (let i = transitions.length - 1; i >= 0; i--) {\r\n                    let t = transitions[i];\r\n                    if (\"-3\" == t.id) {\r\n                        if (null == pExitRet[id]) {\r\n                            pExitRet[id] = [];\r\n                        }\r\n                        pExitRet[id].push(t);\r\n                        continue;\r\n                    }\r\n                    for (let j = linArr.length - 1; j >= 0; j--) {\r\n                        let t2 = linArr[j];\r\n                        let ato = new AnimatorTransition();\r\n                        ato.destState = idCatch[t.id];\r\n                        if (t.conditions) {\r\n                            this.addConditions(t.conditions, ato, data);\r\n                        }\r\n                        if (t2.conditions) {\r\n                            this.addConditions(t2.conditions, ato, data);\r\n                        }\r\n                        for (let k in t) {\r\n                            if (\"solo\" == k || \"id\" == k || \"conditions\" == k) {\r\n                                continue;\r\n                            } else {\r\n                                (ato as any)[k] = (t as any)[k];\r\n                            }\r\n                        }\r\n                        if (t.solo) {\r\n                            sts.unshift(ato);\r\n                        } else {\r\n                            ats.unshift(ato);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    private setTransitions(states: TypeAnimatorState[], idCatch: Record<string, AnimatorState>, acl: AnimatorControllerLayer, data: TypeAnimatorControllerData, pState?: TypeAnimatorState) {\r\n        if (!states) return null;\r\n        let exitRet: Record<string, TypeAnimatorTransition[]> = {};\r\n        for (let i = states.length - 1; i >= 0; i--) {\r\n            let obj = states[i];\r\n            if (obj.states) {\r\n                let exitTransition = this.setTransitions(obj.states, idCatch, acl, data, obj);\r\n                if (exitTransition) {\r\n                    let transitions = obj.soloTransitions;\r\n                    if (transitions) {\r\n                        this.setExitTransition(exitTransition, transitions, idCatch, data, exitRet);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let i = states.length - 1; i >= 0; i--) {\r\n            let obj = states[i];\r\n            if (obj.states) {\r\n                continue;\r\n            }\r\n            if (\"-1\" == obj.id) {\r\n                if (obj.soloTransitions && 0 < obj.soloTransitions.length) {\r\n                    if (null == pState) {\r\n                        acl.defaultState = idCatch[obj.soloTransitions[0].id];\r\n                    } else {\r\n                        idCatch[pState.id] = idCatch[obj.soloTransitions[0].id];\r\n                    }\r\n                    continue;\r\n                }\r\n            } else if (\"-2\" == obj.id) {\r\n                let transitions = obj.soloTransitions;\r\n                if (transitions) {\r\n                    for (let j = transitions.length - 1; j >= 0; j--) {\r\n                        let o = transitions[j];\r\n                        let destState = idCatch[o.id];\r\n                        if (destState) {\r\n                            for (let idk in idCatch) {\r\n                                let state = idCatch[idk];\r\n                                let ato = new AnimatorTransition();\r\n                                ato.destState = destState;\r\n                                if (o.conditions) {\r\n                                    this.addConditions(o.conditions, ato, data);\r\n                                }\r\n\r\n                                for (let k in o) {\r\n                                    if (\"solo\" == k || \"id\" == k || \"conditions\" == k) {\r\n                                        continue;\r\n                                    } else {\r\n                                        (ato as any)[k] = (o as any)[k];\r\n                                    }\r\n                                }\r\n\r\n                                if (o.solo) {\r\n                                    state.soloTransitions.unshift(ato);\r\n                                } else {\r\n                                    state.transitions.unshift(ato);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                continue;\r\n            } else if (\"-3\" == obj.id) {\r\n                continue;\r\n            }\r\n            let soloTransitions = obj.soloTransitions;\r\n            if (soloTransitions && idCatch[obj.id]) {\r\n                let ats: AnimatorTransition[] = idCatch[obj.id].transitions;\r\n                let sts: AnimatorTransition[] = idCatch[obj.id].soloTransitions;\r\n                for (let j = soloTransitions.length - 1; j >= 0; j--) {\r\n                    let o = soloTransitions[j];\r\n                    if (\"-3\" == o.id) {\r\n                        if (null == exitRet[obj.id]) {\r\n                            exitRet[obj.id] = [];\r\n                        }\r\n                        exitRet[obj.id].push(o);\r\n                        continue;\r\n                    }\r\n\r\n                    let ato = new AnimatorTransition();\r\n\r\n                    if (idCatch[o.id]) {\r\n                        ato.destState = idCatch[o.id];\r\n                    }\r\n                    if (o.conditions) {\r\n                        this.addConditions(o.conditions, ato, data);\r\n                    }\r\n                    for (let k in o) {\r\n                        if (\"solo\" == k || \"id\" == k || \"conditions\" == k) {\r\n                            continue;\r\n                        } else {\r\n                            (ato as any)[k] = (o as any)[k];\r\n                        }\r\n                    }\r\n                    if (o.solo) {\r\n                        sts.unshift(ato);\r\n                    } else {\r\n                        ats.unshift(ato);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return exitRet;\r\n    }\r\n\r\n    private getState(states: TypeAnimatorState[], acl: AnimatorControllerLayer, data: TypeAnimatorControllerData) {\r\n        if (states) {\r\n            let idCatch: Record<string, AnimatorState> = {};\r\n            this.createState(states, idCatch, acl);\r\n            this.setTransitions(states, idCatch, acl, data);\r\n        }\r\n    }\r\n\r\n    private addConditions(arr: TypeAnimatorConditions[], ato: AnimatorTransition, data: TypeAnimatorControllerData) {\r\n        let parms = data.animatorParams;\r\n        if (null == parms || 0 == parms.length) return;\r\n        for (let i = 0, len = arr.length; i < len; i++) {\r\n            let o = arr[i];\r\n            let parm: TypeAnimatorParams = null;\r\n            for (let j = parms.length - 1; j >= 0; j--) {\r\n                if (parms[j].id == o.id) {\r\n                    parm = parms[j];\r\n                    break;\r\n                }\r\n            }\r\n            if (null == parm) {\r\n                return;\r\n            }\r\n            let c: AnimatorStateCondition;\r\n            if (parm.type == AniParmType.Bool) {\r\n                let b = new AnimatorStateBoolCondition(parm.name);\r\n                b.compareFlag = Boolean(o.checkValue);\r\n                c = b;\r\n            } else if (parm.type == AniParmType.Float) {\r\n                let n = new AnimatorStateNumberCondition(parm.name);\r\n                n.numberValue = Number(o.checkValue);\r\n                n.compareFlag = o.type;\r\n                c = n;\r\n            } else if (parm.type == AniParmType.Trigger) {\r\n                let t = new AnimatorStateTriggerCondition(parm.name);\r\n                c = t;\r\n            }\r\n            ato.addCondition(c);\r\n        }\r\n    }\r\n}","/**\r\n * @internal\r\n */\r\nexport class BatchMark {\r\n\t/**@internal */\r\n\tupdateMark: number = -1;\r\n\t/**@internal */\r\n\tindexInList: number = -1;\r\n\t/**@internal */\r\n\tbatched: boolean = false;\r\n}\r\n\r\n","import { BatchMark } from \"../../core/render/BatchMark\";\r\n/**\r\n * @internal\r\n */\r\nexport class InstanceBatchManager {\r\n    /** @internal */\r\n    static instance = new InstanceBatchManager();\r\n    /**@internal */\r\n    private _instanceBatchOpaqueMarks: any[] = [];\r\n    /**@internal []*/\r\n    updateCountMark: number = 0;\r\n    constructor() {\r\n    }\r\n\r\n    /**\r\n     * get batch index\r\n     */\r\n    private _getData<T>(key: boolean | number, data: any, cls?: new () => T): T {\r\n        if (null == cls) {\r\n            cls = Array as any;\r\n        }\r\n        if (\"boolean\" == typeof key) {\r\n            return (data[key ? 0 : 1]) || (data[key ? 0 : 1] = new cls());\r\n        } else {\r\n            return data[key] || (data[key] = new cls());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * get batchMark by render property\r\n     * @param receiveShadow \r\n     * @param materialID \r\n     * @param subMeshID \r\n     * @param invertFace \r\n     * @param lightmapIndex \r\n     * @returns \r\n     */\r\n    getInstanceBatchOpaquaMark(receiveShadow: boolean, materialID: number, subMeshID: number, invertFace: boolean, reflectionprob: number, lightmapIndex: number): BatchMark {\r\n        var data = this._getData(receiveShadow, this._instanceBatchOpaqueMarks);\r\n        data = this._getData(materialID, data);\r\n        data = this._getData(subMeshID, data);\r\n        data = this._getData(invertFace, data);\r\n        data = this._getData(lightmapIndex, data);\r\n        return this._getData(reflectionprob, data, BatchMark);\r\n\r\n    }\r\n}","import { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { Camera } from \"../../../core/Camera\";\r\nimport { BaseRender, RenderBitFlag } from \"../../../core/render/BaseRender\";\r\nimport { InstanceRenderElement } from \"../../../core/render/InstanceRenderElement\";\r\nimport { Scene3D } from \"../../../core/scene/Scene3D\";\r\nconst tempVec = new Vector3();\r\nconst tempVec1 = new Vector3();\r\n/**\r\n * \r\n */\r\nexport class BatchRender extends BaseRender {\r\n    /**@internal */\r\n    protected _checkLOD: boolean;\r\n    protected _lodCount: number;\r\n    protected _lodRateArray: number[];\r\n    protected _batchList: SingletonList<BaseRender>;\r\n    protected _batchbit: RenderBitFlag;\r\n    protected _RenderBitFlag: RenderBitFlag;\r\n    protected _lodInstanceRenderElement: { [key: number]: InstanceRenderElement[] } = {};\r\n    protected _lodsize: number;\r\n    private _cacheLod: number;\r\n\r\n    /**\r\n     *  <code>BatchRender</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._RenderBitFlag = RenderBitFlag.RenderBitFlag_Batch;\r\n        this._renderElements = [];\r\n        this._lodInstanceRenderElement[-1] = [];\r\n        this._batchList = new SingletonList<BaseRender>();\r\n    }\r\n\r\n    /**\r\n     * lod\r\n     */\r\n    get checkLOD() {\r\n        return this._checkLOD;\r\n    }\r\n\r\n    set checkLOD(value: boolean) {\r\n        this._checkLOD = value;\r\n    }\r\n\r\n    /**\r\n     * lod\r\n     */\r\n    set lodCullRateArray(value: number[]) {\r\n        if (!this._checkLOD) {\r\n            return;\r\n        }\r\n        value.sort((a, b) => b - a);\r\n        this._lodRateArray = value;\r\n    }\r\n\r\n    get lodCullRateArray() {\r\n        return this._lodRateArray;\r\n    }\r\n\r\n\r\n    /**\r\n     * Overrid it\r\n     *  batch\r\n     */\r\n    protected _canBatch(render: BaseRender): boolean {\r\n        if (render._batchRender) {\r\n            return false;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n        if (this._batchList) {\r\n            for (let i = 0, n = this._batchList.length; i < n; i++) {\r\n                this._batchList.elements[i].setRenderbitFlag(this._RenderBitFlag, true);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _onDisable(): void {\r\n        super._onDisable();\r\n        if (this._batchList) {\r\n            for (let i = 0, n = this._batchList.length; i < n; i++) {\r\n                this._batchList.elements[i].setRenderbitFlag(this._RenderBitFlag, false);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * lod\r\n     */\r\n    protected _changeLOD(lod: number) {\r\n        if (this._cacheLod == lod) {\r\n            return;\r\n        }\r\n\r\n        if(this._cacheLod == this.lodCullRateArray.length - 1)\r\n        {\r\n            lod = -1;\r\n        }\r\n        \r\n        this._renderElements = this._lodInstanceRenderElement[lod];\r\n        if (this._lodInstanceRenderElement[lod] && lod != -1) {\r\n            this._renderElements || (this._renderElements = []);\r\n            this._renderElements = this._renderElements.concat(this._lodInstanceRenderElement[-1]);\r\n        } else {\r\n            this._renderElements = this._lodInstanceRenderElement[-1];\r\n        }\r\n\r\n    }\r\n\r\n    onPreRender() {\r\n        if (!this.checkLOD || !this._lodRateArray || this._lodRateArray.length < 1) {\r\n            this._changeLOD(0);\r\n        } else {\r\n            let checkCamera = (this.owner.scene as Scene3D).cullInfoCamera as Camera;\r\n            let maxYDistance = checkCamera.maxlocalYDistance;\r\n            Vector3.subtract(this._bounds.getCenter(), checkCamera.transform.position, tempVec);\r\n            //farplane,.lod\r\n            let length = tempVec.length();\r\n            let rateYDistance = length / checkCamera.farPlane * maxYDistance;\r\n            let rate = (this._lodsize / rateYDistance);\r\n            for (let i = 0; i < this._lodRateArray.length; i++) {\r\n                if (rate < this._lodRateArray[i])\r\n                    continue;\r\n                this._changeLOD(i);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param render \r\n     */\r\n    _batchOneRender(render: BaseRender): boolean {\r\n        //TODO\r\n        return false\r\n    }\r\n\r\n    /**\r\n     * @param render \r\n     */\r\n    _removeOneRender(render: BaseRender) {\r\n        //TODO\r\n    }\r\n\r\n    /**\r\n     * @param render \r\n     */\r\n    _updateOneRender(render: BaseRender) {\r\n        //TODO\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param renderNodes \r\n     */\r\n    addList(renderNode: BaseRender[]) {\r\n        for (var i = 0, n = renderNode.length; i < n; i++) {\r\n            let baseRender = renderNode[i];\r\n            if (this._canBatch(baseRender)) {\r\n                this._batchList.add(baseRender);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * _batchList\r\n     */\r\n    reBatch() {\r\n        let renderNums = this._batchList.length;\r\n        let renders = this._batchList.elements;\r\n        for (var i = 0; i < renderNums; i++) {\r\n            let render = renders[i];\r\n            this._batchOneRender(render);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Restoring the Batch Render State\r\n     */\r\n    _restorRenderNode() {\r\n        for (let i = 0, n = this._batchList.length; i < n; i++) {\r\n            this._removeOneRender(this._batchList.elements[i]);\r\n        }\r\n    }\r\n\r\n    _clear() {\r\n        this._restorRenderNode();\r\n        this._renderElements = [];\r\n        this._batchList.destroy();\r\n        this._batchList = new SingletonList<BaseRender>();\r\n        this._lodInstanceRenderElement = {};\r\n        this._lodInstanceRenderElement[-1] = [];\r\n\r\n    }\r\n}","import { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { BaseRender, RenderBitFlag } from \"../../../core/render/BaseRender\";\r\nimport { BatchMark } from \"../../../core/render/BatchMark\";\r\nimport { InstanceRenderElement } from \"../../../core/render/InstanceRenderElement\";\r\nimport { RenderElement } from \"../../../core/render/RenderElement\";\r\nimport { InstanceBatchManager } from \"../../../graphics/Batch/InstanceBatchManager\";\r\nimport { MeshInstanceGeometry } from \"../../../graphics/MeshInstanceGeometry\";\r\nimport { Bounds } from \"../../../math/Bounds\";\r\nimport { SubMesh } from \"../../../resource/models/SubMesh\";\r\nimport { BatchRender } from \"./BatchRender\";\r\n\r\n/**\r\n * <code>StaticInstanceBatchRender</code> \r\n */\r\nexport class StaticInstanceBatchRender extends BatchRender {\r\n\r\n    /**@internal instanceBatchManager*/\r\n    private _batchManager: InstanceBatchManager;\r\n\r\n    /**@internal  BatchMaskInstance*/\r\n    private _insBatchMarksNums: number[] = [];\r\n\r\n    /**@interal */\r\n    private _insElementMarksArray: InstanceRenderElement[] = [];\r\n\r\n    /**@interal batch rule:Batch min count*/\r\n    private _instanceBatchminNums: number = 10;\r\n\r\n    /**@interal cache udpate element*/\r\n    private _updateChangeElement: InstanceRenderElement[] = [];\r\n\r\n    /**\r\n     *  <code>StaticInstanceBatchRender</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this.checkLOD = true;\r\n        this._batchManager = new InstanceBatchManager();\r\n        this._RenderBitFlag = RenderBitFlag.RenderBitFlag_InstanceBatch;\r\n    }\r\n\r\n    /**\r\n     * RenderInstanceBatch\r\n     * @param render \r\n     * @returns \r\n     */\r\n    private _isRenderNodeAllCanInstanceBatch(render: BaseRender): boolean {\r\n        let elements = render._renderElements;\r\n        for (var i = 0, n = elements.length; i < n; i++) {\r\n            let element = elements[i];\r\n            if (!element.material._shader._enableInstancing) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Instance\r\n     * @param render \r\n     */\r\n    private _sumInstanceBatch(render: BaseRender) {\r\n        let elements = render._renderElements;\r\n        for (var i = 0, n = elements.length; i < n; i++) {\r\n            let element = elements[i];\r\n            var insBatchMarks = this._batchManager.getInstanceBatchOpaquaMark(element.render.receiveShadow, element.material.id, element._geometry._id, element.transform ? element.transform._isFrontFaceInvert : false, element.render._probReflection ? element.render._probReflection.id : -1, element.render.lightmapIndex);\r\n            if (insBatchMarks.indexInList == -1) {\r\n                insBatchMarks.indexInList = this._insBatchMarksNums.length;\r\n                this._insBatchMarksNums.push(0);\r\n            }\r\n            this._insBatchMarksNums[insBatchMarks.indexInList] += 1;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * batch one element\r\n     * @param element \r\n     * @param render \r\n     * @returns \r\n     */\r\n    private _batchOneElement(element: RenderElement, render: BaseRender) {\r\n        var insBatchMarks = this._batchManager.getInstanceBatchOpaquaMark(element.render.receiveShadow, element.material.id, element._geometry._id, element.transform ? element.transform._isFrontFaceInvert : false, element.render._probReflection ? element.render._probReflection.id : -1, element.render.lightmapIndex);\r\n        if (insBatchMarks.indexInList == -1)\r\n            return;\r\n        let instanceelement: InstanceRenderElement = this._insElementMarksArray[insBatchMarks.indexInList];\r\n        if (!instanceelement) {\r\n            instanceelement = this._createInstanceElement(element, render, insBatchMarks);\r\n        }\r\n        let list = instanceelement._instanceBatchElementList;\r\n        if (list.length == InstanceRenderElement.maxInstanceCount) {\r\n            this._insBatchMarksNums.push(this._insBatchMarksNums[insBatchMarks.indexInList]);\r\n            insBatchMarks.indexInList = this._insBatchMarksNums.length - 1;\r\n            instanceelement = this._createInstanceElement(element, render, insBatchMarks);\r\n            list = instanceelement._instanceBatchElementList;\r\n        }\r\n        if (list.indexof(element) == -1) {\r\n            list.add(element);\r\n            instanceelement._isUpdataData = true;\r\n            (this._updateChangeElement.indexOf(instanceelement) == -1) && this._updateChangeElement.push(instanceelement);\r\n            element._batchElement = instanceelement;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * remove one element\r\n     * @param element \r\n     * @param render \r\n     * @returns \r\n     */\r\n    private _removeOneElement(element: RenderElement, render: BaseRender) {\r\n        var insBatchMarks = this._batchManager.getInstanceBatchOpaquaMark(element.render.receiveShadow, element.material.id, element._geometry._id, element.transform ? element.transform._isFrontFaceInvert : false, element.render._probReflection ? element.render._probReflection.id : -1, element.render.lightmapIndex);\r\n        if (insBatchMarks.indexInList == -1)\r\n            return;\r\n        let instanceelement: InstanceRenderElement = element._batchElement as InstanceRenderElement;\r\n        if (!instanceelement || this._renderElements.indexOf(instanceelement) == -1) {\r\n            return;\r\n        }\r\n        let list = instanceelement._instanceBatchElementList;\r\n        if (list.indexof(element) != -1) {\r\n            list.remove(element);\r\n            instanceelement._isUpdataData = true;\r\n            (this._updateChangeElement.indexOf(instanceelement) == -1) && this._updateChangeElement.push(instanceelement);\r\n            element._batchElement = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * update one element\r\n     * @param element \r\n     * @param render \r\n     * @returns \r\n     */\r\n    private _updateOneElement(element: RenderElement, render: BaseRender) {\r\n        let instanceelement: InstanceRenderElement = element._batchElement as InstanceRenderElement;\r\n        if (!instanceelement || this._renderElements.indexOf(instanceelement) == -1) {\r\n            return;\r\n        }\r\n        let list = instanceelement._instanceBatchElementList;\r\n        if (list.indexof(element) != -1) {\r\n            instanceelement._isUpdataData = true;\r\n            (this._updateChangeElement.indexOf(instanceelement) == -1) && this._updateChangeElement.push(instanceelement);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * create instanceElement\r\n     * @param element \r\n     * @param render \r\n     * @param batchMark \r\n     * @returns \r\n     */\r\n    private _createInstanceElement(element: RenderElement, render: BaseRender, batchMark: BatchMark) {\r\n        let instanceRenderElement = new InstanceRenderElement();\r\n        instanceRenderElement.render = render;\r\n        instanceRenderElement.renderType = RenderElement.RENDERTYPE_INSTANCEBATCH;\r\n        //Geometry updaste\r\n        (instanceRenderElement._geometry as MeshInstanceGeometry).subMesh = (element._geometry as SubMesh);\r\n        instanceRenderElement.material = element.material;\r\n        instanceRenderElement.setTransform(null);\r\n        instanceRenderElement.renderSubShader = element.renderSubShader;\r\n        let list = instanceRenderElement._instanceBatchElementList;\r\n        list.length = 0;\r\n        list.add(element);\r\n        this._insElementMarksArray[batchMark.indexInList] = instanceRenderElement;\r\n        batchMark.batched = true;\r\n        if (!this._lodInstanceRenderElement[render._LOD]) {\r\n            this._lodInstanceRenderElement[render._LOD] = [];\r\n        }\r\n        this._lodInstanceRenderElement[render._LOD].push(instanceRenderElement);\r\n        return instanceRenderElement;\r\n    }\r\n\r\n    /**\r\n     * batch\r\n     * @override\r\n     * @param render \r\n     * @returns \r\n     */\r\n    protected _canBatch(render: BaseRender): boolean {\r\n        let elements = render._renderElements;\r\n        for (var i = 0, n = elements.length; i < n; i++) {\r\n            let element = elements[i];\r\n            var insBatchMarks = this._batchManager.getInstanceBatchOpaquaMark(element.render.receiveShadow, element.material.id, element._geometry._id, element.transform ? element.transform._isFrontFaceInvert : false, element.render._probReflection ? element.render._probReflection.id : -1, element.render.lightmapIndex);\r\n            if (this._insBatchMarksNums[insBatchMarks.indexInList] < this._instanceBatchminNums || element.material.renderQueue >= 3000) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @internal\r\n     * \r\n     */\r\n    protected _calculateBoundingBox() {\r\n        let bound = this._bounds;\r\n        for (let i = 0, n = this._batchList.length; i < n; i++) {\r\n            if (i == 0) {\r\n                this._batchList.elements[i].bounds.cloneTo(bound);\r\n            } else {\r\n                Bounds.merge(bound, this._batchList.elements[i].bounds, bound);\r\n            }\r\n        }\r\n        let extend = this._bounds.getExtent();\r\n        this._lodsize = 2 * Math.max(extend.x, extend.y, extend.z);\r\n        return this._bounds;\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    protected _onDestroy() {\r\n        super._onDestroy();\r\n    }\r\n\r\n    /**\r\n     * render\r\n     * @param render \r\n     * @internal\r\n     * @returns \r\n     */\r\n    _batchOneRender(render: BaseRender) {\r\n        if (!this._canBatch(render)) return false;\r\n        this.boundsChange = true;\r\n        let elements = render._renderElements;\r\n        for (let i = 0, n = elements.length; i < n; i++) {\r\n            let renderelement = elements[i];\r\n            this._batchOneElement(renderelement, render);\r\n        }\r\n        render._batchRender = this;\r\n        render.setRenderbitFlag(RenderBitFlag.RenderBitFlag_InstanceBatch, true);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @Override\r\n     * @internal\r\n     * @param render \r\n     * @returns \r\n     */\r\n    _removeOneRender(render: BaseRender) {\r\n        if (!this._canBatch(render)) return;\r\n        if (this._batchList.indexof(render) != -1) {\r\n            this.boundsChange = true;\r\n            let elements = render._renderElements;\r\n            for (let i = 0, n = elements.length; i < n; i++) {\r\n                let renderelement = elements[i];\r\n                this._removeOneElement(renderelement, render);\r\n            }\r\n            render._batchRender = null;\r\n            render.setRenderbitFlag(RenderBitFlag.RenderBitFlag_InstanceBatch, false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @override\r\n     * @internal\r\n     * @param render \r\n     * @returns \r\n     */\r\n    _updateOneRender(render: BaseRender) {\r\n        if (!this._canBatch(render)) return;\r\n        if (this._batchList.indexof(render) != -1) {\r\n            this.boundsChange = true;\r\n            let elements = render._renderElements;\r\n            for (let i = 0, n = elements.length; i < n; i++) {\r\n                let renderelement = elements[i];\r\n                this._updateOneElement(renderelement, render);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    _clear() {\r\n        super._clear();\r\n        this._insElementMarksArray.forEach(element => {\r\n            element && element.destroy();\r\n        });\r\n\r\n        this._insElementMarksArray = [];\r\n        this._updateChangeElement = [];\r\n        this._insBatchMarksNums = [];\r\n    }\r\n\r\n\r\n\r\n    /**\r\n    * \r\n    * @param renderNodes\r\n    */\r\n    addList(renderNodes: BaseRender[]) {\r\n        if (!this._batchList) {\r\n            this._batchList = new SingletonList<BaseRender>();\r\n        }\r\n        let renders: BaseRender[] = [];\r\n        for (var i = 0; i < renderNodes.length; i++) {\r\n            let baseRender = renderNodes[i];\r\n            if (baseRender._batchRender) {\r\n                continue;\r\n            }\r\n            if (this._isRenderNodeAllCanInstanceBatch(baseRender)) {\r\n                // this._batchList.add(baseRender);\r\n                renders.push(baseRender);\r\n                this._sumInstanceBatch(baseRender);\r\n            }\r\n        }\r\n        for (var i = 0, n = renders.length; i < n; i++) {\r\n            let baseRender = renders[i];\r\n            if (this._canBatch(baseRender)) {\r\n                this._batchList.add(baseRender);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * _batchList\r\n     */\r\n    reBatch() {\r\n        let renderNums = this._batchList.length;\r\n        let renders = this._batchList.elements;\r\n        for (var i = 0; i < renderNums; i++) {\r\n            let render = renders[i];\r\n            this._batchOneRender(render);\r\n        }\r\n    }\r\n\r\n}","import { BaseRender } from \"../../../core/render/BaseRender\";\r\nimport { BatchRender } from \"./BatchRender\";\r\n\r\nexport class StatiVertexMergeBatchRender extends BatchRender {\r\n    \r\n    //TODO \r\n    _addList(renderNodes: BaseRender[]) {\r\n        //TODO  add list\r\n    }\r\n}","import { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { BaseRender } from \"../../../core/render/BaseRender\";\r\nimport { Sprite3D, StaticFlag } from \"../../../core/Sprite3D\";\r\nimport { Volume } from \"../Volume\";\r\nimport { BatchRender } from \"./BatchRender\";\r\nimport { StaticInstanceBatchRender } from \"./StaticInstanceBatchRender\";\r\nimport { StatiVertexMergeBatchRender } from \"./StatiVertexMergeBatchRender\";\r\n\r\n/**\r\n * \r\n */\r\nexport class StaticBatchVolume extends Volume {\r\n\r\n    /**@internal */\r\n    private _cacheRender: SingletonList<BaseRender>;\r\n\r\n    /**@internal BaseRender */\r\n    private _batchRender: SingletonList<BaseRender>;\r\n\r\n    /**@internal LOD */\r\n    private _checkLOD: boolean;//LOD\r\n\r\n    /** StaticInstanceBatch */\r\n    /**@internal Instance */\r\n    private _enableStaticInstanceBatch: boolean;\r\n\r\n    /**@internal Instance */\r\n    private _instanceBatchRender: StaticInstanceBatchRender;\r\n\r\n    /**StaticVertexMergeBatch */\r\n    /**@internal  TODO */\r\n    private _enableStaticVertexMergeBatch: boolean;\r\n\r\n    /**@internal   TODO*/\r\n    private _vertexMergeBatchRender: StatiVertexMergeBatchRender;\r\n\r\n    /**@internal CustomBatchbatch*/\r\n    private _enableCustomBatch: boolean;\r\n\r\n    /**@internal */\r\n    private _customBatchs: BatchRender[] = [];\r\n\r\n    /**\r\n     * @internal\r\n     * @returns \r\n     */\r\n    private _getStaticInstanceBatchRender(): StaticInstanceBatchRender {\r\n        let render = (this.owner as Sprite3D).getComponent(StaticInstanceBatchRender);\r\n        if (!render) {\r\n            render = (this.owner as Sprite3D).addComponent(StaticInstanceBatchRender) as StaticInstanceBatchRender;\r\n        }\r\n        return render;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @returns \r\n     */\r\n    private _getStatiVertexMergeBatchRender(): StatiVertexMergeBatchRender {\r\n        let render = (this.owner as Sprite3D).getComponent(StatiVertexMergeBatchRender);\r\n        if (!render) {\r\n            render = (this.owner as Sprite3D).addComponent(StatiVertexMergeBatchRender) as StatiVertexMergeBatchRender;\r\n        }\r\n        return render;\r\n    }\r\n\r\n    /**\r\n     * LOD\r\n     */\r\n    get checkLOD(): boolean {\r\n        return this._checkLOD;\r\n    }\r\n\r\n    set checkLOD(value: boolean) {\r\n        this._checkLOD = value;\r\n        if (this._enableStaticInstanceBatch) {\r\n            this._instanceBatchRender.checkLOD = value;\r\n        }\r\n        if (this._enableStaticVertexMergeBatch) {\r\n            this._vertexMergeBatchRender.checkLOD = value;\r\n        }\r\n        if (this._enableCustomBatch) {\r\n            this._customBatchs.forEach(element => {\r\n                element.checkLOD = value;\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Instance\r\n     */\r\n    get enableStaticInstanceBatchRender(): boolean {\r\n        return this._enableStaticInstanceBatch;\r\n    }\r\n\r\n    set enableStaticInstanceBatchRender(value: boolean) {\r\n        if (!this._instanceBatchRender && value) {\r\n            this._instanceBatchRender = this._getStaticInstanceBatchRender();\r\n        }\r\n        if (value == this._enableStaticInstanceBatch)\r\n            return;\r\n        if (value) {\r\n            this._instanceBatchRender.enabled = true;\r\n        } else {\r\n            this._instanceBatchRender.enabled = false;\r\n        }\r\n        this._enableStaticInstanceBatch = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get enableMergeBatchRender() {\r\n        return this._enableStaticVertexMergeBatch;\r\n    }\r\n\r\n    set enableMergeBatchRender(value: boolean) {\r\n        if (!this._vertexMergeBatchRender && value) {\r\n            this._vertexMergeBatchRender = this._getStatiVertexMergeBatchRender();\r\n        }\r\n        if (value == this._enableStaticVertexMergeBatch)\r\n            return;\r\n        if (value) {\r\n            this._vertexMergeBatchRender.enabled = true;\r\n        } else {\r\n            this._vertexMergeBatchRender.enabled = false;\r\n        }\r\n        this._enableStaticVertexMergeBatch = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get enableCustomBatchRender() {\r\n        return this._enableCustomBatch;\r\n    }\r\n\r\n    set enableCustomBatchRender(value: boolean) {\r\n        this._enableCustomBatch = value;\r\n        this._customBatchs.forEach(element => {\r\n            element.enabled = value;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * BatchRender\r\n     */\r\n    set customBatchRenders(value: BatchRender[]) {\r\n        if (this._customBatchs) {\r\n            this._customBatchs.forEach(element => {\r\n                (this.owner as Sprite3D)._destroyComponent(element);\r\n            });\r\n        }\r\n        this._customBatchs = value;\r\n        this._customBatchs.forEach(element => {\r\n            (this.owner as Sprite3D).addComponentInstance(element);\r\n        });\r\n        this.enableCustomBatchRender = this._enableCustomBatch;\r\n    }\r\n\r\n    get customBatchRenders() {\r\n        return this._customBatchs;\r\n    }\r\n\r\n    /**\r\n     * <code>BatchVolume</code>\r\n     */\r\n    constructor() {\r\n        super();\r\n        this.checkLOD = true;\r\n        this._enableStaticInstanceBatch = false;\r\n        this._enableStaticVertexMergeBatch = false;\r\n        this._cacheRender = new SingletonList<BaseRender>();\r\n        this._batchRender = new SingletonList<BaseRender>();\r\n        this._enableCustomBatch = false;\r\n    }\r\n\r\n    /**     \r\n     * Restoring the Batch Render State\r\n     */\r\n    private _restorRenderNode() {\r\n        if (this.enableCustomBatchRender) {\r\n            this._customBatchs.forEach(element => {\r\n                element._clear();\r\n            });\r\n        }\r\n        if (this._enableStaticInstanceBatch) {\r\n            this._instanceBatchRender._clear();\r\n        }\r\n        if (this.enableCustomBatchRender) {\r\n            this._vertexMergeBatchRender._clear();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * add one RenderNode\r\n     * @param renderNode \r\n     * @returns \r\n     */\r\n    private __addRenderNodeToBatch(renderNode: BaseRender) {\r\n        //\r\n        if (this.enableCustomBatchRender) {\r\n            this._customBatchs.forEach(element => {\r\n                if (element._batchOneRender(renderNode)) return;\r\n            });\r\n        }\r\n        if (this._enableStaticInstanceBatch) {\r\n            if (this._instanceBatchRender._batchOneRender(renderNode)) return;\r\n        }\r\n        if (this.enableCustomBatchRender) {\r\n            if (this._vertexMergeBatchRender._batchOneRender(renderNode)) return;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * remove one RenderNode\r\n     * @param renderNode \r\n     */\r\n    private __removeRenderNodeFromBatch(renderNode: BaseRender) {\r\n        //\r\n        renderNode._batchRender._removeOneRender(renderNode);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n        if (this._enableStaticInstanceBatch)\r\n            this._instanceBatchRender && (this._instanceBatchRender.enabled = true);\r\n        if (this._enableStaticVertexMergeBatch)\r\n            this._vertexMergeBatchRender && (this._vertexMergeBatchRender.enabled = true);\r\n        if (this.enableCustomBatchRender) {\r\n            this._customBatchs.forEach(element => {\r\n                element.enabled = true;\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onDisable(): void {\r\n        super._onDisable();\r\n        if (this._enableStaticInstanceBatch)\r\n            this._instanceBatchRender && (this._instanceBatchRender.enabled = false);\r\n        if (this._enableStaticVertexMergeBatch)\r\n            this._vertexMergeBatchRender && (this._vertexMergeBatchRender.enabled = false);\r\n        if (this.enableCustomBatchRender) {\r\n            this._customBatchs.forEach(element => {\r\n                element.enabled = false;\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @override\r\n     * @param renderNode \r\n     */\r\n    _addRenderNode?(renderNode: BaseRender): void {\r\n        if (renderNode.renderNode.staticMask == StaticFlag.StaticBatch) {\r\n            if (this._cacheRender.indexof(renderNode) != -1) {\r\n                return;\r\n            }\r\n            this._cacheRender.add(renderNode);\r\n            if (this._batchRender.length > 0) {//if batch exited\r\n                this.__addRenderNodeToBatch(renderNode);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @override\r\n     * @param renderNode    \r\n     */\r\n    _removeRenderNode(renderNode: BaseRender): void {\r\n        if (renderNode.renderNode.staticMask == StaticFlag.StaticBatch) {\r\n            if (this._batchRender.indexof(renderNode) != -1) {\r\n                this.__removeRenderNodeFromBatch(renderNode);\r\n                this._batchRender.remove(renderNode);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * Volume change\r\n     */\r\n    _VolumeChange() {\r\n        super._VolumeChange();\r\n        this._cacheRender.clear();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    onStart() {\r\n        this.reBatch();\r\n    }\r\n\r\n    /**\r\n     * ,\r\n     * ,Volume,\r\n     */\r\n    reBatch() {\r\n        this._cacheRender.elements.length = this._cacheRender.length;\r\n        this._batchRender.clear();\r\n        this._restorRenderNode();\r\n        if (this.enableCustomBatchRender) {\r\n            this._customBatchs.forEach(element => {\r\n                element.addList(this._cacheRender.elements);\r\n                element.reBatch();\r\n            });\r\n        }\r\n        if (this._enableStaticInstanceBatch) {\r\n            this._instanceBatchRender.addList(this._cacheRender.elements);\r\n            this._instanceBatchRender.reBatch();\r\n        }\r\n        if (this.enableCustomBatchRender) {\r\n            this._vertexMergeBatchRender.addList(this._cacheRender.elements);\r\n            this._vertexMergeBatchRender.reBatch();\r\n        }\r\n        //UpdateBatch Render\r\n        for (var i = 0, n = this._cacheRender.length; i < n; i++) {\r\n            (this._cacheRender.elements[i]._batchRender) && this._batchRender.add(this._cacheRender.elements[i]);\r\n        }\r\n    }\r\n}","import { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { Utils3D } from \"../../utils/Utils3D\";\r\nimport { GeometryElement } from \"../GeometryElement\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { UI3D } from \"./UI3D\";\r\n\r\nexport class UI3DGeometry extends GeometryElement {\r\n    /**@internal */\r\n    private static tempV0: Vector3 = new Vector3();\r\n    /**@internal */\r\n    private static _type: number = GeometryElement._typeCounter++;\r\n    /* @internal buffer*/\r\n    private _vertexBuffer: VertexBuffer3D;\r\n    /* @internal */\r\n    private _vertex: Float32Array;\r\n    /**@internal indexbuffer */\r\n    private _indexBuffer: IndexBuffer3D;\r\n    /**@internal index */\r\n    private _index: Uint16Array;\r\n    /**@internal */\r\n    private _bound: Bounds;\r\n    /**@internal */\r\n    _positionArray: Vector3[];\r\n\r\n    /**@internal */\r\n    constructor(owner: UI3D) {\r\n        super(MeshTopology.Triangles, DrawType.DrawElement);\r\n        this._owner = owner;\r\n        //_segementCount\r\n        this.bufferState = new BufferState();\r\n        this._bound = new Bounds();\r\n        this._createBuffer();\r\n        this.indexFormat = IndexFormat.UInt16;\r\n    }\r\n\r\n    /**@internal */\r\n    get bounds() {\r\n        return this._bound;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _createBuffer() {\r\n        var vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n        var halfLong: number = 1 / 2;\r\n        var halfWidth: number = 1 / 2;\r\n        this._vertex = new Float32Array([-halfLong, halfWidth, 0, 0, 0, 1, 0, 0,\r\n            halfLong, halfWidth, 0, 0, 0, 1, 1, 0,\r\n        -halfLong, -halfWidth, 0, 0, 0, 1, 0, 1,\r\n            halfLong, -halfWidth, 0, 0, 0, 1, 1, 1]);\r\n        this._index = new Uint16Array([0, 1, 2, 3, 2, 1]);\r\n        //VB\r\n        this._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(this._vertex.length * 4, BufferUsage.Dynamic, false);\r\n        this._vertexBuffer.vertexDeclaration = vertexDeclaration;\r\n        this._vertexBuffer.setData(this._vertex.buffer);\r\n        //IB\r\n        this._indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, this._index.length, BufferUsage.Static, false);\r\n        this._indexBuffer.setData(this._index);\r\n        //VAO\r\n        this.bufferState = new BufferState();\r\n        this.bufferState.applyState([this._vertexBuffer], this._indexBuffer);\r\n        this._bound.setExtent(new Vector3(halfLong, halfWidth, halfLong));\r\n        this._bound.setCenter(new Vector3(0, 0, 0));\r\n        this._positionArray = [new Vector3(), new Vector3(), new Vector3(), new Vector3()];\r\n        this._positionArray[0].set(-halfWidth, halfLong, 0.0);\r\n        this._positionArray[1].set(halfWidth, halfLong, 0.0);\r\n        this._positionArray[2].set(-halfWidth, -halfLong, 0.0);\r\n        this._positionArray[3].set(halfWidth, -halfLong, 0.0);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * reset view vertex data\r\n     */\r\n    _resizeViewVertexData(size: Vector2, cameraDir: Vector3, cameraUp: Vector3, viewMode: boolean, worldPos: Vector3): void {\r\n        var halfwidth = size.x / 2;\r\n        var halfhight = size.y / 2;\r\n        if (viewMode) {\r\n            UI3DGeometry.tempV0.set(-halfwidth, halfhight, 0.0);\r\n            Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[0]);\r\n            UI3DGeometry.tempV0.set(halfwidth, halfhight, 0.0);\r\n            Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[1]);\r\n            UI3DGeometry.tempV0.set(-halfwidth, -halfhight, 0.0);\r\n            Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[2]);\r\n            UI3DGeometry.tempV0.set(halfwidth, -halfhight, 0.0);\r\n            Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[3]);\r\n            this._vertex[3] = this._vertex[11] = this._vertex[19] = this._vertex[27] = -cameraDir.x;\r\n            this._vertex[4] = this._vertex[12] = this._vertex[20] = this._vertex[28] = -cameraDir.y;\r\n            this._vertex[5] = this._vertex[13] = this._vertex[21] = this._vertex[29] = -cameraDir.z;\r\n        } else {\r\n            this._positionArray[0].set(-halfwidth, halfhight, 0.0);\r\n            this._positionArray[1].set(halfwidth, halfhight, 0.0);\r\n            this._positionArray[2].set(-halfwidth, -halfhight, 0.0);\r\n            this._positionArray[3].set(halfwidth, -halfhight, 0.0);\r\n        }\r\n        Vector3.add(this._positionArray[0], worldPos, this._positionArray[0]);\r\n        Vector3.add(this._positionArray[1], worldPos, this._positionArray[1]);\r\n        Vector3.add(this._positionArray[2], worldPos, this._positionArray[2]);\r\n        Vector3.add(this._positionArray[3], worldPos, this._positionArray[3]);\r\n        this._changeVertex(size);\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * reset view vertex data\r\n     */\r\n    _resizeVertexData(size: Vector2): void {\r\n        var halfwidth = size.x / 2;\r\n        var halfhight = size.y / 2;\r\n        // if (viewMode) {\r\n        //     UI3DGeometry.tempV0.set(-halfwidth, halfhight, 0.0);\r\n        //     Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[0]);\r\n        //     UI3DGeometry.tempV0.set(halfwidth, halfhight, 0.0);\r\n        //     Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[1]);\r\n        //     UI3DGeometry.tempV0.set(-halfwidth, -halfhight, 0.0);\r\n        //     Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[2]);\r\n        //     UI3DGeometry.tempV0.set(halfwidth, -halfhight, 0.0);\r\n        //     Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[3]);\r\n        //     this._vertex[3] = this._vertex[11] = this._vertex[19] = this._vertex[27] = -cameraDir.x;\r\n        //     this._vertex[4] = this._vertex[12] = this._vertex[20] = this._vertex[28] = -cameraDir.y;\r\n        //     this._vertex[5] = this._vertex[13] = this._vertex[21] = this._vertex[29] = -cameraDir.z;\r\n        // } else {\r\n        this._positionArray[0].set(-halfwidth, halfhight, 0.0);\r\n        this._positionArray[1].set(halfwidth, halfhight, 0.0);\r\n        this._positionArray[2].set(-halfwidth, -halfhight, 0.0);\r\n        this._positionArray[3].set(halfwidth, -halfhight, 0.0);\r\n        // }\r\n        // Vector3.add(this._positionArray[0], worldPos, this._positionArray[0]);\r\n        // Vector3.add(this._positionArray[1], worldPos, this._positionArray[1]);\r\n        // Vector3.add(this._positionArray[2], worldPos, this._positionArray[2]);\r\n        // Vector3.add(this._positionArray[3], worldPos, this._positionArray[3]);\r\n        this._changeVertex(size);\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * reset vertex data\r\n     */\r\n    _resizeWorldVertexData(size: Vector2, worldMat: Matrix4x4) {\r\n        let applyMat = (v3: Vector3, mat: Matrix4x4) => {\r\n            Vector3.transformV3ToV3(v3, mat, v3);\r\n            return v3;\r\n        }\r\n        var halfwidth = size.x / 2;\r\n        var halfhight = size.y / 2;\r\n        this._positionArray[0].set(-halfwidth, halfhight, 0.0);\r\n        this._positionArray[1].set(halfwidth, halfhight, 0.0);\r\n        this._positionArray[2].set(-halfwidth, -halfhight, 0.0);\r\n        this._positionArray[3].set(halfwidth, -halfhight, 0.0);\r\n        applyMat(this._positionArray[0], worldMat);\r\n        applyMat(this._positionArray[1], worldMat);\r\n        applyMat(this._positionArray[2], worldMat);\r\n        applyMat(this._positionArray[3], worldMat);\r\n        this._changeVertex(size);\r\n    }\r\n\r\n    private _changeVertex(size: Vector2) {\r\n        this._vertex[0] = this._positionArray[0].x;\r\n        this._vertex[1] = this._positionArray[0].y;\r\n        this._vertex[2] = this._positionArray[0].z;\r\n        this._vertex[8] = this._positionArray[1].x;\r\n        this._vertex[9] = this._positionArray[1].y;\r\n        this._vertex[10] = this._positionArray[1].z;\r\n        this._vertex[16] = this._positionArray[2].x;\r\n        this._vertex[17] = this._positionArray[2].y;\r\n        this._vertex[18] = this._positionArray[2].z;\r\n        this._vertex[24] = this._positionArray[3].x;\r\n        this._vertex[25] = this._positionArray[3].y;\r\n        this._vertex[26] = this._positionArray[3].z;\r\n        this._vertexBuffer.setData(this._vertex.buffer, 0, 0, this._vertex.length * 4);\r\n        UI3DGeometry.tempV0.setValue(size.x / 2, size.y / 2, 0.0);\r\n        this._bound.setExtent(UI3DGeometry.tempV0);\r\n        let halfWidth = (this._positionArray[3].x - this._positionArray[2].x) / 2;\r\n        let halfHeight = (this._positionArray[0].y - this._positionArray[2].y) / 2;\r\n        UI3DGeometry.tempV0.setValue(this._positionArray[2].x + halfWidth, this._positionArray[2].y + halfHeight, this._positionArray[2].z);\r\n        this._bound.setCenter(UI3DGeometry.tempV0);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @internal\r\n     * @override\r\n     */\r\n    _updateRenderParams(state: RenderContext3D): void {\r\n        this.clearRenderParams();\r\n        this.setDrawElemenParams(6, 0);\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    destroy() {\r\n        super.destroy();\r\n        this.bufferState.destroy();\r\n        this._vertexBuffer.destroy();\r\n        this._indexBuffer.destroy();\r\n        this.bufferState = null;\r\n        this._vertexBuffer = null;\r\n        this._indexBuffer = null;\r\n        delete this._vertex;\r\n        delete this._index;\r\n    }\r\n}","import { Sprite } from \"../../../display/Sprite\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { RenderTargetFormat } from \"../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { RenderTexture2D } from \"../../../resource/RenderTexture2D\";\r\nimport { Plane } from \"../../math/Plane\";\r\nimport { Ray } from \"../../math/Ray\";\r\nimport { Material, MaterialRenderMode } from \"../../../resource/Material\";\r\nimport { MeshSprite3DShaderDeclaration } from \"../MeshSprite3DShaderDeclaration\";\r\nimport { BaseRender } from \"../render/BaseRender\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { RenderElement } from \"../render/RenderElement\";\r\nimport { Scene3D } from \"../scene/Scene3D\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Transform3D } from \"../Transform3D\";\r\nimport { UI3DGeometry } from \"./UI3DGeometry\";\r\nimport { Event } from \"../../../events/Event\";\r\nimport { UnlitMaterial } from \"../material/UnlitMaterial\";\r\nimport { Prefab } from \"../../../resource/HierarchyResource\";\r\nimport { InputManager } from \"../../../events/InputManager\";\r\nimport { NodeFlags } from \"../../../Const\";\r\nimport { ILaya } from \"../../../../ILaya\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { LayaEnv } from \"../../../../LayaEnv\";\r\n\r\n/**\r\n * <code>BaseCamera</code> \r\n */\r\nexport class UI3D extends BaseRender {\r\n    /**@intrtnal */\r\n    static TempMatrix = new Matrix4x4();\r\n    /**@internal */\r\n    static temp0: Vector3 = new Vector3();\r\n    /**@internal */\r\n    static temp1: Vector3 = new Vector3();\r\n    /**@internal */\r\n    static temp2: Vector3 = new Vector3();\r\n    /**@internal */\r\n    static DEBUG: boolean = false;\r\n    //,2DUI3D \r\n    private _shellSprite: Sprite;\r\n    /**@internal UISprite*/\r\n    private _uisprite: Sprite;\r\n    /**@internal */\r\n    private _ui3DMat: Material;\r\n    /**@internal */\r\n    private _rendertexure2D: RenderTexture2D;\r\n    /**@internal */\r\n    private _geometry: UI3DGeometry;\r\n    /**@internal 2D*/\r\n    private _needUpdate: boolean;\r\n    /**@internal */\r\n    private _uiPlane: Plane;\r\n    /**@internal */\r\n    private _size: Vector2;\r\n    /**@internal */\r\n    private _sizeChange: boolean = true;\r\n    /**@internal */\r\n    private _resolutionRate: number;\r\n    /**@internal */\r\n    private _view: boolean = true;\r\n    /**@internal */\r\n    private _bindPropertyName: string = \"u_AlbedoTexture\";\r\n    /**@internal */\r\n    private _hit: boolean = false;\r\n    /**@internal */\r\n    private _prefab: Prefab;\r\n    /**@internal */\r\n    private _matrix: Matrix4x4;\r\n    /**@internal  */\r\n    private _scale: Vector3;\r\n    /**@internal */\r\n    static _ray: Ray = new Ray(new Vector3(), new Vector3());\r\n\r\n    /**\r\n     * 3DUI\r\n     */\r\n    set sprite(value: Sprite) {\r\n        if (value == this._uisprite)\r\n            return;\r\n        this._uisprite = value;\r\n        this._shellSprite.removeChildren(0, this._shellSprite.numChildren - 1);\r\n        if (value)\r\n            this._shellSprite.addChild(value);\r\n        this._resizeRT();\r\n        this.boundsChange = true;\r\n    }\r\n\r\n    get sprite() {\r\n        return this._uisprite;\r\n    }\r\n\r\n    /**\r\n     * IDE\r\n     * 3DUI\r\n     */\r\n    set prefab(value: Prefab) {\r\n        this._prefab = value;\r\n        if (value)\r\n            this.sprite = <Sprite>value.create();\r\n        else\r\n            this.sprite = null;\r\n    }\r\n\r\n    get prefab() {\r\n        return this._prefab;\r\n    }\r\n\r\n    /**\r\n     * UI3DmeshScale\r\n     */\r\n    set scale(value: Vector2) {\r\n        if (value.x <= 0 || value.y <= 0)\r\n            return;\r\n        value.cloneTo(this._size);\r\n        this._resizeRT();\r\n        this.boundsChange = true;\r\n        this._scale.setValue(value.x, value.y, 1);\r\n    }\r\n\r\n    get scale() {\r\n        return this._size;\r\n    }\r\n\r\n    /**\r\n     * UI\r\n     */\r\n    set renderMode(value: MaterialRenderMode) {\r\n        this.sharedMaterial.materialRenderMode = value;\r\n        this.boundsChange = true;\r\n    }\r\n\r\n\r\n    get renderMode(): MaterialRenderMode {\r\n        if (!this.sharedMaterial)\r\n            this.sharedMaterial = this._ui3DMat;\r\n        return this.sharedMaterial.materialRenderMode;\r\n    }\r\n\r\n    /**\r\n     * UI\r\n     */\r\n    set cull(value: number) {\r\n        this.sharedMaterial && (this.sharedMaterial.cull = value);\r\n    }\r\n\r\n\r\n    get cull(): number {\r\n        let mat = this.sharedMaterial;\r\n        if (!mat) {\r\n            mat = this._ui3DMat;\r\n        }\r\n        return mat.cull;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get resolutionRate() {\r\n        return this._resolutionRate;\r\n    }\r\n\r\n    set resolutionRate(value: number) {\r\n        if (value <= 0)\r\n            return\r\n        if (this._resolutionRate == value)\r\n            return\r\n        this._resolutionRate = value;\r\n        this._resizeRT();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get billboard() {\r\n        return this._view;\r\n    }\r\n\r\n    set billboard(value: boolean) {\r\n        this._view = value;\r\n        this._sizeChange = true;\r\n        this.boundsChange = true;\r\n    }\r\n\r\n    /**\r\n     * ()\r\n     */\r\n    get enableHit() {\r\n        return this._hit;\r\n    }\r\n\r\n    set enableHit(value: boolean) {\r\n        this._hit = value;\r\n    }\r\n\r\n    /**\r\n     * UI3D\r\n     */\r\n    constructor() {\r\n        super();\r\n        this._uiPlane = new Plane(new Vector3(), 0);\r\n        this._size = new Vector2(1, 1);\r\n        this._resolutionRate = 128;\r\n        this._shellSprite = new Sprite();\r\n        this._shellSprite.name = \"UI3D\";\r\n        this._shellSprite._setBit(NodeFlags.DISPLAYED_INSTAGE, true);\r\n        this._shellSprite._setBit(NodeFlags.ACTIVE_INHIERARCHY, true);\r\n        this._shellSprite._parent = ILaya.stage;\r\n        this._shaderValues.addDefine(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV0);\r\n        this._ui3DMat = new UnlitMaterial();\r\n        this._ui3DMat.materialRenderMode = MaterialRenderMode.RENDERMODE_OPAQUE;\r\n        this._ui3DMat.cull = RenderState.CULL_BACK;\r\n        this._matrix = new Matrix4x4();\r\n        this._scale = new Vector3(1.0, 1.0, 1.0);\r\n    }\r\n\r\n    /**\r\n     * @internal add renderelement\r\n     */\r\n    private _addRenderElement() {\r\n        var elements: RenderElement[] = this._renderElements;\r\n        this._setMaterialTexture();\r\n        var material: Material = (<Material>this.sharedMaterial);\r\n        var element: RenderElement = new RenderElement();\r\n        element.setTransform((this.owner as Sprite3D)._transform);\r\n        element.render = this;\r\n        element.material = material;\r\n        this._geometry = new UI3DGeometry(this);\r\n        element.setGeometry(this._geometry);\r\n        elements.push(element);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _resizeRT() {\r\n        let width = this._size.x * this._resolutionRate;\r\n        let height = this._size.y * this._resolutionRate;\r\n        if (!this._rendertexure2D) {\r\n            this._rendertexure2D = new RenderTexture2D(width, height, RenderTargetFormat.R8G8B8A8, RenderTargetFormat.None);\r\n            this._rendertexure2D._invertY = true;\r\n        } else {\r\n            if (this._rendertexure2D.width != width || this._rendertexure2D.height != height) {\r\n                this._rendertexure2D.destroy();\r\n                this._rendertexure2D = new RenderTexture2D(width, height, RenderTargetFormat.R8G8B8A8, RenderTargetFormat.None);\r\n                this._rendertexure2D._invertY = true;\r\n                this._setMaterialTexture();\r\n            }\r\n        }\r\n        this._submitRT();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    onPreRender(): void {\r\n        //this._geometry\r\n        if (this.billboard) {\r\n            this._sizeChange = false;\r\n            let camera = (this.owner.scene as Scene3D).cullInfoCamera;\r\n            Matrix4x4.createAffineTransformation(this._transform.position, camera.transform.rotation, this._scale, this._matrix);\r\n        } else if (this._sizeChange) {\r\n            this._sizeChange = false;\r\n            this._transform.worldMatrix.cloneTo(this._matrix);\r\n        }\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @param hit \r\n    */\r\n    private _parseHit(ray: Ray) {\r\n        let _tempRay = UI3D._ray;\r\n        let u, v;\r\n        if (!this._uisprite || !LayaEnv.isPlaying) return null;\r\n        this._matrix.invert(UI3D.TempMatrix);\r\n        Vector3.transformCoordinate(ray.origin, UI3D.TempMatrix, _tempRay.origin);\r\n        Vector3.TransformNormal(ray.direction, UI3D.TempMatrix, _tempRay.direction);\r\n        _tempRay.direction.normalize();\r\n\r\n        let normalizeHitWidth = 0;\r\n        let normalizeHitHeight = 0;\r\n\r\n        let t = -_tempRay.origin.z / _tempRay.direction.z;\r\n        if (t < 0) {\r\n            return null;\r\n        }\r\n        else {\r\n            u = _tempRay.origin.x + t * _tempRay.direction.x;\r\n            v = _tempRay.origin.y + t * _tempRay.direction.y;\r\n        }\r\n\r\n        normalizeHitWidth = u + 0.5;\r\n        normalizeHitHeight = v + 0.5;\r\n\r\n        let cx = normalizeHitWidth * this._rendertexure2D.width;\r\n        let cy = (1.0 - normalizeHitHeight) * this._rendertexure2D.height;\r\n\r\n        // drawCircle to test\r\n        // UI3D.DEBUG && this._uisprite && this._shellSprite.graphics.drawCircle(cx, cy, 10, \"#e53d30\");\r\n\r\n        let target = InputManager.inst.getSpriteUnderPoint(this._uisprite, cx, cy);\r\n        if (target)\r\n            return target;\r\n        else\r\n            return null;\r\n    }\r\n\r\n    /**\r\n     * ui\r\n     */\r\n    getUITexture(): BaseTexture {\r\n        return this._rendertexure2D;\r\n    }\r\n\r\n    /**\r\n     * get camera distance\r\n     * @param rayOri \r\n     * @returns \r\n     */\r\n    _getCameraDistance(rayOri: Vector3): number {\r\n        return Vector3.distance(rayOri, (this.owner as Sprite3D).transform.position);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _renderUpdate(context: RenderContext3D, transform: Transform3D): void {\r\n        this._applyLightMapParams();\r\n        this._applyReflection();\r\n        this._setShaderValue(Sprite3D.WORLDMATRIX, ShaderDataType.Matrix4x4, this._matrix);\r\n        this._worldParams.x = transform.getFrontFaceValue();\r\n        this._setShaderValue(Sprite3D.WORLDINVERTFRONT, ShaderDataType.Vector4, this._worldParams);\r\n        return;\r\n    }\r\n\r\n    /** \r\n     * @internal\r\n     * SpriteRT\r\n     */\r\n    _submitRT() {\r\n        //\r\n        this._rendertexure2D && this._shellSprite.drawToTexture(this._rendertexure2D.width, this._rendertexure2D.height, 0, 0, this._rendertexure2D);\r\n        this._setMaterialTexture();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    _setMaterialTexture() {\r\n        if (!this.sharedMaterial)\r\n            this.sharedMaterial = this._ui3DMat;\r\n        if (!this.sharedMaterial.hasDefine(UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE)) {\r\n            this.sharedMaterial.addDefine(UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE);\r\n        }\r\n        this.sharedMaterial.setTexture(this._bindPropertyName, this._rendertexure2D);\r\n    }\r\n\r\n    /**\r\n     * UI\r\n     * @internal \r\n     * @param ray \r\n     * @returns \r\n     */\r\n    _checkUIPos(ray: Ray) {\r\n        if (!this.enableHit)\r\n            return false;\r\n        return this._parseHit(ray);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    protected _calculateBoundingBox(): void {\r\n        var worldMat: Matrix4x4 = this._transform.worldMatrix;\r\n        this._geometry.bounds._tranform(worldMat, this._bounds);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onAdded(): void {\r\n        super._onAdded();\r\n        this._addRenderElement();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onDisable(): void {\r\n        super._onDisable();\r\n        (this.owner as Sprite3D).transform.off(Event.TRANSFORM_CHANGED, this, this._transByRotate);//BaseRender,owner\r\n        (this.owner.scene as Scene3D)._UI3DManager.remove(this);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n        (this.owner.scene as Scene3D)._UI3DManager.add(this);\r\n        (this.owner as Sprite3D).transform.on(Event.TRANSFORM_CHANGED, this, this._transByRotate);//BaseRender,owner\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onDestroy() {\r\n        super._onDestroy();\r\n        this._rendertexure2D && this._rendertexure2D.destroy();\r\n        this._uisprite && this._uisprite.destroy();\r\n        this._shellSprite && this._shellSprite.destroy();\r\n        this._ui3DMat && this._ui3DMat.destroy();\r\n        this._resolutionRate = null;\r\n        this._uiPlane = null;\r\n        this._size = null;\r\n        this._scale = null;\r\n        this._matrix = null;\r\n    }\r\n\r\n    private _transByRotate() {\r\n        if (!this.billboard) {\r\n            this._sizeChange = true;\r\n        }\r\n        this.boundsChange = true;\r\n    }\r\n}\r\n\r\n","import { IResourceLoader, ILoadTask, Loader } from \"../../net/Loader\";\r\nimport { URL } from \"../../net/URL\";\r\nimport { KTXTextureInfo } from \"../../RenderEngine/KTXTextureInfo\";\r\nimport { FilterMode } from \"../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { TextureDimension } from \"../../RenderEngine/RenderEnum/TextureDimension\";\r\nimport { TextureFormat } from \"../../RenderEngine/RenderEnum/TextureFormat\";\r\nimport { WrapMode } from \"../../RenderEngine/RenderEnum/WrapMode\";\r\nimport { AssetDb } from \"../../resource/AssetDb\";\r\nimport { Resource } from \"../../resource/Resource\";\r\nimport { Byte } from \"../../utils/Byte\";\r\nimport { Utils } from \"../../utils/Utils\";\r\nimport { TextureCube } from \"../../resource/TextureCube\";\r\n\r\nvar internalResources: Record<string, TextureCube>;\r\n\r\nclass CubemapLoader implements IResourceLoader {\r\n    constructor() {\r\n        if (!internalResources) {\r\n            internalResources = {\r\n                \"WhiteTextureCube.ltc\": TextureCube.whiteTexture,\r\n                \"BlackTextureCube.ltc\": TextureCube.blackTexture,\r\n                \"GrayTextureCube.ltc\": TextureCube.grayTexture,\r\n            };\r\n        }\r\n    }\r\n\r\n    load(task: ILoadTask) {\r\n        if (task.url.indexOf(\"internal/\") != -1) {\r\n            let tex = internalResources[Utils.getBaseName(task.url)];\r\n            if (tex)\r\n                return Promise.resolve(tex);\r\n        }\r\n\r\n        if (task.ext == \"ktx\" || task.ext == \"cubemap\") {\r\n            let url = task.url;\r\n            if (task.ext == \"cubemap\")\r\n                url = AssetDb.inst.getSubAssetURL(url, task.uuid, \"0\", \"ktx\");\r\n\r\n            return task.loader.fetch(url, \"arraybuffer\", task.progress.createCallback(), task.options).then(data => {\r\n                if (!data)\r\n                    return null;\r\n\r\n                let ktxInfo = KTXTextureInfo.getKTXTextureInfo(data);\r\n                if (ktxInfo.dimension != TextureDimension.Cube) {\r\n                    Loader.warn(\"ktxInfo.dimension != TextureDimension.Cube! \" + task.url);\r\n                    return null;\r\n                }\r\n\r\n                let tex = new TextureCube(ktxInfo.width, ktxInfo.format, ktxInfo.mipmapCount > 1, ktxInfo.sRGB);\r\n                tex.setKTXData(ktxInfo);\r\n\r\n                let obsoluteInst = task.obsoluteInst;\r\n                if (obsoluteInst && (obsoluteInst instanceof TextureCube))\r\n                    tex = this.move(obsoluteInst, tex);\r\n\r\n                return tex;\r\n            });\r\n        }\r\n        else if (task.ext == \"ltcb\" || task.ext == \"ltcb.ls\") {\r\n            return task.loader.fetch(task.url, \"arraybuffer\", task.progress.createCallback(), task.options).then(data => {\r\n                if (!data)\r\n                    return null;\r\n\r\n                let byte: Byte = new Byte(data);\r\n                let version: string = byte.readUTFString();\r\n                if (version !== \"LAYATEXTURECUBE:0000\") {\r\n                    console.warn(`CubemapBinLoader: unknow version. ${version}`);\r\n                    return null;\r\n                }\r\n                let format: TextureFormat = <TextureFormat>byte.readUint8();\r\n                let mipCount: number = byte.getUint8();\r\n                let size: number = byte.readUint16();\r\n                let filterMode: FilterMode = <FilterMode>byte.getUint8();\r\n                let wrapModeU: WrapMode = <WrapMode>byte.getUint8();\r\n                let wrapModev: WrapMode = <WrapMode>byte.getUint8();\r\n                let anisoLevel: FilterMode = byte.getUint8();\r\n\r\n                let tex: TextureCube = new TextureCube(size, format, mipCount > 1 ? true : false);\r\n                tex.setPixelsData(null, false, false);\r\n                tex.filterMode = filterMode;\r\n                tex.wrapModeU = wrapModeU;\r\n                tex.wrapModeV = wrapModev;\r\n                tex.anisoLevel = anisoLevel;\r\n                let pos: number = byte.pos;\r\n                let mipSize: number = size;\r\n                for (let i = 0; i < mipCount; i++) {\r\n                    let uint8Arrays: Array<Uint8Array> = new Array<Uint8Array>(6);\r\n                    let mipPixelLength: number = mipSize * mipSize * tex._getFormatByteCount();\r\n                    for (let j = 0; j < 6; j++) {\r\n                        uint8Arrays[j] = new Uint8Array(data, pos, mipPixelLength);\r\n                        pos += mipPixelLength;\r\n                    }\r\n                    // todo   mipmap   mipmap\r\n                    tex.updateSubPixelsData(uint8Arrays, 0, 0, mipSize, mipSize, i, false, false, false);\r\n                    mipSize /= 2;\r\n                }\r\n\r\n                let obsoluteInst = task.obsoluteInst;\r\n                if (obsoluteInst && (obsoluteInst instanceof TextureCube))\r\n                    tex = this.move(obsoluteInst, tex);\r\n                return tex;\r\n            });\r\n        }\r\n        else {\r\n            return task.loader.fetch(task.url, \"json\", task.progress.createCallback(0.2), task.options).then(data => {\r\n                if (!data)\r\n                    return null;\r\n\r\n                let ltcBasePath: string = URL.getPath(task.url);\r\n                let urls: any[] = [\r\n                    URL.join(ltcBasePath, data.front),\r\n                    URL.join(ltcBasePath, data.back),\r\n                    URL.join(ltcBasePath, data.left),\r\n                    URL.join(ltcBasePath, data.right),\r\n                    URL.join(ltcBasePath, data.up),\r\n                    URL.join(ltcBasePath, data.down)\r\n                ];\r\n\r\n                return Promise.all(urls.map(url => {\r\n                    if (url)\r\n                        return task.loader.fetch(url, \"image\", task.progress.createCallback(), task.options);\r\n                    else\r\n                        return Promise.resolve(null);\r\n                })).then(images => {\r\n                    let constructParams = task.options.constructParams;\r\n                    let size = constructParams ? constructParams[0] : ((images[0]?.width) ?? 1);\r\n                    let format = constructParams ? constructParams[1] : TextureFormat.R8G8B8A8;\r\n                    let mipmap = constructParams ? constructParams[3] : false;\r\n                    let srgb = constructParams ? constructParams[5] : true;\r\n                    let tex = new TextureCube(size, format, mipmap, srgb);\r\n                    tex.setImageData(images, false, false);\r\n\r\n                    let obsoluteInst = task.obsoluteInst;\r\n                    if (obsoluteInst && (obsoluteInst instanceof TextureCube))\r\n                        tex = this.move(obsoluteInst, tex);\r\n                    return tex;\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    private move(obsoluteInst: TextureCube, tex: TextureCube) {\r\n        obsoluteInst._texture = tex._texture;\r\n        obsoluteInst.width = tex.width;\r\n        obsoluteInst.height = tex.height;\r\n        obsoluteInst.obsolute = false;\r\n        delete Resource._idResourcesMap[tex.id];\r\n        return obsoluteInst;\r\n    }\r\n}\r\n\r\nLoader.registerLoader([\"ltc\", \"ltcb\", \"ltcb.ls\", \"cubemap\"], CubemapLoader, Loader.TEXTURECUBE);","import { IResourceLoader, ILoadTask, Loader } from \"../../net/Loader\";\r\nimport { AssetDb } from \"../../resource/AssetDb\";\r\nimport { AnimationClip } from \"../animation/AnimationClip\";\r\n\r\nclass AnimationClipLoader implements IResourceLoader {\r\n    load(task: ILoadTask) {\r\n        let url = AssetDb.inst.getSubAssetURL(task.url, task.uuid, null, \"lani\");\r\n        return task.loader.fetch(url, \"arraybuffer\", task.progress.createCallback(), task.options).then(data => {\r\n            if (!data) {\r\n                return null;\r\n            }\r\n            return AnimationClip._parse(data);\r\n        });\r\n    }\r\n}\r\n\r\nLoader.registerLoader([\"lani\"], AnimationClipLoader, Loader.ANIMATIONCLIP);","\r\nimport { IndexBuffer3D } from \"../graphics/IndexBuffer3D\"\r\nimport { VertexBuffer3D } from \"../graphics/VertexBuffer3D\"\r\nimport { Mesh, skinnedMatrixCache } from \"../resource/models/Mesh\"\r\nimport { SubMesh } from \"../resource/models/SubMesh\"\r\nimport { Byte } from \"../../utils/Byte\"\r\nimport { BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\"\r\nimport { VertexDeclaration } from \"../../RenderEngine/VertexDeclaration\"\r\nimport { IndexFormat } from \"../../RenderEngine/RenderEnum/IndexFormat\"\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\"\r\nimport { VertexMesh } from \"../../RenderEngine/RenderShader/VertexMesh\"\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\"\r\n\r\n/**\r\n * @internal\r\n * <code>LoadModel</code> \r\n */\r\nexport class LoadModelV04 {\r\n\r\n\t/**@internal */\r\n\tprivate static _BLOCK: any = { count: 0 };\r\n\t/**@internal */\r\n\tprivate static _DATA: any = { offset: 0, size: 0 };\r\n\r\n\t/**@internal */\r\n\tprivate static _strings: any[] = [];\r\n\t/**@internal */\r\n\tprivate static _readData: Byte;\r\n\t/**@internal */\r\n\tprivate static _version: string;\r\n\t/**@internal */\r\n\tprivate static _mesh: Mesh;\r\n\t/**@internal */\r\n\tprivate static _subMeshes: SubMesh[];\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic parse(readData: Byte, version: string, mesh: Mesh, subMeshes: SubMesh[]): void {\r\n\t\tLoadModelV04._mesh = mesh;\r\n\t\tLoadModelV04._subMeshes = subMeshes;\r\n\t\tLoadModelV04._version = version;\r\n\t\tLoadModelV04._readData = readData;\r\n\t\tLoadModelV04.READ_DATA();\r\n\t\tLoadModelV04.READ_BLOCK();\r\n\t\tLoadModelV04.READ_STRINGS();\r\n\t\tfor (var i: number = 0, n: number = LoadModelV04._BLOCK.count; i < n; i++) {\r\n\t\t\tLoadModelV04._readData.pos = LoadModelV04._BLOCK.blockStarts[i];\r\n\t\t\tvar index: number = LoadModelV04._readData.getUint16();\r\n\t\t\tvar blockName: string = LoadModelV04._strings[index];\r\n\t\t\tvar fn: Function = (LoadModelV04 as any)[\"READ_\" + blockName];\r\n\t\t\tif (fn == null)\r\n\t\t\t\tthrow new Error(\"model file err,no this function:\" + index + \" \" + blockName);\r\n\t\t\telse\r\n\t\t\t\tfn.call(null);\r\n\t\t}\r\n\t\tLoadModelV04._strings.length = 0;\r\n\t\tLoadModelV04._readData = null;\r\n\t\tLoadModelV04._version = null;\r\n\t\tLoadModelV04._mesh = null;\r\n\t\tLoadModelV04._subMeshes = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static _readString(): string {\r\n\t\treturn LoadModelV04._strings[LoadModelV04._readData.getUint16()];\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static READ_DATA(): void {\r\n\t\tLoadModelV04._DATA.offset = LoadModelV04._readData.getUint32();\r\n\t\tLoadModelV04._DATA.size = LoadModelV04._readData.getUint32();\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static READ_BLOCK(): void {\r\n\t\tvar count: number = LoadModelV04._BLOCK.count = LoadModelV04._readData.getUint16();\r\n\t\tvar blockStarts: any[] = LoadModelV04._BLOCK.blockStarts = [];\r\n\t\tvar blockLengths: any[] = LoadModelV04._BLOCK.blockLengths = [];\r\n\t\tfor (var i: number = 0; i < count; i++) {\r\n\t\t\tblockStarts.push(LoadModelV04._readData.getUint32());\r\n\t\t\tblockLengths.push(LoadModelV04._readData.getUint32());\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static READ_STRINGS(): void {\r\n\t\tvar offset: number = LoadModelV04._readData.getUint32();\r\n\t\tvar count: number = LoadModelV04._readData.getUint16();\r\n\t\tvar prePos: number = LoadModelV04._readData.pos;\r\n\t\tLoadModelV04._readData.pos = offset + LoadModelV04._DATA.offset;\r\n\r\n\t\tfor (var i: number = 0; i < count; i++)\r\n\t\t\tLoadModelV04._strings[i] = LoadModelV04._readData.readUTFString();\r\n\r\n\t\tLoadModelV04._readData.pos = prePos;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static READ_MESH(): boolean {\r\n\t\tvar name: string = LoadModelV04._readString();\r\n\t\tvar arrayBuffer: ArrayBuffer = LoadModelV04._readData.__getBuffer();\r\n\t\tvar i: number;\r\n\r\n\t\tvar memorySize: number = 0;\r\n\t\tvar vertexBufferCount: number = LoadModelV04._readData.getInt16();\r\n\t\tvar offset: number = LoadModelV04._DATA.offset;\r\n\t\tfor (i = 0; i < vertexBufferCount; i++) {//TODO:1\r\n\t\t\tvar vbStart: number = offset + LoadModelV04._readData.getUint32();\r\n\t\t\tvar vbLength: number = LoadModelV04._readData.getUint32();\r\n\t\t\tvar vbArrayBuffer: ArrayBuffer = arrayBuffer.slice(vbStart, vbStart + vbLength);\r\n\t\t\tvar vbDatas: Float32Array = new Float32Array(vbArrayBuffer);\r\n\t\t\tvar bufferAttribute: string = LoadModelV04._readString();\r\n\t\t\tvar vertexDeclaration: VertexDeclaration;\r\n\t\t\tswitch (LoadModelV04._version) {\r\n\t\t\t\tcase \"LAYAMODEL:0301\":\r\n\t\t\t\tcase \"LAYAMODEL:0400\":\r\n\t\t\t\t\tvertexDeclaration = VertexMesh.getVertexDeclaration(bufferAttribute);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"LAYAMODEL:0401\":\r\n\t\t\t\t\tvertexDeclaration = VertexMesh.getVertexDeclaration(bufferAttribute, false);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow new Error(\"LoadModelV03: unknown version.\");\r\n\t\t\t}\r\n\r\n\t\t\tif (!vertexDeclaration)\r\n\t\t\t\tthrow new Error(\"LoadModelV03: unknown vertexDeclaration.\");\r\n\r\n\t\t\tvar vertexBuffer: VertexBuffer3D = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vbDatas.length * 4, BufferUsage.Static, true);\r\n\t\t\tvertexBuffer.vertexDeclaration = vertexDeclaration;\r\n\t\t\tvertexBuffer.setData(vbDatas.buffer);\r\n\t\t\tLoadModelV04._mesh._vertexBuffer = vertexBuffer;\r\n\t\t\tLoadModelV04._mesh._vertexCount += vertexBuffer._byteLength / vertexDeclaration.vertexStride;\r\n\t\t\tmemorySize += vbDatas.length * 4;\r\n\t\t}\r\n\r\n\t\tvar ibStart: number = offset + LoadModelV04._readData.getUint32();\r\n\t\tvar ibLength: number = LoadModelV04._readData.getUint32();\r\n\t\tvar ibDatas: Uint16Array = new Uint16Array(arrayBuffer.slice(ibStart, ibStart + ibLength));\r\n\t\tvar indexBuffer: IndexBuffer3D = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, ibLength / 2, BufferUsage.Static, true);\r\n\t\tindexBuffer.setData(ibDatas);\r\n\t\tLoadModelV04._mesh._indexBuffer = indexBuffer;\r\n\t\tmemorySize += indexBuffer.indexCount * 2;\r\n\r\n\t\tLoadModelV04._mesh._setBuffer(LoadModelV04._mesh._vertexBuffer, indexBuffer);\r\n\r\n\t\tLoadModelV04._mesh._setCPUMemory(memorySize);\r\n\t\tLoadModelV04._mesh._setGPUMemory(memorySize);\r\n\r\n\t\tvar boneNames: string[] = LoadModelV04._mesh._boneNames = [];\r\n\t\tvar boneCount: number = LoadModelV04._readData.getUint16();\r\n\t\tboneNames.length = boneCount;\r\n\t\tfor (i = 0; i < boneCount; i++)\r\n\t\t\tboneNames[i] = LoadModelV04._strings[LoadModelV04._readData.getUint16()];\r\n\r\n\t\tLoadModelV04._readData.pos += 8;//TODO:\r\n\r\n\t\tvar bindPoseDataStart: number = LoadModelV04._readData.getUint32();\r\n\t\tvar bindPoseDataLength: number = LoadModelV04._readData.getUint32();\r\n\t\tvar bindPoseDatas: Float32Array = new Float32Array(arrayBuffer.slice(offset + bindPoseDataStart, offset + bindPoseDataStart + bindPoseDataLength));\r\n\t\tvar bindPoseFloatCount: number = bindPoseDatas.length;\r\n\t\tvar bindPoseBuffer: ArrayBuffer = LoadModelV04._mesh._inverseBindPosesBuffer = new ArrayBuffer(bindPoseFloatCount * 4);//TODO:[NATIVE]\r\n\t\tLoadModelV04._mesh._inverseBindPoses = [];\r\n\t\tif (bindPoseFloatCount != 0)\r\n\t\t\tLoadModelV04._mesh._instanceBufferStateType = Mesh.MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR;\r\n\t\telse\r\n\t\t\tLoadModelV04._mesh._instanceBufferStateType = Mesh.MESH_INSTANCEBUFFER_TYPE_NORMAL;\r\n\t\t//LoadModelV04._mesh._setInstanceBuffer(LoadModelV04._mesh._instanceBufferStateType);\r\n\t\tfor (i = 0; i < bindPoseFloatCount; i += 16) {\r\n\t\t\tvar inverseGlobalBindPose: Matrix4x4 = new Matrix4x4(bindPoseDatas[i + 0], bindPoseDatas[i + 1], bindPoseDatas[i + 2], bindPoseDatas[i + 3], bindPoseDatas[i + 4], bindPoseDatas[i + 5], bindPoseDatas[i + 6], bindPoseDatas[i + 7], bindPoseDatas[i + 8], bindPoseDatas[i + 9], bindPoseDatas[i + 10], bindPoseDatas[i + 11], bindPoseDatas[i + 12], bindPoseDatas[i + 13], bindPoseDatas[i + 14], bindPoseDatas[i + 15], new Float32Array(bindPoseBuffer, i * 4, 16));\r\n\t\t\tLoadModelV04._mesh._inverseBindPoses[i / 16] = inverseGlobalBindPose;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static READ_SUBMESH(): boolean {\r\n\t\tvar arrayBuffer: ArrayBuffer = LoadModelV04._readData.__getBuffer();\r\n\t\tvar subMesh: SubMesh = new SubMesh(LoadModelV04._mesh);\r\n\r\n\t\tLoadModelV04._readData.getInt16();//TODO:vbIndex\r\n\t\tLoadModelV04._readData.getUint32();//TODO:vbStart\r\n\t\tLoadModelV04._readData.getUint32();//TODO:vbLength\r\n\r\n\t\tvar ibStart: number = LoadModelV04._readData.getUint32();\r\n\t\tvar ibCount: number = LoadModelV04._readData.getUint32();\r\n\t\tvar indexBuffer: IndexBuffer3D = LoadModelV04._mesh._indexBuffer;\r\n\t\tsubMesh._indexBuffer = indexBuffer;\r\n\t\tsubMesh._setIndexRange(ibStart, ibCount);\r\n\t\tvar vertexBuffer: VertexBuffer3D = LoadModelV04._mesh._vertexBuffer;\r\n\t\tsubMesh._vertexBuffer = vertexBuffer;\r\n\r\n\t\tvar offset: number = LoadModelV04._DATA.offset;\r\n\t\tvar subIndexBufferStart: number[] = subMesh._subIndexBufferStart;\r\n\t\tvar subIndexBufferCount: number[] = subMesh._subIndexBufferCount;\r\n\t\tvar boneIndicesList: Uint16Array[] = subMesh._boneIndicesList;\r\n\t\tvar drawCount: number = LoadModelV04._readData.getUint16();\r\n\t\tsubIndexBufferStart.length = drawCount;\r\n\t\tsubIndexBufferCount.length = drawCount;\r\n\t\tboneIndicesList.length = drawCount;\r\n\r\n\t\tvar skinnedCache: skinnedMatrixCache[] = LoadModelV04._mesh._skinnedMatrixCaches;\r\n\t\tvar subMeshIndex: number = LoadModelV04._subMeshes.length;\r\n\t\tskinnedCache.length = LoadModelV04._mesh._inverseBindPoses.length;\r\n\t\tfor (var i: number = 0; i < drawCount; i++) {\r\n\t\t\tsubIndexBufferStart[i] = LoadModelV04._readData.getUint32();\r\n\t\t\tsubIndexBufferCount[i] = LoadModelV04._readData.getUint32();\r\n\t\t\tvar boneDicofs: number = LoadModelV04._readData.getUint32();\r\n\t\t\tvar boneDicCount: number = LoadModelV04._readData.getUint32();\r\n\t\t\tvar boneIndices: Uint16Array = boneIndicesList[i] = new Uint16Array(arrayBuffer.slice(offset + boneDicofs, offset + boneDicofs + boneDicCount));\r\n\t\t\tvar boneIndexCount: number = boneIndices.length;\r\n\t\t\tfor (var j: number = 0; j < boneIndexCount; j++) {\r\n\t\t\t\tvar index: number = boneIndices[j];\r\n\t\t\t\tskinnedCache[index] || (skinnedCache[index] = new skinnedMatrixCache(subMeshIndex, i, j));\r\n\t\t\t}\r\n\t\t}\r\n\t\tLoadModelV04._subMeshes.push(subMesh);\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n\r\n","\r\nexport class MorphTarget {\r\n\r\n    /** @internal */\r\n    _index: number;\r\n\r\n    name: string;\r\n\r\n    fullWeight: number;\r\n\r\n    data: Float32Array;\r\n\r\n    constructor() {\r\n        this.fullWeight = 1;\r\n    }\r\n\r\n}\r\n\r\n// todo class name\r\nexport class MorphTargetChannel {\r\n\r\n    /** @internal */\r\n    _index: number;\r\n\r\n    name: string;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    targets: Array<MorphTarget>;\r\n\r\n    targetCount: number = 0;\r\n\r\n    constructor() {\r\n        this.targets = new Array<MorphTarget>();\r\n    }\r\n\r\n    getTargetByIndex(index: number) {\r\n        return this.targets[index];\r\n    }\r\n\r\n    addTarget(target: MorphTarget) {\r\n        this.targetCount++;\r\n        this.targets.push(target);\r\n        this.targets.sort((a, b) => {\r\n            return a.fullWeight - b.fullWeight;\r\n        })\r\n    }\r\n\r\n}","import { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { FilterMode } from \"../../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { RenderCapable } from \"../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { RenderParams } from \"../../../RenderEngine/RenderEnum/RenderParams\";\r\nimport { TextureFormat } from \"../../../RenderEngine/RenderEnum/TextureFormat\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { Texture2DArray } from \"../../../resource/Texture2DArray\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { MorphTarget, MorphTargetChannel } from \"./MorphTarget\";\r\n\r\nexport class MorphTargetData {\r\n\r\n    // keep origin insert order\r\n\r\n    private targets: Array<MorphTarget>;\r\n\r\n    private channels: Array<MorphTargetChannel>;\r\n\r\n    vertexCount: number;\r\n\r\n    /**\r\n     * // todo   \r\n     * //   VertexDeclaration \r\n     * morph target attribute element count\r\n     */\r\n    elementCount: number;\r\n\r\n    /**@internal */\r\n    attributeOffset: Vector4;\r\n    /**@internal */\r\n    params: Vector4;\r\n\r\n    /** @internal */\r\n    targetTexture: Texture2DArray;\r\n\r\n    vertexDec: VertexDeclaration;\r\n\r\n    bounds: Bounds;\r\n\r\n    constructor() {\r\n        this.targets = new Array();\r\n        this.channels = new Array();\r\n        this.bounds = new Bounds();\r\n        this.params = new Vector4();\r\n    }\r\n\r\n    addMorphChannel(channel: MorphTargetChannel) {\r\n\r\n        channel._index = this.channels.length;\r\n        this.channels.push(channel);\r\n\r\n        channel.targets.forEach(target => {\r\n            target._index = this.targets.length;\r\n            this.targets.push(target);\r\n        })\r\n    }\r\n\r\n    getMorphChannel(name: string): MorphTargetChannel {\r\n        // return this.targets.find(value => value.name == name);\r\n        return this.channels.find(value => value.name == name);\r\n    }\r\n\r\n    getMorphChannelbyIndex(index: number) {\r\n        return this.channels[index];\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    get targetCount(): number {\r\n        return this.targets.length;\r\n    }\r\n\r\n    get channelCount(): number {\r\n        return this.channels.length;\r\n    }\r\n\r\n    initData() {\r\n        if (LayaGL.renderEngine.getCapable(RenderCapable.Texture3D)) {\r\n            let targetNum = this.targets.length;\r\n\r\n            let maxTexSize = LayaGL.renderEngine.getParams(RenderParams.MAX_Texture_Size);\r\n\r\n            let vertexCount = this.vertexCount;\r\n\r\n            let vertexDec = this.vertexDec;\r\n\r\n            let morphStride = vertexDec.vertexStride / 4;\r\n\r\n            let elementCount = vertexDec.vertexElementCount;\r\n            this.elementCount = elementCount;\r\n\r\n            let texHeight = Math.floor(elementCount * vertexCount / maxTexSize) + 1;\r\n\r\n            let texelStride = 4;\r\n            this.targetTexture = new Texture2DArray(maxTexSize, texHeight, targetNum, TextureFormat.R32G32B32A32, false, false, false);\r\n            this.targetTexture.filterMode = FilterMode.Point;\r\n            this.targetTexture.anisoLevel = 1;\r\n            this.targetTexture.lock = true;\r\n\r\n            let data = new Float32Array(maxTexSize * texHeight * targetNum * texelStride).fill(0);\r\n\r\n            /**\r\n             * x: position offset\r\n             * y: normal offset\r\n             * z: tangent offset\r\n             */\r\n            let attributeOffset = this.attributeOffset = new Vector4(0, 0, 0, 0);\r\n            attributeOffset.x = vertexDec._vertexElements.indexOf(vertexDec.getVertexElementByUsage(VertexMesh.MESH_POSITION0));\r\n            attributeOffset.y = vertexDec._vertexElements.indexOf(vertexDec.getVertexElementByUsage(VertexMesh.MESH_NORMAL0));\r\n            attributeOffset.z = vertexDec._vertexElements.indexOf(vertexDec.getVertexElementByUsage(VertexMesh.MESH_TANGENT0));\r\n\r\n            let targetStride = maxTexSize * texHeight;\r\n\r\n            for (let targetIndex = 0; targetIndex < targetNum; targetIndex++) {\r\n                let target = this.targets[targetIndex];\r\n                for (let vertexIndex = 0; vertexIndex < vertexCount; vertexIndex++) {\r\n                    let dataOffset = (targetIndex * targetStride + vertexIndex * elementCount) * texelStride;\r\n                    vertexDec._vertexElements.forEach((element, elementIndex) => {\r\n                        let pixelOffset = dataOffset + elementIndex * 4;\r\n\r\n                        let elementOffset = element.offset / 4;\r\n                        let targetDataOffset = vertexIndex * morphStride + elementOffset;\r\n                        switch (element.elementUsage) {\r\n                            case VertexMesh.MESH_POSITION0:\r\n                            case VertexMesh.MESH_NORMAL0:\r\n                                data[pixelOffset] = target.data[targetDataOffset];\r\n                                data[pixelOffset + 1] = target.data[targetDataOffset + 1];\r\n                                data[pixelOffset + 2] = target.data[targetDataOffset + 2];\r\n                                break;\r\n                            case VertexMesh.MESH_TANGENT0:\r\n                                data[pixelOffset] = target.data[targetDataOffset];\r\n                                data[pixelOffset + 1] = target.data[targetDataOffset + 1];\r\n                                data[pixelOffset + 2] = target.data[targetDataOffset + 2];\r\n                                data[pixelOffset + 3] = target.data[targetDataOffset + 3];\r\n                                break;\r\n                            default:\r\n                                break;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n\r\n            this.targetTexture.setPixelsData(data, false, false);\r\n\r\n            this.params.setValue(this.targetTexture.width, this.targetTexture.height, this.elementCount, this.channelCount);\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        if (this.targetTexture) {\r\n            this.targetTexture.lock = false;\r\n            this.targetTexture.destroy();\r\n            this.targetTexture = null;\r\n        }\r\n\r\n        // todo\r\n        this.targets = null;\r\n        this.channels = null;\r\n    }\r\n\r\n    clone(): MorphTargetData {\r\n        let res = new MorphTargetData();\r\n\r\n        res.bounds.setMin(this.bounds.getMin());\r\n        res.bounds.setMax(this.bounds.getMax());\r\n\r\n        res.vertexCount = this.vertexCount;\r\n        res.vertexDec = this.vertexDec;\r\n\r\n        let channelCount = this.channelCount;\r\n        for (let index = 0; index < channelCount; index++) {\r\n            let channel = this.getMorphChannelbyIndex(index);\r\n\r\n            let newChannel = new MorphTargetChannel();\r\n            newChannel.name = channel.name;\r\n\r\n            let targetCount = channel.targetCount;\r\n            for (let targetIndex = 0; targetIndex < targetCount; targetIndex++) {\r\n                let target = channel.getTargetByIndex(targetIndex);\r\n                \r\n                let newTarget = new MorphTarget();\r\n                newTarget.name = target.name;\r\n                newTarget.fullWeight = target.fullWeight;\r\n                newTarget.data = new Float32Array(target.data);\r\n                \r\n                newChannel.addTarget(newTarget);\r\n            }\r\n\r\n            res.addMorphChannel(newChannel);\r\n        }\r\n\r\n        res.initData();\r\n        return res;\r\n    }\r\n\r\n}","import { Matrix4x4 } from \"../../maths/Matrix4x4\"\r\nimport { Vector3 } from \"../../maths/Vector3\"\r\nimport { BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\"\r\nimport { IndexFormat } from \"../../RenderEngine/RenderEnum/IndexFormat\"\r\nimport { VertexMesh } from \"../../RenderEngine/RenderShader/VertexMesh\"\r\nimport { VertexDeclaration } from \"../../RenderEngine/VertexDeclaration\"\r\nimport { Byte } from \"../../utils/Byte\"\r\nimport { HalfFloatUtils } from \"../../utils/HalfFloatUtils\"\r\nimport { IndexBuffer3D } from \"../graphics/IndexBuffer3D\"\r\nimport { VertexBuffer3D } from \"../graphics/VertexBuffer3D\"\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\"\r\nimport { Mesh, skinnedMatrixCache } from \"../resource/models/Mesh\"\r\nimport { MorphTarget, MorphTargetChannel } from \"../resource/models/MorphTarget\"\r\nimport { MorphTargetData } from \"../resource/models/MorphTargetData\"\r\nimport { SubMesh } from \"../resource/models/SubMesh\"\r\n\r\n\r\n/**\r\n * @internal\r\n * <code>LoadModelV05</code> \r\n */\r\nexport class LoadModelV05 {\r\n\r\n    /**@internal */\r\n    private static _BLOCK: any = { count: 0 };\r\n    /**@internal */\r\n    private static _DATA = { offset: 0, size: 0 };\r\n\r\n    /**@internal */\r\n    private static _strings: any[] = [];\r\n    /**@internal */\r\n    private static _readData: Byte;\r\n    /**@internal */\r\n    private static _version: string;\r\n    /**@internal */\r\n    private static _mesh: Mesh;\r\n    /**@internal */\r\n    private static _subMeshes: SubMesh[];\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static parse(readData: Byte, version: string, mesh: Mesh, subMeshes: SubMesh[]): void {\r\n        LoadModelV05._mesh = mesh;\r\n        LoadModelV05._subMeshes = subMeshes;\r\n        LoadModelV05._version = version;\r\n        LoadModelV05._readData = readData;\r\n        LoadModelV05.READ_DATA();\r\n        LoadModelV05.READ_BLOCK();\r\n        LoadModelV05.READ_STRINGS();\r\n        for (var i: number = 0, n: number = LoadModelV05._BLOCK.count; i < n; i++) {\r\n            LoadModelV05._readData.pos = LoadModelV05._BLOCK.blockStarts[i];\r\n            var index: number = LoadModelV05._readData.getUint16();\r\n            var blockName: string = LoadModelV05._strings[index];\r\n            var fn: Function = (LoadModelV05 as any)[\"READ_\" + blockName];\r\n            if (fn == null)\r\n                console.warn(\"model file err,no this function:\" + index + \" \" + blockName);\r\n            else\r\n                fn.call(null);\r\n        }\r\n        LoadModelV05._strings.length = 0;\r\n        LoadModelV05._readData = null;\r\n        LoadModelV05._version = null;\r\n        LoadModelV05._mesh = null;\r\n        LoadModelV05._subMeshes = null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static _readString(): string {\r\n        return LoadModelV05._strings[LoadModelV05._readData.getUint16()];\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static READ_DATA(): void {\r\n        LoadModelV05._DATA.offset = LoadModelV05._readData.getUint32();\r\n        LoadModelV05._DATA.size = LoadModelV05._readData.getUint32();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static READ_BLOCK(): void {\r\n        var count: number = LoadModelV05._BLOCK.count = LoadModelV05._readData.getUint16();\r\n        var blockStarts: any[] = LoadModelV05._BLOCK.blockStarts = [];\r\n        var blockLengths: any[] = LoadModelV05._BLOCK.blockLengths = [];\r\n        for (var i: number = 0; i < count; i++) {\r\n            blockStarts.push(LoadModelV05._readData.getUint32());\r\n            blockLengths.push(LoadModelV05._readData.getUint32());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static READ_STRINGS(): void {\r\n        var offset: number = LoadModelV05._readData.getUint32();\r\n        var count: number = LoadModelV05._readData.getUint16();\r\n        var prePos: number = LoadModelV05._readData.pos;\r\n        LoadModelV05._readData.pos = offset + LoadModelV05._DATA.offset;\r\n\r\n        for (var i: number = 0; i < count; i++)\r\n            LoadModelV05._strings[i] = LoadModelV05._readData.readUTFString();\r\n\r\n        LoadModelV05._readData.pos = prePos;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static READ_MESH(): boolean {\r\n        var i: number;\r\n        var memorySize: number = 0;\r\n        var name: string = LoadModelV05._readString();\r\n        var reader: Byte = LoadModelV05._readData;\r\n        var arrayBuffer: ArrayBuffer = reader.__getBuffer();\r\n\r\n\r\n\r\n        var vertexBufferCount: number = reader.getInt16();\r\n        var offset: number = LoadModelV05._DATA.offset;\r\n        for (i = 0; i < vertexBufferCount; i++) {//TODO:1\r\n            var vbStart: number = offset + reader.getUint32();\r\n            var vertexCount: number = reader.getUint32();\r\n            var vertexFlag: string = LoadModelV05._readString();\r\n            var vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(vertexFlag, false);\r\n\r\n            var vertexStride: number = vertexDeclaration.vertexStride;\r\n            var vertexData: ArrayBuffer;\r\n            var floatData: Float32Array;\r\n            var uint8Data: Uint8Array;\r\n\r\n            var subVertexFlags: any[] = vertexFlag.split(\",\");\r\n            var subVertexCount: number = subVertexFlags.length;\r\n            var mesh: Mesh = LoadModelV05._mesh;\r\n\r\n            switch (LoadModelV05._version) {\r\n                case \"LAYAMODEL:05\":\r\n                case \"LAYAMODEL:0501\":\r\n                case \"LAYAMODEL:0502\":\r\n                    vertexData = arrayBuffer.slice(vbStart, vbStart + vertexCount * vertexStride);\r\n                    floatData = new Float32Array(vertexData);\r\n                    uint8Data = new Uint8Array(vertexData);\r\n                    break;\r\n                case \"LAYAMODEL:COMPRESSION_05\":\r\n                case \"LAYAMODEL:COMPRESSION_0501\":\r\n                    vertexData = new ArrayBuffer(vertexStride * vertexCount);\r\n                    floatData = new Float32Array(vertexData);\r\n                    uint8Data = new Uint8Array(vertexData);\r\n                    var lastPosition: number = reader.pos;\r\n                    reader.pos = vbStart;\r\n\r\n                    for (var j: number = 0; j < vertexCount; j++) {\r\n                        var subOffset: number;\r\n                        var verOffset: number = j * vertexStride;\r\n                        for (var k: number = 0; k < subVertexCount; k++) {\r\n                            switch (subVertexFlags[k]) {\r\n                                case \"POSITION\":\r\n                                    subOffset = verOffset / 4;\r\n                                    floatData[subOffset] = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n                                    floatData[subOffset + 1] = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n                                    floatData[subOffset + 2] = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n                                    verOffset += 12;\r\n                                    break;\r\n                                case \"NORMAL\":\r\n                                    subOffset = verOffset / 4;\r\n                                    floatData[subOffset] = reader.getUint8() / 127.5 - 1;\r\n                                    floatData[subOffset + 1] = reader.getUint8() / 127.5 - 1;\r\n                                    floatData[subOffset + 2] = reader.getUint8() / 127.5 - 1;\r\n                                    verOffset += 12;\r\n                                    break;\r\n                                case \"COLOR\":\r\n                                    subOffset = verOffset / 4;\r\n                                    floatData[subOffset] = reader.getUint8() / 255;\r\n                                    floatData[subOffset + 1] = reader.getUint8() / 255;\r\n                                    floatData[subOffset + 2] = reader.getUint8() / 255;\r\n                                    floatData[subOffset + 3] = reader.getUint8() / 255;\r\n                                    verOffset += 16;\r\n                                    break;\r\n                                case \"UV\":\r\n                                    subOffset = verOffset / 4;\r\n                                    floatData[subOffset] = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n                                    floatData[subOffset + 1] = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n                                    verOffset += 8;\r\n                                    break;\r\n                                case \"UV1\":\r\n                                    subOffset = verOffset / 4;\r\n                                    floatData[subOffset] = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n                                    floatData[subOffset + 1] = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n                                    verOffset += 8;\r\n                                    break;\r\n                                case \"BLENDWEIGHT\":\r\n                                    subOffset = verOffset / 4;\r\n                                    floatData[subOffset] = reader.getUint8() / 255;\r\n                                    floatData[subOffset + 1] = reader.getUint8() / 255;\r\n                                    floatData[subOffset + 2] = reader.getUint8() / 255;\r\n                                    floatData[subOffset + 3] = reader.getUint8() / 255;\r\n                                    verOffset += 16;\r\n                                    break;\r\n                                case \"BLENDINDICES\":\r\n                                    uint8Data[verOffset] = reader.getUint8();\r\n                                    uint8Data[verOffset + 1] = reader.getUint8();\r\n                                    uint8Data[verOffset + 2] = reader.getUint8();\r\n                                    uint8Data[verOffset + 3] = reader.getUint8();\r\n                                    verOffset += 4;\r\n                                    break;\r\n                                case \"TANGENT\":\r\n                                    subOffset = verOffset / 4;\r\n                                    floatData[subOffset] = reader.getUint8() / 127.5 - 1;\r\n                                    floatData[subOffset + 1] = reader.getUint8() / 127.5 - 1;\r\n                                    floatData[subOffset + 2] = reader.getUint8() / 127.5 - 1;\r\n                                    floatData[subOffset + 3] = reader.getUint8() / 127.5 - 1;\r\n                                    verOffset += 16;\r\n                                    break;\r\n                            }\r\n                        }\r\n                    }\r\n                    reader.pos = lastPosition;\r\n                    break;\r\n            }\r\n\r\n            var vertexBuffer: VertexBuffer3D = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vertexData.byteLength, BufferUsage.Static, true);\r\n            vertexBuffer.vertexDeclaration = vertexDeclaration;\r\n            vertexBuffer.setData(vertexData);\r\n            var vertexCount: number = vertexBuffer._byteLength / vertexDeclaration.vertexStride;\r\n            //TDDO:\r\n            if (vertexCount > 65535)\r\n                mesh._indexFormat = IndexFormat.UInt32;\r\n            else\r\n                mesh._indexFormat = IndexFormat.UInt16;\r\n            mesh._vertexBuffer = vertexBuffer;\r\n            mesh._vertexCount += vertexCount;\r\n            memorySize += floatData.length * 4;\r\n        }\r\n\r\n        var ibStart: number = offset + reader.getUint32();\r\n        var ibLength: number = reader.getUint32();\r\n\r\n        var ibDatas: Uint16Array | Uint32Array;\r\n        if (mesh.indexFormat == IndexFormat.UInt32)\r\n            ibDatas = new Uint32Array(arrayBuffer.slice(ibStart, ibStart + ibLength));\r\n        else\r\n            ibDatas = new Uint16Array(arrayBuffer.slice(ibStart, ibStart + ibLength));\r\n\r\n        var indexBuffer: IndexBuffer3D = Laya3DRender.renderOBJCreate.createIndexBuffer3D(mesh.indexFormat, ibDatas.length, BufferUsage.Static, true);\r\n        indexBuffer.setData(ibDatas);\r\n        mesh._indexBuffer = indexBuffer;\r\n\r\n        mesh._setBuffer(mesh._vertexBuffer, indexBuffer);\r\n\r\n        memorySize += indexBuffer.indexCount * 2;\r\n        mesh._setCPUMemory(memorySize);\r\n        mesh._setGPUMemory(memorySize);\r\n\r\n        if (LoadModelV05._version == \"LAYAMODEL:0501\" || LoadModelV05._version == \"LAYAMODEL:COMPRESSION_0501\" || LoadModelV05._version == \"LAYAMODEL:0502\") {\r\n            var bounds = mesh.bounds;\r\n            var min: Vector3 = bounds.getMin();\r\n            var max: Vector3 = bounds.getMax();\r\n            min.setValue(reader.getFloat32(), reader.getFloat32(), reader.getFloat32());\r\n            max.setValue(reader.getFloat32(), reader.getFloat32(), reader.getFloat32());\r\n            bounds.setMin(min);\r\n            bounds.setMax(max);\r\n            mesh.bounds = bounds;\r\n        }\r\n\r\n        var boneNames: string[] = mesh._boneNames = [];\r\n        var boneCount: number = reader.getUint16();\r\n        boneNames.length = boneCount;\r\n        for (i = 0; i < boneCount; i++)\r\n            boneNames[i] = LoadModelV05._strings[reader.getUint16()];//[]\r\n\r\n        var bindPoseDataStart: number = reader.getUint32();\r\n        var bindPoseDataLength: number = reader.getUint32();\r\n        var bindPoseDatas: Float32Array = new Float32Array(arrayBuffer.slice(offset + bindPoseDataStart, offset + bindPoseDataStart + bindPoseDataLength));\r\n        var bindPoseFloatCount: number = bindPoseDatas.length;\r\n        var bindPoseBuffer: ArrayBuffer = mesh._inverseBindPosesBuffer = new ArrayBuffer(bindPoseFloatCount * 4);//TODO:[NATIVE]\r\n        mesh._inverseBindPoses = [];\r\n        if (bindPoseFloatCount != 0)\r\n            mesh._instanceBufferStateType = Mesh.MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR;\r\n        else\r\n            mesh._instanceBufferStateType = Mesh.MESH_INSTANCEBUFFER_TYPE_NORMAL;\r\n        //mesh._setInstanceBuffer(mesh._instanceBufferStateType);\r\n        for (i = 0; i < bindPoseFloatCount; i += 16) {\r\n            var inverseGlobalBindPose: Matrix4x4 = new Matrix4x4(bindPoseDatas[i + 0], bindPoseDatas[i + 1], bindPoseDatas[i + 2], bindPoseDatas[i + 3], bindPoseDatas[i + 4], bindPoseDatas[i + 5], bindPoseDatas[i + 6], bindPoseDatas[i + 7], bindPoseDatas[i + 8], bindPoseDatas[i + 9], bindPoseDatas[i + 10], bindPoseDatas[i + 11], bindPoseDatas[i + 12], bindPoseDatas[i + 13], bindPoseDatas[i + 14], bindPoseDatas[i + 15], new Float32Array(bindPoseBuffer, i * 4, 16));\r\n            mesh._inverseBindPoses[i / 16] = inverseGlobalBindPose;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static READ_SUBMESH(): boolean {\r\n        var reader: Byte = LoadModelV05._readData;\r\n        var arrayBuffer: ArrayBuffer = reader.__getBuffer();\r\n        var subMesh: SubMesh = new SubMesh(LoadModelV05._mesh);\r\n\r\n        reader.getInt16();//TODO:vbIndex\r\n        var ibStart: number = reader.getUint32();\r\n        var ibCount: number = reader.getUint32();\r\n        var indexBuffer: IndexBuffer3D = LoadModelV05._mesh._indexBuffer;\r\n        subMesh._indexBuffer = indexBuffer;\r\n        subMesh._setIndexRange(ibStart, ibCount);\r\n        var vertexBuffer: VertexBuffer3D = LoadModelV05._mesh._vertexBuffer;\r\n        subMesh._vertexBuffer = vertexBuffer;\r\n\r\n        var offset: number = LoadModelV05._DATA.offset;\r\n        var subIndexBufferStart: number[] = subMesh._subIndexBufferStart;\r\n        var subIndexBufferCount: number[] = subMesh._subIndexBufferCount;\r\n        var boneIndicesList: Uint16Array[] = subMesh._boneIndicesList;\r\n        var drawCount: number = reader.getUint16();\r\n        subIndexBufferStart.length = drawCount;\r\n        subIndexBufferCount.length = drawCount;\r\n        boneIndicesList.length = drawCount;\r\n\r\n        var skinnedCache: skinnedMatrixCache[] = LoadModelV05._mesh._skinnedMatrixCaches;\r\n        var subMeshIndex: number = LoadModelV05._subMeshes.length;\r\n        skinnedCache.length = LoadModelV05._mesh._inverseBindPoses.length;\r\n        for (var i: number = 0; i < drawCount; i++) {\r\n            subIndexBufferStart[i] = reader.getUint32();\r\n            subIndexBufferCount[i] = reader.getUint32();\r\n            var boneDicofs: number = reader.getUint32();\r\n            var boneDicCount: number = reader.getUint32();\r\n            var boneIndices: Uint16Array = boneIndicesList[i] = new Uint16Array(arrayBuffer.slice(offset + boneDicofs, offset + boneDicofs + boneDicCount));\r\n            for (var j: number = 0, m: number = boneIndices.length; j < m; j++) {\r\n                var index: number = boneIndices[j];\r\n                skinnedCache[index] || (skinnedCache[index] = new skinnedMatrixCache(subMeshIndex, i, j));\r\n            }\r\n        }\r\n        LoadModelV05._subMeshes.push(subMesh);\r\n        return true;\r\n    }\r\n\r\n    private static READ_MORPH(): boolean {\r\n\r\n        let reader: Byte = LoadModelV05._readData;\r\n        let arrayBuffer: ArrayBuffer = reader.__getBuffer();\r\n        let offset = LoadModelV05._DATA.offset;\r\n        let mesh = LoadModelV05._mesh;\r\n\r\n        let morphData = mesh.morphTargetData = new MorphTargetData();\r\n\r\n        let morphVertexDecStr = LoadModelV05._strings[reader.getUint16()];\r\n\r\n        morphData.vertexDec = VertexMesh.getVertexDeclaration(morphVertexDecStr);\r\n\r\n        let bounds = morphData.bounds;\r\n        let min = bounds.getMin();\r\n        let max = bounds.getMax();\r\n        min.set(reader.getFloat32(), reader.getFloat32(), reader.getFloat32());\r\n        max.set(reader.getFloat32(), reader.getFloat32(), reader.getFloat32());\r\n        bounds.setMin(min);\r\n        bounds.setMax(max);\r\n\r\n        let channelCount = reader.readUint16();\r\n\r\n        for (let channelIndex = 0; channelIndex < channelCount; channelIndex++) {\r\n            let channel = new MorphTargetChannel();\r\n            channel.name = LoadModelV05._strings[reader.getUint16()];\r\n            let targetCount = reader.readUint16();\r\n            for (let targetIndex = 0; targetIndex < targetCount; targetIndex++) {\r\n                let target = new MorphTarget();\r\n                let targetName = LoadModelV05._strings[reader.getUint16()];\r\n                target.name = targetName;\r\n                target.fullWeight = reader.readFloat32();\r\n                let bufferStart = reader.readUint32();\r\n                let bufferLength = reader.readUint32();\r\n                target.data = new Float32Array(arrayBuffer.slice(offset + bufferStart, offset + bufferStart + bufferLength));\r\n\r\n                channel.addTarget(target);\r\n            }\r\n            morphData.addMorphChannel(channel);\r\n        }\r\n\r\n        morphData.vertexCount = mesh.vertexCount;\r\n        morphData.initData();\r\n\r\n        return true;\r\n    }\r\n\r\n    private static READ_UVSIZE(): void {\r\n        LoadModelV05._mesh._width = LoadModelV05._readData.readUint16();\r\n        LoadModelV05._mesh._height = LoadModelV05._readData.readUint16();\r\n    }\r\n}\r\n\r\n\r\n","import { Byte } from \"../../utils/Byte\";\r\nimport { Mesh } from \"../resource/models/Mesh\";\r\nimport { SubMesh } from \"../resource/models/SubMesh\";\r\nimport { LoadModelV04 } from \"./LoadModelV04\";\r\nimport { LoadModelV05 } from \"./LoadModelV05\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class MeshReader {\r\n\t/**\r\n\t *@internal\r\n\t */\r\n\tstatic _parse(data: ArrayBuffer): Mesh {\r\n\t\tvar mesh: Mesh = new Mesh();\r\n\t\tMeshReader.read(data, mesh, mesh._subMeshes);\r\n\t\treturn mesh;\r\n\t}\r\n\r\n\tstatic read(data: ArrayBuffer, mesh: Mesh, subMeshes: SubMesh[]): void {\r\n\t\tvar readData: Byte = new Byte(data);\r\n\t\treadData.pos = 0;\r\n\t\tvar version: string = readData.readUTFString();\r\n\t\tswitch (version) {\r\n\t\t\tcase \"LAYAMODEL:0301\":\r\n\t\t\tcase \"LAYAMODEL:0400\":\r\n\t\t\tcase \"LAYAMODEL:0401\":\r\n\t\t\t\tLoadModelV04.parse(readData, version, mesh, subMeshes);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"LAYAMODEL:05\":\r\n\t\t\tcase \"LAYAMODEL:COMPRESSION_05\":\r\n\t\t\tcase \"LAYAMODEL:0501\":\r\n\t\t\tcase \"LAYAMODEL:COMPRESSION_0501\":\r\n\t\t\tcase \"LAYAMODEL:0502\":\r\n\t\t\t\tLoadModelV05.parse(readData, version, mesh, subMeshes);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"unknown mesh version: \" + version);\r\n\t\t}\r\n\t\tmesh._setSubMeshes(subMeshes);\r\n\t\tif (version != \"LAYAMODEL:0501\" && version != \"LAYAMODEL:COMPRESSION_0501\" && version != \"LAYAMODEL:0502\")//compatible\r\n\t\t\tmesh.calculateBounds();\r\n\t}\r\n}\r\n\r\n","import { IResourceLoader, ILoadTask, Loader } from \"../../net/Loader\";\r\nimport { AssetDb } from \"../../resource/AssetDb\";\r\nimport { MeshReader } from \"./MeshReader\";\r\n\r\nclass MeshLoader implements IResourceLoader {\r\n    load(task: ILoadTask) {\r\n        let url = AssetDb.inst.getSubAssetURL(task.url, task.uuid, null, \"lm\");\r\n        return task.loader.fetch(url, \"arraybuffer\", task.progress.createCallback(), task.options).then(data => {\r\n            if (!data)\r\n                return null;\r\n\r\n            return MeshReader._parse(data);\r\n        });\r\n    }\r\n}\r\n\r\nLoader.registerLoader([\"lm\"], MeshLoader, Loader.MESH);","import { Component } from \"../../components/Component\";\r\nimport { Node } from \"../../display/Node\";\r\nimport { Camera } from \"../core/Camera\";\r\nimport { DirectionLight } from \"../core/light/DirectionLight\";\r\nimport { PointLight } from \"../core/light/PointLight\";\r\nimport { SpotLight } from \"../core/light/SpotLight\";\r\nimport { MeshSprite3D } from \"../core/MeshSprite3D\";\r\nimport { ShuriKenParticle3D } from \"../core/particleShuriKen/ShuriKenParticle3D\";\r\nimport { RenderableSprite3D } from \"../core/RenderableSprite3D\";\r\nimport { Scene3D } from \"../core/scene/Scene3D\";\r\nimport { SkinnedMeshSprite3D } from \"../core/SkinnedMeshSprite3D\";\r\nimport { Sprite3D } from \"../core/Sprite3D\";\r\nimport { TrailSprite3D } from \"../core/trail/TrailSprite3D\";\r\nimport { ClassUtils } from \"../../utils/ClassUtils\";\r\nimport { SimpleSkinnedMeshSprite3D } from \"../core/SimpleSkinnedMeshSprite3D\";\r\nimport { ILoadURL, Loader } from \"../../net/Loader\";\r\nimport { URL } from \"../../net/URL\";\r\nimport { HierarchyLoader } from \"../../loaders/HierarchyLoader\";\r\nimport { ReflectionProbe } from \"../component/Volume/reflectionProbe/ReflectionProbe\";\r\n\r\n/**\r\n * @internal\r\n * <code>Utils3D</code> 3D\r\n */\r\nclass HierarchyParserV2 {\r\n    /**\r\n     * @internal\r\n     * @param nodeData \r\n     * @param spriteMap \r\n     * @param outBatchSprites \r\n     */\r\n    private static _createSprite3DInstance(nodeData: any, spriteMap: any, outBatchSprites: RenderableSprite3D[]): Node {\r\n        let node: Node;\r\n        switch (nodeData.type) {\r\n            case \"Scene3D\":\r\n                node = new Scene3D();\r\n                break;\r\n            case \"Sprite3D\":\r\n                node = new Sprite3D();\r\n                break;\r\n            case \"MeshSprite3D\":\r\n                node = new MeshSprite3D();\r\n                (outBatchSprites && nodeData.props.isStatic) && (outBatchSprites.push(<MeshSprite3D>node));\r\n                break;\r\n            case \"SkinnedMeshSprite3D\":\r\n                node = new SkinnedMeshSprite3D();\r\n                break;\r\n            case \"SimpleSkinnedMeshSprite3D\":\r\n                node = new SimpleSkinnedMeshSprite3D();\r\n                break;\r\n            case \"ShuriKenParticle3D\":\r\n                node = new ShuriKenParticle3D();\r\n                break;\r\n            case \"Camera\":\r\n                node = new Camera();\r\n                break;\r\n            case \"DirectionLight\":\r\n                node = new DirectionLight();\r\n                break;\r\n            case \"PointLight\":\r\n                node = new PointLight();\r\n                break;\r\n            case \"SpotLight\":\r\n                node = new SpotLight();\r\n                break;\r\n            case \"TrailSprite3D\":\r\n                node = new TrailSprite3D();\r\n                break;\r\n            case \"ReflectionProbe\":\r\n                node = new Sprite3D();\r\n                node.addComponent(ReflectionProbe);\r\n                break;\r\n            default:\r\n                throw new Error(\"Utils3D:unidentified class type in (.lh) file.\");\r\n        }\r\n\r\n        let childData: any[] = nodeData.child;\r\n        if (childData) {\r\n            for (let i: number = 0, n: number = childData.length; i < n; i++) {\r\n                let child: any = HierarchyParserV2._createSprite3DInstance(childData[i], spriteMap, outBatchSprites)\r\n                node.addChild(child);\r\n            }\r\n        }\r\n\r\n        spriteMap[nodeData.instanceID] = node;\r\n        return node;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param nodeData \r\n     * @param spriteMap \r\n     * @param interactMap \r\n     */\r\n    private static _createComponentInstance(nodeData: any, spriteMap: any, interactMap: any): void {\r\n        let node: Node = spriteMap[nodeData.instanceID];\r\n        node._parse(nodeData.props, spriteMap);\r\n\r\n        let childData: any[] = nodeData.child;\r\n        if (childData) {\r\n            for (let i: number = 0, n: number = childData.length; i < n; i++)\r\n                HierarchyParserV2._createComponentInstance(childData[i], spriteMap, interactMap)\r\n        }\r\n\r\n        let componentsData: any[] = nodeData.components;\r\n        if (componentsData) {\r\n            for (let j: number = 0, m: number = componentsData.length; j < m; j++) {\r\n                let data: any = componentsData[j];\r\n                let cls: any = ClassUtils.getClass(data.type);\r\n                if (cls) {\r\n                    let component: Component = node.addComponent(cls);\r\n                    component._parse(data, interactMap);\r\n                } else {\r\n                    console.warn(`Unidentified component type: ${data.type}.`);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _createNodeByJson02(nodeData: any, outBatchSprites: RenderableSprite3D[]): Node {\r\n        let spriteMap: any = {};\r\n        let interactMap: any = { component: [], data: [] };\r\n        let node: Node = HierarchyParserV2._createSprite3DInstance(nodeData, spriteMap, outBatchSprites);\r\n        HierarchyParserV2._createComponentInstance(nodeData, spriteMap, interactMap);\r\n        HierarchyParserV2._createInteractInstance(interactMap, spriteMap);\r\n        return node;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _createInteractInstance(interatMap: any, spriteMap: any) {\r\n        let components: Component[] = interatMap.component;\r\n        let data = interatMap.data;\r\n        for (let i = 0, n = components.length; i < n; i++) {\r\n            components[i]._parseInteractive(data[i], spriteMap);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *@internal\r\n     */\r\n    static parse(data: any) {\r\n        let json: any = data.data;\r\n        let outBatchSprits: RenderableSprite3D[] = [];\r\n        let sprite: Sprite3D | Scene3D;\r\n        switch (data.version) {\r\n            case \"LAYAHIERARCHY:02\":\r\n            case \"LAYASCENE3D:02\":\r\n                sprite = (<Sprite3D | Scene3D>HierarchyParserV2._createNodeByJson02(json, outBatchSprits));\r\n                break;\r\n            default:\r\n                sprite = (<Sprite3D | Scene3D>HierarchyParserV2._createNodeByJson(json, outBatchSprits));\r\n        }\r\n\r\n        //StaticBatchManager.combine((sprite instanceof Sprite3D) ? sprite : null, outBatchSprits);\r\n        return sprite;\r\n    }\r\n\r\n    //--------------------------------------------------------------------------------------------------------------------------------\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _createNodeByJson(nodeData: any, outBatchSprites: RenderableSprite3D[]): Node {//\r\n        let node: Node;\r\n        switch (nodeData.type) {\r\n            case \"Scene3D\":\r\n                node = new Scene3D();\r\n                break;\r\n            case \"Sprite3D\":\r\n                node = new Sprite3D();\r\n                break;\r\n            case \"MeshSprite3D\":\r\n                node = new MeshSprite3D();\r\n                (outBatchSprites && nodeData.props.isStatic) && (outBatchSprites.push(<MeshSprite3D>node));\r\n                break;\r\n            case \"SkinnedMeshSprite3D\":\r\n                node = new SkinnedMeshSprite3D();\r\n                break;\r\n            case \"ShuriKenParticle3D\":\r\n                node = new ShuriKenParticle3D();\r\n                break;\r\n            case \"Camera\":\r\n                node = new Camera();\r\n                break;\r\n            case \"DirectionLight\":\r\n                node = new DirectionLight();\r\n                break;\r\n            case \"PointLight\":\r\n                node = new PointLight();\r\n                break;\r\n            case \"SpotLight\":\r\n                node = new SpotLight();\r\n                break;\r\n            case \"TrailSprite3D\":\r\n                node = new TrailSprite3D();\r\n                break;\r\n            default:\r\n                throw new Error(`Unidentified node type ${nodeData.type}`);\r\n        }\r\n\r\n        let childData: any[] = nodeData.child;\r\n        if (childData) {\r\n            for (let i: number = 0, n: number = childData.length; i < n; i++) {\r\n                let child: any = HierarchyParserV2._createNodeByJson(childData[i], outBatchSprites)\r\n                node.addChild(child);\r\n            }\r\n        }\r\n\r\n        let componentsData: any[] = nodeData.components;\r\n        if (componentsData) {\r\n            for (let j: number = 0, m: number = componentsData.length; j < m; j++) {\r\n                let data: any = componentsData[j];\r\n                let clas: any = ClassUtils.getClass(data.type);\r\n                if (clas) {\r\n                    let component: Component = node.addComponent(clas);\r\n                    component._parse(data);\r\n                } else {\r\n                    console.warn(`Unidentified component type: ${data.type}.`);\r\n                }\r\n            }\r\n        }\r\n        node._parse(nodeData.props, null);\r\n        return node;\r\n    }\r\n\r\n    public static collectResourceLinks(data: any, basePath: string): (string | ILoadURL)[] {\r\n        let test: Record<string, string> = {};\r\n        let innerUrls: ILoadURL[] = [];\r\n\r\n        function addInnerUrl(url: string, type: string, constructParams?: any, propertyParams?: any) {\r\n            let url2 = test[url];\r\n            if (url2 === undefined) {\r\n                url2 = URL.join(basePath, url);\r\n                innerUrls.push({ url: url2, type: type, constructParams: constructParams, propertyParams: propertyParams });\r\n                test[url] = url2;\r\n            }\r\n            return url2;\r\n        }\r\n\r\n        function check(nodeData: any) {\r\n            let props: any = nodeData.props;\r\n            switch (nodeData.type) {\r\n                case \"Scene3D\":\r\n                    let lightmaps: any[] = props.lightmaps;\r\n                    if (lightmaps) {\r\n                        for (let i = 0, n = lightmaps.length; i < n; i++) {\r\n                            let lightMap: any = lightmaps[i];\r\n                            if (lightMap.path) {\r\n                                lightMap.path = addInnerUrl(lightMap.path, Loader.TEXTURE2D, lightMap.constructParams, lightMap.propertyParams);\r\n                            }\r\n                            else {\r\n                                let lightmapColorData: any = lightMap.color;\r\n                                lightmapColorData.path = addInnerUrl(lightmapColorData.path, Loader.TEXTURE2D, lightmapColorData.constructParams, lightmapColorData.propertyParams);\r\n                                let lightmapDirectionData: any = lightMap.direction;\r\n                                if (lightmapDirectionData)\r\n                                    lightmapDirectionData.path = addInnerUrl(lightmapDirectionData.path, Loader.TEXTURE2D, lightmapDirectionData.constructParams, lightmapDirectionData.propertyParams);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    //\r\n                    let reflectionTextureData: string = props.reflectionTexture;\r\n                    (reflectionTextureData) && (props.reflection = addInnerUrl(reflectionTextureData, Loader.TEXTURECUBE));\r\n\r\n                    let reflectionData: string = props.reflection;\r\n                    (reflectionData) && (props.reflection = addInnerUrl(reflectionData, Loader.TEXTURECUBE));\r\n                    if (props.sky) {\r\n                        let skyboxMaterial: any = props.sky.material;\r\n                        (skyboxMaterial) && (skyboxMaterial.path = addInnerUrl(skyboxMaterial.path, Loader.MATERIAL));\r\n                    }\r\n                    break;\r\n                case \"Camera\":\r\n                    let skyboxMatData: any = props.skyboxMaterial;\r\n                    (skyboxMatData) && (skyboxMatData.path = addInnerUrl(skyboxMatData.path, Loader.MATERIAL));\r\n                    break;\r\n                case \"TrailSprite3D\":\r\n                case \"MeshSprite3D\":\r\n                case \"SkinnedMeshSprite3D\":\r\n                case \"SimpleSkinnedMeshSprite3D\":\r\n                    let meshPath: string = props.meshPath;\r\n                    (meshPath) && (props.meshPath = addInnerUrl(meshPath, Loader.MESH));\r\n                    let materials: any[] = props.materials;\r\n                    if (materials)\r\n                        for (let i = 0, n = materials.length; i < n; i++)\r\n                            materials[i].path = addInnerUrl(materials[i].path, Loader.MATERIAL);\r\n                    if (nodeData.type == \"SimpleSkinnedMeshSprite3D\")\r\n                        if (props.animatorTexture)\r\n                            props.animatorTexture = addInnerUrl(props.animatorTexture, Loader.TEXTURE2D)\r\n                    break;\r\n\r\n                case \"ShuriKenParticle3D\":\r\n                    if (props.main) {\r\n                        let resources: any = props.renderer.resources;\r\n                        let mesh: string = resources.mesh;\r\n                        let material: string = resources.material;\r\n                        (mesh) && (resources.mesh = addInnerUrl(mesh, Loader.MESH));\r\n                        (material) && (resources.material = addInnerUrl(material, Loader.MATERIAL));\r\n                    }\r\n                    else {//\r\n                        let parMeshPath: string = props.meshPath;\r\n                        (parMeshPath) && (props.meshPath = addInnerUrl(parMeshPath, Loader.MESH));\r\n                        props.material.path = addInnerUrl(props.material.path, Loader.MATERIAL);\r\n                    }\r\n                    break;\r\n                case \"Terrain\":\r\n                    addInnerUrl(props.dataPath, Loader.TERRAINRES);\r\n                    break;\r\n                case \"ReflectionProbe\":\r\n                    let reflection = props.reflection;\r\n                    (reflection) && (props.reflection = addInnerUrl(reflection, Loader.TEXTURECUBE));\r\n                    break;\r\n            }\r\n\r\n            let components: any[] = nodeData.components;\r\n            if (components) {\r\n                for (let k: number = 0, p: number = components.length; k < p; k++) {\r\n                    let component: any = components[k];\r\n                    switch (component.type) {\r\n                        case \"Animator\":\r\n                            // let avatarData: any = component.avatar;\r\n                            // (avatarData) && (avatarData.path = addInnerUrl(avatarData.path, Loader.AVATAR));\r\n                            let clipPaths: string[] = component.clipPaths;\r\n                            if (!clipPaths) {\r\n                                let layersData: any[] = component.layers;\r\n                                for (let i = 0; i < layersData.length; i++) {\r\n                                    let states: any[] = layersData[i].states;\r\n                                    for (let j: number = 0, m: number = states.length; j < m; j++) {\r\n                                        let clipPath: string = states[j].clipPath;\r\n                                        (clipPath) && (states[j].clipPath = addInnerUrl(clipPath, Loader.ANIMATIONCLIP));\r\n                                    }\r\n                                }\r\n                            } else {\r\n                                for (let i = 0, n = clipPaths.length; i < n; i++)\r\n                                    clipPaths[i] = addInnerUrl(clipPaths[i], Loader.ANIMATIONCLIP);\r\n                            }\r\n                            break;\r\n                        case \"PhysicsCollider\":\r\n                        case \"Rigidbody3D\":\r\n                        case \"CharacterController\":\r\n                            let shapes: any[] = component.shapes;\r\n                            for (let i = 0; i < shapes.length; i++) {\r\n                                let shape: any = shapes[i];\r\n                                if (shape.type === \"MeshColliderShape\") {\r\n                                    let mesh: string = shape.mesh;\r\n                                    (mesh) && (shape.mesh = addInnerUrl(mesh, Loader.MESH));\r\n                                }\r\n                            }\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            let children: any[] = nodeData.child;\r\n            if (!children) return;\r\n            for (let i = 0, n = children.length; i < n; i++)\r\n                check(children[i]);\r\n        }\r\n\r\n        check(data.data);\r\n\r\n        return innerUrls;\r\n    }\r\n}\r\n\r\nHierarchyLoader.v2 = HierarchyParserV2;","import { IResourceLoader, ILoadTask, Loader } from \"../../net/Loader\";\r\nimport { AvatarMask } from \"../component/Animator/AvatarMask\";\r\n\r\nclass AvatarMaskLoader implements IResourceLoader {\r\n    load(task: ILoadTask) {\r\n        return task.loader.fetch(task.url, \"json\", task.progress.createCallback(), task.options).then(data => {\r\n            if (!data)\r\n                return null;\r\n\r\n            return new AvatarMask(data);\r\n        });\r\n}\r\n}\r\n\r\nLoader.registerLoader([\"lavm\"], AvatarMaskLoader);","import { ILoadTask, IResourceLoader, Loader } from \"../../net/Loader\";\r\nimport { ShaderCompile } from \"../../webgl/utils/ShaderCompile\";\r\n\r\nclass GLSLLoader implements IResourceLoader {\r\n    load(task: ILoadTask) {\r\n        let url = task.url;\r\n        return task.loader.fetch(url, \"text\", task.progress.createCallback(), task.options).then(data => {\r\n            if (!data)\r\n                return null;\r\n\r\n            return ShaderCompile.addInclude(task.url, data, true);\r\n        });\r\n    }\r\n}\r\n\r\nLoader.registerLoader([\"glsl\", \"vs\", \"fs\"], GLSLLoader);","import { TypeAnimatorLayer, TypeAnimatorState } from \"../../components/AnimatorControllerParse\";\r\nimport { IResourceLoader, ILoadTask, Loader } from \"../../net/Loader\";\r\nimport { AnimatorController } from \"../component/Animator/AnimatorController\";\r\nimport { URL } from \"../../net/URL\";\r\nclass AnimationControllerLoader implements IResourceLoader {\r\n    load(task: ILoadTask) {\r\n        return task.loader.fetch(task.url, \"json\", task.progress.createCallback(0.2), task.options).then(data => {\r\n            let ret = new AnimatorController(data);\r\n            if (ret.data && ret.data.controllerLayers) {\r\n                let layers = ret.data.controllerLayers;\r\n                let promises: Array<any> = [];\r\n                for (let i = layers.length - 1; i >= 0; i--) {\r\n                    if (layers[i].avatarMask) {\r\n                        this.loadAvatarMask(layers[i], promises, task);\r\n                    }\r\n                    let states = layers[i].states;\r\n                    this.loadStates(states, promises, task);\r\n\r\n                }\r\n                return Promise.all(promises).then(() => ret);\r\n            }\r\n            else\r\n                return ret;\r\n        });\r\n    }\r\n    loadAvatarMask(l: TypeAnimatorLayer, promises: Array<any>, task: ILoadTask) {\r\n        let basePath = URL.getPath(task.url);\r\n        if (l.avatarMask && l.avatarMask._$uuid && '' != l.avatarMask._$uuid) {\r\n            let url = URL.getResURLByUUID(l.avatarMask._$uuid);\r\n            if (!url.startsWith(\"res://\"))\r\n                url = URL.join(basePath, url);\r\n            promises.push(task.loader.load(url).then(res => {\r\n                l.avatarMask = res;\r\n            }));\r\n        } else {\r\n            l.avatarMask = null;\r\n        }\r\n    }\r\n\r\n    loadStates(states: TypeAnimatorState[], promises: Array<any>, task: ILoadTask) {\r\n        let basePath = URL.getPath(task.url);\r\n        for (let j = states.length - 1; j >= 0; j--) {\r\n            if (states[j].clip && states[j].clip._$uuid) {\r\n                let url = URL.getResURLByUUID(states[j].clip._$uuid);\r\n                if (!url.startsWith(\"res://\"))\r\n                    url = URL.join(basePath, url);\r\n                promises.push(task.loader.load(url).then(res => {\r\n                    states[j].clip = res;\r\n                }));\r\n\r\n                // promises.push(task.loader.load(\"res://\" + states[j].clip._$uuid).then(res => {\r\n                //     states[j].clip = res;\r\n                // }));\r\n            }\r\n\r\n            if (states[j].states) {\r\n                this.loadStates(states[j].states, promises, task);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nLoader.registerLoader([\"controller\"], AnimationControllerLoader);","import { ClassUtils } from \"../utils/ClassUtils\";\r\nimport { AnimationClip } from \"./animation/AnimationClip\";\r\nimport { Sprite3D } from \"./core/Sprite3D\";\r\nimport { Camera } from \"./core/Camera\";\r\nimport { Gradient } from \"./core/Gradient\";\r\nimport { DirectionLight } from \"./core/light/DirectionLight\";\r\nimport { LightSprite } from \"./core/light/LightSprite\";\r\nimport { PointLight } from \"./core/light/PointLight\";\r\nimport { SpotLight } from \"./core/light/SpotLight\";\r\nimport { BlinnPhongMaterial } from \"./core/material/BlinnPhongMaterial\";\r\nimport { EffectMaterial } from \"./core/material/EffectMaterial\";\r\nimport { ExtendTerrainMaterial } from \"./core/material/ExtendTerrainMaterial\";\r\nimport { Material } from \"../resource/Material\";\r\nimport { PBRStandardMaterial } from \"./core/material/PBRStandardMaterial\";\r\nimport { SkyBoxMaterial } from \"./core/material/SkyBoxMaterial\";\r\nimport { SkyPanoramicMaterial } from \"./core/material/SkyPanoramicMaterial\";\r\nimport { SkyProceduralMaterial } from \"./core/material/SkyProceduralMaterial\";\r\nimport { UnlitMaterial } from \"./core/material/UnlitMaterial\";\r\nimport { WaterPrimaryMaterial } from \"./core/material/WaterPrimaryMaterial\";\r\nimport { MeshFilter } from \"./core/MeshFilter\";\r\nimport { MeshRenderer } from \"./core/MeshRenderer\";\r\nimport { MeshSprite3D } from \"./core/MeshSprite3D\";\r\nimport { Burst } from \"./core/particleShuriKen/module/Burst\";\r\nimport { ColorOverLifetime } from \"./core/particleShuriKen/module/ColorOverLifetime\";\r\nimport { Emission } from \"./core/particleShuriKen/module/Emission\";\r\nimport { FrameOverTime } from \"./core/particleShuriKen/module/FrameOverTime\";\r\nimport { GradientAngularVelocity } from \"./core/particleShuriKen/module/GradientAngularVelocity\";\r\nimport { GradientColor } from \"./core/particleShuriKen/module/GradientColor\";\r\nimport { GradientDataInt } from \"./core/particleShuriKen/module/GradientDataInt\";\r\nimport { GradientDataNumber } from \"./core/particleShuriKen/module/GradientDataNumber\";\r\nimport { GradientSize } from \"./core/particleShuriKen/module/GradientSize\";\r\nimport { GradientVelocity } from \"./core/particleShuriKen/module/GradientVelocity\";\r\nimport { RotationOverLifetime } from \"./core/particleShuriKen/module/RotationOverLifetime\";\r\nimport { BaseShape } from \"./core/particleShuriKen/module/shape/BaseShape\";\r\nimport { BoxShape } from \"./core/particleShuriKen/module/shape/BoxShape\";\r\nimport { CircleShape } from \"./core/particleShuriKen/module/shape/CircleShape\";\r\nimport { ConeShape } from \"./core/particleShuriKen/module/shape/ConeShape\";\r\nimport { HemisphereShape } from \"./core/particleShuriKen/module/shape/HemisphereShape\";\r\nimport { SphereShape } from \"./core/particleShuriKen/module/shape/SphereShape\";\r\nimport { SizeOverLifetime } from \"./core/particleShuriKen/module/SizeOverLifetime\";\r\nimport { StartFrame } from \"./core/particleShuriKen/module/StartFrame\";\r\nimport { TextureSheetAnimation } from \"./core/particleShuriKen/module/TextureSheetAnimation\";\r\nimport { VelocityOverLifetime } from \"./core/particleShuriKen/module/VelocityOverLifetime\";\r\nimport { ShuriKenParticle3D } from \"./core/particleShuriKen/ShuriKenParticle3D\";\r\nimport { ShurikenParticleMaterial } from \"./core/particleShuriKen/ShurikenParticleMaterial\";\r\nimport { ShurikenParticleRenderer } from \"./core/particleShuriKen/ShurikenParticleRenderer\";\r\nimport { ShurikenParticleSystem } from \"./core/particleShuriKen/ShurikenParticleSystem\";\r\nimport { BaseRender } from \"./core/render/BaseRender\";\r\nimport { RenderableSprite3D } from \"./core/RenderableSprite3D\";\r\nimport { Lightmap } from \"./core/scene/Lightmap\";\r\nimport { Scene3D } from \"./core/scene/Scene3D\";\r\nimport { SimpleSkinnedMeshRenderer } from \"./core/SimpleSkinnedMeshRenderer\";\r\nimport { SimpleSkinnedMeshSprite3D } from \"./core/SimpleSkinnedMeshSprite3D\";\r\nimport { SkinnedMeshRenderer } from \"./core/SkinnedMeshRenderer\";\r\nimport { SkinnedMeshSprite3D } from \"./core/SkinnedMeshSprite3D\";\r\nimport { TrailFilter } from \"./core/trail/TrailFilter\";\r\nimport { TrailMaterial } from \"./core/trail/TrailMaterial\";\r\nimport { TrailRenderer } from \"./core/trail/TrailRenderer\";\r\nimport { TrailSprite3D } from \"./core/trail/TrailSprite3D\";\r\nimport { Transform3D } from \"./core/Transform3D\";\r\nimport { SphericalHarmonicsL2 } from \"./graphics/SphericalHarmonicsL2\";\r\nimport { BoundBox } from \"./math/BoundBox\";\r\nimport { Viewport } from \"./math/Viewport\";\r\nimport { Mesh } from \"./resource/models/Mesh\";\r\nimport { SkyRenderer } from \"./resource/models/SkyRenderer\";\r\nimport { TextureCube } from \"../resource/TextureCube\";\r\nimport { DirectionLightCom } from \"./core/light/DirectionLightCom\";\r\nimport { PointLightCom } from \"./core/light/PointLightCom\";\r\nimport { SpotLightCom } from \"./core/light/SpotLightCom\";\r\nimport { Bounds } from \"./math/Bounds\";\r\nimport { ReflectionProbe } from \"./component/Volume/reflectionProbe/ReflectionProbe\";\r\nimport { VolumetricGI } from \"./component/Volume/VolumetricGI/VolumetricGI\";\r\nimport { AreaLightCom } from \"./core/light/AreaLightCom\";\r\nimport { BoxColliderShape } from \"./physics/shape/BoxColliderShape\";\r\nimport { CapsuleColliderShape } from \"./physics/shape/CapsuleColliderShape\";\r\nimport { CylinderColliderShape } from \"./physics/shape/CylinderColliderShape\";\r\nimport { ConeColliderShape } from \"./physics/shape/ConeColliderShape\";\r\nimport { SphereColliderShape } from \"./physics/shape/SphereColliderShape\";\r\n//import { MeshColliderShape } from \"./physics/shape/MeshColliderShape\";\r\nimport { LODGroup, LODInfo } from \"./component/LODGroup\";\r\nimport { PixelLineData } from \"./core/pixelLine/PixelLineData\";\r\nimport { PixelLineRenderer } from \"./core/pixelLine/PixelLineRenderer\";\r\nimport { FloatKeyframe } from \"./core/FloatKeyframe\";\r\n//import { CompoundColliderShape } from \"./physics/shape/CompoundColliderShape\";\r\nimport { Animator } from \"./component/Animator/Animator\";\r\nimport { AnimatorControllerLayer } from \"./component/Animator/AnimatorControllerLayer\";\r\nimport { AnimatorState } from \"./component/Animator/AnimatorState\";\r\nimport { AvatarMask } from \"./component/Animator/AvatarMask\";\r\nimport { PostProcess } from \"./component/PostProcess\";\r\nimport { PostProcessEffect } from \"./core/render/PostProcessEffect\";\r\nimport { BloomEffect } from \"./core/render/PostEffect/BloomEffect\";\r\nimport { GaussianDoF } from \"./core/render/PostEffect/GaussianDoF\";\r\nimport { ScalableAO } from \"./core/render/PostEffect/ScalableAO\";\r\nimport { AnimatorController } from \"./component/Animator/AnimatorController\";\r\nimport { StaticBatchVolume } from \"./component/Volume/BatchVolume/StaticBatchVolume\";\r\nimport { StaticInstanceBatchRender } from \"./component/Volume/BatchVolume/StaticInstanceBatchRender\";\r\nimport { RenderTexture } from \"../resource/RenderTexture\";\r\nimport { ColorGradEffect } from \"./core/render/PostEffect/ColorGradEffect\";\r\nimport { UI3D } from \"./core/UI3D/UI3D\";\r\nimport \"./loaders/AnimationClipLoader\";\r\nimport \"./loaders/CubemapLoader\";\r\nimport \"./loaders/MeshLoader\";\r\nimport \"./loaders/HierarchyParserV2\";\r\nimport \"./loaders/AvatarMaskLoader\";\r\nimport \"./loaders/GLSLLoader\";\r\nimport \"./loaders/AnimationControllerLoader\";\r\nimport { LensFlareData, LensFlareEffect, LensFlareElement } from \"./core/render/PostEffect/LensFlares/LensFlareEffect\";\r\n\r\n\r\n\r\nlet c = ClassUtils.regClass;\r\nc(\"Sprite3D\", Sprite3D);\r\nc(\"Scene3D\", Scene3D);\r\nc(\"Camera\", Camera);\r\nc(\"LightSprite\", LightSprite);\r\nc(\"DirectionLight\", DirectionLight);\r\nc(\"PointLight\", PointLight);\r\nc(\"SpotLight\", SpotLight);\r\nc(\"AreaLightCom\", AreaLightCom);\r\nc(\"DirectionLightCom\", DirectionLightCom);\r\nc(\"PointLightCom\", PointLightCom);\r\nc(\"SpotLightCom\", SpotLightCom);\r\nc(\"RenderableSprite3D\", RenderableSprite3D);\r\nc(\"MeshSprite3D\", MeshSprite3D);\r\nc(\"MeshFilter\", MeshFilter);\r\nc(\"BaseRender\", BaseRender);\r\nc(\"MeshRenderer\", MeshRenderer);\r\nc(\"SimpleSkinnedMeshSprite3D\", SimpleSkinnedMeshSprite3D);\r\nc(\"SkinnedMeshSprite3D\", SkinnedMeshSprite3D);\r\nc(\"SkinnedMeshRenderer\", SkinnedMeshRenderer);\r\nc(\"SimpleSkinnedMeshRenderer\", SimpleSkinnedMeshRenderer);\r\nc(\"SkyRenderer\", SkyRenderer);\r\nc(\"TrailSprite3D\", TrailSprite3D);\r\nc(\"TrailFilter\", TrailFilter);\r\nc(\"TrailRenderer\", TrailRenderer);\r\nc(\"PixelLineRenderer\", PixelLineRenderer);\r\nc(\"PixelLineData\", PixelLineData);\r\nc(\"Gradient\", Gradient);\r\nc(\"Transform3D\", Transform3D);\r\nc(\"Lightmap\", Lightmap);\r\nc(\"ReflectionProbe\", ReflectionProbe);\r\nc(\"VolumetricGI\", VolumetricGI);\r\nc(\"StaticBatchVolume\", StaticBatchVolume);\r\nc(\"StaticInstanceBatchRender\", StaticInstanceBatchRender);\r\nc(\"SphericalHarmonicsL2\", SphericalHarmonicsL2);\r\nc(\"Viewport\", Viewport);\r\nc(\"Bounds\", Bounds);\r\nc(\"BoundBox\", BoundBox);\r\nc(\"TextureCube\", TextureCube);\r\nc(\"Mesh\", Mesh);\r\nc(\"FloatKeyframe\", FloatKeyframe);\r\nc(\"RenderTexture\", RenderTexture);\r\nc(\"Animator\", Animator);\r\nc(\"AnimatorController\", AnimatorController);\r\nc(\"AnimatorControllerLayer\", AnimatorControllerLayer);\r\nc(\"AnimatorState\", AnimatorState);\r\nc(\"AnimationClip\", AnimationClip);\r\nc(\"AvatarMask\", AvatarMask);\r\nc(\"UI3D\", UI3D);\r\n\r\nc(\"Material\", Material);\r\nc(\"BlinnPhongMaterial\", BlinnPhongMaterial);\r\nc(\"EffectMaterial\", EffectMaterial);\r\nc(\"ExtendTerrainMaterial\", ExtendTerrainMaterial);\r\nc(\"PBRStandardMaterial\", PBRStandardMaterial);\r\nc(\"SkyBoxMaterial\", SkyBoxMaterial);\r\nc(\"SkyPanoramicMaterial\", SkyPanoramicMaterial);\r\nc(\"SkyProceduralMaterial\", SkyProceduralMaterial);\r\nc(\"UnlitMaterial\", UnlitMaterial);\r\nc(\"WaterPrimaryMaterial\", WaterPrimaryMaterial);\r\nc(\"ShurikenParticleMaterial\", ShurikenParticleMaterial);\r\nc(\"TrailMaterial\", TrailMaterial);\r\n\r\nc(\"ShuriKenParticle3D\", ShuriKenParticle3D);\r\nc(\"ShurikenParticleRenderer\", ShurikenParticleRenderer);\r\nc(\"ShurikenParticleSystem\", ShurikenParticleSystem);\r\nc(\"Burst\", Burst);\r\nc(\"Emission\", Emission);\r\nc(\"BaseShape\", BaseShape);\r\nc(\"BoxShape\", BoxShape);\r\nc(\"CircleShape\", CircleShape);\r\nc(\"ConeShape\", ConeShape);\r\nc(\"HemisphereShape\", HemisphereShape);\r\nc(\"SphereShape\", SphereShape);\r\nc(\"FrameOverTime\", FrameOverTime);\r\nc(\"GradientAngularVelocity\", GradientAngularVelocity);\r\nc(\"GradientColor\", GradientColor);\r\nc(\"GradientDataInt\", GradientDataInt);\r\nc(\"GradientDataNumber\", GradientDataNumber);\r\nc(\"GradientSize\", GradientSize);\r\nc(\"GradientVelocity\", GradientVelocity);\r\nc(\"StartFrame\", StartFrame);\r\nc(\"TextureSheetAnimation\", TextureSheetAnimation);\r\nc(\"ColorOverLifetime\", ColorOverLifetime);\r\nc(\"RotationOverLifetime\", RotationOverLifetime);\r\nc(\"SizeOverLifetime\", SizeOverLifetime);\r\nc(\"VelocityOverLifetime\", VelocityOverLifetime);\r\nc(\"LODInfo\", LODInfo);\r\nc(\"LODGroup\", LODGroup);\r\n\r\n\r\nc(\"DirectionLight\", DirectionLight);\r\nc(\"DirectionLightCom\", DirectionLightCom);\r\nc(\"MeshRenderer\", MeshRenderer);\r\nc(\"MeshFilter\", MeshFilter);\r\nc(\"MeshRenderer\", MeshRenderer);\r\nc(\"SkinnedMeshRenderer\", SkinnedMeshRenderer);\r\nc(\"SimpleSkinnedMeshRenderer\", SimpleSkinnedMeshRenderer);\r\nc(\"SkyRenderer\", SkyRenderer);\r\n\r\n// c(\"BoxColliderShape\", BoxColliderShape);\r\n// c(\"CapsuleColliderShape\", CapsuleColliderShape);\r\n// c(\"ConeColliderShape\", ConeColliderShape);\r\n// c(\"CylinderColliderShape\", CylinderColliderShape);\r\n// c(\"SphereColliderShape\", SphereColliderShape);\r\n//c(\"MeshColliderShape\", MeshColliderShape);\r\n//c(\"CompoundColliderShape\", CompoundColliderShape);\r\n\r\nc(\"PostProcess\", PostProcess);\r\nc(\"PostProcessEffect\", PostProcessEffect);\r\nc(\"BloomEffect\", BloomEffect);\r\nc(\"GaussianDoF\", GaussianDoF);\r\nc(\"ScalableAO\", ScalableAO);\r\nc(\"ColorGradEffect\", ColorGradEffect);\r\n\r\nc(\"LensFlareEffect\", LensFlareEffect);\r\nc(\"LensFlareElement\", LensFlareElement);\r\nc(\"LensFlareData\", LensFlareData);","import { IBaseRenderNode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IBaseRenderNode\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\n\r\n\r\nexport class NativeBaseRenderNode implements IBaseRenderNode {\r\n\r\n    private _nativeObj: any;\r\n    private _bounds: Bounds = null;\r\n    private _geometryBounds: Bounds = null;\r\n    private _transform: Transform3D = null;\r\n    constructor() {\r\n        this._nativeObj = new (window as any).conchRenderNode();\r\n    }\r\n    set boundsChange(value: boolean) {\r\n        this._nativeObj.boundsChange = value;\r\n    }\r\n    get boundsChange(): boolean {\r\n        return this._nativeObj.boundsChange;\r\n    }\r\n\r\n    set layer(value: number) {\r\n        this._nativeObj.layer = value;\r\n    }\r\n\r\n    get layer(): number {\r\n        return this._nativeObj.layer;\r\n    }\r\n\r\n    get renderId(): number {\r\n        return this._nativeObj.renderId;\r\n    }\r\n    set renderId(value: number) {\r\n        this._nativeObj.renderId = value;\r\n    }\r\n\r\n    get receiveShadow(): boolean {\r\n        return this._nativeObj.receiveShadow;\r\n    }\r\n    set receiveShadow(value: boolean) {\r\n        this._nativeObj.receiveShadow = value;\r\n    }\r\n\r\n    get castShadow(): boolean {\r\n        return this._nativeObj.castShadow;\r\n    }\r\n    set castShadow(value: boolean) {\r\n        this._nativeObj.castShadow = value;\r\n    }\r\n\r\n    get bounds(): Bounds {\r\n        return this._bounds;\r\n    }\r\n    set bounds(value: Bounds) {\r\n        this._bounds = value;\r\n        this._nativeObj.bounds = (value as any)._imp._nativeObj;\r\n    }\r\n\r\n    sortingFudge: number;\r\n\r\n    get distanceForSort(): number {\r\n        return this._nativeObj.distanceForSort;\r\n    }\r\n    set distanceForSort(value: number) {\r\n        this._nativeObj.distanceForSort = value;\r\n    }\r\n\r\n    get transform(): Transform3D {\r\n        return this._transform;\r\n    }\r\n    set transform(value: Transform3D) {\r\n        this._transform = value;\r\n        this._nativeObj.transform = value ? (value as any)._nativeObj : null;\r\n    }\r\n    \r\n    get owner(): BaseRender | null {\r\n        return this._nativeObj.owner;\r\n    }\r\n    set owner(value: BaseRender | null) {\r\n        this._nativeObj.owner = value;\r\n    }\r\n\r\n    get geometryBounds(): Bounds | null {\r\n        return this._geometryBounds;\r\n    }\r\n\r\n    set geometryBounds(value: Bounds | null) {\r\n        this._geometryBounds = value;\r\n        this._nativeObj.geometryBounds = (value as any)._imp._nativeObj;\r\n    }\r\n\r\n    get renderbitFlag(): number {\r\n        return this._nativeObj.renderbitFlag;\r\n    }\r\n    set renderbitFlag(value: number | null) {\r\n        this._nativeObj.renderbitFlag = value;\r\n    }\r\n    get staticMask(): number {\r\n        return this._nativeObj.staticMask;\r\n    }\r\n    set staticMask(value: number | null) {\r\n        this._nativeObj.staticMask = value;\r\n    }\r\n}","import { RenderCapable } from \"../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { RenderElement } from \"../../core/render/RenderElement\";\r\nimport { SubMeshInstanceBatch } from \"../SubMeshInstanceBatch\";\r\nimport { InstanceBatchManager } from \"./InstanceBatchManager\";\r\nimport { InstanceRenderElement } from \"../../core/render/InstanceRenderElement\";\r\nimport { MeshInstanceGeometry } from \"../MeshInstanceGeometry\";\r\nimport { SubMesh } from \"../../resource/models/SubMesh\";\r\nimport { Config3D } from \"../../../../Config3D\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\n\r\nexport class RenderElementBatch {\r\n    static instance: RenderElementBatch;\r\n    private _instanceBatchManager: InstanceBatchManager;\r\n    private _recoverList: SingletonList<InstanceRenderElement>;\r\n    constructor() {\r\n        RenderElementBatch.instance = this;\r\n        this._instanceBatchManager = InstanceBatchManager.instance;\r\n        this._recoverList = new SingletonList();\r\n    }\r\n\r\n    /**\r\n     * after batchRender\r\n     */\r\n    recoverData() {\r\n        let elements = this._recoverList.elements;\r\n        for (let i = 0, n = this._recoverList.length; i < n; i++) {\r\n            let element = elements[i];\r\n            element.recover();\r\n        }\r\n        this._recoverList.length = 0;\r\n    }\r\n\r\n    /**\r\n     * BatchData\r\n     * @param elements \r\n     */\r\n    batch(elements: SingletonList<RenderElement>) {\r\n        let len = elements.length;\r\n        elements.length = 0;\r\n        this._instanceBatchManager.updateCountMark++;//\r\n        let elementArray = elements.elements;\r\n        for (var i = 0; i < len; i++) {\r\n            let element = elements.elements[i];\r\n            if (!element._canBatch) {\r\n                elements.add(element);\r\n                continue;\r\n            }\r\n            if (element.staticBatch && (!element._baseRender._probReflection || element._baseRender._probReflection._isScene) && Config3D.enableStaticBatch) {\r\n                //static Batch TODO\r\n                elements.add(element);\r\n            }\r\n            else if (Config3D.enableDynamicBatch && LayaGL.renderEngine.getCapable(RenderCapable.DrawElement_Instance)) {\r\n                if (element._subShader._owner._enableInstancing) {\r\n                    var insManager = this._instanceBatchManager;\r\n                    let invertFrontFace = element._transform ? element._transform._isFrontFaceInvert : false;\r\n                    var insBatchMarks = insManager.getInstanceBatchOpaquaMark(element._baseRender._receiveShadow, element._material._id, element._geometry._id, invertFrontFace, element._baseRender._probReflection ? element._baseRender._probReflection._id : -1, element._baseRender.lightmapIndex);\r\n                    if (insManager.updateCountMark === insBatchMarks.updateMark) {\r\n                        //can batch\r\n                        var insBatchIndex: number = insBatchMarks.indexInList;\r\n                        var insOriElement: RenderElement = elementArray[insBatchIndex];\r\n                        if (insBatchMarks.batched) {\r\n                            var instanceelements: SingletonList<RenderElement> = (insOriElement as InstanceRenderElement)._instanceBatchElementList;\r\n                            if (instanceelements.length === SubMeshInstanceBatch.maxInstanceCount) {\r\n                                insBatchMarks.updateMark = insManager.updateCountMark;\r\n                                insBatchMarks.indexInList = elements.length;\r\n                                insBatchMarks.batched = false;\r\n                                elements.add(element);\r\n                            } else {\r\n                                instanceelements.add(element);\r\n                            }\r\n                        } else {\r\n                            //ElementsRenderElementInstanceElement\r\n                            let instanceRenderElement = InstanceRenderElement.create();\r\n                            this._recoverList.add(instanceRenderElement);\r\n                            instanceRenderElement._baseRender = insOriElement._baseRender;\r\n                            instanceRenderElement._renderElementOBJ._renderShaderData = insOriElement._baseRender._shaderValues;\r\n                            instanceRenderElement.renderType = RenderElement.RENDERTYPE_INSTANCEBATCH;\r\n                            //Geometry updaste\r\n                            (instanceRenderElement._geometry as MeshInstanceGeometry).subMesh = (insOriElement._geometry as SubMesh);\r\n                            instanceRenderElement.material = insOriElement._material;\r\n                            instanceRenderElement.setTransform(null);\r\n                            instanceRenderElement._subShader = insOriElement._subShader;\r\n                            let list = instanceRenderElement._instanceBatchElementList;\r\n                            list.length = 0;\r\n                            list.add(insOriElement);\r\n                            list.add(element);\r\n                            elementArray[insBatchIndex] = instanceRenderElement;\r\n                            insBatchMarks.batched = true;\r\n                            instanceRenderElement._isUpdataData = true;\r\n                            instanceRenderElement._invertFrontFace = invertFrontFace;\r\n                        }\r\n                    } else {\r\n                        insBatchMarks.updateMark = insManager.updateCountMark;\r\n                        insBatchMarks.indexInList = elements.length;\r\n                        insBatchMarks.batched = false;\r\n                        elements.add(element);\r\n                    }\r\n                } else\r\n                    elements.add(element);\r\n            }\r\n            else\r\n                elements.add(element);\r\n        }\r\n    }\r\n}","import { UploadMemoryManager } from \"../../../RenderEngine/RenderEngine/NativeGLEngine/CommonMemory/UploadMemoryManager\";\r\nimport { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { IRenderQueue } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderQueue\";\r\nimport { ISortPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISortPass\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { Camera } from \"../../core/Camera\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { RenderElement } from \"../../core/render/RenderElement\";\r\nimport { RenderElementBatch } from \"../../graphics/Batch/RenderElementBatch\";\r\n\r\n\r\nexport class NativeBaseRenderQueue implements IRenderQueue {\r\n   /** @interanl */\r\n    _isTransparent: boolean = false;\r\n   /** @internal */\r\n   elements: SingletonList<RenderElement> = new SingletonList<RenderElement>();\r\n   /**sort function*/\r\n   _sortPass: ISortPass;\r\n   /** context*/\r\n   _context: IRenderContext3D;\r\n   _batch: RenderElementBatch;\r\n    private _nativeObj: any;\r\n    set sortPass(value: ISortPass) {\r\n        this._nativeObj.sortPass = value;\r\n    }\r\n    constructor(isTransparent: boolean) {\r\n        this._isTransparent = isTransparent;\r\n        this._nativeObj = new (window as any).conchRenderQueue(isTransparent);\r\n \t    this._batch = RenderElementBatch.instance ? RenderElementBatch.instance : new RenderElementBatch();\r\n    }\r\n    destroy(): void {\r\n        this._nativeObj.destroy();\r\n    }\r\n\r\n    set context(value:RenderContext3D){\r\n        this._context = value._contextOBJ;\r\n    }\r\n\r\n    addRenderElement(renderelement: RenderElement) {\r\n        this.elements.add(renderelement);\r\n    }\r\n\r\n    clear(): void {\r\n        this._nativeObj.clear();\r\n        this.elements.length = 0;\r\n    }\r\n\r\n    renderQueue(context:RenderContext3D):number {\r\n        this.context = context;\r\n        this._context.applyContext(Camera._updateMark);\r\n        \r\n        var elements: RenderElement[] = this.elements.elements;\r\n\r\n\t\tthis._batchQueue();\r\n        this._nativeObj.clear();\r\n        for (var i: number = 0, n: number = this.elements.length; i < n; i++){\r\n            var render_element = elements[i];\r\n            this._nativeObj.addRenderElement((render_element._renderElementOBJ as any)._nativeObj, \r\n            (render_element.render.renderNode as any)._nativeObj,\r\n            render_element.material.renderQueue, \r\n            render_element.render.sortingFudge);\r\n            render_element._renderUpdatePre(context);//Update Data\r\n        }\r\n\r\n        UploadMemoryManager.syncRenderMemory();\r\n\r\n        BufferState._curBindedBufferState && BufferState._curBindedBufferState.unBind();\r\n        this._nativeObj.renderQueue((this._context as any)._nativeObj);\r\n        \r\n        this._batch.recoverData();\r\n\r\n        return n;\r\n    }\r\n\r\n    private _batchQueue() {\r\n       this._isTransparent || this._batch.batch(this.elements);\r\n    }\r\n}","import { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { NativeMemory } from \"../../../RenderEngine/RenderEngine/NativeGLEngine/CommonMemory/NativeMemory\";\r\nimport { IClone } from \"../../../utils/IClone\";\r\nimport { BoundBox } from \"../../math/BoundBox\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\n\r\n\r\n\r\nexport class NativeBounds implements IClone {\r\n\r\n    /**native Share Memory */\r\n    static MemoryBlock_size: number = Math.max(6 * 8, 16 * 4);\r\n    /**@internal\t*/\r\n    nativeMemory: NativeMemory;\r\n    /**@internal\t*/\r\n    float32Array: Float32Array;\r\n    /**@internal\t*/\r\n    float64Array: Float64Array;\r\n    /**@internal\t*/\r\n    _nativeObj: any;\r\n    /**@internal\t*/\r\n    _center: Vector3 = new Vector3();\r\n    /**@internal\t*/\r\n    _extent: Vector3 = new Vector3();\r\n    /**@internal */\r\n    private _boundBox: BoundBox = new BoundBox(new Vector3(), new Vector3());\r\n\r\n    get min() {\r\n        return this.getMin();\r\n    }\r\n\r\n    set min(value: Vector3) {\r\n        this.setMin(value);\r\n    }\r\n\r\n    get max() {\r\n        return this.getMax();\r\n    }\r\n\r\n    set max(value: Vector3) {\r\n        this.setMax(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setMin(value: Vector3): void {\r\n        this.float64Array[0] = value.x;\r\n        this.float64Array[1] = value.y;\r\n        this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setMin();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getMin(): Vector3 {\r\n        var min: Vector3 = this._boundBox.min;\r\n        this._nativeObj.getMin();\r\n        min.x = this.float64Array[0];\r\n        min.y = this.float64Array[1];\r\n        min.z = this.float64Array[2];\r\n        return min;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setMax(value: Vector3): void {\r\n        this.float64Array[0] = value.x;\r\n        this.float64Array[1] = value.y;\r\n        this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setMax();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getMax(): Vector3 {\r\n        var max: Vector3 = this._boundBox.max;\r\n        this._nativeObj.getMax();\r\n        max.x = this.float64Array[0];\r\n        max.y = this.float64Array[1];\r\n        max.z = this.float64Array[2];\r\n        return max;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setCenter(value: Vector3): void {\r\n        this.float64Array[0] = value.x;\r\n        this.float64Array[1] = value.y;\r\n        this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setCenter();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getCenter(): Vector3 {\r\n        var center: Vector3 = this._center;\r\n        this._nativeObj.getCenter();\r\n        center.x = this.float64Array[0];\r\n        center.y = this.float64Array[1];\r\n        center.z = this.float64Array[2];\r\n        return center;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setExtent(value: Vector3): void {\r\n        this.float64Array[0] = value.x;\r\n        this.float64Array[1] = value.y;\r\n        this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setExtent();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getExtent(): Vector3 {\r\n        var extent: Vector3 = this._extent;\r\n        this._nativeObj.getExtent();\r\n        extent.x = this.float64Array[0];\r\n        extent.y = this.float64Array[1];\r\n        extent.z = this.float64Array[2];\r\n        return extent;\r\n    }\r\n\r\n    /**\r\n     *  <code>Bounds</code> \r\n     * @param\tmin  min \r\n     * @param\tmax  max \r\n     */\r\n    constructor(min?: Vector3, max?: Vector3) {\r\n        this.nativeMemory = new NativeMemory(NativeBounds.MemoryBlock_size, true);\r\n        this.float32Array = this.nativeMemory.float32Array;\r\n        this.float64Array = this.nativeMemory.float64Array;\r\n        this._nativeObj = new (window as any).conchBounds(this.nativeMemory._buffer); \r\n        min && this.setMin(min);\r\n        max && this.setMax(max);\r\n    }\r\n    /**\r\n     * @internal\r\n     */\r\n    _tranform(matrix: Matrix4x4, out: NativeBounds): void {\r\n        this.float32Array.set(matrix.elements);\r\n        this._nativeObj._tranform(out._nativeObj);\r\n    }\r\n\r\n    _getBoundBox(): BoundBox {\r\n        this._nativeObj._getBoundBox();\r\n        this._boundBox.min.x = this.float64Array[0];\r\n        this._boundBox.min.y = this.float64Array[1];\r\n        this._boundBox.min.z = this.float64Array[2];\r\n        this._boundBox.max.x = this.float64Array[3];\r\n        this._boundBox.max.y = this.float64Array[4];\r\n        this._boundBox.max.z = this.float64Array[5];\r\n        return this._boundBox;\r\n    }\r\n    /**\r\n     * @returns -1 0\r\n     */\r\n    calculateBoundsintersection(bounds: Bounds): number {\r\n        var ownMax: Vector3 = this.getMax();\r\n        var ownMin: Vector3 = this.getMin();\r\n        var calMax: Vector3 = bounds.getMax();\r\n        var calMin: Vector3 = bounds.getMin();\r\n        var tempV0: Vector3 = TEMP_VECTOR3_MAX0;\r\n        var tempV1: Vector3 = TEMP_VECTOR3_MAX1;\r\n        var thisExtends: Vector3 = this.getExtent();\r\n        var boundExtends: Vector3 = bounds.getExtent();\r\n        tempV0.setValue(Math.max(ownMax.x, calMax.x) - Math.min(ownMin.x, calMin.x),\r\n            Math.max(ownMax.y, calMax.y) - Math.min(ownMin.y, calMin.y),\r\n            Math.max(ownMax.z, calMax.z) - Math.min(ownMin.z, calMin.z));\r\n        tempV1.setValue((thisExtends.x + boundExtends.x) * 2.0,\r\n            (thisExtends.y + boundExtends.y) * 2.0,\r\n            (thisExtends.z + boundExtends.z) * 2.0);\r\n        if ((tempV0.x) > (tempV1.x)) return -1;\r\n        if ((tempV0.y) > (tempV1.y)) return -1;\r\n        if ((tempV0.z) > (tempV1.z)) return -1;\r\n        return (tempV1.x - tempV0.x) * (tempV1.y - tempV0.y) * (tempV1.z - tempV0.z);\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {\r\n        var destBounds: NativeBounds = (<NativeBounds>destObject);\r\n        this._nativeObj.cloneTo(destBounds._nativeObj);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): any {\r\n        var dest: NativeBounds = new NativeBounds(new Vector3(), new Vector3());\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n\r\n}\r\nconst TEMP_VECTOR3_MAX0 = new Vector3();\r\nconst TEMP_VECTOR3_MAX1 = new Vector3();","import { Vector3 } from \"../../../maths/Vector3\";\r\nimport { NativeMemory } from \"../../../RenderEngine/RenderEngine/NativeGLEngine/CommonMemory/NativeMemory\";\r\nimport { ICameraCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { BoundFrustum } from \"../../math/BoundFrustum\";\r\nimport { Plane } from \"../../math/Plane\";\r\n\r\n\r\n/**\r\n * camera\r\n */\r\nexport class NativeCameraCullInfo implements ICameraCullInfo {\r\n\t/** */\r\n\tprivate _position: Vector3;\r\n\r\n\tprivate _useOcclusionCulling: Boolean;\r\n\r\n\tprivate _cullingMask: number;\r\n\t/** */\r\n\tprivate _staticMask: number;\r\n\r\n\tprivate _nativeObj: any;\r\n\r\n\tprivate static MemoryBlock_size = 192;\r\n\t/**native Share Memory */\r\n\tprivate nativeMemory: NativeMemory;\r\n\tprivate float64Array: Float64Array;\r\n\r\n\tboundFrustum: BoundFrustum;\r\n\r\n\tconstructor() {\r\n\t\tthis.nativeMemory = new NativeMemory(NativeCameraCullInfo.MemoryBlock_size, true);\r\n\t\tthis.float64Array = this.nativeMemory.float64Array;\r\n\t\tthis._nativeObj = new (window as any).conchCameraCullInfo(this.nativeMemory._buffer);\r\n\t}\r\n\r\n\tset position(position: Vector3) {\r\n\t\tthis._position = position;\r\n\t\tthis._nativeObj.setPosition(position.x, position.y, position.z);\r\n\t}\r\n\r\n\tget position(): Vector3 {\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tset useOcclusionCulling(useOcclusionCulling: Boolean) {\r\n\t\tthis._useOcclusionCulling = useOcclusionCulling;\r\n\t\tthis._nativeObj.useOcclusionCulling = useOcclusionCulling;\r\n\t}\r\n\r\n\tget useOcclusionCulling(): Boolean {\r\n\t\treturn this._useOcclusionCulling;\r\n\t}\r\n\r\n\tset cullingMask(cullingMask: number) {\r\n\t\tthis._cullingMask = cullingMask;\r\n\t\tthis._nativeObj.cullingMask = cullingMask;\r\n\t}\r\n\r\n\tget cullingMask(): number {\r\n\t\treturn this._cullingMask;\r\n\t}\r\n\r\n\r\n\tset staticMask(value: number) {\r\n\t\tthis._staticMask = value;\r\n\t\tthis._nativeObj.staticMask = value;\r\n\t}\r\n\r\n\tget staticMask(): number {\r\n\t\treturn this._staticMask;\r\n\t}\r\n\t\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tserialize(): void {\r\n\t\tif (this.boundFrustum) {\r\n\t\t\tthis.setPlane(0, this.boundFrustum.near);\r\n\t\t\tthis.setPlane(4, this.boundFrustum.far);\r\n\t\t\tthis.setPlane(8, this.boundFrustum.left);\r\n\t\t\tthis.setPlane(12, this.boundFrustum.right);\r\n\t\t\tthis.setPlane(16, this.boundFrustum.top);\r\n\t\t\tthis.setPlane(20, this.boundFrustum.bottom);\r\n\t\t\tthis._nativeObj.setBoundFrustum();\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tsetPlane(index: number, value: Plane): void {\r\n\t\tthis.float64Array[index] = value.normal.x;\r\n\t\tthis.float64Array[index + 1] = value.normal.y;\r\n\t\tthis.float64Array[index + 2] = value.normal.z;\r\n\t\tthis.float64Array[index + 3] = value.distance;\r\n\t}\r\n}","\r\nimport { ICameraCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { ICullPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICullPass\";\r\nimport { ISceneRenderManager } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { IShadowCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { Stat } from \"../../../utils/Stat\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { FrustumCulling } from \"../../graphics/FrustumCulling\";\r\nimport { NativeCameraCullInfo } from \"./NativeCameraCullInfo\";\r\n\r\n\r\nexport class NativeCullPassBase implements ICullPass {\r\n\r\n    private _nativeObj: any;\r\n    private _tempRenderList: SingletonList<BaseRender>;\r\n    get cullList(): SingletonList<BaseRender> {\r\n        this._tempRenderList.elements = this._nativeObj.cullList;\r\n        this._tempRenderList.length = this._nativeObj.cullList.length;\r\n        return this._tempRenderList;\r\n    }\r\n\r\n    constructor() {\r\n        this._nativeObj = new (window as any).conchCullPass();\r\n        this._tempRenderList = new SingletonList<BaseRender>();\r\n    }\r\n\r\n    cullByCameraCullInfo(cameraCullInfo: ICameraCullInfo, renderManager: ISceneRenderManager): void {\r\n        //native Cull \r\n        (cameraCullInfo as NativeCameraCullInfo).serialize();\r\n        Stat.frustumCulling += this._nativeObj.cullByCameraCullInfo((cameraCullInfo as any)._nativeObj, (renderManager as any)._sceneManagerOBJ._nativeObj);\r\n        //Custom list Cull\r\n        var customRenderList = (renderManager as any)._sceneManagerOBJ._customCullList;\r\n        var boundFrustum = cameraCullInfo.boundFrustum;\r\n        var cullMask: number = cameraCullInfo.cullingMask;\r\n        let staticMask = cameraCullInfo.staticMask;\r\n        var renders = customRenderList.elements;\r\n        let context = RenderContext3D._instance;\r\n        for (var i: number = 0, n: number = customRenderList.length; i < n; i++) {\r\n            var render: BaseRender = <BaseRender>renders[i];\r\n            var canPass: boolean;\r\n            canPass = (Math.pow(2, render.renderNode.layer & cullMask) != 0) && render._enabled && (render.renderbitFlag == 0);\r\n            canPass = canPass && (( render.renderNode.staticMask & staticMask) != 0);\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                if (!cameraCullInfo.useOcclusionCulling || render._needRender(boundFrustum, context)) {\r\n                    this._nativeObj.cullList.push(render);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    cullByShadowCullInfo(cullInfo: IShadowCullInfo, renderManager: ISceneRenderManager): void {\r\n        //native Cull\r\n        //TODO transparent filter\r\n        Stat.frustumCulling += this._nativeObj.cullByShadowCullInfo((cullInfo as any)._nativeObj, (renderManager as any)._sceneManagerOBJ._nativeObj);\r\n        //Custom list Cull\r\n        var customRenderList = (renderManager as any)._sceneManagerOBJ._customCullList;\r\n        var renders = customRenderList.elements;\r\n        for (var i: number = 0, n: number = customRenderList.length; i < n; i++) {\r\n            var render: BaseRender = <BaseRender>renders[i];\r\n            var canPass: boolean = render.castShadow && render._enabled && (render.renderbitFlag == 0);\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                let pass = FrustumCulling.cullingRenderBounds(render.bounds, cullInfo);\r\n                pass && this._nativeObj.cullList.push(render);\r\n            }\r\n        }\r\n    }\r\n    cullingSpotShadow(cameraCullInfo: ICameraCullInfo, renderManager: ISceneRenderManager): void {\r\n        //native Cull\r\n        (cameraCullInfo as NativeCameraCullInfo).serialize();\r\n        //TODO transparent filter\r\n        Stat.frustumCulling += this._nativeObj.cullingSpotShadow((cameraCullInfo as any)._nativeObj, (renderManager as any)._sceneManagerOBJ._nativeObj);\r\n\r\n        //Custom list Cull\r\n        var customRenderList = (renderManager as any)._sceneManagerOBJ._customCullList;\r\n        var renders = customRenderList.elements;\r\n        let context = RenderContext3D._instance;\r\n        for (var i: number = 0, n: number = customRenderList.length; i < n; i++) {\r\n            var render: BaseRender = <BaseRender>renders[i];\r\n            var canPass: boolean = render.castShadow && render._enabled && (render.renderbitFlag == 0);\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                var render: BaseRender = <BaseRender>renders[i];\r\n                if (render._needRender(cameraCullInfo.boundFrustum, context))\r\n                    this._nativeObj.cullList.push(render);\r\n            }\r\n        }\r\n    }\r\n\r\n}","import { IndexBuffer } from \"../../RenderEngine/IndexBuffer\";\r\nimport { BufferTargetType, BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { IndexFormat } from \"../../RenderEngine/RenderEnum/IndexFormat\";\r\n/**\r\n * LayaGL.RenderOBJCreate.createIndexBuffer3D\r\n * <code>IndexBuffer3D</code> \r\n */\r\nexport class IndexBuffer3D extends IndexBuffer {\r\n\t/** @internal */\r\n\tprivate _canRead: boolean;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget indexType(): IndexFormat {\r\n\t\treturn this._indexType;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget indexTypeByteCount(): number {\r\n\t\treturn this._indexTypeByteCount;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget indexCount(): number {\r\n\t\treturn this._indexCount;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget canRead(): boolean {\r\n\t\treturn this._canRead;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>IndexBuffer3D,IndexBuffer3D.create()</code> \r\n\t * @param\tindexType \r\n\t * @param\tindexCount \r\n\t * @param\tbufferUsage IndexBuffer3D\r\n\t * @param\tcanRead \r\n\t */\r\n\tconstructor(indexType: IndexFormat, indexCount: number, bufferUsage: BufferUsage = BufferUsage.Static, canRead: boolean = false) {\r\n\t\tsuper(BufferTargetType.ELEMENT_ARRAY_BUFFER, bufferUsage);\r\n\t\tthis._indexType = indexType;\r\n\t\tthis._indexCount = indexCount;\r\n\r\n\t\tthis._canRead = canRead;\r\n\r\n\t\tswitch (indexType) {\r\n\t\t\tcase IndexFormat.UInt32:\r\n\t\t\t\tthis._indexTypeByteCount = 4;\r\n\t\t\t\tbreak;\r\n\t\t\tcase IndexFormat.UInt16:\r\n\t\t\t\tthis._indexTypeByteCount = 2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase IndexFormat.UInt8:\r\n\t\t\t\tthis._indexTypeByteCount = 1;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"unidentification index type.\");\r\n\t\t}\r\n\t\tvar byteLength: number = this._indexTypeByteCount * indexCount;\r\n\t\tthis._byteLength = byteLength;\r\n\t\tthis._setIndexData(byteLength);\r\n\t\tif (canRead) {\r\n\t\t\tswitch (indexType) {\r\n\t\t\t\tcase IndexFormat.UInt32:\r\n\t\t\t\t\tthis._buffer = new Uint32Array(indexCount);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase IndexFormat.UInt16:\r\n\t\t\t\t\tthis._buffer = new Uint16Array(indexCount);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase IndexFormat.UInt8:\r\n\t\t\t\t\tthis._buffer = new Uint8Array(indexCount);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdata \r\n\t * @param\tbufferOffset \r\n\t * @param\tdataStartIndex \r\n\t * @param\tdataCount \r\n\t */\r\n\tsetData(data: any, bufferOffset: number = 0, dataStartIndex: number = 0, dataCount: number = 4294967295/*uint.MAX_VALUE*/): void {\r\n\t\tvar byteCount: number = this._indexTypeByteCount;\r\n\t\tif (dataStartIndex !== 0 || dataCount !== 4294967295/*uint.MAX_VALUE*/) {\r\n\t\t\tswitch (this._indexType) {\r\n\t\t\t\tcase IndexFormat.UInt32:\r\n\t\t\t\t\tdata = new Uint32Array(data.buffer, dataStartIndex * byteCount, dataCount);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase IndexFormat.UInt16:\r\n\t\t\t\t\tdata = new Uint16Array(data.buffer, dataStartIndex * byteCount, dataCount);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase IndexFormat.UInt8:\r\n\t\t\t\t\tdata = new Uint8Array(data.buffer, dataStartIndex * byteCount, dataCount);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._setIndexData(data, bufferOffset * byteCount);\r\n\r\n\t\tif (this._canRead) {\r\n\t\t\tif (bufferOffset !== 0 || dataStartIndex !== 0 || dataCount !== 4294967295/*uint.MAX_VALUE*/) {\r\n\t\t\t\tvar maxLength: number = this._buffer.length - bufferOffset;\r\n\t\t\t\tif (dataCount > maxLength)\r\n\t\t\t\t\tdataCount = maxLength;\r\n\t\t\t\tif (typeof data == typeof this._buffer && data.length == dataCount)\r\n\t\t\t\t\tthis._buffer.set(data, bufferOffset);\r\n\t\t\t\telse\r\n\t\t\t\t\tfor (var i: number = 0; i < dataCount; i++)\r\n\t\t\t\t\t\tthis._buffer[bufferOffset + i] = data[i];\r\n\t\t\t} else {\r\n\t\t\t\tthis._buffer = data;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t\r\n\t */\r\n\tgetData(): Uint16Array {\r\n\t\tif (this._canRead)\r\n\t\t\treturn <Uint16Array>this._buffer;\r\n\t\telse\r\n\t\t\tthrow new Error(\"Can't read data from VertexBuffer with only write flag!\");\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tdestroy(): void {\r\n\t\tsuper.destroy();\r\n\t\tthis._buffer = null;\r\n\t\tthis._byteLength = 0;\r\n\t\tthis._indexCount = 0;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\n\r\n\r\nexport class NativeIndexBuffer3D extends IndexBuffer3D {\r\n\r\n    _conchIndexBuffer3D:any = null;\r\n\r\n    /**\r\n     *  <code>VertexBuffer3D</code> \r\n     * @param\tbyteLength \r\n     * @param\tbufferUsage VertexBuffer3D\r\n     * @param\tcanRead \r\n     */\r\n    constructor(indexType: IndexFormat, indexCount: number, bufferUsage: BufferUsage = BufferUsage.Static, canRead: boolean = false) {\r\n        super(indexType,indexCount,bufferUsage,canRead)\r\n        this._conchIndexBuffer3D = new (window as any).conchIndexBuffer3D( (LayaGL.renderEngine as any)._nativeObj,indexType,indexCount,bufferUsage,false);\r\n        this._conchIndexBuffer3D.setGLBuffer(this._glBuffer);\r\n     }\r\n}","import { UploadMemoryManager } from \"../../../RenderEngine/RenderEngine/NativeGLEngine/CommonMemory/UploadMemoryManager\";\r\nimport { NativeShaderData } from \"../../../RenderEngine/RenderEngine/NativeGLEngine/NativeShaderData\";\r\nimport { IBaseRenderNode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IBaseRenderNode\";\r\nimport { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { IRenderElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderElement\";\r\nimport { IRenderGeometryElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderGeometryElement\";\r\nimport { ShaderInstance } from \"../../../RenderEngine/RenderShader/ShaderInstance\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\nexport enum RenderElementType {\r\n    Base = 0,\r\n    Skin = 1,\r\n    Instance = 2,\r\n}\r\nexport class NativeRenderElementOBJ implements IRenderElement {\r\n\r\n    private geometry: IRenderGeometryElement;\r\n\r\n    private materialShaderData: NativeShaderData;\r\n\r\n    private renderShaderData: NativeShaderData;\r\n\r\n    private transform: Transform3D;\r\n\r\n    //private isRender: boolean;\r\n\r\n    private owner: IBaseRenderNode;\r\n\r\n    set _geometry(data: IRenderGeometryElement) {\r\n        this.geometry = data;\r\n        this._nativeObj._geometry = (data as any)._nativeObj;\r\n    }\r\n\r\n    get _geometry(): IRenderGeometryElement {\r\n        return this.geometry;\r\n    }\r\n\r\n    set _materialShaderData(data: NativeShaderData) {\r\n        this.materialShaderData = data;\r\n        this._nativeObj._materialShaderData = data ? (data as any)._nativeObj : null;\r\n    }\r\n\r\n    get _materialShaderData(): NativeShaderData {\r\n        return this.materialShaderData;\r\n    }\r\n\r\n    set _renderShaderData(data: NativeShaderData) {\r\n        this.renderShaderData = data;\r\n        this._nativeObj._renderShaderData = data ? (data as any)._nativeObj : null;\r\n    }\r\n\r\n    get _renderShaderData(): NativeShaderData {\r\n        return this.renderShaderData;\r\n    }\r\n\r\n    set _transform(data: Transform3D) {\r\n        this.transform = data;\r\n        this._nativeObj._transform = data ? (data as any)._nativeObj : null;\r\n    }\r\n\r\n    get _transform(): Transform3D {\r\n        return this.transform;\r\n    }\r\n\r\n    get _isRender(): boolean {\r\n        return this._nativeObj._isRender;\r\n    }\r\n\r\n    set _isRender(data: boolean) {\r\n        this._nativeObj._isRender = data;\r\n    }\r\n\r\n    get _invertFront(): boolean {\r\n        return this._nativeObj._invertFront;\r\n    }\r\n\r\n    set _invertFront(data: boolean) {\r\n        this._nativeObj._invertFront = data;\r\n    }\r\n\r\n    _nativeObj: any;\r\n    _shaderInstances: SingletonList<ShaderInstance>;\r\n    constructor() { \r\n        this._shaderInstances = new SingletonList();\r\n        this.init();\r\n    }\r\n    init(): void {\r\n       \r\n        this._nativeObj = new (window as any).conchRenderElement(RenderElementType.Base, (LayaGL.renderEngine as any)._nativeObj);\r\n    }\r\n\r\n    _owner: IBaseRenderNode;\r\n\r\n    _addShaderInstance(shader: ShaderInstance) {\r\n        this._shaderInstances.add(shader);\r\n        this._nativeObj._addShaderInstance((shader as any)._nativeObj);\r\n    }\r\n\r\n    _clearShaderInstance() {\r\n        this._shaderInstances.length = 0;\r\n        this._nativeObj._clearShaderInstance();\r\n    }\r\n    /**\r\n     * render RenderElement\r\n     * @param renderqueue \r\n     */\r\n    _render(context: IRenderContext3D): void {\r\n        UploadMemoryManager.syncRenderMemory();//\r\n        this._nativeObj._render((context as any)._nativeObj);\r\n    }\r\n\r\n    _destroy() {\r\n        this._nativeObj._destroy();\r\n        this.geometry = null;\r\n        this._shaderInstances = null; \r\n        this.materialShaderData = null;\r\n        this.renderShaderData = null;\r\n        this.transform = null;\r\n    }\r\n}","import { CommandEncoder } from \"../../../layagl/CommandEncoder\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { ShaderDataType, ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderPass } from \"../../../RenderEngine/RenderShader/ShaderPass\";\r\nimport { ShaderCompileDefineBase } from \"../../../webgl/utils/ShaderCompileDefineBase\";\r\n\r\n\r\n\r\nenum UniformParamsMapType {\r\n\tScene = 0,\r\n\tCamera,\r\n\tSprite,\r\n\tMaterial,\r\n}\r\n/**\r\n * @internal\r\n * <code>ShaderInstance</code> ShaderInstance\r\n */\r\nexport class NativeShaderInstance/* extends ShaderInstance */ {\r\n\r\n\t_nativeObj: any;\r\n\r\n\t/**@internal */\r\n\tprivate _shaderPass: ShaderCompileDefineBase | ShaderPass;\r\n\r\n\tconstructor(vs: string, ps: string, attributeMap: { [name: string]: [number, ShaderDataType] }, shaderPass: ShaderCompileDefineBase) {\r\n\t\t//super(vs, ps, attributeMap, shaderPass);\r\n\t\tthis._shaderPass = shaderPass;\r\n\t\tvar pConchAttributeMap: any = new (window as any).conchAttributeMap();\r\n\t\tfor (var k in attributeMap) {\r\n\t\t\tpConchAttributeMap.setAttributeValue(k, attributeMap[k][0]);\r\n\t\t}\r\n\t\t\r\n\t\tvar stateMap: { [stateID: number]: number } = {};\r\n\t\tfor (var s in stateMap) {\r\n\t\t\tpConchAttributeMap.setStateValue(parseInt(s), stateMap[s]);\r\n\t\t}\r\n\t\tpConchAttributeMap.statefirst = (<ShaderPass>this._shaderPass).statefirst;\r\n\t\tvar renderState: any = (<ShaderPass>shaderPass).renderState;\r\n\t\tthis._nativeObj = new (window as any).conchShaderInstance((LayaGL.renderEngine as any)._nativeObj, vs, ps, pConchAttributeMap, renderState._nativeObj);\r\n\t}\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tprotected _disposeResource(): void {\r\n\t\tthis._nativeObj.destroy();\r\n\t}\r\n\r\n\r\n\tbind() {\r\n\t\treturn this._nativeObj.bind();\r\n\t}\r\n\r\n\tuploadUniforms(shaderUniform: CommandEncoder, shaderDatas: ShaderData, uploadUnTexture: boolean) {\r\n\t\tthis._nativeObj.uploadUniforms(shaderUniform, (shaderDatas as any)._nativeObj, uploadUnTexture);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tuploadCustomUniform(index: number, data: any): void {\r\n\t\tthis._nativeObj.uploadCustomUniforms(index, data);\r\n\t}\r\n\tget _sceneUniformParamsMap(): CommandEncoder {\r\n\t\treturn (UniformParamsMapType.Scene as unknown as CommandEncoder);\r\n\t}\r\n\r\n\tget _cameraUniformParamsMap(): CommandEncoder {\r\n\t\treturn (UniformParamsMapType.Camera as unknown as CommandEncoder);\r\n\t}\r\n\r\n\tget _spriteUniformParamsMap(): CommandEncoder {\r\n\t\treturn (UniformParamsMapType.Sprite as unknown as CommandEncoder);\r\n\t}\r\n\r\n\tget _materialUniformParamsMap(): CommandEncoder {\r\n\t\treturn (UniformParamsMapType.Material as unknown as CommandEncoder);\r\n\t}\r\n\r\n\tuploadRenderStateBlendDepth(shaderDatas: ShaderData): void {\r\n\t\tthis._nativeObj.uploadRenderStateBlendDepth((shaderDatas as any)._nativeObj);\r\n\t}\r\n\r\n\tuploadRenderStateFrontFace(shaderDatas: ShaderData, isTarget: boolean, invertFront: boolean): void {\r\n\t\tthis._nativeObj.uploadRenderStateFrontFace((shaderDatas as any)._nativeObj, isTarget, invertFront);\r\n\t}\r\n}\r\n\r\n","\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { NativeRenderElementOBJ, RenderElementType } from \"./NativeRenderElementOBJ\";\r\n\r\nexport class NativeInstanceRenderElementOBJ extends NativeRenderElementOBJ {\r\n    /**@internal instance,*/\r\n    private _vertexBuffer3D: Array<VertexBuffer3D> = [];\r\n\r\n    private _updateData: Array<Float32Array> = [];\r\n\r\n\r\n    private _updateNums: number;\r\n\r\n    /**\r\n     * UpdateBuffer\r\n     * @param vb \r\n     * @param length instance\r\n     */\r\n    addUpdateBuffer(vb: VertexBuffer3D,length:number) {\r\n        this._vertexBuffer3D[this._updateNums++] = vb;\r\n        this._nativeObj.addUpdateBuffer((vb as any)._conchVertexBuffer3D, length);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param index index of Buffer3D\r\n     * @param length length of array\r\n     */\r\n    getUpdateData(index: number,length:number): Float32Array {\r\n        let data = this._updateData[index];\r\n        if (!data || data.length < length) {\r\n            data = this._updateData[index] = new Float32Array(length);\r\n            this._nativeObj.getUpdateData(index, data);\r\n        }\r\n        return data;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    clear() {\r\n        this._updateNums = 0;\r\n        this._nativeObj.clear();\r\n    }\r\n\r\n    init(): void {\r\n        this._nativeObj = new (window as any).conchRenderElement(RenderElementType.Instance, (LayaGL.renderEngine as any)._nativeObj);\r\n    }\r\n\r\n    set drawCount(drawCount: number) {\r\n\t\tthis._nativeObj.drawCount = drawCount;\r\n\t} \r\n\r\n\tget drawCount(): number {\r\n\t\treturn this._nativeObj.drawCount;\r\n\t}\r\n}","\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { IRenderTarget } from \"../../../RenderEngine/RenderInterface/IRenderTarget\";\r\nimport { IRenderContext3D, PipelineMode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Viewport } from \"../../math/Viewport\";\r\nimport { NativeRenderElementOBJ } from \"./NativeRenderElementOBJ\";\r\n\r\nexport class NativeRenderContext3DOBJ implements IRenderContext3D {\r\n\r\n    //dest Texture\r\n    private _destTarget: IRenderTarget;\r\n\r\n    //viewPort\r\n    private _viewPort: Viewport;\r\n    //scissor\r\n    private _scissor: Vector4;\r\n\r\n    private _confifShaderData: ShaderData;\r\n    //Camera Shader Data\r\n    private _cameraShaderData: ShaderData;\r\n    //scene Shader Data\r\n    private _sceneShaderData: ShaderData;\r\n    //Global ShaderData\r\n    private _globalShaderData: ShaderData;\r\n\t\r\n    private _nativeObj: any;\r\n\r\n    constructor() {\r\n        this._viewPort = new Viewport(0, 0, 0, 0);\r\n        this._scissor = new Vector4();\r\n        this._nativeObj = new (window as any).conchRenderContext3D((LayaGL.renderEngine as any)._nativeObj);\r\n\t\tthis.pipelineMode = \"Forward\";\r\n    }\r\n    end(): void {\r\n        //TODO\r\n    }\r\n    drawRenderElement(renderelemt: NativeRenderElementOBJ): void {\r\n        renderelemt._render(this);\r\n    }\r\n\r\n    /**IRenderContext */\r\n    applyContext(cameraUpdateMark: number): void {\r\n        this._nativeObj.changeViewport(this._viewPort.x, this._viewPort.y, this._viewPort.width, this._viewPort.height);\r\n        this._nativeObj.changeScissor(this._scissor.x, this._scissor.y, this._scissor.z, this._scissor.w);\r\n        this.destTarget && this.destTarget._start();\r\n        this._nativeObj.applyContext(cameraUpdateMark);\r\n    }\r\n    set destTarget(destTarget: IRenderTarget) {\r\n        this._destTarget = destTarget;\r\n        this._nativeObj.destTarget = destTarget ? destTarget._renderTarget : null;\r\n    }\r\n\r\n    get destTarget(): IRenderTarget {\r\n        return this._destTarget;\r\n    }\r\n\r\n    set viewPort(viewPort: Viewport) {\r\n        this._viewPort = viewPort;\r\n        this._nativeObj.changeViewport(viewPort.x, viewPort.y, viewPort.width, viewPort.height)\r\n    }\r\n\r\n    get viewPort(): Viewport {\r\n        return this._viewPort;\r\n    }\r\n\r\n    set scissor(scissor: Vector4) {\r\n        this._scissor = scissor;\r\n        this._nativeObj.changeScissor(scissor.x, scissor.y, scissor.z, scissor.w)\r\n    }\r\n\r\n    get scissor(): Vector4 {\r\n        return this._scissor;\r\n    }\r\n\r\n    set invertY(invertY: boolean) {\r\n        this._nativeObj.invertY = invertY;\r\n    }\r\n\r\n    get invertY(): boolean {\r\n        return this._nativeObj.invertY;\r\n    }\r\n\r\n    set pipelineMode(pipelineMode: PipelineMode) {\r\n        this._nativeObj.pipelineMode = pipelineMode;\r\n    }\r\n\r\n    get pipelineMode(): PipelineMode {\r\n        return this._nativeObj.pipelineMode;\r\n    }\r\n\r\n    get configShaderData(): ShaderData {\r\n        return this._confifShaderData;\r\n    }\r\n\r\n    set configShaderData(value: ShaderData) {\r\n        this._confifShaderData = value;\r\n        this._nativeObj.configShaderData = value ? (value as any)._nativeObj : null;\r\n    }\r\n\r\n    set globalShaderData(globalShaderData: ShaderData) {\r\n        this._globalShaderData = globalShaderData;\r\n        this._nativeObj.globalShaderData = globalShaderData ? (globalShaderData as any)._nativeObj : null;\r\n    }\r\n\r\n    get globalShaderData(): ShaderData {\r\n        return this._globalShaderData;\r\n    }\r\n\r\n    set sceneShaderData(sceneShaderData: ShaderData) {\r\n        this._sceneShaderData = sceneShaderData;\r\n        this._nativeObj.sceneShaderData = sceneShaderData ? (sceneShaderData as any)._nativeObj : null;\r\n    }\r\n\r\n    get sceneShaderData(): ShaderData {\r\n        return this._sceneShaderData;\r\n    }\r\n\r\n    set cameraShaderData(cameraShaderData: ShaderData) {\r\n        this._cameraShaderData = cameraShaderData;\r\n        this._nativeObj.cameraShaderData = cameraShaderData ? (cameraShaderData as any)._nativeObj : null;\r\n    }\r\n\r\n    get cameraShaderData(): ShaderData {\r\n        return this._cameraShaderData;\r\n    }\r\n\r\n    set sceneID(sceneID: number) {\r\n        this._nativeObj.sceneID = sceneID;\r\n    }\r\n\r\n    get sceneID(): number {\r\n        return this._nativeObj.sceneID;\r\n    }\r\n\r\n    set cameraUpdateMark(cameraUpdateMark: number) {\r\n        this._nativeObj.cameraUpdateMark = cameraUpdateMark;\r\n    }\r\n\r\n    get cameraUpdateMark(): number {\r\n        return this._nativeObj.cameraUpdateMark;\r\n    }\r\n\r\n\r\n}","import { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { IRenderGeometryElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderGeometryElement\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\n\r\n\r\n\r\nexport class NativeRenderGeometryElementOBJ implements IRenderGeometryElement {\r\n  /**@internal */\r\n  private _bufferState: BufferState;\r\n\r\n   /**@internal */\r\n   drawParams: SingletonList<number>;\r\n   \r\n  _nativeObj: any;\r\n\r\n  /**@internal */\r\n  constructor(mode: MeshTopology, drawType: DrawType) {\r\n    this._nativeObj = new (window as any).conchRenderGeometryElement(mode, drawType);\r\n    this.drawParams = new SingletonList();\r\n  }\r\n\r\n  /**@internal */\r\n  setDrawArrayParams(first: number, count: number): void {\r\n    this.drawParams.add(first);\r\n    this.drawParams.add(count);\r\n    this._nativeObj.setDrawArrayParams(first, count);\r\n  }\r\n\r\n  /**@internal */\r\n  setDrawElemenParams(count: number, offset: number): void {\r\n    this.drawParams.add(offset);\r\n    this.drawParams.add(count);\r\n    this._nativeObj.setDrawElemenParams(count, offset);\r\n  }\r\n  \r\n  /**@internal */\r\n  destroy(): void {\r\n    this._nativeObj.destroy();\r\n  }\r\n\r\n  clearRenderParams() {\r\n    this.drawParams.length = 0;\r\n    this._nativeObj.clearRenderParams();\r\n  }\r\n\r\n  set bufferState(value: BufferState) {\r\n    this._bufferState = value;\r\n    if (value) {\r\n      this._nativeObj.bufferState = (value as any)._nativeVertexArrayObject._nativeObj;\r\n    }\r\n    else {\r\n      this._nativeObj.bufferState = null;\r\n    }\r\n  }\r\n\r\n  get bufferState(): BufferState {\r\n    return this._bufferState;\r\n  }\r\n\r\n  set mode(value: MeshTopology) {\r\n    this._nativeObj.mode = value;\r\n  }\r\n\r\n  get mode(): MeshTopology {\r\n    return this._nativeObj.mode;\r\n  }\r\n\r\n  set drawType(value: DrawType) {\r\n    this._nativeObj.drawType = value;\r\n  }\r\n\r\n  get drawType(): DrawType {\r\n    return this._nativeObj.drawType;\r\n  }\r\n\r\n  set instanceCount(value: number) {\r\n    this._nativeObj.instanceCount = value;\r\n  }\r\n\r\n  get instanceCount(): number {\r\n    return this._nativeObj.instanceCount;\r\n  }\r\n\r\n  set indexFormat(value: IndexFormat) {\r\n    this._nativeObj.indexFormat = value;\r\n  }\r\n\r\n  get indexFormat(): IndexFormat {\r\n    return this._nativeObj.indexFormat;\r\n  }\r\n}","import { ISceneRenderManager } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\n\r\n\r\n\r\nexport class NativeSceneRenderManager implements ISceneRenderManager {\r\n    /** @internal */\r\n    _renders: SingletonList<BaseRender> = new SingletonList();\r\n    //Bounds\r\n    _customUpdateList: SingletonList<BaseRender> = new SingletonList();\r\n    //\r\n    _customCullList: SingletonList<BaseRender> = new SingletonList();\r\n    private _nativeObj: any;\r\n    constructor() {\r\n        this._nativeObj = new (window as any).conchSceneCullManger();\r\n    }\r\n\r\n    get list() {\r\n        return this._renders;\r\n    }\r\n\r\n    set list(value) {\r\n        this._customCullList.elements = [];\r\n        this._customCullList.length = 0;\r\n        this._nativeObj.clear();  \r\n        this._renders.clear();\r\n        for (let i = 0, len = value.length; i < len; i++) {\r\n            this.addRenderObject((value.elements[i] as BaseRender));\r\n        }\r\n    }\r\n\r\n    addRenderObject(object: BaseRender): void {\r\n        \r\n        this._renders.add(object);\r\n        if (!object._customCull && object.renderNode.geometryBounds) {\r\n            this._nativeObj.addRenderObject((object.renderNode as any)._nativeObj);\r\n        }\r\n        else {\r\n             this._customCullList.add(object);\r\n        }\r\n\r\n    }\r\n\r\n    removeRenderObject(object: BaseRender): void {\r\n        \r\n        if (!object._customCull && object.renderNode.geometryBounds) {\r\n            this._nativeObj.removeRenderObject((object.renderNode as any)._nativeObj);\r\n        }\r\n        else {\r\n            //remove\r\n            let elements = this._customCullList.elements;\r\n            let index = elements.indexOf(object);\r\n            if (index < this._customCullList.length) {\r\n                this._customCullList.length -= 1;\r\n                elements[index] = elements[this._customCullList.length];\r\n            }\r\n        }\r\n        this._renders.remove(object);\r\n        this.removeMotionObject(object);\r\n    }\r\n\r\n    removeMotionObject(object: BaseRender): void {\r\n        \r\n        if (object.renderNode.geometryBounds) {\r\n            //nativeBounds\r\n            this._nativeObj.removeMotionObject((object.renderNode as any)._nativeObj);\r\n        } else {\r\n            let index = object._motionIndexList;\r\n            if (index != -1) {//remove\r\n                let elements = this._customUpdateList.elements;\r\n                this._customUpdateList.length -= 1;\r\n                elements[length]._motionIndexList = index;\r\n                elements[index] = elements[length];\r\n            }\r\n        }\r\n    }\r\n\r\n    updateMotionObjects(): void {\r\n        \r\n        //update native Motion Node\r\n        this._nativeObj.updateMotionObjects();\r\n\r\n        for (let i = 0; i < this._customUpdateList.length; i++) {\r\n            this._customUpdateList.elements[i].bounds;\r\n            this._customUpdateList.elements[i]._motionIndexList = -1;\r\n        }\r\n        this._customUpdateList.length = 0;\r\n    }\r\n\r\n    addMotionObject(object: BaseRender): void {\r\n        \r\n        if (object.renderNode.geometryBounds) {\r\n            this._nativeObj.addMotionObject((object.renderNode as any)._nativeObj);\r\n        } else {\r\n            if (object._motionIndexList == -1) {\r\n                object._motionIndexList = this._customUpdateList.length;\r\n                this._customUpdateList.add(object);\r\n            }\r\n        }\r\n    }\r\n\r\n    destroy(): void {\r\n        this._nativeObj.destroy(); \r\n        this._renders.destroy();\r\n        //Destroy\r\n        this._customUpdateList.destroy();\r\n        this._customCullList.destroy();\r\n    }\r\n\r\n}","import { Vector3 } from \"../../../maths/Vector3\";\r\nimport { NativeMemory } from \"../../../RenderEngine/RenderEngine/NativeGLEngine/CommonMemory/NativeMemory\";\r\nimport { IShadowCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { BoundSphere } from \"../../math/BoundSphere\";\r\nimport { Plane } from \"../../math/Plane\";\r\n\r\n\r\nexport class NativeShadowCullInfo implements IShadowCullInfo {\r\n\r\n    private _position: Vector3;\r\n\r\n\tprivate _cullPlanes: Plane[];\r\n\r\n    private _direction: Vector3;\r\n\r\n    private _nativeObj: any;\r\n\t\r\n\tprivate _cullSphere: BoundSphere;\r\n\r\n\tprivate _cullPlaneCount: number;\r\n\r\n\t/**native Share Memory */\r\n\tstatic MemoryBlock_size: number = 4 * 8;\r\n\r\n\tprivate nativeMemory: NativeMemory;\r\n\t\r\n\tprivate float64Array: Float64Array;\r\n\r\n\tconstructor() {\r\n\t\tthis.nativeMemory = new NativeMemory(NativeShadowCullInfo.MemoryBlock_size, true);\r\n\t\tthis.float64Array = this.nativeMemory.float64Array;\r\n    \tthis._nativeObj = new (window as any).conchShadowCullInfo(this.nativeMemory._buffer);\r\n  \t}\r\n    set cullPlanes(cullPlanes: Plane[]) {\r\n\t\tthis._cullPlanes = cullPlanes;\r\n        this._nativeObj.clearCullPlanes();\r\n        cullPlanes.forEach((element) => {\r\n\t\t\tthis.float64Array[0] = element.normal.x;\r\n        \tthis.float64Array[1] = element.normal.y;\r\n        \tthis.float64Array[2] = element.normal.z;\r\n\t\t\tthis.float64Array[3] = element.distance;\r\n            this._nativeObj.addCullPlane();\r\n        });\r\n\t}\r\n\tget cullPlanes(): Plane[] {\r\n\t\treturn this._cullPlanes;\r\n\t}\r\n    set cullSphere(cullSphere: BoundSphere) {\r\n\t\tthis._cullSphere = cullSphere;\r\n\t\tthis.float64Array[0] = cullSphere.center.x;\r\n        this.float64Array[1] = cullSphere.center.y;\r\n        this.float64Array[2] = cullSphere.center.z;\r\n\t\tthis.float64Array[3] = cullSphere.radius;\r\n\t\tthis._nativeObj.setCullSphere();\r\n\t}\r\n\t\r\n\tget cullSphere(): BoundSphere {\r\n\t\treturn this._cullSphere;\r\n\t}\r\n    set position(position: Vector3) {\r\n\t\tthis._position = position;\r\n\t\tthis.float64Array[0] = position.x;\r\n        this.float64Array[1] = position.y;\r\n        this.float64Array[2] = position.z;\r\n\t\tthis._nativeObj.setPosition();\r\n\t} \r\n\r\n\tget position(): Vector3 {\r\n\t\treturn this._position;\r\n\t}\r\n    set direction(direction: Vector3) {\r\n\t\tthis._direction = direction;\r\n\t\tthis.float64Array[0] = direction.x;\r\n        this.float64Array[1] = direction.y;\r\n        this.float64Array[2] = direction.z;\r\n\t\tthis._nativeObj.setDirection();\r\n\t} \r\n\r\n\tget direction(): Vector3 {\r\n\t\treturn this._direction;\r\n\t}\r\n\r\n    set cullPlaneCount(cullPlaneCount: number) {\r\n\t\tthis._cullPlaneCount = cullPlaneCount;\r\n\t\tthis._nativeObj.cullPlaneCount = cullPlaneCount;\r\n\t} \r\n\r\n\tget cullPlaneCount(): number {\r\n\t\treturn this._cullPlaneCount;\r\n\t}\r\n}","\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { NativeRenderElementOBJ, RenderElementType } from \"./NativeRenderElementOBJ\";\r\n\r\nexport class NativeSkinRenderElementOBJ extends  NativeRenderElementOBJ {\r\n    \r\n    _skinnedData:Float32Array[];\r\n\r\n    constructor(){\r\n        super();\r\n    }\r\n    get skinnedData():Float32Array[] {\r\n        return this._skinnedData;\r\n    }\r\n    set skinnedData(data:Float32Array[]) {\r\n        this._skinnedData = data;\r\n        this._nativeObj._skinnedData = data;\r\n    }\r\n    init(): void {\r\n        this._nativeObj = new (window as any).conchRenderElement(RenderElementType.Skin, (LayaGL.renderEngine as any)._nativeObj);\r\n    }\r\n}","import { EventDispatcher } from \"../../../events/EventDispatcher\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { NativeMemory } from \"../../../RenderEngine/RenderEngine/NativeGLEngine/CommonMemory/NativeMemory\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\n\r\n/**\r\n * <code>Transform3D</code> 3D\r\n */\r\nexport class NativeTransform3D  extends Transform3D {\r\n\r\n    static MemoryBlock_size: number = 16 * 4;\r\n\r\n    /**native Share Memory */\r\n    private nativeMemory: NativeMemory;\r\n    private float32Array: Float32Array;\r\n\tprivate float64Array: Float64Array;\r\n    private int32Array: Int32Array;\r\n\tprivate eventDispatcher: EventDispatcher;\r\n    _nativeObj: any;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tget _isFrontFaceInvert(): boolean {\r\n        return this._nativeObj._isFrontFaceInvert;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget owner(): Sprite3D {\r\n\t\treturn this._owner;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localPositionX(): number {\r\n\t\treturn this.localPosition.x;\r\n\t}\r\n\r\n\tset localPositionX(x: number) {\r\n\t\tthis._localPosition.x = x;\r\n\t\tthis.localPosition = this._localPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localPositionY(): number {\r\n\t\treturn this.localPosition.y;\r\n\t}\r\n\r\n\tset localPositionY(y: number) {\r\n\t\tthis._localPosition.y = y;\r\n\t\tthis.localPosition = this._localPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localPositionZ(): number {\r\n\t\treturn this.localPosition.z;\r\n\t}\r\n\r\n\tset localPositionZ(z: number) {\r\n\t\tthis._localPosition.z = z;\r\n\t\tthis.localPosition = this._localPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localPosition(): Vector3 {\r\n        if (this._nativeObj.getLocalPosition()) {\r\n        \tthis._localPosition.x = this.float64Array[0];\r\n       \t \tthis._localPosition.y = this.float64Array[1];\r\n        \tthis._localPosition.z = this.float64Array[2];\r\n\t\t}\r\n\t\treturn this._localPosition;\r\n\t}\r\n\r\n\tset localPosition(value: Vector3) {\r\n        this._localPosition.x = this.float64Array[0] = value.x;\r\n        this._localPosition.y = this.float64Array[1] = value.y;\r\n        this._localPosition.z = this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setLocalPosition();\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localRotationX(): number {\r\n\t\treturn this.localRotation.x;\r\n\t}\r\n\r\n\tset localRotationX(x: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.x = x;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localRotationY(): number {\r\n\t\treturn this.localRotation.y;\r\n\t}\r\n\r\n\tset localRotationY(y: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.y = y;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localRotationZ(): number {\r\n\t\treturn this.localRotation.z;\r\n\t}\r\n\r\n\tset localRotationZ(z: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.z = z;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * W\r\n\t */\r\n\tget localRotationW(): number {\r\n\t\treturn this.localRotation.w;\r\n\t}\r\n\r\n\tset localRotationW(w: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.w = w;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localRotation(): Quaternion {\r\n        if (this._nativeObj.getLocalRotation()) {\r\n        \tthis._localRotation.x = this.float64Array[0];\r\n        \tthis._localRotation.y = this.float64Array[1];\r\n        \tthis._localRotation.z = this.float64Array[2];\r\n        \tthis._localRotation.w = this.float64Array[3];\r\n\t\t}\r\n\t\treturn this._localRotation;\r\n\t}\r\n\r\n\tset localRotation(value: Quaternion) {\r\n        this._localRotation.x = this.float64Array[0] = value.x;\r\n        this._localRotation.y = this.float64Array[1] = value.y;\r\n        this._localRotation.z = this.float64Array[2] = value.z;\r\n        this._localRotation.w = this.float64Array[3] = value.w;\r\n\t\tthis._nativeObj.setLocalRotation();\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localScaleX(): number {\r\n\t\treturn this.localScale.x;\r\n\t}\r\n\r\n\tset localScaleX(value: number) {\r\n\t\tthis._localScale.x = value;\r\n\t\tthis.localScale = this._localScale;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localScaleY(): number {\r\n\t\treturn this.localScale.y;\r\n\t}\r\n\r\n\tset localScaleY(value: number) {\r\n\t\tthis._localScale.y = value;\r\n\t\tthis.localScale = this._localScale;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localScaleZ(): number {\r\n\t\treturn this.localScale.z;\r\n\t}\r\n\r\n\tset localScaleZ(value: number) {\r\n\t\tthis._localScale.z = value;\r\n\t\tthis.localScale = this._localScale;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localScale(): Vector3 {\r\n        if (this._nativeObj.getLocalScale())\r\n\t\t{\r\n        \tthis._localScale.x = this.float64Array[0];\r\n        \tthis._localScale.y = this.float64Array[1];\r\n        \tthis._localScale.z = this.float64Array[2];\r\n\t\t}\r\n\t\treturn this._localScale;\r\n\t}\r\n\r\n\tset localScale(value: Vector3) {\r\n\t\tthis._localScale.x = this.float64Array[0] = value.x;\r\n        this._localScale.y = this.float64Array[1] = value.y;\r\n        this._localScale.z = this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setLocalScale();\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localRotationEulerX(): number {\r\n\t\treturn this.localRotationEuler.x;\r\n\t}\r\n\r\n\tset localRotationEulerX(value: number) {\r\n\t\tlet rot = this.localRotationEuler;\r\n\t\trot.x = value;\r\n\t\tthis.localRotationEuler = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localRotationEulerY(): number {\r\n\t\treturn this.localRotationEuler.y;\r\n\t}\r\n\r\n\tset localRotationEulerY(value: number) {\r\n\t\tlet rot = this.localRotationEuler;\r\n\t\trot.y = value;\r\n\t\tthis.localRotationEuler = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localRotationEulerZ(): number {\r\n\t\treturn this.localRotationEuler.z;\r\n\t}\r\n\r\n\tset localRotationEulerZ(value: number) {\r\n\t\tlet rot = this.localRotationEuler;\r\n\t\trot.z = value;\r\n\t\tthis.localRotationEuler = rot;\r\n\t}                                                                                                      \r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localRotationEuler(): Vector3 {\r\n\t\tif (this._nativeObj.getLocalRotationEuler()) {\r\n        \tthis._localRotationEuler.x = this.float64Array[0];\r\n       \t \tthis._localRotationEuler.y = this.float64Array[1];\r\n        \tthis._localRotationEuler.z = this.float64Array[2];\r\n\t\t}\r\n\t\treturn this._localRotationEuler;\r\n\t}\r\n\r\n\tset localRotationEuler(value: Vector3) {\r\n\t\tthis._localRotationEuler.x = this.float64Array[0] = value.x;\r\n        this._localRotationEuler.y = this.float64Array[1] = value.y;\r\n        this._localRotationEuler.z = this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setLocalRotationEuler();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localMatrix(): Matrix4x4 {\r\n        if (this._nativeObj.getLocalMatrix()) {\r\n        \tfor (var i = 0; i < 16; ++i) {\r\n\t\t\t\tthis._localMatrix.elements[i] = this.float32Array[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._localMatrix;\r\n\t}\r\n\r\n\tset localMatrix(value: Matrix4x4) {\r\n\t\tif (this._localMatrix !== value)\r\n\t\t\tvalue.cloneTo(this._localMatrix);\r\n        this.float32Array.set(value.elements);\r\n\t\tthis._nativeObj.setLocalMatrix();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget position(): Vector3 {  \r\n        if (this._nativeObj.getPosition()) {\r\n        \tthis._position.x = this.float64Array[0];\r\n        \tthis._position.y = this.float64Array[1];\r\n        \tthis._position.z = this.float64Array[2];\r\n\t\t}\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tset position(value: Vector3) {\r\n        this._position.x = this.float64Array[0] = value.x;\r\n        this._position.y = this.float64Array[1] = value.y;\r\n        this._position.z = this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setPosition();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget rotation(): Quaternion {\r\n\t\tif (this._nativeObj.getRotation()) {\r\n        \tthis._rotation.x = this.float64Array[0];\r\n        \tthis._rotation.y = this.float64Array[1];\r\n        \tthis._rotation.z = this.float64Array[2];\r\n        \tthis._rotation.w = this.float64Array[3];\r\n\t\t}\r\n\t\treturn this._rotation;\r\n\t}\r\n\r\n\tset rotation(value: Quaternion) {\r\n        this._rotation.x = this.float64Array[0] = value.x;\r\n        this._rotation.y = this.float64Array[1] = value.y;\r\n        this._rotation.z = this.float64Array[2] = value.z;\r\n        this._rotation.w = this.float64Array[3] = value.w;\r\n\t\tthis._nativeObj.setRotation();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * xyz\r\n\t */\r\n\tget rotationEuler(): Vector3 {\r\n\t\tif (this._nativeObj.getRotationEuler()) {\r\n        \tthis._rotationEuler.x = this.float64Array[0];\r\n        \tthis._rotationEuler.y = this.float64Array[1];\r\n        \tthis._rotationEuler.z = this.float64Array[2];\r\n\t\t}\r\n\t\treturn this._rotationEuler;\r\n\t}\r\n\r\n\tset rotationEuler(value: Vector3) {\r\n\t\tthis._rotationEuler.x = this.float64Array[0] = value.x;\r\n        this._rotationEuler.y = this.float64Array[1] = value.y;\r\n        this._rotationEuler.z = this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setRotationEuler();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget worldMatrix(): Matrix4x4 {\r\n\t\tif (this._nativeObj.getWorldMatrix()) {\r\n        \tfor (var i = 0; i < 16; i++) {\r\n\t\t\t\tthis._worldMatrix.elements[i] = this.float32Array[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._worldMatrix;\r\n\t}\r\n\r\n\tset worldMatrix(value: Matrix4x4) {\r\n\t\tif (this._worldMatrix !== value)\r\n\t\t\tvalue.cloneTo(this._worldMatrix);\r\n        this.float32Array.set(value.elements);\r\n\t\tthis._nativeObj.setWorldMatrix();\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Transform3D</code> \r\n\t * @param owner \r\n\t */\r\n\tconstructor(owner: Sprite3D) {\r\n\t\tsuper(owner);\r\n        //native memory\r\n        this.nativeMemory = new NativeMemory(NativeTransform3D.MemoryBlock_size, true);\r\n        this.float32Array = this.nativeMemory.float32Array;\r\n\t\tthis.float64Array = this.nativeMemory.float64Array;\r\n        this.int32Array = this.nativeMemory.int32Array;\r\n\t\tthis.eventDispatcher = new EventDispatcher();\r\n        this._nativeObj = new (window as any).conchTransform(this.nativeMemory._buffer, this.eventDispatcher.event.bind(this.eventDispatcher));\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t _setTransformFlag(type: number, value: boolean): void {\r\n\t\tthis._nativeObj && this._nativeObj._setTransformFlag(type, value);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_getTransformFlag(type: number): boolean {\r\n\t\treturn this._nativeObj._getTransformFlag(type);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setParent(value: Transform3D): void {\r\n\t\tsuper._setParent(value);\r\n        this._nativeObj.setParent(value ? (value as any)._nativeObj : null);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param \ttranslation \r\n\t * @param \tisLocal \r\n\t */\r\n\ttranslate(translation: Vector3, isLocal: boolean = true): void {\r\n\t\tthis.float64Array[0] = translation.x;\r\n        this.float64Array[1] = translation.y;\r\n        this.float64Array[2] = translation.z;\r\n        this.int32Array[6] = isLocal ? 1 : 0;\r\n\t\tthis._nativeObj.translate();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param \trotations \r\n\t * @param \tisLocal \r\n\t * @param \tisRadian \r\n\t */\r\n\trotate(rotation: Vector3, isLocal: boolean = true, isRadian: boolean = true): void {\r\n\t\tthis.float64Array[0] = rotation.x;\r\n        this.float64Array[1] = rotation.y;\r\n        this.float64Array[2] = rotation.z;\r\n        this.int32Array[6] = isLocal ? 1 : 0;\r\n        this.int32Array[7] = isRadian ? 1 : 0;\r\n\t\tthis._nativeObj.rotate();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param forward \r\n\t */\r\n\tgetForward(forward: Vector3): void {\r\n\t\tvar worldMatElem: Float32Array = this.worldMatrix.elements;\r\n\t\tforward.x = -worldMatElem[8];\r\n\t\tforward.y = -worldMatElem[9];\r\n\t\tforward.z = -worldMatElem[10];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param up \r\n\t */\r\n\tgetUp(up: Vector3): void {\r\n\t\tvar worldMatElem: Float32Array = this.worldMatrix.elements;\r\n\t\tup.x = worldMatElem[4];\r\n\t\tup.y = worldMatElem[5];\r\n\t\tup.z = worldMatElem[6];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param \r\n\t */\r\n\tgetRight(right: Vector3): void {\r\n\t\tvar worldMatElem: Float32Array = this.worldMatrix.elements;\r\n\t\tright.x = worldMatElem[0];\r\n\t\tright.y = worldMatElem[1];\r\n\t\tright.z = worldMatElem[2];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\ttarget \r\n\t * @param\tup \r\n\t * @param\tisLocal \r\n\t */\r\n\tlookAt(target: Vector3, up: Vector3, isLocal: boolean = false,isCamera:boolean = true): void {\r\n\t\tthis.float64Array[0] = target.x;\r\n        this.float64Array[1] = target.y;\r\n        this.float64Array[2] = target.z;\r\n        this.float64Array[3] = up.x;\r\n        this.float64Array[4] = up.y;\r\n        this.float64Array[5] = up.z;\r\n        this.int32Array[12] = isLocal ? 1 : 0;\r\n        this.int32Array[13] = isCamera ? 1 : 0;\r\n\t\tthis._nativeObj.lookAt();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param target \r\n\t * @param up \r\n\t * @param isLocal \r\n\t */\r\n\tobjLookat(target: Vector3, up: Vector3, isLocal: boolean = false):void{\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t/**\r\n\t * \r\n\t * Vector3,Matrix3x3\r\n\t * @return\t\r\n\t */\r\n\tgetWorldLossyScale(): Vector3 {\r\n        if (this._nativeObj.getWorldLossyScale()) {\r\n        \tthis._scale.x = this.float64Array[0];\r\n        \tthis._scale.y = this.float64Array[1];\r\n        \tthis._scale.z = this.float64Array[2];\r\n\t\t}\r\n\t\treturn this._scale;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * Vector3,Matrix3x3\r\n\t * @return\t\r\n\t */\r\n\tsetWorldLossyScale(value: Vector3) {\r\n\t\tthis._scale.x = this.float64Array[0] = value.x;\r\n        this._scale.y = this.float64Array[1] = value.y;\r\n        this._scale.z = this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setWorldLossyScale();\r\n\t}\r\n\thasListener(type: string): boolean {\r\n        return this.eventDispatcher.hasListener(type);\r\n    }\r\n\r\n    event(type: string, data?: any): boolean {\r\n        return this.eventDispatcher.event(type, data);\r\n    }\r\n\r\n    on(type: string, listener: Function): EventDispatcher;\r\n    on(type: string, caller: any, listener: Function, args?: any[]): EventDispatcher;\r\n    on(type: string, caller: any, listener?: Function, args?: any[]): EventDispatcher {\r\n\t\tif (arguments.length == 2) {\r\n            listener = caller;\r\n            caller = null;\r\n        }\r\n\t\treturn this.eventDispatcher.on(type, caller, listener, args);\r\n    }\r\n\r\n    once(type: string, listener: Function): EventDispatcher;\r\n    once(type: string, caller: any, listener: Function, args?: any[]): EventDispatcher;\r\n    once(type: string, caller: any, listener?: Function, args?: any[]): EventDispatcher {\r\n\t\tif (arguments.length == 2) {\r\n            listener = caller;\r\n            caller = null;\r\n        }\r\n\t\treturn this.eventDispatcher.once(type, caller, listener, args);\r\n    }\r\n\r\n    off(type: string, listener: Function): EventDispatcher;\r\n    off(type: string, caller: any, listener?: Function, args?: any[]): EventDispatcher;\r\n    off(type: string, caller: any, listener?: Function): EventDispatcher {\r\n\t\tif (arguments.length == 2) {\r\n            listener = caller;\r\n            caller = null;\r\n        }\r\n\t\treturn this.eventDispatcher.off(type, caller, listener);\r\n    }\r\n\r\n    offAll(type?: string): EventDispatcher {\r\n        return this.eventDispatcher.offAll(type);\r\n    }\r\n\r\n    offAllCaller(caller: any): EventDispatcher {\r\n        return this.eventDispatcher.offAllCaller(caller);\r\n    }\r\n}\r\n\r\n\r\n","import { BufferTargetType, BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { VertexBuffer } from \"../../RenderEngine/VertexBuffer\";\r\nimport { VertexDeclaration } from \"../../RenderEngine/VertexDeclaration\";\r\n\r\n\r\n/**\r\n * LayaGL.RenderOBJCreate.createIndexBuffer3D\r\n * <code>VertexBuffer3D</code> \r\n */\r\nexport class VertexBuffer3D extends VertexBuffer {\r\n\r\n\t/** @internal */\r\n\tprotected _canRead: boolean;\r\n\r\n\r\n\t/** @internal */\r\n\t_float32Reader: Float32Array | null = null;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget vertexDeclaration(): VertexDeclaration | null {\r\n\t\treturn this._vertexDeclaration;\r\n\t}\r\n\r\n\tset vertexDeclaration(value: VertexDeclaration | null) {\r\n\t\tthis._vertexDeclaration = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget canRead(): boolean {\r\n\t\treturn this._canRead;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>VertexBuffer3D</code> \r\n\t * @param\tbyteLength \r\n\t * @param\tbufferUsage VertexBuffer3D\r\n\t * @param\tcanRead \r\n\t */\r\n\tconstructor(byteLength: number, bufferUsage: BufferUsage, canRead: boolean = false) {\r\n\t\tsuper(BufferTargetType.ARRAY_BUFFER, bufferUsage);\r\n\t\tthis._canRead = canRead;\r\n\t\tthis._byteLength = byteLength;\r\n\t\tthis.bind();\r\n\t\tthis._glBuffer.setDataLength(byteLength)\r\n\t\tif (this._canRead) {\r\n\t\t\tthis._buffer = new Uint8Array(byteLength);\r\n\t\t\tthis._float32Reader = new Float32Array(this._buffer.buffer);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\torphanStorage(): void {\r\n\t\tthis.bind();\r\n\t\tthis._glBuffer.setDataLength(this._byteLength);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdata \r\n\t * @param\tbufferOffset ,\r\n\t * @param\tdataStartIndex ,\r\n\t * @param\tdataCount ,\r\n\t */\r\n\tsetData(buffer: ArrayBuffer, bufferOffset: number = 0, dataStartIndex: number = 0, dataCount: number = Number.MAX_SAFE_INTEGER): void {\r\n\t\tthis.bind();\r\n\t\tvar needSubData: boolean = dataStartIndex !== 0 || dataCount !== Number.MAX_SAFE_INTEGER;\r\n\t\tif (needSubData) {\r\n\t\t\tvar subData: Uint8Array = new Uint8Array(buffer, dataStartIndex, dataCount);\r\n\t\t\tthis._glBuffer.setData(subData, bufferOffset);\r\n\t\t\tif (this._canRead)\r\n\t\t\t\tthis._buffer.set(subData, bufferOffset);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._glBuffer.setData(buffer, bufferOffset);\r\n\t\t\tif (this._canRead)\r\n\t\t\t\tthis._buffer.set(new Uint8Array(buffer), bufferOffset);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t\r\n\t */\r\n\tgetUint8Data(): Uint8Array {\r\n\t\tif (this._canRead)\r\n\t\t\treturn <Uint8Array>this._buffer;\r\n\t\telse\r\n\t\t\tthrow new Error(\"Can't read data from VertexBuffer with only write flag!\");\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tgetFloat32Data(): Float32Array | null {\r\n\t\tif (this._canRead)\r\n\t\t\treturn this._float32Reader;\r\n\t\telse\r\n\t\t\tthrow new Error(\"Can't read data from VertexBuffer with only write flag!\");\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tmarkAsUnreadbale(): void {\r\n\t\tthis._canRead = false;\r\n\t\tthis._buffer = null;\r\n\t\tthis._float32Reader = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tdestroy(): void {\r\n\t\tsuper.destroy();\r\n\t\tthis._buffer = null;\r\n\t\tthis._float32Reader = null;\r\n\t\tthis._vertexDeclaration = null;\r\n\t\tthis._byteLength = 0;\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n","import { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\n\r\n\r\nexport class NativeVertexBuffer3D extends VertexBuffer3D {\r\n\r\n\r\n    _conchVertexBuffer3D:any = null;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get vertexDeclaration(): VertexDeclaration | null {\r\n        return this._vertexDeclaration;\r\n    }\r\n\r\n    set vertexDeclaration(value: VertexDeclaration | null) {\r\n        this._vertexDeclaration = value;\r\n        this._conchVertexBuffer3D.setVertexDeclaration( this.serilizeVertexDeclaration(value) );\r\n    }\r\n\r\n    serilizeVertexDeclaration(value: VertexDeclaration): Int32Array {\r\n        let array = new Int32Array(value._vertexElements.length * 6);\r\n        let offset = 0;\r\n        var valueData: any = value._shaderValues;\r\n        for (var k in valueData) {\r\n            var loc: number = parseInt(k);\r\n            var attribute: Int32Array = valueData[k];\r\n            array[offset++] = loc;\r\n            array.set(attribute, offset);\r\n            offset += 5;\r\n        }\r\n        return array;\r\n    }\r\n\r\n    get instanceBuffer(): boolean {\r\n\t\treturn this._conchVertexBuffer3D._instanceBuffer;\r\n\t}\r\n\r\n\tset instanceBuffer(value: boolean) {\r\n\t\tthis._conchVertexBuffer3D._instanceBuffer = value;\r\n\t}\r\n    /**\r\n     *  <code>VertexBuffer3D</code> \r\n     * @param\tbyteLength \r\n     * @param\tbufferUsage VertexBuffer3D\r\n     * @param\tcanRead \r\n     */\r\n    constructor(byteLength: number, bufferUsage: BufferUsage, canRead: boolean = false) {\r\n        super(byteLength, bufferUsage, canRead);\r\n        this._conchVertexBuffer3D = new (window as any).conchVertexBuffer3D( (LayaGL.renderEngine as any)._nativeObj,byteLength,bufferUsage,false);\r\n        this._conchVertexBuffer3D.setGLBuffer(this._glBuffer);\r\n    }\r\n}","import { IBaseRenderNode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IBaseRenderNode\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\n\r\n\r\nexport class BaseRenderNode implements IBaseRenderNode {\r\n   \r\n    /**@interanl */\r\n    boundsChange: boolean;\r\n    /**@internal ID */\r\n    renderId: number;\r\n    /**@internal Shadow Mode */\r\n    receiveShadow: boolean;\r\n    /**@internal shadow mode */\r\n    castShadow: boolean;\r\n    /**@internal  */\r\n    bounds: Bounds;\r\n    /**@internal  */\r\n    sortingFudge: number;\r\n    /**@internal  */\r\n    distanceForSort: number;\r\n    /**@internal transform3D */\r\n    transform: Transform3D;\r\n    /**@internal baseRender */\r\n    owner: BaseRender | null;\r\n    /**@internal TODO Base Bounds/can update Bounds by transform*GeometryBounds*/\r\n    geometryBounds: Bounds | null;\r\n    /**@internal layer */\r\n    layer:number;\r\n    /**@internal */\r\n    renderbitFlag:number;\r\n    /**@internal */\r\n    staticMask: number;\r\n}","import { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { IRenderQueue } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderQueue\";\r\nimport { ISortPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISortPass\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { Camera } from \"../../core/Camera\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { RenderElement } from \"../../core/render/RenderElement\";\r\nimport { RenderElementBatch } from \"../../graphics/Batch/RenderElementBatch\";\r\n\r\nexport class BaseRenderQueue implements IRenderQueue {\r\n    /** @interanl */\r\n    _isTransparent: boolean = false;\r\n    /** @internal */\r\n    elements: SingletonList<RenderElement> = new SingletonList<RenderElement>();\r\n    /**sort function*/\r\n    _sortPass: ISortPass;\r\n    /** context*/\r\n    _context: IRenderContext3D;\r\n\r\n    _batch: RenderElementBatch;\r\n\r\n    set sortPass(value: ISortPass) {\r\n        this._sortPass = value;\r\n    }\r\n    constructor(isTransparent: boolean) {\r\n        this._isTransparent = isTransparent;\r\n        this._batch = RenderElementBatch.instance ? RenderElementBatch.instance : new RenderElementBatch();\r\n    }\r\n\r\n\r\n    set context(value: RenderContext3D) {\r\n        this._context = value._contextOBJ;\r\n    }\r\n\r\n    addRenderElement(renderelement: RenderElement) {\r\n        this.elements.add(renderelement);\r\n    }\r\n\r\n    clear(): void {\r\n        this.elements.length = 0;\r\n    }\r\n\r\n    renderQueue(context: RenderContext3D): number {\r\n        this.context = context;\r\n        this._context.applyContext(Camera._updateMark);\r\n\r\n        var elements: RenderElement[] = this.elements.elements;\r\n\r\n        this._batchQueue();//\r\n        for (var i: number = 0, n = this.elements.length; i < n; i++) {\r\n            elements[i]._renderUpdatePre(context);//Update Data\r\n        }\r\n        //buffer nativeTODO\r\n\r\n        this._sort();\r\n        for (var i: number = 0, n: number = this.elements.length; i < n; i++)\r\n            elements[i]._render(this._context);//Update Data\r\n        BufferState._curBindedBufferState && BufferState._curBindedBufferState.unBind();\r\n        this._batch.recoverData();\r\n        this._context.end()\r\n        return n;\r\n    }\r\n\r\n    private _batchQueue() {\r\n        this._isTransparent || this._batch.batch(this.elements);\r\n    }\r\n\r\n    private _sort() {\r\n        var count: number = this.elements.length;\r\n        this._sortPass.sort(this.elements, this._isTransparent, 0, count - 1);\r\n    }\r\n\r\n    destroy(): void {\r\n        this.elements.destroy();\r\n    }\r\n}","import { Vector3 } from \"../../../maths/Vector3\";\r\nimport { ICameraCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { BoundFrustum } from \"../../math/BoundFrustum\";\r\n\r\n\r\n/**\r\n * camera\r\n */\r\nexport class CameraCullInfo implements ICameraCullInfo {\r\n\t/** */\r\n\tposition: Vector3;\r\n\t/** */\r\n\tuseOcclusionCulling: Boolean;\r\n\t/** */\r\n\tboundFrustum: BoundFrustum;\r\n\t/** */\r\n\tcullingMask: number;\r\n\t/** */\r\n\tstaticMask: number;\r\n}","import { IBaseRenderNode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IBaseRenderNode\";\r\nimport { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { IRenderElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderElement\";\r\nimport { IRenderGeometryElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderGeometryElement\";\r\nimport { ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderInstance } from \"../../../RenderEngine/RenderShader/ShaderInstance\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\n\r\n\r\nexport class RenderElementOBJ implements IRenderElement {\r\n\r\n    _geometry: IRenderGeometryElement;\r\n\r\n    _shaderInstances: SingletonList<ShaderInstance>;\r\n\r\n    _materialShaderData: ShaderData;\r\n\r\n    _renderShaderData: ShaderData;\r\n\r\n    _transform: Transform3D;\r\n\r\n    _isRender: boolean;\r\n\r\n    _owner: IBaseRenderNode;\r\n\r\n    _invertFront: boolean;\r\n\r\n    constructor() {\r\n        this._shaderInstances = new SingletonList();\r\n    }\r\n\r\n    _addShaderInstance(shader: ShaderInstance) {\r\n        this._shaderInstances.add(shader);\r\n    }\r\n\r\n    _clearShaderInstance() {\r\n        this._shaderInstances.length = 0;\r\n    }\r\n\r\n    /**\r\n     * render RenderElement\r\n     * @param renderqueue \r\n     */\r\n    _render(context: IRenderContext3D): void {\r\n        var forceInvertFace: boolean = context.invertY;\r\n        var updateMark: number = context.cameraUpdateMark;\r\n        var sceneID = context.sceneID;\r\n        var sceneShaderData: ShaderData = context.sceneShaderData;\r\n        var cameraShaderData: ShaderData = context.cameraShaderData;\r\n        if (this._isRender) {\r\n            var passes: ShaderInstance[] = this._shaderInstances.elements;\r\n            for (var j: number = 0, m: number = this._shaderInstances.length; j < m; j++) {\r\n                const shaderIns: ShaderInstance = passes[j];\r\n                if(!shaderIns.complete)\r\n                    continue;\r\n                var switchShader: boolean = shaderIns.bind();\r\n                var switchUpdateMark: boolean = (updateMark !== shaderIns._uploadMark);\r\n                var uploadScene: boolean = (shaderIns._uploadScene !== sceneID) || switchUpdateMark;\r\n                //Scene\r\n                if (uploadScene || switchShader) {\r\n                    sceneShaderData && shaderIns.uploadUniforms(shaderIns._sceneUniformParamsMap, sceneShaderData, uploadScene);\r\n                    shaderIns._uploadScene = sceneID;\r\n                }\r\n                //render\r\n                if (this._renderShaderData) {\r\n                    var uploadSprite3D: boolean = (shaderIns._uploadRender !== this._renderShaderData) || switchUpdateMark;\r\n                    if (uploadSprite3D || switchShader) {\r\n                        shaderIns.uploadUniforms(shaderIns._spriteUniformParamsMap, this._renderShaderData, uploadSprite3D);\r\n                        shaderIns._uploadRender = this._renderShaderData;\r\n                    }\r\n                }\r\n                //camera\r\n                var uploadCamera: boolean = shaderIns._uploadCameraShaderValue !== cameraShaderData || switchUpdateMark;\r\n                if (uploadCamera || switchShader) {\r\n                    cameraShaderData && shaderIns.uploadUniforms(shaderIns._cameraUniformParamsMap, cameraShaderData, uploadCamera);\r\n                    shaderIns._uploadCameraShaderValue = cameraShaderData;\r\n                }\r\n                //material\r\n                var uploadMaterial: boolean = (shaderIns._uploadMaterial !== this._materialShaderData) || switchUpdateMark;\r\n                if (uploadMaterial || switchShader) {\r\n                    shaderIns.uploadUniforms(shaderIns._materialUniformParamsMap, this._materialShaderData, uploadMaterial);\r\n                    shaderIns._uploadMaterial = this._materialShaderData;\r\n                    //GlobalData\r\n                    context.globalShaderData && shaderIns.uploadUniforms(shaderIns._materialUniformParamsMap, context.globalShaderData, uploadMaterial);\r\n                }\r\n                //renderData update\r\n                //TODORenderstate as a Object to less upload\r\n                shaderIns.uploadRenderStateBlendDepth(this._materialShaderData);\r\n                shaderIns.uploadRenderStateFrontFace(this._materialShaderData, forceInvertFace, this._invertFront);\r\n                this.drawGeometry(shaderIns);\r\n            }\r\n        }\r\n    }\r\n\r\n    drawGeometry(shaderIns: ShaderInstance) {\r\n        LayaGL.renderDrawContext.drawGeometryElement(this._geometry);\r\n    }\r\n\r\n    _destroy() {\r\n        this._geometry = null;\r\n        this._shaderInstances = null;\r\n        this._materialShaderData = null;\r\n        this._renderShaderData = null;\r\n        this._transform = null;\r\n        this._isRender = null;\r\n    }\r\n}","import { ShaderInstance } from \"../../../RenderEngine/RenderShader/ShaderInstance\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { RenderElementOBJ } from \"./RenderElementOBJ\";\r\n\r\nexport class InstanceRenderElementOBJ extends RenderElementOBJ {\r\n\r\n    /**@internal instance,*/\r\n    private _vertexBuffer3D: Array<VertexBuffer3D> = [];\r\n\r\n    private _updateData: Array<Float32Array> = [];\r\n\r\n    private _updateDataNum: Array<number> = [];\r\n\r\n    drawCount: number;\r\n\r\n    updateNums: number;\r\n\r\n    /**\r\n     * UpdateBuffer\r\n     * @param vb \r\n     * @param length instance\r\n     */\r\n    addUpdateBuffer(vb: VertexBuffer3D,length:number) {\r\n        this._vertexBuffer3D[this.updateNums] = vb;\r\n        this._updateDataNum[this.updateNums++] = length;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param index index of Buffer3D\r\n     * @param length length of array\r\n     */\r\n    getUpdateData(index: number,length:number): Float32Array {\r\n        let data = this._updateData[index];\r\n        if (!data || data.length < length) {\r\n            data = this._updateData[index] = new Float32Array(length);\r\n        }\r\n        return data;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * draw geometry\r\n     * @param shaderIns \r\n     */\r\n    drawGeometry(shaderIns: ShaderInstance) {\r\n        //instance,\r\n        let data: Float32Array;\r\n        let buffer: VertexBuffer3D;\r\n        for (let i = 0; i < this.updateNums; i++) {\r\n            buffer = this._vertexBuffer3D[i];\r\n            if (!buffer) break;\r\n            data = this._updateData[i];\r\n            buffer.orphanStorage();\r\n            buffer.setData(data.buffer, 0, 0, this.drawCount * this._updateDataNum[i] * 4);\r\n        }\r\n        LayaGL.renderDrawContext.drawGeometryElement(this._geometry);\r\n    }\r\n\r\n    clear() {\r\n        this.updateNums = 0;\r\n    }\r\n}","import { ISortPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISortPass\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { RenderElement } from \"../../core/render/RenderElement\";\r\n\r\n\r\n\r\nexport class QuickSort implements ISortPass {\r\n\tprivate elementArray: SingletonList<RenderElement>;\r\n\tprivate isTransparent: boolean;\r\n\r\n\t/**\r\n\t * \r\n\t * @param elements \r\n\t * @param isTransparent \r\n\t * @param left \r\n\t * @param right \r\n\t */\r\n\tsort(elements: SingletonList<RenderElement>, isTransparent: boolean, left: number, right: number): void {\r\n\t\tthis.elementArray = elements;\r\n\t\tthis.isTransparent = isTransparent;\r\n\t\tthis._quickSort(left, right);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_quickSort(left: number, right: number): void {\r\n\t\tif (this.elementArray.length > 1) {\r\n\t\t\tvar index: number = this._partitionRenderObject(left, right);\r\n\t\t\tvar leftIndex: number = index - 1;\r\n\t\t\tif (left < leftIndex)\r\n\t\t\t\tthis._quickSort(left, leftIndex);\r\n\r\n\t\t\tif (index < right)\r\n\t\t\t\tthis._quickSort(index, right);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _partitionRenderObject(left: number, right: number): number {\r\n\t\tvar elements: RenderElement[] = this.elementArray.elements;\r\n\t\tvar pivot: RenderElement = elements[Math.floor((right + left) / 2)];\r\n\t\twhile (left <= right) {\r\n\t\t\twhile (this._compare(elements[left], pivot) < 0)\r\n\t\t\t\tleft++;\r\n\t\t\twhile (this._compare(elements[right], pivot) > 0)\r\n\t\t\t\tright--;\r\n\t\t\tif (left < right) {\r\n\t\t\t\tvar temp: RenderElement = elements[left];\r\n\t\t\t\telements[left] = elements[right];\r\n\t\t\t\telements[right] = temp;\r\n\t\t\t\tleft++;\r\n\t\t\t\tright--;\r\n\t\t\t} else if (left === right) {\r\n\t\t\t\tleft++;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn left;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _compare(left: RenderElement, right: RenderElement): number {\r\n\t\tvar renderQueue: number = left._material.renderQueue - right._material.renderQueue;\r\n\t\tif (renderQueue === 0) {\r\n\t\t\tvar sort: number = this.isTransparent ? right._baseRender._distanceForSort - left._baseRender._distanceForSort : left._baseRender._distanceForSort - right._baseRender._distanceForSort;\r\n\t\t\treturn sort + right._baseRender.sortingFudge - left._baseRender.sortingFudge;\r\n\t\t} else {\r\n\t\t\treturn renderQueue;\r\n\t\t}\r\n\t}\r\n\r\n}","\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { IRenderTarget } from \"../../../RenderEngine/RenderInterface/IRenderTarget\";\r\nimport { IRenderContext3D, PipelineMode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Viewport } from \"../../math/Viewport\";\r\nimport { RenderElementOBJ } from \"./RenderElementOBJ\";\r\n\r\nexport class RenderContext3DOBJ implements IRenderContext3D {\r\n\r\n    //dest Texture\r\n    destTarget: IRenderTarget;\r\n    //viewPort\r\n    viewPort: Viewport;\r\n    //scissor\r\n    scissor: Vector4;\r\n    //is invert Y\r\n    invertY: boolean = false;\r\n    //pipeLineMode\r\n    pipelineMode: PipelineMode;\r\n    // config shader data\r\n    configShaderData: ShaderData;\r\n    //Camera Shader Data\r\n    cameraShaderData: ShaderData;\r\n    //Scene cache\r\n    sceneID: number;\r\n    //scene Shader Data\r\n    sceneShaderData: ShaderData;\r\n    //Camera Update Mark\r\n    cameraUpdateMark: number;\r\n    //Global ShaderData\r\n    globalShaderData: ShaderData;\r\n\r\n    constructor() {\r\n        this.viewPort = new Viewport(0, 0, 0, 0);\r\n        this.scissor = new Vector4();\r\n        this.pipelineMode = \"Forward\";\r\n        this.configShaderData = new ShaderData();\r\n    }\r\n    end(): void {\r\n        //TODO\r\n    }\r\n\r\n    /**IRenderContext */\r\n    applyContext(cameraUpdateMark: number): void {\r\n        this.destTarget && this.destTarget._start();\r\n        this.cameraUpdateMark = cameraUpdateMark;\r\n        LayaGL.renderEngine.viewport(this.viewPort.x, this.viewPort.y, this.viewPort.width, this.viewPort.height);\r\n        LayaGL.renderEngine.scissor(this.scissor.x, this.scissor.y, this.scissor.z, this.scissor.w);\r\n    }\r\n\r\n    drawRenderElement(renderelemt: RenderElementOBJ): void {\r\n        renderelemt._render(this);\r\n    }\r\n}","import { GLRenderDrawContext } from \"../../../RenderEngine/RenderEngine/WebGLEngine/GLRenderDrawContext\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { IRenderGeometryElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderGeometryElement\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\n\r\nexport class FastSinglelist<T> extends SingletonList<T> {\r\n\r\n  /**\r\n    * @internal\r\n    */\r\n  add(element: T): void {\r\n    if (this.length === this.elements.length)\r\n      this.elements.push(element);\r\n    else\r\n      this.elements[this.length] = element;\r\n  }\r\n\r\n}\r\n\r\nexport class RenderGeometryElementOBJ implements IRenderGeometryElement {\r\n  /**@internal */\r\n  bufferState: BufferState;\r\n\r\n  /**@internal */\r\n  private _mode: MeshTopology;\r\n\r\n  /**@internal */\r\n  _glmode: number;\r\n\r\n  /**@internal */\r\n  drawType: DrawType;\r\n\r\n  /**@internal */\r\n  drawParams: FastSinglelist<number>;\r\n\r\n  /**@internal */\r\n  instanceCount: number;\r\n\r\n  /**@internal */\r\n  _glindexFormat: number;\r\n\r\n  /**@internal */\r\n  private _indexFormat: IndexFormat;\r\n\r\n  /**\r\n   * index format\r\n   */\r\n  public get indexFormat(): IndexFormat {\r\n    return this._indexFormat;\r\n  }\r\n\r\n  public set indexFormat(value: IndexFormat) {\r\n    this._indexFormat = value;\r\n    this._glindexFormat = (LayaGL.renderDrawContext as GLRenderDrawContext).getIndexType(this._indexFormat);\r\n  }\r\n\r\n  /**\r\n   * Mesh Topology mode \r\n   */\r\n  get mode(): MeshTopology {\r\n    return this._mode;\r\n  }\r\n\r\n  set mode(value: MeshTopology) {\r\n    this._mode = value;\r\n    this._glmode = (LayaGL.renderDrawContext as GLRenderDrawContext).getMeshTopology(this._mode);\r\n  }\r\n\r\n  /**@internal */\r\n  constructor(mode: MeshTopology, drawType: DrawType) {\r\n    this.mode = mode;\r\n    this.drawParams = new SingletonList();\r\n    this.drawType = drawType;\r\n  }\r\n\r\n  /**@internal */\r\n  setDrawArrayParams(first: number, count: number): void {\r\n    this.drawParams.add(first);\r\n    this.drawParams.add(count);\r\n  }\r\n\r\n  /**@internal */\r\n  setDrawElemenParams(count: number, offset: number): void {\r\n    this.drawParams.add(offset);\r\n    this.drawParams.add(count);\r\n\r\n  }\r\n\r\n  /**@internal */\r\n  destroy(): void {\r\n    delete this.drawParams;\r\n  }\r\n  /**@internal */\r\n  clearRenderParams() {\r\n    this.drawParams.length = 0;\r\n  }\r\n}","import { ISceneRenderManager } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\n\r\n\r\nexport class SceneRenderManagerOBJ implements ISceneRenderManager {\r\n    /** @internal */\r\n    _renders: SingletonList<BaseRender> = new SingletonList();\r\n    _motionRenders: SingletonList<BaseRender> = new SingletonList();\r\n    constructor() {\r\n\r\n    }\r\n\r\n    get list() {\r\n        return this._renders;\r\n    }\r\n\r\n    set list(value) {\r\n        this._renders = value;\r\n    }\r\n\r\n    addRenderObject(object: BaseRender): void {\r\n        this._renders.add(object);\r\n    }\r\n    removeRenderObject(object: BaseRender): void {\r\n        this._renders.remove(object);\r\n        this.removeMotionObject(object);\r\n    }\r\n\r\n    removeMotionObject(object: BaseRender): void {\r\n        let index = object._motionIndexList;\r\n        if (index != -1) {//remove\r\n            let elements = this._motionRenders.elements;\r\n            this._motionRenders.length -= 1;\r\n            elements[length]._motionIndexList = index;\r\n            elements[index] = elements[length];\r\n        }\r\n\r\n        //TODO\r\n    }\r\n    updateMotionObjects(): void {\r\n        for (let i = 0; i < this._motionRenders.length; i++) {\r\n            this._motionRenders.elements[i].bounds;\r\n            this._motionRenders.elements[i]._motionIndexList = -1;\r\n        }\r\n        this._motionRenders.length = 0;\r\n\r\n        //TODO\r\n    }\r\n    addMotionObject(object: BaseRender): void {\r\n        if (object._motionIndexList == -1) {\r\n            object._motionIndexList = this._motionRenders.length;\r\n            this._motionRenders.add(object);\r\n        }\r\n\r\n        //TODO\r\n    }\r\n    destroy(): void {\r\n        this._renders.destroy();\r\n    }\r\n\r\n}","import { Vector3 } from \"../../../maths/Vector3\";\r\nimport { IShadowCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { BoundSphere } from \"../../math/BoundSphere\";\r\nimport { Plane } from \"../../math/Plane\";\r\n\r\nexport class ShadowCullInfo implements IShadowCullInfo {\r\n    position: Vector3;\r\n    cullPlanes: Plane[];\r\n    cullSphere: BoundSphere;\r\n    cullPlaneCount: number;\r\n    direction: Vector3;\r\n}","\r\nimport { ShaderInstance } from \"../../../RenderEngine/RenderShader/ShaderInstance\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { SkinnedMeshSprite3D } from \"../../core/SkinnedMeshSprite3D\";\r\nimport { RenderElementOBJ } from \"./RenderElementOBJ\";\r\nimport { RenderGeometryElementOBJ } from \"./RenderGeometryElementOBJ\";\r\n\r\nexport class SkinRenderElementOBJ extends RenderElementOBJ {\r\n\r\n    skinnedData: Float32Array[];\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**  */\r\n    drawGeometry(shaderIns: ShaderInstance) {\r\n        let length = this._shaderInstances.length;\r\n        let element = this._geometry.drawParams.elements;\r\n        if (!this.skinnedData)\r\n            return;\r\n        this._geometry.bufferState.bind();\r\n        for (var i: number = 0, n: number = length; i < n; i++) {\r\n            for (var j = 0, m = this._geometry.drawParams.length / 2; j < m; j++) {\r\n                var subSkinnedDatas: Float32Array = this.skinnedData[j];\r\n                shaderIns.uploadCustomUniform(SkinnedMeshSprite3D.BONES, subSkinnedDatas);\r\n                var offset = j * 2;\r\n                LayaGL.renderDrawContext.drawElements((this._geometry as RenderGeometryElementOBJ)._glmode, element[offset + 1], (this._geometry as RenderGeometryElementOBJ)._glindexFormat, element[offset]);\r\n            }\r\n        }\r\n    }\r\n}","import { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { IClone } from \"../../utils/IClone\";\r\nimport { BoundBox } from \"./BoundBox\";\r\n\r\n/**\r\n * <code>BoundsImp</code> \r\n */\r\nexport class BoundsImpl implements IClone {\r\n    /**@internal */\r\n    static _UPDATE_MIN: number = 0x01;\r\n    /**@internal */\r\n    static _UPDATE_MAX: number = 0x02;\r\n    /**@internal */\r\n    static _UPDATE_CENTER: number = 0x04;\r\n    /**@internal */\r\n    static _UPDATE_EXTENT: number = 0x08;\r\n\r\n    protected _updateFlag: number = 0;\r\n\r\n    /**@internal\t*/\r\n    _center: Vector3 = new Vector3();\r\n    /**@internal\t*/\r\n    _extent: Vector3 = new Vector3();\r\n    /***/\r\n    _boundBox: BoundBox = new BoundBox(new Vector3(), new Vector3());\r\n\r\n    get min() {\r\n        return this.getMin();\r\n    }\r\n\r\n    set min(value: Vector3) {\r\n        this.setMin(value);\r\n    }\r\n\r\n    get max() {\r\n        return this.getMax();\r\n    }\r\n\r\n    set max(value: Vector3) {\r\n        this.setMax(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setMin(value: Vector3): void {\r\n        var min: Vector3 = this._boundBox.min;\r\n        if (value !== min)\r\n            value.cloneTo(min);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_CENTER | BoundsImpl._UPDATE_EXTENT, true);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_MIN, false);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getMin(): Vector3 {\r\n        var min: Vector3 = this._boundBox.min;\r\n        if (this._getUpdateFlag(BoundsImpl._UPDATE_MIN)) {\r\n            this._getMin(this.getCenter(), this.getExtent(), min);\r\n            this._setUpdateFlag(BoundsImpl._UPDATE_MIN, false);\r\n        }\r\n        return min;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setMax(value: Vector3): void {\r\n        var max: Vector3 = this._boundBox.max;\r\n        if (value !== max)\r\n            value.cloneTo(max);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_CENTER | BoundsImpl._UPDATE_EXTENT, true);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_MAX, false);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getMax(): Vector3 {\r\n        var max: Vector3 = this._boundBox.max;\r\n        if (this._getUpdateFlag(BoundsImpl._UPDATE_MAX)) {\r\n            this._getMax(this.getCenter(), this.getExtent(), max);\r\n            this._setUpdateFlag(BoundsImpl._UPDATE_MAX, false);\r\n        }\r\n        return max;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setCenter(value: Vector3): void {\r\n        if (value !== this._center)\r\n            value.cloneTo(this._center);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_MIN | BoundsImpl._UPDATE_MAX, true);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_CENTER, false);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getCenter(): Vector3 {\r\n        if (this._getUpdateFlag(BoundsImpl._UPDATE_CENTER)) {\r\n            this._getCenter(this.getMin(), this.getMax(), this._center);\r\n            this._setUpdateFlag(BoundsImpl._UPDATE_CENTER, false);\r\n        }\r\n        return this._center;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setExtent(value: Vector3): void {\r\n        if (value !== this._extent)\r\n            value.cloneTo(this._extent);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_MIN | BoundsImpl._UPDATE_MAX, true);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_EXTENT, false);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getExtent(): Vector3 {\r\n        if (this._getUpdateFlag(BoundsImpl._UPDATE_EXTENT)) {\r\n            this._getExtent(this.getMin(), this.getMax(), this._extent);\r\n            this._setUpdateFlag(BoundsImpl._UPDATE_EXTENT, false);\r\n        }\r\n        return this._extent;\r\n    }\r\n\r\n    /**\r\n     *  <code>BoundsImp</code> \r\n     * @param\tmin  min \r\n     * @param\tmax  max \r\n     */\r\n    constructor(min?: Vector3, max?: Vector3) {\r\n        min && min.cloneTo(this._boundBox.min);\r\n        max && max.cloneTo(this._boundBox.max);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_CENTER | BoundsImpl._UPDATE_EXTENT, true);\r\n    }\r\n\r\n    protected _getUpdateFlag(type: number): boolean {\r\n        return (this._updateFlag & type) != 0;\r\n    }\r\n\r\n\r\n    protected _setUpdateFlag(type: number, value: boolean): void {\r\n        if (value)\r\n            this._updateFlag |= type;\r\n        else\r\n            this._updateFlag &= ~type;\r\n    }\r\n\r\n\r\n    protected _getCenter(min: Vector3, max: Vector3, out: Vector3): void {\r\n        Vector3.add(min, max, out);\r\n        Vector3.scale(out, 0.5, out);\r\n    }\r\n\r\n\r\n    protected _getExtent(min: Vector3, max: Vector3, out: Vector3): void {\r\n        Vector3.subtract(max, min, out);\r\n        Vector3.scale(out, 0.5, out);\r\n    }\r\n\r\n\r\n    protected _getMin(center: Vector3, extent: Vector3, out: Vector3): void {\r\n        Vector3.subtract(center, extent, out);\r\n    }\r\n\r\n\r\n    protected _getMax(center: Vector3, extent: Vector3, out: Vector3): void {\r\n        Vector3.add(center, extent, out);\r\n    }\r\n\r\n    protected _rotateExtents(extents: Vector3, rotation: Matrix4x4, out: Vector3): void {\r\n        var extentsX: number = extents.x;\r\n        var extentsY: number = extents.y;\r\n        var extentsZ: number = extents.z;\r\n        var matE: Float32Array = rotation.elements;\r\n        out.x = Math.abs(matE[0] * extentsX) + Math.abs(matE[4] * extentsY) + Math.abs(matE[8] * extentsZ);\r\n        out.y = Math.abs(matE[1] * extentsX) + Math.abs(matE[5] * extentsY) + Math.abs(matE[9] * extentsZ);\r\n        out.z = Math.abs(matE[2] * extentsX) + Math.abs(matE[6] * extentsY) + Math.abs(matE[10] * extentsZ);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _tranform(matrix: Matrix4x4, out: BoundsImpl): void {\r\n        var outCen: Vector3 = out._center;\r\n        var outExt: Vector3 = out._extent;\r\n\r\n        Vector3.transformCoordinate(this.getCenter(), matrix, outCen);\r\n        this._rotateExtents(this.getExtent(), matrix, outExt);\r\n\r\n        out._boundBox.setCenterAndExtent(outCen, outExt);\r\n        out._updateFlag = 0;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getBoundBox(): BoundBox {\r\n        if (this._updateFlag & BoundsImpl._UPDATE_MIN) {\r\n            var min: Vector3 = this._boundBox.min;\r\n            this._getMin(this.getCenter(), this.getExtent(), min);\r\n            this._setUpdateFlag(BoundsImpl._UPDATE_MIN, false);\r\n        }\r\n        if (this._updateFlag & BoundsImpl._UPDATE_MAX) {\r\n            var max: Vector3 = this._boundBox.max;\r\n            this._getMax(this.getCenter(), this.getExtent(), max);\r\n            this._setUpdateFlag(BoundsImpl._UPDATE_MAX, false);\r\n        }\r\n        return this._boundBox;\r\n    }\r\n\r\n    /**\r\n     * @returns -1 0\r\n     */\r\n    calculateBoundsintersection(bounds: BoundsImpl): number {\r\n        var ownMax: Vector3 = this.getMax();\r\n        var ownMin: Vector3 = this.getMin();\r\n        var calMax: Vector3 = bounds.getMax();\r\n        var calMin: Vector3 = bounds.getMin();\r\n        var tempV0: Vector3 = TEMP_VECTOR3_MAX0;\r\n        var tempV1: Vector3 = TEMP_VECTOR3_MAX1;\r\n        var thisExtends: Vector3 = this.getExtent();\r\n        var boundExtends: Vector3 = bounds.getExtent();\r\n        tempV0.setValue(Math.max(ownMax.x, calMax.x) - Math.min(ownMin.x, calMin.x),\r\n            Math.max(ownMax.y, calMax.y) - Math.min(ownMin.y, calMin.y),\r\n            Math.max(ownMax.z, calMax.z) - Math.min(ownMin.z, calMin.z));\r\n        tempV1.setValue((thisExtends.x + boundExtends.x) * 2.0,\r\n            (thisExtends.y + boundExtends.y) * 2.0,\r\n            (thisExtends.z + boundExtends.z) * 2.0);\r\n        if ((tempV0.x) > (tempV1.x)) return -1;\r\n        if ((tempV0.y) > (tempV1.y)) return -1;\r\n        if ((tempV0.z) > (tempV1.z)) return -1;\r\n        return (tempV1.x - tempV0.x) * (tempV1.y - tempV0.y) * (tempV1.z - tempV0.z);\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {\r\n        var destBounds: BoundsImpl = (<BoundsImpl>destObject);\r\n        this.getMin().cloneTo(destBounds._boundBox.min);\r\n        this.getMax().cloneTo(destBounds._boundBox.max);\r\n        this.getCenter().cloneTo(destBounds._center);\r\n        this.getExtent().cloneTo(destBounds._extent);\r\n        destBounds._updateFlag = 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): any {\r\n        var dest: BoundsImpl = new BoundsImpl(new Vector3(), new Vector3());\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n}\r\n\r\nconst TEMP_VECTOR3_MAX0 = new Vector3();\r\nconst TEMP_VECTOR3_MAX1 = new Vector3();","import { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { IBaseRenderNode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IBaseRenderNode\";\r\nimport { ICameraCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { ICullPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICullPass\";\r\nimport { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { IRenderElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderElement\";\r\nimport { IRenderGeometryElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderGeometryElement\";\r\nimport { IRenderQueue } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderQueue\";\r\nimport { ISceneRenderManager } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { IShadowCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { ISortPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISortPass\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { BoundsImpl } from \"../../math/BoundsImpl\";\r\nimport { IRenderEngine3DOBJFactory } from \"../IRenderEngine3DOBJFactory\";\r\nimport { Laya3DRender } from \"../Laya3DRender\";\r\nimport { BaseRenderNode } from \"./BaseRenderNode\";\r\nimport { BaseRenderQueue } from \"./BaseRenderQueue\";\r\nimport { CameraCullInfo } from \"./CameraCullInfo\";\r\nimport { CullPassBase } from \"./CullPass\";\r\nimport { InstanceRenderElementOBJ } from \"./InstanceRenderElementOBJ\";\r\nimport { QuickSort } from \"./QuickSort\";\r\nimport { RenderContext3DOBJ } from \"./RenderContext3DOBJ\";\r\nimport { RenderElementOBJ } from \"./RenderElementOBJ\";\r\nimport { RenderGeometryElementOBJ } from \"./RenderGeometryElementOBJ\";\r\nimport { SceneRenderManagerOBJ } from \"./SceneRenderManagerOBJ\";\r\nimport { ShadowCullInfo } from \"./ShadowCullInfo\";\r\nimport { SkinRenderElementOBJ } from \"./SkinRenderElementOBJ\";\r\n\r\nexport class WebGLRenderEngine3DFactory implements IRenderEngine3DOBJFactory{\r\n    createTransform(owner: Sprite3D): Transform3D {\r\n        return new Transform3D(owner);\r\n    }\r\n\r\n    createBounds(min: Vector3, max: Vector3): any {\r\n        return new BoundsImpl(min, max);\r\n    }\r\n\r\n    createRenderElement(): IRenderElement {\r\n        return new RenderElementOBJ();\r\n    }\r\n\r\n    createSkinRenderElement(): IRenderElement {\r\n        return new SkinRenderElementOBJ();\r\n    }\r\n    createInstanceRenderElement() {\r\n        return new InstanceRenderElementOBJ();\r\n    }\r\n\r\n    createBaseRenderQueue(isTransparent: boolean): IRenderQueue {\r\n        var queue: BaseRenderQueue = new BaseRenderQueue(isTransparent);\r\n        queue.sortPass = this.createSortPass();\r\n        return queue;\r\n    }\r\n\r\n    createVertexBuffer3D(byteLength: number, bufferUsage: BufferUsage, canRead: boolean = false) {\r\n        return new VertexBuffer3D(byteLength, bufferUsage, canRead);\r\n    }\r\n\r\n    createIndexBuffer3D(indexType: IndexFormat, indexCount: number, bufferUsage: BufferUsage = BufferUsage.Static, canRead: boolean = false): IndexBuffer3D {\r\n        return new IndexBuffer3D(indexType, indexCount, bufferUsage, canRead);\r\n    }\r\n\r\n    createSceneRenderManager(): ISceneRenderManager {\r\n        return new SceneRenderManagerOBJ();\r\n    }\r\n\r\n    createCullPass(): ICullPass {\r\n        return new CullPassBase();\r\n    }\r\n\r\n    createSortPass(): ISortPass {\r\n        return new QuickSort();\r\n    }\r\n\r\n    createShadowCullInfo(): IShadowCullInfo {\r\n        return new ShadowCullInfo();\r\n    }\r\n\r\n    createCameraCullInfo(): ICameraCullInfo {\r\n        return new CameraCullInfo();\r\n    }\r\n\r\n    createRenderGeometry(mode: MeshTopology, drayType: DrawType): IRenderGeometryElement {\r\n        return new RenderGeometryElementOBJ(mode, drayType);\r\n    }\r\n\r\n    createBaseRenderNode(): IBaseRenderNode {\r\n        return new BaseRenderNode();\r\n    }\r\n\r\n    createRenderContext3D(): IRenderContext3D {\r\n        return new RenderContext3DOBJ();\r\n    }\r\n\r\n\r\n}\r\nLaya3DRender.renderOBJCreate =new WebGLRenderEngine3DFactory();","import { ICollider } from \"../../Physics3D/interface/ICollider\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { PhysicsColliderComponent } from \"./PhysicsColliderComponent\"\r\n\r\n/**\r\n * <code>HitResult</code> \r\n */\r\nexport class HitResult {\r\n    /**  */\r\n    succeeded: boolean = false;\r\n    /** */\r\n    collider: ICollider = null;\r\n    /** */\r\n    point: Vector3 = new Vector3();\r\n    /** */\r\n    normal: Vector3 = new Vector3();\r\n    /**  */\r\n    hitFraction: number = 0;\r\n\r\n    /**\r\n     *  <code>HitResult</code> \r\n     */\r\n    constructor() {\r\n\r\n    }\r\n}\r\n\r\n\r\n","import { IResourceLoader, ILoadTask, Loader } from \"../../net/Loader\";\r\nimport { LensFlareData, LensFlareElement } from \"../core/render/PostEffect/LensFlares/LensFlareEffect\";\r\nimport { URL } from \"../../net/URL\";\r\nimport { Color } from \"../../maths/Color\";\r\nimport { Vector2 } from \"../../maths/Vector2\";\r\n\r\nexport class LensFlareSettingsLoader implements IResourceLoader {\r\n    load(task: ILoadTask) {\r\n        return task.loader.fetch(task.url, \"json\", task.progress.createCallback(), task.options).then(data => {\r\n            if (!data)\r\n                return null;\r\n            let ret = new LensFlareData();\r\n            let basePath = URL.getPath(task.url);\r\n            let promises: Array<any> = [];\r\n\r\n            let elements = data.elements;\r\n            if (elements)\r\n                for (let i = elements.length - 1; i >= 0; i--) {\r\n                    let e = elements[i];\r\n                    if (e.texture && (e.texture as any)._$uuid && '' != (e.texture as any)._$uuid) {\r\n                        let url = URL.getResURLByUUID((e.texture as any)._$uuid);\r\n                        if (!url.startsWith(\"res://\"))\r\n                            url = URL.join(basePath, url);\r\n                        promises.push(task.loader.load(url).then((t) => {\r\n                            e.texture = t;\r\n                        }))\r\n                    }\r\n                    if (e.tint) {\r\n                        e.tint = new Color(e.tint.r, e.tint.g, e.tint.b, e.tint.a);\r\n                    }\r\n                    if (e.positionOffset) {\r\n                        e.positionOffset = new Vector2(e.positionOffset.x, e.positionOffset.y);\r\n                    }\r\n                    if (e.scale) {\r\n                        e.scale = new Vector2(e.scale.x, e.scale.y);\r\n                    }\r\n                }\r\n\r\n            return Promise.all(promises).then(() => {\r\n                ret.elements = elements;\r\n                return ret;\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\nLoader.registerLoader([\"lensflare\"], LensFlareSettingsLoader);","/**\r\n\t * <code>Rand</code> 128,:https://github.com/AndreasMadsen/xorshift\r\n\t */\r\nexport class RandX {\r\n\t/**@internal */\r\n\tprivate static _CONVERTION_BUFFER: DataView = new DataView(new ArrayBuffer(8));\r\n\r\n\t/**@internal */\r\n\tprivate _state0U: number;\r\n\t/**@internal */\r\n\tprivate _state0L: number;\r\n\t/**@internal */\r\n\tprivate _state1U: number;\r\n\t/**@internal */\r\n\tprivate _state1L: number;\r\n\r\n\t/***/\r\n\tstatic defaultRand: RandX = new RandX([0, Date.now() / 65536, 0, Date.now() % 65536]);\r\n\r\n\t/**\r\n\t *  <code>Rand</code> \r\n\t * @param\tseed  \r\n\t */\r\n\tconstructor(seed: any[]) {\r\n\t\tif (!(seed instanceof Array) || seed.length !== 4)\r\n\t\t\tthrow new Error('Rand:Seed must be an array with 4 numbers');\r\n\r\n\t\tthis._state0U = seed[0] | 0;\r\n\t\tthis._state0L = seed[1] | 0;\r\n\t\tthis._state1U = seed[2] | 0;\r\n\t\tthis._state1L = seed[3] | 0;\r\n\t}\r\n\r\n\t/**\r\n\t * 2x3264\r\n\t * @return 64\r\n\t */\r\n\trandomint(): any[] {\r\n\t\t// uint64_t s1 = s[0]\r\n\t\tvar s1U: number = this._state0U, s1L: number = this._state0L;\r\n\t\t// uint64_t s0 = s[1]\r\n\t\tvar s0U: number = this._state1U, s0L: number = this._state1L;\r\n\r\n\t\t// result = s0 + s1\r\n\t\tvar sumL: number = (s0L >>> 0) + (s1L >>> 0);\r\n\t\tvar resU: number = (s0U + s1U + (sumL / 2 >>> 31)) >>> 0;\r\n\t\tvar resL: number = sumL >>> 0;\r\n\r\n\t\t// s[0] = s0\r\n\t\tthis._state0U = s0U;\r\n\t\tthis._state0L = s0L;\r\n\r\n\t\t// - t1 = [0, 0]\r\n\t\tvar t1U: number = 0, t1L: number = 0;\r\n\t\t// - t2 = [0, 0]\r\n\t\tvar t2U: number = 0, t2L: number = 0;\r\n\r\n\t\t// s1 ^= s1 << 23;\r\n\t\t// :: t1 = s1 << 23\r\n\t\tvar a1: number = 23;\r\n\t\tvar m1: number = 0xFFFFFFFF << (32 - a1);\r\n\t\tt1U = (s1U << a1) | ((s1L & m1) >>> (32 - a1));\r\n\t\tt1L = s1L << a1;\r\n\t\t// :: s1 = s1 ^ t1\r\n\t\ts1U = s1U ^ t1U;\r\n\t\ts1L = s1L ^ t1L;\r\n\r\n\t\t// t1 = ( s1 ^ s0 ^ ( s1 >> 17 ) ^ ( s0 >> 26 ) )\r\n\t\t// :: t1 = s1 ^ s0\r\n\t\tt1U = s1U ^ s0U;\r\n\t\tt1L = s1L ^ s0L;\r\n\t\t// :: t2 = s1 >> 18\r\n\t\tvar a2: number = 18;\r\n\t\tvar m2: number = 0xFFFFFFFF >>> (32 - a2);\r\n\t\tt2U = s1U >>> a2;\r\n\t\tt2L = (s1L >>> a2) | ((s1U & m2) << (32 - a2));\r\n\t\t// :: t1 = t1 ^ t2\r\n\t\tt1U = t1U ^ t2U;\r\n\t\tt1L = t1L ^ t2L;\r\n\t\t// :: t2 = s0 >> 5\r\n\t\tvar a3: number = 5;\r\n\t\tvar m3: number = 0xFFFFFFFF >>> (32 - a3);\r\n\t\tt2U = s0U >>> a3;\r\n\t\tt2L = (s0L >>> a3) | ((s0U & m3) << (32 - a3));\r\n\t\t// :: t1 = t1 ^ t2\r\n\t\tt1U = t1U ^ t2U;\r\n\t\tt1L = t1L ^ t2L;\r\n\r\n\t\t// s[1] = t1\r\n\t\tthis._state1U = t1U;\r\n\t\tthis._state1L = t1L;\r\n\r\n\t\t// return result\r\n\t\treturn [resU, resL];\r\n\t}\r\n\r\n\t/**\r\n\t * [0,1)\r\n\t * @return\r\n\t */\r\n\trandom(): number {\r\n\t\t// :: t2 = randomint()\r\n\t\tvar t2: any[] = this.randomint();\r\n\t\tvar t2U: number = t2[0];\r\n\t\tvar t2L: number = t2[1];\r\n\r\n\t\t// :: e = UINT64_C(0x3FF) << 52\r\n\t\tvar eU: number = 0x3FF << (52 - 32);\r\n\t\tvar eL: number = 0;\r\n\r\n\t\t// :: s = t2 >> 12\r\n\t\tvar a1: number = 12;\r\n\t\tvar m1: number = 0xFFFFFFFF >>> (32 - a1);\r\n\t\tvar sU: number = t2U >>> a1;\r\n\t\tvar sL: number = (t2L >>> a1) | ((t2U & m1) << (32 - a1));\r\n\r\n\t\t// :: x = e | s\r\n\t\tvar xU: number = eU | sU;\r\n\t\tvar xL: number = eL | sL;\r\n\r\n\t\t// :: double d = *((double *)&x)\r\n\t\tRandX._CONVERTION_BUFFER.setUint32(0, xU, false);\r\n\t\tRandX._CONVERTION_BUFFER.setUint32(4, xL, false);\r\n\t\tvar d: number = RandX._CONVERTION_BUFFER.getFloat64(0, false);\r\n\r\n\t\t// :: d - 1\r\n\t\treturn d - 1;\r\n\t}\r\n}\r\n\r\n\r\n","/**\r\n * <code>Physics</code> \r\n */\r\nexport class Physics3DUtils {\r\n\t/** */\r\n\tstatic COLLISIONFILTERGROUP_DEFAULTFILTER: number = 0x1;\r\n\t/** */\r\n\tstatic COLLISIONFILTERGROUP_STATICFILTER: number = 0x2;\r\n\t/** */\r\n\tstatic COLLISIONFILTERGROUP_KINEMATICFILTER: number = 0x4;\r\n\t/** */\r\n\tstatic COLLISIONFILTERGROUP_DEBRISFILTER: number = 0x8;\r\n\t/***/\r\n\tstatic COLLISIONFILTERGROUP_SENSORTRIGGER: number = 0x10;\r\n\t/** */\r\n\tstatic COLLISIONFILTERGROUP_CHARACTERFILTER: number = 0x20;\r\n\t/**1 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER1: number = 0x40;\r\n\t/**2 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER2: number = 0x80;\r\n\t/**3 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER3: number = 0x100;\r\n\t/**4 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER4: number = 0x200;\r\n\t/**5 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER5: number = 0x400;\r\n\t/**6 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER6: number = 0x800;\r\n\t/**7 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER7: number = 0x1000;\r\n\t/**8 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER8: number = 0x2000;\r\n\t/**9 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER9: number = 0x4000;\r\n\t/**10*/\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER10: number = 0x8000;\r\n\t/** */\r\n\tstatic COLLISIONFILTERGROUP_ALLFILTER: number = -1;\r\n\t/**PHYSX */\r\n\tstatic PHYSXDEFAULTMASKVALUE: number = 0xffffffff;\r\n}\r\n\r\n\r\n","import { RenderContext3D } from \"../core/render/RenderContext3D\"\r\n\t/**\r\n\t * \r\n\t */\r\n\texport class Size {\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\t static get fullScreen():Size {\r\n\t\t\treturn new Size(-1, -1);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _width:number = 0;\r\n\t\tprivate _height:number = 0;\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\tget width():number {\r\n\t\t\tif (this._width === -1)\r\n\t\t\t\treturn RenderContext3D.clientWidth;\r\n\t\t\t\r\n\t\t\treturn this._width;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\tget height():number {\r\n\t\t\tif (this._height === -1)\r\n\t\t\t\treturn RenderContext3D.clientHeight;\r\n\t\t\treturn this._height;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * Size\r\n\t\t * @param width  \r\n\t\t * @param height \r\n\t\t */\r\n\t\tconstructor(width:number, height:number){\r\n\t\t\tthis._width = width;\r\n\t\t\tthis._height = height;\r\n\t\t}\r\n\t\r\n\t}\r\n\r\n\r\n","export enum ECharacterCapable {\r\n    //Charcater_AllowSleep,   // \r\n    //Charcater_AllowTrigger, // \r\n    Charcater_Gravity,  // \r\n    Charcater_CollisionGroup, // \r\n    //Charcater_Friction,   // \r\n    //Charcater_RollingFriction,    // \r\n    //Charcater_Restitution,    // \r\n    Charcater_WorldPosition,    // \r\n    Charcater_Move, // \r\n    Charcater_Jump, // \r\n    Charcater_StepOffset,   // \r\n    Character_UpDirection,  // \r\n    Character_FallSpeed, // \r\n    Character_SlopeLimit,   // \r\n    Character_PushForce,    // \r\n    Character_Radius,   // \r\n    Character_Height,   // \r\n    Character_offset,   // \r\n    Character_Skin,   // \r\n    Character_minDistance,\r\n    Character_EventFilter, // \r\n}","export enum EColliderCapable {\r\n    Collider_CollisionGroup, // \r\n    Collider_Friction,   // \r\n    Collider_RollingFriction,    // \r\n    Collider_Restitution,    // \r\n    Collider_AllowTrigger, // \r\n    Collider_DynamicFriction,\r\n    Collider_StaticFriction,\r\n    Collider_BounceCombine,\r\n    Collider_FrictionCombine,\r\n    Collider_EventFilter,   // \r\n\r\n    // RigidBody\r\n    RigidBody_CanKinematic,   // \r\n    RigidBody_AllowSleep,   // \r\n    RigidBody_Gravity,   // \r\n    RigidBody_LinearDamp, // \r\n    RigidBody_AngularDamp,    // \r\n    RigidBody_LinearVelocity, // \r\n    RigidBody_AngularVelocity,    //  \r\n    RigidBody_Mass,   // \r\n    RigidBody_WorldPosition,   // \r\n    RigidBody_WorldOrientation,   // \r\n    RigidBody_InertiaTensor,  // \r\n    RigidBody_MassCenter, // \r\n    RigidBody_MaxAngularVelocity, // \r\n    RigidBody_MaxDepenetrationVelocity,   // \r\n    RigidBody_SleepThreshold, //bug TODO\r\n    RigidBody_SleepAngularVelocity,   //   TODO\r\n    RigidBody_SolverIterations,   // \r\n    RigidBody_AllowDetectionMode,   // \r\n    RigidBody_AllowKinematic,   // \r\n    RigidBody_AllowCharacter,   // \r\n    RigidBody_LinearFactor,   // \r\n    RigidBody_AngularFactor,  // \r\n    RigidBody_ApplyForce, // \r\n    RigidBody_ClearForce, // \r\n    RigidBody_ApplyForceWithOffset,    // \r\n    RigidBody_ApplyTorque,    // \r\n    RigidBody_ApplyImpulse,   // \r\n    RigidBody_ApplyTorqueImpulse, // \r\n}","export enum EJointCapable {\r\n    Joint_Anchor,   // \r\n    Joint_ConnectAnchor,    // \r\n}","import { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { IJoint } from \"./IJoint\";\r\nexport enum D6MotionType {\r\n    eX = 0,\t//!< motion along the X axis\r\n    eY = 1,\t//!< motion along the Y axis\r\n    eZ = 2,\t//!< motion along the Z axis\r\n    eTWIST = 3,\t//!< motion around the X axis\r\n    eSWING1 = 4,\t//!< motion around the Y axis\r\n    eSWING2 = 5,\t//!< motion around the Z axis\r\n}\r\n\r\nexport enum D6Axis {\r\n    eLOCKED,\t//!< The DOF is locked, it does not allow relative motion.\r\n    eLIMITED,\t//!< The DOF is limited, it only allows motion within a specific range.\r\n    eFREE\t//!< The DOF is free and has its full range of motion.\r\n}\r\n\r\nexport enum D6Drive {\r\n    eX = 0,\t//!< drive along the X-axis\r\n    eY = 1,\t//!< drive along the Y-axis\r\n    eZ = 2,\t//!< drive along the Z-axis\r\n    eSWING = 3,\t//!< drive of displacement from the X-axis\r\n    eTWIST = 4,\t//!< drive of the displacement around the X-axis\r\n    eSLERP = 5,\t//!< drive of all three angular degrees along a SLERP-path\r\n}\r\n\r\nexport interface ID6Joint extends IJoint {\r\n    setAxis(axis: Vector3, secendary: Vector3): void;\r\n    //Set the motion type around the specified axis.\r\n    setMotion(axis: D6Axis, motionType: D6MotionType): void;\r\n    //Set Distance limit Params\r\n    setDistanceLimit(limit: number, bounceness: number, bounceThreshold: number, spring: number, damp: number): void;\r\n    //x,y,z linear Limit\r\n    setLinearLimit(linearAxis: D6MotionType, upper: number, lower: number, bounceness: number, bounceThreshold: number, spring: number, damping: number): void;\r\n    //The twist limit controls the range of motion around the twist axis. \r\n    setTwistLimit(upper: number, lower: number, bounceness: number, bounceThreshold: number, spring: number, damping: number): void;\r\n    //\r\n    setSwingLimit(yAngle: number, zAngle: number, bounceness: number, bounceThreshold: number, spring: number, damping: number): void;\r\n    //setDrive\r\n    setDrive(index: D6Drive, stiffness: number, damping: number, forceLimit: number): void;\r\n    //drive Position \r\n    setDriveTransform(position: Vector3, rotate: Quaternion): void;\r\n    //\r\n    setDriveVelocity(position: Vector3, angular: Vector3): void;\r\n    //get the twist angle of the joint, in the range (-2*Pi, 2*Pi]\r\n    getTwistAngle(): number\r\n    //get the swing angle of the joint from the Y axis\r\n    getSwingYAngle(): number;\r\n    //get the swing angle of the joint from the Z axis\r\n    getSwingZAngle(): number;\r\n}","import { RenderTargetFormat } from \"../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { RenderTexture } from \"../../../resource/RenderTexture\";\r\nimport { WebXRExperienceHelper } from \"./WebXRExperienceHelper\";\r\n\r\n\r\n/**\r\n * @author miner\r\n * WebXRRenderTexture\r\n */\r\nexport class WebXRRenderTexture extends RenderTexture {\r\n\r\n\t/** @internal */\r\n\tprotected _frameBuffer: any;\r\n\t/**update mask */\r\n\tpublic frameLoop: number = -1;\r\n\r\n\t/**\r\n\t * WebXRFrameBuffer\r\n\t * @param frameBuffer \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper(1, 1, 1, RenderTargetFormat.STENCIL_8, false, 1);\r\n\t}\r\n\r\n\t/**\r\n\t * set frameBuffer\r\n\t */\r\n\tset frameBuffer(value: any) {\r\n\t\tthis._frameBuffer = value;\r\n\t}\r\n\r\n\t/**\r\n\t * No glframeBuffer create\r\n\t * @param width \r\n\t * @param height \r\n\t */\r\n\tprotected _create(width: number, height: number): void {\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_start(): void {\r\n\t\tvar gl: WebGLRenderingContext =  WebXRExperienceHelper.glInstance;\r\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\r\n\t\tRenderTexture._currentActive = this;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_end(): void {\r\n\t\tvar gl: WebGLRenderingContext = WebXRExperienceHelper.glInstance;\r\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\t\tRenderTexture._currentActive = null;\r\n\t}\r\n\r\n}","import { ILaya } from \"../../../../ILaya\";\r\nimport { EventDispatcher } from \"../../../events/EventDispatcher\";\r\n\r\n/**\r\n * Manages an XRSession to work with layaAir engine\r\n * @author miner\r\n */\r\nexport class WebXRSessionManager extends EventDispatcher {\r\n\r\n    static EVENT_MANAGER_END:string = \"xrManagerDestory\";\r\n    static EVENT_FRAME_LOOP:string = \"xrFrameLoop\";\r\n\r\n    \r\n    /**\r\n     * Underlying xr session\r\n     */\r\n    public session: any//: \r\n    /**\r\n     * XRReferenceSpace TODO\r\n     */\r\n    public viewerReferenceSpace: any; //XRReferenceSpace;\r\n\r\n    /** baseRefernceSpace */\r\n    public baseReferenceSpace: any;//;\r\n    /** Current XR  XRFrame*/\r\n    public currentFrame: any;//\r\n    /** WebXR timestamp updated every frame */\r\n    public currentTimestamp: number = -1;\r\n    /**,init */\r\n    public defaultHeightCompensation = 1.7;\r\n\r\n    /**\r\n     * XRReferenceSpace\r\n     */\r\n    private _referenceSpace: any;\r\n    /** \"inline\" | \"immersive-vr\" | \"immersive-ar\"*/\r\n    private _sessionMode: any;\r\n    /** session enable state */\r\n    private _sessionEnded: boolean = false;\r\n    /**WebXR Base Layer */\r\n    private _baseLayer:any;\r\n    /**web XRSystem */\r\n    private _xrNavigator: any;\r\n    /**\r\n     * @internal\r\n     * WebXR\r\n     */\r\n    constructor() {\r\n        super();\r\n    }\r\n    /**\r\n    * The current reference space used in this session.\r\n    * @returns XRReferenceSpace;\r\n    */\r\n    public get referenceSpace() {\r\n        return this._referenceSpace;\r\n    }\r\n\r\n    /**\r\n     * set \r\n     */\r\n    public set referenceSpace(newReferenceSpace) {\r\n        this._referenceSpace = newReferenceSpace;\r\n    }\r\n\r\n    /**\r\n    * The mode for the managed XR session\r\n    */\r\n    public get sessionMode() {\r\n        return this._sessionMode;\r\n    }\r\n\r\n    /**\r\n     * Stops the xrSession and restores the render loop\r\n     */\r\n    exitXR() {\r\n        this.endXRRenderLoop();\r\n        this.event(WebXRSessionManager.EVENT_MANAGER_END);\r\n    }\r\n    \r\n    /**\r\n     * Initializes the xr layer for the session \r\n     * @param xrSession \r\n     * @param gl \r\n     * @returns \r\n     */\r\n    public initializeXRGL(xrSession: any, gl: WebGLRenderingContext): Promise<boolean> {//: XRWebGLLayer {\r\n        return (gl as any).makeXRCompatible().then(()=> {\r\n            return true;\r\n        });\r\n    };\r\n\r\n    /**\r\n     * WebXR\r\n     * @returns WebXR\r\n     */\r\n    public initializeAsync(): Promise<void> {\r\n        // Check if the browser supports webXR\r\n        this._xrNavigator = navigator;\r\n        if (!this._xrNavigator.xr) {\r\n            return Promise.reject(\"WebXR not available\");\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n\r\n    /**\r\n     * Sessiopn\r\n     * @param sessionMode \"inline\" | \"immersive-vr\" | \"immersive-ar\"\r\n     * @returns A Promise that resolves to true if supported and false if not\r\n     */\r\n    public isSessionSupportedAsync(sessionMode: string): Promise<boolean> {\r\n        if (!(navigator as any).xr) {\r\n            return Promise.resolve(false);\r\n        } else {\r\n            this._xrNavigator = navigator;\r\n        }\r\n        const functionToUse = (navigator as any).xr.isSessionSupported || (navigator as any).xr.supportsSession;\r\n        if (!functionToUse)\r\n            return Promise.resolve(false);\r\n        else {\r\n            return (navigator as any).xr.isSessionSupported(sessionMode);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Session\r\n     * @param xrSessionMode xrsessionMode\r\n     * @param xrSessionInit any initInfo\r\n     * @returns \r\n     */\r\n    public initializeSessionAsync(xrSessionMode = 'immersive-vr', xrSessionInit = {}): Promise<any> {\r\n        return this._xrNavigator.xr.requestSession('immersive-vr').then((session: any) => {\r\n            this.session = session;\r\n            this._sessionMode = xrSessionMode;\r\n            this._sessionEnded = false;\r\n\r\n            // handle\r\n            this.session.addEventListener(\r\n                \"end\",\r\n                () => {\r\n                    this._sessionEnded = true;\r\n                    this.exitXR();\r\n                },\r\n                { once: true }\r\n            );\r\n\r\n            return this.session;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Resets the reference space to the one started the session\r\n     */\r\n    public resetReferenceSpace() {\r\n        this.referenceSpace = this.baseReferenceSpace;\r\n    }\r\n\r\n    /**\r\n     * Starts rendering to the xr layer\r\n     */\r\n    public runXRRenderLoop() {\r\n        this.session.requestAnimationFrame.bind(this.session);\r\n        let fn = (timestamp: any, xrFrame: any) => {\r\n            this._updateByXrFrame(xrFrame, timestamp);\r\n            this.event(WebXRSessionManager.EVENT_FRAME_LOOP, [xrFrame]);\r\n            ILaya.stage._loop();\r\n            this.session.requestAnimationFrame(fn);\r\n        };\r\n        this.session.requestAnimationFrame(fn);\r\n    }\r\n\r\n    public endXRRenderLoop(){\r\n\r\n    }\r\n\r\n    /**\r\n     * Update\r\n     * @param xrFrame \r\n     */\r\n    private _updateByXrFrame(xrFrame: any, timestamp: number) {\r\n        this.currentFrame = xrFrame;\r\n        this.currentTimestamp = timestamp;\r\n    }\r\n\r\n    /**\r\n    * Sets the reference space on the xr session\r\n    * @param referenceSpaceType space to set\r\n    * @returns a promise that will resolve once the reference space has been set\r\n    */\r\n    public setReferenceSpaceTypeAsync(referenceSpaceType = \"local-floor\"): Promise<any> {//XRReferenceSpace\r\n        return this.session\r\n            .requestReferenceSpace(referenceSpaceType)\r\n            .then(\r\n                (referenceSpace: any) => {\r\n                    return referenceSpace;\r\n                },\r\n                (rejectionReason: any) => {\r\n                    return this.session.requestReferenceSpace(\"viewer\").then(\r\n                        (referenceSpace: any) => {\r\n                            //@ts-ignore\r\n                            const heightCompensation = new XRRigidTransform({ x: 0, y: -this.defaultHeightCompensation, z: 0 });\r\n                            return (referenceSpace).getOffsetReferenceSpace(heightCompensation);\r\n                        },\r\n                        (rejectionReason: any) => {\r\n\r\n                            throw 'XR initialization failed: required \"viewer\" reference space type not supported.';\r\n                        }\r\n                    );\r\n                }\r\n            ).then((referenceSpace: any) => {\r\n                // initialize the base and offset (currently the same)\r\n                this.referenceSpace = this.baseReferenceSpace = referenceSpace;\r\n                return this.referenceSpace;\r\n            });\r\n    }\r\n\r\n    /**\r\n    * Updates the render state of the session\r\n    * @param state state to set\r\n    * @returns a promise that resolves once the render state has been updated\r\n    */\r\n    public updateRenderStateAsync(state: any) {//: XRRenderState) {\r\n        if (state.baseLayer) {\r\n            this._baseLayer = state.baseLayer;\r\n        }\r\n        return this.session.updateRenderState(state);\r\n    }\r\n\r\n    /**\r\n     * The current frame rate as reported by the device\r\n     */\r\n    public get currentFrameRate(): number | undefined {\r\n        return this.session?.frameRate;\r\n    }\r\n\r\n    /**\r\n    * A list of supported frame rates (only available in-session!\r\n    */\r\n    public get supportedFrameRates(): Float32Array | undefined {\r\n        return this.session?.supportedFrameRates;\r\n    }\r\n\r\n    /**\r\n     * Set the framerate of the session.\r\n     * @param rate the new framerate. This value needs to be in the supportedFrameRates array\r\n     * @returns a promise that resolves once the framerate has been set\r\n     */\r\n    public updateTargetFrameRate(rate: number): Promise<void> {\r\n        return this.session.updateTargetFrameRate(rate);\r\n    }\r\n\r\n    destroy() {\r\n        if (!this._sessionEnded) {\r\n            this.exitXR();\r\n        }\r\n    }\r\n}","import { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { WebXRCamera } from \"./WebXRCamera\";\r\nimport { WebXRRenderTexture } from \"./WebXRRenderTexture\";\r\nimport { WebXRSessionManager } from \"./WebXRSessionManager\";\r\n\r\n\r\n/**\r\n * @author miner\r\n * XRCamera\r\n */\r\nexport class WebXRCameraManager {\r\n    /**\r\n     * reference Quaternin\r\n     */\r\n    private _referenceQuaternion: Quaternion = new Quaternion();\r\n    /**\r\n     * reference Position\r\n     */\r\n    private _referencedPosition: Vector3 = new Vector3();\r\n    /**\r\n     * WebXR Session Manager\r\n     */\r\n    private _webXRSessionManager: WebXRSessionManager;\r\n    /**\r\n     * first Frame Flag\r\n     */\r\n    private _firstFrame = true;//\r\n    /**\r\n     * WebXR RenderTexture\r\n     */\r\n    private _XRRenderTexture: WebXRRenderTexture = new WebXRRenderTexture();\r\n    /**\r\n     * WebXRCamera Array\r\n     */\r\n    private _rigCameras = new Array<WebXRCamera>();\r\n    /**\r\n     * Reference position\r\n     */\r\n    private _position = new Vector3();\r\n\r\n    /**\r\n     * parent\r\n     */\r\n    public owner: any;\r\n\r\n    get position(): Vector3 {\r\n        return this._position;\r\n    }\r\n\r\n    set position(newPosition: Vector3) {\r\n\r\n        newPosition.cloneTo(this._position);\r\n    }\r\n\r\n    set rotationQuaternion(value: Quaternion) {\r\n        value.cloneTo(this._referenceQuaternion);\r\n    }\r\n\r\n    get rotationQuaternion(): Quaternion {\r\n        return this._referenceQuaternion;\r\n    }\r\n\r\n    get rigCameras(): WebXRCamera[] {\r\n        return this._rigCameras;\r\n    }\r\n\r\n    /**\r\n     * XRCamera\r\n     * @param camera \r\n     * @param manager \r\n     */\r\n    constructor(camera: any, manager: WebXRSessionManager = null) {\r\n        this.owner = camera;\r\n        this.owner.enableRender = false;\r\n        if (!this.owner.aspectRatio) {\r\n            console.warn(\"owner is not Camera\");\r\n        }\r\n        this._webXRSessionManager = manager;\r\n        this._webXRSessionManager.on(WebXRSessionManager.EVENT_FRAME_LOOP, this, this._updateFromXRSession);\r\n        this._webXRSessionManager.on(WebXRSessionManager.EVENT_FRAME_LOOP, this, this._updateReferenceSpace);\r\n        this._webXRSessionManager.on(WebXRSessionManager.EVENT_MANAGER_END, this, this.destroy);\r\n    }\r\n\r\n    /**\r\n     * updateFrame by WebXR Session\r\n     */\r\n    _updateFromXRSession() {\r\n        //XRViewerPose\r\n        let pose = this._webXRSessionManager.currentFrame && this._webXRSessionManager.currentFrame.getViewerPose(this._webXRSessionManager.referenceSpace);\r\n        //update pose data\r\n        const pos = pose.transform.position;\r\n        const orientation = pose.transform.orientation;\r\n        this._referenceQuaternion.setValue(orientation.x, orientation.y, orientation.z, orientation.w);\r\n        this._referencedPosition.setValue(pos.x, pos.y, pos.z);\r\n        if (this._firstFrame) {\r\n            this._firstFrame = false;\r\n            this.position.y += this._referencedPosition.y;\r\n            // avoid using the head rotation on the first frame.\r\n            this._referenceQuaternion.setValue(0, 0, 0, 1);\r\n        } else {\r\n            // update position and rotation as reference\r\n            this.rotationQuaternion = this._referenceQuaternion;\r\n            this.position = this._referencedPosition;\r\n        }\r\n        // Update camera rigs\r\n        if (this.rigCameras.length !== pose.views.length) {\r\n            this._updateNumberOfRigCameras(pose.views.length);\r\n        }\r\n        //XRView\r\n        pose.views.forEach((view: any, i: any) => {\r\n            const currentRig = this.rigCameras[i];\r\n            if (view.eye === \"right\")\r\n                currentRig.name = \"right\";\r\n            else if (view.eye === \"left\")\r\n                currentRig.name = \"left\";\r\n            // Update view/projection matrix\r\n            const pos = view.transform.position;\r\n            const orientation = view.transform.orientation;\r\n            currentRig.transform.position.setValue(pos.x, pos.y, pos.z);\r\n            currentRig.transform.rotation.setValue(orientation.x, orientation.y, orientation.z, orientation.w);\r\n            currentRig.transform.position = currentRig.transform.position;\r\n            currentRig.transform.rotation = currentRig.transform.rotation;\r\n            // Update viewport\r\n            if (this._webXRSessionManager.session.renderState.baseLayer) {\r\n                var viewport = this._webXRSessionManager.session.renderState.baseLayer.getViewport(view);\r\n                var width = this._webXRSessionManager.session.renderState.baseLayer.framebufferWidth;\r\n                var height = this._webXRSessionManager.session.renderState.baseLayer.framebufferHeight;\r\n                this._XRRenderTexture.frameBuffer = this._webXRSessionManager.session.renderState.baseLayer.framebuffer;\r\n                //update FrameBuffer\r\n                currentRig.renderTarget = this._XRRenderTexture;\r\n                //update clientSize\r\n                currentRig.clientWidth = width;\r\n                currentRig.clientHeight = height;\r\n                //update viewPort\r\n                var cameraViewPort = currentRig.viewport;\r\n                cameraViewPort.x = viewport.x;\r\n                cameraViewPort.y = viewport.y;\r\n                cameraViewPort.width = viewport.width;\r\n                cameraViewPort.height = viewport.height;\r\n                currentRig.viewport = cameraViewPort;\r\n                currentRig.projectionMatrix.cloneByArray(view.projectionMatrix);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * update number of WebXRCamera\r\n     * @param viewCount \r\n     */\r\n    private _updateNumberOfRigCameras(viewCount = 1) {\r\n        while (this.rigCameras.length < viewCount) {\r\n            //add camera\r\n            var xrcamera = new WebXRCamera(this.owner.aspectRatio, this.owner.nearPlane, this.owner.farPlane);\r\n            xrcamera.clearFlag = this.owner.clearFlag;\r\n            xrcamera.clearColor = this.owner.clearColor;\r\n            this.owner.addChild(xrcamera);\r\n            this.rigCameras.push(xrcamera);\r\n        }\r\n        while (this.rigCameras.length > viewCount) {\r\n            //remove camera\r\n            let xrcamera = this.rigCameras.pop();\r\n            this.owner.removeChild(xrcamera);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * TODO:update of Reference Space\r\n     */\r\n    private _updateReferenceSpace() {\r\n        //TODO:\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy() {\r\n        this.owner.enableRender = true;\r\n        this._webXRSessionManager.off(WebXRSessionManager.EVENT_FRAME_LOOP, this, this._updateFromXRSession);\r\n        this._webXRSessionManager.off(WebXRSessionManager.EVENT_FRAME_LOOP, this, this._updateReferenceSpace);\r\n        this._webXRSessionManager.off(WebXRSessionManager.EVENT_MANAGER_END, this, this.destroy);\r\n        this._rigCameras.forEach(element => {\r\n            element.destroy();\r\n        });\r\n        this._rigCameras = null;\r\n        this._XRRenderTexture.destroy();\r\n    }\r\n\r\n}","import { EventDispatcher } from \"../../../events/EventDispatcher\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\n\r\n/**\r\n * gamepad Axis\r\n */\r\nexport class AxiGamepad extends EventDispatcher {\r\n    static EVENT_OUTPUT: string = \"outputAxi_id\";\r\n    /**\r\n     * \r\n     */\r\n    public handness: string;\r\n    /**\r\n     * \r\n     */\r\n    public axisLength: number;\r\n    /**\r\n     * axis Array\r\n     */\r\n    private axisData: Array<Vector2> = new Array();\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param handness \r\n     * @param length \r\n     */\r\n    constructor(handness: string, length: number) {\r\n        super();\r\n        this.handness = handness;\r\n        this.axisData.length = length;\r\n        this.axisLength = length;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param padGameAxi \r\n     */\r\n    update(padGameAxi: any) {\r\n        for (let i = 0, j = 0; i < padGameAxi.axes.length; i += 2, ++j) {\r\n            if (!this.axisData[j])\r\n                this.axisData[j] = new Vector2();\r\n            this.axisData[j].setValue(padGameAxi.axes[i], padGameAxi.axes[i + 1]);\r\n            this.outPutStickValue(this.axisData[j], j);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param value \r\n     * @param index \r\n     */\r\n    outPutStickValue(value: Vector2, index: number) {\r\n        const eventnam = AxiGamepad.EVENT_OUTPUT + index.toString();\r\n        this.event(eventnam, [value]);\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy() {\r\n        for (let i = 0; i < this.axisLength; i++) {\r\n            let eventname = AxiGamepad.EVENT_OUTPUT + i.toString();\r\n            this.offAll(eventname);\r\n        }\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * gamepad Button\r\n */\r\nexport class ButtonGamepad extends EventDispatcher {\r\n    static EVENT_TOUCH_ENTER: string = \"touchEnter\";\r\n    static EVENT_TOUCH_STAY: string = \"touchStay\";\r\n    static EVENT_TOUCH_OUT: string = \"touchOut\";\r\n    static EVENT_PRESS_ENTER: string = \"pressEnter\";\r\n    static EVENT_PRESS_STAY: string = \"pressStay\";\r\n    static EVENT_PRESS_OUT: string = \"pressOut\";\r\n    static EVENT_PRESS_VALUE: string = \"outpressed\";\r\n\r\n    /**\r\n     * The id of the gamepad\r\n     */\r\n    public handness: string;\r\n    /**\r\n    * The index of the gamepad\r\n    */\r\n    public index: number;\r\n\r\n    /**\r\n     * front touch state\r\n     */\r\n    private lastTouch: boolean = false;\r\n    private lastPress: boolean = false;\r\n    private lastPressValue: number = 0;\r\n\r\n    /**\r\n     * current touch state\r\n     */\r\n    private touch: boolean = false;\r\n    private press: boolean = false;\r\n    private pressValue: number = 0;\r\n\r\n\r\n    /**\r\n     * Button\r\n     * @param handness \r\n     * @param index button\r\n     */\r\n    constructor(handness: string, index: number) {\r\n        super();\r\n        this.handness = handness;\r\n        this.index = index;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * GamePadButton update\r\n     */\r\n    update(padButton: any) {\r\n        //set Data\r\n        this.lastTouch = this.touch;\r\n        this.lastPress = this.press;\r\n        this.lastPressValue = this.pressValue;\r\n        this.touch = padButton.touched;\r\n        this.press = padButton.pressed;\r\n        this.pressValue = padButton.value;\r\n        if (!this.lastTouch && !this.touch) {\r\n            return;\r\n        }\r\n        if (this.lastTouch != this.touch && this.touch) {\r\n            this.touchEnter();\r\n        } else if (this.lastTouch == this.touch && this.touch) {\r\n            this.touchStay();\r\n        } else if (this.lastTouch != this.touch && !this.touch) {\r\n            this.touchOut();\r\n        }\r\n        if (this.lastPress != this.press && this.press) {\r\n            this.pressEnter();\r\n        } else if (this.lastPress == this.press && this.press) {\r\n            this.pressStay();\r\n        } else if (this.lastPress != this.press && !this.press) {\r\n            this.pressOut();\r\n        }\r\n        if (this.touch) {\r\n            this.outpressed();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * event touch enter\r\n     */\r\n    private touchEnter() {\r\n        this.event(ButtonGamepad.EVENT_TOUCH_ENTER);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * event touch Stay\r\n     */\r\n    private touchStay() {\r\n        this.event(ButtonGamepad.EVENT_TOUCH_STAY);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * event touch Out\r\n     */\r\n    private touchOut() {\r\n        this.event(ButtonGamepad.EVENT_TOUCH_OUT);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * event press enter\r\n     */\r\n    private pressEnter() {\r\n        this.event(ButtonGamepad.EVENT_PRESS_ENTER);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * event press Stay\r\n     */\r\n    private pressStay() {\r\n        this.event(ButtonGamepad.EVENT_PRESS_STAY);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * event press Out\r\n     */\r\n    private pressOut() {\r\n        this.event(ButtonGamepad.EVENT_PRESS_OUT);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * event press value\r\n     */\r\n    private outpressed() {\r\n        this.event(ButtonGamepad.EVENT_PRESS_VALUE, [this.pressValue]);\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy() {\r\n        this.offAll(ButtonGamepad.EVENT_PRESS_ENTER);\r\n        this.offAll(ButtonGamepad.EVENT_PRESS_STAY);\r\n        this.offAll(ButtonGamepad.EVENT_PRESS_OUT);\r\n        this.offAll(ButtonGamepad.EVENT_PRESS_ENTER);\r\n        this.offAll(ButtonGamepad.EVENT_PRESS_STAY);\r\n        this.offAll(ButtonGamepad.EVENT_PRESS_OUT);\r\n        this.offAll(ButtonGamepad.EVENT_PRESS_VALUE);\r\n    }\r\n}","import { EventDispatcher } from \"../../../events/EventDispatcher\";\r\nimport { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Ray } from \"../../math/Ray\";\r\nimport { ButtonGamepad, AxiGamepad } from \"./WebXRGamepad\";\r\n\r\n\r\n/**\r\n * @author miner\r\n * \r\n */\r\nexport class WebXRInput extends EventDispatcher {\r\n    static HANDNESS_LEFT: string = \"left\";\r\n    static HANDNESS_RIGHT: string = \"right\";\r\n    static EVENT_FRAMEUPDATA_WEBXRINPUT: string = \"frameXRInputUpdate\";\r\n    private static tempQua: Quaternion = new Quaternion();\r\n    /**\r\n     * Button\r\n     */\r\n    private preButtonEventList: Array<any> = [];\r\n    /**\r\n     * axis\r\n     */\r\n    private preAxisEventList: Array<any> = [];\r\n    /**\r\n     * @internal\r\n     */\r\n    public _inputSource: any;//XRInputSource\r\n\r\n    public lastXRPose: any;\r\n    /**\r\n     * handMode\r\n     */\r\n    public handness: string;\r\n    /**\r\n     * input Ray\r\n     */\r\n    public ray: Ray;\r\n    /**\r\n     * hand Pos\r\n     */\r\n    public position: Vector3;\r\n    /**\r\n     * hand Rotate\r\n     */\r\n    public rotation: Quaternion;\r\n    /**\r\n     * lastRayPos\r\n     */\r\n    public _lastXRPose: any;\r\n\r\n    /**\r\n     * gamepad Button info\r\n     */\r\n    public gamepadButton: Array<ButtonGamepad>;\r\n\r\n    /**\r\n     * gamepad axis Info\r\n     */\r\n    public gamepadAxis: AxiGamepad;\r\n\r\n    constructor(handness: string) {\r\n        super();\r\n        this.handness = handness;\r\n        this.position = new Vector3();\r\n        this.rotation = new Quaternion();\r\n        this.ray = new Ray(new Vector3(), new Vector3());\r\n    }\r\n\r\n    /**\r\n     * XRInput\r\n     * @internal\r\n     * @param xrFrame WebXR\r\n     * @param referenceSpace \r\n     */\r\n    _updateByXRPose(xrFrame: any, referenceSpace: any) {\r\n        //updateRay\r\n        const rayPose = xrFrame.getPose(this._inputSource.targetRaySpace, referenceSpace);\r\n        this._lastXRPose = rayPose;\r\n        if (rayPose) {\r\n            const pos = rayPose.transform.position;\r\n            const orientation = rayPose.transform.orientation;\r\n            WebXRInput.tempQua.setValue(orientation.x, orientation.y, orientation.z, orientation.w);\r\n            this.ray.origin.setValue(pos.x, pos.y, pos.z);\r\n            Vector3.transformQuat(Vector3.UnitZ, WebXRInput.tempQua, this.ray.direction);\r\n            Vector3.scale(this.ray.direction, -1, this.ray.direction);\r\n        }\r\n        //updateMesh\r\n        if (this._inputSource.gripSpace) {\r\n            let meshPose = xrFrame.getPose(this._inputSource.gripSpace, referenceSpace);\r\n            if (meshPose) {\r\n                const pos = meshPose.transform.position;\r\n                const orientation = meshPose.transform.orientation;\r\n                this.position.setValue(pos.x, pos.y, pos.z);\r\n                this.rotation.setValue(orientation.x, orientation.y, orientation.z, orientation.w);\r\n            }\r\n        }\r\n        this.event(WebXRInput.EVENT_FRAMEUPDATA_WEBXRINPUT, [this]);\r\n        //handle gamepad\r\n        this._handleProcessGamepad();\r\n    }\r\n\r\n\r\n    /**\r\n     * handle gamepad Event\r\n     */\r\n    private _handleProcessGamepad() {\r\n        //axis init\r\n        const gamepad = this._inputSource.gamepad;\r\n        if (!this.gamepadAxis) {\r\n            this.gamepadAxis = new AxiGamepad(this.handness, gamepad.axes.length);\r\n            //preEvent\r\n            this.preAxisEventList.forEach(element => {\r\n                this.gamepadAxis.on(element.eventnam, element.caller, element.listener);\r\n            });\r\n        }\r\n        if (!this.gamepadButton) {\r\n            this.gamepadButton = [];\r\n            for (let i = 0; i < gamepad.buttons.length; ++i) {\r\n                this.gamepadButton.push(new ButtonGamepad(this.handness, i));\r\n            }\r\n            //preEvent\r\n            this.preButtonEventList.forEach(element => {\r\n                this.addButtonEvent(element.index, element.type, element.caller, element.listener);\r\n            });\r\n        }\r\n        //axis\r\n        this.gamepadAxis.update(gamepad);\r\n        //button\r\n        for (let i = 0; i < gamepad.buttons.length; ++i) {\r\n            let button = this.gamepadButton[i];\r\n            button.update(gamepad.buttons[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * add button event\r\n     * @param index button\r\n     * @param type \r\n     * @param caller \r\n     * @param listener \r\n     */\r\n    addButtonEvent(index: number, type: string, caller: any, listener: Function) {\r\n        if (!this.gamepadButton) {\r\n            this.preButtonEventList.push({\r\n                \"index\": index,\r\n                \"type\": type,\r\n                \"caller\": caller,\r\n                \"listener\": listener\r\n            });\r\n        } else {\r\n            let button = this.gamepadButton[index];\r\n            button.on(type, caller, listener);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * add axis event\r\n     * @param index axis\r\n     * @param type \r\n     * @param caller \r\n     * @param listener \r\n     */\r\n    addAxisEvent(index: number, type: string, caller: any, listener: Function) {\r\n        if (!this.gamepadAxis) {\r\n            this.preAxisEventList.push({\r\n                \"eventnam\": type + index.toString(),\r\n                \"caller\": caller,\r\n                \"listener\": listener\r\n            });\r\n        } else {\r\n            const eventnam = type + index.toString();\r\n            this.gamepadAxis.on(eventnam, caller, listener);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * remove axis event\r\n     * @param index axis\r\n     * @param type \r\n     * @param caller \r\n     * @param listener \r\n     */\r\n    offAxisEvent(index: number, type: string, caller: any, listener: Function) {\r\n        if (this.gamepadAxis) {\r\n            const eventnam = type + index.toString();\r\n            this.gamepadAxis.off(eventnam, caller, listener);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * remove Button event\r\n     * @param index axis\r\n     * @param type \r\n     * @param caller \r\n     * @param listener \r\n     */\r\n    offButtonEvent(index: number, type: string, caller: any, listener: Function) {\r\n        if (this.gamepadButton) {\r\n            let button = this.gamepadButton[index];\r\n            button.off(type, caller, listener);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    destroy() {\r\n        this.preButtonEventList = null;\r\n        this.ray = null;\r\n        this.position = null;\r\n        this.rotation = null;\r\n        this.gamepadAxis.destroy();\r\n        this.gamepadButton.forEach(element => {\r\n            element.destroy();\r\n        });\r\n    }\r\n}","import { Color } from \"../../../maths/Color\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { PixelLineSprite3D } from \"../../core/pixelLine/PixelLineSprite3D\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { WebXRCameraManager } from \"./WebXRCameraManager\";\r\nimport { WebXRInput } from \"./WebXRInput\";\r\nimport { WebXRSessionManager } from \"./WebXRSessionManager\";\r\n\r\n\r\n/**\r\n * @author miner\r\n * \r\n * The path of the CDN the sample will fetch controller models from\r\n * MeshSource https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0.9/dist/profiles/\r\n */\r\nexport class WebXRInputManager {\r\n    static tempVec: Vector3 = new Vector3();\r\n    static tempVec1: Vector3 = new Vector3();\r\n    /**\r\n     * Session Manager\r\n     */\r\n    private webXRSessionManager: WebXRSessionManager;\r\n    /**\r\n     * webXRCamera Manager\r\n     */\r\n    private webXRCameraManager: WebXRCameraManager;\r\n    /**\r\n     * array of XRInput\r\n     */\r\n    private controllers: Map<string, WebXRInput> = new Map();\r\n    /**\r\n     * bind of XRInput Node Render\r\n     */\r\n    private controllerHandMesh: Map<string, Sprite3D> = new Map();\r\n    /**\r\n     * bind of XRInput Ray Render\r\n     */\r\n    private controllerLineRender: Map<string, PixelLineSprite3D> = new Map();\r\n    /**\r\n     * line Color\r\n     */\r\n    private lineColor: Color = Color.RED;\r\n    /**\r\n     * Ray length\r\n     */\r\n    private rayLength: number = 2;\r\n\r\n    /**\r\n     * WebXRInput\r\n     * @param webxrManager WebXR Session manager\r\n     * @param webXRCamera WebXR Manager\r\n     */\r\n    constructor(webxrManager: WebXRSessionManager, webXRCamera: WebXRCameraManager) {\r\n        this.webXRSessionManager = webxrManager;\r\n        this.webXRCameraManager = webXRCamera;\r\n        this.webXRSessionManager.on(WebXRSessionManager.EVENT_MANAGER_END, this, this.destory);\r\n        this.webXRSessionManager.on(WebXRSessionManager.EVENT_FRAME_LOOP, this, this._updateFromXRFrame);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param xrInput \r\n     */\r\n    private _updataMeshRender(xrInput: WebXRInput) {\r\n        const handness = xrInput.handness;\r\n        //mesh\r\n        if (this.controllerHandMesh.has(handness)) {\r\n            let meshNode = this.controllerHandMesh.get(handness);\r\n            meshNode.transform.position = xrInput.position;\r\n            meshNode.transform.rotation = xrInput.rotation;\r\n        }\r\n        //rayLine\r\n        if (this.controllerLineRender.has(handness)) {\r\n            let line = this.controllerLineRender.get(handness);\r\n            line.clear();\r\n            let ray = xrInput.ray;\r\n            WebXRInputManager.tempVec.setValue(ray.origin.x, ray.origin.y, ray.origin.z);\r\n            Vector3.scale(ray.direction, this.rayLength, WebXRInputManager.tempVec1);\r\n            Vector3.add(WebXRInputManager.tempVec, WebXRInputManager.tempVec1, WebXRInputManager.tempVec1);\r\n            line.addLine(WebXRInputManager.tempVec, WebXRInputManager.tempVec1, this.lineColor, this.lineColor);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * WebXRInput\r\n     * @param xrFrame \r\n     */\r\n    private _updateFromXRFrame(xrFrame: any) {\r\n        //frame, this.xrSessionManager.referenceSpace, this.xrCamera\r\n        const session = this.webXRSessionManager.session;\r\n        const refSpace = this.webXRSessionManager.referenceSpace;\r\n        for (let inputSource of session.inputSources) {\r\n            const key = inputSource.handedness;\r\n            let xrInput: WebXRInput;\r\n            if (!this.controllers.has(key)) {\r\n                xrInput = this.getController(key);\r\n            }else\r\n                xrInput = this.controllers.get(key);\r\n            if(xrInput){\r\n                xrInput = this.controllers.get(key);\r\n                xrInput._inputSource = inputSource;\r\n                xrInput._updateByXRPose(xrFrame, refSpace);\r\n            }\r\n            \r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param meshSprite \r\n     * @param handness left/right\r\n     */\r\n    bindMeshNode(meshSprite: Sprite3D, handness: string) {\r\n        this.controllerHandMesh.set(handness, meshSprite);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param lineSprite \r\n     * @param handness left/right\r\n     */\r\n    bindRayNode(lineSprite: PixelLineSprite3D, handness: string) {\r\n        this.controllerLineRender.set(handness, lineSprite);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param handness left/right\r\n     * @returns \r\n     */\r\n    getController(handness: string): WebXRInput {\r\n        if (handness != \"left\" && handness != \"right\")\r\n            return null;\r\n        if (!this.controllers.has(handness)) {\r\n            let value = new WebXRInput(handness);\r\n            this.controllers.set(handness, value);\r\n            value.on(WebXRInput.EVENT_FRAMEUPDATA_WEBXRINPUT, this, this._updataMeshRender);\r\n        }\r\n        return this.controllers.get(handness);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    destory() {\r\n        this.webXRSessionManager.off(WebXRSessionManager.EVENT_FRAME_LOOP, this, this._updateFromXRFrame);\r\n        for (let key in this.controllers) {\r\n            this.controllers.get(key).off(\"frameXRInputUpdate\", this, this._updataMeshRender);\r\n            this.controllers.get(key).destroy();\r\n        }\r\n        this.controllers = null;\r\n        this.controllerHandMesh = null;\r\n        this.controllerLineRender = null;\r\n    }\r\n}\r\n\r\n","import { Camera } from \"../../core/Camera\";\r\nimport { WebXRCameraManager } from \"./WebXRCameraManager\";\r\nimport { WebXRInputManager } from \"./WebXRInputManager\";\r\nimport { WebXRSessionManager } from \"./WebXRSessionManager\";\r\nexport class WebXRCameraInfo {\r\n    /**depth far */\r\n    depthFar: number;\r\n    /**depth near */\r\n    depthNear: number;\r\n    /**camera */\r\n    camera: any;\r\n}\r\n\r\n/**\r\n * WebXR\r\n * @author miner\r\n */\r\nexport class WebXRExperienceHelper {\r\n\r\n    static glInstance: any;\r\n    /**\r\n     * single XRManager \r\n     */\r\n    public static xr_Manager = new WebXRSessionManager();\r\n    /**\r\n     * support webXR\r\n     */\r\n    public static supported = false;\r\n    /**\r\n     * default WebLayer option\r\n     * XRWebGLLayerInit\r\n     */\r\n    public static canvasOptions = {\r\n        antialias: true,\r\n        depth: true,\r\n        stencil: false,\r\n        alpha: true,\r\n        multiview: false,\r\n        framebufferScaleFactor: 1,\r\n    };\r\n\r\n    /**\r\n     * XRSession\r\n     * @param sessionMode XRSessionMode = \"inline\" | \"immersive-vr\" | \"immersive-ar\";\r\n     * @returns \r\n     */\r\n    public static supportXR(sessionMode: string): Promise<boolean> {\r\n        return WebXRExperienceHelper.xr_Manager.isSessionSupportedAsync(sessionMode).then(value => {\r\n            WebXRExperienceHelper.supported = value;\r\n            return value;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * WewXR\r\n     * @param sessionMode XRSessionMode\r\n     * @param referenceSpaceType referenceType = \"viewer\" | \"local\" | \"local-floor\" | \"unbounded\";\r\n     * @param cameraInfo WebXRCameraInfo webXRCamera\r\n     * @returns Promise<WebXRSessionManager> \r\n     */\r\n    public static enterXRAsync(sessionMode: string, referenceSpaceType: string, cameraInfo: WebXRCameraInfo): Promise<WebXRSessionManager> {\r\n        if (sessionMode === \"immersive-ar\" && referenceSpaceType !== \"unbounded\") {\r\n            console.warn(\"We recommend using 'unbounded' reference space type when using 'immersive-ar' session mode\");\r\n        }\r\n\r\n        //session\r\n        return WebXRExperienceHelper.xr_Manager.initializeSessionAsync(sessionMode).then(() => {\r\n            //refernceSpace\r\n            return WebXRExperienceHelper.xr_Manager.setReferenceSpaceTypeAsync(referenceSpaceType);\r\n        }).then(() => {\r\n            //webglSurport\r\n            //@ts-ignore\r\n            return WebXRExperienceHelper.xr_Manager.initializeXRGL(sessionMode, LayaGL.renderEngine.gl);\r\n        }).then(() => {\r\n            //@ts-ignore\r\n            WebXRExperienceHelper.glInstance = LayaGL.renderEngine.gl;\r\n            return WebXRExperienceHelper.xr_Manager.updateRenderStateAsync({\r\n                depthFar: cameraInfo.depthFar,\r\n                depthNear: cameraInfo.depthNear,\r\n                //@ts-ignore\r\n                baseLayer: new XRWebGLLayer(WebXRExperienceHelper.xr_Manager.session, LayaGL.renderEngine.gl),\r\n            });\r\n        }).then(() => {\r\n            WebXRExperienceHelper.xr_Manager.runXRRenderLoop();\r\n            return WebXRExperienceHelper.xr_Manager;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * config WebXRCameraManager\r\n     * @param camera Camera\r\n     * @param manager WebXRSessionManager\r\n     * @returns \r\n     */\r\n    public static setWebXRCamera(camera: Camera, manager: WebXRSessionManager): WebXRCameraManager {\r\n        return new WebXRCameraManager(camera, manager);\r\n    }\r\n\r\n    /**\r\n     * config WebXRInputManager\r\n     * @param sessionManager WebXRSessionManager\r\n     * @param cameraManager WebXRCameraManager\r\n     * @returns \r\n     */\r\n    public static setWebXRInput(sessionManager: WebXRSessionManager, cameraManager: WebXRCameraManager): WebXRInputManager {\r\n        return new WebXRInputManager(sessionManager, cameraManager);\r\n    }\r\n}","import { Config3D } from \"../../../../Config3D\";\r\nimport { ILaya3D } from \"../../../../ILaya3D\";\r\nimport { Camera, CameraEventFlags } from \"../../core/Camera\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { Scene3D } from \"../../core/scene/Scene3D\";\r\nimport { Cluster } from \"../../graphics/renderPath/Cluster\";\r\nimport { Viewport } from \"../../math/Viewport\";\r\nimport { WebXRCameraManager } from \"./WebXRCameraManager\";\r\nimport { WebXRRenderTexture } from \"./WebXRRenderTexture\";\r\nimport { RenderStateContext } from \"../../../RenderEngine/RenderStateContext\";\r\nimport { WebXRExperienceHelper } from \"./WebXRExperienceHelper\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { RenderTexture } from \"../../../resource/RenderTexture\";\r\n\r\n\r\n/**\r\n * @author miner\r\n * WebXR\r\n */\r\nexport class WebXRCamera extends Camera {\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tpublic isWebXR = true;\r\n\t/**\r\n\t * WebXRSessionManager\r\n\t */\r\n\tprivate _webXRManager: WebXRCameraManager;\r\n\r\n\t/**\r\n\t * override client\r\n\t */\r\n\tprivate _clientWidth: number;\r\n\t/**\r\n\t * override client\r\n\t */\r\n\tprivate _clientHeight: number;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget renderTarget(): RenderTexture {\r\n\t\treturn this._internalRenderTexture;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tset renderTarget(value: RenderTexture) {\r\n\t\tthis._internalRenderTexture = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tset clientWidth(value: number) {\r\n\t\tthis._clientWidth = value;\r\n\t}\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tset clientHeight(value: number) {\r\n\t\tthis._clientHeight = value;\r\n\t}\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tget clientWidth(): number {\r\n\t\treturn this._clientWidth;\r\n\t}\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tget clientHeight(): number {\r\n\t\treturn this._clientHeight;\r\n\t}\r\n\r\n\t/**\r\n\t * restore view state\r\n\t * @internal\r\n\t */\r\n\tprivate _restoreView(gl: WebGLRenderingContext) {\r\n\t\t//\r\n\t\tvar viewport: Viewport = this.viewport;\r\n\t\tvar vpX: number, vpY: number;\r\n\t\tvar vpW: number = viewport.width;\r\n\t\tvar vpH: number = viewport.height;\r\n\t\tif (this._needInternalRenderTexture()) {\r\n\t\t\tvpX = 0;\r\n\t\t\tvpY = 0;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvpX = viewport.x;\r\n\t\t\tvpY = this._getCanvasHeight() - viewport.y - vpH;\r\n\t\t}\r\n\t\tgl.viewport(vpX, vpY, vpW, vpH);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @override\r\n\t * @param shader \r\n\t * @param replacementTag \r\n\t */\r\n\trender(shader: Shader3D = null, replacementTag: string = null): void {\r\n\t\tif (!this.activeInHierarchy) //custom render should protected with activeInHierarchy=true\r\n\t\t\treturn;\r\n\r\n\t\tvar viewport: Viewport = this.viewport;\r\n\t\tvar needInternalRT: boolean = true;\r\n\t\tvar context: RenderContext3D = RenderContext3D._instance;\r\n\t\tvar scene: Scene3D = context.scene = <Scene3D>this._scene;\r\n\t\tcontext.pipelineMode = context.configPipeLineMode;\r\n\t\tcontext.replaceTag = replacementTag;\r\n\t\tcontext.customShader = shader;\r\n\t\tvar needShadowCasterPass: boolean = this._renderShadowMap(scene, context);\r\n\t\tthis._preRenderMainPass(context, scene, needInternalRT, viewport);\r\n\t\tthis._renderMainPass(context, viewport, scene, shader, replacementTag, needInternalRT);\r\n\t\tthis._aftRenderMainPass(needShadowCasterPass);\r\n\t}\r\n\r\n\t/**\r\n * \r\n * @internal\r\n * @param context \r\n * @param viewport \r\n * @param scene \r\n * @param shader shader\r\n * @param replacementTag \r\n * @param needInternalRT RT\r\n */\r\n\t_renderMainPass(context: RenderContext3D, viewport: Viewport, scene: Scene3D, shader: Shader3D, replacementTag: string, needInternalRT: boolean) {\r\n\t\tvar gl: WebGLRenderingContext = WebXRExperienceHelper.glInstance;\r\n\t\tvar renderTex: RenderTexture = this._internalRenderTexture;\r\n\r\n\t\tcontext.viewport = viewport;\r\n\t\tthis._prepareCameraToRender();\r\n\t\tvar multiLighting: boolean = Config3D._multiLighting;\r\n\t\t(multiLighting) && (Cluster.instance.update(this, <Scene3D>(scene)));\r\n\t\tscene._preCulling(context, this);\r\n\r\n\t\tif (renderTex && renderTex._isCameraTarget)//Y\r\n\t\t\tcontext.invertY = true;\r\n\t\tthis._applyViewProject(context, this.viewMatrix, this._projectionMatrix);\r\n\t\tif (this.depthTextureMode != 0) {\r\n\t\t\t//TODO:\r\n\t\t\tthis._renderDepthMode(context);\r\n\t\t}\r\n\t\t(renderTex) && (renderTex._start());\r\n\t\tif ((renderTex as any).frameLoop != Scene3D._updateMark) {\r\n\t\t\t(renderTex as any).frameLoop = Scene3D._updateMark;\r\n\t\t\t//scene._clear(gl, context);\r\n\t\t\tthis.clear(gl);\r\n\t\t}\r\n\t\tthis._restoreView(gl);\r\n\t\tthis._prepareCameraToRender();\r\n\r\n\t\tthis._applyCommandBuffer(CameraEventFlags.BeforeForwardOpaque, context);\r\n\t\tscene._renderScene(context, ILaya3D.Scene3D.SCENERENDERFLAG_RENDERQPAQUE);\r\n\t\tthis._applyCommandBuffer(CameraEventFlags.BeforeSkyBox, context);\r\n\t\tscene._renderScene(context, ILaya3D.Scene3D.SCENERENDERFLAG_SKYBOX);\r\n\t\tthis._applyCommandBuffer(CameraEventFlags.BeforeTransparent, context);\r\n\t\tscene._renderScene(context, ILaya3D.Scene3D.SCENERENDERFLAG_RENDERTRANSPARENT);\r\n\t\tscene._componentDriver.callPostRender();//TODO:duo\r\n\t\tthis._applyCommandBuffer(CameraEventFlags.BeforeImageEffect, context);\r\n\t\t(renderTex) && (renderTex._end());\r\n\t\t//PostProcess TODO\r\n\t\t// if (needInternalRT) {\r\n\t\t// \tif (this._postProcess && this._postProcess.enable) {\r\n\t\t// \t\tthis._postProcess.commandContext = context;\r\n\t\t// \t\tthis._postProcess._render();\r\n\t\t// \t\tthis._postProcess._applyPostProcessCommandBuffers();\r\n\t\t// \t} else if (this._enableHDR || this._needBuiltInRenderTexture) {\r\n\t\t// \t\tvar canvasWidth: number = this._getCanvasWidth(), canvasHeight: number = this._getCanvasHeight();\r\n\t\t// \t\tif (this._offScreenRenderTexture) {\r\n\t\t// \t\t\tthis._screenOffsetScale.setValue(viewport.x / canvasWidth, viewport.y / canvasHeight, viewport.width / canvasWidth, viewport.height / canvasHeight);\r\n\t\t// \t\t\tthis._internalCommandBuffer._camera = this;\r\n\t\t// \t\t\tthis._internalCommandBuffer._context = context;\r\n\t\t// \t\t\tthis._internalCommandBuffer.blitScreenQuad(this._internalRenderTexture, this._offScreenRenderTexture, this._screenOffsetScale, null, null, 0, true);\r\n\t\t// \t\t\tthis._internalCommandBuffer._apply();\r\n\t\t// \t\t\tthis._internalCommandBuffer.clear();\r\n\t\t// \t\t}\r\n\t\t// \t}\r\n\t\t// \tRenderTexture.bindCanvasRender = this._internalRenderTexture;\r\n\t\t// \t//RenderTexture.recoverToPool(this._internalRenderTexture);\r\n\t\t// } else {\r\n\t\t// \tRenderTexture.bindCanvasRender = null;\r\n\t\t// }\r\n\t\tthis._applyCommandBuffer(CameraEventFlags.AfterEveryThing, context);\r\n\t}\r\n\r\n\t/**\r\n\t * null function\r\n\t */\r\n\tprotected _calculateProjectionMatrix(): void {\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tclear(gl: WebGLRenderingContext) {\r\n\t\tgl.viewport(0, 0, this._clientWidth, this._clientHeight);\r\n\t\tgl.scissor(0, 0, this._clientWidth, this._clientHeight);\r\n\t\tgl.clearColor(this.clearColor.r, this.clearColor.g, this.clearColor.b, this.clearColor.a);\r\n\t\tRenderStateContext.setDepthMask(true);\r\n\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\t}\r\n\r\n\t/**\r\n\t * destroy\r\n\t */\r\n\tdestroy() {\r\n\t\tsuper.destroy(true);\r\n\t}\r\n}\r\n\r\n\r\n","import { Script } from \"../../components/Script\";\r\n\r\n/**\r\n * 2.0Script\r\n */\r\nexport var Script3D = Script;\r\nexport type Script3D = Script;\r\n","import { ShaderData, ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { MeshFilter } from \"../../core/MeshFilter\";\r\nimport { RenderableSprite3D } from \"../../core/RenderableSprite3D\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { RenderElement } from \"../../core/render/RenderElement\";\r\nimport { BoundFrustum } from \"../../math/BoundFrustum\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { MeshUtil } from \"../../resource/models/MeshUtil\";\r\nimport { HLODBatchMesh } from \"./HLODBatchMesh\";\r\nimport { HLODElement } from \"./HLODUtil\";\r\n\r\nexport class HLODRender extends BaseRender {\r\n\r\n    /**@internal */\r\n    _singleton: boolean;\r\n\r\n    /**@internal */\r\n    _curHLODRS: HLODElement;\r\n\r\n    /**@internal */\r\n    _curSubBatchMeshBounds: Bounds[];\r\n\r\n    constructor() {\r\n        super();\r\n        this._singleton = false;\r\n\r\n    }\r\n\r\n    /**\r\n     * set HLOD element\r\n     */\r\n    get curHLODRS() {\r\n        return this._curHLODRS;\r\n    }\r\n\r\n    set curHLODRS(value: HLODElement) {\r\n        if (!this._curHLODRS) {\r\n            this._renderElements = [];\r\n            this._renderElements.push(new RenderElement());\r\n            this._renderElements[0].render = this;\r\n        }\r\n        if (value != this._curHLODRS) {\r\n            this._changeMesh(value.HLODMesh);\r\n            this._curHLODRS = value;//\r\n            this._createRenderelementByHLODElement(this._curHLODRS, this._renderElements[0]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * LOD\r\n     * @param source \r\n     * @returns \r\n     */\r\n    private _createRenderelementByHLODElement(source: HLODElement, out: RenderElement) {\r\n        out.setGeometry(source.HLODMesh);\r\n        out.material = source.material;\r\n    }\r\n\r\n    /**\r\n     * change Render Mesh\r\n     */\r\n    private _changeMesh(lodMesh: HLODBatchMesh) {\r\n        var defineDatas: ShaderData = this._shaderValues;\r\n        this.boundsChange = true;\r\n        let meshDefines = MeshFilter._meshVerticeDefine;\r\n        if (this.curHLODRS) {\r\n            MeshUtil.getMeshDefine(this.curHLODRS.HLODMesh.batchMesh, meshDefines);\r\n            for (var i: number = 0, n: number = meshDefines.length; i < n; i++)\r\n                defineDatas.removeDefine(MeshFilter._meshVerticeDefine[i]);\r\n        }\r\n        if (lodMesh) {\r\n            MeshUtil.getMeshDefine(lodMesh.batchMesh, meshDefines);\r\n            for (var i: number = 0, n: number = MeshFilter._meshVerticeDefine.length; i < n; i++)\r\n                defineDatas.addDefine(MeshFilter._meshVerticeDefine[i]);\r\n        }\r\n        //update submesh Bounds\r\n        this._curSubBatchMeshBounds.length = lodMesh.batchSubMeshInfo.length;\r\n        for (let i = 0, n = lodMesh.batchSubMeshInfo.length; i < n; i++) {\r\n            this._curSubBatchMeshBounds[i] = this._curSubBatchMeshBounds[i] ? this._curSubBatchMeshBounds[i] : new Bounds();\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @internal\r\n     * \r\n     */\r\n    _applyLightMapParams() {\r\n        if (!this._scene) return;\r\n        var shaderValues = this._shaderValues;\r\n        var lightMap = this._curHLODRS.lightmap;\r\n        if (lightMap && lightMap.lightmapColor) {\r\n            shaderValues.setTexture(RenderableSprite3D.LIGHTMAP, lightMap.lightmapColor);\r\n            shaderValues.addDefine(RenderableSprite3D.SAHDERDEFINE_LIGHTMAP);\r\n            if (lightMap.lightmapDirection) {\r\n                shaderValues.setTexture(RenderableSprite3D.LIGHTMAP_DIRECTION, lightMap.lightmapDirection);\r\n                shaderValues.addDefine(RenderableSprite3D.SHADERDEFINE_LIGHTMAP_DIRECTIONAL);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(RenderableSprite3D.SHADERDEFINE_LIGHTMAP_DIRECTIONAL);\r\n            }\r\n        } else {\r\n            shaderValues.removeDefine(RenderableSprite3D.SAHDERDEFINE_LIGHTMAP);\r\n            shaderValues.removeDefine(RenderableSprite3D.SHADERDEFINE_LIGHTMAP_DIRECTIONAL);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * re caculate BoundBox\r\n     */\r\n    _calculateBoundingBox() {\r\n        // todo \r\n        if (this._curHLODRS) {\r\n            var sharedMesh: HLODBatchMesh = this._curHLODRS.HLODMesh;\r\n            if (sharedMesh) {\r\n                var worldMat: Matrix4x4 = this._transform.worldMatrix;\r\n                sharedMesh.batchMesh.bounds._tranform(worldMat, this._bounds);\r\n            }\r\n            //Update \r\n            for (let i = 0, n = this._curSubBatchMeshBounds.length; i < n; i++) {\r\n                sharedMesh.batchSubMeshInfo[i].bounds._tranform(worldMat, this._curSubBatchMeshBounds[i]);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * update data\r\n     * @param context \r\n     * @param transform \r\n     */\r\n    _renderUpdate(context: RenderContext3D, transform: Transform3D): void {\r\n        this._applyLightMapParams();\r\n        // // todo ,  worldmatrix\r\n        this._setShaderValue(Sprite3D.WORLDMATRIX, ShaderDataType.Matrix4x4, this._transform.worldMatrix);\r\n    }\r\n\r\n    _needRender(boundFrustum: BoundFrustum, context: RenderContext3D): boolean {\r\n        if (boundFrustum){\r\n            if(boundFrustum.intersects(this.bounds)){\r\n                let hodMesh = this.curHLODRS.HLODMesh.drawSubMeshs;\r\n                let lodbatchMesh =this._curHLODRS.HLODMesh.batchSubMeshInfo;\r\n                hodMesh.length = 0;\r\n                for(let i = 0,n = this._curSubBatchMeshBounds.length;i<n;i++){\r\n                    if(boundFrustum.intersects(this._curSubBatchMeshBounds[i])){\r\n                        hodMesh.push(lodbatchMesh[i]);\r\n                    }\r\n                }\r\n                //sort TODO\r\n                // let position = context.camera.transform.position;\r\n                // let oriPisition = (this.owner as Sprite3D)\r\n                // hodMesh = hodMesh.sort((a,b)=>{\r\n                    \r\n                //     return 10;\r\n                // });\r\n                this._curHLODRS.HLODMesh.drawSubMeshs = hodMesh;\r\n                return true;\r\n            }\r\n            else\r\n                return false\r\n        }else{\r\n            return true;\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        super.onEnable();\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n    }\r\n\r\n    onDestroy() {\r\n        super.onDestroy();\r\n        this._renderElements.forEach(element => {\r\n            element.material._removeReference();\r\n            element.destroy();\r\n        });\r\n        this._renderElements = null;\r\n    }\r\n\r\n    _cloneTo(dest: HLODRender) {\r\n        //TODO\r\n    }\r\n}","import { Component } from \"../../../components/Component\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Camera } from \"../../core/Camera\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Scene3D } from \"../../core/scene/Scene3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { HLODRender } from \"./HLODRender\";\r\nimport { HLODConfig, HLODResourceGroup } from \"./HLODUtil\";\r\n\r\nconst tempVec = new Vector3();\r\n\r\nexport class HLOD extends Component {\r\n    /**@internal */\r\n    _resourceList: HLODResourceGroup[];\r\n    /**@internal */\r\n    _curLODSource: HLODResourceGroup;\r\n    /**@internal */\r\n    _bounds: Bounds;\r\n    /**@internal */\r\n    _curRender: HLODRender[];\r\n    /**@internal TODO*/\r\n    //_crossRender: HLODRender[];\r\n    /**@internal TODO*/\r\n    //_renderMode:\r\n    /**@internal TODO*/\r\n    //cacheRender:HLODRender[];\r\n    /**@internal */\r\n    _HLODConfig: HLODConfig;\r\n    /**@internal */\r\n    private _lodRateArray: number[];\r\n    /**@internal */\r\n    private _size: number;\r\n\r\n    \r\n    constructor() {\r\n        super();\r\n        this._singleton = true;\r\n    }\r\n\r\n    /**\r\n     * IDE\r\n     */\r\n    get bounds() {\r\n        return this._bounds;\r\n    }\r\n\r\n    set bounds(value: Bounds) {\r\n        this._bounds = value;\r\n        this.recalculateBounds();\r\n    }\r\n\r\n    /**\r\n     * IDE\r\n     */\r\n    get lodResource() {\r\n        return this._resourceList;\r\n    }\r\n    set lodResource(value: HLODResourceGroup[]) {\r\n        this._resourceList = value;\r\n    }\r\n\r\n\r\n    /**\r\n     * lod\r\n     */\r\n    set lodCullRateArray(value: number[]) {\r\n        value.sort((a, b) => b - a);\r\n        this._lodRateArray = value;\r\n    }\r\n\r\n    get lodCullRateArray() {\r\n        return this._lodRateArray;\r\n    }\r\n\r\n    private _applyLODResource(resource: HLODResourceGroup) {\r\n        this._curLODSource = resource;\r\n        let element = resource.resources;\r\n        for (let i = 0, n = element.length; i < n; i++) {\r\n            let hlodRender = this.owner.addComponent(HLODRender);\r\n            this._curRender.push(hlodRender);\r\n            hlodRender.curHLODRS = element[i];\r\n        }\r\n    }\r\n\r\n    private _releaseGroupRender() {\r\n        this._curRender.forEach(element => {\r\n            element.destroy();\r\n        });\r\n        this._curRender = [];\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    recalculateBounds() {\r\n        //Bounds\r\n        let extend = this._bounds.getExtent();\r\n        this._size = 2 * Math.max(extend.x, extend.y, extend.z);\r\n    }\r\n\r\n    /**\r\n    * @internal\r\n    * \r\n    */\r\n    onPreRender() {\r\n        // this.recalculateBounds();\r\n        // //\r\n        let checkCamera = (this.owner.scene as Scene3D).cullInfoCamera as Camera;\r\n        let maxYDistance = checkCamera.maxlocalYDistance;\r\n        let cameraFrustum = checkCamera.boundFrustum;\r\n        Vector3.subtract((this.owner as Sprite3D).transform.position, checkCamera.transform.position, tempVec);\r\n        //farplane,.lod\r\n        let length = tempVec.length();\r\n        if (length > checkCamera.farPlane || cameraFrustum.containsPoint((this.owner as Sprite3D).transform.position) == 0) {\r\n            return;\r\n        }\r\n        let rateYDistance = length / checkCamera.farPlane * maxYDistance;\r\n        let rate = (this._size / rateYDistance);\r\n        for (let i = 0; i < this._lodRateArray.length; i++) {\r\n            if (rate < this._lodRateArray[i])\r\n                continue;\r\n            this.applyResource(this._resourceList[i]);\r\n            break;\r\n        }\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this._curLODSource.updateMark = Camera._updateMark;\r\n        //GC TODO\r\n\r\n    }\r\n\r\n    applyResource(resource: HLODResourceGroup) {\r\n        if (resource == this._curLODSource)\r\n            return;\r\n        if (resource.loaded) {\r\n            if (this._curLODSource) {\r\n                //Cache TODO\r\n                //Cross fade Render \r\n                this._releaseGroupRender();\r\n                this._applyLODResource(resource);\r\n\r\n            }\r\n        } else {\r\n            resource.load(this.applyResource, this);\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        super.onEnable();\r\n        //\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n    }\r\n\r\n    onDestroy() {\r\n        super.onDestroy();\r\n        //TODO\r\n    }\r\n\r\n    _cloneTo(dest: HLOD) {\r\n        //Clone to\r\n        throw \"cant clone HLOD\"\r\n    }\r\n}","import { Vector3 } from \"../../../maths/Vector3\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { GeometryElement } from \"../../core/GeometryElement\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\n\r\n\r\nexport class StaticBatchSubInfo {\r\n\r\n    indexStart: number;\r\n    indexCount: number;\r\n\r\n    meshBounds: Bounds;\r\n\r\n    needRender: boolean;\r\n\r\n    constructor() {\r\n        this.indexStart = 0;\r\n        this.indexCount = 0;\r\n        this.meshBounds = new Bounds(new Vector3(), new Vector3());\r\n        this.needRender = false;\r\n    }\r\n\r\n}\r\n\r\nexport class StaticBatchSubMesh extends GeometryElement {\r\n\r\n    /**@internal */\r\n    private static _type: number = GeometryElement._typeCounter++;\r\n\r\n    subInfos: StaticBatchSubInfo[];\r\n\r\n    indexByteCount: number;\r\n\r\n    constructor() {\r\n        super(MeshTopology.Triangles, DrawType.DrawElement);\r\n        this.subInfos = [];\r\n    }\r\n\r\n    addSubMesh(indexCount: number, indexStart: number, bounds: Bounds) {\r\n\r\n        let info = new StaticBatchSubInfo();\r\n        info.indexCount = indexCount;\r\n        info.indexStart = indexStart;\r\n        bounds.cloneTo(info.meshBounds);\r\n\r\n        this.subInfos.push(info);\r\n    }\r\n\r\n    _getType(): number {\r\n        return StaticBatchSubMesh._type;\r\n    }\r\n\r\n    _updateRenderParams(state: RenderContext3D): void {\r\n\r\n        this.clearRenderParams();\r\n        // todo\r\n        let cameraPos = state.camera.transform.position;\r\n        this.subInfos.sort((a, b) => {\r\n            let centerA = a.meshBounds.getCenter();\r\n            let distanceA = Vector3.distanceSquared(centerA, cameraPos);\r\n            let centerB = b.meshBounds.getCenter();\r\n            let distanceB = Vector3.distanceSquared(centerB, cameraPos);\r\n            return distanceA - distanceB;\r\n        });\r\n        for (const info of this.subInfos) {\r\n            if (info.needRender) {\r\n                this.setDrawElemenParams(info.indexCount, info.indexStart * this.indexByteCount);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    _prepareRender(state: RenderContext3D): boolean {\r\n        return !!this.subInfos.find(info => info.needRender);\r\n    }\r\n\r\n    destroy() {\r\n        for (const info of this.subInfos) {\r\n        }\r\n        this.subInfos = null;\r\n    }\r\n}","import { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { BlinnPhongMaterial } from \"../../core/material/BlinnPhongMaterial\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { Utils3D } from \"../../utils/Utils3D\";\r\nimport { StaticBatchSubMesh } from \"./StaticBatchSubMesh\";\r\nimport { StaticMeshMergeInfo } from \"./StaticMeshMergeInfo\";\r\n\r\n\r\nconst tempMatrix = new Matrix4x4;\r\n\r\nconst TriangleIndices = [0, 1, 2];\r\nconst InvertTriangleIndices = [0, 2, 1];\r\n\r\n\r\nexport class StaticBatchMesh {\r\n\r\n    static create(info: StaticMeshMergeInfo): StaticBatchMesh {\r\n        let staticMesh = new StaticBatchMesh();\r\n\r\n        let vertexCount = info.vertexCount;\r\n        let indexCount = info.indexCount;\r\n        let vertexDec = info.vertexDec;\r\n        let vertexFloatStride = vertexDec.vertexStride / 4;\r\n        let vertexData = new ArrayBuffer(vertexDec.vertexStride * vertexCount);\r\n        let vertexFloatArray = new Float32Array(vertexData);\r\n\r\n        let mergeIndexFormat = IndexFormat.UInt16;\r\n        let mergeIndexByteCount = 2;\r\n\r\n        let indexArray: Uint16Array | Uint32Array;\r\n\r\n        if (vertexCount > 65535) {\r\n            mergeIndexFormat = IndexFormat.UInt32;\r\n            mergeIndexByteCount = 4;\r\n            indexArray = new Uint32Array(indexCount);\r\n        }\r\n        else {\r\n            indexArray = new Uint16Array(indexCount);\r\n        }\r\n\r\n        let positionElement = vertexDec.getVertexElementByUsage(VertexMesh.MESH_POSITION0);\r\n        let normalElement = vertexDec.getVertexElementByUsage(VertexMesh.MESH_NORMAL0);\r\n        let lightmapUVElement = vertexDec.getVertexElementByUsage(VertexMesh.MESH_TEXTURECOORDINATE1);\r\n        let tangentElement = vertexDec.getVertexElementByUsage(VertexMesh.MESH_TANGENT0);\r\n\r\n        let vertexDataOffset = 0;\r\n        let vertexCountOffset = 0;\r\n        let indexOffset = 0;\r\n\r\n        let bounds: Bounds;\r\n\r\n        for (const render of info.renders) {\r\n            let lightmapScaleOffset = render.lightmapScaleOffset;\r\n\r\n            if (!bounds) {\r\n                bounds = staticMesh.bounds;\r\n                render.bounds.cloneTo(bounds);\r\n            }\r\n\r\n            Bounds.merge(bounds, render.bounds, bounds);\r\n\r\n            let sp = <Sprite3D>render.owner;\r\n            let invertFront = sp.transform._isFrontFaceInvert;\r\n            let worldMat = sp.transform.worldMatrix;\r\n            let normalMat = tempMatrix;\r\n            worldMat.invert(normalMat);\r\n            normalMat.transpose();\r\n\r\n            let mesh = render.getMesh();\r\n            let meshVertexCount = mesh.vertexCount;\r\n            let meshIndexCount = mesh.indexCount;\r\n\r\n            // todo \r\n            // todo \r\n            let meshVertexData = mesh._vertexBuffer.getFloat32Data();\r\n            vertexFloatArray.set(meshVertexData, vertexDataOffset);\r\n\r\n            // todo  vertex element \r\n            for (let index = 0; index < meshVertexCount; index++) {\r\n                let elementOffset = index * vertexFloatStride;\r\n                for (const element of vertexDec._vertexElements) {\r\n                    elementOffset += element.offset / 4;\r\n                    switch (element.elementUsage) {\r\n                        case VertexMesh.MESH_POSITION0:\r\n                            Utils3D.transformVector3ArrayToVector3ArrayCoordinate(meshVertexData, elementOffset, worldMat, vertexFloatArray, vertexDataOffset + elementOffset);\r\n                            break;\r\n                        case VertexMesh.MESH_NORMAL0:\r\n                        case VertexMesh.MESH_TANGENT0:\r\n                            Utils3D.transformVector3ArrayToVector3ArrayNormal(meshVertexData, elementOffset, normalMat, vertexFloatArray, vertexDataOffset + elementOffset);\r\n                            break;\r\n                        case VertexMesh.MESH_TEXTURECOORDINATE1:\r\n                            Utils3D.transformLightingMapTexcoordArray(meshVertexData, elementOffset, lightmapScaleOffset, vertexFloatArray, vertexDataOffset + elementOffset);\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            let meshIndexData = mesh._indexBuffer.getData();\r\n            // todo \r\n            let triangleIndices = invertFront ? InvertTriangleIndices : TriangleIndices;\r\n            for (let index = 0; index < meshIndexCount; index += 3) {\r\n                indexArray[indexOffset + index] = meshIndexData[index + triangleIndices[0]] + vertexCountOffset;\r\n                indexArray[indexOffset + index + 1] = meshIndexData[index + triangleIndices[1]] + vertexCountOffset;\r\n                indexArray[indexOffset + index + 2] = meshIndexData[index + triangleIndices[2]] + vertexCountOffset;\r\n            }\r\n\r\n            let subMeshCount = mesh.subMeshCount;\r\n\r\n            for (let index = 0; index < subMeshCount; index++) {\r\n                // todo default material\r\n                let material = render.sharedMaterials[index] || BlinnPhongMaterial.defaultMaterial;\r\n                let staticSubMesh = staticMesh._staticSubMeshes.get(material);\r\n                if (!staticSubMesh) {\r\n                    staticSubMesh = new StaticBatchSubMesh();\r\n                    staticSubMesh.indexByteCount = mergeIndexByteCount;\r\n                    staticMesh._staticSubMeshes.set(material, staticSubMesh);\r\n                    staticSubMesh.bufferState = staticMesh._bufferState;\r\n                    staticSubMesh.indexFormat = mergeIndexFormat;\r\n                }\r\n\r\n                let subMesh = mesh.getSubMesh(index);\r\n                // submesh bounds  mesh bounds \r\n                // mesh\r\n                // todo  \r\n                staticSubMesh.addSubMesh(subMesh.indexCount, subMesh._indexStart + indexOffset, render.bounds);\r\n            }\r\n\r\n            vertexDataOffset += meshVertexData.length;\r\n            vertexCountOffset += meshVertexCount;\r\n            indexOffset += meshIndexData.length;\r\n        }\r\n\r\n        let vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vertexData.byteLength, BufferUsage.Static, false);\r\n        vertexBuffer.vertexDeclaration = vertexDec;\r\n        vertexBuffer.setData(vertexData);\r\n\r\n        let indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(mergeIndexFormat, indexCount, BufferUsage.Static, false);\r\n        indexBuffer.setData(indexArray);\r\n\r\n        staticMesh.setBuffer(vertexBuffer, indexBuffer);\r\n\r\n        return staticMesh;\r\n    }\r\n    /**@internal */\r\n    _bufferState: BufferState;\r\n    /**@internal */\r\n    _vertexBuffer: VertexBuffer3D;\r\n    /**@internal */\r\n    _indexBuffer: IndexBuffer3D;\r\n    /**@internal */\r\n    _staticSubMeshes: Map<Material, StaticBatchSubMesh>;\r\n\r\n    bounds: Bounds;\r\n\r\n    constructor() {\r\n        this._bufferState = new BufferState();\r\n        this._staticSubMeshes = new Map();\r\n        this.bounds = new Bounds();\r\n    }\r\n\r\n    setBuffer(vertex: VertexBuffer3D, index: IndexBuffer3D) {\r\n        let bufferState = this._bufferState;\r\n\r\n        this._vertexBuffer = vertex;\r\n        this._indexBuffer = index;\r\n\r\n        bufferState.applyState([vertex], index);\r\n    }\r\n\r\n    destroy() {\r\n        this._staticSubMeshes.forEach(submesh => {\r\n            submesh.destroy();\r\n        });\r\n        this._staticSubMeshes.clear();\r\n        this._staticSubMeshes = null;\r\n        this._bufferState.destroy();\r\n    }\r\n\r\n\r\n}","import { RenderElement } from \"../../core/render/RenderElement\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class StaticBatchMeshRenderElement extends RenderElement {\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    getInvertFront(): boolean {\r\n        return false;\r\n    }\r\n\r\n}","import { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { MeshFilter } from \"../../core/MeshFilter\";\r\nimport { MeshSprite3DShaderDeclaration } from \"../../core/MeshSprite3DShaderDeclaration\";\r\nimport { BaseRender, RenderBitFlag } from \"../../core/render/BaseRender\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\nimport { BoundFrustum } from \"../../math/BoundFrustum\";\r\nimport { StaticBatchMesh } from \"./StaticBatchMesh\";\r\nimport { StaticBatchMeshRenderElement } from \"./StaticBatchMeshRenderElement\";\r\nimport { StaticMeshMergeInfo } from \"./StaticMeshMergeInfo\";\r\n\r\nexport class StaticBatchMeshRender extends BaseRender {\r\n\r\n    static create(info: StaticMeshMergeInfo): StaticBatchMeshRender {\r\n\r\n        let render = new StaticBatchMeshRender();\r\n\r\n        render.mergeInfo = info;\r\n\r\n        return render;\r\n    }\r\n\r\n    private _staticMesh: StaticBatchMesh;\r\n    public get staticMesh(): StaticBatchMesh {\r\n        return this._staticMesh;\r\n    }\r\n\r\n    private _mergeInfo: StaticMeshMergeInfo;\r\n\r\n    public get mergeInfo(): StaticMeshMergeInfo {\r\n        return this._mergeInfo;\r\n    }\r\n    public set mergeInfo(value: StaticMeshMergeInfo) {\r\n        this._mergeInfo = value;\r\n\r\n        let staticMesh = StaticBatchMesh.create(value);\r\n        this._staticMesh = staticMesh;\r\n        this.lightmapIndex = value.lightmapIndex;\r\n\r\n        this._staticMesh = staticMesh;\r\n        this.geometryBounds = staticMesh.bounds;\r\n        let meshDefines = MeshFilter._meshVerticeDefine;\r\n        let defineDatas = this._shaderValues;\r\n        this._getMeshDefine(staticMesh, meshDefines);\r\n\r\n        for (const meshDef of meshDefines) {\r\n            defineDatas.addDefine(meshDef);\r\n        }\r\n\r\n        this._renderElements.forEach(element => {\r\n            element.material._removeReference();\r\n            element.destroy();\r\n        })\r\n\r\n        this._renderElements = [];\r\n\r\n        staticMesh._staticSubMeshes.forEach((subMesh, material) => {\r\n            let element = new StaticBatchMeshRenderElement();\r\n            this._renderElements.push(element);\r\n            element.render = this;\r\n            element.material = material;\r\n            element.setGeometry(subMesh);\r\n\r\n            material._addReference();\r\n        });\r\n\r\n        staticMesh.bounds.cloneTo(this.bounds);\r\n\r\n    }\r\n\r\n    _singleton: boolean;\r\n\r\n    private constructor() {\r\n        super();\r\n        this._singleton = false;\r\n    }\r\n\r\n    _calculateBoundingBox() {\r\n        // todo \r\n        // this._bounds.setCenter(Vector3.ZERO);\r\n        // this._bounds.setExtent(Vector3.ONE);\r\n    }\r\n\r\n    _renderUpdate(context: RenderContext3D, transform: Transform3D): void {\r\n        this._applyLightMapParams();\r\n        // todo ,  worldmatrix\r\n        this._setShaderValue(Sprite3D.WORLDMATRIX, ShaderDataType.Matrix4x4, Matrix4x4.DEFAULT);\r\n        this._worldParams.x = 1.0;\r\n        this._setShaderValue(Sprite3D.WORLDINVERTFRONT, ShaderDataType.Vector4, this._worldParams);//TODO\r\n    }\r\n\r\n    _getMeshDefine(mesh: StaticBatchMesh, out: Array<ShaderDefine>) {\r\n        let vertexElements = mesh._vertexBuffer.vertexDeclaration._vertexElements;\r\n        for (const element of vertexElements) {\r\n            switch (element.elementUsage) {\r\n                case VertexMesh.MESH_COLOR0:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_COLOR);\r\n                    break;\r\n                case VertexMesh.MESH_TEXTURECOORDINATE0:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV0);\r\n                    break;\r\n                case VertexMesh.MESH_TEXTURECOORDINATE1:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV1);\r\n                    break;\r\n                case VertexMesh.MESH_TANGENT0:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_TANGENT);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    _needRender(boundFrustum: BoundFrustum, context: RenderContext3D): boolean {\r\n        if (boundFrustum) {\r\n            if (boundFrustum.intersects(this.bounds)) {\r\n                let needRender = false;\r\n                this.staticMesh._staticSubMeshes.forEach(subMesh => {\r\n                    for (const info of subMesh.subInfos) {\r\n                        info.needRender = boundFrustum.intersects(info.meshBounds);\r\n                        needRender = needRender || info.needRender;\r\n                    }\r\n                });\r\n                return needRender;\r\n            }\r\n            return false;\r\n        }\r\n        else {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        super.onEnable();\r\n        this.mergeInfo.renders.forEach(render => {\r\n            render.setRenderbitFlag(RenderBitFlag.RenderBitFlag_Batch, true);\r\n        });\r\n\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n        this.mergeInfo.renders.forEach(render => {\r\n            render.setRenderbitFlag(RenderBitFlag.RenderBitFlag_Batch, false);\r\n        });\r\n    }\r\n\r\n    onDestroy() {\r\n        super.onDestroy();\r\n        this._renderElements.forEach(element => {\r\n            element.material._removeReference();\r\n            element.destroy();\r\n        });\r\n        this._renderElements = null;\r\n        this._staticMesh.destroy();\r\n        this._staticMesh = null;\r\n    }\r\n\r\n    _cloneTo(dest: StaticBatchMeshRender) {\r\n        dest.mergeInfo = this.mergeInfo;\r\n    }\r\n}","import { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { MeshRenderer } from \"../../core/MeshRenderer\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\n\r\nexport class StaticMeshMergeInfo {\r\n\r\n    static create(render: MeshRenderer) {\r\n\r\n        let mesh = render.getMesh();\r\n        let owner = <Sprite3D>render.owner;\r\n\r\n        let info = new StaticMeshMergeInfo();\r\n        info.lightmapIndex = render.lightmapIndex;\r\n        info.receiveShadow = render.receiveShadow;\r\n        info.vertexDec = mesh ? mesh.getVertexDeclaration() : null;\r\n        // info.invertFrontFace = owner ? owner.transform._isFrontFaceInvert : false;\r\n        return info;\r\n    }\r\n\r\n    /**\r\n     * receiveShadow\r\n     */\r\n    receiveShadow: boolean;\r\n    \r\n    /**\r\n     * \r\n     */\r\n    lightmapIndex: number;\r\n\r\n    /**\r\n     * \r\n     */\r\n    vertexDec: VertexDeclaration;\r\n\r\n    private _renders: MeshRenderer[];\r\n    public get renders(): MeshRenderer[] {\r\n        return this._renders;\r\n    }\r\n\r\n    vertexCount: number;\r\n    indexCount: number;\r\n\r\n    private constructor() {\r\n        this._renders = [];\r\n        this.vertexCount = 0;\r\n        this.indexCount = 0;\r\n    }\r\n\r\n    match(render: MeshRenderer): boolean {\r\n\r\n        let mesh = render.getMesh();\r\n        let owner = <Sprite3D>render.owner;\r\n\r\n        let match = true;\r\n\r\n        match = match && this.lightmapIndex == render.lightmapIndex;\r\n        match = match && this.receiveShadow == render.receiveShadow;\r\n        match = match && this.vertexDec == mesh.getVertexDeclaration();\r\n        // match = match && this.invertFrontFace == owner.transform._isFrontFaceInvert;\r\n        return match;\r\n    }\r\n\r\n    addElement(render: MeshRenderer) {\r\n        this.renders.push(render);\r\n        let mesh = render.getMesh();\r\n        this.vertexCount += mesh.vertexCount;\r\n        this.indexCount += mesh.indexCount;\r\n    }\r\n\r\n    destroy() {\r\n        this._renders = null;\r\n    }\r\n}","import { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { SubUniformBufferData } from \"../../RenderEngine/SubUniformBufferData\";\r\nimport { UniformBufferParamsType } from \"../../RenderEngine/UniformBufferData\";\r\nimport { UniformBufferObject } from \"../../RenderEngine/UniformBufferObject\";\r\n/**\r\n * @internal\r\n */\r\nexport class TransLargeUBOUtils {\r\n    static configStartLength: number = 1024;\r\n\r\n    static addStep: number = 512;\r\n\r\n    bindUBO: UniformBufferObject;\r\n\r\n    maxlength: number;\r\n\r\n    currentlength: number = 0;\r\n\r\n    pool: SubUniformBufferData[];\r\n\r\n    subDataMap: SubUniformBufferData[];\r\n\r\n    subDataParamMap: Map<string, UniformBufferParamsType>;\r\n\r\n    defaultSubData: SubUniformBufferData;\r\n\r\n    /**\r\n     * @internal\r\n     * @param UBO\r\n     * @param paramsMap\r\n     * @param defautSubData \r\n     */\r\n    constructor(UBO: UniformBufferObject, paramsMap: Map<string, UniformBufferParamsType>, defautSubData: SubUniformBufferData) {\r\n        this.bindUBO = UBO;\r\n        this.defaultSubData = defautSubData;\r\n        UBO._reset(TransLargeUBOUtils.configStartLength * this.defaultSubData.getbyteLength());\r\n        this.subDataParamMap = paramsMap;\r\n        this.maxlength = TransLargeUBOUtils.configStartLength;\r\n        this.subDataMap = [];\r\n        this.pool = [];\r\n        this.subDataMap.push(defautSubData);\r\n        this.currentlength++;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @returns \r\n     */\r\n    create(): SubUniformBufferData {\r\n        if (this.pool.length > 0) {\r\n            const re = this.pool.pop();\r\n            re._isInPool = false;\r\n            return re;\r\n        }\r\n        if (this.maxlength == this.currentlength)\r\n            this.reset();\r\n\r\n        let uniformMap = new Map<number, UniformBufferParamsType>();\r\n        this.subDataParamMap.forEach((value, key) => {\r\n            uniformMap.set(Shader3D.propertyNameToID(key), value);\r\n        })\r\n        let subdata = new SubUniformBufferData(uniformMap, this.currentlength++);\r\n        this.subDataMap.push(subdata);\r\n        return subdata;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param subModuleData \r\n     */\r\n    recover(subModuleData: SubUniformBufferData) {\r\n        if (!subModuleData._isInPool) {\r\n            this.pool.push(subModuleData);\r\n            subModuleData._isInPool = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    reset() {\r\n        this.maxlength += TransLargeUBOUtils.addStep;\r\n        this.bindUBO._reset(this.maxlength * this.defaultSubData.getbyteLength());\r\n        //all update\r\n        this.subDataMap.forEach(element => {\r\n            this.bindUBO.setDataByByUniformBufferDataOffset(element, element._offset);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Update One subData\r\n     * @param data \r\n     */\r\n    updateSubData(data: SubUniformBufferData) {\r\n        this.bindUBO.setDataByByUniformBufferDataOffset(data, data._offset);\r\n        data._needUpdate = false;\r\n    }\r\n\r\n    updateBindRange(data: SubUniformBufferData) {\r\n        let bytelenth = data.getbyteLength();\r\n        this.bindUBO._bindBufferRange(data._offset * bytelenth, bytelenth);\r\n    }\r\n\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy() {\r\n        this.subDataMap.forEach(element => {\r\n            element.destroy();\r\n        });\r\n\r\n        delete this.subDataMap;\r\n        delete this.pool;\r\n        this.subDataMap = null;\r\n        this.pool = null;\r\n    }\r\n}","import { Camera, CameraClearFlags } from \"../Camera\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Ray } from \"../../math/Ray\";\r\nimport { Viewport } from \"../../math/Viewport\";\r\nimport { HitResult } from \"../../physics/HitResult\";\r\nimport { Config3D } from \"../../../../Config3D\";\r\nimport { InputManager } from \"../../../events/InputManager\";\r\nimport { Node } from \"../../../display/Node\";\r\nimport { Scene3D } from \"./Scene3D\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Render } from \"../../../renders/Render\";\r\n\r\nconst _vec2 = new Vector2();\r\nconst _ray = new Ray(new Vector3(), new Vector3());\r\nconst _hitResult = new HitResult();\r\n\r\nInputManager.prototype.getSprite3DUnderPoint = function (this: InputManager, x: number, y: number): Node {\r\n    _hitResult.succeeded = false;\r\n\r\n    x = x * this._stage.clientScaleX;\r\n    y = y * this._stage.clientScaleY;\r\n    var pageX = x;\r\n    var pageY = y;\r\n\r\n    var normalWidth = x / Render._mainCanvas.width;\r\n    var normalHeight = y / Render._mainCanvas.height;\r\n\r\n    x = this._stage.width * normalWidth;\r\n    y = this._stage.height * normalHeight;\r\n\r\n    _vec2.setValue(x, y);\r\n\r\n    for (let scene of <Scene3D[]>this._stage._scene3Ds) {\r\n        let sim = scene._physicsManager;\r\n        let uiManager = scene._UI3DManager;\r\n\r\n        let cameras = scene._cameraPool;\r\n        for (let i = cameras.length - 1; i >= 0; i--) {\r\n            let camera = <Camera>cameras[i];\r\n            let viewport: Viewport = camera.viewport;\r\n            let ratio = Config3D.pixelRatio;\r\n            if (pageX >= viewport.x && pageY >= viewport.y && pageX <= viewport.width / ratio && pageY <= viewport.height / ratio) {\r\n                //Physics\r\n                camera.viewportPointToRay(_vec2, _ray);\r\n\r\n                //3D UI\r\n                let sprite = uiManager.rayCast(_ray);\r\n                if (sprite)\r\n                    return sprite;\r\n                if (!sim)\r\n                    continue;\r\n                var sucess: boolean = sim.rayCast(_ray, <any>_hitResult);\r\n                if (sucess || (camera.clearFlag === CameraClearFlags.SolidColor || camera.clearFlag === CameraClearFlags.Sky))\r\n                    break;\r\n            }\r\n        }\r\n\r\n        if (_hitResult.succeeded)\r\n            return (<Sprite3D>_hitResult.collider.owner);\r\n    }\r\n\r\n    return null;\r\n}\r\n","import { Vector2 } from \"../../../../maths/Vector2\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\n\r\n/**\r\n * <code>GradientDataVector2</code> \r\n */\r\nexport class GradientDataVector2 implements IClone {\r\n\tprivate _currentLength: number = 0;\r\n\t/**@internal */\r\n\t_elements: Float32Array;\r\n\r\n\t/***/\r\n\tget gradientCount(): number {\r\n\t\treturn this._currentLength / 3;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientDataVector2</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tthis._elements = new Float32Array(12);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tkey 01\r\n\t * @param\tvalue \r\n\t */\r\n\tadd(key: number, value: Vector2): void {\r\n\t\tif (this._currentLength < 8) {\r\n\r\n\t\t\tif ((this._currentLength === 6) && ((key !== 1))) {\r\n\t\t\t\tkey = 1;\r\n\t\t\t\tconsole.log(\"GradientDataVector2 warning:the forth key is  be force set to 1.\");\r\n\t\t\t}\r\n\r\n\t\t\tthis._elements[this._currentLength++] = key;\r\n\t\t\tthis._elements[this._currentLength++] = value.x;\r\n\t\t\tthis._elements[this._currentLength++] = value.y;\r\n\t\t} else {\r\n\t\t\tconsole.log(\"GradientDataVector2 warning:data count must lessEqual than 4\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientDataVector2: GradientDataVector2 = <GradientDataVector2>destObject;\r\n\t\tdestGradientDataVector2._currentLength = this._currentLength;\r\n\t\tvar destElements: Float32Array = destGradientDataVector2._elements;\r\n\t\tfor (var i: number = 0, n: number = this._elements.length; i < n; i++) {\r\n\t\t\tdestElements[i] = this._elements[i];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientDataVector2: GradientDataVector2 = new GradientDataVector2();\r\n\t\tthis.cloneTo(destGradientDataVector2);\r\n\t\treturn destGradientDataVector2;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Vector2 } from \"../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { BufferUsage } from \"../../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { VertexDeclaration } from \"../../../../RenderEngine/VertexDeclaration\";\r\nimport { VertexBuffer3D } from \"../../../graphics/VertexBuffer3D\";\r\nimport { Laya3DRender } from \"../../../RenderObjs/Laya3DRender\";\r\nimport { DrawMeshInstancedCMD } from \"./DrawMeshInstancedCMD\";\r\n\r\n/**\r\n * @internal\r\n * <code>Mesh</code> CustomInstance\r\n */\r\nexport class MaterialInstanceProperty {\r\n\t/**@internal instanceProperty name*/\r\n\tpublic _name: string;\r\n\t/**@internal property Data*/\r\n\tpublic _value: Vector4[] | Vector3[] | Vector2[] | Float32Array;\r\n\t/**@internal vertex Declaration */\r\n\tpublic _vertexDeclaration: VertexDeclaration;\r\n\t/**@internal */\r\n\tpublic _isNeedUpdate: boolean = false;\r\n\t/**@internal */\r\n\tpublic _vertexStride: number;\r\n\t/**@internal */\r\n\tpublic _instanceData: Float32Array;\r\n\t/**@internal */\r\n\tpublic _vertexBuffer: VertexBuffer3D;\r\n\r\n\t/**\r\n\t * @internal\r\n\t * instanceBuffer\r\n\t */\r\n\tcreateInstanceVertexBuffer3D() {\r\n\t\tthis._instanceData = new Float32Array(DrawMeshInstancedCMD.maxInstanceCount * this._vertexStride);\r\n\t\tthis._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(this._instanceData.length * 4, BufferUsage.Dynamic, false);\r\n\t\tthis._vertexBuffer.vertexDeclaration = this._vertexDeclaration;\r\n\t\tthis._vertexBuffer.instanceBuffer = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * \r\n\t */\r\n\tupdateVertexBufferData(drawNums: number) {\r\n\t\t//\r\n\t\tif (!this._isNeedUpdate)\r\n\t\t\treturn;\r\n\t\tlet instanceData = this._instanceData;\r\n\t\tlet dataValue = this._value;\r\n\t\tlet datalength = this._value.length;\r\n\t\tlet data: Vector2 | Vector3 | Vector4;\r\n\t\tlet stride = this._vertexStride;\r\n\t\tlet updateType = 0;\r\n\t\tif (!(this._value instanceof Float32Array)) {\r\n\t\t\tupdateType = 1;//Vector\r\n\t\t}\r\n\r\n\t\tswitch (updateType) {\r\n\t\t\tcase 0:\r\n\t\t\t\tinstanceData.set(<Float32Array>dataValue, 0);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tfor (let i = 0; i < datalength; i++) {\r\n\t\t\t\t\tdata = <Vector2 | Vector3 | Vector4>dataValue[i];\r\n\t\t\t\t\tdata.writeTo(instanceData, i * stride);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tthis._vertexBuffer.orphanStorage();\r\n\t\tthis._vertexBuffer.setData(instanceData.buffer, 0, 0, drawNums * 4 * stride);\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tdelete this._value;\r\n\t\tdelete this._instanceData;\r\n\t\tthis._vertexDeclaration = null;\r\n\t\tthis._vertexBuffer.destroy();\r\n\t}\r\n}","import { Vector2 } from \"../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { VertexDeclaration } from \"../../../../RenderEngine/VertexDeclaration\";\r\nimport { VertexElement } from \"../../../../renders/VertexElement\";\r\nimport { VertexElementFormat } from \"../../../../renders/VertexElementFormat\";\r\nimport { MaterialInstanceProperty } from \"./MaterialInstanceProperty\";\r\n\r\nexport enum InstanceLocation{\r\n\tCUSTOME0 = 12,\r\n\tCUSTOME1 = 13,\r\n\tCUSTOME2 = 14,\r\n\tCUSTOME3 = 15\r\n}\r\n\r\n/**\r\n * <code>Mesh</code> CustomInstance\r\n */\r\nexport class MaterialInstancePropertyBlock{\r\n\t\r\n\t/**Instance */\r\n\t/**attribute instance , instance*/\r\n\tpublic static INSTANCETYPE_ATTRIBUTE:number = 0;\r\n\t/**uniform instance instance  WebGLContext._maxUniformFragmentVectors */\r\n\tpublic static INSTANCETYPE_UNIFORMBUFFER:number = 1;\r\n\r\n\r\n\t/**@internal instance type*/\r\n\tprotected _type:number = 0;\r\n\r\n\r\n\t/**@internal property map*/\r\n\t_propertyMap:{[key:number]:MaterialInstanceProperty} = {};\r\n\r\n\tconstructor(){\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @internal \r\n\t * @param vertexElementFormat \r\n\t * @param propertyName \r\n\t * @param attributeLocation attribute\r\n\t * @param prob \r\n\t */\r\n\tprivate _checkPropertyLegal(vertexElementFormat:VertexElementFormat,propertyName:string,attributeLocation:InstanceLocation,prob:MaterialInstanceProperty){\r\n\t\t\tvar vecDec = prob._vertexDeclaration;\r\n\t\t\t//\r\n\t\t\tif(vecDec._vertexElements[0]._elementFormat !== vertexElementFormat)\r\n\t\t\t\tthrow \"Data exists and format does not match\";//\r\n\t\t\tif(prob._name !== propertyName)\r\n\t\t\t\tthrow \"You cannot add a new property to an existing attributeLocation,Please use another attributeLocation\";//\t\r\n\t}\r\n\r\n\t/**\r\n\t * instance\r\n\t * @param attributeName name\r\n\t * @param arrays data\r\n\t * @param vertexStride vertex size\r\n\t * @param vertexformat vertexFormat\r\n\t * @param attributeLocation  attribute location\r\n\t */\r\n\tprivate _creatProperty(attributeName:string,arrays:Vector4[]|Vector3[]|Vector2[]|Float32Array,vertexStride:number,vertexformat:string,attributeLocation:InstanceLocation){\r\n\t\tvar prob = this._propertyMap[attributeLocation] = new MaterialInstanceProperty();\r\n\t\tprob._name = attributeName;\r\n\t\tprob._value = arrays;\r\n\t\tprob._vertexDeclaration = new VertexDeclaration(vertexStride,[new VertexElement(0,vertexformat,attributeLocation)]);\r\n\t\tprob._isNeedUpdate = true;\r\n\t\tprob._vertexStride = vertexStride / 4;\r\n\t\tprob.createInstanceVertexBuffer3D();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Vector4\r\n\t * @param attributeName Shader\r\n\t * @param arrays \r\n\t * @param attributeLocation  ShadershaderAttribute\r\n\t */\r\n\tsetVectorArray(attributeName:string,arrays:Vector4[]|Float32Array,attributeLocation:InstanceLocation):void{\r\n\t\tvar prob = this._propertyMap[attributeLocation];\r\n\t\tif(prob){\r\n\t\t\t//\r\n\t\t\tthis._checkPropertyLegal(VertexElementFormat.Vector4,attributeName,attributeLocation,prob);\r\n\t\t\tprob._value = arrays;\r\n\t\t\tprob._isNeedUpdate = true;\r\n\t\t}else//\r\n\t\t\tthis._creatProperty(attributeName,arrays,16,VertexElementFormat.Vector4,attributeLocation);\r\n\t}\r\n\r\n\t/**\r\n\t * Vector3\r\n\t * @param attributeName Shader\r\n\t * @param arrays \r\n\t * @param attributeLocation shadershaderAttribute\r\n\t */\r\n\tsetVector3Array(attributeName:string,arrays:Vector3[]|Float32Array,attributeLocation:InstanceLocation){\r\n\t\tvar prob = this._propertyMap[attributeLocation];\r\n\t\tif(prob){\r\n\t\t\t//\r\n\t\t\tthis._checkPropertyLegal(VertexElementFormat.Vector3,attributeName,attributeLocation,prob);\r\n\t\t\tprob._value = arrays;\r\n\t\t\tprob._isNeedUpdate = true;\r\n\t\t}else//\r\n\t\t\tthis._creatProperty(attributeName,arrays,12,VertexElementFormat.Vector3,attributeLocation);\r\n\t}\r\n\r\n\t/**\r\n\t * Vector2\r\n\t * @param attributeName Shader\r\n\t * @param arrays \r\n\t * @param attributeLocation shadershaderAttribute\r\n\t */\r\n\tsetVector2Array(attributeName:string,arrays:Vector2[]|Float32Array,attributeLocation:InstanceLocation){\r\n\t\tvar prob = this._propertyMap[attributeLocation];\r\n\t\tif(prob){\r\n\t\t\t//\r\n\t\t\tthis._checkPropertyLegal(VertexElementFormat.Vector2,attributeName,attributeLocation,prob);\r\n\t\t\tprob._value = arrays;\r\n\t\t\tprob._isNeedUpdate = true;\r\n\t\t}else//\r\n\t\t\tthis._creatProperty(attributeName,arrays,8,VertexElementFormat.Vector2,attributeLocation);\r\n\t}\r\n\r\n\t/**\r\n \t * Number\r\n\t * @param attributeName Shader\r\n\t * @param arrays \r\n\t * @param attributeLocation shadershaderAttribute\r\n\t */\r\n\tsetNumberArray(attributeName:string,arrays:Float32Array,attributeLocation:InstanceLocation){\r\n\t\tvar prob = this._propertyMap[attributeLocation];\r\n\t\tif(prob){\r\n\t\t\t//\r\n\t\t\tthis._checkPropertyLegal(VertexElementFormat.Single,attributeName,attributeLocation,prob);\r\n\t\t\tprob._value = arrays;\r\n\t\t\tprob._isNeedUpdate = true;\r\n\t\t}else//\r\n\t\t\tthis._creatProperty(attributeName,arrays,4,VertexElementFormat.Single,attributeLocation);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param attributeLocation  shader\r\n\t */\r\n\tgetPropertyArray(attributeLocation:InstanceLocation):Vector4[]|Vector3[]|Vector2[]|Float32Array{\r\n\t\tvar prob = this._propertyMap[attributeLocation];\r\n\t\treturn prob?prob._value:null;\r\n\t}\r\n\r\n\tclear(){\r\n\t\tfor(var i in this._propertyMap){\r\n\t\t\tthis._propertyMap[i].destroy();\r\n\t\t}\r\n\t\tthis._propertyMap = {};\r\n\t}\r\n\r\n}","import { Animator2D } from \"../../components/Animator2D\";\r\nimport { AnimatorState2D } from \"../../components/AnimatorState2D\";\r\nimport { Animator } from \"../component/Animator/Animator\"\r\nimport { AnimatorPlayState } from \"../component/Animator/AnimatorPlayState\";\r\nimport { AnimatorState } from \"../component/Animator/AnimatorState\";\r\n\r\ninterface AnimatorPlayScriptInfo {\r\n\tanimator: Animator | Animator2D;\r\n\tlayerindex: number;\r\n\tplayState: AnimatorState | AnimatorState2D;\r\n}\r\n/**\r\n * <code>AnimatorStateScript</code> ,,\r\n */\r\nexport class AnimatorStateScript {\r\n\r\n\t/**@internal */\r\n\tplayStateInfo: AnimatorPlayScriptInfo = { animator: null, layerindex: -1, playState: null };\r\n\r\n\t/**@internal */\r\n\tsetPlayScriptInfo(animator: Animator | Animator2D, layerindex: number, playstate: AnimatorState | AnimatorState2D) {\r\n\t\tthis.playStateInfo.animator = animator;\r\n\t\tthis.playStateInfo.layerindex = layerindex;\r\n\t\tthis.playStateInfo.playState = playstate;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>AnimatorStateScript</code> \r\n\t */\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tonStateEnter(): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param normalizeTime 0-1\r\n\t */\r\n\tonStateUpdate(normalizeTime: number): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tonStateExit(): void {\r\n\r\n\t}\r\n\t/**\r\n\t * \r\n\t */\r\n\tonStateLoop(): void {\r\n\r\n\t}\r\n}\r\n\r\n\r\n","import { ICollider } from \"../../Physics3D/interface/ICollider\";\r\nimport { ContactPoint } from \"./ContactPoint\";\r\n\r\n/**\r\n * <code>Collision</code> \r\n */\r\nexport class Collision {\r\n    /**@internal */\r\n    _lastUpdateFrame = -2147483648/*int.MIN_VALUE*/;\r\n    /**@internal */\r\n    _updateFrame = -2147483648/*int.MIN_VALUE*/;\r\n    /**@internal */\r\n    _isTrigger = false;\r\n\r\n    /**@internal */\r\n    _colliderA: ICollider;\r\n    /**@internal */\r\n    _colliderB: ICollider;\r\n\r\n    /**@readonly*/\r\n    contacts: ContactPoint[] = [];\r\n    /**@readonly*/\r\n    other: ICollider;\r\n\r\n    /**@internal */\r\n    _inPool: boolean = false;\r\n    /**\r\n     *  <code>Collision</code> \r\n     */\r\n    constructor() {\r\n\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setUpdateFrame(farme: number): void {\r\n        this._lastUpdateFrame = this._updateFrame;//TODO:\r\n        this._updateFrame = farme;\r\n    }\r\n\r\n}\r\n\r\n\r\n","import { ICollider } from \"../../Physics3D/interface/ICollider\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\n\r\n/**\r\n * <code>ContactPoint</code> \r\n */\r\nexport class ContactPoint {\r\n\t/**@internal */\r\n\t_idCounter: number = 0;\r\n\r\n\t/**@internal */\r\n\t_id: number;\r\n\r\n\t/**A*/\r\n\t_colliderA: ICollider = null;\r\n\t/**B*/\r\n\t_colliderB: ICollider = null;\r\n\t/***/\r\n\tdistance: number = 0;\r\n\t/***/\r\n\tnormal: Vector3 = new Vector3();\r\n\t/**A*/\r\n\tpositionOnA: Vector3 = new Vector3();\r\n\t/**B*/\r\n\tpositionOnB: Vector3 = new Vector3();\r\n\r\n\t/**\r\n\t *  <code>ContactPoint</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tthis._id = ++this._idCounter;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { GeometryElement } from \"../../core/GeometryElement\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { Mesh } from \"../../resource/models/Mesh\";\r\nimport { HLODBatchSubMesh } from \"./HLODUtil\";\r\n\r\n\r\nexport class HLODBatchMesh extends GeometryElement {\r\n    /**@internal batchMesh */\r\n    private _mesh: Mesh;\r\n    /**@internal */\r\n    private _batchSubMeshInfos: HLODBatchSubMesh[];\r\n\r\n    /**@internal */\r\n    private _drawSubMeshs: HLODBatchSubMesh[];\r\n    /**\r\n     * instance HLODBatchMesh\r\n     */\r\n    constructor() {\r\n        super(MeshTopology.Triangles, DrawType.DrawElement);\r\n    }\r\n\r\n    /**\r\n     * mesh\r\n     * @param mesh \r\n     * @param bounds \r\n     */\r\n    set batchMesh(mesh: Mesh) {\r\n        if (this._mesh != mesh) {\r\n            this._mesh && (this._mesh._removeReference());\r\n            this.indexFormat = mesh.indexFormat;\r\n            this._mesh = mesh;\r\n            this._mesh._addReference();\r\n        }\r\n    }\r\n\r\n    get batchMesh() {\r\n        return this._mesh;\r\n    }\r\n\r\n    /**\r\n     * mesh\r\n     */\r\n    set batchSubMeshInfo(value: HLODBatchSubMesh[]) {\r\n        this._batchSubMeshInfos = value;\r\n    }\r\n\r\n    get batchSubMeshInfo() {\r\n        return this._batchSubMeshInfos;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param value \r\n     */\r\n    set drawSubMeshs(value: HLODBatchSubMesh[]) {\r\n        this._drawSubMeshs = value;\r\n    }\r\n\r\n    get drawSubMeshs(): HLODBatchSubMesh[] {\r\n        return this._drawSubMeshs;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    _prepareRender(state: RenderContext3D): boolean {\r\n        this._mesh._uploadVerticesData();\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    _updateRenderParams(state: RenderContext3D): void {\r\n        var mesh: Mesh = this._mesh;\r\n        var byteCount: number;\r\n        switch (mesh.indexFormat) {\r\n            case IndexFormat.UInt32:\r\n                byteCount = 4;\r\n                break;\r\n            case IndexFormat.UInt16:\r\n                byteCount = 2;\r\n                break;\r\n            case IndexFormat.UInt8:\r\n                byteCount = 1;\r\n                break;\r\n        }\r\n        this.clearRenderParams();\r\n        this.bufferState = mesh._bufferState;\r\n        if (this._drawSubMeshs) {\r\n            this._drawSubMeshs.forEach(element => {\r\n                this.setDrawElemenParams(element.drawPramas.y, element.drawPramas.x * byteCount);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    destroy(): void {\r\n        this._mesh && this._mesh._removeReference();\r\n        delete this._batchSubMeshInfos;\r\n        delete this._drawSubMeshs;\r\n    }\r\n\r\n\r\n}","import { Laya } from \"../../../../Laya\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Handler } from \"../../../utils/Handler\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { Lightmap } from \"../../core/scene/Lightmap\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { HLODBatchMesh } from \"./HLODBatchMesh\";\r\n/**\r\n * HLOD\r\n */\r\nexport class HLODConfig {\r\n    releaseCallTime: number;//CG\r\n    releaseTime: number;//\r\n}\r\n\r\n\r\n/**\r\n * HLODBatch resource\r\n */\r\nexport class HLODBatchSubMesh {\r\n    bounds: Bounds;\r\n    drawPramas: Vector2;\r\n}\r\n\r\n/**\r\n * HLODElement HLODRenderElement\r\n */\r\nexport class HLODElement {\r\n    /**batch mesh */\r\n    HLODMesh: HLODBatchMesh;\r\n\r\n    /**material */\r\n    private _material: Material;\r\n    public get material(): Material {\r\n        return this._material;\r\n    }\r\n    public set material(value: Material) {\r\n        if (this._material != value) {\r\n            this._material && this._material._removeReference();\r\n            this._material = value;\r\n            this._material._addReference();\r\n        }\r\n\r\n    }\r\n\r\n    /**lightmap */\r\n    private _lightmap: Lightmap;\r\n    public get lightmap(): Lightmap {\r\n        return this._lightmap;\r\n    }\r\n    public set lightmap(value: Lightmap) {\r\n        if (this._lightmap != value) {\r\n            if (this._lightmap) {\r\n                this._lightmap.lightmapColor._removeReference();\r\n                this._lightmap.lightmapDirection._removeReference();\r\n            }\r\n            this._lightmap = value;\r\n            this._lightmap.lightmapColor._addReference();\r\n            this._lightmap.lightmapDirection._addReference();\r\n\r\n        }\r\n        this._lightmap = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * lightmap direct destroy\r\n     */\r\n    release() {\r\n        this.HLODMesh.destroy();\r\n        this.material.destroy();\r\n        if (this.lightmap) {\r\n            this._lightmap.lightmapColor.destroy();\r\n            this._lightmap.lightmapDirection.destroy();\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * HLOD Resource\r\n * Load/release\r\n */\r\nexport class HLODResourceGroup {\r\n    url: string;\r\n    updateMark: number;\r\n    resources: HLODElement[];\r\n    loaded: boolean;\r\n\r\n    /**\r\n     * loaded\r\n     * @param callFun \r\n     * @param hlod \r\n     */\r\n    load(callFun: Function, hlod: any) {\r\n        if (!this.loaded) {\r\n            Laya.loader.load(this.url, Handler.create(\r\n                this, (res: any) => {\r\n                    callFun.apply(hlod, [this]);\r\n                    this.loaded = true;\r\n                }, [this]\r\n            ));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * HLODGourp\r\n     */\r\n    release() {\r\n        this.resources.forEach(element => {\r\n            element.release();\r\n        });\r\n        this.loaded = false;\r\n    }\r\n}","import { Vector3 } from \"../../../maths/Vector3\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { ICameraCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { ICullPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICullPass\";\r\nimport { IRenderElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderElement\";\r\nimport { IRenderQueue } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderQueue\";\r\nimport { ISceneRenderManager } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { IShadowCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { ISortPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISortPass\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { IRenderEngine3DOBJFactory } from \"../IRenderEngine3DOBJFactory\";\r\nimport { NativeBaseRenderNode } from \"./NativeBaseRenderNode\";\r\nimport { NativeBaseRenderQueue } from \"./NativeBaseRenderQueue\";\r\nimport { NativeBounds } from \"./NativeBounds\";\r\nimport { NativeCameraCullInfo } from \"./NativeCameraCullInfo\";\r\nimport { NativeCullPassBase } from \"./NativeCullPass\";\r\nimport { NativeIndexBuffer3D } from \"./NativeIndexBuffer3D\";\r\nimport { NativeInstanceRenderElementOBJ } from \"./NativeInstanceRenderElementOBJ\";\r\nimport { NativeRenderContext3DOBJ } from \"./NativeRenderContext3DOBJ\";\r\nimport { NativeRenderElementOBJ } from \"./NativeRenderElementOBJ\";\r\nimport { NativeRenderGeometryElementOBJ } from \"./NativeRenderGeometryElementOBJ\";\r\nimport { NativeSceneRenderManager } from \"./NativeSceneRenderManager\";\r\nimport { NativeShadowCullInfo } from \"./NativeShadowCullInfo\";\r\nimport { NativeSkinRenderElementOBJ } from \"./NativeSkinRenderElementOBJ\";\r\nimport { NativeTransform3D } from \"./NativeTransform3D\";\r\nimport { NativeVertexBuffer3D } from \"./NativeVertexBuffer3D\";\r\n\r\n\r\nexport class NativeGLRenderEngine3DOBJFactory implements IRenderEngine3DOBJFactory{\r\n    createTransform(owner: Sprite3D): Transform3D {\r\n        return new NativeTransform3D(owner);\r\n    }\r\n\r\n    createBounds(min: Vector3, max: Vector3): any {\r\n        return new NativeBounds(min, max);\r\n    }\r\n\r\n    createRenderElement(): IRenderElement {\r\n        return new NativeRenderElementOBJ();\r\n    }\r\n\r\n    createSkinRenderElement(): IRenderElement {\r\n        return new NativeSkinRenderElementOBJ();\r\n    }\r\n\r\n    createInstanceRenderElement(): IRenderElement {\r\n        return new NativeInstanceRenderElementOBJ();\r\n    }\r\n\r\n    createBaseRenderQueue(isTransparent: boolean): IRenderQueue {\r\n        var queue: NativeBaseRenderQueue = new NativeBaseRenderQueue(isTransparent);\r\n        queue.sortPass = this.createSortPass();\r\n        return queue;\r\n    }\r\n\r\n    createVertexBuffer3D(byteLength: number, bufferUsage: BufferUsage, canRead: boolean = false) {\r\n        return new NativeVertexBuffer3D(byteLength, bufferUsage, canRead);\r\n    }\r\n\r\n    createIndexBuffer3D(indexType: IndexFormat, indexCount: number, bufferUsage: BufferUsage = BufferUsage.Static, canRead: boolean = false): IndexBuffer3D {\r\n        return new NativeIndexBuffer3D(indexType, indexCount, bufferUsage, canRead);\r\n    }\r\n\r\n    createSceneRenderManager(): ISceneRenderManager {\r\n        return new NativeSceneRenderManager();\r\n    }\r\n\r\n    createCullPass(): ICullPass {\r\n        return new NativeCullPassBase();\r\n    }\r\n\r\n    createSortPass(): ISortPass {\r\n        return new (window as any).conchQuickSort();\r\n    }\r\n\r\n    createShadowCullInfo(): IShadowCullInfo {\r\n        return new NativeShadowCullInfo();\r\n    }\r\n\r\n    createCameraCullInfo(): ICameraCullInfo {\r\n        return new NativeCameraCullInfo();\r\n    }\r\n\r\n    createBaseRenderNode(): NativeBaseRenderNode {\r\n        return new NativeBaseRenderNode();\r\n    }\r\n\r\n    createRenderContext3D(): NativeRenderContext3DOBJ {\r\n        return new NativeRenderContext3DOBJ();\r\n    }\r\n\r\n    createRenderGeometry(mode: MeshTopology, drayType: DrawType): NativeRenderGeometryElementOBJ {\r\n        return new NativeRenderGeometryElementOBJ(mode,drayType);\r\n    }\r\n}","import { PixelLineFilter } from \"./PixelLineFilter\";\r\nimport { PixelLineRenderer } from \"./PixelLineRenderer\";\r\nimport { PixelLineData } from \"./PixelLineData\";\r\nimport { RenderableSprite3D } from \"../RenderableSprite3D\"\r\nimport { Node } from \"../../../display/Node\"\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { UnlitMaterial } from \"../material/UnlitMaterial\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>PixelLineSprite3D</code> \r\n */\r\nexport class PixelLineSprite3D extends RenderableSprite3D {\r\n    /** @private active */\r\n    private _isRenderActive: Boolean = false;\r\n    /** @private */\r\n    private _isInRenders: Boolean = false;\r\n    /** @internal */\r\n    public _geometryFilter: PixelLineFilter;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get maxLineCount(): number {\r\n        return (this._render as PixelLineRenderer).maxLineCount;\r\n    }\r\n\r\n    set maxLineCount(value: number) {\r\n        (this._render as PixelLineRenderer).maxLineCount = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get lineCount(): number {\r\n        return (this._render as PixelLineRenderer).lineCount;\r\n    }\r\n\r\n    /**\r\n     * line\r\n     */\r\n    get pixelLineRenderer(): PixelLineRenderer {\r\n        return (<PixelLineRenderer>this._render);\r\n    }\r\n\r\n    /**\r\n     *  <code>PixelLineSprite3D</code> \r\n     * @param maxCount \r\n     * @param name \r\n     */\r\n    constructor(maxCount: number = 2, name: string = null) {\r\n        super(name);\r\n\r\n        this._render = this.addComponent(PixelLineRenderer);\r\n        this._geometryFilter = (this._render as PixelLineRenderer)._pixelLineFilter;\r\n        (this._render as PixelLineRenderer).maxLineCount = maxCount;\r\n        let material = this._render.material = new UnlitMaterial();\r\n        material.enableVertexColor = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tstartPosition  \r\n     * @param\tendPosition\t   \r\n     * @param\tstartColor\t   \r\n     * @param\tendColor\t   \r\n     */\r\n    addLine(startPosition: Vector3, endPosition: Vector3, startColor: Color, endColor: Color): void {\r\n        (this._render as PixelLineRenderer).addLine(startPosition, endPosition, startColor, endColor);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tlines  \r\n     */\r\n    addLines(lines: PixelLineData[]): void {\r\n        (this._render as PixelLineRenderer).addLines(lines);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param index \r\n     */\r\n    removeLine(index: number): void {\r\n        (this._render as PixelLineRenderer).removeLine(index);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tindex  \t\t   \r\n     * @param\tstartPosition  \r\n     * @param\tendPosition\t   \r\n     * @param\tstartColor\t   \r\n     * @param\tendColor\t   \r\n     */\r\n    setLine(index: number, startPosition: Vector3, endPosition: Vector3, startColor: Color, endColor: Color): void {\r\n        (this._render as PixelLineRenderer).setLine(index, startPosition, endPosition, startColor, endColor);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param out \r\n     */\r\n    getLine(index: number, out: PixelLineData): void {\r\n        (this._render as PixelLineRenderer).getLine(index, out);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    clear(): void {\r\n        (this._render as PixelLineRenderer).clear();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Node {\r\n        return new Sprite3D();\r\n    }\r\n\r\n}\r\n\r\n","import { MeshRenderer } from \"laya/d3/core/MeshRenderer\";\r\nimport { StaticBatchMeshRender } from \"./StaticBatchMeshRender\";\r\nimport { StaticMeshMergeInfo } from \"./StaticMeshMergeInfo\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class StaticMeshBatchManager {\r\n\r\n    private meshVertexDecSet: Set<StaticMeshMergeInfo>;\r\n\r\n    constructor() {\r\n        this.meshVertexDecSet = new Set();\r\n    }\r\n    /**\r\n     * \r\n     * @param renders \r\n     * @returns \r\n     */\r\n    combine(renders: MeshRenderer[]) {\r\n        // todo \r\n        for (const render of renders) {\r\n            let haveMatch = false;\r\n            for (const info of this.meshVertexDecSet) {\r\n                if (info.match(render)) {\r\n                    haveMatch = true;\r\n                    info.addElement(render);\r\n                }\r\n            }\r\n            if (!haveMatch) {\r\n                let info = StaticMeshMergeInfo.create(render);\r\n                info.addElement(render);\r\n                this.meshVertexDecSet.add(info);\r\n            }\r\n        }\r\n\r\n        let staticRenders: StaticBatchMeshRender[] = [];\r\n        for (const info of this.meshVertexDecSet) {\r\n            staticRenders.push(StaticBatchMeshRender.create(info));\r\n        }\r\n        this.meshVertexDecSet.clear();\r\n        return staticRenders;\r\n    }\r\n    \r\n    merge(info: StaticMeshMergeInfo) {\r\n        let staticMeshRender = StaticBatchMeshRender.create(info);\r\n        return staticMeshRender;\r\n    }\r\n\r\n}","import { Color } from \"../../maths/Color\";\r\n\r\n\t\r\n\t/**\r\n\t * <code>TextMesh</code> \r\n\t */\r\n\texport class TextMesh {\r\n\t\tprivate _text:string;\r\n\t\tprivate _fontSize:number;\r\n\t\tprivate _color:Color;\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t * @return \r\n\t\t */\r\n\t\t get text():string {\r\n\t\t\treturn this._text;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param value \r\n\t\t */\r\n\t\t set text(value:string) {\r\n\t\t\tthis._text = value;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  value \r\n\t\t */\r\n\t\t get fontSize():number {\r\n\t\t\treturn this._fontSize;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t * @return \r\n\t\t */\r\n\t\t set fontSize(value:number) {\r\n\t\t\tthis._fontSize = value;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t * @return \r\n\t\t */\r\n\t\t get color():Color {\r\n\t\t\treturn this._color;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param \r\n\t\t */\r\n\t\t set color(value:Color) {\r\n\t\t\tthis._color = value;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t *  <code>TextMesh</code> \r\n\t\t */\r\n\t\tconstructor(){\r\n\t\t\r\n\t\t}\r\n\t\t\r\n\t\r\n\t\t// private _createVertexBuffer(charCount:number):void {\r\n\t\t// }\r\n\t\t\r\n\t\r\n\t\t// private _resizeVertexBuffer(charCount:number):void {\r\n\t\t\r\n\t\t// }\r\n\t\t\r\n\t\r\n\t\t// private _addChar():void {\r\n\t\t// \t//_vertexBuffer\r\n\t\t// }\r\n\t\r\n\t}\r\n\r\n\r\n"],"mappings":"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"}